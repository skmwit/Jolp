/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.uptime_bundle_jsonpfunction=window.uptime_bundle_jsonpfunction||[]).push([[11],{438:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SyntheticsPolicyEditExtensionWrapper",(function(){return SyntheticsPolicyEditExtensionWrapper}));var external_kbnSharedDeps_React_=__webpack_require__(1),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),types=__webpack_require__(41),useDebounce=__webpack_require__(81),useDebounce_default=__webpack_require__.n(useDebounce),public_=__webpack_require__(16),contexts=__webpack_require__(57),custom_fields=__webpack_require__(206),use_update_policy=__webpack_require__(204),validation=__webpack_require__(205);const SyntheticsPolicyEditExtension=Object(external_kbnSharedDeps_React_.memo)(({newPolicy:newPolicy,onChange:onChange,defaultConfig:defaultConfig,isTLSEnabled:isTLSEnabled})=>{Object(public_.useTrackPageview)({app:"fleet",path:"syntheticsEdit"}),Object(public_.useTrackPageview)({app:"fleet",path:"syntheticsEdit",delay:15e3});const{fields:simpleFields}=Object(external_kbnSharedDeps_React_.useContext)(contexts.c),{fields:httpAdvancedFields}=Object(external_kbnSharedDeps_React_.useContext)(contexts.a),{fields:tcpAdvancedFields}=Object(external_kbnSharedDeps_React_.useContext)(contexts.e),{fields:tlsFields}=Object(external_kbnSharedDeps_React_.useContext)(contexts.g),{config:config,setConfig:setConfig}=Object(use_update_policy.a)({defaultConfig:defaultConfig,newPolicy:newPolicy,onChange:onChange,validate:validation.a});return useDebounce_default()(()=>{setConfig(prevConfig=>({...prevConfig,...simpleFields,...httpAdvancedFields,...tcpAdvancedFields,...tlsFields,[types.a.PROXY_URL]:simpleFields[types.a.MONITOR_TYPE]===types.c.HTTP?httpAdvancedFields[types.a.PROXY_URL]:tcpAdvancedFields[types.a.PROXY_URL]}))},250,[setConfig,simpleFields,httpAdvancedFields,tcpAdvancedFields,tlsFields]),external_kbnSharedDeps_React_default.a.createElement(custom_fields.a,{isTLSEnabled:isTLSEnabled,validate:validation.a[config[types.a.MONITOR_TYPE]]})});SyntheticsPolicyEditExtension.displayName="SyntheticsPolicyEditExtension";const SyntheticsPolicyEditExtensionWrapper=Object(external_kbnSharedDeps_React_.memo)(({policy:currentPolicy,newPolicy:newPolicy,onChange:onChange})=>{const{enableTLS:isTLSEnabled,config:defaultConfig}=Object(external_kbnSharedDeps_React_.useMemo)(()=>{const fallbackConfig={name:"",...contexts.j,...contexts.i,...contexts.k,...contexts.l};let enableTLS=!1;return(()=>{var _currentInput$streams;const currentInput=currentPolicy.inputs.find(input=>!0===input.enabled),vars=null==currentInput||null===(_currentInput$streams=currentInput.streams[0])||void 0===_currentInput$streams?void 0:_currentInput$streams.vars;return{config:Object.values(types.a).reduce((acc,key)=>{var _vars$key;const value=null==vars||null===(_vars$key=vars[key])||void 0===_vars$key?void 0:_vars$key.value;switch(key){case types.a.NAME:acc[key]=currentPolicy.name;break;case types.a.SCHEDULE:if(value){const fullSchedule=JSON.parse(value).replace("@every ",""),unit=fullSchedule.slice(-1),number=fullSchedule.slice(0,fullSchedule.length-1);acc[key]={unit:unit,number:number}}else acc[key]=fallbackConfig[key];break;case types.a.TIMEOUT:case types.a.WAIT:acc[key]=value?value.slice(0,value.length-1):fallbackConfig[key];break;case types.a.TAGS:case types.a.RESPONSE_BODY_CHECK_NEGATIVE:case types.a.RESPONSE_BODY_CHECK_POSITIVE:case types.a.RESPONSE_STATUS_CHECK:case types.a.RESPONSE_HEADERS_CHECK:case types.a.REQUEST_HEADERS_CHECK:acc[key]=value?JSON.parse(value):fallbackConfig[key];break;case types.a.REQUEST_BODY_CHECK:const headers=value?JSON.parse(null==vars?void 0:vars[types.a.REQUEST_HEADERS_CHECK].value):fallbackConfig[types.a.REQUEST_HEADERS_CHECK],requestBodyValue=null!=value?JSON.parse(value):fallbackConfig[key].value;let type=fallbackConfig[key].type;Object.keys(headers||[]).some(headerKey=>{if("Content-Type"===headerKey&&types.j[headers[headerKey]])return type=types.j[headers[headerKey]],!0}),acc[key]={value:requestBodyValue,type:type};break;case types.a.TLS_KEY_PASSPHRASE:case types.a.TLS_VERIFICATION_MODE:acc[key]={value:null!=value?value:fallbackConfig[key].value,isEnabled:!!value},value&&(enableTLS=!0);break;case types.a.TLS_CERTIFICATE:case types.a.TLS_CERTIFICATE_AUTHORITIES:case types.a.TLS_KEY:case types.a.TLS_VERSION:acc[key]={value:value?JSON.parse(value):fallbackConfig[key].value,isEnabled:!!value},value&&(enableTLS=!0);break;default:acc[key]=null!=value?value:fallbackConfig[key]}return acc},{}),enableTLS:enableTLS}})()},[currentPolicy]),simpleFields={[types.a.APM_SERVICE_NAME]:defaultConfig[types.a.APM_SERVICE_NAME],[types.a.HOSTS]:defaultConfig[types.a.HOSTS],[types.a.MAX_REDIRECTS]:defaultConfig[types.a.MAX_REDIRECTS],[types.a.MONITOR_TYPE]:defaultConfig[types.a.MONITOR_TYPE],[types.a.SCHEDULE]:defaultConfig[types.a.SCHEDULE],[types.a.TAGS]:defaultConfig[types.a.TAGS],[types.a.TIMEOUT]:defaultConfig[types.a.TIMEOUT],[types.a.URLS]:defaultConfig[types.a.URLS],[types.a.WAIT]:defaultConfig[types.a.WAIT]},httpAdvancedFields={[types.a.USERNAME]:defaultConfig[types.a.USERNAME],[types.a.PASSWORD]:defaultConfig[types.a.PASSWORD],[types.a.PROXY_URL]:defaultConfig[types.a.PROXY_URL],[types.a.RESPONSE_BODY_CHECK_NEGATIVE]:defaultConfig[types.a.RESPONSE_BODY_CHECK_NEGATIVE],[types.a.RESPONSE_BODY_CHECK_POSITIVE]:defaultConfig[types.a.RESPONSE_BODY_CHECK_POSITIVE],[types.a.RESPONSE_BODY_INDEX]:defaultConfig[types.a.RESPONSE_BODY_INDEX],[types.a.RESPONSE_HEADERS_CHECK]:defaultConfig[types.a.RESPONSE_HEADERS_CHECK],[types.a.RESPONSE_HEADERS_INDEX]:defaultConfig[types.a.RESPONSE_HEADERS_INDEX],[types.a.RESPONSE_STATUS_CHECK]:defaultConfig[types.a.RESPONSE_STATUS_CHECK],[types.a.REQUEST_BODY_CHECK]:defaultConfig[types.a.REQUEST_BODY_CHECK],[types.a.REQUEST_HEADERS_CHECK]:defaultConfig[types.a.REQUEST_HEADERS_CHECK],[types.a.REQUEST_METHOD_CHECK]:defaultConfig[types.a.REQUEST_METHOD_CHECK]},tcpAdvancedFields={[types.a.PROXY_URL]:defaultConfig[types.a.PROXY_URL],[types.a.PROXY_USE_LOCAL_RESOLVER]:defaultConfig[types.a.PROXY_USE_LOCAL_RESOLVER],[types.a.RESPONSE_RECEIVE_CHECK]:defaultConfig[types.a.RESPONSE_RECEIVE_CHECK],[types.a.REQUEST_SEND_CHECK]:defaultConfig[types.a.REQUEST_SEND_CHECK]},tlsFields={[types.a.TLS_CERTIFICATE_AUTHORITIES]:defaultConfig[types.a.TLS_CERTIFICATE_AUTHORITIES],[types.a.TLS_CERTIFICATE]:defaultConfig[types.a.TLS_CERTIFICATE],[types.a.TLS_KEY]:defaultConfig[types.a.TLS_KEY],[types.a.TLS_KEY_PASSPHRASE]:defaultConfig[types.a.TLS_KEY_PASSPHRASE],[types.a.TLS_VERIFICATION_MODE]:defaultConfig[types.a.TLS_VERIFICATION_MODE],[types.a.TLS_VERSION]:defaultConfig[types.a.TLS_VERSION]};return external_kbnSharedDeps_React_default.a.createElement(contexts.d,{defaultValues:simpleFields},external_kbnSharedDeps_React_default.a.createElement(contexts.b,{defaultValues:httpAdvancedFields},external_kbnSharedDeps_React_default.a.createElement(contexts.f,{defaultValues:tcpAdvancedFields},external_kbnSharedDeps_React_default.a.createElement(contexts.h,{defaultValues:tlsFields},external_kbnSharedDeps_React_default.a.createElement(SyntheticsPolicyEditExtension,{newPolicy:newPolicy,onChange:onChange,defaultConfig:defaultConfig,isTLSEnabled:isTLSEnabled})))))});SyntheticsPolicyEditExtensionWrapper.displayName="SyntheticsPolicyEditExtensionWrapper"}}]);