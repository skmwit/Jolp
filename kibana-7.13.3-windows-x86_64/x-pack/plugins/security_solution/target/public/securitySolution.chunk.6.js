/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[6],{320:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return sendGetEndpointSpecificPackagePolicies})),__webpack_require__.d(__webpack_exports__,"f",(function(){return sendGetPackagePolicy})),__webpack_require__.d(__webpack_exports__,"a",(function(){return sendGetAgentPolicyList})),__webpack_require__.d(__webpack_exports__,"g",(function(){return sendPutPackagePolicy})),__webpack_require__.d(__webpack_exports__,"d",(function(){return sendGetFleetAgentStatusForPolicy})),__webpack_require__.d(__webpack_exports__,"e",(function(){return sendGetFleetAgentsWithEndpoint})),__webpack_require__.d(__webpack_exports__,"b",(function(){return sendGetEndpointSecurityPackage}));var _fleet_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(91);const sendGetEndpointSpecificPackagePolicies=(http,options={})=>{var _options$query;return http.get("/api/fleet/package_policies",{...options,query:{...options.query,kuery:`${null!=options&&null!==(_options$query=options.query)&&void 0!==_options$query&&_options$query.kuery?options.query.kuery+" and ":""}${_fleet_common__WEBPACK_IMPORTED_MODULE_0__.PACKAGE_POLICY_SAVED_OBJECT_TYPE}.package.name: endpoint`}})},sendGetPackagePolicy=(http,packagePolicyId,options)=>http.get("/api/fleet/package_policies/"+packagePolicyId,options),sendGetAgentPolicyList=(http,options)=>http.get("/api/fleet/agent_policies",options),sendPutPackagePolicy=(http,packagePolicyId,packagePolicy,options={})=>http.put("/api/fleet/package_policies/"+packagePolicyId,{...options,body:JSON.stringify(packagePolicy)}),sendGetFleetAgentStatusForPolicy=(http,policyId,options={})=>http.get("/api/fleet/agent-status",{...options,query:{policyId:policyId}}),sendGetFleetAgentsWithEndpoint=(http,options={})=>http.get("/api/fleet/agents",{...options,query:{page:1,perPage:1,kuery:'packages : "endpoint"'}}),sendGetEndpointSecurityPackage=async http=>{const endpointPackageInfo=(await http.get("/api/fleet/epm/packages",{query:{category:"security"}})).response.find(epmPackage=>"endpoint"===epmPackage.name);if(!endpointPackageInfo)throw new Error("Endpoint package was not found.");return endpointPackageInfo}},388:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"g",(function(){return metadataCurrentIndexPattern})),__webpack_require__.d(__webpack_exports__,"c",(function(){return TRUSTED_APPS_GET_API})),__webpack_require__.d(__webpack_exports__,"d",(function(){return TRUSTED_APPS_LIST_API})),__webpack_require__.d(__webpack_exports__,"a",(function(){return TRUSTED_APPS_CREATE_API})),__webpack_require__.d(__webpack_exports__,"f",(function(){return TRUSTED_APPS_UPDATE_API})),__webpack_require__.d(__webpack_exports__,"b",(function(){return TRUSTED_APPS_DELETE_API})),__webpack_require__.d(__webpack_exports__,"e",(function(){return TRUSTED_APPS_SUMMARY_API}));const metadataCurrentIndexPattern="metrics-endpoint.metadata_current_*",TRUSTED_APPS_GET_API="/api/endpoint/trusted_apps/{id}",TRUSTED_APPS_LIST_API="/api/endpoint/trusted_apps",TRUSTED_APPS_CREATE_API="/api/endpoint/trusted_apps",TRUSTED_APPS_UPDATE_API="/api/endpoint/trusted_apps/{id}",TRUSTED_APPS_DELETE_API="/api/endpoint/trusted_apps/{id}",TRUSTED_APPS_SUMMARY_API="/api/endpoint/trusted_apps/summary"},486:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return initialPolicyDetailsState})),__webpack_require__.d(__webpack_exports__,"b",(function(){return policyDetailsReducer}));var _selectors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(172);const updatePolicyConfigInPolicyData=(policyData,policyConfig)=>({...policyData,inputs:policyData.inputs.map(input=>({...input,config:input.config&&{...input.config,policy:{...input.config.policy,value:policyConfig}}}))}),initialPolicyDetailsState=()=>({policyItem:void 0,isLoading:!1,agentStatusSummary:{error:0,events:0,offline:0,online:0,total:0,other:0}}),policyDetailsReducer=(state=initialPolicyDetailsState(),action)=>{if("serverReturnedPolicyDetailsData"===action.type||"serverReturnedUpdatedPolicyDetailsData"===action.type)return{...state,...action.payload,isLoading:!1};if("serverFailedToReturnPolicyDetailsData"===action.type)return{...state,isLoading:!1,apiError:action.payload};if("serverReturnedPolicyDetailsAgentSummaryData"===action.type)return{...state,...action.payload};if("serverReturnedPolicyDetailsUpdateFailure"===action.type)return{...state,isLoading:!1,updateStatus:action.payload};if("userClickedPolicyDetailsSaveButton"===action.type)return{...state,isLoading:!0,updateApiError:void 0};if("licenseChanged"===action.type)return{...state,license:action.payload};if("userChangedUrl"===action.type){const newState={...state,location:action.payload},isCurrentlyOnDetailsPage=Object(_selectors__WEBPACK_IMPORTED_MODULE_0__.g)(newState),wasPreviouslyOnDetailsPage=Object(_selectors__WEBPACK_IMPORTED_MODULE_0__.g)(state),currentLicense=Object(_selectors__WEBPACK_IMPORTED_MODULE_0__.h)(newState);return isCurrentlyOnDetailsPage?wasPreviouslyOnDetailsPage?newState:{...newState,isLoading:!0}:{...initialPolicyDetailsState(),location:action.payload,license:currentLicense}}if("userChangedPolicyConfig"===action.type){if(!state.policyItem)return state;const newState={...state,policyItem:{...state.policyItem}},newPolicy={...Object(_selectors__WEBPACK_IMPORTED_MODULE_0__.c)(state)};return newState.policyItem.inputs[0].config.policy.value=newPolicy,Object.entries(action.payload.policyConfig).forEach(([section,newSettings])=>{newPolicy[section]={...newPolicy[section],...newSettings}}),newState}if("userChangedAntivirusRegistration"===action.type){if(state.policyItem){const policyConfig=Object(_selectors__WEBPACK_IMPORTED_MODULE_0__.c)(state);return{...state,policyItem:updatePolicyConfigInPolicyData(state.policyItem,{...policyConfig,windows:{...policyConfig.windows,antivirus_registration:{enabled:action.payload.enabled}}})}}return state}return state}},502:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return service_TrustedAppsHttpService}));var constants=__webpack_require__(388);const resolvePathVariables=(path,variables)=>Object.keys(variables).reduce((acc,paramName)=>acc.replace(new RegExp(`{${paramName}}`,"g"),String(variables[paramName])),path);var ingest=__webpack_require__(320);class service_TrustedAppsHttpService{constructor(http){this.http=http}async getTrustedApp(params){return this.http.get(resolvePathVariables(constants.c,params))}async getTrustedAppsList(request){return this.http.get(constants.d,{query:request})}async deleteTrustedApp(request){return this.http.delete(resolvePathVariables(constants.b,request))}async createTrustedApp(request){return this.http.post(constants.a,{body:JSON.stringify(request)})}async updateTrustedApp(params,updatedTrustedApp){return this.http.put(resolvePathVariables(constants.f,params),{body:JSON.stringify(updatedTrustedApp)})}async getTrustedAppsSummary(){return this.http.get(constants.e)}getPolicyList(options){return Object(ingest.c)(this.http,options)}}},707:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CurrentLicense}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(110),_hooks_use_license__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27);const CurrentLicense=Object(react__WEBPACK_IMPORTED_MODULE_0__.memo)(({children:children})=>{const dispatch=Object(react_redux__WEBPACK_IMPORTED_MODULE_1__.useDispatch)();return Object(react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{var _licenseService$getLi;const subscription=null===(_licenseService$getLi=_hooks_use_license__WEBPACK_IMPORTED_MODULE_2__.a.getLicenseInformation$())||void 0===_licenseService$getLi?void 0:_licenseService$getLi.subscribe(licenseInformation=>{dispatch({type:"licenseChanged",payload:licenseInformation})});return()=>null==subscription?void 0:subscription.unsubscribe()},[dispatch]),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,children)});CurrentLicense.displayName="CurrentLicense"},708:function(module,exports){},719:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return managementMiddlewareFactory}));var common_store=__webpack_require__(129),constants=__webpack_require__(132),policy_config=__webpack_require__(280),selectors=__webpack_require__(172),ingest=__webpack_require__(320);const policyDetailsMiddlewareFactory=coreStart=>{const http=coreStart.http;return({getState:getState,dispatch:dispatch})=>next=>async action=>{next(action);const state=getState();if("userChangedUrl"===action.type&&Object(selectors.g)(state)){const id=Object(selectors.l)(state);let policyItem;try{policyItem=(await Object(ingest.f)(http,id)).item,""===policyItem.inputs[0].config.policy.value.windows.popup.malware.message&&(policyItem.inputs[0].config.policy.value.windows.popup.malware.message=policy_config.a,policyItem.inputs[0].config.policy.value.mac.popup.malware.message=policy_config.a),""===policyItem.inputs[0].config.policy.value.windows.popup.ransomware.message&&(policyItem.inputs[0].config.policy.value.windows.popup.ransomware.message=policy_config.a)}catch(error){return void dispatch({type:"serverFailedToReturnPolicyDetailsData",payload:error.body||error})}if(dispatch({type:"serverReturnedPolicyDetailsData",payload:{policyItem:policyItem}}),policyItem.policy_id){const{results:results}=await Object(ingest.d)(http,policyItem.policy_id);dispatch({type:"serverReturnedPolicyDetailsAgentSummaryData",payload:{agentStatusSummary:results}})}}else if("userClickedPolicyDetailsSaveButton"===action.type){const{id:id}=Object(selectors.j)(state),updatedPolicyItem=Object(selectors.k)(state);let apiResponse;try{apiResponse=await Object(ingest.g)(http,id,updatedPolicyItem).catch(error=>error.response&&409===error.response.status?Object(ingest.f)(http,id).then(packagePolicy=>{const latestUpdatedPolicyItem=packagePolicy.item;return latestUpdatedPolicyItem.inputs[0].config.policy=updatedPolicyItem.inputs[0].config.policy,Object(ingest.g)(http,id,Object(selectors.d)(latestUpdatedPolicyItem))}):Promise.reject(error))}catch(error){return void dispatch({type:"serverReturnedPolicyDetailsUpdateFailure",payload:{success:!1,error:error.body||error}})}dispatch({type:"serverReturnedUpdatedPolicyDetailsData",payload:{policyItem:apiResponse.item,updateStatus:{success:!0}}})}}};__webpack_require__(708),__webpack_require__(486);var store_selectors=__webpack_require__(233),common_=__webpack_require__(91),endpoint_constants=__webpack_require__(388);const endpointMiddlewareFactory=(coreStart,depsStart)=>({getState:getState,dispatch:dispatch})=>next=>async action=>{if(next(action),("userChangedUrl"===action.type||"appRequestedEndpointList"===action.type)&&Object(store_selectors.isOnEndpointPage)(getState())&&!0!==Object(store_selectors.hasSelectedEndpoint)(getState())){if(!Object(store_selectors.endpointPackageInfo)(getState()))try{const packageInfo=await Object(ingest.b)(coreStart.http);dispatch({type:"serverReturnedEndpointPackageInfo",payload:packageInfo})}catch(error){console.error(error)}const{page_index:pageIndex,page_size:pageSize}=Object(store_selectors.uiQueryParams)(getState());let endpointResponse;try{const decodedQuery=Object(store_selectors.searchBarQuery)(getState());endpointResponse=await coreStart.http.post("/api/endpoint/metadata",{body:JSON.stringify({paging_properties:[{page_index:pageIndex},{page_size:pageSize}],filters:{kql:decodedQuery.query}})}),endpointResponse.request_page_index=Number(pageIndex),dispatch({type:"serverReturnedEndpointList",payload:endpointResponse});try{const endpointsTotalCount=await endpointsTotal(coreStart.http);dispatch({type:"serverReturnedEndpointsTotal",payload:endpointsTotalCount})}catch(error){dispatch({type:"serverFailedToReturnEndpointsTotal",payload:error})}try{const agentsWithEndpoint=await Object(ingest.e)(coreStart.http);dispatch({type:"serverReturnedAgenstWithEndpointsTotal",payload:agentsWithEndpoint.total})}catch(error){dispatch({type:"serverFailedToReturnAgenstWithEndpointsTotal",payload:error})}try{const ingestPolicies=await getAgentAndPoliciesForEndpointsList(coreStart.http,endpointResponse.hosts,Object(store_selectors.nonExistingPolicies)(getState()));void 0!==(null==ingestPolicies?void 0:ingestPolicies.packagePolicy)&&dispatch({type:"serverReturnedEndpointNonExistingPolicies",payload:ingestPolicies.packagePolicy}),void 0!==(null==ingestPolicies?void 0:ingestPolicies.agentPolicy)&&dispatch({type:"serverReturnedEndpointAgentPolicies",payload:ingestPolicies.agentPolicy})}catch(error){console.error(error)}}catch(error){dispatch({type:"serverFailedToReturnEndpointList",payload:error})}if(0===Object(store_selectors.patterns)(getState()).length&&Object(store_selectors.isTransformEnabled)(getState()))try{const indexPatterns=await async function(){const{indexPatterns:indexPatterns}=depsStart.data,fields=await indexPatterns.getFieldsForWildcard({pattern:endpoint_constants.g});return[{title:endpoint_constants.g,fields:fields}]}();void 0!==indexPatterns&&dispatch({type:"serverReturnedMetadataPatterns",payload:indexPatterns})}catch(error){dispatch({type:"serverFailedToReturnMetadataPatterns",payload:error})}if(endpointResponse&&0===endpointResponse.hosts.length){const http=coreStart.http;if(await doEndpointsExist(http))return;dispatch({type:"serverReturnedEndpointExistValue",payload:!1});try{const policyDataResponse=await Object(ingest.c)(http,{query:{perPage:50,page:1}});dispatch({type:"serverReturnedPoliciesForOnboarding",payload:{policyItems:policyDataResponse.items}})}catch(error){var _error$body;return void dispatch({type:"serverFailedToReturnPoliciesForOnboarding",payload:null!==(_error$body=error.body)&&void 0!==_error$body?_error$body:error})}}else dispatch({type:"serverCancelledPolicyItemsLoading"}),dispatch({type:"serverReturnedEndpointExistValue",payload:!0})}if("userChangedUrl"===action.type&&!0===Object(store_selectors.hasSelectedEndpoint)(getState())){if(dispatch({type:"serverCancelledPolicyItemsLoading"}),0===Object(store_selectors.listData)(getState()).length){const{page_index:pageIndex,page_size:pageSize}=Object(store_selectors.uiQueryParams)(getState());try{const response=await coreStart.http.post("/api/endpoint/metadata",{body:JSON.stringify({paging_properties:[{page_index:pageIndex},{page_size:pageSize}]})});response.request_page_index=Number(pageIndex),dispatch({type:"serverReturnedEndpointList",payload:response});try{const ingestPolicies=await getAgentAndPoliciesForEndpointsList(coreStart.http,response.hosts,Object(store_selectors.nonExistingPolicies)(getState()));void 0!==(null==ingestPolicies?void 0:ingestPolicies.packagePolicy)&&dispatch({type:"serverReturnedEndpointNonExistingPolicies",payload:ingestPolicies.packagePolicy}),void 0!==(null==ingestPolicies?void 0:ingestPolicies.agentPolicy)&&dispatch({type:"serverReturnedEndpointAgentPolicies",payload:ingestPolicies.agentPolicy})}catch(error){console.error(error)}}catch(error){dispatch({type:"serverFailedToReturnEndpointList",payload:error})}}else dispatch({type:"serverCancelledEndpointListLoading"});const{selected_endpoint:selectedEndpoint}=Object(store_selectors.uiQueryParams)(getState());try{const response=await coreStart.http.get("/api/endpoint/metadata/"+selectedEndpoint);dispatch({type:"serverReturnedEndpointDetails",payload:response});try{const ingestPolicies=await getAgentAndPoliciesForEndpointsList(coreStart.http,[response],Object(store_selectors.nonExistingPolicies)(getState()));void 0!==ingestPolicies&&dispatch({type:"serverReturnedEndpointNonExistingPolicies",payload:ingestPolicies.packagePolicy}),void 0!==(null==ingestPolicies?void 0:ingestPolicies.agentPolicy)&&dispatch({type:"serverReturnedEndpointAgentPolicies",payload:ingestPolicies.agentPolicy})}catch(error){console.error(error)}}catch(error){dispatch({type:"serverFailedToReturnEndpointDetails",payload:error})}try{const policyResponse=await coreStart.http.get("/api/endpoint/policy_response",{query:{agentId:selectedEndpoint}});dispatch({type:"serverReturnedEndpointPolicyResponse",payload:policyResponse})}catch(error){dispatch({type:"serverFailedToReturnEndpointPolicyResponse",payload:error})}}},getAgentAndPoliciesForEndpointsList=async(http,hosts,currentNonExistingPolicies)=>{if(0===hosts.length)return;const policyIdsToCheck=Array.from(new Set(hosts.filter(host=>!currentNonExistingPolicies[host.metadata.Endpoint.policy.applied.id]).map(host=>host.metadata.Endpoint.policy.applied.id)));if(0===policyIdsToCheck.length)return;const policiesFound=(await Object(ingest.a)(http,{query:{kuery:`${common_.AGENT_POLICY_SAVED_OBJECT_TYPE}.package_policies: (${policyIdsToCheck.join(" or ")})`}})).items.reduce((list,agentPolicy)=>(agentPolicy.package_policies.forEach(packagePolicy=>{list.packagePolicy[packagePolicy]=!0,list.agentPolicy[packagePolicy]=agentPolicy.id}),list),{packagePolicy:{},agentPolicy:{}}),nonExistingPackagePoliciesAndExistingAgentPolicies=policyIdsToCheck.reduce((list,policyId)=>policiesFound.packagePolicy[policyId]?(list.agentPolicy[policyId]=policiesFound.agentPolicy[policyId],list):(list.packagePolicy[policyId]=!0,list),{packagePolicy:{},agentPolicy:{}});return 0!==Object.keys(nonExistingPackagePoliciesAndExistingAgentPolicies.packagePolicy).length||0!==Object.keys(nonExistingPackagePoliciesAndExistingAgentPolicies.agentPolicy).length?nonExistingPackagePoliciesAndExistingAgentPolicies:void 0},endpointsTotal=async http=>{try{return(await http.post("/api/endpoint/metadata",{body:JSON.stringify({paging_properties:[{page_index:0},{page_size:1}]})})).total}catch(error){console.error("error while trying to check for total endpoints"),console.error(error)}return 0},doEndpointsExist=async http=>{try{return await endpointsTotal(http)>0}catch(error){console.error("error while trying to check if endpoints exist"),console.error(error)}return!1};var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),service=__webpack_require__(502),trusted_apps_state=__webpack_require__(382),builders=__webpack_require__(281),trusted_apps_store_selectors=__webpack_require__(200);const parseQueryFilterToKQL=filter=>{if(!filter)return"";return`(${["name","description","entries.value","entries.entries.value"].map(field=>`exception-list-agnostic.attributes.${field}:(*${filter.trim().replace(/([\)\(\<\>\}\{\"\:\\])/gm,"\\$&").replace(/\s/gm,"*")}*)`).join(" OR ")})`},NEW_TRUSTED_APP_KEYS=["name","effectScope","entries","description","os","version"],toUpdateTrustedApp=trustedApp=>{const trustedAppForUpdate={};for(const key of NEW_TRUSTED_APP_KEYS)trustedAppForUpdate[key]=trustedApp[key];return trustedAppForUpdate},createTrustedAppsListResourceStateChangedAction=newState=>({type:"trustedAppsListResourceStateChanged",payload:{newState:newState}}),createTrustedAppCreationSubmissionResourceStateChanged=newState=>({type:"trustedAppCreationSubmissionResourceStateChanged",payload:{newState:newState}}),createTrustedAppDeletionSubmissionResourceStateChanged=newState=>({type:"trustedAppDeletionSubmissionResourceStateChanged",payload:{newState:newState}}),createTrustedAppsPageMiddleware=trustedAppsService=>store=>next=>async action=>{next(action),"userChangedUrl"!==action.type&&"trustedAppsListDataOutdated"!==action.type||(await(async(store,trustedAppsService)=>{if(Object(trusted_apps_store_selectors.J)(store.getState())){store.dispatch(createTrustedAppsListResourceStateChangedAction({type:"LoadingResourceState",previousState:Object(trusted_apps_store_selectors.v)(store.getState())}));try{const pageIndex=Object(trusted_apps_store_selectors.m)(store.getState()),pageSize=Object(trusted_apps_store_selectors.n)(store.getState()),filter=Object(trusted_apps_store_selectors.l)(store.getState()),response=await trustedAppsService.getTrustedAppsList({page:pageIndex+1,per_page:pageSize,kuery:parseQueryFilterToKQL(filter)||void 0});store.dispatch(createTrustedAppsListResourceStateChangedAction({type:"LoadedResourceState",data:{items:response.data,pageIndex:pageIndex,pageSize:pageSize,totalItemsCount:response.total,timestamp:Date.now(),filter:filter}}))}catch(error){store.dispatch(createTrustedAppsListResourceStateChangedAction({type:"FailedResourceState",error:error.body,lastLoadedState:Object(trusted_apps_store_selectors.r)(store.getState())}))}}})(store,trustedAppsService),await(async(store,trustedAppsService)=>{const currentState=store.getState(),currentEntriesExistState=Object(trusted_apps_store_selectors.g)(currentState);if(Object(trusted_apps_store_selectors.L)(currentState)&&!Object(trusted_apps_state.isLoadingResourceState)(currentEntriesExistState)){const currentListTotal=Object(trusted_apps_store_selectors.w)(currentState),currentDoEntriesExist=Object(trusted_apps_store_selectors.f)(currentState);if(!Object(trusted_apps_state.isLoadedResourceState)(currentEntriesExistState)||0===currentListTotal&&currentDoEntriesExist||currentListTotal>0&&!currentDoEntriesExist){let doTheyExist;store.dispatch({type:"trustedAppsExistStateChanged",payload:{type:"LoadingResourceState",previousState:currentEntriesExistState}});try{const{total:total}=await trustedAppsService.getTrustedAppsList({page:1,per_page:1});doTheyExist=total>0}catch(e){doTheyExist=!0}store.dispatch({type:"trustedAppsExistStateChanged",payload:{type:"LoadedResourceState",data:doTheyExist}})}}})(store,trustedAppsService)),"userChangedUrl"===action.type&&((store=>{const newEntry=Object(trusted_apps_store_selectors.h)(store.getState()),shouldShow=Object(trusted_apps_store_selectors.y)(store.getState());shouldShow&&!newEntry?store.dispatch({type:"trustedAppCreationDialogStarted",payload:{entry:Object(builders.b)()}}):!shouldShow&&newEntry&&store.dispatch({type:"trustedAppCreationDialogClosed"})})(store),(async({getState:getState,dispatch:dispatch},trustedAppsService)=>{const currentState=getState(),currentPoliciesState=Object(trusted_apps_store_selectors.K)(currentState),isLoading=Object(trusted_apps_state.isLoadingResourceState)(currentPoliciesState),isPageActive=Object(trusted_apps_store_selectors.L)(currentState),isCreateFlow=Object(trusted_apps_store_selectors.y)(currentState);if(isPageActive&&isCreateFlow&&!isLoading){dispatch({type:"trustedAppsPoliciesStateChanged",payload:{type:"LoadingResourceState",previousState:currentPoliciesState}});try{dispatch({type:"trustedAppsPoliciesStateChanged",payload:{type:"LoadedResourceState",data:await trustedAppsService.getPolicyList({query:{page:1,perPage:1e3}})}})}catch(error){dispatch({type:"trustedAppsPoliciesStateChanged",payload:{type:"FailedResourceState",error:error.body||error,lastLoadedState:Object(trusted_apps_state.getLastLoadedResourceState)(Object(trusted_apps_store_selectors.K)(getState()))}})}}})(store,trustedAppsService),(async({getState:getState,dispatch:dispatch},trustedAppsService)=>{const currentState=getState(),isPageActive=Object(trusted_apps_store_selectors.L)(currentState),isEditFlow=Object(trusted_apps_store_selectors.E)(currentState),isAlreadyFetching=Object(trusted_apps_store_selectors.F)(currentState),editTrustedAppId=Object(trusted_apps_store_selectors.b)(currentState);if(isPageActive&&isEditFlow&&!isAlreadyFetching){if(!editTrustedAppId){const errorMessage=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.securitySolution.trustedapps.middleware.editIdMissing",{defaultMessage:"No id provided"});return void dispatch({type:"trustedAppCreationEditItemStateChanged",payload:{type:"FailedResourceState",error:Object.assign(new Error(errorMessage),{statusCode:404,error:errorMessage})}})}let trustedAppForEdit=Object(trusted_apps_store_selectors.e)(currentState);if(trustedAppForEdit&&trustedAppForEdit.id===editTrustedAppId)return;trustedAppForEdit=Object(trusted_apps_store_selectors.t)(currentState).find(ta=>ta.id===editTrustedAppId);try{trustedAppForEdit||(dispatch({type:"trustedAppCreationEditItemStateChanged",payload:{type:"LoadingResourceState",previousState:Object(trusted_apps_store_selectors.c)(currentState)}}),trustedAppForEdit=(await trustedAppsService.getTrustedApp({id:editTrustedAppId})).data),dispatch({type:"trustedAppCreationEditItemStateChanged",payload:{type:"LoadedResourceState",data:trustedAppForEdit}}),dispatch({type:"trustedAppCreationDialogFormStateUpdated",payload:{entry:toUpdateTrustedApp(trustedAppForEdit),isValid:!0}})}catch(e){dispatch({type:"trustedAppCreationEditItemStateChanged",payload:{type:"FailedResourceState",error:e}})}}})(store,trustedAppsService)),"trustedAppCreationDialogConfirmed"===action.type&&await(async(store,trustedAppsService)=>{const currentState=store.getState(),submissionResourceState=Object(trusted_apps_store_selectors.j)(currentState),isValid=Object(trusted_apps_store_selectors.x)(currentState),entry=Object(trusted_apps_store_selectors.h)(currentState),editMode=Object(trusted_apps_store_selectors.E)(currentState);if(Object(trusted_apps_state.isStaleResourceState)(submissionResourceState)&&void 0!==entry&&isValid){store.dispatch(createTrustedAppCreationSubmissionResourceStateChanged({type:"LoadingResourceState",previousState:submissionResourceState}));try{let responseTrustedApp;responseTrustedApp=editMode?(await trustedAppsService.updateTrustedApp({id:Object(trusted_apps_store_selectors.b)(currentState)},entry)).data:(await trustedAppsService.createTrustedApp(entry)).data,store.dispatch(createTrustedAppCreationSubmissionResourceStateChanged({type:"LoadedResourceState",data:responseTrustedApp})),store.dispatch({type:"trustedAppsListDataOutdated"})}catch(error){store.dispatch(createTrustedAppCreationSubmissionResourceStateChanged({type:"FailedResourceState",error:error.body,lastLoadedState:Object(trusted_apps_state.getLastLoadedResourceState)(submissionResourceState)}))}}})(store,trustedAppsService),"trustedAppDeletionDialogConfirmed"===action.type&&await(async(store,trustedAppsService)=>{const submissionResourceState=Object(trusted_apps_store_selectors.q)(store.getState()),entry=Object(trusted_apps_store_selectors.o)(store.getState());if(Object(trusted_apps_state.isStaleResourceState)(submissionResourceState)&&void 0!==entry){store.dispatch(createTrustedAppDeletionSubmissionResourceStateChanged({type:"LoadingResourceState",previousState:submissionResourceState}));try{await trustedAppsService.deleteTrustedApp({id:entry.id}),store.dispatch(createTrustedAppDeletionSubmissionResourceStateChanged({type:"LoadedResourceState",data:null})),store.dispatch({type:"trustedAppDeletionDialogClosed"}),store.dispatch({type:"trustedAppsListDataOutdated"})}catch(error){store.dispatch(createTrustedAppDeletionSubmissionResourceStateChanged({type:"FailedResourceState",error:error.body,lastLoadedState:Object(trusted_apps_state.getLastLoadedResourceState)(submissionResourceState)}))}}})(store,trustedAppsService)},trustedAppsPageMiddlewareFactory=coreStart=>createTrustedAppsPageMiddleware(new service.a(coreStart.http)),createSubStateSelector=namespace=>state=>state[constants.l][namespace],managementMiddlewareFactory=(coreStart,depsStart)=>[Object(common_store.substateMiddlewareFactory)(createSubStateSelector(constants.m),policyDetailsMiddlewareFactory(coreStart)),Object(common_store.substateMiddlewareFactory)(createSubStateSelector(constants.k),endpointMiddlewareFactory(coreStart,depsStart)),Object(common_store.substateMiddlewareFactory)(createSubStateSelector(constants.n),trustedAppsPageMiddlewareFactory(coreStart))]},730:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return managementReducer}));var redux=__webpack_require__(192),reducer=__webpack_require__(486),constants=__webpack_require__(132),selectors=__webpack_require__(233);const initialEndpointListState={hosts:[],pageSize:10,pageIndex:0,total:0,loading:!1,error:void 0,details:void 0,detailsLoading:!1,detailsError:void 0,policyResponse:void 0,policyResponseLoading:!1,policyResponseError:void 0,location:void 0,policyItems:[],selectedPolicyId:void 0,policyItemsLoading:!1,endpointPackageInfo:void 0,nonExistingPolicies:{},agentPolicies:{},endpointsExist:!0,patterns:[],patternsError:void 0,isAutoRefreshEnabled:!0,autoRefreshInterval:constants.a,agentsWithEndpointsTotal:0,agentsWithEndpointsTotalError:void 0,endpointsTotal:0,endpointsTotalError:void 0,queryStrategyVersion:void 0,policyVersionInfo:void 0,hostStatus:void 0};var builders=__webpack_require__(281),querystring_es3=__webpack_require__(316),external_kbnSharedDeps_ReactRouterDom_=__webpack_require__(77),routing=__webpack_require__(149),store_selectors=__webpack_require__(200);const userChangedUrl=(state,action)=>{if(location=action.payload,null!==Object(external_kbnSharedDeps_ReactRouterDom_.matchPath)(null!==(_location$pathname=location.pathname)&&void 0!==_location$pathname?_location$pathname:"",{path:constants.j,exact:!0})){return{...state,active:!0,location:Object(routing.b)(Object(querystring_es3.parse)(action.payload.search.slice(1)))}}return Object(builders.e)();var location,_location$pathname},immutableCombineReducers=redux.combineReducers,managementReducer=(constants.m,Object(reducer.a)(),constants.k,constants.n,Object(builders.e)(),immutableCombineReducers({[constants.m]:reducer.b,[constants.k]:(state=initialEndpointListState,action)=>{if("serverReturnedEndpointList"===action.type){const{hosts:hosts,total:total,request_page_size:pageSize,request_page_index:pageIndex,query_strategy_version:queryStrategyVersion,policy_info:policyVersionInfo}=action.payload;return{...state,hosts:hosts,total:total,pageSize:pageSize,pageIndex:pageIndex,queryStrategyVersion:queryStrategyVersion,policyVersionInfo:policyVersionInfo,loading:!1,error:void 0}}if("serverFailedToReturnEndpointList"===action.type)return{...state,error:action.payload,loading:!1};if("serverReturnedEndpointNonExistingPolicies"===action.type)return{...state,nonExistingPolicies:{...state.nonExistingPolicies,...action.payload}};if("serverReturnedEndpointAgentPolicies"===action.type)return{...state,agentPolicies:{...state.agentPolicies,...action.payload}};if("serverReturnedMetadataPatterns"===action.type)return{...state,patterns:action.payload,patternsError:void 0};if("serverFailedToReturnMetadataPatterns"===action.type)return{...state,patternsError:action.payload};if("serverReturnedEndpointDetails"===action.type)return{...state,details:action.payload.metadata,policyVersionInfo:action.payload.policy_info,hostStatus:action.payload.host_status,detailsLoading:!1,detailsError:void 0};if("serverFailedToReturnEndpointDetails"===action.type)return{...state,detailsError:action.payload,detailsLoading:!1};if("serverReturnedPoliciesForOnboarding"===action.type)return{...state,policyItems:action.payload.policyItems,policyItemsLoading:!1};if("serverFailedToReturnPoliciesForOnboarding"===action.type)return{...state,error:action.payload,policyItemsLoading:!1};if("serverReturnedEndpointPolicyResponse"===action.type)return{...state,policyResponse:action.payload.policy_response,policyResponseLoading:!1,policyResponseError:void 0};if("serverFailedToReturnEndpointPolicyResponse"===action.type)return{...state,policyResponseError:action.payload,policyResponseLoading:!1};if("userSelectedEndpointPolicy"===action.type)return{...state,selectedPolicyId:action.payload.selectedPolicyId,policyResponseLoading:!1};if("serverCancelledEndpointListLoading"===action.type)return{...state,loading:!1};if("serverCancelledPolicyItemsLoading"===action.type)return{...state,policyItemsLoading:!1};if("serverReturnedEndpointPackageInfo"===action.type)return{...state,endpointPackageInfo:action.payload};if("serverReturnedEndpointExistValue"===action.type)return{...state,endpointsExist:action.payload};if("serverReturnedAgenstWithEndpointsTotal"===action.type)return{...state,agentsWithEndpointsTotal:action.payload,agentsWithEndpointsTotalError:void 0};if("serverFailedToReturnAgenstWithEndpointsTotal"===action.type)return{...state,agentsWithEndpointsTotalError:action.payload};if("serverReturnedEndpointsTotal"===action.type)return{...state,endpointsTotal:action.payload,endpointsTotalError:void 0};if("serverFailedToReturnEndpointsTotal"===action.type)return{...state,endpointsTotalError:action.payload};var _action$payload$isAut,_action$payload$autoR;if("userUpdatedEndpointListRefreshOptions"===action.type)return{...state,isAutoRefreshEnabled:null!==(_action$payload$isAut=action.payload.isAutoRefreshEnabled)&&void 0!==_action$payload$isAut?_action$payload$isAut:state.isAutoRefreshEnabled,autoRefreshInterval:null!==(_action$payload$autoR=action.payload.autoRefreshInterval)&&void 0!==_action$payload$autoR?_action$payload$autoR:state.autoRefreshInterval};if("userChangedUrl"===action.type){const newState={...state,location:action.payload},isCurrentlyOnListPage=Object(selectors.isOnEndpointPage)(newState)&&!Object(selectors.hasSelectedEndpoint)(newState),wasPreviouslyOnListPage=Object(selectors.isOnEndpointPage)(state)&&!Object(selectors.hasSelectedEndpoint)(state),isCurrentlyOnDetailsPage=Object(selectors.isOnEndpointPage)(newState)&&Object(selectors.hasSelectedEndpoint)(newState),wasPreviouslyOnDetailsPage=Object(selectors.isOnEndpointPage)(state)&&Object(selectors.hasSelectedEndpoint)(state);if(isCurrentlyOnListPage){if(!wasPreviouslyOnListPage)return{...state,location:action.payload,loading:!0,policyItemsLoading:!0,error:void 0,detailsError:void 0}}else if(isCurrentlyOnDetailsPage)return wasPreviouslyOnDetailsPage||wasPreviouslyOnListPage?{...state,location:action.payload,detailsLoading:!0,policyResponseLoading:!0,error:void 0,detailsError:void 0,policyResponseError:void 0}:{...state,location:action.payload,loading:!0,detailsLoading:!0,policyResponseLoading:!0,error:void 0,detailsError:void 0,policyResponseError:void 0,policyItemsLoading:!0};return{...state,location:action.payload,error:void 0,detailsError:void 0,policyResponseError:void 0,endpointsExist:!0}}return state},[constants.n]:(state=Object(builders.e)(),action)=>{switch(action.type){case"trustedAppsListDataOutdated":return((state,action)=>({...state,listView:{...state.listView,freshDataTimestamp:Date.now()}}))(state);case"trustedAppsListResourceStateChanged":return((state,action)=>({...state,listView:{...state.listView,listResourceState:action.payload.newState}}))(state,action);case"trustedAppDeletionSubmissionResourceStateChanged":return((state,action)=>({...state,deletionDialog:{...state.deletionDialog,submissionResourceState:action.payload.newState}}))(state,action);case"trustedAppDeletionDialogStarted":return((state,action)=>({...state,deletionDialog:{...Object(builders.d)(),...action.payload}}))(state,action);case"trustedAppDeletionDialogConfirmed":return(state=>({...state,deletionDialog:{...state.deletionDialog,confirmed:!0}}))(state);case"trustedAppDeletionDialogClosed":return(state=>({...state,deletionDialog:Object(builders.d)()}))(state);case"trustedAppCreationSubmissionResourceStateChanged":return((state,action)=>({...state,creationDialog:{...state.creationDialog,submissionResourceState:action.payload.newState}}))(state,action);case"trustedAppCreationDialogStarted":return((state,action)=>({...state,creationDialog:{...Object(builders.c)(),formState:{...action.payload,isValid:!1}}}))(state,action);case"trustedAppCreationDialogFormStateUpdated":return((state,action)=>({...state,creationDialog:{...state.creationDialog,formState:{...action.payload}}}))(state,action);case"trustedAppCreationEditItemStateChanged":return((state,action)=>({...state,creationDialog:{...state.creationDialog,editItem:action.payload}}))(state,action);case"trustedAppCreationDialogConfirmed":return(state=>({...state,creationDialog:{...state.creationDialog,confirmed:!0}}))(state);case"trustedAppCreationDialogClosed":return(state=>({...state,creationDialog:Object(builders.c)()}))(state);case"userChangedUrl":return userChangedUrl(state,action);case"trustedAppsExistStateChanged":return((state,{payload:payload})=>Object(store_selectors.g)(state)!==payload?{...state,entriesExist:payload}:state)(state,action);case"trustedAppsPoliciesStateChanged":return((state,{payload:payload})=>Object(store_selectors.L)(state)?{...state,policies:payload}:state)(state,action)}return state}}))}}]);