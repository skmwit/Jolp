/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[16],{280:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return processFilters}));var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(41);function processFilters(filters,query,controlledBy){const must=["kuery"===query.language?_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__.esKuery.toElasticsearchQuery(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__.esKuery.fromKueryExpression(query.query)):_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__.esQuery.luceneStringToDsl(query.query)],mustNot=[];for(const filter of filters){if(filter.meta.disabled||void 0!==controlledBy&&filter.meta.controlledBy===controlledBy)continue;const{meta:{negate:negate,type:type,key:fieldName}}=filter;let filterQuery=filter.query;void 0===filterQuery&&"exists"===type&&(filterQuery={exists:{field:fieldName}}),negate?mustNot.push(filterQuery):must.push(filterQuery)}return{bool:{must:must,must_not:mustNot}}}},281:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getJobsObservable}));var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25),lodash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7),_common_util_parse_interval__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(26);function getJobsObservable(embeddableInput,anomalyDetectorService,setErrorHandler){return embeddableInput.pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.pluck)("jobIds"),Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.distinctUntilChanged)(lodash__WEBPACK_IMPORTED_MODULE_2__.isEqual),Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.switchMap)(jobsIds=>anomalyDetectorService.getJobs$(jobsIds)),Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.map)(jobs=>jobs.map(job=>{const bucketSpan=Object(_common_util_parse_interval__WEBPACK_IMPORTED_MODULE_3__.a)(job.analysis_config.bucket_span);return{id:job.job_id,selected:!0,bucketSpanSeconds:bucketSpan.asSeconds()}})),Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.catchError)(e=>{var _e$body;return setErrorHandler(null!==(_e$body=e.body)&&void 0!==_e$body?_e$body:e),Object(rxjs__WEBPACK_IMPORTED_MODULE_0__.of)(void 0)}))}},886:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"EmbeddableSwimLaneContainer",(function(){return EmbeddableSwimLaneContainer}));var external_kbnSharedDeps_React_=__webpack_require__(14),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(39),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(40),external_kbnSharedDeps_Rxjs_=__webpack_require__(23),external_kbnSharedDeps_RxjsOperators_=__webpack_require__(25),time_buckets=__webpack_require__(90),explorer_constants=__webpack_require__(75),public_=__webpack_require__(41),swimlane_container=__webpack_require__(161),embeddable_public_=__webpack_require__(45),process_filters=__webpack_require__(280),public_0=__webpack_require__(36),get_jobs_observable=__webpack_require__(281);var ui_actions=__webpack_require__(181);const EmbeddableSwimLaneContainer=({id:id,embeddableContext:embeddableContext,embeddableInput:embeddableInput,services:services,refresh:refresh,onInputChange:onInputChange,onOutputChange:onOutputChange})=>{const[chartWidth,setChartWidth]=Object(external_kbnSharedDeps_React_.useState)(0),[fromPage,setFromPage]=Object(external_kbnSharedDeps_React_.useState)(1),[{},{uiActions:uiActions}]=services,[selectedCells,setSelectedCells]=Object(external_kbnSharedDeps_React_.useState)(),[swimlaneType,swimlaneData,perPage,setPerPage,timeBuckets,isLoading,error]=function(embeddableInput$,onInputChange,refresh,services,chartWidth,fromPage){const[{uiSettings:uiSettings},,{anomalyTimelineService:anomalyTimelineService,anomalyDetectorService:anomalyDetectorService}]=services,[swimlaneData,setSwimlaneData]=Object(external_kbnSharedDeps_React_.useState)(),[swimlaneType,setSwimlaneType]=Object(external_kbnSharedDeps_React_.useState)(),[error,setError]=Object(external_kbnSharedDeps_React_.useState)(),[perPage,setPerPage]=Object(external_kbnSharedDeps_React_.useState)(),[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_.useState)(!1),chartWidth$=Object(external_kbnSharedDeps_React_.useMemo)(()=>new external_kbnSharedDeps_Rxjs_.Subject,[]),selectedJobs$=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(get_jobs_observable.a)(embeddableInput$,anomalyDetectorService,setError).pipe(Object(external_kbnSharedDeps_RxjsOperators_.shareReplay)(1)),[]),bucketInterval$=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(external_kbnSharedDeps_Rxjs_.combineLatest)([selectedJobs$,chartWidth$,embeddableInput$.pipe(Object(external_kbnSharedDeps_RxjsOperators_.pluck)("timeRange"))]).pipe(Object(external_kbnSharedDeps_RxjsOperators_.skipWhile)(([jobs,width])=>!Array.isArray(jobs)||!width),Object(external_kbnSharedDeps_RxjsOperators_.tap)(([,,timeRange])=>{anomalyTimelineService.setTimeRange(timeRange)}),Object(external_kbnSharedDeps_RxjsOperators_.map)(([jobs,width])=>anomalyTimelineService.getSwimlaneBucketInterval(jobs,width)),Object(external_kbnSharedDeps_RxjsOperators_.distinctUntilChanged)((prev,curr)=>prev.asSeconds()===curr.asSeconds())),[]),fromPage$=Object(external_kbnSharedDeps_React_.useMemo)(()=>new external_kbnSharedDeps_Rxjs_.Subject,[]),perPage$=Object(external_kbnSharedDeps_React_.useMemo)(()=>new external_kbnSharedDeps_Rxjs_.Subject,[]),timeBuckets=Object(external_kbnSharedDeps_React_.useMemo)(()=>new time_buckets.a({"histogram:maxBars":uiSettings.get(public_.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":uiSettings.get(public_.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")}),[]);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{const subscription=Object(external_kbnSharedDeps_Rxjs_.combineLatest)([selectedJobs$,embeddableInput$,bucketInterval$,fromPage$,perPage$.pipe(Object(external_kbnSharedDeps_RxjsOperators_.startWith)(void 0),Object(external_kbnSharedDeps_RxjsOperators_.distinctUntilChanged)((prev,curr)=>void 0===prev&&curr===explorer_constants.i)),refresh.pipe(Object(external_kbnSharedDeps_RxjsOperators_.startWith)(null))]).pipe(Object(external_kbnSharedDeps_RxjsOperators_.tap)(setIsLoading.bind(null,!0)),Object(external_kbnSharedDeps_RxjsOperators_.debounceTime)(500),Object(external_kbnSharedDeps_RxjsOperators_.switchMap)(([explorerJobs,input,bucketInterval,fromPageInput,perPageFromState])=>{if(!explorerJobs)return Object(external_kbnSharedDeps_Rxjs_.of)(void 0);const{viewBy:viewBy,swimlaneType:swimlaneTypeInput,perPage:perPageInput,filters:filters,query:query,viewMode:viewMode}=input;let appliedFilters;swimlaneType||setSwimlaneType(swimlaneTypeInput);try{appliedFilters=Object(process_filters.a)(filters,query,public_0.CONTROLLED_BY_SWIM_LANE_FILTER)}catch(e){return setError(e),Object(external_kbnSharedDeps_Rxjs_.of)(void 0)}return Object(external_kbnSharedDeps_Rxjs_.from)(anomalyTimelineService.loadOverallData(explorerJobs,void 0,bucketInterval)).pipe(Object(external_kbnSharedDeps_RxjsOperators_.switchMap)(overallSwimlaneData=>{const{earliest:earliest,latest:latest}=overallSwimlaneData;var _ref;return overallSwimlaneData&&swimlaneTypeInput===explorer_constants.h.VIEW_BY?(void 0===perPageFromState&&setPerPage(null!=perPageInput?perPageInput:explorer_constants.i),viewMode===embeddable_public_.ViewMode.EDIT&&perPageFromState!==perPageInput&&onInputChange({perPage:perPageFromState}),Object(external_kbnSharedDeps_Rxjs_.from)(anomalyTimelineService.loadViewBySwimlane([],{earliest:earliest,latest:latest},explorerJobs,viewBy,Object(swimlane_container.c)(swimlaneData)?swimlaneData.cardinality:explorer_constants.a,null!==(_ref=null!=perPageFromState?perPageFromState:perPageInput)&&void 0!==_ref?_ref:explorer_constants.i,fromPageInput,void 0,appliedFilters,bucketInterval)).pipe(Object(external_kbnSharedDeps_RxjsOperators_.map)(viewBySwimlaneData=>({...viewBySwimlaneData,earliest:earliest,latest:latest})))):Object(external_kbnSharedDeps_Rxjs_.of)(overallSwimlaneData)}))}),Object(external_kbnSharedDeps_RxjsOperators_.catchError)(e=>(setError(e.body),Object(external_kbnSharedDeps_Rxjs_.of)(void 0)))).subscribe(data=>{void 0!==data&&(setError(null),setSwimlaneData(data),setIsLoading(!1))});return()=>{subscription.unsubscribe()}},[]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{fromPage$.next(fromPage)},[fromPage]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{void 0!==perPage&&perPage$.next(perPage)},[perPage]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{chartWidth$.next(chartWidth)},[chartWidth]),[swimlaneType,swimlaneData,null!=perPage?perPage:explorer_constants.i,setPerPage,timeBuckets,isLoading,error]}(embeddableInput,onInputChange,refresh,services,chartWidth,fromPage);Object(external_kbnSharedDeps_React_.useEffect)(()=>{onOutputChange({perPage:perPage,fromPage:fromPage,interval:null==swimlaneData?void 0:swimlaneData.interval})},[perPage,fromPage,swimlaneData]);const onCellsSelection=Object(external_kbnSharedDeps_React_.useCallback)(update=>{setSelectedCells(update),update&&uiActions.getTrigger(ui_actions.a).exec({embeddable:embeddableContext,data:update,updateCallback:setSelectedCells.bind(null,void 0)})},[swimlaneData,perPage,fromPage,setSelectedCells]);return error?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.errorMessage",defaultMessage:"Unable to load the ML swim lane data"}),color:"danger",iconType:"alert",style:{width:"100%"}},external_kbnSharedDeps_React_default.a.createElement("p",null,error.message)):external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"100%",padding:"8px"},"data-test-subj":"mlAnomalySwimlaneEmbeddableWrapper"},external_kbnSharedDeps_React_default.a.createElement(swimlane_container.b,{id:id,"data-test-subj":"mlSwimLaneEmbeddable_"+embeddableContext.id,timeBuckets:timeBuckets,swimlaneData:swimlaneData,swimlaneType:swimlaneType,fromPage:fromPage,perPage:perPage,swimlaneLimit:Object(swimlane_container.c)(swimlaneData)?swimlaneData.cardinality:void 0,onResize:setChartWidth,selection:selectedCells,onCellsSelection:onCellsSelection,onPaginationChange:update=>{update.fromPage&&setFromPage(update.fromPage),update.perPage&&(setFromPage(1),setPerPage(update.perPage))},isLoading:isLoading,noDataWarning:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.noDataFound",defaultMessage:"No anomalies found"})}))};__webpack_exports__.default=EmbeddableSwimLaneContainer},90:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return getTimeBucketsFromCache})),__webpack_require__.d(__webpack_exports__,"a",(function(){return TimeBuckets})),__webpack_require__.d(__webpack_exports__,"b",(function(){return getBoundsRoundedToInterval}));var external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Moment_=__webpack_require__(15),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_),datemath_target=__webpack_require__(30),target_default=__webpack_require__.n(datemath_target);const{duration:d}=external_kbnSharedDeps_Moment_default.a;var parse_interval=__webpack_require__(26),dependency_cache=__webpack_require__(22),public_=__webpack_require__(41);const unitsDesc=target_default.a.unitsDesc,timeUnitsMaxSupportedIndex=unitsDesc.indexOf("w"),calcAuto=function(){const revRoundingRules=[[d(500,"ms"),d(100,"ms")],[d(5,"second"),d(1,"second")],[d(10,"second"),d(5,"second")],[d(15,"second"),d(10,"second")],[d(30,"second"),d(15,"second")],[d(1,"minute"),d(30,"second")],[d(5,"minute"),d(1,"minute")],[d(10,"minute"),d(5,"minute")],[d(15,"minute"),d(10,"minute")],[d(30,"minute"),d(10,"minute")],[d(1,"hour"),d(30,"minute")],[d(2,"hour"),d(1,"hour")],[d(4,"hour"),d(2,"hour")],[d(6,"hour"),d(4,"hour")],[d(8,"hour"),d(6,"hour")],[d(12,"hour"),d(8,"hour")],[d(24,"hour"),d(12,"hour")],[d(2,"d"),d(1,"d")],[d(4,"d"),d(2,"d")],[d(1,"week"),d(4,"d")],[d(1,"month"),d(1,"week")],[d(1,"year"),d(1,"month")],[1/0,d(1,"year")]].slice(0).reverse();function find(rules,check,last){return function(buckets,duration){const interval=function(buckets,duration){const target=duration/buckets;let lastResp;for(let i=0;i<rules.length;i++){const rule=rules[i],resp=check(rule[0],rule[1],target);if(null==resp){if(!last)continue;if(lastResp)return lastResp;break}if(!last)return resp;lastResp=resp}const ms=Math.max(Math.floor(target),1);return external_kbnSharedDeps_Moment_default.a.duration(ms,"ms")}(buckets,duration);if(interval)return external_kbnSharedDeps_Moment_default.a.duration(interval._data)}}return{near:find(revRoundingRules,(function(upperBound,lowerBound,target){if(upperBound>target){if(upperBound===1/0)return lowerBound;const boundMs=upperBound.asMilliseconds(),intervalMs=lowerBound.asMilliseconds();return Math.abs(boundMs-target)<=Math.abs(intervalMs)?upperBound:lowerBound}}),!0),lessThan:find(revRoundingRules,(function(upperBound,lowerBound,target){if(lowerBound<target)return upperBound!==1/0?upperBound:lowerBound})),atLeast:find(revRoundingRules,(function(upperBound,lowerBound,target){if(lowerBound<=target)return lowerBound}))}}();function getTimeBucketsFromCache(){const uiSettings=Object(dependency_cache.k)();return new TimeBuckets({[public_.UI_SETTINGS.HISTOGRAM_MAX_BARS]:uiSettings.get(public_.UI_SETTINGS.HISTOGRAM_MAX_BARS),[public_.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:uiSettings.get(public_.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")})}function TimeBuckets(timeBucketsConfig){this._timeBucketsConfig=timeBucketsConfig,this.barTarget=this._timeBucketsConfig[public_.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[public_.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function decorateInterval(interval,originalDuration){const esInterval=function(duration){for(let i=0;i<unitsDesc.length;i++){const unit=unitsDesc[i],val=duration.as(unit);if(val>=1&&Math.floor(val)===val){if(i<=timeUnitsMaxSupportedIndex)continue;return{value:val,unit:unit,expression:val+unit}}}const ms=duration.as("ms");return{value:ms,unit:"ms",expression:ms+"ms"}}(interval);interval.esValue=esInterval.value,interval.esUnit=esInterval.unit,interval.expression=esInterval.expression,interval.overflow=originalDuration>interval&&external_kbnSharedDeps_Moment_default.a.duration(interval-originalDuration);const prettyUnits=external_kbnSharedDeps_Moment_default.a.normalizeUnits(esInterval.unit);return 1===esInterval.value?interval.description=prettyUnits:interval.description=`${esInterval.value} ${prettyUnits}s`,interval}function isValidMoment(m){return m&&"isValid"in m&&m.isValid()}function getBoundsRoundedToInterval(bounds,interval,inclusiveEnd=!1){const intervalMs=interval.asMilliseconds(),adjustedMinMs=Math.floor(bounds.min.valueOf()/intervalMs)*intervalMs;let adjustedMaxMs=Math.ceil(bounds.max.valueOf()/intervalMs)*intervalMs;return!1===inclusiveEnd&&(adjustedMaxMs-=1),{min:external_kbnSharedDeps_Moment_default()(adjustedMinMs),max:external_kbnSharedDeps_Moment_default()(adjustedMaxMs)}}TimeBuckets.prototype.setBarTarget=function(bt){this.barTarget=bt},TimeBuckets.prototype.setMaxBars=function(mb){this.maxBars=mb},TimeBuckets.prototype.setBounds=function(input){if(!input)return this.clearBounds();let bounds;bounds=Object(external_kbnSharedDeps_Lodash_.isPlainObject)(input)?[input.min,input.max]:Array.isArray(input)?input:[];const moments=Object(external_kbnSharedDeps_Lodash_.sortBy)(bounds.map(Object(external_kbnSharedDeps_Lodash_.ary)(external_kbnSharedDeps_Moment_default.a,1)),Number);if(!(2===moments.length&&moments.every(isValidMoment)))throw this.clearBounds(),new Error("invalid bounds set: "+input);if(this._lb=moments.shift(),this._ub=moments.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},TimeBuckets.prototype.clearBounds=function(){this._lb=this._ub=null},TimeBuckets.prototype.hasBounds=function(){return isValidMoment(this._ub)&&isValidMoment(this._lb)},TimeBuckets.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},TimeBuckets.prototype.getDuration=function(){if(this.hasBounds())return external_kbnSharedDeps_Moment_default.a.duration(this._ub-this._lb,"ms")},TimeBuckets.prototype.setInterval=function(input){this.originalInterval=input;let interval=input;if(interval&&"auto"!==interval){if(Object(external_kbnSharedDeps_Lodash_.isString)(interval)&&(input=interval,interval=Object(parse_interval.a)(interval),0==+interval&&(interval=null)),!external_kbnSharedDeps_Moment_default.a.isDuration(interval))throw new TypeError('"'+input+'" is not a valid interval.');this._i=interval}else this._i="auto"},TimeBuckets.prototype.getInterval=function(){const self=this,duration=self.getDuration();return decorateInterval(function(interval){if(!self.hasBounds())return interval;const maxLength=self.maxBars;let scaled;if(!(duration/interval>maxLength))return interval;scaled=calcAuto.lessThan(maxLength,duration);return+scaled==+interval?interval:(decorateInterval(interval,duration),Object(external_kbnSharedDeps_Lodash_.assign)(scaled,{preScaled:interval,scale:interval/scaled,scaled:!0}))}(function(){const interval=self._i;return external_kbnSharedDeps_Moment_default.a.isDuration(interval)?interval:calcAuto.near(self.barTarget,duration)}()),duration)},TimeBuckets.prototype.getIntervalToNearestMultiple=function(divisorSecs){const interval=this.getInterval(),intervalSecs=interval.asSeconds(),remainder=intervalSecs%divisorSecs;if(0===remainder)return interval;let nearestMultiple=remainder>divisorSecs/2?intervalSecs+divisorSecs-remainder:intervalSecs-remainder;nearestMultiple=0===nearestMultiple?divisorSecs:nearestMultiple;const nearestMultipleInt=external_kbnSharedDeps_Moment_default.a.duration(nearestMultiple,"seconds");decorateInterval(nearestMultipleInt,this.getDuration());const preScaled=interval.preScaled;return void 0!==preScaled&&preScaled<nearestMultipleInt&&(nearestMultipleInt.preScaled=preScaled,nearestMultipleInt.scale=preScaled/nearestMultipleInt,nearestMultipleInt.scaled=!0),nearestMultipleInt},TimeBuckets.prototype.getScaledDateFormat=function(){const interval=this.getInterval(),rules=this._timeBucketsConfig["dateFormat:scaled"];for(let i=rules.length-1;i>=0;i--){const rule=rules[i];if(!rule[0]||interval>=external_kbnSharedDeps_Moment_default.a.duration(rule[0]))return rule[1]}return this._timeBucketsConfig.dateFormat},TimeBuckets.prototype.getScaledDateFormatter=function(){return new(Object(dependency_cache.c)().getType(public_.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)}}}]);