/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[13],{106:function(module,__webpack_exports__,__webpack_require__){"use strict";let DATAFEED_STATE,FORECAST_REQUEST_STATE,JOB_STATE;__webpack_require__.d(__webpack_exports__,"a",(function(){return DATAFEED_STATE})),__webpack_require__.d(__webpack_exports__,"b",(function(){return FORECAST_REQUEST_STATE})),__webpack_require__.d(__webpack_exports__,"c",(function(){return JOB_STATE})),function(DATAFEED_STATE){DATAFEED_STATE.STARTED="started",DATAFEED_STATE.STARTING="starting",DATAFEED_STATE.STOPPED="stopped",DATAFEED_STATE.STOPPING="stopping",DATAFEED_STATE.DELETED="deleted"}(DATAFEED_STATE||(DATAFEED_STATE={})),function(FORECAST_REQUEST_STATE){FORECAST_REQUEST_STATE.FAILED="failed",FORECAST_REQUEST_STATE.FINISHED="finished",FORECAST_REQUEST_STATE.SCHEDULED="scheduled",FORECAST_REQUEST_STATE.STARTED="started"}(FORECAST_REQUEST_STATE||(FORECAST_REQUEST_STATE={})),function(JOB_STATE){JOB_STATE.CLOSED="closed",JOB_STATE.CLOSING="closing",JOB_STATE.FAILED="failed",JOB_STATE.OPENED="opened",JOB_STATE.OPENING="opening",JOB_STATE.DELETED="deleted"}(JOB_STATE||(JOB_STATE={}))},121:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SEVERITY_OPTIONS})),__webpack_require__.d(__webpack_exports__,"d",(function(){return optionValueToThreshold})),__webpack_require__.d(__webpack_exports__,"e",(function(){return useTableSeverity})),__webpack_require__.d(__webpack_exports__,"b",(function(){return SelectSeverity})),__webpack_require__.d(__webpack_exports__,"c",(function(){return SelectSeverityUI}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(40),_elastic_eui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(39),_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),_util_url_state__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(77),_common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(16);const warningLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__.i18n.translate("xpack.ml.controls.selectSeverity.warningLabel",{defaultMessage:"warning"}),minorLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__.i18n.translate("xpack.ml.controls.selectSeverity.minorLabel",{defaultMessage:"minor"}),majorLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__.i18n.translate("xpack.ml.controls.selectSeverity.majorLabel",{defaultMessage:"major"}),criticalLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__.i18n.translate("xpack.ml.controls.selectSeverity.criticalLabel",{defaultMessage:"critical"}),optionsMap={[warningLabel]:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.LOW,[minorLabel]:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MINOR,[majorLabel]:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MAJOR,[criticalLabel]:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.CRITICAL},SEVERITY_OPTIONS=[{val:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.LOW,display:warningLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__.j)(_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.LOW)},{val:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MINOR,display:minorLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__.j)(_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MINOR)},{val:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MAJOR,display:majorLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__.j)(_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.MAJOR)},{val:_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.CRITICAL,display:criticalLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__.j)(_common__WEBPACK_IMPORTED_MODULE_6__.ANOMALY_THRESHOLD.CRITICAL)}];function optionValueToThreshold(value){let threshold=SEVERITY_OPTIONS.find(opt=>opt.val===value);return void 0===threshold&&(threshold=SEVERITY_OPTIONS[0]),threshold}const TABLE_SEVERITY_DEFAULT=SEVERITY_OPTIONS[0],useTableSeverity=()=>Object(_util_url_state__WEBPACK_IMPORTED_MODULE_5__.b)("mlSelectSeverity",TABLE_SEVERITY_DEFAULT),SelectSeverity=({classNames:classNames}={classNames:""})=>{const[severity,setSeverity]=useTableSeverity();return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(SelectSeverityUI,{severity:severity,onChange:setSeverity})},SelectSeverityUI=({classNames:classNames="",severity:severity,onChange:onChange})=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__.EuiSuperSelect,{"data-test-subj":"mlAnomalySeverityThresholdControls",className:classNames,hasDividers:!0,options:SEVERITY_OPTIONS.map(({color:color,display:display,val:val})=>({value:display,inputDisplay:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__.EuiHealth,{color:color,style:{lineHeight:"inherit"}},display)),dropdownDisplay:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__.EuiHealth,{color:color,style:{lineHeight:"inherit"}},display),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__.EuiSpacer,{size:"xs"}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__.EuiText,{size:"xs",color:"subdued"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("p",{className:"euiTextColor--subdued"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__.FormattedMessage,{id:"xpack.ml.controls.selectSeverity.scoreDetailsDescription",defaultMessage:"score {value} and above",values:{value:val}}))))})),valueOfSelected:severity.display,onChange:valueDisplay=>{onChange(optionValueToThreshold(optionsMap[valueDisplay]))}})},169:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return populateValidationMessages})),__webpack_require__.d(__webpack_exports__,"a",(function(){return invalidTimeIntervalMessage}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27),_services_ml_server_info__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(88);function populateValidationMessages(validationResults,basicValidations,jobConfig,datafeedConfig){const limits=Object(_services_ml_server_info__WEBPACK_IMPORTED_MODULE_2__.c)();if(validationResults.contains("job_id_empty"))basicValidations.jobId.valid=!1;else if(validationResults.contains("job_id_invalid")){basicValidations.jobId.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});basicValidations.jobId.message=msg}else if(validationResults.contains("job_id_invalid_max_length"))basicValidations.jobId.valid=!1,basicValidations.jobId.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__.b}});else if(validationResults.contains("job_id_already_exists")){basicValidations.jobId.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});basicValidations.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){basicValidations.groupIds.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});basicValidations.groupIds.message=msg}else if(validationResults.contains("job_group_id_invalid_max_length"))basicValidations.groupIds.valid=!1,basicValidations.groupIds.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__.b}});else if(validationResults.contains("job_group_id_already_exists")){basicValidations.groupIds.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});basicValidations.groupIds.message=msg}if(validationResults.contains("model_memory_limit_units_invalid")){basicValidations.modelMemoryLimit.valid=!1;const str=`${_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__.a.slice(0,_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__.a.length-1).join(", ")} or ${[..._common_constants_validation__WEBPACK_IMPORTED_MODULE_1__.a].pop()}`,msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:str}});basicValidations.modelMemoryLimit.message=msg}if(validationResults.contains("model_memory_limit_invalid")){basicValidations.modelMemoryLimit.valid=!1;const maxModelMemoryLimit=(limits.max_model_memory_limit||"").toUpperCase(),msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:maxModelMemoryLimit}});basicValidations.modelMemoryLimit.message=msg}if(validationResults.contains("detectors_duplicates")){basicValidations.duplicateDetectors.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});basicValidations.duplicateDetectors.message=msg}if(validationResults.contains("categorizer_detector_missing_per_partition_field")){basicValidations.categorizerMissingPerPartition.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});basicValidations.categorizerMissingPerPartition.message=msg}if(validationResults.contains("categorizer_varying_per_partition_fields")){basicValidations.categorizerVaryingPerPartitionField.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});basicValidations.categorizerVaryingPerPartitionField.message=msg}if(validationResults.contains("bucket_span_empty")){basicValidations.bucketSpan.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});basicValidations.bucketSpan.message=msg}else validationResults.contains("bucket_span_invalid")&&(basicValidations.bucketSpan.valid=!1,basicValidations.bucketSpan.message=invalidTimeIntervalMessage(jobConfig.analysis_config.bucket_span));if(validationResults.contains("query_empty")){basicValidations.query.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});basicValidations.query.message=msg}else if(validationResults.contains("query_invalid")){basicValidations.query.valid=!1;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});basicValidations.query.message=msg}validationResults.contains("query_delay_invalid")&&(basicValidations.queryDelay.valid=!1,basicValidations.queryDelay.message=invalidTimeIntervalMessage(datafeedConfig.query_delay)),validationResults.contains("frequency_invalid")&&(basicValidations.frequency.valid=!1,basicValidations.frequency.message=invalidTimeIntervalMessage(datafeedConfig.frequency)),validationResults.contains("missing_summary_count_field_name")&&(basicValidations.summaryCountField.valid=!1,basicValidations.summaryCountField.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function invalidTimeIntervalMessage(value){return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:value,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},267:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(14);exports.default=function(effect){react_1.useEffect(effect,[])}},868:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(869);case"v7light":return __webpack_require__(871);case"v8dark":return __webpack_require__(873);case"v8light":return __webpack_require__(875)}},869:function(module,exports,__webpack_require__){var api=__webpack_require__(65),content=__webpack_require__(870);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},870:function(module,exports,__webpack_require__){(exports=__webpack_require__(66)(!1)).push([module.i,".mlSeverityControl .euiRangeLevel--success{background-color:#8BC8FB}.mlSeverityControl .euiRangeLevel--primary{background-color:#FDEC25}.mlSeverityControl .euiRangeLevel--warning{background-color:#FBA740}.mlSeverityControl .euiRangeLevel--danger{background-color:#FE5050}\n",""]),module.exports=exports},871:function(module,exports,__webpack_require__){var api=__webpack_require__(65),content=__webpack_require__(872);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},872:function(module,exports,__webpack_require__){(exports=__webpack_require__(66)(!1)).push([module.i,".mlSeverityControl .euiRangeLevel--success{background-color:#8BC8FB}.mlSeverityControl .euiRangeLevel--primary{background-color:#FDEC25}.mlSeverityControl .euiRangeLevel--warning{background-color:#FBA740}.mlSeverityControl .euiRangeLevel--danger{background-color:#FE5050}\n",""]),module.exports=exports},873:function(module,exports,__webpack_require__){var api=__webpack_require__(65),content=__webpack_require__(874);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},874:function(module,exports,__webpack_require__){(exports=__webpack_require__(66)(!1)).push([module.i,".mlSeverityControl .euiRangeLevel--success{background-color:#8BC8FB}.mlSeverityControl .euiRangeLevel--primary{background-color:#FDEC25}.mlSeverityControl .euiRangeLevel--warning{background-color:#FBA740}.mlSeverityControl .euiRangeLevel--danger{background-color:#FE5050}\n",""]),module.exports=exports},875:function(module,exports,__webpack_require__){var api=__webpack_require__(65),content=__webpack_require__(876);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},876:function(module,exports,__webpack_require__){(exports=__webpack_require__(66)(!1)).push([module.i,".mlSeverityControl .euiRangeLevel--success{background-color:#8BC8FB}.mlSeverityControl .euiRangeLevel--primary{background-color:#FDEC25}.mlSeverityControl .euiRangeLevel--warning{background-color:#FBA740}.mlSeverityControl .euiRangeLevel--danger{background-color:#FE5050}\n",""]),module.exports=exports},877:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var useEffectOnce_1=__webpack_require__(35).__importDefault(__webpack_require__(267));exports.default=function(fn){useEffectOnce_1.default((function(){fn()}))}},88:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return loadMlServerInfo})),__webpack_require__.d(__webpack_exports__,"b",(function(){return getNewJobDefaults})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getNewJobLimits})),__webpack_require__.d(__webpack_exports__,"d",(function(){return isCloud})),__webpack_require__.d(__webpack_exports__,"a",(function(){return getCloudDeploymentId}));var _ml_api_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(64);let defaults={anomaly_detectors:{},datafeeds:{}},limits={};const cloudInfo={cloudId:null,isCloud:!1};async function loadMlServerInfo(){try{const resp=await _ml_api_service__WEBPACK_IMPORTED_MODULE_0__.ml.mlInfo();return defaults=resp.defaults,limits=resp.limits,cloudInfo.cloudId=resp.cloudId||null,cloudInfo.isCloud=void 0!==resp.cloudId,{defaults:defaults,limits:limits,cloudId:cloudInfo}}catch(error){return{defaults:defaults,limits:limits,cloudId:cloudInfo}}}function getNewJobDefaults(){return defaults}function getNewJobLimits(){return limits}function isCloud(){return cloudInfo.isCloud}function getCloudDeploymentId(){return null===cloudInfo.cloudId?null:function(cloudId){const tempCloudId=cloudId.replace(/^(.+)?:/,"");try{const matches=atob(tempCloudId).match(/^.+\$(.+)(?=\$)/);return null!==matches&&2===matches.length?matches[1]:null}catch(error){return null}}(cloudInfo.cloudId)}},881:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var external_kbnSharedDeps_React_=__webpack_require__(14),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(39),useMount=__webpack_require__(877),useMount_default=__webpack_require__.n(useMount),external_kbnSharedDeps_KbnI18n_=__webpack_require__(2),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(40);const JobSelectorControl=({jobsAndGroupIds:jobsAndGroupIds,onChange:onChange,adJobsApiService:adJobsApiService,errors:errors})=>{const[options,setOptions]=Object(external_kbnSharedDeps_React_.useState)([]),jobIds=Object(external_kbnSharedDeps_React_.useMemo)(()=>new Set,[]),groupIds=Object(external_kbnSharedDeps_React_.useMemo)(()=>new Set,[]),selectedOptions=Object(external_kbnSharedDeps_React_.useMemo)(()=>(null!=jobsAndGroupIds?jobsAndGroupIds:[]).map(v=>({label:v})),[jobsAndGroupIds]),fetchOptions=Object(external_kbnSharedDeps_React_.useCallback)(async()=>{try{const{jobIds:jobIdOptions,groupIds:groupIdOptions}=await adJobsApiService.getAllJobAndGroupIds();jobIdOptions.forEach(v=>{jobIds.add(v)}),groupIdOptions.forEach(v=>{groupIds.add(v)}),setOptions([{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.jobSelector.jobOptionsLabel",{defaultMessage:"Jobs"}),options:jobIdOptions.map(v=>({label:v}))}])}catch(e){}},[adJobsApiService]),onSelectionChange=Object(external_kbnSharedDeps_React_.useCallback)(selectionUpdate=>{const selectedJobIds=[],selectedGroupIds=[];selectionUpdate.forEach(({label:label})=>{jobIds.has(label)?selectedJobIds.push(label):groupIds.has(label)&&selectedGroupIds.push(label)}),onChange({...selectedJobIds.length>0?{jobIds:selectedJobIds}:{},...selectedGroupIds.length>0?{groupIds:selectedGroupIds}:{}})},[jobIds,groupIds]);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{fetchOptions()},[]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.jobSelector.formControlLabel",defaultMessage:"Select job"}),isInvalid:!(null==errors||!errors.length),error:errors},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{singleSelection:!0,selectedOptions:selectedOptions,options:options,onChange:onSelectionChange,fullWidth:!0,"data-test-subj":"mlAnomalyAlertJobSelection",isInvalid:!(null==errors||!errors.length)}))};var kibana=__webpack_require__(63),ml_api_service_jobs=__webpack_require__(308),http_service=__webpack_require__(111),select_severity=__webpack_require__(121),common=__webpack_require__(16);__webpack_require__(868);const SeverityControl=external_kbnSharedDeps_React_default.a.memo(({value:value,onChange:onChange})=>{const levels=[{min:common.ANOMALY_THRESHOLD.LOW,max:common.ANOMALY_THRESHOLD.MINOR-1,color:"success"},{min:common.ANOMALY_THRESHOLD.MINOR,max:common.ANOMALY_THRESHOLD.MAJOR-1,color:"primary"},{min:common.ANOMALY_THRESHOLD.MAJOR,max:common.ANOMALY_THRESHOLD.CRITICAL,color:"warning"},{min:common.ANOMALY_THRESHOLD.CRITICAL,max:100,color:"danger"}],toggleButtons=select_severity.a.map(v=>({value:v.val,label:v.display}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.severitySelector.formControlLabel",defaultMessage:"Select severity threshold"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiRange,{className:"mlSeverityControl",fullWidth:!0,min:common.ANOMALY_THRESHOLD.LOW,max:100,value:null!=value?value:common.ANOMALY_THRESHOLD.LOW,onChange:e=>{onChange(Number(e.target.value))},showLabels:!0,showValue:!0,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.severitySelector.formControlLabel",{defaultMessage:"Select severity threshold"}),showTicks:!0,ticks:toggleButtons,levels:levels,"data-test-subj":"mlAnomalyAlertScoreSelection"}))});var anomalies=__webpack_require__(1);const ResultTypeSelector=external_kbnSharedDeps_React_default.a.memo(({value:selectedResultType=[],onChange:onChange,availableOption:availableOption})=>{const resultTypeOptions=Object(external_kbnSharedDeps_React_.useMemo)(()=>[{value:anomalies.a.BUCKET,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.bucketResultType.title",defaultMessage:"Bucket"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.bucketResultType.description",defaultMessage:"How unusual was the job within the bucket of time?"})},{value:anomalies.a.RECORD,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.recordResultType.title",defaultMessage:"Record"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.recordResultType.description",defaultMessage:"What individual anomalies are present in a time range?"})},{value:anomalies.a.INFLUENCER,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.influencerResultType.title",defaultMessage:"Influencer"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.influencerResultType.description",defaultMessage:"What are the most unusual entities in a time range?"})}].filter(v=>availableOption.includes(v.value)),[availableOption]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.resultTypeSelector.formControlLabel",defaultMessage:"Result type"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s"},resultTypeOptions.map(({value:value,title:title,description:description})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:value},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCard,{title:title,titleSize:"xs",paddingSize:"s",description:external_kbnSharedDeps_React_default.a.createElement("small",null,description),selectable:{onClick:()=>{selectedResultType!==value&&onChange(value)},isSelected:value===selectedResultType},"data-test-subj":`mlAnomalyAlertResult_${value}${value===selectedResultType?"_selected":""}`})))))});var app=__webpack_require__(5);var util_validators=__webpack_require__(17),util=__webpack_require__(169),alerts=__webpack_require__(146);const AlertInstancePreview=external_kbnSharedDeps_React_default.a.memo(({jobIds:jobIds,timestampIso8601:timestampIso8601,score:score,topInfluencers:topInfluencers,topRecords:topRecords})=>{const listItems=[{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.previewAlert.jobsLabel",{defaultMessage:"Job IDs:"}),description:jobIds.join(", ")},{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.previewAlert.timeLabel",{defaultMessage:"Time: "}),description:timestampIso8601},{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.previewAlert.scoreLabel",{defaultMessage:"Anomaly score:"}),description:score},...topInfluencers&&topInfluencers.length>0?[{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.previewAlert.topInfluencersLabel",{defaultMessage:"Top influencers:"}),description:external_kbnSharedDeps_React_default.a.createElement("ul",null,topInfluencers.map(i=>external_kbnSharedDeps_React_default.a.createElement("li",{key:i.unique_key},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCode,{transparentBackground:!0},i.influencer_field_name)," ="," ",i.influencer_field_value," [",i.score,"]")))}]:[],...topRecords&&topRecords.length>0?[{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.previewAlert.topRecordsLabel",{defaultMessage:"Top records:"}),description:external_kbnSharedDeps_React_default.a.createElement("ul",null,topRecords.map(i=>external_kbnSharedDeps_React_default.a.createElement("li",{key:i.unique_key},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCode,{transparentBackground:!0},i.function,"(",i.field_name,")")," ",i.by_field_value," ",i.over_field_value," ",i.partition_field_value," [",i.score,"]")))}]:[]];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescriptionList,{type:"row",compressed:!0,listItems:listItems})}),PreviewAlertCondition=({alertingApiService:alertingApiService,alertParams:alertParams})=>{var _alertParams$jobSelec,_alertParams$jobSelec2,_alertParams$jobSelec3,_alertParams$jobSelec4;const sampleSize=alerts.a,[lookBehindInterval,setLookBehindInterval]=Object(external_kbnSharedDeps_React_.useState)(),[lastQueryInterval,setLastQueryInterval]=Object(external_kbnSharedDeps_React_.useState)(),[areResultsVisible,setAreResultVisible]=Object(external_kbnSharedDeps_React_.useState)(!0),[previewError,setPreviewError]=Object(external_kbnSharedDeps_React_.useState)(),[previewResponse,setPreviewResponse]=Object(external_kbnSharedDeps_React_.useState)(),validators=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(common.composeValidators)(Object(util_validators.f)(),Object(util_validators.g)()),[]),validationErrors=Object(external_kbnSharedDeps_React_.useMemo)(()=>validators(lookBehindInterval),[lookBehindInterval]);Object(external_kbnSharedDeps_React_.useEffect)((function(){setPreviewResponse(void 0)}),[alertParams]);const testCondition=Object(external_kbnSharedDeps_React_.useCallback)(async()=>{try{const response=await alertingApiService.preview({alertParams:alertParams,timeRange:lookBehindInterval,sampleSize:sampleSize});setPreviewResponse(response),setLastQueryInterval(lookBehindInterval),setPreviewError(void 0)}catch(e){var _e$body;setPreviewResponse(void 0),setPreviewError(null!==(_e$body=e.body)&&void 0!==_e$body?_e$body:e)}},[alertParams,lookBehindInterval]),sampleHits=Object(external_kbnSharedDeps_React_.useMemo)(()=>{if(previewResponse)return previewResponse.results},[previewResponse]),isReady=((null===(_alertParams$jobSelec=alertParams.jobSelection)||void 0===_alertParams$jobSelec||null===(_alertParams$jobSelec2=_alertParams$jobSelec.jobIds)||void 0===_alertParams$jobSelec2?void 0:_alertParams$jobSelec2.length)>0||(null===(_alertParams$jobSelec3=alertParams.jobSelection)||void 0===_alertParams$jobSelec3||null===(_alertParams$jobSelec4=_alertParams$jobSelec3.groupIds)||void 0===_alertParams$jobSelec4?void 0:_alertParams$jobSelec4.length)>0)&&!!alertParams.resultType&&void 0!==alertParams.severity&&null===validationErrors,isInvalid=void 0!==lookBehindInterval&&!!validationErrors;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s",alignItems:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.intervalLabel",defaultMessage:"Check the rule condition with an interval"}),isInvalid:isInvalid,error:Object(util.a)(lookBehindInterval)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{placeholder:"15d, 6m",value:null!=lookBehindInterval?lookBehindInterval:"",onChange:e=>{setLookBehindInterval(e.target.value)},isInvalid:isInvalid,"data-test-subj":"mlAnomalyAlertPreviewInterval"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:testCondition,disabled:!isReady,"data-test-subj":"mlAnomalyAlertPreviewButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.testButtonLabel",defaultMessage:"Test"})))),void 0!==previewError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.previewErrorTitle",defaultMessage:"Unable to load the preview"}),color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,previewError.message))),previewResponse&&sampleHits&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs","data-test-subj":"mlAnomalyAlertPreviewMessage"},external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.previewMessage",defaultMessage:"Found {alertsCount, plural, one {# anomaly} other {# anomalies}} in the last {interval}.",values:{alertsCount:previewResponse.count,interval:lastQueryInterval}})))),sampleHits.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{color:"primary",size:"xs",onClick:setAreResultVisible.bind(null,!areResultsVisible)},areResultsVisible?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.hideResultsButtonLabel",defaultMessage:"Hide results"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.showResultsButtonLabel",defaultMessage:"Show results"})))),areResultsVisible&&sampleHits.length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1,"data-test-subj":"mlAnomalyAlertPreviewCallout"},external_kbnSharedDeps_React_default.a.createElement("ul",null,sampleHits.map((v,i)=>external_kbnSharedDeps_React_default.a.createElement("li",{key:v.key},external_kbnSharedDeps_React_default.a.createElement(AlertInstancePreview,v),i!==sampleHits.length-1?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,{margin:"xs"}):null))),previewResponse.count>sampleSize?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.previewAlert.otherValuesLabel",defaultMessage:"and {count, plural, one {# other} other {# others}}",values:{count:previewResponse.count-sampleSize}})))):null):null))},InterimResultsControl=external_kbnSharedDeps_React_default.a.memo(({value:value,onChange:onChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.interimResultsControl.label",defaultMessage:"Include interim results"}),checked:null!=value&&value,onChange:onChange.bind(null,!value)})));var parse_interval=__webpack_require__(26),states=__webpack_require__(106);const ConfigValidator=external_kbnSharedDeps_React_default.a.memo(({jobConfigs:jobConfigs=[],alertInterval:alertInterval,alertParams:alertParams,alertNotifyWhen:alertNotifyWhen,maxNumberOfBuckets:maxNumberOfBuckets})=>{var _parseInterval,_alertParams$topNBuck;if(0===jobConfigs.length)return null;const alertIntervalInSeconds=Object(parse_interval.a)(alertInterval).asSeconds(),lookbackIntervalInSeconds=!!alertParams.lookbackInterval&&(null===(_parseInterval=Object(parse_interval.a)(alertParams.lookbackInterval))||void 0===_parseInterval?void 0:_parseInterval.asSeconds()),isAlertIntervalTooHigh=lookbackIntervalInSeconds&&lookbackIntervalInSeconds<alertIntervalInSeconds,jobWithoutStartedDatafeed=jobConfigs.filter(job=>job.datafeed_config.state!==states.a.STARTED).map(job=>job.job_id),configContainsIssues=isAlertIntervalTooHigh||jobWithoutStartedDatafeed.length>0,notifyWhenWarning="onActiveAlert"===alertNotifyWhen&&lookbackIntervalInSeconds&&alertIntervalInSeconds<lookbackIntervalInSeconds,bucketSpanDuration=Object(parse_interval.a)(jobConfigs[0].analysis_config.bucket_span),notificationDuration=bucketSpanDuration?Math.ceil(bucketSpanDuration.asMinutes())*Math.min(null!==(_alertParams$topNBuck=alertParams.topNBuckets)&&void 0!==_alertParams$topNBuck?_alertParams$topNBuck:alerts.c,null!=maxNumberOfBuckets?maxNumberOfBuckets:alerts.c):void 0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),configContainsIssues?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.alertConditionValidation.title",defaultMessage:"Alert condition contains the following issues:"}),color:"warning",size:"s"},external_kbnSharedDeps_React_default.a.createElement("ul",null,isAlertIntervalTooHigh?external_kbnSharedDeps_React_default.a.createElement("li",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.alertConditionValidation.alertIntervalTooHighMessage",defaultMessage:"The check interval is greater than the lookback interval. Reduce it to {lookbackInterval} to avoid potentially missing notifications.",values:{lookbackInterval:alertParams.lookbackInterval}})):null,jobWithoutStartedDatafeed.length>0?external_kbnSharedDeps_React_default.a.createElement("li",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.alertConditionValidation.stoppedDatafeedJobsMessage",defaultMessage:"The datafeed is not started for the following {count, plural, one {job} other {jobs}}: {jobIds}.",values:{count:jobWithoutStartedDatafeed.length,jobIds:jobWithoutStartedDatafeed.join(", ")}})):null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"})):null,notifyWhenWarning?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.alertConditionValidation.notifyWhenWarning",defaultMessage:"Expect to receive duplicate notifications about the same anomaly for up to {notificationDuration, plural, one {# minute} other {# minutes}}. Increase the check interval or switch to notify only on status change to avoid duplicate notifications.",values:{notificationDuration:notificationDuration}}),color:"warning",size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"})):null)});function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const TimeIntervalControl=({value:value,onChange:onChange,label:label,...fieldTextProps})=>{const validators=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(common.composeValidators)(Object(util_validators.g)()),[]),validationErrors=Object(external_kbnSharedDeps_React_.useMemo)(()=>validators(value),[value]),isInvalid=void 0!==value&&!!validationErrors;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:label,isInvalid:isInvalid,error:Object(util.a)(null!=value?value:void 0)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,_extends({},fieldTextProps,{placeholder:"15d, 6m",value:null!=value?value:"",onChange:e=>{onChange(e.target.value)},isInvalid:isInvalid})))},AdvancedSettings=external_kbnSharedDeps_React_default.a.memo(({value:value,onChange:onChange})=>{var _value$topNBuckets;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:"mlAnomalyAlertAdvancedSettings",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.advancedSettingsLabel",defaultMessage:"Advanced settings"}),"data-test-subj":"mlAnomalyAlertAdvancedSettingsTrigger"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"})),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalDescription",defaultMessage:"Time interval to query the anomalies data during each rule condition check. By default, is derived from the bucket span of the job and the query delay of the datafeed."}))},external_kbnSharedDeps_React_default.a.createElement(TimeIntervalControl,{value:value.lookbackInterval,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"}),onChange:update=>{onChange({lookbackInterval:update})},"data-test-subj":"mlAnomalyAlertLookbackInterval"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"})),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsDescription",defaultMessage:"The number of latest buckets to check to obtain the highest anomaly."}))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldNumber,{value:null!==(_value$topNBuckets=value.topNBuckets)&&void 0!==_value$topNBuckets?_value$topNBuckets:alerts.c,min:1,onChange:e=>{onChange({topNBuckets:Number(e.target.value)})},"data-test-subj":"mlAnomalyAlertTopNBuckets"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,{margin:"m"}))});var job_utils=__webpack_require__(69),guards=__webpack_require__(163);function getLookbackInterval(jobs){return function(jobs,datafeeds){var _resolveMaxTimeInterv,_resolveMaxTimeInterv2;const bucketSpanInSeconds=Math.ceil(null!==(_resolveMaxTimeInterv=Object(job_utils.s)(jobs.map(v=>v.analysis_config.bucket_span)))&&void 0!==_resolveMaxTimeInterv?_resolveMaxTimeInterv:0),queryDelayInSeconds=Math.ceil(null!==(_resolveMaxTimeInterv2=Object(job_utils.s)(datafeeds.map(v=>v.query_delay).filter(guards.a)))&&void 0!==_resolveMaxTimeInterv2?_resolveMaxTimeInterv2:0),result=Math.max(120,2*bucketSpanInSeconds)+queryDelayInSeconds+1;return Math.ceil(result/60)+"m"}(jobs,jobs.map(v=>v.datafeed_config))}__webpack_exports__.default=({alertParams:alertParams,setAlertParams:setAlertParams,setAlertProperty:setAlertProperty,errors:errors,alertInterval:alertInterval,alertNotifyWhen:alertNotifyWhen})=>{const{services:{http:http},notifications:{toasts:toasts}}=Object(kibana.b)(),mlHttpService=Object(external_kbnSharedDeps_React_.useMemo)(()=>new http_service.a(http),[http]),adJobsApiService=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(ml_api_service_jobs.a)(mlHttpService),[mlHttpService]),alertingApiService=Object(external_kbnSharedDeps_React_.useMemo)(()=>{return httpService=mlHttpService,{preview(params){const body=JSON.stringify(params);return httpService.http({path:app.b+"/alerting/preview",method:"POST",body:body})}};var httpService},[mlHttpService]),[jobConfigs,setJobConfigs]=Object(external_kbnSharedDeps_React_.useState)([]),onAlertParamChange=Object(external_kbnSharedDeps_React_.useCallback)(param=>update=>{setAlertParams(param,update)},[]),jobsAndGroupIds=Object(external_kbnSharedDeps_React_.useMemo)(()=>{var _alertParams$jobSelec;return Object.values(null!==(_alertParams$jobSelec=alertParams.jobSelection)&&void 0!==_alertParams$jobSelec?_alertParams$jobSelec:{}).flat()},[alertParams.jobSelection]),fetchJobsConfig=Object(external_kbnSharedDeps_React_.useCallback)(async()=>{try{const jobs=await adJobsApiService.jobs(jobsAndGroupIds);setJobConfigs(jobs)}catch(e){toasts.danger({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.anomalyDetectionAlert.errorFetchingJobs",{defaultMessage:"Unable to fetch jobs configuration"}),body:e.message,toastLifeTimeMs:5e3})}},[jobsAndGroupIds]),availableResultTypes=Object(external_kbnSharedDeps_React_.useMemo)(()=>0===jobConfigs.length||(null!=jobConfigs?jobConfigs:[]).some(v=>v.analysis_config.influencers.length>0)?Object.values(anomalies.a):[anomalies.a.BUCKET,anomalies.a.RECORD],[jobConfigs]);Object(external_kbnSharedDeps_React_.useEffect)((function(){0!==jobsAndGroupIds.length&&fetchJobsConfig()}),[jobsAndGroupIds]),useMount_default()((function(){const{jobSelection:jobSelection,...rest}=alertParams;0===Object.keys(rest).length&&setAlertProperty("params",{severity:common.ANOMALY_THRESHOLD.CRITICAL,resultType:anomalies.a.BUCKET,includeInterim:!1,jobSelection:jobSelection,lookbackInterval:void 0,topNBuckets:void 0})}));const advancedSettings=Object(external_kbnSharedDeps_React_.useMemo)(()=>{let{lookbackInterval:lookbackInterval,topNBuckets:topNBuckets}=alertParams;return!Object(guards.a)(lookbackInterval)&&jobConfigs.length>0&&(lookbackInterval=getLookbackInterval(jobConfigs)),!Object(guards.a)(topNBuckets)&&jobConfigs.length>0&&(topNBuckets=function(job){const bucketSpan=Object(parse_interval.a)(job.analysis_config.bucket_span);if(null===bucketSpan)throw new Error("Unable to resolve a bucket span length");return Math.ceil(60/bucketSpan.asSeconds())}(jobConfigs[0])),{lookbackInterval:lookbackInterval,topNBuckets:topNBuckets}},[alertParams.lookbackInterval,alertParams.topNBuckets,jobConfigs]),resultParams=Object(external_kbnSharedDeps_React_.useMemo)(()=>({...alertParams,...advancedSettings}),[alertParams,advancedSettings]),maxNumberOfBuckets=Object(external_kbnSharedDeps_React_.useMemo)(()=>{if(0===jobConfigs.length)return;const bucketDuration=Object(parse_interval.a)(jobConfigs[0].analysis_config.bucket_span),lookbackIntervalDuration=advancedSettings.lookbackInterval?Object(parse_interval.a)(advancedSettings.lookbackInterval):null;return lookbackIntervalDuration&&bucketDuration?Math.ceil(lookbackIntervalDuration.asSeconds()/bucketDuration.asSeconds()):void 0},[jobConfigs,advancedSettings]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,{"data-test-subj":"mlAnomalyAlertForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"none",justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBetaBadge,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.anomalyDetectionAlert.betaBadgeLabel",{defaultMessage:"Beta"}),tooltipContent:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.anomalyDetectionAlert.betaBadgeTooltipContent",{defaultMessage:"Anomaly detection alerts are a beta feature. We'd love to hear your feedback."})}))),external_kbnSharedDeps_React_default.a.createElement(JobSelectorControl,{jobsAndGroupIds:jobsAndGroupIds,adJobsApiService:adJobsApiService,onChange:Object(external_kbnSharedDeps_React_.useCallback)(onAlertParamChange("jobSelection"),[]),errors:Array.isArray(errors.jobSelection)?errors.jobSelection:[]}),external_kbnSharedDeps_React_default.a.createElement(ConfigValidator,{jobConfigs:jobConfigs,alertInterval:alertInterval,alertNotifyWhen:alertNotifyWhen,alertParams:resultParams,maxNumberOfBuckets:maxNumberOfBuckets}),external_kbnSharedDeps_React_default.a.createElement(ResultTypeSelector,{value:alertParams.resultType,availableOption:availableResultTypes,onChange:Object(external_kbnSharedDeps_React_.useCallback)(onAlertParamChange("resultType"),[])}),external_kbnSharedDeps_React_default.a.createElement(SeverityControl,{value:alertParams.severity,onChange:Object(external_kbnSharedDeps_React_.useCallback)(onAlertParamChange("severity"),[])}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(InterimResultsControl,{value:alertParams.includeInterim,onChange:Object(external_kbnSharedDeps_React_.useCallback)(onAlertParamChange("includeInterim"),[])}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(AdvancedSettings,{value:advancedSettings,onChange:Object(external_kbnSharedDeps_React_.useCallback)(update=>{Object.keys(update).forEach(k=>{setAlertParams(k,update[k])})},[])}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(PreviewAlertCondition,{alertingApiService:alertingApiService,alertParams:alertParams}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}))}}}]);