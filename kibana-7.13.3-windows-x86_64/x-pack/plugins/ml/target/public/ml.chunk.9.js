/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[9,10],{225:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"AnomalyDetectorService",(function(){return AnomalyDetectorService}));var rxjs_operators__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(25),_ml_api_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(64);class AnomalyDetectorService{constructor(httpService){var obj,key,value;this.httpService=httpService,obj=this,key="apiBasePath",value=Object(_ml_api_service__WEBPACK_IMPORTED_MODULE_1__.basePath)()+"/anomaly_detectors",key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}getJobById$(jobId){return this.httpService.http$({path:`${this.apiBasePath}/${jobId}`}).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_0__.map)(response=>response.jobs[0]))}getJobs$(jobIds){return this.httpService.http$({path:`${this.apiBasePath}/${jobIds.join(",")}`}).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_0__.map)(response=>response.jobs))}extractInfluencers(jobs){Array.isArray(jobs)||(jobs=[jobs]);const influencers=new Set;for(const job of jobs)for(const influencer of job.analysis_config.influencers)influencers.add(influencer);return Array.from(influencers)}}},290:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return resolveJobSelection}));var external_kbnSharedDeps_Moment_=__webpack_require__(15),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_),external_kbnSharedDeps_RxjsOperators_=__webpack_require__(25),external_kbnSharedDeps_Rxjs_=__webpack_require__(23),external_kbnSharedDeps_React_=__webpack_require__(14),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),job_selector=__webpack_require__(226),public_=__webpack_require__(42),app=__webpack_require__(282),dashboard_public_=__webpack_require__(53),job_selector_flyout=__webpack_require__(285);const JobSelectorFlyout=({selectedIds:selectedIds,withTimeRangeSelector:withTimeRangeSelector,dateFormatTz:dateFormatTz,singleSelection:singleSelection,timeseriesOnly:timeseriesOnly,onFlyoutClose:onFlyoutClose,onSelectionConfirmed:onSelectionConfirmed,maps:maps})=>{const[applyTimeRangeState,setApplyTimeRangeState]=Object(external_kbnSharedDeps_React_.useState)(!0);return external_kbnSharedDeps_React_default.a.createElement(job_selector_flyout.b,{selectedIds:selectedIds,withTimeRangeSelector:withTimeRangeSelector,dateFormatTz:dateFormatTz,singleSelection:singleSelection,timeseriesOnly:timeseriesOnly,onFlyoutClose:onFlyoutClose,onSelectionConfirmed:onSelectionConfirmed,onTimeRangeConfigChange:setApplyTimeRangeState,applyTimeRangeConfig:applyTimeRangeState,maps:maps})};async function resolveJobSelection(coreStart,selectedJobIds){const{http:http,uiSettings:uiSettings,application:{currentAppId$:currentAppId$}}=coreStart;return new Promise(async(resolve,reject)=>{const maps={groupsMap:Object(job_selector.b)([]),jobsMap:{}},tzConfig=uiSettings.get("dateFormat:tz"),dateFormatTz="Browser"!==tzConfig?tzConfig:external_kbnSharedDeps_Moment_default.a.tz.guess(),flyoutSession=coreStart.overlays.openFlyout(Object(public_.toMountPoint)(external_kbnSharedDeps_React_default.a.createElement(public_.KibanaContextProvider,{services:{...coreStart,mlServices:Object(app.getMlGlobalServices)(http)}},external_kbnSharedDeps_React_default.a.createElement(JobSelectorFlyout,{selectedIds:selectedJobIds,withTimeRangeSelector:!1,dateFormatTz:dateFormatTz,singleSelection:!1,timeseriesOnly:!0,onFlyoutClose:()=>{flyoutSession.close(),reject()},onSelectionConfirmed:async({jobIds:jobIds,groups:groups})=>{await flyoutSession.close(),resolve({jobIds:jobIds,groups:groups})},maps:maps}))),{"data-test-subj":"mlFlyoutJobSelector",ownFocus:!0,closeButtonAriaLabel:"jobSelectorFlyout"});currentAppId$.pipe(Object(external_kbnSharedDeps_RxjsOperators_.takeUntil)(Object(external_kbnSharedDeps_Rxjs_.from)(flyoutSession.onClose))).subscribe(appId=>{appId!==dashboard_public_.DashboardConstants.DASHBOARDS_ID&&flyoutSession.close()})})}},885:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"resolveAnomalySwimlaneUserInput",(function(){return resolveAnomalySwimlaneUserInput}));var external_kbnSharedDeps_React_=__webpack_require__(14),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),explorer_constants=__webpack_require__(75),public_=__webpack_require__(42),external_kbnSharedDeps_ElasticEui_=__webpack_require__(39),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(40),external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);const AnomalySwimlaneInitializer=({defaultTitle:defaultTitle,influencers:influencers,onCreate:onCreate,onCancel:onCancel,initialInput:initialInput})=>{var _initialInput$swimlan;const[panelTitle,setPanelTitle]=Object(external_kbnSharedDeps_React_.useState)(defaultTitle),[swimlaneType,setSwimlaneType]=Object(external_kbnSharedDeps_React_.useState)(null!==(_initialInput$swimlan=null==initialInput?void 0:initialInput.swimlaneType)&&void 0!==_initialInput$swimlan?_initialInput$swimlan:explorer_constants.h.OVERALL),[viewBySwimlaneFieldName,setViewBySwimlaneFieldName]=Object(external_kbnSharedDeps_React_.useState)(null==initialInput?void 0:initialInput.viewBy),swimlaneTypeOptions=[{id:explorer_constants.h.OVERALL,label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"})},{id:explorer_constants.h.VIEW_BY,label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.explorer.viewByLabel",{defaultMessage:"View by"})}],viewBySwimlaneOptions=["",...influencers].map(influencer=>({value:influencer,text:influencer})),isPanelTitleValid=panelTitle.length>0,isFormValid=isPanelTitleValid&&(swimlaneType===explorer_constants.h.OVERALL||swimlaneType===explorer_constants.h.VIEW_BY&&!!viewBySwimlaneFieldName);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModal,{initialFocus:"[name=panelTitle]",onClose:onCancel},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeaderTitle,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.title",defaultMessage:"Anomaly swim lane configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.panelTitleLabel",defaultMessage:"Panel title"}),isInvalid:!isPanelTitleValid},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{id:"panelTitle",name:"panelTitle",value:panelTitle,onChange:e=>setPanelTitle(e.target.value),isInvalid:!isPanelTitleValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",defaultMessage:"Swim lane type"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonGroup,{id:"selectSwimlaneType",name:"selectSwimlaneType",color:"primary",isFullWidth:!0,legend:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",{defaultMessage:"Swim lane type"}),options:swimlaneTypeOptions,idSelected:swimlaneType,onChange:id=>setSwimlaneType(id)})),swimlaneType===explorer_constants.h.VIEW_BY&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.explorer.viewByLabel",defaultMessage:"View by"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSelect,{id:"selectViewBy",name:"selectViewBy",options:viewBySwimlaneOptions,value:viewBySwimlaneFieldName,onChange:e=>setViewBySwimlaneFieldName(e.target.value)}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:onCancel},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{isDisabled:!isFormValid,onClick:onCreate.bind(null,{panelTitle:panelTitle,swimlaneType:swimlaneType,viewBy:viewBySwimlaneFieldName}),fill:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.confirmButtonLabel",defaultMessage:"Confirm"}))))};var anomaly_detector_service=__webpack_require__(225),anomaly_swimlane_embeddable=__webpack_require__(288),http_service=__webpack_require__(111),resolve_job_selection=__webpack_require__(290);async function resolveAnomalySwimlaneUserInput(coreStart,input){const{http:http,overlays:overlays}=coreStart,anomalyDetectorService=new anomaly_detector_service.AnomalyDetectorService(new http_service.a(http));return new Promise(async(resolve,reject)=>{var _input$title;const{jobIds:jobIds}=await Object(resolve_job_selection.a)(coreStart,null==input?void 0:input.jobIds),title=null!==(_input$title=null==input?void 0:input.title)&&void 0!==_input$title?_input$title:Object(anomaly_swimlane_embeddable.getDefaultSwimlanePanelTitle)(jobIds),jobs=await anomalyDetectorService.getJobs$(jobIds).toPromise(),influencers=anomalyDetectorService.extractInfluencers(jobs);influencers.push(explorer_constants.j);const modalSession=overlays.openModal(Object(public_.toMountPoint)(external_kbnSharedDeps_React_default.a.createElement(AnomalySwimlaneInitializer,{defaultTitle:title,influencers:influencers,initialInput:input,onCreate:({panelTitle:panelTitle,viewBy:viewBy,swimlaneType:swimlaneType})=>{modalSession.close(),resolve({jobIds:jobIds,title:panelTitle,swimlaneType:swimlaneType,viewBy:viewBy})},onCancel:()=>{modalSession.close(),reject()}})))})}}}]);