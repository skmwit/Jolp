/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.reporting_bundle_jsonpfunction=window.reporting_bundle_jsonpfunction||[]).push([[1],{37:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"mountManagementSection",(function(){return mountManagementSection}));var external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ReactDom_=__webpack_require__(35),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(2),external_kbnSharedDeps_ElasticEui_=__webpack_require__(3),external_kbnSharedDeps_KbnI18n_=__webpack_require__(4),external_kbnSharedDeps_Lodash_=__webpack_require__(10),external_kbnSharedDeps_Moment_=__webpack_require__(36),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_),constants=__webpack_require__(1),poller=__webpack_require__(14),schema_utils=__webpack_require__(15),license_check=__webpack_require__(8);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class report_error_button_ReportErrorButtonUi extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),_defineProperty(this,"mounted",void 0),_defineProperty(this,"togglePopover",()=>{this.setState(prevState=>({isPopoverOpen:!prevState.isPopoverOpen})),this.state.error||this.loadError()}),_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:!1})}),_defineProperty(this,"loadError",async()=>{const{record:record,apiClient:apiClient,intl:intl}=this.props;this.setState({isLoading:!0});try{const reportContent=await apiClient.getContent(record.id);this.mounted&&this.setState({isLoading:!1,error:reportContent.content})}catch(kfetchError){this.mounted&&this.setState({isLoading:!1,calloutTitle:intl.formatMessage({id:"xpack.reporting.errorButton.unableToFetchReportContentTitle",defaultMessage:"Unable to fetch report content"}),error:kfetchError.message})}}),this.state={isLoading:!1,isPopoverOpen:!1,calloutTitle:props.intl.formatMessage({id:"xpack.reporting.errorButton.unableToGenerateReportTitle",defaultMessage:"Unable to generate report"})}}render(){const{record:record,intl:intl}=this.props;if(record.status!==constants.JOB_STATUSES.FAILED)return null;const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:this.togglePopover,iconType:"alert",color:"danger","aria-label":intl.formatMessage({id:"xpack.reporting.errorButton.showReportErrorAriaLabel",defaultMessage:"Show report error"})});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"popover",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,anchorPosition:"downRight"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"danger",title:this.state.calloutTitle},external_kbnSharedDeps_React_default.a.createElement("p",null,this.state.error)))}componentWillUnmount(){this.mounted=!1}componentDidMount(){this.mounted=!0}}const ReportErrorButton=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)(report_error_button_ReportErrorButtonUi);class report_delete_button_ReportDeleteButton extends external_kbnSharedDeps_React_.PureComponent{constructor(props){super(props),this.state={showConfirm:!1}}hideConfirm(){this.setState({showConfirm:!1})}showConfirm(){this.setState({showConfirm:!0})}renderConfirm(){const{intl:intl,jobsToDelete:jobsToDelete}=this.props,title=jobsToDelete.length>1?intl.formatMessage({id:"xpack.reporting.listing.table.deleteNumConfirmTitle",defaultMessage:"Delete {num} reports?"},{num:jobsToDelete.length}):intl.formatMessage({id:"xpack.reporting.listing.table.deleteConfirmTitle",defaultMessage:'Delete the "{name}" report?'},{name:jobsToDelete[0].object_title}),message=intl.formatMessage({id:"xpack.reporting.listing.table.deleteConfirmMessage",defaultMessage:"You can't recover deleted reports."}),confirmButtonText=intl.formatMessage({id:"xpack.reporting.listing.table.deleteConfirmButton",defaultMessage:"Delete"}),cancelButtonText=intl.formatMessage({id:"xpack.reporting.listing.table.deleteCancelButton",defaultMessage:"Cancel"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{title:title,onCancel:()=>this.hideConfirm(),onConfirm:()=>this.props.performDelete(),confirmButtonText:confirmButtonText,cancelButtonText:cancelButtonText,defaultFocusedButton:"confirm",buttonColor:"danger"},message)}render(){const{jobsToDelete:jobsToDelete,intl:intl}=this.props;return 0===jobsToDelete.length?null:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:()=>this.showConfirm(),iconType:"trash",color:"danger","data-test-subj":"deleteReportButton"},intl.formatMessage({id:"xpack.reporting.listing.table.deleteReportButton",defaultMessage:"Delete ({num})"},{num:jobsToDelete.length})),this.state.showConfirm?this.renderConfirm():null)}}const ReportDownloadButton=props=>{const{record:record,apiClient:apiClient,intl:intl}=props;if(record.status!==constants.JOB_STATUSES.COMPLETED&&record.status!==constants.JOB_STATUSES.WARNINGS)return null;const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:()=>apiClient.downloadReport(record.id),iconType:"importAction","aria-label":intl.formatMessage({id:"xpack.reporting.listing.table.downloadReportAriaLabel",defaultMessage:"Download report"})});return record.csv_contains_formulas?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{position:"top",content:intl.formatMessage({id:"xpack.reporting.listing.table.csvContainsFormulas",defaultMessage:"Your CSV contains characters which spreadsheet applications can interpret as formulas."})},button):record.max_size_reached?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{position:"top",content:intl.formatMessage({id:"xpack.reporting.listing.table.maxSizeReachedTooltip",defaultMessage:"Max size reached, contains partial data."})},button):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{position:"top",content:intl.formatMessage({id:"xpack.reporting.listing.table.downloadReport",defaultMessage:"Download report"})},button)};function report_info_button_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const NA="n/a",getDimensions=info=>{const{width:width,height:height}=Object(external_kbnSharedDeps_Lodash_.get)(info,"payload.layout.dimensions",{width:null,height:null});return width&&height?`Width: ${width} x Height: ${height}`:NA};class report_info_button_ReportInfoButton extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),report_info_button_defineProperty(this,"mounted",void 0),report_info_button_defineProperty(this,"loadInfo",async()=>{this.setState({isLoading:!0});try{const info=await this.props.apiClient.getInfo(this.props.jobId);this.mounted&&this.setState({isLoading:!1,info:info})}catch(err){this.mounted&&this.setState({isLoading:!1,calloutTitle:"Unable to fetch report info",info:null,error:err})}}),report_info_button_defineProperty(this,"closeFlyout",()=>{this.setState({isFlyoutVisible:!1,info:null})}),report_info_button_defineProperty(this,"showFlyout",()=>{this.setState({isFlyoutVisible:!0}),this.state.info||this.loadInfo()}),this.state={isLoading:!1,isFlyoutVisible:!1,calloutTitle:"Job Info",info:null,error:null},this.closeFlyout=this.closeFlyout.bind(this),this.showFlyout=this.showFlyout.bind(this)}renderInfo(){const{info:info,error:err}=this.state;if(err)return err.message;if(!info)return null;const jobType=info.jobtype||NA,attempts=info.attempts?info.attempts.toString():NA,maxAttempts=info.max_attempts?info.max_attempts.toString():NA,timeout=info.timeout?info.timeout.toString():NA,warnings=info.output&&info.output.warnings?info.output.warnings.join(","):null,jobInfoDateTimes=[{title:"Created By",description:info.created_by||NA},{title:"Created At",description:info.created_at||NA},{title:"Started At",description:info.started_at||NA},{title:"Completed At",description:info.completed_at||NA},{title:"Processed By",description:info.kibana_name&&info.kibana_id?`${info.kibana_name} (${info.kibana_id})`:"unknown"},{title:"Browser Timezone",description:Object(external_kbnSharedDeps_Lodash_.get)(info,"payload.browserTimezone")||NA}],jobInfoPayload=[{title:"Title",description:Object(external_kbnSharedDeps_Lodash_.get)(info,"payload.title")||NA},{title:"Layout",description:Object(external_kbnSharedDeps_Lodash_.get)(info,"meta.layout")||NA},{title:"Dimensions",description:getDimensions(info)},{title:"Job Type",description:jobType},{title:"Content Type",description:Object(external_kbnSharedDeps_Lodash_.get)(info,"output.content_type")||NA},{title:"Size in Bytes",description:Object(external_kbnSharedDeps_Lodash_.get)(info,"output.size")||NA}],jobInfoStatus=[{title:"Attempts",description:attempts},{title:"Max Attempts",description:maxAttempts},{title:"Timeout",description:timeout},{title:"Status",description:info.status||NA},{title:"Browser Type",description:constants.USES_HEADLESS_JOB_TYPES.includes(jobType)?info.browser_type||"unknown":NA}];warnings&&jobInfoStatus.push({title:"Errors",description:warnings});const jobInfoParts={datetimes:jobInfoDateTimes,payload:jobInfoPayload,status:jobInfoStatus};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescriptionList,{listItems:jobInfoParts.datetimes,type:"column",align:"center",compressed:!0}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescriptionList,{listItems:jobInfoParts.payload,type:"column",align:"center",compressed:!0}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescriptionList,{listItems:jobInfoParts.status,type:"column",align:"center",compressed:!0}))}componentWillUnmount(){this.mounted=!1}componentDidMount(){this.mounted=!0}render(){let flyout;return this.state.isFlyoutVisible&&(flyout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPortal,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyout,{ownFocus:!0,onClose:this.closeFlyout,size:"s","aria-labelledby":"flyoutTitle","data-test-subj":"reportInfoFlyout"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutHeader,{hasBorder:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",{id:"flyoutTitle"},this.state.calloutTitle))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,this.renderInfo()))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:this.showFlyout,iconType:"iInCircle",color:"primary","data-test-subj":"reportInfoButton","aria-label":"Show report info"}),flyout)}}var statuses;!function(statuses){statuses.configStatus="configStatus",statuses.chromeStatus="chromeStatus",statuses.screenshotStatus="screenshotStatus"}(statuses||(statuses={}));const initialState={[statuses.configStatus]:"incomplete",[statuses.chromeStatus]:"incomplete",[statuses.screenshotStatus]:"incomplete",isFlyoutVisible:!1,help:[],logs:"",isBusy:!1,success:!0},ReportDiagnostic=({apiClient:apiClient})=>{const[state,setStateBase]=Object(external_kbnSharedDeps_React_.useState)(initialState),setState=s=>setStateBase({...state,...s}),{configStatus:configStatus,isBusy:isBusy,screenshotStatus:screenshotStatus,chromeStatus:chromeStatus,isFlyoutVisible:isFlyoutVisible,help:help,logs:logs,success:success}=state,closeFlyout=()=>setState({...initialState,isFlyoutVisible:!1}),apiWrapper=(apiMethod,statusProp)=>()=>{setState({isBusy:!0,[statusProp]:"incomplete"}),apiMethod().then(response=>{setState({isBusy:!1,help:response.help,logs:response.logs,success:response.success,[statusProp]:response.success?"complete":"danger"})}).catch(error=>{setState({isBusy:!1,help:[external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticApiCallFailure",{defaultMessage:"There was a problem running the diagnostic: {error}",values:{error:error}})],logs:""+error.message,success:!1,[statusProp]:"danger"})})},steps=[{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticConfigTitle",{defaultMessage:"Verify Kibana configuration"}),children:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticConfigMessage",defaultMessage:"Ensure your Kibana configuration is properly set up for reports."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{disabled:isBusy||"complete"===configStatus,isLoading:isBusy&&"incomplete"===configStatus,onClick:apiWrapper(apiClient.verifyConfig,statuses.configStatus),iconType:"complete"===configStatus?"check":void 0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticConfigButton",defaultMessage:"Verify configuration"}))),status:success||"complete"===configStatus?configStatus:"danger"}];let flyout;return"complete"===configStatus&&steps.push({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticBrowserTitle",{defaultMessage:"Check browser"}),children:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticBrowserMessage",defaultMessage:"Reporting uses a headless browser to generate PDF and PNGs. Validate that the browser can launch successfully."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{disabled:isBusy||"complete"===chromeStatus,onClick:apiWrapper(apiClient.verifyBrowser,statuses.chromeStatus),isLoading:isBusy&&"incomplete"===chromeStatus,iconType:"complete"===chromeStatus?"check":void 0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticBrowserButton",defaultMessage:"Check browser"}))),status:success||"complete"===chromeStatus?chromeStatus:"danger"}),"complete"===chromeStatus&&steps.push({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticScreenshotTitle",{defaultMessage:"Check screen capture"}),children:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticScreenshotMessage",defaultMessage:"Ensure that the headless browser can capture a screenshot of a page."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{disabled:isBusy||"complete"===screenshotStatus,onClick:apiWrapper(apiClient.verifyScreenCapture,statuses.screenshotStatus),isLoading:isBusy&&"incomplete"===screenshotStatus,iconType:"complete"===screenshotStatus?"check":void 0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticScreenshotButton",defaultMessage:"Capture screenshot"}))),status:success||"complete"===screenshotStatus?screenshotStatus:"danger"}),"complete"===screenshotStatus&&steps.push({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticSuccessTitle",{defaultMessage:"All set!"}),children:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticSuccessMessage",defaultMessage:"Everything looks good for reporting to function."})),status:success?screenshotStatus:"danger"}),success||steps.push({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.diagnosticFailureTitle",{defaultMessage:"Something isn't working properly."}),children:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,help.length?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,help.join("\n")))):null,logs.length?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticFailureDescription",defaultMessage:"Here are some details about the issue:"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCodeBlock,null,logs)):null),status:"danger"}),isFlyoutVisible&&(flyout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyout,{onClose:closeFlyout,"aria-labelledby":"reportingHelperTitle",size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutHeader,{hasBorder:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticTitle",defaultMessage:"Reporting Diagnostics"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticDescription",defaultMessage:"Run diagnostics to automatically troubleshoot common reporting problems."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSteps,{steps:steps})))),external_kbnSharedDeps_React_default.a.createElement("div",null,flyout,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",flush:"left",onClick:()=>setState({isFlyoutVisible:!0})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.diagnosticButton",defaultMessage:"Run reporting diagnostics"})))};function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function report_listing_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const jobStatusLabelsMap=new Map([[constants.JOB_STATUSES.PENDING,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.pendingText",{defaultMessage:"Pending"})],[constants.JOB_STATUSES.PROCESSING,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.processingText",{defaultMessage:"Processing"})],[constants.JOB_STATUSES.COMPLETED,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.completedText",{defaultMessage:"Completed"})],[constants.JOB_STATUSES.WARNINGS,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.warningText",{defaultMessage:"Completed with warnings"})],[constants.JOB_STATUSES.FAILED,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.failedText",{defaultMessage:"Failed"})],[constants.JOB_STATUSES.CANCELLED,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.jobStatuses.cancelledText",{defaultMessage:"Cancelled"})]]);class report_listing_ReportListingUi extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),report_listing_defineProperty(this,"isInitialJobsFetch",void 0),report_listing_defineProperty(this,"licenseSubscription",void 0),report_listing_defineProperty(this,"mounted",void 0),report_listing_defineProperty(this,"poller",void 0),report_listing_defineProperty(this,"licenseHandler",license=>{const{enableLinks:enableLinks,showLinks:showLinks,message:badLicenseMessage}=Object(license_check.a)(license.check("reporting","basic"));this.setState({enableLinks:enableLinks,showLinks:showLinks,badLicenseMessage:badLicenseMessage})}),report_listing_defineProperty(this,"onSelectionChange",jobs=>{this.setState(current=>({...current,selectedJobs:jobs}))}),report_listing_defineProperty(this,"removeRecord",record=>{const{jobs:jobs}=this.state,filtered=jobs.filter(j=>j.id!==record.id);this.setState(current=>({...current,jobs:filtered}))}),report_listing_defineProperty(this,"renderDeleteButton",()=>{const{selectedJobs:selectedJobs}=this.state;if(0===selectedJobs.length)return;return external_kbnSharedDeps_React_default.a.createElement(report_delete_button_ReportDeleteButton,_extends({jobsToDelete:selectedJobs,performDelete:async()=>{for(const record of selectedJobs)try{await this.props.apiClient.deleteReport(record.id),this.removeRecord(record),this.props.toasts.addSuccess(this.props.intl.formatMessage({id:"xpack.reporting.listing.table.deleteConfim",defaultMessage:"The {reportTitle} report was deleted"},{reportTitle:record.object_title}))}catch(error){throw this.props.toasts.addDanger(this.props.intl.formatMessage({id:"xpack.reporting.listing.table.deleteFailedErrorMessage",defaultMessage:"The report was not deleted: {error}"},{error:error})),error}this.setState(()=>({page:0}),this.fetchJobs)}},this.props))}),report_listing_defineProperty(this,"onTableChange",({page:page})=>{const{index:pageIndex}=page;this.setState(()=>({page:pageIndex}),this.fetchJobs)}),report_listing_defineProperty(this,"fetchJobs",async()=>{let jobs,total;this.isInitialJobsFetch&&this.setState(()=>({isLoading:!0}));try{jobs=await this.props.apiClient.list(this.state.page),total=await this.props.apiClient.total(),this.isInitialJobsFetch=!1}catch(fetchError){return this.licenseAllowsToShowThisPage()?("Failed to fetch"===fetchError.message&&this.props.toasts.addDanger(fetchError.message||this.props.intl.formatMessage({id:"xpack.reporting.listing.table.requestFailedErrorMessage",defaultMessage:"Request failed"})),void(this.mounted&&this.setState(()=>({isLoading:!1,jobs:[],total:0})))):(this.props.toasts.addDanger(this.state.badLicenseMessage),void this.props.redirect("management"))}this.mounted&&this.setState(()=>({isLoading:!1,total:total,jobs:jobs.map(job=>{const{_source:source}=job;return{id:job._id,type:source.jobtype,object_type:source.payload.objectType,object_title:source.payload.title,created_by:source.created_by,created_at:source.created_at,started_at:source.started_at,completed_at:source.completed_at,status:source.status,statusLabel:jobStatusLabelsMap.get(source.status)||source.status,max_size_reached:!!source.output&&source.output.max_size_reached,attempts:source.attempts,max_attempts:source.max_attempts,csv_contains_formulas:Object(external_kbnSharedDeps_Lodash_.get)(source,"output.csv_contains_formulas"),warnings:source.output?source.output.warnings:void 0}})}))}),report_listing_defineProperty(this,"licenseAllowsToShowThisPage",()=>this.state.showLinks&&this.state.enableLinks),this.state={page:0,total:0,jobs:[],selectedJobs:[],isLoading:!1,showLinks:!1,enableLinks:!1,badLicenseMessage:""},this.isInitialJobsFetch=!0}render(){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,{horizontalPosition:"center",className:"euiPageBody--restrictWidth-default"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.reportstitle",defaultMessage:"Reports"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued",size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.reports.subtitle",defaultMessage:"Get reports generated in Kibana applications."}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),this.renderTable()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"rowReverse"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(ReportDiagnostic,{apiClient:this.props.apiClient}))))}componentWillUnmount(){this.mounted=!1,this.poller.stop(),this.licenseSubscription&&this.licenseSubscription.unsubscribe()}componentDidMount(){this.mounted=!0;const{pollConfig:pollConfig,license$:license$}=this.props,pollFrequencyInMillis=Object(schema_utils.a)(pollConfig.jobsRefresh.interval);this.poller=new poller.a({functionToPoll:()=>this.fetchJobs(),pollFrequencyInMillis:pollFrequencyInMillis,trailing:!1,continuePollingOnError:!0,pollFrequencyErrorMultiplier:pollConfig.jobsRefresh.intervalErrorMultiplier}),this.poller.start(),this.licenseSubscription=license$.subscribe(this.licenseHandler)}formatDate(timestamp){try{return external_kbnSharedDeps_Moment_default()(timestamp).format("YYYY-MM-DD @ hh:mm A")}catch(error){return timestamp}}renderTable(){const{intl:intl}=this.props,tableColumns=[{field:"object_title",name:intl.formatMessage({id:"xpack.reporting.listing.tableColumns.reportTitle",defaultMessage:"Report"}),render:(objectTitle,record)=>external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("div",null,objectTitle),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTextColor,{color:"subdued"},record.object_type)))},{field:"created_at",name:intl.formatMessage({id:"xpack.reporting.listing.tableColumns.createdAtTitle",defaultMessage:"Created at"}),render:(createdAt,record)=>record.created_by?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("div",null,this.formatDate(createdAt)),external_kbnSharedDeps_React_default.a.createElement("span",null,record.created_by)):this.formatDate(createdAt)},{field:"status",name:intl.formatMessage({id:"xpack.reporting.listing.tableColumns.statusTitle",defaultMessage:"Status"}),render:(status,record)=>{if("pending"===status)return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.tableValue.statusDetail.pendingStatusReachedText",defaultMessage:"Pending - waiting for job to be processed"}));let maxSizeReached,warnings,statusTimestamp;record.max_size_reached&&(maxSizeReached=external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.tableValue.statusDetail.maxSizeReachedText",defaultMessage:" - Max size reached"}))),record.warnings&&(warnings=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTextColor,{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.tableValue.statusDetail.warningsText",defaultMessage:"Errors occurred: see job info for details."})))),status===constants.JOB_STATUSES.PROCESSING&&record.started_at?statusTimestamp=this.formatDate(record.started_at):record.completed_at&&[constants.JOB_STATUSES.COMPLETED,constants.JOB_STATUSES.FAILED,constants.JOB_STATUSES.WARNINGS].includes(status)&&(statusTimestamp=this.formatDate(record.completed_at));let statusLabel=jobStatusLabelsMap.get(status)||status;return status===constants.JOB_STATUSES.PROCESSING&&(statusLabel+=` (attempt ${record.attempts} of ${record.max_attempts})`),statusTimestamp?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.reporting.listing.tableValue.statusDetail.statusTimestampText",defaultMessage:"{statusLabel} at {statusTimestamp}",values:{statusLabel:statusLabel,statusTimestamp:external_kbnSharedDeps_React_default.a.createElement("span",{className:"eui-textNoWrap"},statusTimestamp)}}),maxSizeReached,warnings):external_kbnSharedDeps_React_default.a.createElement("div",null,statusLabel,maxSizeReached)}},{name:intl.formatMessage({id:"xpack.reporting.listing.tableColumns.actionsTitle",defaultMessage:"Actions"}),actions:[{render:record=>external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(ReportDownloadButton,_extends({},this.props,{record:record})),external_kbnSharedDeps_React_default.a.createElement(ReportErrorButton,_extends({},this.props,{record:record})),external_kbnSharedDeps_React_default.a.createElement(report_info_button_ReportInfoButton,_extends({},this.props,{jobId:record.id})))}]}],pagination={pageIndex:this.state.page,pageSize:10,totalItemCount:this.state.total,hidePerPageOptions:!0},selection={itemId:"id",onSelectionChange:this.onSelectionChange};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBasicTable,{tableCaption:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.reporting.listing.table.captionDescription",{defaultMessage:"Reports generated in Kibana applications"}),itemId:"id",items:this.state.jobs,loading:this.state.isLoading,columns:tableColumns,noItemsMessage:this.state.isLoading?intl.formatMessage({id:"xpack.reporting.listing.table.loadingReportsDescription",defaultMessage:"Loading reports"}):intl.formatMessage({id:"xpack.reporting.listing.table.noCreatedReportsDescription",defaultMessage:"No reports have been created"}),pagination:pagination,selection:selection,isSelectable:!0,onChange:this.onTableChange,"data-test-subj":"reportJobListing"}),this.state.selectedJobs.length>0?this.renderDeleteButton():null)}}const ReportListing=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)(report_listing_ReportListingUi);async function mountManagementSection(coreSetup,coreStart,license$,pollConfig,apiClient,params){return Object(external_kbnSharedDeps_ReactDom_.render)(external_kbnSharedDeps_React_.createElement(external_kbnSharedDeps_KbnI18nReact_.I18nProvider,null,external_kbnSharedDeps_React_.createElement(ReportListing,{toasts:coreSetup.notifications.toasts,license$:license$,pollConfig:pollConfig,redirect:coreStart.application.navigateToApp,apiClient:apiClient})),params.element),()=>{Object(external_kbnSharedDeps_ReactDom_.unmountComponentAtNode)(params.element)}}}}]);