/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[12],{308:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"RolesGridPage",(function(){return roles_grid_page_RolesGridPage}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_Lodash_=__webpack_require__(16),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4),public_=__webpack_require__(6),model=__webpack_require__(15),management_badges=__webpack_require__(89);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class confirm_delete_ConfirmDelete extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),_defineProperty(this,"onConfirmDelete",()=>{this.setState({deleteInProgress:!0},()=>{this.deleteRoles()})}),_defineProperty(this,"deleteRoles",async()=>{const{rolesToDelete:rolesToDelete,callback:callback,rolesAPIClient:rolesAPIClient,notifications:notifications}=this.props,errors=[],deleteOperations=rolesToDelete.map(roleName=>(async()=>{try{await rolesAPIClient.deleteRole(roleName),notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.confirmDelete.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role {roleName}",values:{roleName:roleName}}))}catch(e){errors.push(roleName),notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.confirmDelete.roleDeletingErrorNotificationMessage",{defaultMessage:"Error deleting role {roleName}",values:{roleName:roleName}}))}})());await Promise.all(deleteOperations),callback(rolesToDelete,errors)}),this.state={deleteInProgress:!1}}render(){const{rolesToDelete:rolesToDelete}=this.props,moreThanOne=rolesToDelete.length>1,title=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.deleteRoleTitle",{defaultMessage:"Delete role{value, plural, one {{roleName}} other {s}}",values:{value:rolesToDelete.length,roleName:" "+rolesToDelete[0]}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModal,{onClose:this.props.onCancel},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeaderTitle,{"data-test-subj":"confirmModalTitleText"},title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,moreThanOne?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.removingRolesDescription",defaultMessage:"You are about to delete these roles:"})),external_kbnSharedDeps_React_default.a.createElement("ul",null,rolesToDelete.map(roleName=>external_kbnSharedDeps_React_default.a.createElement("li",{key:roleName},roleName)))):null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.deletingRolesWarningMessage",defaultMessage:"You can't undo this operation."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{"data-test-subj":"confirmModalCancelButton",onClick:this.props.onCancel,isDisabled:this.state.deleteInProgress},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{"data-test-subj":"confirmModalConfirmButton",onClick:this.onConfirmDelete,fill:!0,color:"danger",isLoading:this.state.deleteInProgress},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.deleteButtonLabel",defaultMessage:"Delete"}))))}}const PermissionDenied=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,{horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"securityApp",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.deniedPermissionTitle",defaultMessage:"You need permission to manage roles"})),body:external_kbnSharedDeps_React_default.a.createElement("p",{"data-test-subj":"permissionDeniedMessage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.noPermissionToManageRolesDescription",defaultMessage:"Contact your system administrator."}))})));function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function roles_grid_page_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const getRoleManagementHref=(action,roleName)=>`/${action}${roleName?"/"+encodeURIComponent(roleName):""}`;class roles_grid_page_RolesGridPage extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),roles_grid_page_defineProperty(this,"getPageContent",()=>{const{roles:roles}=this.state;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.roleTitle",defaultMessage:"Roles"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued",size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.subtitle",defaultMessage:"Apply roles to groups of users and manage permissions across the stack."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,_extends({"data-test-subj":"createRoleButton"},Object(public_.reactRouterNavigate)(this.props.history,getRoleManagementHref("edit"))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.createRoleButtonLabel",defaultMessage:"Create role"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentBody,null,this.state.showDeleteConfirmation?external_kbnSharedDeps_React_default.a.createElement(confirm_delete_ConfirmDelete,{onCancel:this.onCancelDelete,rolesToDelete:this.state.selection.map(role=>role.name),callback:this.handleDelete,notifications:this.props.notifications,rolesAPIClient:this.props.rolesAPIClient}):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{itemId:"name",responsive:!1,columns:this.getColumnConfig(),hasActions:!0,selection:{selectable:role=>!role.metadata||!role.metadata._reserved,selectableMessage:selectable=>selectable?"":"Role is reserved",onSelectionChange:selection=>this.setState({selection:selection})},pagination:{initialPageSize:20,pageSizeOptions:[10,20,30,50,100]},items:this.state.visibleRoles,loading:0===roles.length,search:{toolsLeft:this.renderToolsLeft(),toolsRight:this.renderToolsRight(),box:{incremental:!0,"data-test-subj":"searchRoles"},onChange:query=>{this.setState({filter:query.queryText,visibleRoles:this.getVisibleRoles(this.state.roles,query.queryText,this.state.includeReservedRoles)})}},sorting:{sort:{field:"name",direction:"asc"}},rowProps:()=>({"data-test-subj":"roleRow"}),isSelectable:!0})))}),roles_grid_page_defineProperty(this,"getColumnConfig",()=>[{field:"name",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.nameColumnName",{defaultMessage:"Role"}),sortable:!0,truncateText:!0,render:(name,record)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued",size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,_extends({"data-test-subj":"roleRowName"},Object(public_.reactRouterNavigate)(this.props.history,getRoleManagementHref("edit",name))),name))},{field:"metadata",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.statusColumnName",{defaultMessage:"Status"}),sortable:role=>Object(model.h)(role)&&!Object(model.g)(role),render:(metadata,record)=>this.getRoleStatusBadges(record)},{name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.actionsColumnName",{defaultMessage:"Actions"}),width:"150px",actions:[{available:role=>!Object(model.i)(role),render:role=>{const title=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.editRoleActionName",{defaultMessage:"Edit {roleName}",values:{roleName:role.name}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,_extends({"aria-label":title,"data-test-subj":"edit-role-action-"+role.name,title:title,color:"primary",iconType:"pencil"},Object(public_.reactRouterNavigate)(this.props.history,getRoleManagementHref("edit",role.name))))}},{available:role=>!Object(model.j)(role),render:role=>{const title=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.cloneRoleActionName",{defaultMessage:"Clone {roleName}",values:{roleName:role.name}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,_extends({"aria-label":title,"data-test-subj":"clone-role-action-"+role.name,title:title,color:"primary",iconType:"copy"},Object(public_.reactRouterNavigate)(this.props.history,getRoleManagementHref("clone",role.name))))}}]}]),roles_grid_page_defineProperty(this,"getVisibleRoles",(roles,filter,includeReservedRoles)=>roles.filter(role=>{const normalized=(""+role.name).toLowerCase(),normalizedQuery=filter.toLowerCase();return-1!==normalized.indexOf(normalizedQuery)&&(includeReservedRoles||!Object(model.j)(role))})),roles_grid_page_defineProperty(this,"onIncludeReservedRolesChange",e=>{this.setState({includeReservedRoles:e.target.checked,visibleRoles:this.getVisibleRoles(this.state.roles,this.state.filter,e.target.checked)})}),roles_grid_page_defineProperty(this,"getRoleStatusBadges",role=>{const enabled=Object(model.h)(role),deprecated=Object(model.g)(role),reserved=Object(model.j)(role),badges=[];return enabled||badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.b,{"data-test-subj":"roleDisabled"})),reserved&&badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.d,{"data-test-subj":"roleReserved",tooltipContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.reservedRoleBadgeTooltip",defaultMessage:"Reserved roles are built-in and cannot be edited or removed."})})),deprecated&&badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.a,{"data-test-subj":"roleDeprecated",tooltipContent:Object(model.d)(role)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s"},badges.map((badge,index)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:index,grow:!1},badge)))}),roles_grid_page_defineProperty(this,"handleDelete",()=>{this.setState({selection:[],showDeleteConfirmation:!1}),this.loadRoles()}),roles_grid_page_defineProperty(this,"onCancelDelete",()=>{this.setState({showDeleteConfirmation:!1})}),this.state={roles:[],visibleRoles:[],selection:[],filter:"",showDeleteConfirmation:!1,permissionDenied:!1,includeReservedRoles:!0}}componentDidMount(){this.loadRoles()}render(){const{permissionDenied:permissionDenied}=this.state;return permissionDenied?external_kbnSharedDeps_React_default.a.createElement(PermissionDenied,null):this.getPageContent()}async loadRoles(){try{const roles=await this.props.rolesAPIClient.getRoles();this.setState({roles:roles,visibleRoles:this.getVisibleRoles(roles,this.state.filter,this.state.includeReservedRoles)})}catch(e){403===external_kbnSharedDeps_Lodash_default.a.get(e,"body.statusCode")?this.setState({permissionDenied:!0}):this.props.notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.fetchingRolesErrorMessage",{defaultMessage:"Error fetching roles: {message}",values:{message:external_kbnSharedDeps_Lodash_default.a.get(e,"body.message","")}}))}}renderToolsLeft(){const{selection:selection}=this.state;if(0===selection.length)return;const numSelected=selection.length;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{"data-test-subj":"deleteRoleButton",color:"danger",onClick:()=>this.setState({showDeleteConfirmation:!0})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.deleteSelectedRolesButtonLabel",defaultMessage:"Delete {numSelected} role{numSelected, plural, one { } other {s}}",values:{numSelected:numSelected}}))}renderToolsRight(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{"data-test-subj":"showReservedRolesSwitch",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.roles.showReservedRolesLabel",defaultMessage:"Show reserved roles"}),checked:this.state.includeReservedRoles,onChange:this.onIncludeReservedRolesChange})}}},89:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DeprecatedBadge})),__webpack_require__.d(__webpack_exports__,"b",(function(){return DisabledBadge})),__webpack_require__.d(__webpack_exports__,"c",(function(){return EnabledBadge})),__webpack_require__.d(__webpack_exports__,"d",(function(){return ReservedBadge}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4);const OptionalToolTip=props=>props.tooltipContent?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:props.tooltipContent},props.children):props.children,DeprecatedBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.deprecatedBadge",defaultMessage:"Deprecated"}))),DisabledBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"hollow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.disabledBadge",defaultMessage:"Disabled"}))),EnabledBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"secondary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.enabledBadge",defaultMessage:"Enabled"}))),ReservedBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"primary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.reservedBadge",defaultMessage:"Reserved"})))}}]);