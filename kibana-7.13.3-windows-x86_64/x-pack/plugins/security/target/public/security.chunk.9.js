/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[9],{103:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return isUserReserved})),__webpack_require__.d(__webpack_exports__,"b",(function(){return isUserDeprecated})),__webpack_require__.d(__webpack_exports__,"a",(function(){return getExtendedUserDeprecationNotice}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);const isUserReserved=user=>{var _user$metadata$_reser,_user$metadata;return null!==(_user$metadata$_reser=null===(_user$metadata=user.metadata)||void 0===_user$metadata?void 0:_user$metadata._reserved)&&void 0!==_user$metadata$_reser&&_user$metadata$_reser},isUserDeprecated=user=>{var _user$metadata$_depre,_user$metadata2;return null!==(_user$metadata$_depre=null===(_user$metadata2=user.metadata)||void 0===_user$metadata2?void 0:_user$metadata2._deprecated)&&void 0!==_user$metadata$_depre&&_user$metadata$_depre},getExtendedUserDeprecationNotice=user=>{var _user$metadata$_depre2,_user$metadata3;const reason=null!==(_user$metadata$_depre2=null===(_user$metadata3=user.metadata)||void 0===_user$metadata3?void 0:_user$metadata3._deprecated_reason)&&void 0!==_user$metadata$_depre2?_user$metadata$_depre2:"";return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__.i18n.translate("xpack.security.management.users.extendedUserDeprecationNotice",{defaultMessage:"The {username} user is deprecated. {reason}",values:{username:user.username,reason:reason}})}},107:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return RoleTableDisplay}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),model=__webpack_require__(15);const RoleTableDisplay=({role:role,navigateToApp:navigateToApp})=>{let content,path;return"string"==typeof role?(content=external_kbnSharedDeps_React_default.a.createElement("div",null,role),path="security/roles/edit/"+encodeURIComponent(role)):Object(model.g)(role)?(content=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:Object(model.d)(role),"data-test-subj":"roleDeprecationTooltip"},external_kbnSharedDeps_React_default.a.createElement("div",null,role.name," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"alert",color:"warning",size:"s",className:"eui-alignTop"}))),path="security/roles/edit/"+encodeURIComponent(role.name)):(content=external_kbnSharedDeps_React_default.a.createElement("div",null,role.name),path="security/roles/edit/"+encodeURIComponent(role.name)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{onClick:()=>navigateToApp("management",{path:path})},content)}},310:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"UsersGridPage",(function(){return users_grid_page_UsersGridPage}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4),public_=__webpack_require__(6),management_badges=__webpack_require__(89),role_table_display=__webpack_require__(107);__webpack_require__(95);class confirm_delete_users_ConfirmDeleteUsers extends external_kbnSharedDeps_React_.Component{constructor(...args){var obj,key,value;super(...args),value=()=>{const{usersToDelete:usersToDelete,callback:callback,userAPIClient:userAPIClient,notifications:notifications}=this.props,errors=[];usersToDelete.forEach(async username=>{try{await userAPIClient.deleteUser(username),notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.userSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted user {username}",values:{username:username}}))}catch(e){errors.push(username),notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.userDeletingErrorNotificationMessage",{defaultMessage:"Error deleting user {username}",values:{username:username}}))}callback&&callback(usersToDelete,errors)})},(key="deleteUsers")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}render(){const{usersToDelete:usersToDelete,onCancel:onCancel}=this.props,moreThanOne=usersToDelete.length>1,title=moreThanOne?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.deleteMultipleUsersTitle",{defaultMessage:"Delete {userLength} users",values:{userLength:usersToDelete.length}}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.deleteOneUserTitle",{defaultMessage:"Delete user {userLength}",values:{userLength:usersToDelete[0]}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{title:title,onCancel:onCancel,onConfirm:this.deleteUsers,cancelButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.confirmDelete.confirmButtonLabel",{defaultMessage:"Delete"}),buttonColor:"danger"},external_kbnSharedDeps_React_default.a.createElement("div",null,moreThanOne?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.confirmDelete.removingUsersDescription",defaultMessage:"You are about to delete these users:"})),external_kbnSharedDeps_React_default.a.createElement("ul",null,usersToDelete.map(username=>external_kbnSharedDeps_React_default.a.createElement("li",{key:username},username)))):null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.confirmDelete.removingUsersWarningMessage",defaultMessage:"This operation cannot be undone."}))))}}var user_utils=__webpack_require__(103);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function users_grid_page_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class users_grid_page_UsersGridPage extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),users_grid_page_defineProperty(this,"handleDelete",(usernames,errors)=>{const{users:users}=this.state,filteredUsers=users.filter(({username:username})=>!usernames.includes(username)||errors.includes(username));this.setState({selection:[],showDeleteConfirmation:!1,users:filteredUsers,visibleUsers:this.getVisibleUsers(filteredUsers,this.state.filter,this.state.includeReservedUsers)})}),users_grid_page_defineProperty(this,"getVisibleUsers",(users,filter,includeReservedUsers)=>users.filter(({username:username,roles:userRoles,full_name:fullName="",email:email="",metadata:metadata={}})=>{const normalized=`${username} ${userRoles.join(" ")} ${fullName} ${email}`.toLowerCase(),normalizedQuery=filter.toLowerCase();return-1!==normalized.indexOf(normalizedQuery)&&(includeReservedUsers||!metadata._reserved)})),users_grid_page_defineProperty(this,"onIncludeReservedUsersChange",e=>{this.setState({includeReservedUsers:e.target.checked,visibleUsers:this.getVisibleUsers(this.state.users,this.state.filter,e.target.checked)})}),users_grid_page_defineProperty(this,"getUserStatusBadges",user=>{const enabled=user.enabled,reserved=Object(user_utils.c)(user),deprecated=Object(user_utils.b)(user),badges=[];return enabled||badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.b,{"data-test-subj":"userDisabled"})),reserved&&badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.d,{"data-test-subj":"userReserved",tooltipContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.reservedUserBadgeTooltip",defaultMessage:"Reserved users are built-in and cannot be edited or removed."})})),deprecated&&badges.push(external_kbnSharedDeps_React_default.a.createElement(management_badges.a,{"data-test-subj":"userDeprecated",tooltipContent:Object(user_utils.a)(user)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s",wrap:!0},badges.map((badge,index)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:index,grow:!1},badge)))}),users_grid_page_defineProperty(this,"onCancelDelete",()=>{this.setState({showDeleteConfirmation:!1})}),this.state={users:[],visibleUsers:[],roles:[],selection:[],showDeleteConfirmation:!1,permissionDenied:!1,filter:"",includeReservedUsers:!0}}componentDidMount(){this.loadUsersAndRoles()}render(){const{users:users,roles:roles,permissionDenied:permissionDenied,showDeleteConfirmation:showDeleteConfirmation,selection:selection}=this.state;if(permissionDenied)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,{horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"securityApp",title:external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.deniedPermissionTitle",defaultMessage:"You need permission to manage users"})),body:external_kbnSharedDeps_React_default.a.createElement("p",{"data-test-subj":"permissionDeniedMessage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.permissionDeniedToManageUsersDescription",defaultMessage:"Contact your system administrator."}))})));const columns=[{field:"username",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.userNameColumnName",{defaultMessage:"User Name"}),sortable:!0,truncateText:!0,render:username=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,_extends({"data-test-subj":"userRowUserName"},Object(public_.reactRouterNavigate)(this.props.history,"/edit/"+encodeURIComponent(username))),username)},{field:"full_name",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.fullNameColumnName",{defaultMessage:"Full Name"}),sortable:!0,truncateText:!0,render:fullName=>external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"userRowFullName"},fullName)},{field:"email",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.emailAddressColumnName",{defaultMessage:"Email Address"}),sortable:!0,truncateText:!0,render:email=>external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"userRowEmail"},email)},{field:"roles",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.rolesColumnName",{defaultMessage:"Roles"}),width:"30%",render:rolenames=>{const roleLinks=rolenames.map((rolename,index)=>{var _roles$find;const roleDefinition=null!==(_roles$find=null==roles?void 0:roles.find(role=>role.name===rolename))&&void 0!==_roles$find?_roles$find:rolename;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1,key:rolename},external_kbnSharedDeps_React_default.a.createElement(role_table_display.a,{role:roleDefinition,navigateToApp:this.props.navigateToApp}))});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{"data-test-subj":"userRowRoles",gutterSize:"s",wrap:!0},roleLinks)}},{field:"metadata",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.statusColumnName",{defaultMessage:"Status"}),width:"10%",sortable:({metadata:metadata})=>Boolean(metadata&&metadata._reserved),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.reservedColumnDescription",{defaultMessage:"Reserved users are built-in and cannot be removed. Only the password can be changed."}),render:(metadata,record)=>this.getUserStatusBadges(record)}],selectionConfig={itemId:"username",selectable:user=>!(user.metadata&&user.metadata._reserved),selectableMessage:selectable=>selectable?"":"User is a system user",onSelectionChange:updatedSelection=>this.setState({selection:updatedSelection})},search={toolsLeft:this.renderToolsLeft(),toolsRight:this.renderToolsRight(),box:{incremental:!0,"data-test-subj":"searchUsers"},onChange:query=>{this.setState({filter:query.queryText,visibleUsers:this.getVisibleUsers(this.state.users,query.queryText,this.state.includeReservedUsers)})}};return external_kbnSharedDeps_React_default.a.createElement("div",{className:"secUsersListingPage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,{className:"secUsersListingPage__content"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.usersTitle",defaultMessage:"Users"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,_extends({"data-test-subj":"createUserButton"},Object(public_.reactRouterNavigate)(this.props.history,"/create")),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.createNewUserButtonLabel",defaultMessage:"Create user"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentBody,null,showDeleteConfirmation?external_kbnSharedDeps_React_default.a.createElement(confirm_delete_users_ConfirmDeleteUsers,{onCancel:this.onCancelDelete,usersToDelete:selection.map(user=>user.username),callback:this.handleDelete,userAPIClient:this.props.userAPIClient,notifications:this.props.notifications}):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{itemId:"username",tableCaption:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.tableCaption",{defaultMessage:"Users"}),rowHeader:"username",columns:columns,selection:selectionConfig,pagination:{initialPageSize:20,pageSizeOptions:[10,20,50,100]},items:this.state.visibleUsers,loading:0===users.length,search:search,sorting:{sort:{field:"username",direction:"asc"}},rowProps:()=>({"data-test-subj":"userRow"}),isSelectable:!0}))))}async loadUsersAndRoles(){try{const[users,roles]=await Promise.all([this.props.userAPIClient.getUsers(),this.props.rolesAPIClient.getRoles()]);this.setState({users:users,roles:roles,visibleUsers:this.getVisibleUsers(users,this.state.filter,this.state.includeReservedUsers)})}catch(e){403===e.body.statusCode?this.setState({permissionDenied:!0}):this.props.notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.fetchingUsersErrorMessage",{defaultMessage:"Error fetching users: {message}",values:{message:e.body.message}}))}}renderToolsLeft(){const{selection:selection}=this.state;if(0===selection.length)return;const numSelected=selection.length;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{"data-test-subj":"deleteUserButton",color:"danger",onClick:()=>this.setState({showDeleteConfirmation:!0})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.deleteUsersButtonLabel",defaultMessage:"Delete {numSelected} user{numSelected, plural, one { } other {s}}",values:{numSelected:numSelected}}))}renderToolsRight(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{"data-test-subj":"showReservedUsersSwitch",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.users.showReservedUsersLabel",defaultMessage:"Show reserved users"}),checked:this.state.includeReservedUsers,onChange:this.onIncludeReservedUsersChange})}}},89:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DeprecatedBadge})),__webpack_require__.d(__webpack_exports__,"b",(function(){return DisabledBadge})),__webpack_require__.d(__webpack_exports__,"c",(function(){return EnabledBadge})),__webpack_require__.d(__webpack_exports__,"d",(function(){return ReservedBadge}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4);const OptionalToolTip=props=>props.tooltipContent?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:props.tooltipContent},props.children):props.children,DeprecatedBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.deprecatedBadge",defaultMessage:"Deprecated"}))),DisabledBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"hollow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.disabledBadge",defaultMessage:"Disabled"}))),EnabledBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"secondary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.enabledBadge",defaultMessage:"Enabled"}))),ReservedBadge=props=>external_kbnSharedDeps_React_default.a.createElement(OptionalToolTip,{tooltipContent:props.tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{"data-test-subj":props["data-test-subj"],color:"primary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.reservedBadge",defaultMessage:"Reserved"})))},95:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return change_password_form_ChangePasswordForm}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_Lodash_=__webpack_require__(16),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class change_password_form_ChangePasswordForm extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),_defineProperty(this,"getForm",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,null,this.props.isUserChangingOwnPassword&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,_extends({},this.validateCurrentPassword(),{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.currentPasswordLabel",defaultMessage:"Current password"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldPassword,{autoComplete:"off","data-test-subj":"currentPassword",type:"dual",value:this.state.currentPassword,onChange:this.onCurrentPasswordChange,disabled:this.state.changeInProgress,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,_extends({helpText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.passwordRequirements",defaultMessage:"Use at least 6 characters."})},this.validateNewPassword(),{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.newPasswordLabel",defaultMessage:"New password"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldPassword,{autoComplete:"new-password","data-test-subj":"newPassword",type:"dual",value:this.state.newPassword,onChange:this.onNewPasswordChange,disabled:this.state.changeInProgress,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,_extends({},this.validateConfirmPassword(),{fullWidth:!0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.confirmPasswordLabel",defaultMessage:"Confirm new password"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldPassword,{autoComplete:"new-password","data-test-subj":"confirmNewPassword",type:"dual",value:this.state.confirmPassword,onChange:this.onConfirmPasswordChange,disabled:this.state.changeInProgress,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:this.onChangePasswordClick,fill:!0,isLoading:this.state.changeInProgress,"data-test-subj":"changePasswordButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.saveChangesButtonLabel",defaultMessage:"Change password"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:this.onCancelClick,isDisabled:this.state.changeInProgress},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.cancelButtonLabel",defaultMessage:"Reset"}))))))),_defineProperty(this,"onCurrentPasswordChange",e=>{this.setState({currentPassword:e.target.value,currentPasswordError:!1})}),_defineProperty(this,"onNewPasswordChange",e=>{this.setState({newPassword:e.target.value})}),_defineProperty(this,"onConfirmPasswordChange",e=>{this.setState({confirmPassword:e.target.value})}),_defineProperty(this,"onCancelClick",()=>{this.setState({shouldValidate:!1,currentPassword:"",newPassword:"",confirmPassword:"",currentPasswordError:!1,changeInProgress:!1})}),_defineProperty(this,"onChangePasswordClick",async()=>{this.setState({shouldValidate:!0,currentPasswordError:!1},()=>{const{isInvalid:isInvalid}=this.validateForm();isInvalid||this.setState({changeInProgress:!0},()=>this.performPasswordChange())})}),_defineProperty(this,"validateCurrentPassword",(shouldValidate=this.state.shouldValidate)=>shouldValidate&&this.props.isUserChangingOwnPassword?this.state.currentPasswordError?{isInvalid:!0,error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.changePasswordForm.invalidPassword",defaultMessage:"Current password is incorrect."})}:this.state.currentPassword?{isInvalid:!1}:{isInvalid:!0,error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.currentPasswordRequired",defaultMessage:"Current password is required."})}:{isInvalid:!1}),_defineProperty(this,"validateNewPassword",(shouldValidate=this.state.shouldValidate)=>{const{newPassword:newPassword}=this.state;return shouldValidate&&newPassword.length<6?{isInvalid:!0,error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.passwordLengthDescription",defaultMessage:"Password is too short."})}:{isInvalid:!1}}),_defineProperty(this,"validateConfirmPassword",(shouldValidate=this.state.shouldValidate)=>{const{newPassword:newPassword,confirmPassword:confirmPassword}=this.state;return shouldValidate&&newPassword!==confirmPassword?{isInvalid:!0,error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.account.passwordsDoNotMatch",defaultMessage:"Passwords do not match."})}:{isInvalid:!1}}),_defineProperty(this,"validateForm",()=>{const firstFailure=[this.validateCurrentPassword(!0),this.validateNewPassword(!0),this.validateConfirmPassword(!0)].find(result=>result.isInvalid);return firstFailure||{isInvalid:!1}}),_defineProperty(this,"performPasswordChange",async()=>{try{await this.props.userAPIClient.changePassword(this.props.user.username,this.state.newPassword,this.state.currentPassword),this.handleChangePasswordSuccess()}catch(e){this.handleChangePasswordFailure(e)}finally{this.setState({changeInProgress:!1})}}),_defineProperty(this,"handleChangePasswordSuccess",()=>{this.props.notifications.toasts.addSuccess({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.account.changePasswordSuccess",{defaultMessage:"Your password has been changed."}),"data-test-subj":"passwordUpdateSuccess"}),this.setState({currentPasswordError:!1,shouldValidate:!1,newPassword:"",currentPassword:"",confirmPassword:""}),this.props.onChangePassword&&this.props.onChangePassword()}),_defineProperty(this,"handleChangePasswordFailure",error=>{error.body&&403===error.body.statusCode?this.setState({currentPasswordError:!0}):this.props.notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.editUser.settingPasswordErrorMessage",{defaultMessage:"Error setting password: {message}",values:{message:external_kbnSharedDeps_Lodash_default.a.get(error,"body.message")}}))}),this.state={shouldValidate:!1,currentPassword:"",newPassword:"",confirmPassword:"",currentPasswordError:!1,changeInProgress:!1}}render(){return this.getForm()}}}}]);