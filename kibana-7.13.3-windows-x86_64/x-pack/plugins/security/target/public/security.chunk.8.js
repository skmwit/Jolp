/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[8,15],{101:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return FormFlyout}));var _elastic_eui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_use_html_id__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(93);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const FormFlyout=({title:title,submitButtonText:submitButtonText,submitButtonColor:submitButtonColor,onCancel:onCancel,onSubmit:onSubmit,isLoading:isLoading,isDisabled:isDisabled,children:children,initialFocus:initialFocus,...rest})=>{Object(react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{initialFocus&&initialFocus.current&&initialFocus.current.focus()},[initialFocus]);const titleId=Object(_use_html_id__WEBPACK_IMPORTED_MODULE_3__.a)("formFlyout","title");return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiPortal,null,react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlyout,_extends({onClose:onCancel,"aria-labelledby":titleId},rest),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlyoutHeader,{hasBorder:!0},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiTitle,{size:"m"},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("h2",{id:titleId},title))),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlyoutBody,null,children),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlyoutFooter,null,react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlexGroup,{justifyContent:"spaceBetween"},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlexItem,{grow:!1},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiButtonEmpty,{"data-test-subj":"formFlyoutCancelButton",flush:"right",isDisabled:isLoading,onClick:onCancel},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__.FormattedMessage,{id:"xpack.security.formFlyout.cancelButton",defaultMessage:"Cancel"}))),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiFlexItem,{grow:!1},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiButton,{"data-test-subj":"formFlyoutSubmitButton",isLoading:isLoading,isDisabled:isDisabled,color:submitButtonColor,fill:!0,onClick:onSubmit},submitButtonText))))))}},102:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useInitialFocus}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);function useInitialFocus(deps=[]){const inputRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return Object(react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{inputRef.current&&inputRef.current.focus()},deps),inputRef}},117:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"APIKeysAPIClient",(function(){return APIKeysAPIClient}));const apiKeysUrl="/internal/security/api_key";class APIKeysAPIClient{constructor(http){this.http=http}async checkPrivileges(){return await this.http.get(apiKeysUrl+"/privileges")}async getApiKeys(isAdmin=!1){return await this.http.get(apiKeysUrl,{query:{isAdmin:isAdmin}})}async invalidateApiKeys(apiKeys,isAdmin=!1){return await this.http.post(apiKeysUrl+"/invalidate",{body:JSON.stringify({apiKeys:apiKeys,isAdmin:isAdmin})})}async createApiKey(apiKey){return await this.http.post(apiKeysUrl,{body:JSON.stringify(apiKey)})}}},304:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"APIKeysGridPage",(function(){return api_keys_grid_page_APIKeysGridPage}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_MomentTimezone_=__webpack_require__(77),external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ReactRouterDom_=__webpack_require__(3),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4),public_=__webpack_require__(78),kibanaReact_public_=__webpack_require__(6),breadcrumb=__webpack_require__(7),external_kbnSharedDeps_Theme_=__webpack_require__(79);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const TokenField=props=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormControlLayout,_extends({},props,{append:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCopy,{textToCopy:props.value},copyText=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.copyTokenField.copyButton",{defaultMessage:"Copy to clipboard"}),iconType:"copyClipboard",color:"success",style:{backgroundColor:"transparent"},onClick:copyText})),style:{backgroundColor:"transparent"},readOnly:!0}),external_kbnSharedDeps_React_default.a.createElement("input",{type:"text","aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.copyTokenField.tokenLabel",{defaultMessage:"Token"}),className:"euiFieldText euiFieldText--inGroup",value:props.value,style:{fontFamily:external_kbnSharedDeps_Theme_.euiThemeVars.euiCodeFontFamily,fontSize:external_kbnSharedDeps_Theme_.euiThemeVars.euiFontSizeXS},onFocus:event=>event.currentTarget.select(),readOnly:!0})),SelectableTokenField=props=>{const{options:options,...rest}=props,[isPopoverOpen,setIsPopoverOpen]=external_kbnSharedDeps_React_default.a.useState(!1),[selectedOption,setSelectedOption]=external_kbnSharedDeps_React_default.a.useState(options[0]),selectedIndex=options.findIndex(c=>c.key===selectedOption.key),closePopover=()=>setIsPopoverOpen(!1);return external_kbnSharedDeps_React_default.a.createElement(TokenField,_extends({},rest,{prepend:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right",color:"success",onClick:()=>setIsPopoverOpen(!isPopoverOpen)},selectedOption.label),isOpen:isPopoverOpen,panelPaddingSize:"none",closePopover:closePopover},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuPanel,{initialFocusedItemIndex:2*selectedIndex,items:options.reduce((items,option,i)=>(items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuItem,{key:option.key,icon:option.icon,layoutAlign:"top",onClick:()=>{closePopover(),setSelectedOption(option)}},external_kbnSharedDeps_React_default.a.createElement("strong",null,option.label),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,option.description)))),i<options.length-1&&items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,{key:option.key+"-seperator",margin:"none"})),items),[])})),value:selectedOption.value}))};var doc_link=__webpack_require__(92),use_html_id=__webpack_require__(93);const ApiKeysEmptyPrompt=({error:error,children:children})=>{const accordionId=Object(use_html_id.a)("apiKeysEmptyPrompt","accordion");if(error){if(function(error){var _error$body;return-1!==((null===(_error$body=error.body)||void 0===_error$body?void 0:_error$body.message)||"").indexOf('disabled.feature="api_keys"')}(error))return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"alert",body:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.disabledErrorMessage",defaultMessage:"API keys are disabled."})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(doc_link.a,{app:"elasticsearch",doc:"security-settings.html#api-key-service-settings"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.docsLinkText",defaultMessage:"Learn how to enable API keys."}))))});if(function(error){var _error$body2;return 403===(null===(_error$body2=error.body)||void 0===_error$body2?void 0:_error$body2.statusCode)}(error))return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"lock",body:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.forbiddenErrorMessage",defaultMessage:"Not authorized to manage API keys."}))});const ThrowError=()=>{throw error};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"alert",body:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.errorMessage",defaultMessage:"Could not load API keys."})),actions:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:accordionId,buttonClassName:"euiButtonEmpty euiButtonEmpty--primary euiButtonEmpty--xSmall",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.technicalDetailsButton",defaultMessage:"Technical details"}),buttonProps:{style:{display:"flex",justifyContent:"center"}},arrowDisplay:"right",paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{textAlign:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiErrorBoundary,null,external_kbnSharedDeps_React_default.a.createElement(ThrowError,null)))))})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"gear",title:external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyTitle",defaultMessage:"Create your first API key"})),body:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyMessage",defaultMessage:"Allow applications to access Elastic on your behalf."})),actions:children})};var useAsyncFn=__webpack_require__(40),useAsyncFn_default=__webpack_require__.n(useAsyncFn),form_flyout=__webpack_require__(101),use_current_user=__webpack_require__(19),use_form=__webpack_require__(94),use_initial_focus=__webpack_require__(102),roles_api_client=__webpack_require__(29),api_keys_api_client=__webpack_require__(117);function create_api_key_flyout_extends(){return(create_api_key_flyout_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const defaultDefaultValues={name:"",expiration:"",customExpiration:!1,customPrivileges:!1,role_descriptors:JSON.stringify({"role-a":{cluster:["all"],indices:[{names:["index-a*"],privileges:["read"]}]},"role-b":{cluster:["all"],indices:[{names:["index-b*"],privileges:["all"]}]}},null,2)},CreateApiKeyFlyout=({onSuccess:onSuccess,onCancel:onCancel,defaultValues:defaultValues=defaultDefaultValues})=>{var _body;const{services:services}=Object(kibanaReact_public_.useKibana)(),{value:currentUser,loading:isLoadingCurrentUser}=Object(use_current_user.b)(),[{value:roles,loading:isLoadingRoles},getRoles]=useAsyncFn_default()(()=>new roles_api_client.RolesAPIClient(services.http).getRoles(),[services.http]),[form,eventHandlers]=Object(use_form.a)({onSubmit:async values=>{try{const apiKey=await new api_keys_api_client.APIKeysAPIClient(services.http).createApiKey(function(values){return{name:values.name,expiration:values.customExpiration&&values.expiration?values.expiration+"d":void 0,role_descriptors:values.customPrivileges&&values.role_descriptors?JSON.parse(values.role_descriptors):void 0}}(values));null==onSuccess||onSuccess(apiKey)}catch(error){throw error}},validate:validate,defaultValues:defaultValues}),isLoading=isLoadingCurrentUser||isLoadingRoles;Object(external_kbnSharedDeps_React_.useEffect)(()=>{getRoles()},[]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{if(currentUser&&roles){const userPermissions=currentUser.roles.reduce((accumulator,roleName)=>{const role=roles.find(r=>r.name===roleName);return role&&(accumulator[role.name]=role.elasticsearch),accumulator},{});form.touched.role_descriptors||form.setValue("role_descriptors",JSON.stringify(userPermissions,null,2))}},[currentUser,roles]);const firstFieldRef=Object(use_initial_focus.a)([isLoading]);return external_kbnSharedDeps_React_default.a.createElement(form_flyout.a,{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.title",{defaultMessage:"Create API key"}),onCancel:onCancel,onSubmit:form.submit,submitButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.submitButton",{defaultMessage:"{isSubmitting, select, true{Creating API key…} other{Create API key}}",values:{isSubmitting:form.isSubmitting}}),isLoading:form.isSubmitting,isDisabled:isLoading||form.isSubmitted&&form.isInvalid,size:"s",ownFocus:!0},form.submitError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.errorMessage",{defaultMessage:"Could not create API key"}),color:"danger"},(null===(_body=form.submitError.body)||void 0===_body?void 0:_body.message)||form.submitError.message),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null)),isLoading?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLoadingContent,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,create_api_key_flyout_extends({component:"form",isInvalid:form.isInvalid,error:Object.values(form.errors),invalidCallout:!form.submitError&&form.isSubmitted?"above":"none"},eventHandlers),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.users.changePasswordFlyout.userLabel",{defaultMessage:"User"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"user"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{style:{overflow:"hidden"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},null==currentUser?void 0:currentUser.username),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.nameLabel",{defaultMessage:"Name"}),helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.nameHelpText",{defaultMessage:"What is this key used for?"}),error:form.errors.name,isInvalid:form.touched.name&&!!form.errors.name},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{name:"name",defaultValue:form.values.name,isInvalid:form.touched.name&&!!form.errors.name,inputRef:firstFieldRef,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormFieldset,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{id:"apiKeyCustom",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.customPrivilegesLabel",{defaultMessage:"Restrict privileges"}),checked:!!form.values.customPrivileges,onChange:e=>form.setValue("customPrivileges",e.target.checked)}),form.values.customPrivileges&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{helpText:external_kbnSharedDeps_React_default.a.createElement(doc_link.a,{app:"elasticsearch",doc:"security-api-create-api-key.html#security-api-create-api-key-request-body"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.accountManagement.createApiKey.roleDescriptorsHelpText",defaultMessage:"Learn how to structure role descriptors."})),error:form.errors.role_descriptors,isInvalid:form.touched.role_descriptors&&!!form.errors.role_descriptors},external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_.CodeEditorField,{value:form.values.role_descriptors,onChange:value=>form.setValue("role_descriptors",value),languageId:"xjson",height:200})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormFieldset,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{name:"customExpiration",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.customExpirationLabel",{defaultMessage:"Expire after time"}),checked:!!form.values.customExpiration,onChange:e=>form.setValue("customExpiration",e.target.checked)}),form.values.customExpiration&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{error:form.errors.expiration,isInvalid:form.touched.expiration&&!!form.errors.expiration,label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.customExpirationInputLabel",{defaultMessage:"Lifetime (days)"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldNumber,{append:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.accountManagement.createApiKey.expirationUnit",{defaultMessage:"days"}),name:"expiration",min:0,defaultValue:form.values.expiration,isInvalid:form.touched.expiration&&!!form.errors.expiration,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}))),external_kbnSharedDeps_React_default.a.createElement("input",{type:"submit",hidden:!0})))};function validate(values){const errors={};if(values.name||(errors.name=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createApiKey.nameRequired",{defaultMessage:"Enter a name."})),values.customExpiration){const parsedExpiration=parseFloat(values.expiration);(isNaN(parsedExpiration)||parsedExpiration<=0)&&(errors.expiration=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createApiKey.expirationRequired",{defaultMessage:"Enter a valid duration or disable this option."}))}if(values.customPrivileges)if(values.role_descriptors)try{JSON.parse(values.role_descriptors)}catch(e){errors.role_descriptors=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createApiKey.invalidJsonError",{defaultMessage:"Enter valid JSON."})}else errors.role_descriptors=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createApiKey.roleDescriptorsRequired",{defaultMessage:"Enter role descriptors or disable this option."});return errors}const InvalidateProvider=({isAdmin:isAdmin,children:children,notifications:notifications,apiKeysAPIClient:apiKeysAPIClient})=>{const[apiKeys,setApiKeys]=Object(external_kbnSharedDeps_React_.useState)([]),[isModalOpen,setIsModalOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),onSuccessCallback=Object(external_kbnSharedDeps_React_.useRef)(null),closeModal=()=>{setIsModalOpen(!1),setApiKeys([])},invalidateApiKey=async()=>{let result,error,errors;try{result=await apiKeysAPIClient.invalidateApiKeys(apiKeys,isAdmin)}catch(e){error=e}if(closeModal(),result){const{itemsInvalidated:itemsInvalidated}=result;if(({errors:errors}=result),itemsInvalidated&&itemsInvalidated.length){const successMessage=itemsInvalidated.length>1?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successMultipleNotificationTitle",{defaultMessage:"Deleted {count} API keys",values:{count:itemsInvalidated.length}}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successSingleNotificationTitle",{defaultMessage:"Deleted API key '{name}'",values:{name:itemsInvalidated[0].name}});notifications.toasts.addSuccess(successMessage),onSuccessCallback.current&&onSuccessCallback.current([...itemsInvalidated])}}if(error||errors&&errors.length){const errorMessage=errors&&errors.length>1||error&&apiKeys.length>1?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorMultipleNotificationTitle",{defaultMessage:"Error deleting {count} apiKeys",values:{count:errors&&errors.length||apiKeys.length}}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorSingleNotificationTitle",{defaultMessage:"Error deleting API key '{name}'",values:{name:errors&&errors[0].name||apiKeys[0].name}});notifications.toasts.addDanger(errorMessage)}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,children((keys,onSuccess=(()=>{}))=>{if(!keys||!keys.length)throw new Error("No API key IDs specified for deletion");setIsModalOpen(!0),setApiKeys(keys),onSuccessCallback.current=onSuccess}),(()=>{if(!isModalOpen)return null;const isSingle=1===apiKeys.length;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{role:"dialog",title:isSingle?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteSingleTitle",{defaultMessage:"Delete API key '{name}'?",values:{name:apiKeys[0].name}}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleTitle",{defaultMessage:"Delete {count} API keys?",values:{count:apiKeys.length}}),onCancel:closeModal,onConfirm:invalidateApiKey,cancelButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.confirmButtonLabel",{defaultMessage:"Delete {count, plural, one {API key} other {API keys}}",values:{count:apiKeys.length}}),buttonColor:"danger","data-test-subj":"invalidateApiKeyConfirmationModal"},isSingle?null:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleListDescription",{defaultMessage:"You are about to delete these API keys:"})),external_kbnSharedDeps_React_default.a.createElement("ul",null,apiKeys.map(({name:name,id:id})=>external_kbnSharedDeps_React_default.a.createElement("li",{key:id},name)))))})())},NotEnabled=()=>{const docLinks=Object(kibanaReact_public_.useKibana)().services.docLinks;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorTitle",defaultMessage:"API keys not enabled in Elasticsearch"}),color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorDescription",defaultMessage:"Contact your system administrator and refer to the {link} to enable API keys.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{href:""+docLinks.links.security.apiKeyServiceSettings,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysDisabledErrorLinkText",defaultMessage:"docs"}))}}))},PermissionDenied=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,{horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"securityApp",title:external_kbnSharedDeps_React_default.a.createElement("h2",{"data-test-subj":"apiKeysPermissionDeniedMessage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.deniedPermissionTitle",defaultMessage:"You need permission to manage API keys"})),body:external_kbnSharedDeps_React_default.a.createElement("p",{"data-test-subj":"permissionDeniedMessage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.noPermissionToManageRolesDescription",defaultMessage:"Contact your system administrator."}))})));function api_keys_grid_page_extends(){return(api_keys_grid_page_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class api_keys_grid_page_APIKeysGridPage extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),_defineProperty(this,"renderTable",()=>{var _apiKeys$reduce,_apiKeys$reduce2;const{apiKeys:apiKeys,selectedItems:selectedItems,isLoadingTable:isLoadingTable,isAdmin:isAdmin,error:error}=this.state,message=isLoadingTable?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysTableLoadingMessage",defaultMessage:"Loading API keys…"}):void 0,sorting={sort:{field:"creation",direction:"desc"}},pagination={initialPageSize:20,pageSizeOptions:[10,20,50]},selection={onSelectionChange:newSelectedItems=>{this.setState({selectedItems:newSelectedItems})}},search={toolsLeft:selectedItems.length?external_kbnSharedDeps_React_default.a.createElement(InvalidateProvider,{isAdmin:isAdmin,notifications:this.props.notifications,apiKeysAPIClient:this.props.apiKeysAPIClient},invalidateApiKeyPrompt=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:()=>invalidateApiKeyPrompt(selectedItems.map(({name:name,id:id})=>({name:name,id:id})),this.onApiKeysInvalidated),color:"danger","data-test-subj":"bulkInvalidateActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.invalidateApiKeyButton",defaultMessage:"Delete {count, plural, one {API key} other {API keys}}",values:{count:selectedItems.length}}))):void 0,box:{incremental:!0},filters:isAdmin?[{type:"field_value_selection",field:"username",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.userFilterLabel",{defaultMessage:"User"}),multiSelect:!1,options:Object.keys(null!==(_apiKeys$reduce=null==apiKeys?void 0:apiKeys.reduce((apiKeysMap,apiKey)=>(apiKeysMap[apiKey.username]=!0,apiKeysMap),{}))&&void 0!==_apiKeys$reduce?_apiKeys$reduce:{}).map(username=>({value:username,view:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"user"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,username)))}))},{type:"field_value_selection",field:"realm",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.realmFilterLabel",{defaultMessage:"Realm"}),multiSelect:!1,options:Object.keys(null!==(_apiKeys$reduce2=null==apiKeys?void 0:apiKeys.reduce((apiKeysMap,apiKey)=>(apiKeysMap[apiKey.realm]=!0,apiKeysMap),{}))&&void 0!==_apiKeys$reduce2?_apiKeys$reduce2:{}).map(realm=>({value:realm,view:realm}))}]:void 0};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,isAdmin?void 0:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.manageOwnKeysWarning",defaultMessage:"You only have permission to manage your own API keys."}),color:"primary",iconType:"user"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null)),external_kbnSharedDeps_React_default.a.createElement(InvalidateProvider,{isAdmin:isAdmin,notifications:this.props.notifications,apiKeysAPIClient:this.props.apiKeysAPIClient},invalidateApiKeyPrompt=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{items:null!=apiKeys?apiKeys:[],itemId:"id",columns:this.getColumnConfig(invalidateApiKeyPrompt),search:search,sorting:sorting,selection:selection,pagination:pagination,loading:isLoadingTable,error:error&&external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeysEmptyPrompt.errorMessage",{defaultMessage:"Could not load API keys."}),message:message,isSelectable:!0})))}),_defineProperty(this,"getColumnConfig",invalidateApiKeyPrompt=>{const{isAdmin:isAdmin,createdApiKey:createdApiKey}=this.state;let config=[];return config=config.concat([{field:"name",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.nameColumnName",{defaultMessage:"Name"}),sortable:!0}]),isAdmin&&(config=config.concat([{field:"username",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.userNameColumnName",{defaultMessage:"User"}),sortable:!0,render:username=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"user"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,username)))},{field:"realm",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.realmColumnName",{defaultMessage:"Realm"}),sortable:!0}])),config=config.concat([{field:"creation",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.creationDateColumnName",{defaultMessage:"Created"}),sortable:!0,mobileOptions:{show:!1},render:(creation,item)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:external_kbnSharedDeps_MomentTimezone_default()(creation).format("MMMM Do YYYY HH:mm:ss")},item.id===(null==createdApiKey?void 0:createdApiKey.id)?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,{color:"secondary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createdBadge",defaultMessage:"Just now"})):external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_MomentTimezone_default()(creation).fromNow()))},{name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.statusColumnName",{defaultMessage:"Status"}),render:({expiration:expiration})=>expiration?Date.now()>expiration?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHealth,{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpired",defaultMessage:"Expired"})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHealth,{color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:external_kbnSharedDeps_MomentTimezone_default()(expiration).format("MMMM Do YYYY HH:mm:ss")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpires",defaultMessage:"Expires {timeFromNow}",values:{timeFromNow:external_kbnSharedDeps_MomentTimezone_default()(expiration).fromNow()}}))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHealth,{color:"primary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusActive",defaultMessage:"Active"}))},{actions:[{name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.deleteAction",{defaultMessage:"Delete"}),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.deleteDescription",{defaultMessage:"Delete this API key"}),icon:"trash",type:"icon",color:"danger",onClick:item=>invalidateApiKeyPrompt([{id:item.id,name:item.name}],this.onApiKeysInvalidated)}]}]),config}),_defineProperty(this,"onApiKeysInvalidated",apiKeysInvalidated=>{apiKeysInvalidated.length&&this.reloadApiKeys()}),_defineProperty(this,"reloadApiKeys",()=>{this.setState({isLoadingApp:!1,isLoadingTable:!0,createdApiKey:void 0,error:void 0}),this.loadApiKeys()}),_defineProperty(this,"loadApiKeys",async()=>{try{const{isAdmin:isAdmin}=this.state,{apiKeys:apiKeys}=await this.props.apiKeysAPIClient.getApiKeys(isAdmin);this.setState({apiKeys:apiKeys})}catch(e){this.setState({error:e})}this.setState({isLoadingApp:!1,isLoadingTable:!1})}),this.state={isLoadingApp:!0,isLoadingTable:!1,isAdmin:!1,canManage:!1,areApiKeysEnabled:!1,apiKeys:void 0,selectedItems:[],error:void 0}}componentDidMount(){this.checkPrivileges()}render(){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_.Route,{path:"/create"},external_kbnSharedDeps_React_default.a.createElement(breadcrumb.a,{text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},external_kbnSharedDeps_React_default.a.createElement(CreateApiKeyFlyout,{onSuccess:apiKey=>{this.props.history.push({pathname:"/"}),this.reloadApiKeys(),this.setState({createdApiKey:apiKey})},onCancel:()=>this.props.history.push({pathname:"/"})}))),this.renderContent())}renderContent(){var _this$state$createdAp,_this$state$createdAp2;const{isLoadingApp:isLoadingApp,isLoadingTable:isLoadingTable,areApiKeysEnabled:areApiKeysEnabled,isAdmin:isAdmin,canManage:canManage,error:error,apiKeys:apiKeys}=this.state;if(!apiKeys){if(isLoadingApp)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(public_.SectionLoading,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.loadingApiKeysDescription",defaultMessage:"Loading API keys…"})));if(!canManage)return external_kbnSharedDeps_React_default.a.createElement(PermissionDenied,null);if(error)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(ApiKeysEmptyPrompt,{error:error},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{iconType:"refresh",onClick:this.reloadApiKeys},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.accountManagement.apiKeys.retryButton",defaultMessage:"Try again"}))));if(!areApiKeysEnabled)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(NotEnabled,null))}if(!isLoadingTable&&apiKeys&&0===apiKeys.length)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(ApiKeysEmptyPrompt,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,api_keys_grid_page_extends({},Object(kibanaReact_public_.reactRouterNavigate)(this.props.history,"/create"),{fill:!0}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"}))));const concatenated=`${null===(_this$state$createdAp=this.state.createdApiKey)||void 0===_this$state$createdAp?void 0:_this$state$createdAp.id}:${null===(_this$state$createdAp2=this.state.createdApiKey)||void 0===_this$state$createdAp2?void 0:_this$state$createdAp2.api_key}`;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContent,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysTitle",defaultMessage:"API Keys"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued",size:"s","data-test-subj":"apiKeysDescriptionText"},external_kbnSharedDeps_React_default.a.createElement("p",null,isAdmin?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysAllDescription",defaultMessage:"View and delete API keys. An API key sends requests on behalf of a user."}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysOwnDescription",defaultMessage:"View and delete your API keys. An API key sends requests on your behalf."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentHeaderSection,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,Object(kibanaReact_public_.reactRouterNavigate)(this.props.history,"/create"),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"})))),this.state.createdApiKey&&!this.state.isLoadingTable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"success",iconType:"check",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.createSuccessMessage",{defaultMessage:"Created API key '{name}'",values:{name:this.state.createdApiKey.name}})},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.apiKeys.successDescription",defaultMessage:"Copy this key now. You will not be able to view it again."})),external_kbnSharedDeps_React_default.a.createElement(SelectableTokenField,{options:[{key:"base64",value:btoa(concatenated),icon:"empty",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.base64Label",{defaultMessage:"Base64"}),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.base64Description",{defaultMessage:"Format used to authenticate with Elasticsearch."})},{key:"json",value:JSON.stringify(this.state.createdApiKey),icon:"empty",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.jsonLabel",{defaultMessage:"JSON"}),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.jsonDescription",{defaultMessage:"Full API response."})},{key:"beats",value:concatenated,icon:"logoBeats",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.beatsLabel",{defaultMessage:"Beats"}),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.beatsDescription",{defaultMessage:"Format used to configure Beats."})},{key:"logstash",value:concatenated,icon:"logoLogstash",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.logstashLabel",{defaultMessage:"Logstash"}),description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.logstashDescription",{defaultMessage:"Format used to configure Logstash."})}]})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPageContentBody,null,this.renderTable()))}async checkPrivileges(){try{const{isAdmin:isAdmin,canManage:canManage,areApiKeysEnabled:areApiKeysEnabled}=await this.props.apiKeysAPIClient.checkPrivileges();this.setState({isAdmin:isAdmin,canManage:canManage,areApiKeysEnabled:areApiKeysEnabled}),canManage&&areApiKeysEnabled?this.loadApiKeys():this.setState({isLoadingApp:!1})}catch(e){var _e$body$message,_e$body;this.props.notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.apiKeys.table.fetchingApiKeysErrorMessage",{defaultMessage:"Error checking privileges: {message}",values:{message:null!==(_e$body$message=null===(_e$body=e.body)||void 0===_e$body?void 0:_e$body.message)&&void 0!==_e$body$message?_e$body$message:""}}))}}}},92:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DocLink}));var _elastic_eui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6);const DocLink=({app:app,doc:doc,children:children})=>{const[,getDocLink]=function(){const{services:services}=Object(_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_2__.useKibana)(),{links:links,ELASTIC_WEBSITE_URL:ELASTIC_WEBSITE_URL,DOC_LINK_VERSION:DOC_LINK_VERSION}=services.docLinks;return[links,Object(react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((app,doc)=>`${ELASTIC_WEBSITE_URL}guide/en/${app}/reference/${DOC_LINK_VERSION}/${doc}`,[ELASTIC_WEBSITE_URL,DOC_LINK_VERSION])]}();return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.EuiLink,{href:getDocLink(app,doc),target:"_blank",external:!0},children)}},93:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useHtmlId}));var _elastic_eui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0);function useHtmlId(prefix,suffix){return Object(react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>Object(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__.htmlIdGenerator)(prefix)(suffix),[prefix,suffix])}},94:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useForm}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(16),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react_use_lib_useAsyncFn__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(40),react_use_lib_useAsyncFn__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react_use_lib_useAsyncFn__WEBPACK_IMPORTED_MODULE_2__);function useForm(options){const form=function({onSubmit:onSubmit,validate:validate,defaultValues:defaultValues}){const[values,setValues]=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)(defaultValues),[errors,setErrors]=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)({}),[touched,setTouched]=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)({}),[submitCount,setSubmitCount]=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)(0),[validationState,validateForm]=react_use_lib_useAsyncFn__WEBPACK_IMPORTED_MODULE_2___default()(async formValues=>{const nextErrors=await validate(formValues);return setErrors(nextErrors),0===Object.keys(nextErrors).length&&setSubmitCount(0),nextErrors},[validate]),[submitState,submitForm]=react_use_lib_useAsyncFn__WEBPACK_IMPORTED_MODULE_2___default()(async formValues=>{const nextErrors=await validateForm(formValues);if(setTouched(function(values,value){return Object(lodash__WEBPACK_IMPORTED_MODULE_0__.cloneDeepWith)(values,v=>{if("object"!=typeof v&&null!==v)return value})}(formValues,!0)),setSubmitCount(submitCount+1),0===Object.keys(nextErrors).length)return onSubmit(formValues)},[validateForm,onSubmit]);return{setValue:async(name,value)=>{const nextValues=setDeep(values,name,value);setValues(nextValues),await validateForm(nextValues)},setTouched:async(name,value=!0)=>{setTouched(setDeep(touched,name,value)),await validateForm(values)},setError:(name,message)=>{setErrors(setDeep(errors,name,message)),setTouched(setDeep(touched,name,!0))},reset:nextValues=>{setValues(nextValues),setErrors({}),setTouched({}),setSubmitCount(0)},submit:()=>submitForm(values),values:values,errors:errors,touched:touched,isValidating:validationState.loading,isSubmitting:submitState.loading,submitError:submitState.error,isInvalid:Object.keys(errors).length>0,isSubmitted:submitCount>0}}(options),eventHandlers={onSubmit:event=>{event.preventDefault(),form.submit()},onChange:event=>{const{name:name,type:type,checked:checked,value:value}=event.target;name&&form.setValue(name,"checkbox"===type?checked:value)},onBlur:event=>{const{name:name}=event.target;name&&form.setTouched(event.target.name)}};return[form,eventHandlers]}function setDeep(values,name,value){return Object(lodash__WEBPACK_IMPORTED_MODULE_0__.get)(values,name)!==value?Object(lodash__WEBPACK_IMPORTED_MODULE_0__.set)(Object(lodash__WEBPACK_IMPORTED_MODULE_0__.cloneDeep)(values),name,value):values}}}]);