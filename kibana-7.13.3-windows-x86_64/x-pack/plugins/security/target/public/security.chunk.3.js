/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[3],{251:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(252);case"v7light":return __webpack_require__(254);case"v8dark":return __webpack_require__(256);case"v8light":return __webpack_require__(258)}},252:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(253);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},253:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),module.exports=exports},254:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(255);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},255:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),module.exports=exports},256:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(257);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},257:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),module.exports=exports},258:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(259);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},259:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),module.exports=exports},260:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(261);case"v7light":return __webpack_require__(263);case"v8dark":return __webpack_require__(265);case"v8light":return __webpack_require__(267)}},261:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(262);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},262:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".subFeaturePrivilegeExpandedRegion{background-color:#25262E;padding-left:40px;padding-top:8px}\n",""]),module.exports=exports},263:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(264);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},264:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".subFeaturePrivilegeExpandedRegion{background-color:#F5F7FA;padding-left:40px;padding-top:8px}\n",""]),module.exports=exports},265:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(266);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},266:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".subFeaturePrivilegeExpandedRegion{background-color:#25262E;padding-left:40px;padding-top:8px}\n",""]),module.exports=exports},267:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(268);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},268:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".subFeaturePrivilegeExpandedRegion{background-color:#F5F7FA;padding-left:40px;padding-top:8px}\n",""]),module.exports=exports},269:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(270);case"v7light":return __webpack_require__(272);case"v8dark":return __webpack_require__(274);case"v8light":return __webpack_require__(276)}},270:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(271);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},271:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),module.exports=exports},272:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(273);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},273:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),module.exports=exports},274:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(275);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},275:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),module.exports=exports},276:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(277);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},277:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),module.exports=exports},278:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(279);case"v7light":return __webpack_require__(281);case"v8dark":return __webpack_require__(283);case"v8light":return __webpack_require__(285)}},279:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(280);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},280:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),module.exports=exports},281:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(282);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},282:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),module.exports=exports},283:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(284);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},284:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),module.exports=exports},285:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(286);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},286:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),module.exports=exports},287:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(288);case"v7light":return __webpack_require__(290);case"v8dark":return __webpack_require__(292);case"v8light":return __webpack_require__(294)}},288:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(289);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},289:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#25262E}\n",""]),module.exports=exports},290:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(291);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},291:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#F5F7FA}\n",""]),module.exports=exports},292:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(293);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},293:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#25262E}\n",""]),module.exports=exports},294:function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(295);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},295:function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#F5F7FA}\n",""]),module.exports=exports},302:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"EditRolePage",(function(){return EditRolePage}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2),external_kbnSharedDeps_React_=__webpack_require__(0),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(4),public_=__webpack_require__(6),model=__webpack_require__(15),common_=__webpack_require__(75),external_kbnSharedDeps_Lodash_=__webpack_require__(16),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);class kibana_privilege_KibanaPrivilege{constructor(id,actions=[]){this.id=id,this.actions=actions}get name(){return external_kbnSharedDeps_Lodash_default.a.upperFirst(this.id)}grantsPrivilege(candidatePrivilege){return this.checkActions(this.actions,candidatePrivilege.actions).hasAllRequested}checkActions(knownActions,candidateActions){const missing=candidateActions.filter(action=>!knownActions.includes(action));return{missing:missing,hasAllRequested:knownActions.length>0&&candidateActions.length>0&&0===missing.length}}}class primary_feature_privilege_PrimaryFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(id,config,actions=[]){super(id,actions),this.config=config,this.actions=actions}isMinimalFeaturePrivilege(){return this.id.startsWith("minimal_")}getMinimalPrivilegeId(){return this.isMinimalFeaturePrivilege()?this.id:"minimal_"+this.id}}class sub_feature_privilege_SubFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(subPrivilegeConfig,actions=[]){super(subPrivilegeConfig.id,actions),this.subPrivilegeConfig=subPrivilegeConfig,this.actions=actions}get name(){return this.subPrivilegeConfig.name}}class sub_feature_privilege_group_SubFeaturePrivilegeGroup{constructor(config,actionMapping={}){this.config=config,this.actionMapping=actionMapping}get groupType(){return this.config.groupType}get privileges(){return this.config.privileges.map(p=>new sub_feature_privilege_SubFeaturePrivilege(p,this.actionMapping[p.id]||[]))}}class secured_sub_feature_SecuredSubFeature extends common_.SubFeature{constructor(config,actionMapping={}){var obj,key,value;super(config),this.actionMapping=actionMapping,value=void 0,(key="privileges")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.privileges=[];for(const privilege of this.privilegeIterator())this.privileges.push(privilege)}getPrivilegeGroups(){return this.privilegeGroups.map(pg=>new sub_feature_privilege_group_SubFeaturePrivilegeGroup(pg,this.actionMapping))}*privilegeIterator({predicate:predicate=(()=>!0)}={}){for(const group of this.privilegeGroups)yield*group.privileges.map(gp=>new sub_feature_privilege_SubFeaturePrivilege(gp,this.actionMapping[gp.id])).filter(privilege=>predicate(privilege,this))}}function secured_feature_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class secured_feature_SecuredFeature extends common_.KibanaFeature{constructor(config,actionMapping={}){var _this$config$subFeatu,_this$config$subFeatu2,_this$config$subFeatu3,_this$config$subFeatu4;super(config),secured_feature_defineProperty(this,"primaryFeaturePrivileges",void 0),secured_feature_defineProperty(this,"minimalPrimaryFeaturePrivileges",void 0),secured_feature_defineProperty(this,"subFeaturePrivileges",void 0),secured_feature_defineProperty(this,"securedSubFeatures",void 0),this.primaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map(([id,privilege])=>new primary_feature_privilege_PrimaryFeaturePrivilege(id,privilege,actionMapping[id])),null!==(_this$config$subFeatu=null===(_this$config$subFeatu2=this.config.subFeatures)||void 0===_this$config$subFeatu2?void 0:_this$config$subFeatu2.length)&&void 0!==_this$config$subFeatu&&_this$config$subFeatu?this.minimalPrimaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map(([id,privilege])=>new primary_feature_privilege_PrimaryFeaturePrivilege("minimal_"+id,privilege,actionMapping["minimal_"+id])):this.minimalPrimaryFeaturePrivileges=[],this.securedSubFeatures=null!==(_this$config$subFeatu3=null===(_this$config$subFeatu4=this.config.subFeatures)||void 0===_this$config$subFeatu4?void 0:_this$config$subFeatu4.map(sf=>new secured_sub_feature_SecuredSubFeature(sf,actionMapping)))&&void 0!==_this$config$subFeatu3?_this$config$subFeatu3:[],this.subFeaturePrivileges=this.securedSubFeatures.reduce((acc,subFeature)=>[...acc,...subFeature.privilegeIterator()],[])}getPrivilegesTooltip(){return this.config.privilegesTooltip}getAllPrivileges(){return[...this.primaryFeaturePrivileges,...this.minimalPrimaryFeaturePrivileges,...this.subFeaturePrivileges]}getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:includeMinimalFeaturePrivileges}={includeMinimalFeaturePrivileges:!1}){return includeMinimalFeaturePrivileges?[this.primaryFeaturePrivileges,this.minimalPrimaryFeaturePrivileges].flat():[...this.primaryFeaturePrivileges]}getMinimalFeaturePrivileges(){return[...this.minimalPrimaryFeaturePrivileges]}getSubFeaturePrivileges(){return[...this.subFeaturePrivileges]}getSubFeatures(){return[...this.securedSubFeatures]}}var privilege_utils=__webpack_require__(27);class PrivilegeCollection{constructor(privileges){var obj,key,value;value=void 0,(key="actions")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.actions=new Set(privileges.reduce((acc,priv)=>[...acc,...priv.actions],[]))}grantsPrivilege(privilege){return this.checkActions(this.actions,privilege.actions).hasAllRequested}checkActions(knownActions,candidateActions){const missing=candidateActions.filter(action=>!knownActions.has(action));return{missing:missing,hasAllRequested:knownActions.size>0&&candidateActions.length>0&&0===missing.length}}}function kibana_privileges_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function recordsToBasePrivilegeMap(record){return new Map(Object.entries(record).map(entry=>function(entry){const[privilegeId,actions]=entry;return[privilegeId,new kibana_privilege_KibanaPrivilege(privilegeId,actions)]}(entry)))}class kibana_privileges_KibanaPrivileges{constructor(rawKibanaPrivileges,features){kibana_privileges_defineProperty(this,"global",void 0),kibana_privileges_defineProperty(this,"spaces",void 0),kibana_privileges_defineProperty(this,"feature",void 0),this.global=recordsToBasePrivilegeMap(rawKibanaPrivileges.global),this.spaces=recordsToBasePrivilegeMap(rawKibanaPrivileges.space),this.feature=new Map(features.map(feature=>{const rawPrivs=rawKibanaPrivileges.features[feature.id];return[feature.id,new secured_feature_SecuredFeature(feature.toRaw(),rawPrivs)]}))}getBasePrivileges(entry){return Object(privilege_utils.a)(entry)?Array.from(this.global.values()):Array.from(this.spaces.values())}getSecuredFeature(featureId){return this.feature.get(featureId)}getSecuredFeatures(){return Array.from(this.feature.values())}createCollectionFromRoleKibanaPrivileges(roleKibanaPrivileges){const filterAssigned=assignedPrivileges=>privilege=>assignedPrivileges.includes(privilege.id),privileges=roleKibanaPrivileges.map(entry=>[this.getBasePrivileges(entry).filter(filterAssigned(entry.base)),Object.entries(entry.feature).map(([featureId,assignedFeaturePrivs])=>this.getFeaturePrivileges(featureId).filter(filterAssigned(assignedFeaturePrivs)))].flat(2)).flat();return new PrivilegeCollection(privileges)}getFeaturePrivileges(featureId){var _this$getSecuredFeatu,_this$getSecuredFeatu2;return null!==(_this$getSecuredFeatu=null===(_this$getSecuredFeatu2=this.getSecuredFeature(featureId))||void 0===_this$getSecuredFeatu2?void 0:_this$getSecuredFeatu2.getAllPrivileges())&&void 0!==_this$getSecuredFeatu?_this$getSecuredFeatu:[]}}function delete_role_button_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class delete_role_button_DeleteRoleButton extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),delete_role_button_defineProperty(this,"state",{showModal:!1}),delete_role_button_defineProperty(this,"maybeShowModal",()=>this.state.showModal?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleTitle",defaultMessage:"Delete Role"}),onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.cancelButtonLabel",defaultMessage:"No, don't delete"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.confirmButtonLabel",defaultMessage:"Yes, delete role"}),buttonColor:"danger"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleConfirmationText",defaultMessage:"Are you sure you want to delete this role?"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleWarningText",defaultMessage:"This action cannot be undone!"}))):null),delete_role_button_defineProperty(this,"closeModal",()=>{this.setState({showModal:!1})}),delete_role_button_defineProperty(this,"showModal",()=>{this.setState({showModal:!0})}),delete_role_button_defineProperty(this,"onConfirmDelete",()=>{this.closeModal(),this.props.onDelete()})}render(){return this.props.canDelete?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{color:"danger",onClick:this.showModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleButtonLabel",defaultMessage:"Delete role"})),this.maybeShowModal()):null}}__webpack_require__(251);function collapsible_panel_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class collapsible_panel_CollapsiblePanel extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),collapsible_panel_defineProperty(this,"state",{collapsed:!1}),collapsible_panel_defineProperty(this,"getTitle",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,null,external_kbnSharedDeps_React_default.a.createElement("h2",null,this.props.iconType&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:this.props.iconType,size:"xl",className:"collapsiblePanel__logo"})," "),this.props.title))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{"data-test-subj":"showHidePrivilege",onClick:this.toggleCollapsed},this.state.collapsed?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.showLinkText",defaultMessage:"show"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.hideLinkText",defaultMessage:"hide"}))))),collapsible_panel_defineProperty(this,"getForm",()=>this.state.collapsed?null:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),this.props.children)),collapsible_panel_defineProperty(this,"toggleCollapsed",()=>{this.setState({collapsed:!this.state.collapsed})}),this.state={collapsed:props.initiallyCollapsed||!1}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPanel,null,this.getTitle(),this.getForm())}}function cluster_privileges_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class cluster_privileges_ClusterPrivileges extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),cluster_privileges_defineProperty(this,"buildComboBox",items=>{const role=this.props.role,options=items.map(i=>({label:i})),selectedOptions=(role.elasticsearch.cluster||[]).map(k=>({label:k}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:"clusterPrivs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"cluster-privileges-combobox",options:options,selectedOptions:selectedOptions,onChange:this.onClusterPrivilegesChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:Object(model.i)(role)}))}),cluster_privileges_defineProperty(this,"onClusterPrivilegesChange",selectedPrivileges=>{this.props.onChange(selectedPrivileges.map(priv=>priv.label))}),cluster_privileges_defineProperty(this,"onCreateCustomPrivilege",customPrivilege=>{this.props.onChange([...this.props.role.elasticsearch.cluster,customPrivilege])}),cluster_privileges_defineProperty(this,"getAvailableClusterPrivileges",()=>{const availableClusterPrivileges=[...this.props.builtinClusterPrivileges,...this.props.role.elasticsearch.cluster];return external_kbnSharedDeps_Lodash_default.a.uniq(availableClusterPrivileges)})}render(){const availableClusterPrivileges=this.getAvailableClusterPrivileges();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,this.buildComboBox(availableClusterPrivileges))}}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function index_privilege_form_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const fromOption=option=>option.label,toOption=value=>({label:value});class index_privilege_form_IndexPrivilegeForm extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),index_privilege_form_defineProperty(this,"getPrivilegeForm",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,_extends({label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.indicesFormRowLabel",defaultMessage:"Indices"}),fullWidth:!0},this.props.validator.validateIndexPrivilege(this.props.indexPrivilege)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"indicesInput"+this.props.formIndex,options:this.props.indexPatterns.map(toOption),selectedOptions:this.props.indexPrivilege.names.map(toOption),onCreateOption:this.onCreateIndexPatternOption,onChange:this.onIndexPatternsChange,isDisabled:this.props.isRoleReadOnly}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.privilegesFormRowLabel",defaultMessage:"Privileges"}),fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"privilegesInput"+this.props.formIndex,options:this.props.availableIndexPrivileges.map(toOption),selectedOptions:this.props.indexPrivilege.privileges.map(toOption),onChange:this.onPrivilegeChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:this.props.isRoleReadOnly})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),this.getFieldLevelControls(),this.getGrantedDocumentsControl())),index_privilege_form_defineProperty(this,"getFieldLevelControls",()=>{const{allowFieldLevelSecurity:allowFieldLevelSecurity,allowDocumentLevelSecurity:allowDocumentLevelSecurity,availableFields:availableFields,indexPrivilege:indexPrivilege,isRoleReadOnly:isRoleReadOnly}=this.props;if(!allowFieldLevelSecurity)return null;const{grant:grant,except:except}=this.getFieldSecurity(indexPrivilege);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column"},!isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{"data-test-subj":"restrictFieldsQuery"+this.props.formIndex,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantFieldPrivilegesLabel",defaultMessage:"Grant access to specific fields"}),compressed:!0,checked:this.state.fieldSecurityExpanded,onChange:this.toggleFieldSecurity})),this.state.fieldSecurityExpanded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowLabel",defaultMessage:"Granted fields"}),fullWidth:!0,className:"indexPrivilegeForm__grantedFieldsRow",helpText:isRoleReadOnly||0!==grant.length?void 0:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowHelpText",defaultMessage:"If no fields are granted, then users assigned to this role will not be able to see any data for this index."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"fieldInput"+this.props.formIndex,options:availableFields?availableFields.map(toOption):[],selectedOptions:grant.map(toOption),onCreateOption:this.onCreateGrantedField,onChange:this.onGrantedFieldsChange,isDisabled:this.props.isRoleReadOnly})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.deniedFieldsFormRowLabel",defaultMessage:"Denied fields"}),fullWidth:!0,className:"indexPrivilegeForm__deniedFieldsRow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"deniedFieldInput"+this.props.formIndex,options:availableFields?availableFields.map(toOption):[],selectedOptions:except.map(toOption),onCreateOption:this.onCreateDeniedField,onChange:this.onDeniedFieldsChange,isDisabled:isRoleReadOnly}))))))),allowDocumentLevelSecurity&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null))}),index_privilege_form_defineProperty(this,"getGrantedDocumentsControl",()=>{const{allowDocumentLevelSecurity:allowDocumentLevelSecurity,indexPrivilege:indexPrivilege,isRoleReadOnly:isRoleReadOnly}=this.props;return allowDocumentLevelSecurity?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column"},!this.props.isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{"data-test-subj":"restrictDocumentsQuery"+this.props.formIndex,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantReadPrivilegesLabel",defaultMessage:"Grant read privileges to specific documents"}),compressed:!0,checked:this.state.queryExpanded,onChange:this.toggleDocumentQuery,disabled:isRoleReadOnly})),this.state.queryExpanded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryFormRowLabel",defaultMessage:"Granted documents query"}),fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTextArea,{"data-test-subj":"queryInput"+this.props.formIndex,style:{resize:"none"},fullWidth:!0,value:indexPrivilege.query,onChange:this.onQueryChange,readOnly:this.props.isRoleReadOnly})))):null}),index_privilege_form_defineProperty(this,"toggleDocumentQuery",()=>{const willToggleOff=this.state.queryExpanded,willToggleOn=!willToggleOff;this.setState({queryExpanded:!this.state.queryExpanded,documentQuery:willToggleOff?this.props.indexPrivilege.query:this.state.documentQuery}),willToggleOff&&this.props.onChange({...this.props.indexPrivilege,query:""}),willToggleOn&&!this.props.indexPrivilege.query&&this.state.documentQuery&&this.props.onChange({...this.props.indexPrivilege,query:this.state.documentQuery})}),index_privilege_form_defineProperty(this,"toggleFieldSecurity",()=>{const willToggleOff=this.state.fieldSecurityExpanded,willToggleOn=!willToggleOff,{grant:grant,except:except}=this.getFieldSecurity(this.props.indexPrivilege);this.setState({fieldSecurityExpanded:!this.state.fieldSecurityExpanded,grantedFields:willToggleOff?grant:this.state.grantedFields,exceptedFields:willToggleOff?except:this.state.exceptedFields}),willToggleOff&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:["*"],except:[]}});const hasConfiguredFieldSecurity=this.isFieldSecurityConfigured(this.props.indexPrivilege),hasSavedFieldSecurity=this.state.exceptedFields.length>0||this.state.grantedFields.length>0;willToggleOn&&!hasConfiguredFieldSecurity&&hasSavedFieldSecurity&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:this.state.grantedFields,except:this.state.exceptedFields}})}),index_privilege_form_defineProperty(this,"onCreateIndexPatternOption",option=>{const newIndexPatterns=this.props.indexPrivilege.names.concat([option]);this.props.onChange({...this.props.indexPrivilege,names:newIndexPatterns})}),index_privilege_form_defineProperty(this,"onIndexPatternsChange",newPatterns=>{this.props.onChange({...this.props.indexPrivilege,names:newPatterns.map(fromOption)})}),index_privilege_form_defineProperty(this,"onPrivilegeChange",newPrivileges=>{this.props.onChange({...this.props.indexPrivilege,privileges:newPrivileges.map(fromOption)})}),index_privilege_form_defineProperty(this,"onCreateCustomPrivilege",customPrivilege=>{this.props.onChange({...this.props.indexPrivilege,privileges:[...this.props.indexPrivilege.privileges,customPrivilege]})}),index_privilege_form_defineProperty(this,"onQueryChange",e=>{this.props.onChange({...this.props.indexPrivilege,query:e.target.value})}),index_privilege_form_defineProperty(this,"onCreateGrantedField",grant=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.grant)return;const newGrants=this.props.indexPrivilege.field_security.grant.concat([grant]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:newGrants}})}),index_privilege_form_defineProperty(this,"onGrantedFieldsChange",grantedFields=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:grantedFields.map(fromOption)}})}),index_privilege_form_defineProperty(this,"onCreateDeniedField",except=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.except)return;const newExcepts=this.props.indexPrivilege.field_security.except.concat([except]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:newExcepts}})}),index_privilege_form_defineProperty(this,"onDeniedFieldsChange",deniedFields=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:deniedFields.map(fromOption)}})}),index_privilege_form_defineProperty(this,"getFieldSecurity",indexPrivilege=>{const{grant:grant=[],except:except=[]}=indexPrivilege.field_security||{};return{grant:grant,except:except}}),index_privilege_form_defineProperty(this,"isFieldSecurityConfigured",indexPrivilege=>{const{grant:grant,except:except}=this.getFieldSecurity(indexPrivilege);return except.length>0||grant.length>0&&!external_kbnSharedDeps_Lodash_default.a.isEqual(grant,["*"])});const{grant:_grant,except:_except}=this.getFieldSecurity(props.indexPrivilege);this.state={queryExpanded:!!props.indexPrivilege.query,fieldSecurityExpanded:this.isFieldSecurityConfigured(props.indexPrivilege),grantedFields:_grant,exceptedFields:_except,documentQuery:props.indexPrivilege.query}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{className:"index-privilege-form"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,this.getPrivilegeForm()),!this.props.isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{hasEmptyLabelSpace:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.indexPrivilegeForm.deleteSpacePrivilegeAriaLabel",{defaultMessage:"Delete index privilege"}),color:"danger",onClick:this.props.onDelete,iconType:"trash"})))))}}function index_privileges_extends(){return(index_privileges_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function index_privileges_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class index_privileges_IndexPrivileges extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),index_privileges_defineProperty(this,"addIndexPrivilege",()=>{const{role:role}=this.props,newIndices=[...role.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})}),index_privileges_defineProperty(this,"onIndexPrivilegeChange",privilegeIndex=>updatedPrivilege=>{const{role:role}=this.props,{indices:indices}=role.elasticsearch,newIndices=[...indices];newIndices[privilegeIndex]=updatedPrivilege,this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}}),this.loadAvailableFields(newIndices)}),index_privileges_defineProperty(this,"onIndexPrivilegeDelete",privilegeIndex=>()=>{const{role:role}=this.props,newIndices=[...role.elasticsearch.indices];newIndices.splice(privilegeIndex,1),this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})}),index_privileges_defineProperty(this,"isPlaceholderPrivilege",indexPrivilege=>0===indexPrivilege.names.length),index_privileges_defineProperty(this,"loadFieldsForPattern",async pattern=>{if(!pattern)return{[pattern]:[]};try{return{[pattern]:await this.props.indicesAPIClient.getFields(pattern)}}catch(e){return{[pattern]:[]}}}),this.state={availableFields:{}}}componentDidMount(){this.loadAvailableFields(this.props.role.elasticsearch.indices)}render(){const{indices:indices=[]}=this.props.role.elasticsearch,{indexPatterns:indexPatterns,license:license,availableIndexPrivileges:availableIndexPrivileges}=this.props,{allowRoleDocumentLevelSecurity:allowRoleDocumentLevelSecurity,allowRoleFieldLevelSecurity:allowRoleFieldLevelSecurity}=license.getFeatures(),props={indexPatterns:indexPatterns,allowDocumentLevelSecurity:allowRoleDocumentLevelSecurity||!Object(model.h)(this.props.role),allowFieldLevelSecurity:allowRoleFieldLevelSecurity||!Object(model.h)(this.props.role),isRoleReadOnly:Object(model.i)(this.props.role)},forms=indices.map((indexPrivilege,idx)=>external_kbnSharedDeps_React_default.a.createElement(index_privilege_form_IndexPrivilegeForm,index_privileges_extends({key:idx},props,{formIndex:idx,validator:this.props.validator,availableIndexPrivileges:availableIndexPrivileges,indexPrivilege:indexPrivilege,availableFields:this.state.availableFields[indexPrivilege.names.join(",")],onChange:this.onIndexPrivilegeChange(idx),onDelete:this.onIndexPrivilegeDelete(idx)})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,forms)}loadAvailableFields(privileges){if(Object(model.i)(this.props.role))return;const patterns=privileges.map(index=>index.names.join(",")),cachedPatterns=Object.keys(this.state.availableFields),fetchRequests=external_kbnSharedDeps_Lodash_default.a.difference(patterns,cachedPatterns).map(this.loadFieldsForPattern);Promise.all(fetchRequests).then(response=>{this.setState({availableFields:{...this.state.availableFields,...response.reduce((acc,o)=>({...acc,...o}),{})}})})}}function elasticsearch_privileges_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class elasticsearch_privileges_ElasticsearchPrivileges extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),elasticsearch_privileges_defineProperty(this,"getForm",()=>{const{role:role,indicesAPIClient:indicesAPIClient,docLinks:docLinks,validator:validator,onChange:onChange,editable:editable,indexPatterns:indexPatterns,license:license,builtinESPrivileges:builtinESPrivileges}=this.props,indexProps={role:role,indicesAPIClient:indicesAPIClient,validator:validator,indexPatterns:indexPatterns,license:license,onChange:onChange,availableIndexPrivileges:builtinESPrivileges.index};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescribedFormGroup,{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.clusterPrivilegesTitle",defaultMessage:"Cluster privileges"})),description:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.manageRoleActionsDescription",defaultMessage:"Manage the actions this role can perform against your cluster. "}),this.learnMore(docLinks.links.security.clusterPrivileges))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,hasEmptyLabelSpace:!0},external_kbnSharedDeps_React_default.a.createElement(cluster_privileges_ClusterPrivileges,{role:this.props.role,onChange:this.onClusterPrivilegesChange,builtinClusterPrivileges:builtinESPrivileges.cluster}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescribedFormGroup,{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.runAsPrivilegesTitle",defaultMessage:"Run As privileges"})),description:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.howToBeSubmittedOnBehalfOfOtherUsersDescription",defaultMessage:"Allow requests to be submitted on the behalf of other users. "}),this.learnMore(docLinks.links.security.runAsPrivilege))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{hasEmptyLabelSpace:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{placeholder:this.props.editable?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.elasticSearchPrivileges.addUserTitle",{defaultMessage:"Add a userâ€¦"}):void 0,options:this.props.runAsUsers.map(username=>({id:username,label:username,isGroupLabelOption:!1})),selectedOptions:this.props.role.elasticsearch.run_as.map(u=>({label:u})),onCreateOption:this.onCreateRunAsOption,onChange:this.onRunAsUserChange,isDisabled:!editable}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.indexPrivilegesTitle",defaultMessage:"Index privileges"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.controlAccessToClusterDataDescription",defaultMessage:"Control access to the data in your cluster. "}),this.learnMore(docLinks.links.security.indicesPrivileges))),external_kbnSharedDeps_React_default.a.createElement(index_privileges_IndexPrivileges,indexProps),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,null),this.props.editable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{iconType:"plusInCircleFilled",onClick:this.addIndexPrivilege},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.addIndexPrivilegesButtonLabel",defaultMessage:"Add index privilege"})))}),elasticsearch_privileges_defineProperty(this,"learnMore",href=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{className:"editRole__learnMore",href:href,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.learnMoreLinkText",defaultMessage:"Learn more"}))),elasticsearch_privileges_defineProperty(this,"addIndexPrivilege",()=>{const{role:role}=this.props,newIndices=[...role.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})}),elasticsearch_privileges_defineProperty(this,"onClusterPrivilegesChange",cluster=>{const role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,cluster:cluster}};this.props.onChange(role)}),elasticsearch_privileges_defineProperty(this,"onRunAsUserChange",users=>{const role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:users.map(u=>u.label)}};this.props.onChange(role)}),elasticsearch_privileges_defineProperty(this,"onCreateRunAsOption",option=>{const newRunAsUsers=this.props.role.elasticsearch.run_as.concat(option),role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:newRunAsUsers}};this.props.onChange(role)})}render(){return external_kbnSharedDeps_React_default.a.createElement(collapsible_panel_CollapsiblePanel,{iconType:"logoElasticsearch",title:"Elasticsearch"},this.getForm())}}__webpack_require__(260);const FeatureTableCell=({feature:feature})=>{let tooltipElement=null;if(feature.getPrivilegesTooltip()){const tooltipContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement("p",null,feature.getPrivilegesTooltip()));tooltipElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{iconProps:{className:"eui-alignTop"},type:"iInCircle",color:"subdued",content:tooltipContent})}return external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"featureTableCell"},feature.name," ",tooltipElement)};__webpack_require__(269);function change_all_privileges_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class change_all_privileges_ChangeAllPrivilegesControl extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),change_all_privileges_defineProperty(this,"state",{isPopoverOpen:!1}),change_all_privileges_defineProperty(this,"onSelectPrivilege",privilege=>{this.props.onChange(privilege),this.setState({isPopoverOpen:!1})}),change_all_privileges_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})}),change_all_privileges_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:!1})})}render(){const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{onClick:this.onButtonClick,className:"secPrivilegeFeatureChangeAllLink","data-test-subj":"changeAllPrivilegesButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.changeAllPrivilegesLink",defaultMessage:"Bulk actions"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{size:"s",type:"arrowDown"}))),items=this.props.privileges.map(privilege=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuItem,{key:privilege.id,"data-test-subj":"changeAllPrivileges-"+privilege.id,onClick:()=>{this.onSelectPrivilege(privilege.id)},disabled:this.props.disabled},external_kbnSharedDeps_Lodash_default.a.upperFirst(privilege.id)));return items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuItem,{key:"none","data-test-subj":"changeAllPrivileges-none",onClick:()=>{this.onSelectPrivilege("none")},disabled:this.props.disabled},external_kbnSharedDeps_Lodash_default.a.upperFirst("none"))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"changeAllFeaturePrivilegesPopover",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuPanel,{items:items}))}}const SubFeatureForm=props=>{const groupsWithPrivileges=props.subFeature.getPrivilegeGroups().filter(group=>group.privileges.length>0);return 0===groupsWithPrivileges.length?null:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},props.subFeature.name)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,groupsWithPrivileges.map((function(privilegeGroup,index){switch(privilegeGroup.groupType){case"independent":return function(privilegeGroup,index){return external_kbnSharedDeps_React_default.a.createElement("div",{key:index},privilegeGroup.privileges.map(privilege=>{const isGranted=props.privilegeCalculator.isIndependentSubFeaturePrivilegeGranted(props.featureId,privilege.id,props.privilegeIndex);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCheckbox,{key:privilege.id,id:`${props.featureId}_${privilege.id}`,label:privilege.name,"data-test-subj":"independentSubFeaturePrivilegeControl",onChange:e=>{const{checked:checked}=e.target;checked?props.onChange([...props.selectedFeaturePrivileges,privilege.id]):props.onChange(props.selectedFeaturePrivileges.filter(sp=>sp!==privilege.id))},checked:isGranted,disabled:props.disabled,compressed:!0})}))}(privilegeGroup,index);case"mutually_exclusive":return function(privilegeGroup,index){var _firstSelectedPrivile;const firstSelectedPrivilege=props.privilegeCalculator.getSelectedMutuallyExclusiveSubFeaturePrivilege(props.featureId,privilegeGroup,props.privilegeIndex),options=[...privilegeGroup.privileges.map((privilege,privilegeIndex)=>({id:privilege.id,label:privilege.name,isDisabled:props.disabled}))];return options.push({id:"none",label:"None",isDisabled:props.disabled}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonGroup,{key:index,buttonSize:"compressed","data-test-subj":"mutexSubFeaturePrivilegeControl",options:options,idSelected:null!==(_firstSelectedPrivile=null==firstSelectedPrivilege?void 0:firstSelectedPrivilege.id)&&void 0!==_firstSelectedPrivile?_firstSelectedPrivile:"none",isDisabled:props.disabled,onChange:selectedPrivilegeId=>{const privilegesWithoutGroupEntries=props.selectedFeaturePrivileges.filter(sp=>!privilegeGroup.privileges.some(privilege=>privilege.id===sp));"none"===selectedPrivilegeId?props.onChange(privilegesWithoutGroupEntries):props.onChange([...privilegesWithoutGroupEntries,selectedPrivilegeId])},legend:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.subFeatureForm.controlLegendText",{defaultMessage:"{subFeatureName} sub-feature privilege",values:{subFeatureName:props.subFeature.name}})})}(privilegeGroup,index);default:throw new Error("Unsupported privilege group type: "+privilegeGroup.groupType)}}))))},FeatureTableExpandedRow=({feature:feature,onChange:onChange,privilegeIndex:privilegeIndex,privilegeCalculator:privilegeCalculator,selectedFeaturePrivileges:selectedFeaturePrivileges,disabled:disabled})=>{const[isCustomizing,setIsCustomizing]=Object(external_kbnSharedDeps_React_.useState)(()=>feature.getMinimalFeaturePrivileges().some(p=>selectedFeaturePrivileges.includes(p.id)));Object(external_kbnSharedDeps_React_.useEffect)(()=>{!feature.getMinimalFeaturePrivileges().some(p=>selectedFeaturePrivileges.includes(p.id))&&isCustomizing&&setIsCustomizing(!1)},[feature,isCustomizing,selectedFeaturePrivileges]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.customizeSubFeaturePrivilegesSwitchLabel",defaultMessage:"Customize sub-feature privileges"}),checked:isCustomizing,onChange:e=>{onChange(feature.id,privilegeCalculator.updateSelectedFeaturePrivilegesForCustomization(feature.id,privilegeIndex,e.target.checked)),setIsCustomizing(e.target.checked)},"data-test-subj":"customizeSubFeaturePrivileges",disabled:disabled||!privilegeCalculator.canCustomizeSubFeaturePrivileges(feature.id,privilegeIndex)})),feature.getSubFeatures().map(subFeature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:subFeature.name},external_kbnSharedDeps_React_default.a.createElement(SubFeatureForm,{privilegeCalculator:privilegeCalculator,privilegeIndex:privilegeIndex,featureId:feature.id,subFeature:subFeature,onChange:updatedPrivileges=>onChange(feature.id,updatedPrivileges),selectedFeaturePrivileges:selectedFeaturePrivileges,disabled:disabled||!isCustomizing}))))};function feature_table_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class feature_table_FeatureTable extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),feature_table_defineProperty(this,"featureCategories",new Map),feature_table_defineProperty(this,"renderPrivilegeControlsForFeature",feature=>{const renderFeatureMarkup=(buttonContent,extraAction,warningIcon)=>{var _this$props$role$kiba;const{canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges}=this.props,hasSubFeaturePrivileges=feature.getSubFeaturePrivileges().length>0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},warningIcon),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:"featurePrivilegeControls_"+feature.id,"data-test-subj":"featurePrivilegeControls",buttonContent:buttonContent,extraAction:extraAction,forceState:canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges?void 0:"closed",arrowDisplay:canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges?"left":"none"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"subFeaturePrivilegeExpandedRegion"},external_kbnSharedDeps_React_default.a.createElement(FeatureTableExpandedRow,{feature:feature,privilegeIndex:this.props.privilegeIndex,onChange:this.props.onChange,privilegeCalculator:this.props.privilegeCalculator,selectedFeaturePrivileges:null!==(_this$props$role$kiba=this.props.role.kibana[this.props.privilegeIndex].feature[feature.id])&&void 0!==_this$props$role$kiba?_this$props$role$kiba:[],disabled:this.props.disabled})))))},primaryFeaturePrivileges=feature.getPrimaryFeaturePrivileges();if(feature.reserved&&0===primaryFeaturePrivileges.length){return renderFeatureMarkup(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"empty",size:"l"})," ",external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{style:{maxWidth:200},size:"xs","data-test-subj":"reservedFeatureDescription"},feature.reserved.description),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"empty"}))}if(0===primaryFeaturePrivileges.length)return null;const selectedPrivilegeId=this.props.privilegeCalculator.getDisplayedPrimaryFeaturePrivilegeId(feature.id,this.props.privilegeIndex),options=primaryFeaturePrivileges.map(privilege=>({id:`${feature.id}_${privilege.id}`,label:privilege.name,isDisabled:this.props.disabled}));options.push({id:feature.id+"_none",label:"None",isDisabled:this.props.disabled});let warningIcon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:"empty",content:null});this.props.privilegeCalculator.hasCustomizedSubFeaturePrivileges(feature.id,this.props.privilegeIndex)&&(warningIcon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:"alert",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.privilegeCustomizationTooltip",defaultMessage:"Feature has customized sub-feature privileges. Expand this row for more information."})}));const{canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges}=this.props,hasSubFeaturePrivileges=feature.getSubFeaturePrivileges().length>0,showAccordionArrow=canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges;return renderFeatureMarkup(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,!showAccordionArrow&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"empty",size:"l"})," ",external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonGroup,{name:"featurePrivilege_"+feature.id,"data-test-subj":"primaryFeaturePrivilegeControl",isFullWidth:!0,options:options,idSelected:`${feature.id}_${null!=selectedPrivilegeId?selectedPrivilegeId:"none"}`,onChange:this.onChange(feature.id),legend:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.featureTable.actionLegendText",{defaultMessage:"{featureName} feature privilege",values:{featureName:feature.name}}),style:{minWidth:200}}),warningIcon)}),feature_table_defineProperty(this,"onChange",featureId=>featurePrivilegeId=>{const privilege=featurePrivilegeId.substr((featureId+"_").length);"none"===privilege?this.props.onChange(featureId,[]):this.props.onChange(featureId,[privilege])}),feature_table_defineProperty(this,"onChangeAllFeaturePrivileges",privilege=>{"none"===privilege?this.props.onChangeAll([]):this.props.onChangeAll([privilege])}),feature_table_defineProperty(this,"getCategoryHelpText",category=>{if("management"===category.id)return external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.featureTable.managementCategoryHelpText",{defaultMessage:"Access to Stack Management is determined by both Elasticsearch and Kibana privileges, and cannot be explicitly disabled."})}),props.kibanaPrivileges.getSecuredFeatures().filter(feature=>null!=feature.privileges||null!=feature.reserved).forEach(feature=>{this.featureCategories.has(feature.category.id)||this.featureCategories.set(feature.category.id,[]),this.featureCategories.get(feature.category.id).push(feature)})}render(){const basePrivileges=this.props.kibanaPrivileges.getBasePrivileges(this.props.role.kibana[this.props.privilegeIndex]),accordions=[];return this.featureCategories.forEach(featuresInCategory=>{var _category$order;const{category:category}=featuresInCategory[0],featureCount=featuresInCategory.length,grantedCount=featuresInCategory.filter(feature=>null!=this.props.privilegeCalculator.getEffectivePrimaryFeaturePrivilege(feature.id,this.props.privilegeIndex)).length,buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{"data-test-subj":"featureCategoryButton_"+category.id,alignItems:"center",responsive:!1,gutterSize:"m"},category.euiIconType?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{size:"m",type:category.euiIconType})):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"eui-displayInlineBlock"},category.label)))),label=external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.featureTable.featureAccordionSwitchLabel",{defaultMessage:"{grantedCount} / {featureCount} {featureCount, plural, one {feature} other {features}} granted",values:{grantedCount:grantedCount,featureCount:featureCount}}),extraAction=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s","aria-hidden":"true",color:"subdued","data-test-subj":"categoryLabel"},label),helpText=this.getCategoryHelpText(category),accordion=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:"featureCategory_"+category.id,"data-test-subj":"featureCategory_"+category.id,key:category.id,arrowDisplay:"left",forceState:void 0,buttonContent:buttonContent,extraAction:extraAction},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),helpText&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{iconType:"iInCircle",size:"s"},helpText),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column",gutterSize:"s"},featuresInCategory.map(feature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:feature.id},this.renderPrivilegeControlsForFeature(feature))))));accordions.push({order:null!==(_category$order=category.order)&&void 0!==_category$order?_category$order:Number.MAX_SAFE_INTEGER,element:accordion})}),accordions.sort((a1,a2)=>a1.order-a2.order),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.featureTable.featureVisibilityTitle",{defaultMessage:"Customize feature privileges"})))),!this.props.disabled&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(change_all_privileges_ChangeAllPrivilegesControl,{privileges:basePrivileges,onChange:this.onChangeAllFeaturePrivileges}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,{margin:"m"}),accordions.flatMap((a,idx)=>[a.element,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHorizontalRule,{key:"accordion-hr-"+idx,margin:"m"})]))}}feature_table_defineProperty(feature_table_FeatureTable,"defaultProps",{privilegeIndex:-1,showLocks:!0});class privilege_form_calculator_PrivilegeFormCalculator{constructor(kibanaPrivileges,role){this.kibanaPrivileges=kibanaPrivileges,this.role=role}getBasePrivilege(privilegeIndex){const entry=this.role.kibana[privilegeIndex];return this.kibanaPrivileges.getBasePrivileges(entry).find(bp=>entry.base.includes(bp.id))}getDisplayedPrimaryFeaturePrivilegeId(featureId,privilegeIndex){var _this$getDisplayedPri;return null===(_this$getDisplayedPri=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex))||void 0===_this$getDisplayedPri?void 0:_this$getDisplayedPri.id}hasCustomizedSubFeaturePrivileges(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId),displayedPrimary=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex),formPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([this.role.kibana[privilegeIndex]]);return feature.getSubFeaturePrivileges().some(sfp=>{var _displayedPrimary$gra;const isGranted=formPrivileges.grantsPrivilege(sfp);return isGranted!==(null!==(_displayedPrimary$gra=null==displayedPrimary?void 0:displayedPrimary.grantsPrivilege(sfp))&&void 0!==_displayedPrimary$gra?_displayedPrimary$gra:isGranted)})}getEffectivePrimaryFeaturePrivilege(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId),basePrivilege=this.getBasePrivilege(privilegeIndex),selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);return feature.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).find(fp=>selectedFeaturePrivileges.includes(fp.id)||(null==basePrivilege?void 0:basePrivilege.grantsPrivilege(fp)))}isIndependentSubFeaturePrivilegeGranted(featureId,privilegeId,privilegeIndex){const kibanaPrivilege=this.role.kibana[privilegeIndex],subFeaturePrivilege=this.kibanaPrivileges.getSecuredFeature(featureId).getSubFeaturePrivileges().find(ap=>ap.id===privilegeId);return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([kibanaPrivilege]).grantsPrivilege(subFeaturePrivilege)}getSelectedMutuallyExclusiveSubFeaturePrivilege(featureId,subFeatureGroup,privilegeIndex){const kibanaPrivilege=this.role.kibana[privilegeIndex],assignedPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([kibanaPrivilege]);return subFeatureGroup.privileges.find(p=>assignedPrivileges.grantsPrivilege(p))}canCustomizeSubFeaturePrivileges(featureId,privilegeIndex){const selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);return this.kibanaPrivileges.getSecuredFeature(featureId).getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).some(apfp=>selectedFeaturePrivileges.includes(apfp.id))}updateSelectedFeaturePrivilegesForCustomization(featureId,privilegeIndex,willBeCustomizing){const primary=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex),selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);if(!primary)return selectedFeaturePrivileges;const nextPrivileges=[];if(willBeCustomizing){const startingPrivileges=this.kibanaPrivileges.getSecuredFeature(featureId).getSubFeaturePrivileges().filter(ap=>primary.grantsPrivilege(ap)).map(p=>p.id);nextPrivileges.push(primary.getMinimalPrivilegeId(),...startingPrivileges)}else nextPrivileges.push(primary.id);return nextPrivileges}hasSupersededInheritedPrivileges(privilegeIndex){const global=this.locateGlobalPrivilege(this.role),entry=this.role.kibana[privilegeIndex];if(Object(privilege_utils.a)(entry)||!global)return!1;const globalPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([global]),formPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([entry]),hasAssignedBasePrivileges=this.kibanaPrivileges.getBasePrivileges(entry).some(base=>entry.base.includes(base.id)),featuresWithDirectlyAssignedPrivileges=this.kibanaPrivileges.getSecuredFeatures().filter(feature=>feature.getAllPrivileges().some(privilege=>{var _entry$feature$featur;return null===(_entry$feature$featur=entry.feature[feature.id])||void 0===_entry$feature$featur?void 0:_entry$feature$featur.includes(privilege.id)})),hasSupersededBasePrivileges=hasAssignedBasePrivileges&&this.kibanaPrivileges.getBasePrivileges(entry).some(privilege=>globalPrivileges.grantsPrivilege(privilege)&&!formPrivileges.grantsPrivilege(privilege)),hasSupersededFeaturePrivileges=featuresWithDirectlyAssignedPrivileges.some(feature=>feature.getAllPrivileges().some(fp=>globalPrivileges.grantsPrivilege(fp)&&!formPrivileges.grantsPrivilege(fp)));return hasSupersededBasePrivileges||hasSupersededFeaturePrivileges}getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId),basePrivilege=this.getBasePrivilege(privilegeIndex),selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);return feature.getPrimaryFeaturePrivileges().find(fp=>{const correspondingMinimalPrivilegeId=fp.getMinimalPrivilegeId(),correspendingMinimalPrivilege=feature.getMinimalFeaturePrivileges().find(mp=>mp.id===correspondingMinimalPrivilegeId),hasMinimalPrivileges=feature.subFeatures.length>0&&fp.grantsPrivilege(correspendingMinimalPrivilege);return selectedFeaturePrivileges.includes(fp.id)||hasMinimalPrivileges&&selectedFeaturePrivileges.includes(correspondingMinimalPrivilegeId)||(null==basePrivilege?void 0:basePrivilege.grantsPrivilege(fp))})}getSelectedFeaturePrivileges(featureId,privilegeIndex){var _this$role$kibana$pri;return null!==(_this$role$kibana$pri=this.role.kibana[privilegeIndex].feature[featureId])&&void 0!==_this$role$kibana$pri?_this$role$kibana$pri:[]}locateGlobalPrivilege(role){return role.kibana.find(entry=>Object(privilege_utils.a)(entry))}}class unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning extends external_kbnSharedDeps_React_.Component{constructor(...args){var obj,key,value;super(...args),value=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.unsupportedSpacePrivilegesWarning",defaultMessage:"This role contains privilege definitions for spaces, but spaces are not enabled in Kibana. Saving this role will remove these privileges."}),(key="getMessage")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{iconType:"alert",color:"warning",title:this.getMessage()})}}function simple_privilege_section_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class simple_privilege_section_SimplePrivilegeSection extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),simple_privilege_section_defineProperty(this,"getDisplayedBasePrivilege",()=>{if(this.state.isCustomizingGlobalPrivilege)return"custom";const{role:role}=this.props,form=this.locateGlobalPrivilege(role);return form&&form.base.length>0?form.base[0]:"none"}),simple_privilege_section_defineProperty(this,"onKibanaPrivilegeChange",privilege=>{const role=Object(model.c)(this.props.role),form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);"none"===privilege?role.kibana=role.kibana.filter(entry=>!Object(privilege_utils.a)(entry)):"custom"===privilege?form.base=[]:(form.base=[privilege],form.feature={}),this.props.onChange(role),this.setState({isCustomizingGlobalPrivilege:"custom"===privilege,globalPrivsIndex:role.kibana.indexOf(form)})}),simple_privilege_section_defineProperty(this,"onFeaturePrivilegeChange",(featureId,privileges)=>{const role=Object(model.c)(this.props.role),form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);privileges.length>0?form.feature[featureId]=[...privileges]:delete form.feature[featureId],this.props.onChange(role)}),simple_privilege_section_defineProperty(this,"onChangeAllFeaturePrivileges",privileges=>{const role=Object(model.c)(this.props.role),form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);privileges.length>0?this.props.kibanaPrivileges.getSecuredFeatures().forEach(feature=>{form.feature[feature.id]=[...privileges]}):form.feature={},this.props.onChange(role)}),simple_privilege_section_defineProperty(this,"maybeRenderSpacePrivilegeWarning",()=>this.props.role.kibana.some(privilege=>!Object(privilege_utils.a)(privilege))?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning,null)):null),simple_privilege_section_defineProperty(this,"locateGlobalPrivilegeIndex",role=>role.kibana.findIndex(privileges=>Object(privilege_utils.a)(privileges))),simple_privilege_section_defineProperty(this,"locateGlobalPrivilege",role=>role.kibana.find(privileges=>Object(privilege_utils.a)(privileges)));const globalPrivs=this.locateGlobalPrivilege(props.role),globalPrivsIndex=this.locateGlobalPrivilegeIndex(props.role);this.state={isCustomizingGlobalPrivilege:Boolean(globalPrivs&&Object.keys(globalPrivs.feature).length>0),globalPrivsIndex:globalPrivsIndex}}render(){var _this$props$role$kiba,_this$props$role$kiba2;const kibanaPrivilege=this.getDisplayedBasePrivilege(),reservedPrivileges=null!==(_this$props$role$kiba=null===(_this$props$role$kiba2=this.props.role.kibana[this.state.globalPrivsIndex])||void 0===_this$props$role$kiba2?void 0:_this$props$role$kiba2._reserved)&&void 0!==_this$props$role$kiba?_this$props$role$kiba:[],title=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.kibanaPrivilegesTitle",defaultMessage:"Kibana privileges"}),description=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.specifyPrivilegeForRoleDescription",defaultMessage:"Specifies the Kibana privilege for this role."}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued"},description)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:title},reservedPrivileges.length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{fullWidth:!0,selectedOptions:reservedPrivileges.map(rp=>({label:rp})),isDisabled:!0}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSuperSelect,{disabled:!this.props.editable,onChange:this.onKibanaPrivilegeChange,options:[{value:"none",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeInput",defaultMessage:"None"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdown",defaultMessage:"None"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdownDescription",defaultMessage:"No access to Kibana"})))},{value:"custom",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeInput",defaultMessage:"Custom"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdown",defaultMessage:"Custom"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdownDescription",defaultMessage:"Customize access to Kibana"})))},{value:"read",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeInput",defaultMessage:"Read"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdown",defaultMessage:"Read"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdownDescription",defaultMessage:"Grants read-only access to all of Kibana"})))},{value:"all",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeInput",defaultMessage:"All"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdown",defaultMessage:"All"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdownDescription",defaultMessage:"Grants full access to all of Kibana"})))}],hasDividers:!0,valueOfSelected:kibanaPrivilege})),this.state.isCustomizingGlobalPrivilege&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(feature_table_FeatureTable,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.onFeaturePrivilegeChange,onChangeAll:this.onChangeAllFeaturePrivileges,privilegeIndex:this.props.role.kibana.findIndex(k=>Object(privilege_utils.a)(k)),canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges})),this.maybeRenderSpacePrivilegeWarning())))}createGlobalPrivilegeEntry(role){const newEntry={spaces:["*"],base:[],feature:{}};return role.kibana.push(newEntry),newEntry}}class privilege_summary_calculator_PrivilegeSummaryCalculator{constructor(kibanaPrivileges,role){this.kibanaPrivileges=kibanaPrivileges,this.role=role}getEffectiveFeaturePrivileges(entry){const assignedPrivileges=this.collectAssignedPrivileges(entry);return this.kibanaPrivileges.getSecuredFeatures().reduce((acc,feature)=>{const displayedPrimaryFeaturePrivilege=this.getDisplayedPrimaryFeaturePrivilege(assignedPrivileges,feature),effectiveSubPrivileges=feature.getSubFeaturePrivileges().filter(ap=>assignedPrivileges.grantsPrivilege(ap)),hasCustomizedSubFeaturePrivileges=this.hasCustomizedSubFeaturePrivileges(feature,displayedPrimaryFeaturePrivilege,entry);return{...acc,[feature.id]:{primary:displayedPrimaryFeaturePrivilege,hasCustomizedSubFeaturePrivileges:hasCustomizedSubFeaturePrivileges,subFeature:effectiveSubPrivileges.map(p=>p.id)}}},{})}hasCustomizedSubFeaturePrivileges(feature,displayedPrimaryFeaturePrivilege,entry){const formPrivileges=this.collectAssignedPrivileges(entry);return feature.getSubFeaturePrivileges().some(sfp=>{var _displayedPrimaryFeat;const isGranted=formPrivileges.grantsPrivilege(sfp);return isGranted!==(null!==(_displayedPrimaryFeat=null==displayedPrimaryFeaturePrivilege?void 0:displayedPrimaryFeaturePrivilege.grantsPrivilege(sfp))&&void 0!==_displayedPrimaryFeat?_displayedPrimaryFeat:isGranted)})}getDisplayedPrimaryFeaturePrivilege(assignedPrivileges,feature){const primaryFeaturePrivileges=feature.getPrimaryFeaturePrivileges(),minimalPrimaryFeaturePrivileges=feature.getMinimalFeaturePrivileges(),hasMinimalPrivileges=feature.subFeatures.length>0;return primaryFeaturePrivileges.find(pfp=>{const isPrimaryGranted=assignedPrivileges.grantsPrivilege(pfp);if(!isPrimaryGranted&&hasMinimalPrivileges){const correspondingMinimal=minimalPrimaryFeaturePrivileges.find(mpfp=>mpfp.id===pfp.getMinimalPrivilegeId());return assignedPrivileges.grantsPrivilege(correspondingMinimal)}return isPrimaryGranted})}collectAssignedPrivileges(entry){if(Object(privilege_utils.a)(entry))return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([entry]);const globalPrivilege=this.locateGlobalPrivilege(this.role);return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges(globalPrivilege?[globalPrivilege,entry]:[entry])}locateGlobalPrivilege(role){return role.kibana.find(entry=>Object(privilege_utils.a)(entry))}}const PrivilegeSummaryExpandedRow=props=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"column"},props.feature.getSubFeatures().map(subFeature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:subFeature.name,"data-test-subj":"subFeatureEntry"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s","data-test-subj":"subFeatureName"},subFeature.name)),props.effectiveFeaturePrivileges.map((privs,index)=>{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:index,"data-test-subj":"entry-"+index},subFeature.getPrivilegeGroups().map((effectiveSubFeaturePrivileges=privs.subFeature,(privilegeGroup,index)=>{switch(privilegeGroup.groupType){case"independent":return function(effectiveSubFeaturePrivileges,privilegeGroup,index){return external_kbnSharedDeps_React_default.a.createElement("div",{key:index},privilegeGroup.privileges.map(privilege=>{const isGranted=effectiveSubFeaturePrivileges.includes(privilege.id);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s","data-test-subj":"independentPrivilege",key:privilege.id},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:isGranted?"check":"cross",color:isGranted?"primary":"danger",content:isGranted?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeGrantedIconTip",{defaultMessage:"Privilege is granted"}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeNotGrantedIconTip",{defaultMessage:"Privilege is not granted"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s","data-test-subj":"privilegeName"},privilege.name)))}))}(effectiveSubFeaturePrivileges,privilegeGroup,index);case"mutually_exclusive":return function(effectiveSubFeaturePrivileges,privilegeGroup,index){var _privilegeGroup$privi;const firstSelectedPrivilege=null===(_privilegeGroup$privi=privilegeGroup.privileges.find(p=>effectiveSubFeaturePrivileges.includes(p.id)))||void 0===_privilegeGroup$privi?void 0:_privilegeGroup$privi.name;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"s",key:index,"data-test-subj":"mutexPrivilege"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:firstSelectedPrivilege?"check":"cross",color:firstSelectedPrivilege?"primary":"danger",content:firstSelectedPrivilege?"Privilege is granted":"Privilege is not granted"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s","data-test-subj":"privilegeName"},null!=firstSelectedPrivilege?firstSelectedPrivilege:"None")))}(effectiveSubFeaturePrivileges,privilegeGroup,index);default:throw new Error("Unsupported privilege group type: "+privilegeGroup.groupType)}})));var effectiveSubFeaturePrivileges})))));__webpack_require__(278);var spaces_common_=__webpack_require__(80);function spaces_popover_list_extends(){return(spaces_popover_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function spaces_popover_list_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class spaces_popover_list_SpacesPopoverList extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),spaces_popover_list_defineProperty(this,"state",{searchTerm:"",allowSpacesListFocus:!1,isPopoverOpen:!1}),spaces_popover_list_defineProperty(this,"getMenuPanel",()=>{const{searchTerm:searchTerm}=this.state,items=this.getVisibleSpaces(searchTerm).map(this.renderSpaceMenuItem),panelProps={className:"spcMenu",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacesPopoverList.popoverTitle",{defaultMessage:"Spaces"}),watchedItemProps:["data-search-term"]};return this.props.spaces.length>=spaces_common_.SPACE_SEARCH_COUNT_THRESHOLD?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuPanel,panelProps,this.renderSearchField(),this.renderSpacesListPanel(items,searchTerm)):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuPanel,spaces_popover_list_extends({},panelProps,{items:items}))}),spaces_popover_list_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen,searchTerm:""})}),spaces_popover_list_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:!1,searchTerm:""})}),spaces_popover_list_defineProperty(this,"getVisibleSpaces",searchTerm=>{const{spaces:spaces}=this.props;let filteredSpaces=spaces;return searchTerm&&(filteredSpaces=spaces.filter(space=>{const{name:name,description:description=""}=space;return name.toLowerCase().indexOf(searchTerm)>=0||description.toLowerCase().indexOf(searchTerm)>=0})),filteredSpaces}),spaces_popover_list_defineProperty(this,"renderSpacesListPanel",(items,searchTerm)=>0===items.length?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued",className:"eui-textCenter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacesPopoverList.noSpacesFoundTitle",defaultMessage:" no spaces found "})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuPanel,{key:"spcMenuList","data-search-term":searchTerm,className:"spcMenu__spacesList",hasFocus:this.state.allowSpacesListFocus,initialFocusedItemIndex:this.state.allowSpacesListFocus?0:void 0,items:items})),spaces_popover_list_defineProperty(this,"renderSearchField",()=>external_kbnSharedDeps_React_default.a.createElement("div",{key:"manageSpacesSearchField",className:"spcMenu__searchFieldWrapper"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldSearch,{placeholder:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacesPopoverList.findSpacePlaceholder",{defaultMessage:"Find a space"}),incremental:!0,onSearch:this.onSearch,onKeyDown:this.onSearchKeyDown,onFocus:this.onSearchFocus,compressed:!0}))),spaces_popover_list_defineProperty(this,"onSearchKeyDown",e=>{const keyCode=e.keyCode;[9,13,40].includes(keyCode)&&this.setState({allowSpacesListFocus:!0})}),spaces_popover_list_defineProperty(this,"onSearchFocus",()=>{this.setState({allowSpacesListFocus:!1})}),spaces_popover_list_defineProperty(this,"onSearch",searchTerm=>{this.setState({searchTerm:searchTerm.trim().toLowerCase()})}),spaces_popover_list_defineProperty(this,"renderSpaceMenuItem",space=>{const LazySpaceAvatar=Object(external_kbnSharedDeps_React_.memo)(this.props.spacesApiUi.components.getSpaceAvatar),icon=external_kbnSharedDeps_React_default.a.createElement(LazySpaceAvatar,{space:space,size:"s"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenuItem,{key:space.id,icon:icon,toolTipTitle:space.description&&space.name,toolTipContent:space.description},space.name)})}render(){const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",onClick:this.onButtonClick},external_kbnSharedDeps_React_default.a.createElement("span",{className:"secSpacesPopoverList__buttonText"},this.props.buttonText));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"spacesPopoverList",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft",ownFocus:!0},this.getMenuPanel())}}const SpaceColumnHeader=props=>{const{spacesApiUi:spacesApiUi}=props,isGlobal=Object(privilege_utils.a)(props.entry),entrySpaces=props.entry.spaces.map(spaceId=>{var _props$spaces$find;return null!==(_props$spaces$find=props.spaces.find(s=>s.id===spaceId))&&void 0!==_props$spaces$find?_props$spaces$find:{id:spaceId,name:spaceId,disabledFeatures:[]}}),LazySpaceAvatar=Object(external_kbnSharedDeps_React_.useMemo)(()=>spacesApiUi.components.getSpaceAvatar,[spacesApiUi]);return external_kbnSharedDeps_React_default.a.createElement("div",null,entrySpaces.slice(0,4).map(space=>external_kbnSharedDeps_React_default.a.createElement("span",{key:space.id},external_kbnSharedDeps_React_default.a.createElement(LazySpaceAvatar,{size:"s",space:space})," ",isGlobal&&external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeMatrix.globalSpaceName",defaultMessage:"All Spaces"})))),entrySpaces.length>4&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(spaces_popover_list_SpacesPopoverList,{spaces:entrySpaces,buttonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeMatrix.showNMoreSpacesLink",{defaultMessage:"+{count} more",values:{count:entrySpaces.length-4}}),spacesApiUi:spacesApiUi})))};function getColumnKey(entry){return"privilege_entry_"+entry.spaces.join("|")}const PrivilegeSummaryTable=props=>{const[expandedFeatures,setExpandedFeatures]=Object(external_kbnSharedDeps_React_.useState)([]),featureCategories=Object(external_kbnSharedDeps_React_.useMemo)(()=>{const featureCategoryMap=new Map;return props.kibanaPrivileges.getSecuredFeatures().filter(feature=>null!=feature.privileges||null!=feature.reserved).forEach(feature=>{featureCategoryMap.has(feature.category.id)||featureCategoryMap.set(feature.category.id,[]),featureCategoryMap.get(feature.category.id).push(feature)}),featureCategoryMap},[props.kibanaPrivileges]),calculator=new privilege_summary_calculator_PrivilegeSummaryCalculator(props.kibanaPrivileges,props.role),featureColumn={name:"Feature",field:"feature",render:feature=>external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature})},rowExpanderColumn={align:"right",width:"40px",isExpander:!0,field:"featureId",name:"",render:(featureId,record)=>record.feature.getSubFeaturePrivileges().length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:()=>(featureId=>{expandedFeatures.includes(featureId)?setExpandedFeatures(expandedFeatures.filter(ef=>ef!==featureId)):setExpandedFeatures([...expandedFeatures,featureId])})(featureId),"data-test-subj":"expandPrivilegeSummaryRow","aria-label":expandedFeatures.includes(featureId)?"Collapse":"Expand",iconType:expandedFeatures.includes(featureId)?"arrowUp":"arrowDown"}):null},rawKibanaPrivileges=[...props.role.kibana].sort((entry1,entry2)=>Object(privilege_utils.a)(entry1)?-1:Object(privilege_utils.a)(entry2)?1:0),privilegeColumns=rawKibanaPrivileges.map(entry=>{const key=getColumnKey(entry);return{name:external_kbnSharedDeps_React_default.a.createElement(SpaceColumnHeader,{entry:entry,spaces:props.spaces,spacesApiUi:props.spacesApiUi}),field:key,render:(kibanaPrivilege,record)=>{var _primary$name;const{primary:primary,hasCustomizedSubFeaturePrivileges:hasCustomizedSubFeaturePrivileges}=kibanaPrivilege[record.featureId];let iconTip=null;return iconTip=hasCustomizedSubFeaturePrivileges?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{size:"s",type:"iInCircle",content:external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.additionalPrivilegesGrantedIconTip",defaultMessage:"Additional privileges granted. Expand this row for more information."}))}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{size:"s",type:"empty"}),external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"privilegeColumn "+(hasCustomizedSubFeaturePrivileges?"additionalPrivilegesGranted":"")},null!==(_primary$name=null==primary?void 0:primary.name)&&void 0!==_primary$name?_primary$name:"None"," ",iconTip)}}}),columns=[];props.canCustomizeSubFeaturePrivileges&&columns.push(rowExpanderColumn),columns.push(featureColumn,...privilegeColumns);const privileges=rawKibanaPrivileges.reduce((acc,entry)=>({...acc,[getColumnKey(entry)]:calculator.getEffectiveFeaturePrivileges(entry)}),{}),accordions=[];return featureCategories.forEach(featuresInCategory=>{const{category:category}=featuresInCategory[0],buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{"data-test-subj":"featureCategoryButton_"+category.id,alignItems:"center",responsive:!1,gutterSize:"m"},category.euiIconType?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{size:"m",type:category.euiIconType})):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"eui-displayInlineBlock"},category.label)))),categoryItems=featuresInCategory.map(feature=>({feature:feature,featureId:feature.id,...privileges}));accordions.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:"privilegeSummaryFeatureCategory_"+category.id,"data-test-subj":"privilegeSummaryFeatureCategory_"+category.id,key:category.id,buttonContent:buttonContent,initialIsOpen:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{columns:columns,items:categoryItems,itemId:"featureId",rowProps:record=>({"data-test-subj":"summaryTableRow-"+record.featureId}),itemIdToExpandedRowMap:expandedFeatures.reduce((acc,featureId)=>({...acc,[featureId]:external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummaryExpandedRow,{feature:props.kibanaPrivileges.getSecuredFeature(featureId),effectiveFeaturePrivileges:Object.values(privileges).map(p=>p[featureId])})}),{})})))}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,accordions.map((a,idx)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,{key:idx},a,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null))))},PrivilegeSummary=props=>{const[isOpen,setIsOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),flyoutSize=props.role.kibana.length>5?"l":"m";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:()=>setIsOpen(!0),"data-test-subj":"viewPrivilegeSummaryButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.viewSummaryButtonText",defaultMessage:"View privilege summary"})),isOpen&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiOverlayMask,{headerZindexLocation:"below"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyout,{onClose:()=>setIsOpen(!1),size:flyoutSize},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.modalHeaderTitle",defaultMessage:"Privilege summary"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutBody,null,external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummaryTable,{role:props.role,spaces:props.spaces,kibanaPrivileges:props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:props.canCustomizeSubFeaturePrivileges,spacesApiUi:props.spacesApiUi})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:()=>setIsOpen(!1)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.closeSummaryButtonText",defaultMessage:"Close"}))))))};var spaces_public_=__webpack_require__(76);function space_selector_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const spaceToOption=(space,currentSelection)=>{if(space)return{id:"spaceOption_"+space.id,label:space.name,color:Object(spaces_public_.getSpaceColor)(space),disabled:"global"===currentSelection&&"*"!==space.id||"spaces"===currentSelection&&"*"===space.id}};class space_selector_SpaceSelector extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),space_selector_defineProperty(this,"onChange",selectedSpaces=>{this.props.onChange(selectedSpaces.map(s=>s.id.split("spaceOption_")[1]))}),space_selector_defineProperty(this,"getOptions",()=>this.props.spaces.map(space=>spaceToOption(space,this.props.selectedSpaceIds.includes("*")?"global":this.props.selectedSpaceIds.length>0?"spaces":void 0)).filter(Boolean)),space_selector_defineProperty(this,"getSelectedOptions",()=>{var spaces;return this.props.selectedSpaceIds.map((spaces=this.props.spaces,s=>spaceToOption(spaces.find(space=>space.id===s)))).filter(Boolean)})}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{"data-test-subj":"spaceSelectorComboBox","aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spaceSelectorLabel",{defaultMessage:"Spaces"}),fullWidth:!0,options:this.getOptions(),renderOption:(option,searchValue,contentClassName)=>{const{color:color,label:label}=option;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHealth,{color:color},external_kbnSharedDeps_React_default.a.createElement("span",{className:contentClassName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiHighlight,{search:searchValue},label)))},selectedOptions:this.getSelectedOptions(),isDisabled:this.props.disabled,onChange:this.onChange})}}function privilege_space_form_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class privilege_space_form_PrivilegeSpaceForm extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),privilege_space_form_defineProperty(this,"getForm",()=>{const{spaces:spaces}=this.props,hasSelectedSpaces=this.state.selectedSpaceIds.length>0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormLabel",{defaultMessage:"Spaces"}),helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormHelpText",{defaultMessage:"Select one or more Kibana spaces to which you wish to assign privileges."})},external_kbnSharedDeps_React_default.a.createElement(space_selector_SpaceSelector,{selectedSpaceIds:this.state.selectedSpaceIds,onChange:this.onSelectedSpacesChange,spaces:spaces})),this.getPrivilegeCallout(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0,label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormLabel",{defaultMessage:"Privileges for all features"}),helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormHelpText",{defaultMessage:"Assign the privilege level you wish to grant to all present and future features across this space."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonGroup,{name:"basePrivilegeButtonGroup","data-test-subj":"basePrivilegeButtonGroup",isFullWidth:!0,color:"primary",options:[{id:"basePrivilege_all",label:"All","data-test-subj":"basePrivilege_all"},{id:"basePrivilege_read",label:"Read","data-test-subj":"basePrivilege_read"},{id:"basePrivilege_custom",label:"Customize","data-test-subj":"basePrivilege_custom"}],idSelected:this.getDisplayedBasePrivilege(),isDisabled:!hasSelectedSpaces,onChange:this.onSpaceBasePrivilegeChange,legend:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.basePrivilegeControlLegend",{defaultMessage:"Privileges for all features"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,this.getFeatureListLabel(this.state.selectedBasePrivilege.length>0))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,this.getFeatureListDescription(this.state.selectedBasePrivilege.length>0))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(feature_table_FeatureTable,{role:this.state.role,privilegeCalculator:this.state.privilegeCalculator,onChange:this.onFeaturePrivilegesChange,onChangeAll:this.onChangeAllFeaturePrivileges,kibanaPrivileges:this.props.kibanaPrivileges,privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,disabled:this.state.selectedBasePrivilege.length>0||!hasSelectedSpaces}),this.requiresGlobalPrivilegeWarning()&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"globalPrivilegeWarning",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeWarning",defaultMessage:"Creating a global privilege might impact your other space privileges."})})))}),privilege_space_form_defineProperty(this,"getSaveButton",()=>{const{mode:mode}=this.state,isGlobal=this.isDefiningGlobalPrivilege();let buttonText;switch(mode){case"create":buttonText=isGlobal?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createGlobalPrivilegeButton",defaultMessage:"Create global privilege"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createPrivilegeButton",defaultMessage:"Add Kibana privilege"});break;case"update":buttonText=isGlobal?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updateGlobalPrivilegeButton",defaultMessage:"Update global privilege"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updatePrivilegeButton",defaultMessage:"Update space privilege"});break;default:throw new Error("Unsupported mode: "+mode)}let buttonColor="primary";return this.requiresGlobalPrivilegeWarning()&&(buttonColor="warning"),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:this.onSaveClick,fill:!0,disabled:!this.canSave(),color:buttonColor,"data-test-subj":"createSpacePrivilegeButton"},buttonText)}),privilege_space_form_defineProperty(this,"getFeatureListLabel",disabled=>disabled?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.summaryOfFeaturePrivileges",{defaultMessage:"Summary of feature privileges"}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivileges",{defaultMessage:"Customize by feature"})),privilege_space_form_defineProperty(this,"getFeatureListDescription",disabled=>disabled?external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.featurePrivilegeSummaryDescription",{defaultMessage:"Some features might be hidden by the space or affected by a global space privilege."}):external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivilegeDescription",{defaultMessage:"Increase privilege levels on a per feature basis. Some features might be hidden by the space or affected by a global space privilege."})),privilege_space_form_defineProperty(this,"getPrivilegeCallout",()=>this.isDefiningGlobalPrivilege()?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"primary",iconType:"iInCircle",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeNotice",{defaultMessage:"These privileges will apply to all current and future spaces."})})):null),privilege_space_form_defineProperty(this,"closeFlyout",()=>{this.props.onCancel()}),privilege_space_form_defineProperty(this,"onSaveClick",()=>{const role=Object(model.c)(this.state.role),form=role.kibana[this.state.privilegeIndex];this.isDefiningGlobalPrivilege()||(form.spaces=form.spaces.filter(spaceId=>this.props.spaces.find(space=>space.id===spaceId))),this.props.onChange(role)}),privilege_space_form_defineProperty(this,"onSelectedSpacesChange",selectedSpaceIds=>{const role=Object(model.c)(this.state.role);role.kibana[this.state.privilegeIndex].spaces=[...selectedSpaceIds],this.setState({selectedSpaceIds:selectedSpaceIds,role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})}),privilege_space_form_defineProperty(this,"onSpaceBasePrivilegeChange",basePrivilege=>{const role=Object(model.c)(this.state.role),form=role.kibana[this.state.privilegeIndex],privilegeName=basePrivilege.split("basePrivilege_")[1];let isCustomizingFeaturePrivileges=!1;"custom"===privilegeName?(form.base=[],isCustomizingFeaturePrivileges=!0):(form.base=[privilegeName],form.feature={}),this.setState({selectedBasePrivilege:"custom"===privilegeName?[]:[privilegeName],role:role,isCustomizingFeaturePrivileges:isCustomizingFeaturePrivileges,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})}),privilege_space_form_defineProperty(this,"getDisplayedBasePrivilege",()=>{const basePrivilege=this.state.privilegeCalculator.getBasePrivilege(this.state.privilegeIndex);return basePrivilege?"basePrivilege_"+basePrivilege.id:"basePrivilege_custom"}),privilege_space_form_defineProperty(this,"onFeaturePrivilegesChange",(featureId,privileges)=>{const role=Object(model.c)(this.state.role),form=role.kibana[this.state.privilegeIndex];0===privileges.length?delete form.feature[featureId]:form.feature[featureId]=[...privileges],this.setState({role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})}),privilege_space_form_defineProperty(this,"onChangeAllFeaturePrivileges",privileges=>{const role=Object(model.c)(this.state.role),entry=role.kibana[this.state.privilegeIndex];0===privileges.length?entry.feature={}:this.props.kibanaPrivileges.getSecuredFeatures().forEach(feature=>{const nextFeaturePrivilege=feature.getPrimaryFeaturePrivileges().find(pfp=>privileges.includes(pfp.id));nextFeaturePrivilege&&(entry.feature[feature.id]=[nextFeaturePrivilege.id])}),this.setState({role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})}),privilege_space_form_defineProperty(this,"canSave",()=>{if(0===this.state.selectedSpaceIds.length)return!1;const form=this.state.role.kibana[this.state.privilegeIndex];return 0!==form.base.length||0!==Object.keys(form.feature).length}),privilege_space_form_defineProperty(this,"isDefiningGlobalPrivilege",()=>this.state.selectedSpaceIds.includes("*")),privilege_space_form_defineProperty(this,"requiresGlobalPrivilegeWarning",()=>{const hasOtherSpacePrivilegesDefined=this.props.role.kibana.length>0;return"create"===this.state.mode&&this.isDefiningGlobalPrivilege()&&hasOtherSpacePrivilegesDefined});const _role=Object(model.c)(props.role);let privilegeIndex=props.privilegeIndex;privilegeIndex<0&&(privilegeIndex=_role.kibana.push({spaces:[],base:[],feature:{}})-1),this.state={role:_role,privilegeIndex:privilegeIndex,selectedSpaceIds:[..._role.kibana[privilegeIndex].spaces],selectedBasePrivilege:[..._role.kibana[privilegeIndex].base||[]],mode:props.privilegeIndex<0?"create":"update",isCustomizingFeaturePrivileges:!1,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(props.kibanaPrivileges,_role)}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiOverlayMask,{headerZindexLocation:"below"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyout,{onClose:this.closeFlyout,size:"m",maxWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutHeader,{hasBorder:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.modalTitle",defaultMessage:"Kibana privileges"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiErrorBoundary,null,this.getForm())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutFooter,null,this.state.privilegeCalculator.hasSupersededInheritedPrivileges(this.state.privilegeIndex)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"spaceFormGlobalPermissionsSupersedeWarning",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarningTitle",defaultMessage:"Superseded by global privileges"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarning",defaultMessage:"Declared privileges are less permissive than configured global privileges. View the privilege summary to see effective privileges."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left","data-test-subj":"cancelSpacePrivilegeButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.cancelButton",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},this.getSaveButton())))))}}privilege_space_form_defineProperty(privilege_space_form_PrivilegeSpaceForm,"defaultProps",{privilegeIndex:-1});__webpack_require__(287);const PrivilegeDisplay=props=>external_kbnSharedDeps_React_default.a.createElement(SimplePrivilegeDisplay,props),SimplePrivilegeDisplay=props=>{const{privilege:privilege,...rest}=props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,rest,function(privilege){const privileges=function(privilege){if(void 0===privilege)return[];if(Array.isArray(privilege))return privilege;return[privilege]}(privilege);let displayValue;displayValue=0===privileges.length||1===privileges.length&&privileges.includes("none")?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{color:"subdued",type:"minusInCircle"}):privileges.map(p=>external_kbnSharedDeps_Lodash_default.a.upperFirst(p)).join(", ");return displayValue}(privilege))};function privilege_space_table_extends(){return(privilege_space_table_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function privilege_space_table_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}PrivilegeDisplay.defaultProps={privilege:[]};class privilege_space_table_PrivilegeSpaceTable extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),privilege_space_table_defineProperty(this,"state",{expandedSpacesGroups:[]}),privilege_space_table_defineProperty(this,"renderKibanaPrivileges",()=>{const{privilegeCalculator:privilegeCalculator,displaySpaces:displaySpaces}=this.props,rows=this.getSortedPrivileges().map((spacePrivs,privilegeIndex)=>({spaces:spacePrivs.spaces.map(spaceId=>displaySpaces.find(space=>space.id===spaceId)||{id:spaceId,name:spaceId,disabledFeatures:[],deleted:!0}),privilegeIndex:privilegeIndex,isGlobal:Object(privilege_utils.a)(spacePrivs),privileges:{spaces:spacePrivs.spaces,base:spacePrivs.base||[],feature:spacePrivs.feature||{},reserved:spacePrivs._reserved||[]}})),columns=[{field:"spaces",name:"Spaces",width:"60%",render:(spaces,record)=>{const isExpanded=this.state.expandedSpacesGroups.includes(record.privilegeIndex),displayedSpaces=isExpanded?spaces:spaces.slice(0,4);let button=null;return spaces.length>displayedSpaces.length?button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(record.privilegeIndex)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showNMoreSpacesLink",defaultMessage:"+{count} more",values:{count:spaces.length-displayedSpaces.length}})):isExpanded&&(button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(record.privilegeIndex)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showLessSpacesLink",defaultMessage:"show less"}))),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"spacesColumn"},displayedSpaces.map(space=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiBadge,privilege_space_table_extends({key:space.id},(space=>space.deleted?{iconType:"trash"}:{})(space),{color:Object(spaces_public_.getSpaceColor)(space)}),space.name))),button)}},{field:"privileges",name:"Privileges",render:(privileges,record)=>{var _privilegeCalculator$,_privilegeCalculator$2;if(privileges.reserved.length>0)return external_kbnSharedDeps_React_default.a.createElement(PrivilegeDisplay,{privilege:privileges.reserved,"data-test-subj":"privilegeColumn"});let icon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"empty",size:"s"});return privilegeCalculator.hasSupersededInheritedPrivileges(record.privilegeIndex)&&(icon=external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"spaceTablePrivilegeSupersededWarning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:"alert",size:"s",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.supersededPrivilegeWarning",defaultMessage:"Privileges are superseded by configured global privilege. View the privilege summary to see effective privileges."})}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},icon),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(PrivilegeDisplay,{privilege:null!==(_privilegeCalculator$=null===(_privilegeCalculator$2=privilegeCalculator.getBasePrivilege(record.privilegeIndex))||void 0===_privilegeCalculator$2?void 0:_privilegeCalculator$2.id)&&void 0!==_privilegeCalculator$?_privilegeCalculator$:"custom","data-test-subj":"privilegeColumn"})))}}];return this.props.disabled||columns.push({name:"Actions",actions:[{render:record=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.editPrivilegesLabel",{defaultMessage:"Edit privileges for the following spaces: {spaceNames}.",values:{spaceNames:record.spaces.map(s=>s.name).join(", ")}}),color:"primary",iconType:"pencil",onClick:()=>this.props.onEdit(record.privilegeIndex)})},{render:record=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.deletePrivilegesLabel",{defaultMessage:"Delete privileges for the following spaces: {spaceNames}.",values:{spaceNames:record.spaces.map(s=>s.name).join(", ")}}),color:"danger",iconType:"trash",onClick:()=>this.onDeleteSpacePrivilege(record)})}]}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{columns:columns,items:rows,hasActions:!0,rowProps:item=>({className:Object(privilege_utils.a)(item.privileges)?"secPrivilegeTable__row--isGlobalSpace":""})})}),privilege_space_table_defineProperty(this,"getSortedPrivileges",()=>this.props.role.kibana.sort((priv1,priv2)=>Object(privilege_utils.a)(priv1)?-1:Object(privilege_utils.a)(priv2)?1:0)),privilege_space_table_defineProperty(this,"toggleExpandSpacesGroup",privilegeIndex=>{this.state.expandedSpacesGroups.includes(privilegeIndex)?this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter(i=>i!==privilegeIndex)}):this.setState({expandedSpacesGroups:[...this.state.expandedSpacesGroups,privilegeIndex]})}),privilege_space_table_defineProperty(this,"onDeleteSpacePrivilege",item=>{const roleCopy=Object(model.c)(this.props.role);roleCopy.kibana.splice(item.privilegeIndex,1),this.props.onChange(roleCopy),this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter(i=>i!==item.privilegeIndex)})})}render(){return this.renderKibanaPrivileges()}}function space_aware_privilege_section_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class space_aware_privilege_section_SpaceAwarePrivilegeSection extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),space_aware_privilege_section_defineProperty(this,"globalSpaceEntry",{id:"*",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.spaceAwarePrivilegeForm.globalSpacesName",{defaultMessage:"* All Spaces"}),color:"#D3DAE6",initials:"*",disabledFeatures:[]}),space_aware_privilege_section_defineProperty(this,"renderKibanaPrivileges",()=>{const{role:role}=this.props;if(role.kibana.length>0){const table=external_kbnSharedDeps_React_default.a.createElement(privilege_space_table_PrivilegeSpaceTable,{role:this.props.role,displaySpaces:this.getDisplaySpaces(),privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.props.onChange,onEdit:this.onEditSpacesPrivileges,disabled:!this.props.editable});return external_kbnSharedDeps_React_default.a.createElement("div",null,table,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),this.getAvailablePrivilegeButtons(!0))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{iconType:"lock",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.noAccessToKibanaTitle",defaultMessage:"This role does not grant access to Kibana"})),titleSize:"s",actions:this.getAvailablePrivilegeButtons(!1)})}),space_aware_privilege_section_defineProperty(this,"getAvailablePrivilegeButtons",hasPrivilegesAssigned=>{const hasAvailableSpaces=this.getAvailableSpaces().length>0;if(!hasAvailableSpaces&&!hasPrivilegesAssigned)return null;const addPrivilegeButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{color:"primary",onClick:this.addSpacePrivilege,iconType:"plusInCircleFilled","data-test-subj":"addSpacePrivilegeButton",isDisabled:!hasAvailableSpaces||!this.props.editable},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.addSpacePrivilegeButton",defaultMessage:"Add Kibana privilege"}));if(!hasPrivilegesAssigned)return addPrivilegeButton;const viewMatrixButton=external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummary,{role:this.props.role,spaces:this.getDisplaySpaces(),kibanaPrivileges:this.props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,spacesApiUi:this.props.spacesApiUi});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},addPrivilegeButton),hasPrivilegesAssigned&&!Object(model.j)(this.props.role)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},viewMatrixButton))}),space_aware_privilege_section_defineProperty(this,"getDisplaySpaces",()=>[this.globalSpaceEntry,...this.props.spaces]),space_aware_privilege_section_defineProperty(this,"getAvailableSpaces",(includeSpacesFromPrivilegeIndex=-1)=>{const spacesToExclude=external_kbnSharedDeps_Lodash_default.a.uniq(external_kbnSharedDeps_Lodash_default.a.flatten(this.props.role.kibana.map((entry,index)=>includeSpacesFromPrivilegeIndex===index?[]:entry.spaces)));return this.getDisplaySpaces().filter(displaySpace=>!spacesToExclude.includes(displaySpace.id))}),space_aware_privilege_section_defineProperty(this,"addSpacePrivilege",()=>{this.setState({showSpacePrivilegeEditor:!0,privilegeIndex:-1})}),space_aware_privilege_section_defineProperty(this,"onSpacesPrivilegeChange",role=>{this.setState({showSpacePrivilegeEditor:!1,privilegeIndex:-1}),this.props.onChange(role)}),space_aware_privilege_section_defineProperty(this,"onEditSpacesPrivileges",privilegeIndex=>{this.setState({privilegeIndex:privilegeIndex,showSpacePrivilegeEditor:!0})}),space_aware_privilege_section_defineProperty(this,"onCancelEditPrivileges",()=>{this.setState({showSpacePrivilegeEditor:!1})}),this.state={showSpacePrivilegeEditor:!1,showPrivilegeMatrix:!1,role:null,privilegeIndex:-1}}render(){const{uiCapabilities:uiCapabilities}=this.props;return uiCapabilities.spaces.manage?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiErrorBoundary,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,this.renderKibanaPrivileges(),this.state.showSpacePrivilegeEditor&&external_kbnSharedDeps_React_default.a.createElement(privilege_space_form_PrivilegeSpaceForm,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,onChange:this.onSpacesPrivilegeChange,onCancel:this.onCancelEditPrivileges,spaces:this.getAvailableSpaces(this.state.privilegeIndex),privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges}))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.insufficientPrivilegesDescription",defaultMessage:"Insufficient Privileges"})),iconType:"alert",color:"danger","data-test-subj":"userCannotManageSpacesCallout"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.howToViewAllAvailableSpacesDescription",defaultMessage:"You are not authorized to view all available spaces."})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.ensureAccountHasAllPrivilegesGrantedDescription",defaultMessage:"Please ensure your account has all privileges granted by the {kibanaAdmin} role, and try again.",values:{kibanaAdmin:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.kibanaAdminTitle",defaultMessage:"kibana_admin"}))}})))}}class transform_error_section_TransformErrorSection extends external_kbnSharedDeps_React_.PureComponent{render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiEmptyPrompt,{color:"danger",iconType:"alert",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionTitle",defaultMessage:"Malformed role"})),body:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionDescription",defaultMessage:"This role definition is invalid, and cannot be edited through this screen."}))})}}class kibana_privileges_region_KibanaPrivilegesRegion extends external_kbnSharedDeps_React_.Component{constructor(...args){var obj,key,value;super(...args),value=()=>{const{kibanaPrivileges:kibanaPrivileges,role:role,spacesEnabled:spacesEnabled,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges,spaces:spaces=[],uiCapabilities:uiCapabilities,onChange:onChange,editable:editable,validator:validator,spacesApiUi:spacesApiUi}=this.props;return role._transform_error&&role._transform_error.includes("kibana")?external_kbnSharedDeps_React_default.a.createElement(transform_error_section_TransformErrorSection,null):spacesEnabled?external_kbnSharedDeps_React_default.a.createElement(space_aware_privilege_section_SpaceAwarePrivilegeSection,{kibanaPrivileges:kibanaPrivileges,role:role,spaces:spaces,uiCapabilities:uiCapabilities,onChange:onChange,editable:editable,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges,validator:validator,spacesApiUi:spacesApiUi}):external_kbnSharedDeps_React_default.a.createElement(simple_privilege_section_SimplePrivilegeSection,{kibanaPrivileges:kibanaPrivileges,role:role,onChange:onChange,editable:editable,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges})},(key="getForm")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}render(){return external_kbnSharedDeps_React_default.a.createElement(collapsible_panel_CollapsiblePanel,{iconType:"logoKibana",title:"Kibana"},this.getForm())}}const ReservedRoleBadge=props=>{const{role:role}=props;return Object(model.j)(role)?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{"data-test-subj":"reservedRoleBadgeTooltip",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.reversedRoleBadge.reservedRolesCanNotBeModifiedTooltip",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{style:{verticalAlign:"super"},type:"lock"})):null};var constants=__webpack_require__(18);class validate_role_RoleValidator{constructor(options={}){var obj,key,value;value=void 0,(key="shouldValidate")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.shouldValidate=options.shouldValidate}enableValidation(){this.shouldValidate=!0}disableValidation(){this.shouldValidate=!1}validateRoleName(role){return this.shouldValidate?role.name?role.name.length>constants.d?invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.nameLengthWarningMessage",{defaultMessage:"Name must not exceed {maxLength} characters.",values:{maxLength:constants.d}})):role.name.trim()!==role.name?invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.nameWhitespaceWarningMessage",{defaultMessage:"Name must not contain leading or trailing spaces."})):role.name.match(constants.e)?{isInvalid:!1}:invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.nameAllowedCharactersWarningMessage",{defaultMessage:"Name must contain only letters, numbers, spaces, punctuation and printable symbols."})):invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.provideRoleNameWarningMessage",{defaultMessage:"Please provide a role name."})):{isInvalid:!1}}validateIndexPrivileges(role){if(!this.shouldValidate)return{isInvalid:!1};if(!Array.isArray(role.elasticsearch.indices))throw new TypeError(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.indicesTypeErrorMessage",{defaultMessage:"Expected {elasticIndices} to be an array",values:{elasticIndices:'"role.elasticsearch.indices"'}}));return null==role.elasticsearch.indices.map(indexPriv=>this.validateIndexPrivilege(indexPriv)).find(result=>result.isInvalid)?{isInvalid:!1}:invalid()}validateIndexPrivilege(indexPrivilege){return this.shouldValidate&&indexPrivilege.names.length&&!indexPrivilege.privileges.length?invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.onePrivilegeRequiredWarningMessage",{defaultMessage:"At least one privilege is required"})):{isInvalid:!1}}validateSelectedSpaces(spaceIds,privilege){return this.shouldValidate&&privilege?Array.isArray(spaceIds)&&spaceIds.length>0?{isInvalid:!1}:invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.oneSpaceRequiredWarningMessage",{defaultMessage:"At least one space is required"})):{isInvalid:!1}}validateSelectedPrivilege(spaceIds,privilege){return this.shouldValidate&&spaceIds&&0!==spaceIds.length?privilege?{isInvalid:!1}:invalid(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.validateRole.privilegeRequiredWarningMessage",{defaultMessage:"Privilege is required"})):{isInvalid:!1}}validateSpacePrivileges(role){if(!this.shouldValidate)return{isInvalid:!1};return(role.kibana||[]).every(assignedPrivilege=>assignedPrivilege.base.length>0||Object.keys(assignedPrivilege.feature).length>0)?{isInvalid:!1}:invalid()}validateForSave(role){const{isInvalid:isNameInvalid}=this.validateRoleName(role),{isInvalid:areIndicesInvalid}=this.validateIndexPrivileges(role),{isInvalid:areSpacePrivilegesInvalid}=this.validateSpacePrivileges(role);return isNameInvalid||areIndicesInvalid||areSpacePrivilegesInvalid?invalid():{isInvalid:!1}}}function invalid(error){return{isInvalid:!0,error:error}}function edit_role_page_extends(){return(edit_role_page_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const EditRolePage=({userAPIClient:userAPIClient,indexPatterns:indexPatterns,rolesAPIClient:rolesAPIClient,indicesAPIClient:indicesAPIClient,privilegesAPIClient:privilegesAPIClient,getFeatures:getFeatures,http:http,roleName:roleName,action:action,fatalErrors:fatalErrors,license:license,docLinks:docLinks,uiCapabilities:uiCapabilities,notifications:notifications,history:history,spacesApiUi:spacesApiUi})=>{const backToRoleList=Object(external_kbnSharedDeps_React_.useCallback)(()=>history.push("/"),[history]),{current:validator}=Object(external_kbnSharedDeps_React_.useRef)(new validate_role_RoleValidator({shouldValidate:!1})),[formError,setFormError]=Object(external_kbnSharedDeps_React_.useState)(null),runAsUsers=function(userAPIClient,fatalErrors){const[userNames,setUserNames]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{userAPIClient.getUsers().then(users=>setUserNames(users.map(user=>user.username)),err=>fatalErrors.add(err))},[fatalErrors,userAPIClient]),userNames}(userAPIClient,fatalErrors),indexPatternsTitles=function(indexPatterns,fatalErrors,notifications){const[indexPatternsTitles,setIndexPatternsTitles]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{indexPatterns.getTitles().catch(err=>{var _err$response;if(403===(null===(_err$response=err.response)||void 0===_err$response?void 0:_err$response.status))return notifications.toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.noIndexPatternsPermission",{defaultMessage:"You need permission to access the list of available index patterns."})}),[];throw fatalErrors.add(err),err}).then(titles=>setIndexPatternsTitles(titles.filter(Boolean)))},[fatalErrors,indexPatterns,notifications]),indexPatternsTitles}(indexPatterns,fatalErrors,notifications),privileges=function(privilegesAPIClient,fatalErrors){const[privileges,setPrivileges]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{Promise.all([privilegesAPIClient.getAll({includeActions:!0}),privilegesAPIClient.getBuiltIn()]).then(([kibanaPrivileges,builtInESPrivileges])=>setPrivileges([kibanaPrivileges,builtInESPrivileges]),err=>fatalErrors.add(err))},[privilegesAPIClient,fatalErrors]),privileges}(privilegesAPIClient,fatalErrors),spaces=function(http,fatalErrors){const[spaces,setSpaces]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{http.get("/api/spaces/space").then(fetchedSpaces=>setSpaces({enabled:!0,list:fetchedSpaces}),err=>{var _err$response3;404===(null===(_err$response3=err.response)||void 0===_err$response3?void 0:_err$response3.status)?setSpaces({enabled:!1,list:[]}):fatalErrors.add(err)})},[http,fatalErrors]),spaces}(http,fatalErrors),features=function(getFeatures,fatalErrors){const[features,setFeatures]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{getFeatures().catch(err=>{var _err$response4;if(403===(null===(_err$response4=err.response)||void 0===_err$response4?void 0:_err$response4.status))return[];fatalErrors.add(err)}).then(retrievedFeatures=>{setFeatures(retrievedFeatures)})},[fatalErrors,getFeatures]),features}(getFeatures,fatalErrors),[role,setRole]=function(rolesAPIClient,fatalErrors,notifications,license,action,backToRoleList,roleName){const[role,setRole]=Object(external_kbnSharedDeps_React_.useState)(null);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{(roleName?rolesAPIClient.getRole(roleName):Promise.resolve({name:"",elasticsearch:{cluster:[],indices:[],run_as:[]},kibana:[],_unrecognized_applications:[]})).then(fetchedRole=>{if("clone"===action&&Object(model.j)(fetchedRole))backToRoleList();else{if(0===fetchedRole.elasticsearch.indices.length){const emptyOption={names:[],privileges:[]},{allowRoleDocumentLevelSecurity:allowRoleDocumentLevelSecurity,allowRoleFieldLevelSecurity:allowRoleFieldLevelSecurity}=license.getFeatures();allowRoleFieldLevelSecurity&&(emptyOption.field_security={grant:["*"],except:[]}),allowRoleDocumentLevelSecurity&&(emptyOption.query=""),fetchedRole.elasticsearch.indices.push(emptyOption)}setRole("clone"===action?Object(model.l)(fetchedRole):Object(model.c)(fetchedRole))}}).catch(err=>{var _err$response2;404===(null===(_err$response2=err.response)||void 0===_err$response2?void 0:_err$response2.status)?(notifications.toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.roles.roleNotFound",{defaultMessage:'No "{roleName}" role found.',values:{roleName:roleName}})}),backToRoleList()):fatalErrors.add(err)})},[roleName,action,fatalErrors,rolesAPIClient,notifications,license,backToRoleList]),[role,setRole]}(rolesAPIClient,fatalErrors,notifications,license,action,backToRoleList,roleName);if(!(role&&runAsUsers&&indexPatternsTitles&&privileges&&spaces&&features))return null;const isEditingExistingRole=!!roleName&&"edit"===action,isRoleReadOnly=Object(model.i)(role),isRoleReserved=Object(model.j)(role),isDeprecatedRole=Object(model.g)(role),[kibanaPrivileges,builtInESPrivileges]=privileges,onNameChange=e=>setRole({...role,name:e.target.value}),onRoleChange=newRole=>setRole(newRole),getReturnToRoleListButton=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,edit_role_page_extends({},Object(public_.reactRouterNavigate)(history,""),{"data-test-subj":"roleFormReturnButton"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.returnToRoleListButtonLabel",defaultMessage:"Return to role list"})),getSaveButton=()=>{const saveText=isEditingExistingRole?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.updateRoleText",defaultMessage:"Update role"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.createRoleText",defaultMessage:"Create role"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{"data-test-subj":"roleFormSaveButton",fill:!0,onClick:saveRole,disabled:isRoleReserved},saveText)},getCancelButton=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{"data-test-subj":"roleFormCancelButton",onClick:backToRoleList},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.cancelButtonLabel",defaultMessage:"Cancel"})),saveRole=async()=>{validator.enableValidation();const result=validator.validateForSave(role);if(result.isInvalid)setFormError(result);else{setFormError(null);try{await rolesAPIClient.saveRole({role:role,spacesEnabled:spaces.enabled})}catch(error){var _error$body$message,_error$body;return void notifications.toasts.addDanger(null!==(_error$body$message=null==error||null===(_error$body=error.body)||void 0===_error$body?void 0:_error$body.message)&&void 0!==_error$body$message?_error$body$message:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.errorSavingRoleError",{defaultMessage:"Error saving role"}))}notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.roleSuccessfullySavedNotificationMessage",{defaultMessage:"Saved role"})),backToRoleList()}},handleDeleteRole=async()=>{try{await rolesAPIClient.deleteRole(role.name)}catch(error){var _error$data$message,_error$data;return void notifications.toasts.addDanger(null!==(_error$data$message=null==error||null===(_error$data=error.data)||void 0===_error$data?void 0:_error$data.message)&&void 0!==_error$data$message?_error$data$message:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.errorDeletingRoleError",{defaultMessage:"Error deleting role"}))}notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.security.management.editRole.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role"})),backToRoleList()},description=spaces.enabled?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.setPrivilegesToKibanaSpacesDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to your Kibana spaces."}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.setPrivilegesToKibanaDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to Kibana."});return external_kbnSharedDeps_React_default.a.createElement("div",{className:"editRolePage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,formError,(()=>{let titleText;const props={tabIndex:0};return isRoleReserved?(titleText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.viewingRoleTitle",defaultMessage:"Viewing role"}),props["aria-describedby"]="reservedRoleDescription"):titleText=isEditingExistingRole?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.editRoleTitle",defaultMessage:"Edit role"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.createRoleTitle",defaultMessage:"Create role"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h1",props,titleText," ",external_kbnSharedDeps_React_default.a.createElement(ReservedRoleBadge,{role:role})))})(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},description),isRoleReserved&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",{id:"reservedRoleDescription",tabIndex:0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.modifyingReversedRolesDescription",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})))),isDeprecatedRole&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:Object(model.d)(role),color:"warning",iconType:"alert"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPanel,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,edit_role_page_extends({label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowTitle",defaultMessage:"Role name"}),helpText:!isRoleReserved&&isEditingExistingRole?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowHelpText",defaultMessage:"A role's name cannot be changed once it has been created."}):void 0},validator.validateRoleName(role)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{name:"name",value:role.name||"",onChange:onNameChange,"data-test-subj":"roleFormNameInput",readOnly:isRoleReserved||isEditingExistingRole}))),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(elasticsearch_privileges_ElasticsearchPrivileges,{role:role,editable:!isRoleReadOnly,indicesAPIClient:indicesAPIClient,onChange:onRoleChange,runAsUsers:runAsUsers,validator:validator,indexPatterns:indexPatternsTitles,builtinESPrivileges:builtInESPrivileges,license:license,docLinks:docLinks})),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),external_kbnSharedDeps_React_default.a.createElement(kibana_privileges_region_KibanaPrivilegesRegion,{kibanaPrivileges:new kibana_privileges_KibanaPrivileges(kibanaPrivileges,features),spaces:spaces.list,spacesEnabled:spaces.enabled,uiCapabilities:uiCapabilities,canCustomizeSubFeaturePrivileges:license.getFeatures().allowSubFeaturePrivileges,editable:!isRoleReadOnly,role:role,onChange:onRoleChange,validator:validator,spacesApiUi:spacesApiUi})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,null),isRoleReadOnly?getReturnToRoleListButton():external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},getSaveButton()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},getCancelButton()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!0}),isEditingExistingRole&&!isRoleReadOnly?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(delete_role_button_DeleteRoleButton,{canDelete:!0,onDelete:handleDeleteRole})):null)))}}}]);