/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[13],{139:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"i",(function(){return tooltipProps})),__webpack_require__.d(__webpack_exports__,"d",(function(){return NUM_BUCKETS})),__webpack_require__.d(__webpack_exports__,"f",(function(){return TIME_LABELS})),__webpack_require__.d(__webpack_exports__,"j",(function(){return useDateFormatter})),__webpack_require__.d(__webpack_exports__,"k",(function(){return yAxisFormatter})),__webpack_require__.d(__webpack_exports__,"h",(function(){return getDomain})),__webpack_require__.d(__webpack_exports__,"g",(function(){return getChartTheme})),__webpack_require__.d(__webpack_exports__,"a",(function(){return ChartContainer})),__webpack_require__.d(__webpack_exports__,"e",(function(){return NoDataState})),__webpack_require__.d(__webpack_exports__,"c",(function(){return LoadingState})),__webpack_require__.d(__webpack_exports__,"b",(function(){return ErrorState}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_elastic_charts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61),lodash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(24),moment__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50),moment__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_3__),_kbn_i18n__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1),_elastic_eui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(10),_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14),_common_formatters_number__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9);const tooltipProps={headerFormatter:tooltipValue=>moment__WEBPACK_IMPORTED_MODULE_3___default()(tooltipValue.value).format("Y-MM-DD HH:mm:ss")},NUM_BUCKETS=20,TIME_LABELS={s:_kbn_i18n__WEBPACK_IMPORTED_MODULE_4__.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:_kbn_i18n__WEBPACK_IMPORTED_MODULE_4__.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:_kbn_i18n__WEBPACK_IMPORTED_MODULE_4__.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:_kbn_i18n__WEBPACK_IMPORTED_MODULE_4__.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},useDateFormatter=(xMin,xMax)=>Object(react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>"number"==typeof xMin&&"number"==typeof xMax?Object(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__.niceTimeFormatter)([xMin,xMax]):value=>""+value,[xMin,xMax]),yAxisFormatter=_common_formatters_number__WEBPACK_IMPORTED_MODULE_7__.a,getDomain=(series,stacked=!1)=>{let min=null,max=null;const valuesByTimestamp=series.reduce((acc,serie)=>(serie.points.forEach(point=>{const valuesForTimestamp=acc[point.timestamp]||[];acc[point.timestamp]=[...valuesForTimestamp,point.value]}),acc),{});Object.values(valuesByTimestamp).forEach(results=>{const maxResult=stacked?Object(lodash__WEBPACK_IMPORTED_MODULE_2__.sum)(results):Object(lodash__WEBPACK_IMPORTED_MODULE_2__.max)(results),minResult=Object(lodash__WEBPACK_IMPORTED_MODULE_2__.min)(results);maxResult&&(!max||maxResult>max)&&(max=maxResult),minResult&&(!min||minResult<min)&&(min=minResult)});const timestampValues=Object.keys(valuesByTimestamp).map(Number),minTimestamp=Object(lodash__WEBPACK_IMPORTED_MODULE_2__.min)(timestampValues)||0,maxTimestamp=Object(lodash__WEBPACK_IMPORTED_MODULE_2__.max)(timestampValues)||0;return{yMin:min||0,yMax:max||0,xMin:minTimestamp,xMax:maxTimestamp}},getChartTheme=isDarkMode=>isDarkMode?_elastic_charts__WEBPACK_IMPORTED_MODULE_1__.DARK_THEME:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__.LIGHT_THEME,EmptyContainer=({children:children})=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},children),ChartContainer=({children:children})=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{style:{width:"100%",height:150}},children),NoDataState=()=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(EmptyContainer,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_5__.EuiText,{color:"subdued","data-test-subj":"noChartData"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_6__.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),LoadingState=()=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(EmptyContainer,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_5__.EuiText,{color:"subdued","data-test-subj":"loadingData"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_6__.FormattedMessage,{id:"xpack.infra.alerts.charts.loadingMessage",defaultMessage:"Loading"}))),ErrorState=()=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(EmptyContainer,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_5__.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_6__.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},207:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ThresholdAnnotations}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),_elastic_charts__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61),_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(19),_common_color_palette__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(86);const ThresholdAnnotations=({threshold:threshold,sortedThresholds:sortedThresholds,comparator:comparator,color:color,id:id,firstTimestamp:firstTimestamp,lastTimestamp:lastTimestamp,domain:domain})=>{if(!comparator||!threshold)return null;const isAbove=[_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.GT,_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.GT_OR_EQ].includes(comparator),isBelow=[_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.LT,_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.LT_OR_EQ].includes(comparator);return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.LineAnnotation,{id:id+"-thresholds",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:sortedThresholds.map(t=>({dataValue:t})),style:{line:{strokeWidth:2,stroke:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:1}}}),2===sortedThresholds.length&&comparator===_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.BETWEEN?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.RectAnnotation,{id:id+"-lower-threshold","data-test-subj":"between-rect",style:{fill:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:.3},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold),y1:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.last)(threshold)}}]})):null,2===sortedThresholds.length&&comparator===_server_lib_alerting_metric_threshold_types__WEBPACK_IMPORTED_MODULE_3__.a.OUTSIDE_RANGE?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.RectAnnotation,{id:id+"-lower-threshold","data-test-subj":"outside-range-lower-rect",style:{fill:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:.3},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:domain.min,y1:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold)}}]}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.RectAnnotation,{id:id+"-upper-threshold","data-test-subj":"outside-range-upper-rect",style:{fill:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:.3},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.last)(threshold),y1:domain.max}}]})):null,isBelow&&null!=Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold)?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.RectAnnotation,{id:id+"-upper-threshold","data-test-subj":"below-rect",style:{fill:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:.3},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:domain.min,y1:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold)}}]}):null,isAbove&&null!=Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold)?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_2__.RectAnnotation,{id:id+"-upper-threshold","data-test-subj":"above-rect",style:{fill:Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_4__.b)(color),opacity:.3},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(lodash__WEBPACK_IMPORTED_MODULE_1__.first)(threshold),y1:domain.max}}]}):null)}},211:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AlertPreview}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),external_kbnSharedDeps_Lodash_=__webpack_require__(24),external_kbnSharedDeps_React_=__webpack_require__(2),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(10),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(14),public_=__webpack_require__(3),formatters=__webpack_require__(33),get_interval_in_seconds=__webpack_require__(206),metrics=__webpack_require__(131);const AlertPreview=props=>{var _previewError$body;const{alertParams:alertParams,alertInterval:alertInterval,alertThrottle:alertThrottle,alertNotifyWhen:alertNotifyWhen,alertType:alertType,validate:validate,showNoDataResults:showNoDataResults,groupByDisplayName:groupByDisplayName}=props,{http:http}=Object(public_.useKibana)().services,[previewLookbackInterval,setPreviewLookbackInterval]=Object(external_kbnSharedDeps_React_.useState)("h"),[isPreviewLoading,setIsPreviewLoading]=Object(external_kbnSharedDeps_React_.useState)(!1),[previewError,setPreviewError]=Object(external_kbnSharedDeps_React_.useState)(!1),[previewResult,setPreviewResult]=Object(external_kbnSharedDeps_React_.useState)(null),onSelectPreviewLookbackInterval=Object(external_kbnSharedDeps_React_.useCallback)(e=>{setPreviewLookbackInterval(e.target.value)},[]),onClickPreview=Object(external_kbnSharedDeps_React_.useCallback)(async()=>{setIsPreviewLoading(!0),setPreviewResult(null),setPreviewError(!1);try{const result=await async function({fetch:fetch,params:params,alertType:alertType}){return await fetch(""+metrics.c,{method:"POST",body:JSON.stringify({...params,alertType:alertType})})}({fetch:http.fetch,params:{...alertParams,lookback:previewLookbackInterval,alertInterval:alertInterval,alertThrottle:alertThrottle,alertNotifyWhen:alertNotifyWhen,alertOnNoData:null!=showNoDataResults&&showNoDataResults},alertType:alertType});setPreviewResult({...result,groupByDisplayName:groupByDisplayName,previewLookbackInterval:previewLookbackInterval,alertThrottle:alertThrottle})}catch(e){setPreviewError(e)}finally{setIsPreviewLoading(!1)}},[alertParams,alertInterval,alertType,alertNotifyWhen,groupByDisplayName,previewLookbackInterval,alertThrottle,showNoDataResults,http]),previewIntervalError=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(get_interval_in_seconds.a)(alertInterval)>=Object(get_interval_in_seconds.a)("1"+previewLookbackInterval),[previewLookbackInterval,alertInterval]),isPreviewDisabled=Object(external_kbnSharedDeps_React_.useMemo)(()=>{if(!alertParams.criteria)return!1;const validationResult=validate({criteria:alertParams.criteria});return Object.values(validationResult.errors).some(result=>Object.values(result).some(arr=>Array.isArray(arr)&&arr.length))||previewIntervalError},[alertParams.criteria,previewIntervalError,validate]),showNumberOfNotifications=Object(external_kbnSharedDeps_React_.useMemo)(()=>{if(!previewResult)return!1;if("onActiveAlert"===alertNotifyWhen)return!1;const{notifications:notifications,fired:fired,noData:noData,error:error}=previewResult.resultTotals;return fired+(showNoDataResults?noData+error:0)>notifications},[previewResult,showNoDataResults,alertNotifyWhen]),hasWarningThreshold=Object(external_kbnSharedDeps_React_.useMemo)(()=>{var _alertParams$criteria,_alertParams$criteria2;return null!==(_alertParams$criteria=null===(_alertParams$criteria2=alertParams.criteria)||void 0===_alertParams$criteria2?void 0:_alertParams$criteria2.some(c=>Reflect.has(c,"warningThreshold")))&&void 0!==_alertParams$criteria&&_alertParams$criteria},[alertParams]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.previewLabel",{defaultMessage:"Preview"}),fullWidth:!0,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSelect,{id:"selectPreviewLookbackInterval",value:previewLookbackInterval,onChange:onSelectPreviewLookbackInterval,options:previewDOMOptions})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{isLoading:isPreviewLoading,isDisabled:isPreviewDisabled,onClick:onClickPreview},external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.testAlertCondition",{defaultMessage:"Test alert condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"})),previewResult&&!previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(PreviewTextString,{previewResult:previewResult,hasWarningThreshold:Boolean(hasWarningThreshold)})},showNoDataResults&&previewResult.resultTotals.noData?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewNoDataResult",defaultMessage:"There {wereWas} {boldedResultsNumber} of no data.",values:{wereWas:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.wereWas",defaultMessage:"{plurality, plural, one {was} other {were}}",values:{plurality:previewResult.resultTotals.noData}}),boldedResultsNumber:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.alertPreviewNoDataResultNumber",{defaultMessage:"{noData, plural, one {# result} other {# results}}",values:{noData:previewResult.resultTotals.noData}}))}}):null," ",previewResult.resultTotals.error?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorResult",defaultMessage:"An error occurred when trying to evaluate some of the data."}):null,showNumberOfNotifications?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewTotalNotifications",defaultMessage:'As a result, this alert would have sent {notifications} based on the selected "notify" setting of "{alertThrottle}."',values:{alertThrottle:"onThrottleInterval"===alertNotifyWhen?previewResult.alertThrottle:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.alertPreviewOnlyOnStatusChange",{defaultMessage:"Only on status change"}),notifications:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.alertPreviewTotalNotificationsNumber",{defaultMessage:"{notifs, plural, one {# notification} other {# notifications}}",values:{notifs:previewResult.resultTotals.notifications}}))}})):null," ")),previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortTitle",defaultMessage:"Not enough data"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortDescription",defaultMessage:"Try selecting a longer preview length, or increase the amount of time in the {checkEvery} field.",values:{checkEvery:external_kbnSharedDeps_React_default.a.createElement("strong",null,"check every")}}))),previewError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),508===(null===(_previewError$body=previewError.body)||void 0===_previewError$body?void 0:_previewError$body.statusCode)?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorTitle",defaultMessage:"Too much data (>{maxBuckets} results)",values:{maxBuckets:formatters.a.number(previewError.body.message)}}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorDescription",defaultMessage:"Try selecting a shorter preview length, or increase the amount of time in the {forTheLast} field.",values:{forTheLast:external_kbnSharedDeps_React_default.a.createElement("strong",null,"FOR THE LAST")}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewError",defaultMessage:"An error occurred when trying to preview this alert condition"}),color:"danger",iconType:"alert"},previewError.body&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorDesc",defaultMessage:"Please try again later or see details for more information."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiAccordion,{id:"alertErrorDetailsAccordion",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.errorDetails",defaultMessage:"Details"})))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCodeBlock,null,previewError.body.message)))))))},PreviewTextString=({previewResult:previewResult,hasWarningThreshold:hasWarningThreshold})=>{var _previewOptions$find;const instanceCount=hasWarningThreshold?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewResultWithSeverityLevels",defaultMessage:"There {wereWas} {criticalInstances} that satisfied the {boldCritical} conditions, and {warningInstances} that satisfied the {boldWarning} conditions of this alert",values:{wereWas:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.wereWas",defaultMessage:"{plurality, plural, one {was} other {were}}",values:{plurality:previewResult.resultTotals.fired}}),criticalInstances:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.firedTimes",defaultMessage:"{fired, plural, one {# instance} other {# instances}}",values:{fired:previewResult.resultTotals.fired}})),warningInstances:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.firedTimes",defaultMessage:"{fired, plural, one {# instance} other {# instances}}",values:{fired:previewResult.resultTotals.warning}})),boldCritical:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.boldCritical",defaultMessage:"critical"})),boldWarning:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.boldWarning",defaultMessage:"warning"}))}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewResultInstances",defaultMessage:"There {wereWas} {firedTimes} that satisfied the conditions of this alert",values:{wereWas:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.wereWas",defaultMessage:"{plurality, plural, one {was} other {were}}",values:{plurality:previewResult.resultTotals.fired}}),firedTimes:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.firedTimes",defaultMessage:"{fired, plural, one {# instance} other {# instances}}",values:{fired:previewResult.resultTotals.fired}}))}}),groupByText=previewResult.groupByDisplayName?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroupBy",defaultMessage:"across {groups}",values:{groups:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroups",defaultMessage:"{numberOfGroups, plural, one {# {groupName}} other {# {groupName}s}}",values:{numberOfGroups:previewResult.numberOfGroups,groupName:previewResult.groupByDisplayName}}))}})," "):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null),lookbackText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewLookback",defaultMessage:"in the last {lookback}",values:{lookback:null===(_previewOptions$find=previewOptions.find(e=>e.value===previewResult.previewLookbackInterval))||void 0===_previewOptions$find?void 0:_previewOptions$find.shortText}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.alertPreviewResultText",defaultMessage:"{instanceCount} {groupByWithConditionalTrailingSpace}{lookbackText}.",values:{instanceCount:instanceCount,groupByWithConditionalTrailingSpace:groupByText,lookbackText:lookbackText}})},previewOptions=[{value:"h",text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),shortText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"})},{value:"d",text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),shortText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"})},{value:"w",text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),shortText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"})},{value:"M",text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),shortText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})}],previewDOMOptions=previewOptions.map(o=>Object(external_kbnSharedDeps_Lodash_.omit)(o,"shortText"));external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})},564:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"defaultExpression",(function(){return defaultExpression})),__webpack_require__.d(__webpack_exports__,"Expressions",(function(){return Expressions})),__webpack_require__.d(__webpack_exports__,"ExpressionRow",(function(){return ExpressionRow})),__webpack_require__.d(__webpack_exports__,"nodeTypes",(function(){return nodeTypes}));var external_kbnSharedDeps_Lodash_=__webpack_require__(24),external_kbnSharedDeps_React_=__webpack_require__(2),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(10),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(14),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),snapshot_metric_i18n=__webpack_require__(165),common=__webpack_require__(211),alerting_metrics=__webpack_require__(131),types=__webpack_require__(19),common_=__webpack_require__(13),public_common_=__webpack_require__(76),kuery_bar=__webpack_require__(162),use_source_via_http=__webpack_require__(141),toolbar_items=__webpack_require__(289),aws_ec2_toolbar_items=__webpack_require__(286),aws_s3_toolbar_items=__webpack_require__(287),aws_rds_toolbar_items=__webpack_require__(288),host_toolbar_items=__webpack_require__(283),container_toolbar_items=__webpack_require__(284),pod_toolbar_items=__webpack_require__(285),inventory_models=__webpack_require__(88),inventory_models_types=__webpack_require__(83),get_custom_metric_label=__webpack_require__(126),snapshot_api=__webpack_require__(87);const AGGREGATION_LABELS={avg:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),max:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),min:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),rate:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})},aggregationOptions=snapshot_api.b.map(k=>({text:AGGREGATION_LABELS[k],value:k})),MetricExpression=({metric:metric,metrics:metrics,customMetric:customMetric,fields:fields,errors:errors,onChange:onChange,onChangeCustom:onChangeCustom,popupPosition:popupPosition})=>{var _errors$metric;const[popoverOpen,setPopoverOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),[customMetricTabOpen,setCustomMetricTabOpen]=Object(external_kbnSharedDeps_React_.useState)("custom"===(null==metric?void 0:metric.value)),[selectedOption,setSelectedOption]=Object(external_kbnSharedDeps_React_.useState)(null==metric?void 0:metric.value),[fieldDisplayedCustomLabel,setFieldDisplayedCustomLabel]=Object(external_kbnSharedDeps_React_.useState)(null==customMetric?void 0:customMetric.label),firstFieldOption={text:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.selectFieldLabel",{defaultMessage:"Select a metric"}),value:""},fieldOptions=Object(external_kbnSharedDeps_React_.useMemo)(()=>fields.filter(f=>f.aggregatable&&"number"===f.type&&!((null==customMetric?void 0:customMetric.field)===f.name)).map(f=>({label:f.name})),[fields,null==customMetric?void 0:customMetric.field]),expressionDisplayValue=Object(external_kbnSharedDeps_React_.useMemo)(()=>customMetricTabOpen?(null==customMetric?void 0:customMetric.field)&&Object(get_custom_metric_label.a)(customMetric):(null==metric?void 0:metric.text)||firstFieldOption.text,[customMetricTabOpen,metric,customMetric,firstFieldOption]),onChangeTab=Object(external_kbnSharedDeps_React_.useCallback)(id=>{"metric-popover-custom"===id?(setCustomMetricTabOpen(!0),onChange("custom")):(setCustomMetricTabOpen(!1),onChange(selectedOption))},[setCustomMetricTabOpen,onChange,selectedOption]),onAggregationChange=Object(external_kbnSharedDeps_React_.useCallback)(e=>{const value=e.target.value,aggValue=snapshot_api.c.is(value)?value:"avg",newCustomMetric={...customMetric,aggregation:aggValue};snapshot_api.d.is(newCustomMetric)&&onChangeCustom(newCustomMetric)},[customMetric,onChangeCustom]),onFieldChange=Object(external_kbnSharedDeps_React_.useCallback)(selectedOptions=>{const newCustomMetric={...customMetric,field:selectedOptions[0].label};snapshot_api.d.is(newCustomMetric)&&onChangeCustom(newCustomMetric)},[customMetric,onChangeCustom]),debouncedOnChangeCustom=Object(external_kbnSharedDeps_Lodash_.debounce)(onChangeCustom,500),onLabelChange=Object(external_kbnSharedDeps_React_.useCallback)(e=>{setFieldDisplayedCustomLabel(e.target.value);const newCustomMetric={...customMetric,label:e.target.value};snapshot_api.d.is(newCustomMetric)&&debouncedOnChangeCustom(newCustomMetric)},[customMetric,debouncedOnChangeCustom]),availablefieldsOptions=metrics.map(m=>({label:m.text,value:m.value}),[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"metricPopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiExpression,{description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.whenLabel",{defaultMessage:"When"}),value:expressionDisplayValue,isActive:Boolean(popoverOpen||errors.metric&&errors.metric.length>0),onClick:()=>{setPopoverOpen(!0)},color:null!==(_errors$metric=errors.metric)&&void 0!==_errors$metric&&_errors$metric.length?"danger":"secondary"}),isOpen:popoverOpen,closePopover:()=>{setPopoverOpen(!1)},anchorPosition:null!=popupPosition?popupPosition:"downRight",zIndex:8e3},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:620}},external_kbnSharedDeps_React_default.a.createElement(ClosablePopoverTitle,{onClose:()=>setPopoverOpen(!1)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.metric.popoverTitle",defaultMessage:"Metric"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:"Metric type",options:[{id:"metric-popover-default",label:"Default metric"},{id:"metric-popover-custom",label:"Custom metric"}],idSelected:customMetricTabOpen?"metric-popover-custom":"metric-popover-default",onChange:onChangeTab}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),customMetricTabOpen?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSelect,{onChange:onAggregationChange,value:(null==customMetric?void 0:customMetric.aggregation)||"avg",options:aggregationOptions,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.of",{defaultMessage:"of"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{fullWidth:!0,placeholder:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:!0},selectedOptions:null!=customMetric&&customMetric.field?[{label:customMetric.field}]:[],options:fieldOptions,onChange:onFieldChange,isClearable:!1,isInvalid:errors.metric.length>0})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.alerting.customMetrics.labelLabel",{defaultMessage:"Metric name (optional)"}),display:"rowCompressed",fullWidth:!0,helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.alerting.customMetrics.helpText",{defaultMessage:'Choose a name to help identify your custom metric. Defaults to "<function> of <field name>".'})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{name:"label",placeholder:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:fieldDisplayedCustomLabel,fullWidth:!0,onChange:onLabelChange}))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{fullWidth:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{className:"actOf__metricContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{fullWidth:!0,singleSelection:{asPlainText:!0},"data-test-subj":"availablefieldsOptionsComboBox",isInvalid:errors.metric.length>0,placeholder:firstFieldOption.text,options:availablefieldsOptions,noSuggestions:!availablefieldsOptions.length,selectedOptions:metric?availablefieldsOptions.filter(a=>a.value===metric.value):[],renderOption:o=>o.label,onChange:selectedOptions=>{selectedOptions.length>0?(onChange(selectedOptions[0].value),setSelectedOption(selectedOptions[0].value)):onChange()}}))))))},ClosablePopoverTitle=({children:children,onClose:onClose})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverTitle,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>onClose()})))),NodeTypeExpression=({value:value,options:options,onChange:onChange,popupPosition:popupPosition})=>{const[aggTypePopoverOpen,setAggTypePopoverOpen]=Object(external_kbnSharedDeps_React_.useState)(!1);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiExpression,{"data-test-subj":"nodeTypeExpression",description:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.expression.for.descriptionLabel",{defaultMessage:"For"}),value:options[value].text,isActive:aggTypePopoverOpen,onClick:()=>{setAggTypePopoverOpen(!0)}}),isOpen:aggTypePopoverOpen,closePopover:()=>{setAggTypePopoverOpen(!1)},ownFocus:!0,anchorPosition:null!=popupPosition?popupPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(node_type_ClosablePopoverTitle,{onClose:()=>setAggTypePopoverOpen(!1)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.for.popoverTitle",defaultMessage:"Node Type"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSelect,{"data-test-subj":"forExpressionSelect",value:value,fullWidth:!0,onChange:e=>{onChange(e.target.value),setAggTypePopoverOpen(!1)},options:Object.values(options).map(o=>o)})))},node_type_ClosablePopoverTitle=({children:children,onClose:onClose})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverTitle,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>onClose()}))));var kuery=__webpack_require__(117),validation=__webpack_require__(43),use_kibana=__webpack_require__(16),external_kbnSharedDeps_ElasticCharts_=__webpack_require__(61),external_kbnSharedDeps_Moment_=__webpack_require__(50),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_),color_palette=__webpack_require__(86),series_chart=__webpack_require__(124),use_metrics_explorer_options=__webpack_require__(93),calculate_domain=__webpack_require__(125),get_metric_id=__webpack_require__(161),use_snaphot=__webpack_require__(163),create_inventory_metric_formatter=__webpack_require__(164),criterion_preview_chart=__webpack_require__(139),threshold_annotations=__webpack_require__(207),use_waffle_options=__webpack_require__(94);const ExpressionChart=({expression:expression,filterQuery:filterQuery,nodeType:nodeType,sourceId:sourceId})=>{var _expression$warningTh,_expression$warningTh2,_nodes$2,_nodes$2$metrics$,_nodes$3;const timerange=Object(external_kbnSharedDeps_React_.useMemo)(()=>({interval:`${expression.timeSize||1}${expression.timeUnit}`,from:external_kbnSharedDeps_Moment_default()().subtract(20*(expression.timeSize||1),expression.timeUnit).valueOf(),to:external_kbnSharedDeps_Moment_default()().valueOf(),forceInterval:!0,ignoreLookback:!0}),[expression.timeSize,expression.timeUnit]),buildCustomMetric=metric=>({...metric,type:"custom"}),options=Object(use_waffle_options.d)(),{loading:loading,nodes:nodes}=Object(use_snaphot.a)(filterQuery,"custom"===expression.metric?[buildCustomMetric(expression.customMetric)]:[{type:expression.metric}],[],nodeType,sourceId,0,options.accountId,options.region,!0,timerange),{uiSettings:uiSettings}=Object(use_kibana.b)().services,metric={field:expression.metric,aggregation:"avg",color:color_palette.a.color0},isDarkMode=(null==uiSettings?void 0:uiSettings.get("theme:darkMode"))||!1,dateFormatter=Object(external_kbnSharedDeps_React_.useMemo)(()=>{var _nodes$,_nodes$$metrics$,_first,_last;const firstSeries=null===(_nodes$=nodes[0])||void 0===_nodes$||null===(_nodes$$metrics$=_nodes$.metrics[0])||void 0===_nodes$$metrics$?void 0:_nodes$$metrics$.timeseries,firstTimestamp=null===(_first=Object(external_kbnSharedDeps_Lodash_.first)(null==firstSeries?void 0:firstSeries.rows))||void 0===_first?void 0:_first.timestamp,lastTimestamp=null===(_last=Object(external_kbnSharedDeps_Lodash_.last)(null==firstSeries?void 0:firstSeries.rows))||void 0===_last?void 0:_last.timestamp;return null==firstTimestamp||null==lastTimestamp?value=>""+value:Object(external_kbnSharedDeps_ElasticCharts_.niceTimeFormatter)([firstTimestamp,lastTimestamp])},[nodes]),yAxisFormater=Object(external_kbnSharedDeps_React_.useCallback)(Object(create_inventory_metric_formatter.a)("custom"===expression.metric?buildCustomMetric(expression.customMetric):{type:expression.metric}),[expression.metric]);if(loading||!nodes)return external_kbnSharedDeps_React_default.a.createElement(criterion_preview_chart.c,null);const convertThreshold=threshold=>convertMetricValue(expression.metric,threshold),convertedThresholds=expression.threshold.map(convertThreshold),convertedWarningThresholds=null!==(_expression$warningTh=null===(_expression$warningTh2=expression.warningThreshold)||void 0===_expression$warningTh2?void 0:_expression$warningTh2.map(convertThreshold))&&void 0!==_expression$warningTh?_expression$warningTh:[],criticalThresholds=convertedThresholds.slice().sort(),warningThresholds=convertedWarningThresholds.slice().sort(),thresholds=[...criticalThresholds,...warningThresholds].sort(),firstSeries=null===(_nodes$2=nodes[0])||void 0===_nodes$2||null===(_nodes$2$metrics$=_nodes$2.metrics[0])||void 0===_nodes$2$metrics$?void 0:_nodes$2$metrics$.timeseries;if(!firstSeries||!firstSeries.rows||0===firstSeries.rows.length)return external_kbnSharedDeps_React_default.a.createElement(criterion_preview_chart.e,null);const series={...firstSeries,id:null===(_nodes$3=nodes[0])||void 0===_nodes$3?void 0:_nodes$3.name,rows:firstSeries.rows.map(row=>{const newRow={...row};return thresholds.forEach((thresholdValue,index)=>{newRow[Object(get_metric_id.a)(metric,"threshold_"+index)]=thresholdValue}),newRow})},firstTimestamp=Object(external_kbnSharedDeps_Lodash_.first)(firstSeries.rows).timestamp,lastTimestamp=Object(external_kbnSharedDeps_Lodash_.last)(firstSeries.rows).timestamp,dataDomain=Object(calculate_domain.a)(series,[metric],!1),domain={max:1.1*Math.max(dataDomain.max,Object(external_kbnSharedDeps_Lodash_.last)(thresholds)||dataDomain.max),min:.9*Math.min(dataDomain.min,Object(external_kbnSharedDeps_Lodash_.first)(thresholds)||dataDomain.min)};domain.min===Object(external_kbnSharedDeps_Lodash_.first)(convertedThresholds)&&(domain.min=.9*domain.min);const{timeSize:timeSize,timeUnit:timeUnit}=expression,timeLabel=criterion_preview_chart.f[timeUnit];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(criterion_preview_chart.a,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_.Chart,null,external_kbnSharedDeps_React_default.a.createElement(series_chart.a,{type:use_metrics_explorer_options.b.bar,metric:metric,id:"0",series:series,stack:!1}),external_kbnSharedDeps_React_default.a.createElement(threshold_annotations.a,{comparator:expression.comparator,threshold:convertedThresholds,sortedThresholds:criticalThresholds,color:color_palette.a.color1,id:"critical",firstTimestamp:firstTimestamp,lastTimestamp:lastTimestamp,domain:domain}),expression.warningComparator&&expression.warningThreshold&&external_kbnSharedDeps_React_default.a.createElement(threshold_annotations.a,{comparator:expression.warningComparator,threshold:convertedWarningThresholds,sortedThresholds:warningThresholds,color:color_palette.a.color5,id:"warning",firstTimestamp:firstTimestamp,lastTimestamp:lastTimestamp,domain:domain}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_.Axis,{id:"timestamp",position:external_kbnSharedDeps_ElasticCharts_.Position.Bottom,showOverlappingTicks:!0,tickFormat:dateFormatter}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_.Axis,{id:"values",position:external_kbnSharedDeps_ElasticCharts_.Position.Left,tickFormat:yAxisFormater,domain:domain}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_.Settings,{tooltip:criterion_preview_chart.i,theme:Object(criterion_preview_chart.g)(isDarkMode)}))),external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==series.id?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:series.id,timeLabel:timeLabel,lookback:20*timeSize}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:timeLabel,lookback:20*timeSize}}))))},convertMetricValue=(metric,value)=>converters[metric]?converters[metric](value):value,converters={cpu:n=>Number(n)/100,memory:n=>Number(n)/100},defaultExpression={metric:"cpu",comparator:types.a.GT,threshold:[],timeSize:1,timeUnit:"m",customMetric:{type:"custom",id:"alert-custom-metric",field:"",aggregation:"avg"}},Expressions=props=>{const{http:http,notifications:notifications}=Object(use_kibana.b)().services,{setAlertParams:setAlertParams,alertParams:alertParams,errors:errors,alertInterval:alertInterval,alertThrottle:alertThrottle,metadata:metadata,alertNotifyWhen:alertNotifyWhen}=props,{source:source,createDerivedIndexPattern:createDerivedIndexPattern}=Object(use_source_via_http.a)({sourceId:"default",fetch:http.fetch,toastWarning:notifications.toasts.addWarning}),[timeSize,setTimeSize]=Object(external_kbnSharedDeps_React_.useState)(1),[timeUnit,setTimeUnit]=Object(external_kbnSharedDeps_React_.useState)("m"),derivedIndexPattern=Object(external_kbnSharedDeps_React_.useMemo)(()=>createDerivedIndexPattern(),[createDerivedIndexPattern]),updateParams=Object(external_kbnSharedDeps_React_.useCallback)((id,e)=>{const exp=alertParams.criteria?alertParams.criteria.slice():[];exp[id]=e,setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria]),addExpression=Object(external_kbnSharedDeps_React_.useCallback)(()=>{var _alertParams$criteria;const exp=(null===(_alertParams$criteria=alertParams.criteria)||void 0===_alertParams$criteria?void 0:_alertParams$criteria.slice())||[];exp.push({...defaultExpression,timeSize:null!=timeSize?timeSize:defaultExpression.timeSize,timeUnit:null!=timeUnit?timeUnit:defaultExpression.timeUnit}),setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria,timeSize,timeUnit]),removeExpression=Object(external_kbnSharedDeps_React_.useCallback)(id=>{const exp=alertParams.criteria.slice();exp.length>1&&(exp.splice(id,1),setAlertParams("criteria",exp))},[setAlertParams,alertParams.criteria]),onFilterChange=Object(external_kbnSharedDeps_React_.useCallback)(filter=>{setAlertParams("filterQueryText",filter||""),setAlertParams("filterQuery",Object(kuery.a)(filter,derivedIndexPattern)||"")},[derivedIndexPattern,setAlertParams]),debouncedOnFilterChange=Object(external_kbnSharedDeps_React_.useCallback)(Object(external_kbnSharedDeps_Lodash_.debounce)(onFilterChange,500),[onFilterChange]),emptyError=Object(external_kbnSharedDeps_React_.useMemo)(()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]}),[]),updateTimeSize=Object(external_kbnSharedDeps_React_.useCallback)(ts=>{const criteria=alertParams.criteria.map(c=>({...c,timeSize:ts}));setTimeSize(ts||void 0),setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]),updateTimeUnit=Object(external_kbnSharedDeps_React_.useCallback)(tu=>{const criteria=alertParams.criteria.map(c=>({...c,timeUnit:tu}));setTimeUnit(tu),setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]),updateNodeType=Object(external_kbnSharedDeps_React_.useCallback)(nt=>{setAlertParams("nodeType",nt)},[setAlertParams]),handleFieldSearchChange=Object(external_kbnSharedDeps_React_.useCallback)(e=>onFilterChange(e.target.value),[onFilterChange]),preFillAlertCriteria=Object(external_kbnSharedDeps_React_.useCallback)(()=>{const md=metadata;md&&md.options?setAlertParams("criteria",[{...defaultExpression,metric:md.options.metric.type,customMetric:snapshot_api.d.is(md.options.metric)?md.options.metric:defaultExpression.customMetric}]):setAlertParams("criteria",[defaultExpression])},[metadata,setAlertParams]),preFillAlertFilter=Object(external_kbnSharedDeps_React_.useCallback)(()=>{const md=metadata;md&&md.filter&&(setAlertParams("filterQueryText",md.filter),setAlertParams("filterQuery",Object(kuery.a)(md.filter,derivedIndexPattern)||""))},[metadata,derivedIndexPattern,setAlertParams]);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{const md=metadata;alertParams.nodeType||(md&&md.nodeType?setAlertParams("nodeType",md.nodeType):setAlertParams("nodeType","host")),alertParams.criteria&&alertParams.criteria.length?(setTimeSize(alertParams.criteria[0].timeSize),setTimeUnit(alertParams.criteria[0].timeUnit)):preFillAlertCriteria(),alertParams.filterQuery||preFillAlertFilter(),alertParams.sourceId||setAlertParams("sourceId",(null==source?void 0:source.id)||"default")},[metadata,derivedIndexPattern,defaultExpression,source]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(NonCollapsibleExpression,null,external_kbnSharedDeps_React_default.a.createElement(NodeTypeExpression,{options:nodeTypes,value:alertParams.nodeType||"host",onChange:updateNodeType})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"}),alertParams.criteria&&alertParams.criteria.map((e,idx)=>external_kbnSharedDeps_React_default.a.createElement(ExpressionRow,{nodeType:alertParams.nodeType,canDelete:alertParams.criteria.length>1,remove:removeExpression,addExpression:addExpression,key:idx,expressionId:idx,setAlertParams:updateParams,errors:errors[idx]||emptyError,expression:e||{},fields:derivedIndexPattern.fields},external_kbnSharedDeps_React_default.a.createElement(ExpressionChart,{expression:e,filterQuery:alertParams.filterQuery,nodeType:alertParams.nodeType,sourceId:alertParams.sourceId,"data-test-subj":"preview-chart"}))),external_kbnSharedDeps_React_default.a.createElement(NonCollapsibleExpression,null,external_kbnSharedDeps_React_default.a.createElement(public_common_.ForLastExpression,{timeWindowSize:timeSize,timeWindowUnit:timeUnit,errors:emptyError,onChangeWindowSize:updateTimeSize,onChangeWindowUnit:updateTimeUnit})),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:addExpression},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCheckbox,{id:"metrics-alert-no-data-toggle",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{content:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"questionInCircle",color:"subdued"}))),checked:alertParams.alertOnNoData,onChange:e=>setAlertParams("alertOnNoData",e.target.checked)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:!0,display:"rowCompressed"},metadata&&external_kbnSharedDeps_React_default.a.createElement(kuery_bar.a,{derivedIndexPattern:derivedIndexPattern,onSubmit:onFilterChange,onChange:debouncedOnFilterChange,value:alertParams.filterQueryText})||external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldSearch,{onChange:handleFieldSearchChange,value:alertParams.filterQueryText,fullWidth:!0})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(common.a,{alertInterval:alertInterval,alertThrottle:alertThrottle,alertNotifyWhen:alertNotifyWhen,alertType:alerting_metrics.d,alertParams:Object(external_kbnSharedDeps_Lodash_.pick)(alertParams,"criteria","nodeType","sourceId","filterQuery"),validate:validation.a,groupByDisplayName:alertParams.nodeType,showNoDataResults:alertParams.alertOnNoData}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}))};__webpack_exports__.default=Expressions;const NonCollapsibleExpression=common_.euiStyled.div`
  margin-left: 28px;
`,StyledExpressionRow=Object(common_.euiStyled)(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup)`
  display: flex;
  flex-wrap: wrap;
  margin: 0 -4px;
`,StyledExpression=common_.euiStyled.div`
  padding: 0 4px;
`,StyledHealth=Object(common_.euiStyled)(external_kbnSharedDeps_ElasticEui_.EuiHealth)`
  margin-left: 4px;
`,ExpressionRow=props=>{var _ref,_ref2,_ofFields$find;const[isExpanded,setRowState]=Object(external_kbnSharedDeps_React_.useState)(!0),toggleRowState=Object(external_kbnSharedDeps_React_.useCallback)(()=>setRowState(!isExpanded),[isExpanded]),{children:children,setAlertParams:setAlertParams,expression:expression,errors:errors,expressionId:expressionId,remove:remove,canDelete:canDelete,fields:fields}=props,{metric:metric,comparator:comparator=types.a.GT,threshold:threshold=[],customMetric:customMetric,warningThreshold:warningThreshold=[],warningComparator:warningComparator}=expression,[displayWarningThreshold,setDisplayWarningThreshold]=Object(external_kbnSharedDeps_React_.useState)(Boolean(null==warningThreshold?void 0:warningThreshold.length)),updateMetric=Object(external_kbnSharedDeps_React_.useCallback)(m=>{const newMetric=inventory_models_types.f.is(m)?m:Boolean(m)?"custom":void 0,newAlertParams={...expression,metric:newMetric};setAlertParams(expressionId,newAlertParams)},[expressionId,expression,setAlertParams]),updateCustomMetric=Object(external_kbnSharedDeps_React_.useCallback)(cm=>{snapshot_api.d.is(cm)&&setAlertParams(expressionId,{...expression,customMetric:cm})},[expressionId,expression,setAlertParams]),updateComparator=Object(external_kbnSharedDeps_React_.useCallback)(c=>{setAlertParams(expressionId,{...expression,comparator:c})},[expressionId,expression,setAlertParams]),updateWarningComparator=Object(external_kbnSharedDeps_React_.useCallback)(c=>{setAlertParams(expressionId,{...expression,warningComparator:c})},[expressionId,expression,setAlertParams]),updateThreshold=Object(external_kbnSharedDeps_React_.useCallback)(t=>{t.join()!==expression.threshold.join()&&setAlertParams(expressionId,{...expression,threshold:t})},[expressionId,expression,setAlertParams]),updateWarningThreshold=Object(external_kbnSharedDeps_React_.useCallback)(t=>{var _expression$warningTh;t.join()!==(null===(_expression$warningTh=expression.warningThreshold)||void 0===_expression$warningTh?void 0:_expression$warningTh.join())&&setAlertParams(expressionId,{...expression,warningThreshold:t})},[expressionId,expression,setAlertParams]),toggleWarningThreshold=Object(external_kbnSharedDeps_React_.useCallback)(()=>{displayWarningThreshold?(setDisplayWarningThreshold(!1),setAlertParams(expressionId,Object(external_kbnSharedDeps_Lodash_.omit)(expression,"warningComparator","warningThreshold"))):(setDisplayWarningThreshold(!0),setAlertParams(expressionId,{...expression,warningComparator:comparator,warningThreshold:[]}))},[displayWarningThreshold,setDisplayWarningThreshold,setAlertParams,comparator,expression,expressionId]),criticalThresholdExpression=external_kbnSharedDeps_React_default.a.createElement(ThresholdElement,{comparator:comparator,threshold:threshold,updateComparator:updateComparator,updateThreshold:updateThreshold,errors:null!==(_ref=errors.critical)&&void 0!==_ref?_ref:{},metric:metric}),warningThresholdExpression=displayWarningThreshold&&external_kbnSharedDeps_React_default.a.createElement(ThresholdElement,{comparator:warningComparator||comparator,threshold:warningThreshold,updateComparator:updateWarningComparator,updateThreshold:updateWarningThreshold,errors:null!==(_ref2=errors.warning)&&void 0!==_ref2?_ref2:{},metric:metric}),ofFields=Object(external_kbnSharedDeps_React_.useMemo)(()=>{let myMetrics=host_toolbar_items.b;switch(props.nodeType){case"awsEC2":myMetrics=aws_ec2_toolbar_items.b;break;case"awsRDS":myMetrics=aws_rds_toolbar_items.b;break;case"awsS3":myMetrics=aws_s3_toolbar_items.b;break;case"awsSQS":myMetrics=toolbar_items.b;break;case"host":myMetrics=host_toolbar_items.b;break;case"pod":myMetrics=pod_toolbar_items.b;break;case"container":myMetrics=container_toolbar_items.b}return myMetrics.map(snapshot_metric_i18n.a)},[props.nodeType]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{iconType:isExpanded?"arrowDown":"arrowRight",onClick:toggleRowState,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!0},external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(MetricExpression,{metric:{value:metric,text:(null===(_ofFields$find=ofFields.find(v=>(null==v?void 0:v.value)===metric))||void 0===_ofFields$find?void 0:_ofFields$find.text)||""},metrics:ofFields.filter(m=>void 0!==m&&void 0!==m.value),onChange:updateMetric,onChangeCustom:updateCustomMetric,errors:errors,customMetric:customMetric,fields:fields})),!displayWarningThreshold&&criticalThresholdExpression),displayWarningThreshold&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,criticalThresholdExpression,external_kbnSharedDeps_React_default.a.createElement(StyledHealth,{color:"danger"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.criticalThreshold",defaultMessage:"Alert"}))),external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,warningThresholdExpression,external_kbnSharedDeps_React_default.a.createElement(StyledHealth,{color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.warningThreshold",defaultMessage:"Warning"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.removeWarningThreshold",{defaultMessage:"Remove warningThreshold"}),iconSize:"s",color:"subdued",iconType:"crossInACircleFilled",onClick:toggleWarningThreshold}))),!displayWarningThreshold&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:toggleWarningThreshold},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addWarningThreshold",defaultMessage:"Add warning threshold"}))))),canDelete&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>remove(expressionId)}))),isExpanded?external_kbnSharedDeps_React_default.a.createElement("div",{style:{padding:"0 0 0 28px"}},children):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"}))},ThresholdElement=({updateComparator:updateComparator,updateThreshold:updateThreshold,threshold:threshold,metric:metric,comparator:comparator,errors:errors})=>{var _metricUnit$metric;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(public_common_.ThresholdExpression,{thresholdComparator:comparator||types.a.GT,threshold:threshold,onChangeSelectedThresholdComparator:updateComparator,onChangeSelectedThreshold:updateThreshold,errors:errors})),metric&&external_kbnSharedDeps_React_default.a.createElement("div",{style:{alignSelf:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},(null===(_metricUnit$metric=metricUnit[metric])||void 0===_metricUnit$metric?void 0:_metricUnit$metric.label)||"")))},getDisplayNameForType=type=>Object(inventory_models.b)(type).displayName,nodeTypes={host:{text:getDisplayNameForType("host"),value:"host"},pod:{text:getDisplayNameForType("pod"),value:"pod"},container:{text:getDisplayNameForType("container"),value:"container"},awsEC2:{text:getDisplayNameForType("awsEC2"),value:"awsEC2"},awsS3:{text:getDisplayNameForType("awsS3"),value:"awsS3"},awsRDS:{text:getDisplayNameForType("awsRDS"),value:"awsRDS"},awsSQS:{text:getDisplayNameForType("awsSQS"),value:"awsSQS"}},metricUnit={count:{label:""},cpu:{label:"%"},memory:{label:"%"},rx:{label:"bits/s"},tx:{label:"bits/s"},logRate:{label:"/s"},diskIOReadBytes:{label:"bytes/s"},diskIOWriteBytes:{label:"bytes/s"},s3BucketSize:{label:"bytes"},s3TotalRequests:{label:""},s3NumberOfObjects:{label:""},s3UploadBytes:{label:"bytes"},s3DownloadBytes:{label:"bytes"},sqsOldestMessage:{label:"seconds"},rdsLatency:{label:"ms"},custom:{label:""}}}}]);