/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[6],{48:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return AlertAdd}));var external_kbnSharedDeps_React_=__webpack_require__(1),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(52),external_kbnSharedDeps_ElasticEui_=__webpack_require__(15),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0),external_kbnSharedDeps_Lodash_=__webpack_require__(3),types=__webpack_require__(16),alert_form=__webpack_require__(145),alert_reducer=__webpack_require__(98),alert_api=__webpack_require__(90),health_check=__webpack_require__(100);const ConfirmAlertSave=({onConfirm:onConfirm,onCancel:onCancel})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.confirmAlertSave.confirmAlertSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:onCancel,onConfirm:onConfirm,confirmButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.confirmAlertSave.confirmAlertSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.confirmAlertSave.confirmAlertSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmAlertSaveModal"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmAlertSave.confirmAlertSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var confirm_alert_close=__webpack_require__(143),lib_capabilities=__webpack_require__(84),health_context=__webpack_require__(92);const AlertAddFooter=({isSaving:isSaving,onSave:onSave,onCancel:onCancel})=>{const{loadingHealthCheck:loadingHealthCheck}=Object(health_context.b)();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{"data-test-subj":"cancelSaveAlertButton",onClick:onCancel},external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.alertAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{fill:!0,color:"secondary","data-test-subj":"saveAlertButton",type:"submit",iconType:"check",isDisabled:loadingHealthCheck,isLoading:isSaving,onClick:onSave},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"xpack.triggersActionsUI.sections.alertAddFooter.saveButtonLabel",defaultMessage:"Save"})))))};var kibana=__webpack_require__(72),has_alert_changed=__webpack_require__(144),value_validators=__webpack_require__(5);const AlertAdd=({consumer:consumer,alertTypeRegistry:alertTypeRegistry,actionTypeRegistry:actionTypeRegistry,onClose:onClose,canChangeTrigger:canChangeTrigger,alertTypeId:alertTypeId,initialValues:initialValues,reloadAlerts:reloadAlerts,onSave:onSave,metadata:metadata})=>{var _alert$actions;const onSaveHandler=null!=onSave?onSave:reloadAlerts,initialAlert=Object(external_kbnSharedDeps_React_.useMemo)(()=>({params:{},consumer:consumer,alertTypeId:alertTypeId,schedule:{interval:"1m"},actions:[],tags:[],notifyWhen:"onActionGroupChange",...initialValues||{}}),[alertTypeId,consumer,initialValues]),[{alert:alert},dispatch]=Object(external_kbnSharedDeps_React_.useReducer)(alert_reducer.a,{alert:initialAlert}),[initialAlertParams,setInitialAlertParams]=Object(external_kbnSharedDeps_React_.useState)({}),[isSaving,setIsSaving]=Object(external_kbnSharedDeps_React_.useState)(!1),[isConfirmAlertSaveModalOpen,setIsConfirmAlertSaveModalOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),[isConfirmAlertCloseModalOpen,setIsConfirmAlertCloseModalOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),{http:http,notifications:{toasts:toasts},application:{capabilities:capabilities}}=Object(kibana.b)().services,canShowActions=Object(lib_capabilities.e)(capabilities);Object(external_kbnSharedDeps_React_.useEffect)(()=>{alertTypeId&&dispatch({command:{type:"setProperty"},payload:{key:"alertTypeId",value:alertTypeId}})},[alertTypeId]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{Object(external_kbnSharedDeps_Lodash_.isEmpty)(alert.params)&&!Object(external_kbnSharedDeps_Lodash_.isEmpty)(initialAlertParams)?setInitialAlertParams({}):Object(external_kbnSharedDeps_Lodash_.isEmpty)(initialAlertParams)&&setInitialAlertParams(alert.params)},[alert.params,initialAlertParams,setInitialAlertParams]);const checkForChangesAndCloseFlyout=()=>{Object(has_alert_changed.a)(alert,initialAlert,!1)||Object(has_alert_changed.b)(alert.params,initialAlertParams)?setIsConfirmAlertCloseModalOpen(!0):onClose(types.b.CANCELED)},saveAlertAndCloseFlyout=async()=>{const savedAlert=await async function(){try{const newAlert=await Object(alert_api.b)({http:http,alert:alert});return toasts.addSuccess(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.alertAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:newAlert.name}})),newAlert}catch(errorRes){var _errorRes$body$messag,_errorRes$body;toasts.addDanger(null!==(_errorRes$body$messag=null===(_errorRes$body=errorRes.body)||void 0===_errorRes$body?void 0:_errorRes$body.message)&&void 0!==_errorRes$body$messag?_errorRes$body$messag:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.alertAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}))}}();setIsSaving(!1),savedAlert&&(onClose(types.b.SAVED),onSaveHandler&&onSaveHandler())},alertType=alert.alertTypeId?alertTypeRegistry.get(alert.alertTypeId):null,{alertActionsErrors:alertActionsErrors,alertBaseErrors:alertBaseErrors,alertErrors:alertErrors,alertParamsErrors:alertParamsErrors}=Object(alert_form.b)(alert,actionTypeRegistry,alertType),shouldConfirmSave=canShowActions&&0===(null===(_alert$actions=alert.actions)||void 0===_alert$actions?void 0:_alert$actions.length);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPortal,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyout,{onClose:checkForChangesAndCloseFlyout,"aria-labelledby":"flyoutAlertAddTitle",size:"m",maxWidth:620},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutHeader,{hasBorder:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"s","data-test-subj":"addAlertFlyoutTitle"},external_kbnSharedDeps_React_default.a.createElement("h3",{id:"flyoutTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.alertAdd.flyoutTitle"})))),external_kbnSharedDeps_React_default.a.createElement(health_context.a,null,external_kbnSharedDeps_React_default.a.createElement(health_check.a,{inFlyout:!0,waitForCheck:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlyoutBody,null,external_kbnSharedDeps_React_default.a.createElement(alert_form.a,{alert:alert,dispatch:dispatch,errors:alertErrors,canChangeTrigger:canChangeTrigger,operation:external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.triggersActionsUI.sections.alertAdd.operationName",{defaultMessage:"create"}),actionTypeRegistry:actionTypeRegistry,alertTypeRegistry:alertTypeRegistry,metadata:metadata})),external_kbnSharedDeps_React_default.a.createElement(AlertAddFooter,{isSaving:isSaving,onSave:async()=>{if(setIsSaving(!0),!Object(alert_form.c)(alert,alertErrors,alertActionsErrors))return value=Object(value_validators.a)(alert,alertParamsErrors,alertBaseErrors,alertActionsErrors),dispatch({command:{type:"setAlert"},payload:{key:"alert",value:value}}),void setIsSaving(!1);var value;shouldConfirmSave?setIsConfirmAlertSaveModalOpen(!0):await saveAlertAndCloseFlyout()},onCancel:checkForChangesAndCloseFlyout}))),isConfirmAlertSaveModalOpen&&external_kbnSharedDeps_React_default.a.createElement(ConfirmAlertSave,{onConfirm:async()=>{setIsConfirmAlertSaveModalOpen(!1),await saveAlertAndCloseFlyout()},onCancel:()=>{setIsSaving(!1),setIsConfirmAlertSaveModalOpen(!1)}}),isConfirmAlertCloseModalOpen&&external_kbnSharedDeps_React_default.a.createElement(confirm_alert_close.a,{onConfirm:()=>{setIsConfirmAlertCloseModalOpen(!1),onClose(types.b.CANCELED)},onCancel:()=>{setIsConfirmAlertCloseModalOpen(!1)}})))}}}]);