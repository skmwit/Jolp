/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=11)}([function(module,exports){module.exports=__kbnSharedDeps__.Rxjs},function(module,exports){},function(module,exports){module.exports=__kbnSharedDeps__.RxjsOperators},function(module,exports){},function(module,exports){},function(module,exports){var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);module.exports=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>((3&i)<<3)&255;return rnds}}},function(module,exports){for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=function(buf,offset){var i=offset||0,bth=byteToHex;return[bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]]].join("")}},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.Moment},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,exports,__webpack_require__){var v1=__webpack_require__(13),v4=__webpack_require__(14),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(12);__kbnBundles__.define("plugin/globalSearch/public",__webpack_require__,15)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__.globalSearch},function(module,exports,__webpack_require__){var _nodeId,_clockseq,rng=__webpack_require__(5),bytesToUuid=__webpack_require__(6),_lastMSecs=0,_lastNSecs=0;module.exports=function(options,buf,offset){var i=buf&&offset||0,b=buf||[],node=(options=options||{}).node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=rng();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid(b)}},function(module,exports,__webpack_require__){var rng=__webpack_require__(5),bytesToUuid=__webpack_require__(6);module.exports=function(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null);var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid(rnds)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin})),__webpack_require__.d(__webpack_exports__,"GlobalSearchBatchedResults",(function(){return common_types.GlobalSearchBatchedResults})),__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderFindOptions",(function(){return common_types.GlobalSearchProviderFindOptions})),__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderResult",(function(){return common_types.GlobalSearchProviderResult})),__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderResultUrl",(function(){return common_types.GlobalSearchProviderResultUrl})),__webpack_require__.d(__webpack_exports__,"GlobalSearchResult",(function(){return common_types.GlobalSearchResult})),__webpack_require__.d(__webpack_exports__,"GlobalSearchFindParams",(function(){return common_types.GlobalSearchFindParams})),__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderFindParams",(function(){return common_types.GlobalSearchProviderFindParams})),__webpack_require__.d(__webpack_exports__,"GlobalSearchPluginSetup",(function(){return public_types.GlobalSearchPluginSetup})),__webpack_require__.d(__webpack_exports__,"GlobalSearchPluginStart",(function(){return public_types.GlobalSearchPluginStart})),__webpack_require__.d(__webpack_exports__,"GlobalSearchResultProvider",(function(){return public_types.GlobalSearchResultProvider})),__webpack_require__.d(__webpack_exports__,"GlobalSearchFindOptions",(function(){return types.GlobalSearchFindOptions}));class LicenseChecker{constructor(license$){_defineProperty(this,"subscription",void 0),_defineProperty(this,"state",{valid:!1,message:"unknown"}),this.subscription=license$.subscribe(license=>{this.state=(license=>{const check=license.check("globalSearch","basic");switch(check.state){case"expired":return{valid:!1,message:"expired"};case"invalid":return{valid:!1,message:"invalid"};case"unavailable":return{valid:!1,message:"unavailable"};case"valid":return{valid:!0};default:throw new Error("Invalid license state: "+check.state)}})(license)})}getState(){return this.state}clean(){this.subscription.unsubscribe()}}var external_kbnSharedDeps_Rxjs_=__webpack_require__(0),external_kbnSharedDeps_RxjsOperators_=__webpack_require__(2),external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Moment_=__webpack_require__(8),external_kbnSharedDeps_KbnI18n_=__webpack_require__(9);class GlobalSearchFindError extends Error{static invalidLicense(message){return new GlobalSearchFindError("invalid-license",message)}constructor(type,message){super(message),this.type=type,Object.setPrototypeOf(this,GlobalSearchFindError.prototype)}}class TakeInArray{constructor(total){if(this.total=total,this.total<0)throw new Error("Cannot take a negative number of items")}call(subscriber,source){return source.subscribe(new take_in_array_TakeInArraySubscriber(subscriber,this.total))}}class take_in_array_TakeInArraySubscriber extends external_kbnSharedDeps_Rxjs_.Subscriber{constructor(destination,total){var obj,key,value;super(destination),this.total=total,value=0,(key="current")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}_next(value){const remaining=this.total-this.current;remaining>value.length?(this.destination.next(value),this.current+=value.length):(this.destination.next(value.slice(0,remaining)),this.destination.complete(),this.unsubscribe())}}const convertResultUrl=(url,basePath)=>"string"==typeof url?url.startsWith("/")?basePath.prepend(url):url:url.prependBasePath?basePath.prepend(url.path):url.path;var uuid=__webpack_require__(10),uuid_default=__webpack_require__.n(uuid);function search_service_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const mapToUndefined=()=>{};class search_service_SearchService{constructor(){search_service_defineProperty(this,"providers",new Map),search_service_defineProperty(this,"config",void 0),search_service_defineProperty(this,"http",void 0),search_service_defineProperty(this,"maxProviderResults",40),search_service_defineProperty(this,"licenseChecker",void 0),search_service_defineProperty(this,"serverTypes",void 0)}setup({config:config,maxProviderResults:maxProviderResults=40}){return this.config=config,this.maxProviderResults=maxProviderResults,{registerResultProvider:provider=>{if(this.providers.has(provider.id))throw new Error("trying to register duplicate provider: "+provider.id);this.providers.set(provider.id,provider)}}}start({http:http,licenseChecker:licenseChecker}){return this.http=http,this.licenseChecker=licenseChecker,{find:(params,options)=>this.performFind(params,options),getSearchableTypes:()=>this.getSearchableTypes()}}async getSearchableTypes(){const providerTypes=(await Promise.all([...this.providers.values()].map(provider=>provider.getSearchableTypes()))).flat();return this.serverTypes||(this.serverTypes=await(async http=>{const{types:types}=await http.get("/internal/global_search/searchable_types");return types})(this.http)),Object(external_kbnSharedDeps_Lodash_.uniq)([...providerTypes,...this.serverTypes])}performFind(params,options){var _options$preference;const licenseState=this.licenseChecker.getState();if(!licenseState.valid)return Object(external_kbnSharedDeps_Rxjs_.throwError)(GlobalSearchFindError.invalidLicense(external_kbnSharedDeps_KbnI18n_.i18n.translate("xpack.globalSearch.find.invalidLicenseError",{defaultMessage:"GlobalSearch API is disabled because of invalid license state: {errorMessage}",values:{errorMessage:licenseState.message}})));const timeout=Object(external_kbnSharedDeps_Moment_.duration)(this.config.search_timeout).asMilliseconds(),timeout$=Object(external_kbnSharedDeps_Rxjs_.timer)(timeout).pipe(Object(external_kbnSharedDeps_RxjsOperators_.map)(mapToUndefined)),aborted$=options.aborted$?Object(external_kbnSharedDeps_Rxjs_.merge)(options.aborted$,timeout$):timeout$,preference=null!==(_options$preference=options.preference)&&void 0!==_options$preference?_options$preference:((storage=window.sessionStorage)=>{let pref=storage.getItem("globalSearch:defaultPref");return pref||(pref=uuid_default.a.v4(),storage.setItem("globalSearch:defaultPref",pref),pref)})(),providerOptions={...options,preference:preference,maxResults:this.maxProviderResults,aborted$:aborted$},processResult=result=>((result,basePath)=>({...result,url:convertResultUrl(result.url,basePath)}))(result,this.http.basePath),serverResults$=((http,params,{preference:preference,aborted$:aborted$})=>{var _controller;let controller;return aborted$&&(controller=new AbortController,aborted$.subscribe(()=>{controller.abort()})),Object(external_kbnSharedDeps_Rxjs_.from)(http.post("/internal/global_search/find",{body:JSON.stringify({params:params,options:{preference:preference}}),signal:null===(_controller=controller)||void 0===_controller?void 0:_controller.signal})).pipe(Object(external_kbnSharedDeps_RxjsOperators_.takeUntil)(null!=aborted$?aborted$:external_kbnSharedDeps_Rxjs_.EMPTY),Object(external_kbnSharedDeps_RxjsOperators_.map)(response=>response.results))})(this.http,params,{preference:preference,aborted$:aborted$}),providersResults$=[...this.providers.values()].map(provider=>{return provider.find(params,providerOptions).pipe((count=this.maxProviderResults,function(source){return 0===count?external_kbnSharedDeps_Rxjs_.EMPTY:source.lift(new TakeInArray(count))}),Object(external_kbnSharedDeps_RxjsOperators_.takeUntil)(aborted$),Object(external_kbnSharedDeps_RxjsOperators_.map)(results=>results.map(r=>processResult(r))));var count});return Object(external_kbnSharedDeps_Rxjs_.merge)(...providersResults$,serverResults$).pipe(Object(external_kbnSharedDeps_RxjsOperators_.map)(results=>({results:results})))}}var types=__webpack_require__(3);function plugin_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class plugin_GlobalSearchPlugin{constructor(context){plugin_defineProperty(this,"config",void 0),plugin_defineProperty(this,"licenseChecker",void 0),plugin_defineProperty(this,"searchService",new search_service_SearchService),this.config=context.config.get()}setup(core){const{registerResultProvider:registerResultProvider}=this.searchService.setup({config:this.config});return{registerResultProvider:registerResultProvider}}start({http:http},{licensing:licensing}){this.licenseChecker=new LicenseChecker(licensing.license$);const{find:find,getSearchableTypes:getSearchableTypes}=this.searchService.start({http:http,licenseChecker:this.licenseChecker});return{find:find,getSearchableTypes:getSearchableTypes}}stop(){this.licenseChecker&&this.licenseChecker.clean()}}var common_types=__webpack_require__(1),public_types=__webpack_require__(4);const public_plugin=context=>new plugin_GlobalSearchPlugin(context)}]);