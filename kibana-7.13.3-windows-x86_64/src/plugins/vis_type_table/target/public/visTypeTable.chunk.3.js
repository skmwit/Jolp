(window.visTypeTable_bundle_jsonpfunction=window.visTypeTable_bundle_jsonpfunction||[]).push([[3],{24:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return VIS_TYPE_TABLE})),__webpack_require__.d(__webpack_exports__,"a",(function(){return AggTypes}));const VIS_TYPE_TABLE="table";let AggTypes;!function(AggTypes){AggTypes.SUM="sum",AggTypes.AVG="avg",AggTypes.MIN="min",AggTypes.MAX="max",AggTypes.COUNT="count"}(AggTypes||(AggTypes={}))},25:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return TableOptions}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_elastic_eui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8);const TableOptionsComponent=Object(react__WEBPACK_IMPORTED_MODULE_0__.lazy)(()=>__webpack_require__.e(5).then(__webpack_require__.bind(null,27))),TableOptions=props=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Suspense,{fallback:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__.EuiLoadingSpinner,null)},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(TableOptionsComponent,props))},26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return usePagination})),__webpack_require__.d(__webpack_exports__,"c",(function(){return useUiState})),__webpack_require__.d(__webpack_exports__,"a",(function(){return tableVisResponseHandler}));var external_kbnSharedDeps_React_=__webpack_require__(5);const usePagination=(visParams,rowCount)=>{const[pagination,setPagination]=Object(external_kbnSharedDeps_React_.useState)({pageIndex:0,pageSize:visParams.perPage||0}),onChangeItemsPerPage=Object(external_kbnSharedDeps_React_.useCallback)(pageSize=>setPagination(pag=>({...pag,pageSize:pageSize,pageIndex:0})),[]),onChangePage=Object(external_kbnSharedDeps_React_.useCallback)(pageIndex=>setPagination(pag=>({...pag,pageIndex:pageIndex})),[]);Object(external_kbnSharedDeps_React_.useEffect)(()=>{const pageSize=visParams.perPage||0,lastPageIndex=Math.ceil(rowCount/pageSize)-1;setPagination(pag=>({pageIndex:pag.pageIndex>lastPageIndex?lastPageIndex:pag.pageIndex,pageSize:pageSize}))},[visParams.perPage,rowCount]);return Object(external_kbnSharedDeps_React_.useMemo)(()=>pagination.pageSize?{...pagination,onChangeItemsPerPage:onChangeItemsPerPage,onChangePage:onChangePage}:void 0,[onChangeItemsPerPage,onChangePage,pagination])};var external_kbnSharedDeps_Lodash_=__webpack_require__(7);const defaultSort={columnIndex:null,direction:null},useUiState=uiState=>{const[sort,setSortState]=Object(external_kbnSharedDeps_React_.useState)((null==uiState?void 0:uiState.get("vis.params.sort"))||defaultSort),[columnsWidth,setColumnsWidthState]=Object(external_kbnSharedDeps_React_.useState)((null==uiState?void 0:uiState.get("vis.params.colWidth"))||[]),uiStateValues=Object(external_kbnSharedDeps_React_.useRef)({columnsWidth:null==uiState?void 0:uiState.get("vis.params.colWidth"),sort:null==uiState?void 0:uiState.get("vis.params.sort"),pendingUpdate:!1}),setSort=Object(external_kbnSharedDeps_React_.useCallback)((s=defaultSort)=>{setSortState(s||defaultSort),uiStateValues.current.sort=s,uiStateValues.current.pendingUpdate=!0,setTimeout(()=>{null==uiState||uiState.set("vis.params.sort",s),uiStateValues.current.pendingUpdate=!1})},[uiState]),setColumnsWidth=Object(external_kbnSharedDeps_React_.useCallback)(col=>{setColumnsWidthState(prevState=>{const updated=[...prevState],idx=prevState.findIndex(c=>c.colIndex===col.colIndex);return idx>=0?updated[idx]=col:updated.push(col),uiStateValues.current.columnsWidth=updated,uiStateValues.current.pendingUpdate=!0,setTimeout(()=>{null==uiState||uiState.set("vis.params.colWidth",updated),uiStateValues.current.pendingUpdate=!1}),updated})},[uiState]);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{const updateOnChange=Object(external_kbnSharedDeps_Lodash_.debounce)(()=>{if(uiStateValues.current.pendingUpdate)return;const{vis:vis}=null==uiState?void 0:uiState.getChanges();Object(external_kbnSharedDeps_Lodash_.isEqual)(null==vis?void 0:vis.params.colWidth,uiStateValues.current.columnsWidth)||(uiStateValues.current.columnsWidth=null==vis?void 0:vis.params.colWidth,setColumnsWidthState((null==vis?void 0:vis.params.colWidth)||[])),Object(external_kbnSharedDeps_Lodash_.isEqual)(null==vis?void 0:vis.params.sort,uiStateValues.current.sort)||(uiStateValues.current.sort=null==vis?void 0:vis.params.sort,setSortState((null==vis?void 0:vis.params.sort)||defaultSort))});return null==uiState||uiState.on("change",updateOnChange),()=>{null==uiState||uiState.off("change",updateOnChange)}},[uiState]),{columnsWidth:columnsWidth,sort:sort,setColumnsWidth:setColumnsWidth,setSort:setSort}};var services=__webpack_require__(0),external_kbnSharedDeps_KbnI18n_=__webpack_require__(6);function addPercentageColumn(table,name){const{columns:columns,rows:rows,formattedColumns:formattedColumns}=table,insertAtIndex=Object(external_kbnSharedDeps_Lodash_.findIndex)(columns,{name:name});if(insertAtIndex<0)return table;const{id:id}=columns[insertAtIndex],{sumTotal:sumTotal}=formattedColumns[id],percentageColumnId=id+"-percents",formatter=Object(services.a)().deserialize({id:"percent"}),percentageColumnName=external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.params.percentageTableColumnName",{defaultMessage:"{title} percentages",values:{title:name}}),newCols=function(arr,index,col){const newArray=[...arr];return newArray.splice(index+1,0,col),newArray}(columns,insertAtIndex,{name:percentageColumnName,id:percentageColumnId,meta:{type:"number",params:{id:"percent"}}}),newFormattedColumns={...formattedColumns,[percentageColumnId]:{title:percentageColumnName,formatter:formatter,filterable:!1}};return{columns:newCols,rows:rows.map(row=>({[percentageColumnId]:row[id]/sumTotal,...row})),formattedColumns:newFormattedColumns}}var common=__webpack_require__(24);const createFormattedTable=(table,visConfig)=>{const{buckets:buckets,metrics:metrics}=visConfig,formattedColumns=table.columns.reduce((acc,col,i)=>{var _dimension$format$par;const isBucket=null==buckets?void 0:buckets.find(({accessor:accessor})=>accessor===i),dimension=isBucket||metrics.find(({accessor:accessor})=>accessor===i);if(!dimension)return acc;const formatter=Object(services.a)().deserialize(dimension.format),formattedColumn={title:col.name,formatter:formatter,filterable:!!isBucket},isDate="date"===dimension.format.id||"date"===(null===(_dimension$format$par=dimension.format.params)||void 0===_dimension$format$par?void 0:_dimension$format$par.id);if(formatter.allowsNumericalAggregations||isDate||visConfig.totalFunc===common.a.COUNT){const sumOfColumnValues=table.rows.reduce((prev,curr)=>void 0===curr[col.id]?prev:prev+curr[col.id],0);switch(formattedColumn.sumTotal=sumOfColumnValues,visConfig.totalFunc){case common.a.SUM:isDate||(formattedColumn.formattedTotal=formatter.convert(sumOfColumnValues),formattedColumn.total=sumOfColumnValues);break;case common.a.AVG:if(!isDate){const total=sumOfColumnValues/table.rows.length;formattedColumn.formattedTotal=formatter.convert(total),formattedColumn.total=total}break;case common.a.MIN:{const total=Object(external_kbnSharedDeps_Lodash_.chain)(table.rows).map(col.id).min().value();formattedColumn.formattedTotal=formatter.convert(total),formattedColumn.total=total;break}case common.a.MAX:{const total=Object(external_kbnSharedDeps_Lodash_.chain)(table.rows).map(col.id).max().value();formattedColumn.formattedTotal=formatter.convert(total),formattedColumn.total=total;break}case common.a.COUNT:{const total=table.rows.length;formattedColumn.formattedTotal=total,formattedColumn.total=total;break}}}return acc[col.id]=formattedColumn,acc},{});return{columns:table.columns.filter(col=>formattedColumns[col.id]),rows:table.rows,formattedColumns:formattedColumns}};function tableVisResponseHandler(input,visConfig){const tables=[];let table,direction;const split=visConfig.splitColumn||visConfig.splitRow;if(split){direction=visConfig.splitRow?"row":"column";const splitColumnIndex=split.accessor,splitColumnFormatter=Object(services.a)().deserialize(split.format),splitColumn=input.columns[splitColumnIndex],splitMap={};let splitIndex=0;input.rows.forEach(row=>{const splitValue=row[splitColumn.id];if(!splitMap.hasOwnProperty(splitValue)){splitMap[splitValue]=splitIndex++;const tableGroup={title:`${splitColumnFormatter.convert(splitValue)}: ${splitColumn.name}`,table:{columns:input.columns,rows:[],formattedColumns:{}}};tables.push(tableGroup)}const tableIndex=splitMap[splitValue];tables[tableIndex].table.rows.push(row)}),tables.forEach(tg=>{tg.table=createFormattedTable(tg.table,visConfig),visConfig.percentageCol&&(tg.table=addPercentageColumn(tg.table,visConfig.percentageCol))})}else table=createFormattedTable(input,visConfig),visConfig.percentageCol&&(table=addPercentageColumn(table,visConfig.percentageCol));return{direction:direction,table:table,tables:tables}}},56:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"registerTableVis",(function(){return registerTableVis}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(6),common=__webpack_require__(24),utils=__webpack_require__(26);const createTableVisFn=()=>({name:"kibana_table",type:"render",inputTypes:["datatable"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.help",{defaultMessage:"Table visualization"}),args:{metrics:{types:["vis_dimension"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.metricsHelpText",{defaultMessage:"Metrics dimensions config"}),required:!0,multi:!0},buckets:{types:["vis_dimension"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.bucketsHelpText",{defaultMessage:"Buckets dimensions config"}),multi:!0},splitColumn:{types:["vis_dimension"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.splitColumnHelpText",{defaultMessage:"Split by column dimension config"})},splitRow:{types:["vis_dimension"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.splitRowHelpText",{defaultMessage:"Split by row dimension config"})},percentageCol:{types:["string"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.percentageColHelpText",{defaultMessage:"Name of column to show percentage for"}),default:""},perPage:{types:["number"],default:"",help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.perPageHelpText",{defaultMessage:"The number of rows at a table page is used for pagination"})},row:{types:["boolean"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.rowHelpText",{defaultMessage:'Row value is used for split table mode. Set to "true" to split by row'})},showPartialRows:{types:["boolean"],help:"",default:!1},showMetricsAtAllLevels:{types:["boolean"],help:"",default:!1},showToolbar:{types:["boolean"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.showToolbarHelpText",{defaultMessage:'Set to "true" to show grid\'s toolbar with "Export" button'}),default:!1},showTotal:{types:["boolean"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.showTotalHelpText",{defaultMessage:'Set to "true" to show the total row'}),default:!1},title:{types:["string"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.titleHelpText",{defaultMessage:"The visualization title. The title is used for CSV export as a default file name"})},totalFunc:{types:["string"],help:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.function.args.totalFuncHelpText",{defaultMessage:"Specifies calculating function for the total row. Possible options are: "})}},fn(input,args,handlers){var _handlers$inspectorAd;const convertedData=Object(utils.a)(input,args);return null!=handlers&&null!==(_handlers$inspectorAd=handlers.inspectorAdapters)&&void 0!==_handlers$inspectorAd&&_handlers$inspectorAd.tables&&handlers.inspectorAdapters.tables.logDatatable("default",input),{type:"render",as:"table_vis",value:{visData:convertedData,visType:common.b,visConfig:args}}}});var external_kbnSharedDeps_React_=__webpack_require__(5),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ReactDom_=__webpack_require__(18),public_=__webpack_require__(9);const TableVisualizationComponent=Object(external_kbnSharedDeps_React_.lazy)(()=>__webpack_require__.e(2).then(__webpack_require__.bind(null,55)));var data_public_=__webpack_require__(10),table_vis_options_lazy=__webpack_require__(25),expressions_public_=__webpack_require__(12);const prepareDimension=params=>{const visdimension=Object(expressions_public_.buildExpressionFunction)("visdimension",{accessor:params.accessor});return params.format&&(visdimension.addArgument("format",params.format.id),visdimension.addArgument("formatParams",JSON.stringify(params.format.params))),Object(expressions_public_.buildExpression)([visdimension])},tableVisTypeDefinition={name:common.b,title:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.tableVisTitle",{defaultMessage:"Data table"}),icon:"visTable",description:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.tableVisDescription",{defaultMessage:"Display data in rows and columns."}),getSupportedTriggers:()=>[public_.VIS_EVENT_TO_TRIGGER.filter],visConfig:{defaults:{perPage:10,showPartialRows:!1,showMetricsAtAllLevels:!1,showTotal:!1,showToolbar:!1,totalFunc:"sum",percentageCol:""}},editorConfig:{optionsTemplate:table_vis_options_lazy.a,schemas:[{group:data_public_.AggGroupNames.Metrics,name:"metric",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.metricTitle",{defaultMessage:"Metric"}),aggFilter:["!geo_centroid","!geo_bounds","!filtered_metric","!single_percentile"],aggSettings:{top_hits:{allowStrings:!0}},min:1,defaults:[{type:"count",schema:"metric"}]},{group:data_public_.AggGroupNames.Buckets,name:"bucket",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.bucketTitle",{defaultMessage:"Split rows"}),aggFilter:["!filter"]},{group:data_public_.AggGroupNames.Buckets,name:"split",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.splitTitle",{defaultMessage:"Split table"}),min:0,max:1,aggFilter:["!filter"]}]},toExpressionAst:(vis,params)=>{var _schemas$bucket;const esaggs=Object(expressions_public_.buildExpressionFunction)("esaggs",{index:Object(expressions_public_.buildExpression)([Object(expressions_public_.buildExpressionFunction)("indexPatternLoad",{id:vis.data.indexPattern.id})]),metricsAtAllLevels:vis.isHierarchical(),partialRows:vis.params.showPartialRows,aggs:vis.data.aggs.aggs.map(agg=>Object(expressions_public_.buildExpression)(agg.toExpressionAst()))}),schemas=Object(public_.getVisSchemas)(vis,params),metrics=((schemas,visParams)=>{const metrics=[...schemas.metric];if(schemas.bucket&&visParams.showPartialRows&&!visParams.showMetricsAtAllLevels){const metricsPerBucket=metrics.length/schemas.bucket.length;metrics.splice(0,metricsPerBucket*schemas.bucket.length-metricsPerBucket)}return metrics})(schemas,vis.params),args={perPage:vis.params.perPage,percentageCol:vis.params.percentageCol,row:vis.params.row,showPartialRows:vis.params.showPartialRows,showMetricsAtAllLevels:vis.params.showMetricsAtAllLevels,showToolbar:vis.params.showToolbar,showTotal:vis.params.showTotal,totalFunc:vis.params.totalFunc,title:vis.title,metrics:metrics.map(prepareDimension),buckets:null===(_schemas$bucket=schemas.bucket)||void 0===_schemas$bucket?void 0:_schemas$bucket.map(prepareDimension)},table=Object(expressions_public_.buildExpressionFunction)("kibana_table",args);schemas.split_column&&table.addArgument("splitColumn",prepareDimension(schemas.split_column[0])),schemas.split_row&&table.addArgument("splitRow",prepareDimension(schemas.split_row[0]));return Object(expressions_public_.buildExpression)([esaggs,table]).toAst()},hierarchicalData:vis=>vis.params.showPartialRows||vis.params.showMetricsAtAllLevels,requiresSearch:!0},registerTableVis=async(core,{expressions:expressions,visualizations:visualizations},context)=>{const[coreStart]=await core.getStartServices();expressions.registerFunction(createTableVisFn),expressions.registerRenderer((core=>({name:"table_vis",reuseDomNode:!0,render:async(domNode,{visData:visData,visConfig:visConfig},handlers)=>{var _visData$table;handlers.onDestroy(()=>{Object(external_kbnSharedDeps_ReactDom_.unmountComponentAtNode)(domNode)});const showNoResult=0===(null===(_visData$table=visData.table)||void 0===_visData$table?void 0:_visData$table.rows.length)||!visData.table&&0===visData.tables.length;Object(external_kbnSharedDeps_ReactDom_.render)(external_kbnSharedDeps_React_default.a.createElement(public_.VisualizationContainer,{"data-test-subj":"tbvChartContainer",handlers:handlers,showNoResult:showNoResult},external_kbnSharedDeps_React_default.a.createElement(TableVisualizationComponent,{core:core,handlers:handlers,visData:visData,visConfig:visConfig})),domNode)}}))(coreStart)),visualizations.createBaseVisualization(tableVisTypeDefinition)}}}]);