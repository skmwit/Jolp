(window.visTypeTimeseries_bundle_jsonpfunction=window.visTypeTimeseries_bundle_jsonpfunction||[]).push([[11],{384:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return TopNVisualization}));var services=__webpack_require__(0),tick_formatter=__webpack_require__(54),external_kbnSharedDeps_React_=__webpack_require__(1),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),get_last_value=__webpack_require__(49),label_date_formatter=__webpack_require__(67),empty_label=__webpack_require__(43),lib=__webpack_require__(90),lib_default=__webpack_require__.n(lib);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const RENDER_MODES_POSITIVE="positive",RENDER_MODES_NEGATIVE="negative",RENDER_MODES_MIXED="mixed";class top_n_TopN extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),this.tableRef=external_kbnSharedDeps_React_default.a.createRef(),this.state={labelMaxWidth:150}}get labelMaxWidth(){return.35*this.tableRef.current.offsetWidth}componentDidMount(){this.setState({labelMaxWidth:this.labelMaxWidth})}componentDidUpdate(prevProps,prevState){prevState.labelMaxWidth!==this.labelMaxWidth&&this.setState({labelMaxWidth:this.labelMaxWidth})}handleClick(item){return()=>{this.props.onClick&&this.props.onClick(item)}}renderRow({min:min,max:max}){return item=>{const renderMode=top_n_TopN.getRenderMode(min,max),key=""+(item.id||item.label),lastValue=Object(get_last_value.b)(item.data),formatter=item.tickFormatter||this.props.tickFormatter,isPositiveValue=lastValue>=0,intervalLength=top_n_TopN.calcDomain(renderMode,min,max),width=Math.abs(lastValue)/intervalLength*100||0,label=item.labelFormatted?Object(label_date_formatter.a)(item.labelFormatted):item.label,styles=lib_default()({default:{innerBar:{...top_n_TopN.calcInnerBarStyles(renderMode,isPositiveValue)},innerBarValue:{...top_n_TopN.calcInnerBarDivStyles(item,width,isPositiveValue)},label:{maxWidth:this.state.labelMaxWidth}},onClick:{row:{cursor:"pointer"}}},this.props);return external_kbnSharedDeps_React_default.a.createElement("tr",{key:key,onClick:this.handleClick({lastValue:lastValue,...item}),style:styles.row},external_kbnSharedDeps_React_default.a.createElement("td",{title:item.label,className:"tvbVisTopN__label",style:styles.label},Object(empty_label.b)(label)),external_kbnSharedDeps_React_default.a.createElement("td",{width:"100%",className:"tvbVisTopN__bar"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"tvbVisTopN__innerBar",style:styles.innerBar},external_kbnSharedDeps_React_default.a.createElement("div",{style:styles.innerBarValue}))),external_kbnSharedDeps_React_default.a.createElement("td",{className:"tvbVisTopN__value","data-test-subj":"tsvbTopNValue"},formatter(lastValue)))}}render(){if(!this.props.series)return null;const intervalSettings=this.props.series.reduce((acc,series,index)=>{const value=Object(get_last_value.b)(series.data);return{min:!index||value<acc.min?value:acc.min,max:!index||value>acc.max?value:acc.max}},{min:void 0,max:void 0}),rows=this.props.series.map(this.renderRow(intervalSettings));let className="tvbVisTopN";return this.props.reversed&&(className+=" tvbVisTopN--reversed"),external_kbnSharedDeps_React_default.a.createElement("div",{className:className},external_kbnSharedDeps_React_default.a.createElement("table",{className:"tvbVisTopN__table","data-test-subj":"tvbVisTopNTable",ref:this.tableRef},external_kbnSharedDeps_React_default.a.createElement("tbody",null,rows)))}}_defineProperty(top_n_TopN,"getRenderMode",(min,max)=>min>=0?RENDER_MODES_POSITIVE:max<0?RENDER_MODES_NEGATIVE:RENDER_MODES_MIXED),_defineProperty(top_n_TopN,"calcInnerBarStyles",(renderMode,isPositive)=>renderMode===RENDER_MODES_MIXED?{[isPositive?"marginLeft":"marginRight"]:"50%"}:{}),_defineProperty(top_n_TopN,"calcInnerBarDivStyles",(item,width,isPositive)=>({backgroundColor:item.color,width:width+"%",float:isPositive?"left":"right"})),_defineProperty(top_n_TopN,"calcDomain",(renderMode,min,max)=>renderMode===RENDER_MODES_MIXED?Math.max(max,Math.abs(min)):renderMode===RENDER_MODES_NEGATIVE?Math.abs(min):max),top_n_TopN.defaultProps={tickFormatter:n=>n,onClick:i=>i,direction:"desc"};var set_is_reversed=__webpack_require__(84),replace_vars=__webpack_require__(61),external_kbnSharedDeps_Lodash_=__webpack_require__(7);const OPERATORS={gt:external_kbnSharedDeps_Lodash_.gt,gte:external_kbnSharedDeps_Lodash_.gte,lt:external_kbnSharedDeps_Lodash_.lt,lte:external_kbnSharedDeps_Lodash_.lte};function sortSeries(visData,model){const series=Object(external_kbnSharedDeps_Lodash_.get)(visData,model.id+".series",[]);return model.series.reduce((acc,item)=>{const itemSeries=series.filter(s=>Object(external_kbnSharedDeps_Lodash_.first)(s.id.split(/:/))===item.id),direction=item.terms_direction||"desc";return"_key"===item.terms_order_by?acc.concat(itemSeries):acc.concat(function(data,direction,fn){return"desc"===direction?Object(external_kbnSharedDeps_Lodash_.sortBy)(data,fn).reverse():Object(external_kbnSharedDeps_Lodash_.sortBy)(data,fn)}(itemSeries,direction,s=>Object(get_last_value.b)(s.data)))},[])}function TopNVisualization(props){const{backgroundColor:backgroundColor,model:model,visData:visData}=props,series=sortSeries(visData,model).map(item=>{const id=Object(external_kbnSharedDeps_Lodash_.first)(item.id.split(/:/)),seriesConfig=model.series.find(s=>s.id===id);if(seriesConfig){const tickFormatter=Object(tick_formatter.a)(seriesConfig.formatter,seriesConfig.value_template,props.getConfig),value=Object(get_last_value.b)(item.data);let color=item.color||seriesConfig.color;return model.bar_color_rules&&model.bar_color_rules.forEach(rule=>{rule.operator&&null!=rule.value&&rule.bar_color&&OPERATORS[rule.operator](value,rule.value)&&(color=rule.bar_color)}),{...item,color:color,tickFormatter:tickFormatter}}return item}),panelBackgroundColor=model.background_color||backgroundColor,style={backgroundColor:panelBackgroundColor},params={series:series,reversed:Object(set_is_reversed.b)(panelBackgroundColor)};return model.drilldown_url&&(params.onClick=item=>{const url=Object(replace_vars.a)(model.drilldown_url,{},{key:item.label});Object(services.b)().application.navigateToUrl(url)}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"tvbVis",style:style},external_kbnSharedDeps_React_default.a.createElement(top_n_TopN,params))}},61:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return replaceVars}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(78),handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1__),_common_empty_label__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(43),_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3);function replaceVars(str,args={},vars={}){try{const template=handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1___default.a.compile(str.replace(_common_empty_label__WEBPACK_IMPORTED_MODULE_2__.a,`[${_common_empty_label__WEBPACK_IMPORTED_MODULE_2__.a}]`),{strict:!0,knownHelpersOnly:!0});return template(lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign({},vars,{args:args}))}catch(e){if(-1!==e.toString().indexOf("Parse error"))return str;if(-1!==e.message.indexOf("not defined in")){const badVar=e.message.split(/"/)[1];e.error={caused_by:{reason:_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__.i18n.translate("visTypeTimeseries.replaceVars.errors.unknownVarDescription",{defaultMessage:"{badVar} is an unknown variable",values:{badVar:"{{"+badVar+"}}"}}),title:_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__.i18n.translate("visTypeTimeseries.replaceVars.errors.unknownVarTitle",{defaultMessage:"Error processing your markdown"})}}}else e.error={caused_by:{reason:_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__.i18n.translate("visTypeTimeseries.replaceVars.errors.markdownErrorDescription",{defaultMessage:"Please verify you are only using markdown, known variables, and built-in Handlebars expressions"}),title:_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__.i18n.translate("visTypeTimeseries.replaceVars.errors.markdownErrorTitle",{defaultMessage:"Error processing your markdown"})}};return e}}}}]);