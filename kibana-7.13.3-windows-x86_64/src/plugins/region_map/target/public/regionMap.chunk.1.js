(window.regionMap_bundle_jsonpfunction=window.regionMap_bundle_jsonpfunction||[]).push([[1],{18:function(module,exports,__webpack_require__){"use strict";var memo,isOldIE=function(){return void 0===memo&&(memo=Boolean(window&&document&&document.all&&!window.atob)),memo},getTarget=function(){var memo={};return function(target){if(void 0===memo[target]){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}}(),stylesInDom=[];function getIndexByIdentifier(identifier){for(var result=-1,i=0;i<stylesInDom.length;i++)if(stylesInDom[i].identifier===identifier){result=i;break}return result}function modulesToDom(list,options){for(var idCountMap={},identifiers=[],i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],count=idCountMap[id]||0,identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var index=getIndexByIdentifier(identifier),obj={css:item[1],media:item[2],sourceMap:item[3]};-1!==index?(stylesInDom[index].references++,stylesInDom[index].updater(obj)):stylesInDom.push({identifier:identifier,updater:addStyle(obj,options),references:1}),identifiers.push(identifier)}return identifiers}function insertStyleElement(options){var style=document.createElement("style"),attributes=options.attributes||{};if(void 0===attributes.nonce){var nonce=__webpack_require__.nc;nonce&&(attributes.nonce=nonce)}if(Object.keys(attributes).forEach((function(key){style.setAttribute(key,attributes[key])})),"function"==typeof options.insert)options.insert(style);else{var target=getTarget(options.insert||"head");if(!target)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");target.appendChild(style)}return style}var textStore,replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")});function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.media?"@media ".concat(obj.media," {").concat(obj.css,"}"):obj.css;if(style.styleSheet)style.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=style.childNodes;childNodes[index]&&style.removeChild(childNodes[index]),childNodes.length?style.insertBefore(cssNode,childNodes[index]):style.appendChild(cssNode)}}function applyToTag(style,options,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media?style.setAttribute("media",media):style.removeAttribute("media"),sourceMap&&btoa&&(css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")),style.styleSheet)style.styleSheet.cssText=css;else{for(;style.firstChild;)style.removeChild(style.firstChild);style.appendChild(document.createTextNode(css))}}var singleton=null,singletonCounter=0;function addStyle(obj,options){var style,update,remove;if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=insertStyleElement(options)),update=applyToSingletonTag.bind(null,style,styleIndex,!1),remove=applyToSingletonTag.bind(null,style,styleIndex,!0)}else style=insertStyleElement(options),update=applyToTag.bind(null,style,options),remove=function(){!function(style){if(null===style.parentNode)return!1;style.parentNode.removeChild(style)}(style)};return update(obj),function(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}module.exports=function(list,options){(options=options||{}).singleton||"boolean"==typeof options.singleton||(options.singleton=isOldIE());var lastIdentifiers=modulesToDom(list=list||[],options);return function(newList){if(newList=newList||[],"[object Array]"===Object.prototype.toString.call(newList)){for(var i=0;i<lastIdentifiers.length;i++){var index=getIndexByIdentifier(lastIdentifiers[i]);stylesInDom[index].references--}for(var newLastIdentifiers=modulesToDom(newList,options),_i=0;_i<lastIdentifiers.length;_i++){var _index=getIndexByIdentifier(lastIdentifiers[_i]);0===stylesInDom[_index].references&&(stylesInDom[_index].updater(),stylesInDom.splice(_index,1))}lastIdentifiers=newLastIdentifiers}}}},19:function(module,exports,__webpack_require__){"use strict";module.exports=function(useSourceMap){var list=[];return list.toString=function(){return this.map((function(item){var content=function(item,useSourceMap){var content=item[1]||"",cssMapping=item[3];if(!cssMapping)return content;if(useSourceMap&&"function"==typeof btoa){var sourceMapping=(sourceMap=cssMapping,base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64),"/*# ".concat(data," */")),sourceURLs=cssMapping.sources.map((function(source){return"/*# sourceURL=".concat(cssMapping.sourceRoot||"").concat(source," */")}));return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}var sourceMap,base64,data;return[content].join("\n")}(item,useSourceMap);return item[2]?"@media ".concat(item[2]," {").concat(content,"}"):content})).join("")},list.i=function(modules,mediaQuery,dedupe){"string"==typeof modules&&(modules=[[null,modules,""]]);var alreadyImportedModules={};if(dedupe)for(var i=0;i<this.length;i++){var id=this[i][0];null!=id&&(alreadyImportedModules[id]=!0)}for(var _i=0;_i<modules.length;_i++){var item=[].concat(modules[_i]);dedupe&&alreadyImportedModules[item[0]]||(mediaQuery&&(item[2]?item[2]="".concat(mediaQuery," and ").concat(item[2]):item[2]=mediaQuery),list.push(item))}},list}},20:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(21);case"v7light":return __webpack_require__(23);case"v8dark":return __webpack_require__(25);case"v8light":return __webpack_require__(27)}},21:function(module,exports,__webpack_require__){var api=__webpack_require__(18),content=__webpack_require__(22);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},22:function(module,exports,__webpack_require__){(exports=__webpack_require__(19)(!1)).push([module.i,".rgmChart__wrapper,.rgmChart{flex:1 1 0;display:flex}\n",""]),module.exports=exports},23:function(module,exports,__webpack_require__){var api=__webpack_require__(18),content=__webpack_require__(24);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},24:function(module,exports,__webpack_require__){(exports=__webpack_require__(19)(!1)).push([module.i,".rgmChart__wrapper,.rgmChart{flex:1 1 0;display:flex}\n",""]),module.exports=exports},25:function(module,exports,__webpack_require__){var api=__webpack_require__(18),content=__webpack_require__(26);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},26:function(module,exports,__webpack_require__){(exports=__webpack_require__(19)(!1)).push([module.i,".rgmChart__wrapper,.rgmChart{flex:1 1 0;display:flex}\n",""]),module.exports=exports},27:function(module,exports,__webpack_require__){var api=__webpack_require__(18),content=__webpack_require__(28);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},28:function(module,exports,__webpack_require__){(exports=__webpack_require__(19)(!1)).push([module.i,".rgmChart__wrapper,.rgmChart{flex:1 1 0;display:flex}\n",""]),module.exports=exports},33:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return RegionMapVisualization}));var external_kbnSharedDeps_React_=__webpack_require__(2),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(13),external_kbnSharedDeps_Lodash_=__webpack_require__(14),external_kbnSharedDeps_KbnI18n_=__webpack_require__(1),kibana_services=__webpack_require__(0),public_=__webpack_require__(12);function tooltipFormatter(metric,fieldFormatter,fieldName,metricName){if(!metric)return"";const details=[];return fieldName&&metric&&details.push({label:fieldName,value:metric.term}),metric&&details.push({label:metricName,value:fieldFormatter?fieldFormatter.convert(metric.value,"text"):metric.value}),details}var mapsLegacy_public_=__webpack_require__(8),mapsEms_public_=__webpack_require__(5);__webpack_require__(20);const RegionMapVisualization=({deps:deps,handlers:handlers,visData:visData,visConfig:visConfig})=>{const chartDiv=Object(external_kbnSharedDeps_React_.useRef)(null),visController=Object(external_kbnSharedDeps_React_.useRef)(null),isFirstRender=Object(external_kbnSharedDeps_React_.useRef)(!0),uiState=handlers.uiState;Object(external_kbnSharedDeps_React_.useEffect)(()=>{if(chartDiv.current&&isFirstRender.current){isFirstRender.current=!1;const Controller=function({regionmapsConfig:regionmapsConfig,uiSettings:uiSettings,BaseMapsVisualization:BaseMapsVisualization,getServiceSettings:getServiceSettings}){return class extends BaseMapsVisualization{constructor(container,handlers,initialVisParams){super(container,handlers,initialVisParams),this._choroplethLayer=null,this._tooltipFormatter=Object(mapsLegacy_public_.mapTooltipProvider)(container,tooltipFormatter)}async render(esResponse,visParams){Object(kibana_services.c)().loadFontAwesome(),await super.render(esResponse,visParams),this._choroplethLayer&&await this._choroplethLayer.whenDataLoaded()}async _updateData(table){this._chartData=table;const termColumn=this._params.bucket?table.columns[this._params.bucket.accessor]:null,valueColumn=table.columns[this._params.metric.accessor];let results;results=this._hasColumns()&&table.rows.length?table.rows.map(row=>({term:row[termColumn.id],value:row[valueColumn.id]})):[];const selectedLayer=await this._loadConfig(this._params.selectedLayer);if(!this._params.selectedJoinField&&selectedLayer&&(this._params.selectedJoinField=selectedLayer.fields[0]),!selectedLayer)return;await this._updateChoroplethLayerForNewMetrics(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes,results);const metricFieldFormatter=Object(kibana_services.b)().deserialize(this._params.metric.format);this._choroplethLayer.setMetrics(results,metricFieldFormatter,valueColumn.name),termColumn&&valueColumn&&this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,termColumn.name,valueColumn.name),this._kibanaMap.useUiStateFromVisualization(this.handlers.uiState)}async _loadConfig(fileLayerConfig){const{escape:escape}=await Promise.resolve().then(__webpack_require__.t.bind(null,14,7));if(fileLayerConfig.isEMS||fileLayerConfig.layerId&&fileLayerConfig.layerId.startsWith(mapsEms_public_.ORIGIN.EMS+".")){const serviceSettings=await getServiceSettings();return await serviceSettings.loadFileLayerConfig(fileLayerConfig)}const configuredLayer=regionmapsConfig.layers.find(layer=>layer.name===fileLayerConfig.name);return configuredLayer?{...configuredLayer,attribution:escape(configuredLayer.attribution?configuredLayer.attribution:"")}:null}async _updateParams(){await super._updateParams();const selectedLayer=await this._loadConfig(this._params.selectedLayer);if(!this._params.selectedJoinField&&selectedLayer&&(this._params.selectedJoinField=selectedLayer.fields[0]),!this._params.selectedJoinField||!selectedLayer)return;await this._updateChoroplethLayerForNewProperties(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes);const metricFieldFormatter=Object(kibana_services.b)().deserialize(this._params.metric.format);this._choroplethLayer.setJoinField(this._params.selectedJoinField.name),this._choroplethLayer.setColorRamp(public_.truncatedColorMaps[this._params.colorSchema].value),this._choroplethLayer.setLineWeight(this._params.outlineWeight),this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,this._metricLabel)}async _updateChoroplethLayerForNewMetrics(name,attribution,showAllData,newMetrics){this._choroplethLayer&&this._choroplethLayer.canReuseInstanceForNewMetrics(name,showAllData,newMetrics)||await this._recreateChoroplethLayer(name,attribution,showAllData)}async _updateChoroplethLayerForNewProperties(name,attribution,showAllData){this._choroplethLayer&&this._choroplethLayer.canReuseInstance(name,showAllData)||await this._recreateChoroplethLayer(name,attribution,showAllData)}async _recreateChoroplethLayer(name,attribution,showAllData){const selectedLayer=await this._loadConfig(this._params.selectedLayer);if(this._kibanaMap.removeLayer(this._choroplethLayer),this._choroplethLayer)this._choroplethLayer=this._choroplethLayer.cloneChoroplethLayerForNewData(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(mapsLegacy_public_.lazyLoadMapsLegacyModules)()).L);else{const{ChoroplethLayer:ChoroplethLayer}=await __webpack_require__.e(2).then(__webpack_require__.bind(null,32));this._choroplethLayer=new ChoroplethLayer(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(mapsLegacy_public_.lazyLoadMapsLegacyModules)()).L)}this._choroplethLayer.on("select",event=>{const{rows:rows,columns:columns}=this._chartData,rowIndex=rows.findIndex(row=>row[columns[0].id]===event);this.handlers.event({name:"filterBucket",data:{data:[{table:this._chartData,column:0,row:rowIndex,value:event}]}})}),this._choroplethLayer.on("styleChanged",event=>{const shouldShowWarning=this._params.isDisplayWarning&&uiSettings.get("visualization:regionmap:showWarnings");event.mismatches.length>0&&shouldShowWarning&&Object(kibana_services.d)().toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("regionMap.visualization.unableToShowMismatchesWarningTitle",{defaultMessage:"Unable to show {mismatchesLength} {oneMismatch, plural, one {result} other {results}} on map",values:{mismatchesLength:event.mismatches.length,oneMismatch:event.mismatches.length>1?0:1}}),text:external_kbnSharedDeps_KbnI18n_.i18n.translate("regionMap.visualization.unableToShowMismatchesWarningText",{defaultMessage:"Ensure that each of these term matches a shape on that shape's join field: {mismatches}",values:{mismatches:event.mismatches?event.mismatches.join(", "):""}})})}),this._kibanaMap.addLayer(this._choroplethLayer)}_hasColumns(){return this._chartData&&2===this._chartData.columns.length}}}(deps);visController.current=new Controller(chartDiv.current,handlers,visConfig)}},[deps,handlers,visConfig,visData]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{var _visController$curren;null===(_visController$curren=visController.current)||void 0===_visController$curren||_visController$curren.render(visData,visConfig).then(handlers.done)},[visData,visConfig,handlers.done]),Object(external_kbnSharedDeps_React_.useEffect)(()=>{const onUiStateChange=()=>{var _visController$curren2;null===(_visController$curren2=visController.current)||void 0===_visController$curren2||_visController$curren2.render().then(handlers.done)};return null==uiState||uiState.on("change",onUiStateChange),()=>{null==uiState||uiState.off("change",onUiStateChange)}},[uiState,handlers.done]),Object(external_kbnSharedDeps_React_.useEffect)(()=>()=>{var _visController$curren3;null===(_visController$curren3=visController.current)||void 0===_visController$curren3||_visController$curren3.destroy(),visController.current=null},[]);const updateChartSize=Object(external_kbnSharedDeps_React_.useMemo)(()=>Object(external_kbnSharedDeps_Lodash_.throttle)(()=>{var _visController$curren4;return null===(_visController$curren4=visController.current)||void 0===_visController$curren4?void 0:_visController$curren4.resize()},300),[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiResizeObserver,{onResize:updateChartSize},resizeRef=>external_kbnSharedDeps_React_default.a.createElement("div",{className:"rgmChart__wrapper",ref:resizeRef},external_kbnSharedDeps_React_default.a.createElement("div",{className:"rgmChart",ref:chartDiv})))}}}]);