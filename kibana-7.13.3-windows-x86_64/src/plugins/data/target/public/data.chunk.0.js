(window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[]).push([[0,11],{167:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)&&arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}return classes.join(" ")}module.exports?(classNames.default=classNames,module.exports=classNames):void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},170:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return query_string_input_QueryStringInputUI}));var external_kbnSharedDeps_React_=__webpack_require__(3),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0),classnames=__webpack_require__(167),classnames_default=__webpack_require__.n(classnames),external_kbnSharedDeps_ElasticEui_=__webpack_require__(11),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(16),external_kbnSharedDeps_Lodash_=__webpack_require__(2),external_kbnSharedDeps_KbnAnalytics_=__webpack_require__(159),autocomplete=__webpack_require__(35),public_=__webpack_require__(25);function QueryLanguageSwitcher({language:language,anchorPosition:anchorPosition,onSelectLanguage:onSelectLanguage,nonKqlMode:nonKqlMode="lucene",nonKqlModeHelpText:nonKqlModeHelpText}){const kueryQuerySyntaxDocs=Object(public_.useKibana)().services.docLinks.links.query.kueryQuerySyntax,[isPopoverOpen,setIsPopoverOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),luceneLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.luceneLanguageName",defaultMessage:"Lucene"}),kqlLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.kqlLanguageName",defaultMessage:"KQL"}),kqlFullName=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.kqlFullLanguageName",defaultMessage:"Kibana Query Language"}),kqlModeTitle=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.languageSwitcher.toText",{defaultMessage:"Switch to Kibana Query Language for search"}),button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",onClick:()=>setIsPopoverOpen(!isPopoverOpen),className:"euiFormControlLayout__append kqlQueryBar__languageSwitcherButton","data-test-subj":"switchQueryLanguageButton"},"kuery"===language?kqlLabel:"lucene"===nonKqlMode?luceneLabel:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"boxesVertical",title:kqlModeTitle,"aria-label":kqlModeTitle}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"queryLanguageSwitcherPopover",anchorClassName:"euiFormControlLayout__append",anchorPosition:anchorPosition||"downRight",button:button,isOpen:isPopoverOpen,closePopover:()=>setIsPopoverOpen(!1),repositionOnScroll:!0,ownFocus:!0,initialFocus:'[role="switch"]'},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverTitle,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.syntaxOptionsTitle",defaultMessage:"Syntax options"})),external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"350px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.syntaxOptionsDescription",defaultMessage:"The {docsLink} (KQL) offers a simplified query syntax and support for scripted fields. KQL also provides autocomplete. If you turn off KQL, {nonKqlModeHelpText}",values:{docsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{href:kueryQuerySyntaxDocs,target:"_blank"},kqlFullName),nonKqlModeHelpText:nonKqlModeHelpText||external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.syntaxOptionsDescription.nonKqlModeHelpText",{defaultMessage:"Kibana uses Lucene."})}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:kqlFullName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{id:"queryEnhancementOptIn",name:"popswitch",label:"kuery"===language?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.kqlOnLabel",defaultMessage:"On"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.kqlOffLabel",defaultMessage:"Off"}),checked:"kuery"===language,onChange:()=>{onSelectLanguage("kuery"===language?nonKqlMode:"kuery")},"data-test-subj":"languageToggle"})))))}var public_query=__webpack_require__(15),ui=__webpack_require__(36),common=__webpack_require__(1);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const KEY_CODES={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,TAB:9,HOME:36,END:35};class query_string_input_QueryStringInputUI extends external_kbnSharedDeps_React_.Component{constructor(...args){var _this$services$usageC;super(...args),_defineProperty(this,"state",{isSuggestionsVisible:!1,index:null,suggestions:[],suggestionLimit:50,selectionStart:null,selectionEnd:null,indexPatterns:[],queryBarRect:void 0}),_defineProperty(this,"inputRef",null),_defineProperty(this,"persistedLog",void 0),_defineProperty(this,"abortController",void 0),_defineProperty(this,"fetchIndexPatternsAbortController",void 0),_defineProperty(this,"services",this.props.kibana.services),_defineProperty(this,"reportUiCounter",null===(_this$services$usageC=this.services.usageCollection)||void 0===_this$services$usageC?void 0:_this$services$usageC.reportUiCounter.bind(this.services.usageCollection,this.services.appName)),_defineProperty(this,"componentIsUnmounting",!1),_defineProperty(this,"queryBarInputDivRefInstance",Object(external_kbnSharedDeps_React_.createRef)()),_defineProperty(this,"isFocusWithin",!1),_defineProperty(this,"getQueryString",()=>Object(public_query.B)(this.props.query.query)),_defineProperty(this,"fetchIndexPatterns",Object(external_kbnSharedDeps_Lodash_.debounce)(async()=>{const stringPatterns=this.props.indexPatterns.filter(indexPattern=>"string"==typeof indexPattern),objectPatterns=this.props.indexPatterns.filter(indexPattern=>"string"!=typeof indexPattern);this.fetchIndexPatternsAbortController&&this.fetchIndexPatternsAbortController.abort(),this.fetchIndexPatternsAbortController=new AbortController;const currentAbortController=this.fetchIndexPatternsAbortController,objectPatternsFromStrings=await async function(indexPatternsService,indexPatternStrings){if(!indexPatternStrings||Object(external_kbnSharedDeps_Lodash_.isEmpty)(indexPatternStrings))return[];const searchString=indexPatternStrings.map(string=>`"${string}"`).join(" | "),exactMatches=(await indexPatternsService.find(searchString)).filter(ip=>indexPatternStrings.includes(ip.title));return exactMatches.length===indexPatternStrings.length?exactMatches:[...exactMatches,await indexPatternsService.getDefault()]}(this.services.data.indexPatterns,stringPatterns);currentAbortController.signal.aborted||(this.setState({indexPatterns:[...objectPatterns,...objectPatternsFromStrings]}),this.updateSuggestions())},200)),_defineProperty(this,"getSuggestions",async()=>{if(!this.inputRef)return;const language=this.props.query.language,queryString=this.getQueryString(),recentSearchSuggestions=this.getRecentSearchSuggestions(queryString);if(!this.services.data.autocomplete.hasQuerySuggestions(language)||!Array.isArray(this.state.indexPatterns)||0===Object(external_kbnSharedDeps_Lodash_.compact)(this.state.indexPatterns).length)return recentSearchSuggestions;const indexPatterns=this.state.indexPatterns,{selectionStart:selectionStart,selectionEnd:selectionEnd}=this.inputRef;if(null!==selectionStart&&null!==selectionEnd)try{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;return[...await this.services.data.autocomplete.getQuerySuggestions({language:language,indexPatterns:indexPatterns,query:queryString,selectionStart:selectionStart,selectionEnd:selectionEnd,signal:this.abortController.signal})||[],...recentSearchSuggestions]}catch(e){var _this$reportUiCounter;if("The user aborted a request."===e.message)return;throw null===(_this$reportUiCounter=this.reportUiCounter)||void 0===_this$reportUiCounter||_this$reportUiCounter.call(this,external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.LOADED,"query_string:suggestions_error"),e}}),_defineProperty(this,"getRecentSearchSuggestions",query=>{if(!this.persistedLog)return[];return this.persistedLog.get().filter(recentQuery=>{const recentQueryString="object"==typeof recentQuery?Object(public_query.B)(recentQuery):recentQuery;return""!==recentQueryString&&recentQueryString.includes(query)}).map(recentSearch=>{const text=Object(public_query.B)(recentSearch),end=query.length;return{type:autocomplete.h.RecentSearch,text:text,start:0,end:end}})}),_defineProperty(this,"updateSuggestions",Object(external_kbnSharedDeps_Lodash_.debounce)(async()=>{const suggestions=await this.getSuggestions()||[];this.componentIsUnmounting||this.setState({suggestions:suggestions})},100)),_defineProperty(this,"onSubmit",query=>{this.props.onSubmit&&(this.persistedLog&&this.persistedLog.add(query.query),this.props.onSubmit({query:Object(public_query.t)(query.query),language:query.language}))}),_defineProperty(this,"onChange",query=>{this.updateSuggestions(),this.props.onChange&&this.props.onChange({query:Object(public_query.t)(query.query),language:query.language})}),_defineProperty(this,"onQueryStringChange",value=>{this.setState({isSuggestionsVisible:!0,index:null,suggestionLimit:50}),this.onChange({query:value,language:this.props.query.language})}),_defineProperty(this,"onInputChange",event=>{const value=this.formatTextAreaValue(event.target.value);this.onQueryStringChange(value),""===event.target.value?this.handleRemoveHeight():this.handleAutoHeight()}),_defineProperty(this,"onClickInput",event=>{if(event.target instanceof HTMLTextAreaElement){const value=this.formatTextAreaValue(event.target.value);this.onQueryStringChange(value)}}),_defineProperty(this,"onKeyUp",event=>{if([KEY_CODES.LEFT,KEY_CODES.RIGHT,KEY_CODES.HOME,KEY_CODES.END].includes(event.keyCode)&&(this.setState({isSuggestionsVisible:!0}),event.target instanceof HTMLTextAreaElement)){const value=this.formatTextAreaValue(event.target.value);this.onQueryStringChange(value)}}),_defineProperty(this,"onKeyDown",event=>{if(event.target instanceof HTMLTextAreaElement){const{isSuggestionsVisible:isSuggestionsVisible,index:index}=this.state,preventDefault=event.preventDefault.bind(event),{target:target,key:key,metaKey:metaKey}=event,{value:value,selectionStart:selectionStart,selectionEnd:selectionEnd}=target,updateQuery=(query,newSelectionStart,newSelectionEnd)=>{this.onQueryStringChange(query),this.setState({selectionStart:newSelectionStart,selectionEnd:newSelectionEnd})};switch(event.keyCode){case KEY_CODES.DOWN:isSuggestionsVisible&&null!==index?(event.preventDefault(),this.incrementIndex(index)):(isSuggestionsVisible&&null==index||""===this.getQueryString())&&(event.preventDefault(),this.setState({isSuggestionsVisible:!0,index:0}));break;case KEY_CODES.UP:isSuggestionsVisible&&null!==index&&(event.preventDefault(),this.decrementIndex(index));break;case KEY_CODES.ENTER:this.props.bubbleSubmitEvent||event.preventDefault(),isSuggestionsVisible&&null!==index&&this.state.suggestions[index]?(event.preventDefault(),this.selectSuggestion(this.state.suggestions[index],index)):(this.onSubmit(this.props.query),this.setState({isSuggestionsVisible:!1}));break;case KEY_CODES.ESC:event.preventDefault(),this.setState({isSuggestionsVisible:!1,index:null});break;case KEY_CODES.TAB:this.setState({isSuggestionsVisible:!1,index:null});break;default:null!==selectionStart&&null!==selectionEnd&&Object(public_query.y)({value:value,selectionStart:selectionStart,selectionEnd:selectionEnd,key:key,metaKey:metaKey,updateQuery:updateQuery,preventDefault:preventDefault})}}}),_defineProperty(this,"selectSuggestion",(suggestion,listIndex)=>{var _this$reportUiCounter2,_this$reportUiCounter3;if(!this.inputRef)return;const{type:type,text:text,start:start,end:end,cursorIndex:cursorIndex}=suggestion;this.handleNestedFieldSyntaxNotification(suggestion);const query=this.getQueryString(),{selectionStart:selectionStart,selectionEnd:selectionEnd}=this.inputRef;if(null===selectionStart||null===selectionEnd)return;const value=query.substr(0,selectionStart)+query.substr(selectionEnd),newQueryString=value.substr(0,start)+text+value.substr(end);null===(_this$reportUiCounter2=this.reportUiCounter)||void 0===_this$reportUiCounter2||_this$reportUiCounter2.call(this,external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,`query_string:${type}:suggestions_select_position_${listIndex}`),null===(_this$reportUiCounter3=this.reportUiCounter)||void 0===_this$reportUiCounter3||_this$reportUiCounter3.call(this,external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,`query_string:${type}:suggestions_select_q_length_${end-start}`),this.onQueryStringChange(newQueryString),this.setState({selectionStart:start+(cursorIndex||text.length),selectionEnd:start+(cursorIndex||text.length)});const isTypeRecentSearch=type===autocomplete.h.RecentSearch,isAutoSubmitAndValid=this.props.autoSubmit&&(type===autocomplete.h.Value||[":*",": *"].includes(value.trim()));(isTypeRecentSearch||isAutoSubmitAndValid)&&(this.setState({isSuggestionsVisible:!1,index:null}),this.onSubmit({query:newQueryString,language:this.props.query.language}))}),_defineProperty(this,"handleNestedFieldSyntaxNotification",suggestion=>{if("field"in suggestion&&suggestion.field.subType&&suggestion.field.subType.nested&&!this.services.storage.get("kibana.KQLNestedQuerySyntaxInfoOptOut")){const{notifications:notifications,docLinks:docLinks}=this.services,onKQLNestedQuerySyntaxInfoOptOut=toast=>{this.services.storage&&(this.services.storage.set("kibana.KQLNestedQuerySyntaxInfoOptOut",!0),notifications.toasts.remove(toast))};if(notifications&&docLinks){const toast=notifications.toasts.add({title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.KQLNestedQuerySyntaxInfoTitle",{defaultMessage:"KQL nested query syntax"}),text:Object(public_.toMountPoint)(external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoText",defaultMessage:"It looks like you're querying on a nested field. You can construct KQL syntax for nested queries in different ways, depending on the results you want. Learn more in our {link}.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiLink,{href:docLinks.links.query.kueryQuerySyntax,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoDocLinkText",defaultMessage:"docs"}))}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{size:"s",onClick:()=>onKQLNestedQuerySyntaxInfoOptOut(toast)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoOptOutText",defaultMessage:"Don't show again"}))))))})}}}),_defineProperty(this,"increaseLimit",()=>{this.setState({suggestionLimit:this.state.suggestionLimit+50})}),_defineProperty(this,"incrementIndex",currentIndex=>{let nextIndex=currentIndex+1;(null===currentIndex||nextIndex>=this.state.suggestions.length)&&(nextIndex=0),this.setState({index:nextIndex})}),_defineProperty(this,"decrementIndex",currentIndex=>{const previousIndex=currentIndex-1;previousIndex<0?this.setState({index:this.state.suggestions.length-1}):this.setState({index:previousIndex})}),_defineProperty(this,"onSelectLanguage",language=>{var _this$reportUiCounter4;this.services.http.post("/api/kibana/kql_opt_in_stats",{body:JSON.stringify({opt_in:"kuery"===language})});const storageKey=this.props.storageKey;this.services.storage.set(storageKey,language);const newQuery={query:"",language:language};this.onChange(newQuery),this.onSubmit(newQuery),null===(_this$reportUiCounter4=this.reportUiCounter)||void 0===_this$reportUiCounter4||_this$reportUiCounter4.call(this,external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.LOADED,storageKey?`${storageKey}:language:${language}`:"query_string:language:"+language)}),_defineProperty(this,"onOutsideClick",()=>{this.state.isSuggestionsVisible&&(this.setState({isSuggestionsVisible:!1,index:null}),this.scheduleOnInputBlur())}),_defineProperty(this,"blurTimeoutHandle",void 0),_defineProperty(this,"scheduleOnInputBlur",()=>{clearTimeout(this.blurTimeoutHandle),this.blurTimeoutHandle=window.setTimeout(()=>{this.isFocusWithin||this.state.isSuggestionsVisible||this.componentIsUnmounting||(this.handleBlurHeight(),this.props.onChangeQueryInputFocus&&this.props.onChangeQueryInputFocus(!1),this.props.submitOnBlur&&this.onSubmit(this.props.query))},50)}),_defineProperty(this,"onInputBlur",()=>{Object(external_kbnSharedDeps_Lodash_.isFunction)(this.props.onBlur)&&this.props.onBlur()}),_defineProperty(this,"onClickSuggestion",(suggestion,index)=>{this.inputRef&&(this.selectSuggestion(suggestion,index),this.inputRef.focus())}),_defineProperty(this,"initPersistedLog",()=>{const{uiSettings:uiSettings,storage:storage,appName:appName}=this.services;this.persistedLog=this.props.persistedLog?this.props.persistedLog:Object(public_query.w)(uiSettings,storage,appName,this.props.query.language)}),_defineProperty(this,"onMouseEnterSuggestion",index=>{this.setState({index:index})}),_defineProperty(this,"textareaId",Object(external_kbnSharedDeps_ElasticEui_.htmlIdGenerator)()()),_defineProperty(this,"handleListUpdate",()=>{var _this$queryBarInputDi;if(!this.componentIsUnmounting)return this.setState({queryBarRect:null===(_this$queryBarInputDi=this.queryBarInputDivRefInstance.current)||void 0===_this$queryBarInputDi?void 0:_this$queryBarInputDi.getBoundingClientRect()})}),_defineProperty(this,"handleAutoHeight",()=>{null!==this.inputRef&&document.activeElement===this.inputRef&&(this.inputRef.classList.add("kbnQueryBar__textarea--autoHeight"),this.inputRef.style.setProperty("height",this.inputRef.scrollHeight+"px","important")),this.handleListUpdate()}),_defineProperty(this,"handleRemoveHeight",()=>{null!==this.inputRef&&(this.inputRef.style.removeProperty("height"),this.inputRef.classList.remove("kbnQueryBar__textarea--autoHeight"))}),_defineProperty(this,"handleBlurHeight",()=>{null!==this.inputRef&&(this.handleRemoveHeight(),this.inputRef.scrollTop=0)}),_defineProperty(this,"handleOnFocus",()=>{this.props.onChangeQueryInputFocus&&this.props.onChangeQueryInputFocus(!0),requestAnimationFrame(()=>{this.handleAutoHeight()})})}componentDidMount(){const parsedQuery=Object(public_query.t)(Object(public_query.B)(this.props.query.query));Object(external_kbnSharedDeps_Lodash_.isEqual)(this.props.query.query,parsedQuery)||this.onChange({...this.props.query,query:parsedQuery}),this.initPersistedLog(),this.fetchIndexPatterns(),this.handleListUpdate(),window.addEventListener("resize",this.handleAutoHeight),window.addEventListener("scroll",this.handleListUpdate,{passive:!0,capture:!0})}componentDidUpdate(prevProps){const parsedQuery=Object(public_query.t)(Object(public_query.B)(this.props.query.query));Object(external_kbnSharedDeps_Lodash_.isEqual)(this.props.query.query,parsedQuery)||this.onChange({...this.props.query,query:parsedQuery}),this.initPersistedLog(),Object(external_kbnSharedDeps_Lodash_.isEqual)(prevProps.indexPatterns,this.props.indexPatterns)?Object(external_kbnSharedDeps_Lodash_.isEqual)(prevProps.query,this.props.query)||this.updateSuggestions():this.fetchIndexPatterns(),null!==this.state.selectionStart&&null!==this.state.selectionEnd&&(null!=this.inputRef&&this.inputRef.setSelectionRange(this.state.selectionStart,this.state.selectionEnd),this.setState({selectionStart:null,selectionEnd:null}),null!==document.activeElement&&document.activeElement.id===this.textareaId?this.handleAutoHeight():this.handleRemoveHeight())}componentWillUnmount(){this.abortController&&this.abortController.abort(),this.updateSuggestions.cancel&&this.updateSuggestions.cancel(),this.componentIsUnmounting=!0,window.removeEventListener("resize",this.handleAutoHeight),window.removeEventListener("scroll",this.handleListUpdate,{capture:!0})}render(){const ariaCombobox={...this.state.isSuggestionsVisible&&{"aria-controls":"kbnTypeahead__items","aria-owns":"kbnTypeahead__items"},role:"combobox"},containerClassName=classnames_default()("euiFormControlLayout euiFormControlLayout--group kbnQueryBar__wrap",this.props.className),inputClassName=classnames_default()("kbnQueryBar__textarea",this.props.iconType?"kbnQueryBar__textarea--withIcon":null,this.props.prepend?"kbnQueryBar__textarea--hasPrepend":null,this.props.disableLanguageSwitcher?null:"kbnQueryBar__textarea--hasAppend"),inputWrapClassName=classnames_default()("euiFormControlLayout__childrenWrapper kbnQueryBar__textareaWrap",this.props.prepend?"kbnQueryBar__textareaWrap--hasPrepend":null,this.props.disableLanguageSwitcher?null:"kbnQueryBar__textareaWrap--hasAppend");return external_kbnSharedDeps_React_default.a.createElement("div",{className:containerClassName,onFocus:e=>{this.isFocusWithin=!0},onBlur:e=>{this.isFocusWithin=!1,this.scheduleOnInputBlur()}},this.props.prepend,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiOutsideClickDetector,{onOutsideClick:this.onOutsideClick},external_kbnSharedDeps_React_default.a.createElement("div",_extends({},ariaCombobox,{style:{position:"relative",width:"100%"},"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.comboboxAriaLabel",{defaultMessage:"Search and filter the {pageType} page",values:{pageType:this.services.appName}}),"aria-haspopup":"true","aria-expanded":this.state.isSuggestionsVisible,"data-skip-axe":"aria-required-children"}),external_kbnSharedDeps_React_default.a.createElement("div",{role:"search",className:inputWrapClassName,ref:this.queryBarInputDivRefInstance},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTextArea,{placeholder:this.props.placeholder||external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.searchInputPlaceholder",{defaultMessage:"Search"}),value:this.forwardNewValueIfNeeded(this.getQueryString()),onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onChange:this.onInputChange,onClick:this.onClickInput,onBlur:this.onInputBlur,onFocus:this.handleOnFocus,className:inputClassName,fullWidth:!0,rows:1,id:this.textareaId,autoFocus:!this.props.onChangeQueryInputFocus&&!this.props.disableAutoFocus,inputRef:node=>{node&&(this.inputRef=node)},autoComplete:"off",spellCheck:!1,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.searchInputAriaLabel",{defaultMessage:"Start typing to search and filter the {pageType} page",values:{pageType:this.services.appName}}),"aria-autocomplete":"list","aria-controls":this.state.isSuggestionsVisible?"kbnTypeahead__items":void 0,"aria-activedescendant":this.state.isSuggestionsVisible&&"number"==typeof this.state.index?"suggestion-"+this.state.index:void 0,role:"textbox","data-test-subj":this.props.dataTestSubj||"queryInput",isInvalid:this.props.isInvalid},this.forwardNewValueIfNeeded(this.getQueryString())),this.props.iconType?external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiFormControlLayoutIcons"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{className:"euiFormControlLayoutCustomIcon__icon","aria-hidden":"true",type:this.props.iconType})):null,this.props.isClearable&&this.props.query.query?external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiFormControlLayoutIcons euiFormControlLayoutIcons--right"},external_kbnSharedDeps_React_default.a.createElement("button",{type:"button",className:"euiFormControlLayoutClearButton",title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.query.queryBar.clearInputLabel",{defaultMessage:"Clear input"}),onClick:()=>{this.onQueryStringChange(""),this.props.autoSubmit&&this.onSubmit({query:"",language:this.props.query.language})}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{className:"euiFormControlLayoutClearButton__icon",type:"cross"}))):null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPortal,null,external_kbnSharedDeps_React_default.a.createElement(ui.h,{show:this.state.isSuggestionsVisible,suggestions:this.state.suggestions.slice(0,this.state.suggestionLimit),index:this.state.index,onClick:this.onClickSuggestion,onMouseEnter:this.onMouseEnterSuggestion,loadMore:this.increaseLimit,queryBarRect:this.state.queryBarRect,size:this.props.size})))),this.props.disableLanguageSwitcher?null:external_kbnSharedDeps_React_default.a.createElement(QueryLanguageSwitcher,{language:this.props.query.language,anchorPosition:this.props.languageSwitcherPopoverAnchorPosition,onSelectLanguage:this.onSelectLanguage,nonKqlMode:this.props.nonKqlMode,nonKqlModeHelpText:this.props.nonKqlModeHelpText}))}formatTextAreaValue(newValue){return newValue.replace(/\u00A0/g," ")}forwardNewValueIfNeeded(newQueryString){var _this$inputRef$value,_this$inputRef;const oldQueryString=null!==(_this$inputRef$value=null===(_this$inputRef=this.inputRef)||void 0===_this$inputRef?void 0:_this$inputRef.value)&&void 0!==_this$inputRef$value?_this$inputRef$value:"",formattedNewQueryString=this.formatTextAreaValue(newQueryString);return formattedNewQueryString===this.formatTextAreaValue(oldQueryString)?oldQueryString:formattedNewQueryString}}_defineProperty(query_string_input_QueryStringInputUI,"defaultProps",{storageKey:common.KIBANA_USER_QUERY_LANGUAGE_KEY})}}]);