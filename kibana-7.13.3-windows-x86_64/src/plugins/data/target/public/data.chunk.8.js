(window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[]).push([[8],{171:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return QueryBarTopRow}));var target=__webpack_require__(18),target_default=__webpack_require__.n(target),classnames=__webpack_require__(167),classnames_default=__webpack_require__.n(classnames),external_kbnSharedDeps_React_=__webpack_require__(3),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(11),public_=__webpack_require__(25),query_string_input=__webpack_require__(170),common=__webpack_require__(1),query=__webpack_require__(15),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);function NoDataPopover({showNoDataPopover:showNoDataPopover,storage:storage,children:children}){const[noDataPopoverDismissed,setNoDataPopoverDismissed]=Object(external_kbnSharedDeps_React_.useState)(()=>Boolean(storage.get("data.noDataPopover"))),[noDataPopoverVisible,setNoDataPopoverVisible]=Object(external_kbnSharedDeps_React_.useState)(!1);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{showNoDataPopover&&!noDataPopoverDismissed&&setNoDataPopoverVisible(!0)},[noDataPopoverDismissed,showNoDataPopover]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTourStep,{onFinish:()=>{},closePopover:()=>{setNoDataPopoverVisible(!1)},content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",{style:{maxWidth:300}},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.content",{defaultMessage:"This time range doesn't contain any data. Increase or adjust the time range to see more fields and create charts."}))),minWidth:300,anchorPosition:"downCenter",anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:noDataPopoverVisible,subtitle:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.subtitle",{defaultMessage:"Tip"}),title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.title",{defaultMessage:"Empty dataset"}),footerAction:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",flush:"right",color:"text","data-test-subj":"noDataPopoverDismissButton",onClick:()=>{storage.set("data.noDataPopover",!0),setNoDataPopoverDismissed(!0),setNoDataPopoverVisible(!1)}},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.dismissAction",{defaultMessage:"Don't show again"}))},external_kbnSharedDeps_React_default.a.createElement("div",{onFocus:()=>{setNoDataPopoverVisible(!1)}},children))}const QueryStringInput=Object(public_.withKibana)(query_string_input.default);function QueryBarTopRow(props){const[isDateRangeInvalid,setIsDateRangeInvalid]=Object(external_kbnSharedDeps_React_.useState)(!1),[isQueryInputFocused,setIsQueryInputFocused]=Object(external_kbnSharedDeps_React_.useState)(!1),kibana=Object(public_.useKibana)(),{uiSettings:uiSettings,storage:storage,appName:appName}=kibana.services,queryLanguage=props.query&&props.query.language,persistedLog=external_kbnSharedDeps_React_default.a.useMemo(()=>queryLanguage&&uiSettings&&storage&&appName?Object(query.w)(uiSettings,storage,appName,queryLanguage):void 0,[appName,queryLanguage,uiSettings,storage]);function onClickSubmitButton(event){persistedLog&&props.query&&persistedLog.add(props.query.query),event.preventDefault(),onSubmit({query:props.query,dateRange:getDateRange()})}function getDateRange(){const defaultTimeSetting=uiSettings.get(common.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS);return{from:props.dateRangeFrom||defaultTimeSetting.from,to:props.dateRangeTo||defaultTimeSetting.to}}function onQueryChange(query){props.onChange({query:query,dateRange:getDateRange()})}function onChangeQueryInputFocus(isFocused){setIsQueryInputFocused(isFocused)}function onTimeChange({start:start,end:end,isInvalid:isInvalid,isQuickSelection:isQuickSelection}){setIsDateRangeInvalid(isInvalid);const retVal={query:props.query,dateRange:{from:start,to:end}};isQuickSelection?props.onSubmit(retVal):props.onChange(retVal)}function onRefresh({start:start,end:end}){const retVal={dateRange:{from:start,to:end}};props.onRefresh&&props.onRefresh(retVal)}function onSubmit({query:query,dateRange:dateRange}){props.timeHistory&&props.timeHistory.add(dateRange),props.onSubmit({query:query,dateRange:dateRange})}function onInputSubmit(query){onSubmit({query:query,dateRange:getDateRange()})}function toAbsoluteString(value,roundUp=!1){const valueAsMoment=target_default.a.parse(value,{roundUp:roundUp});return valueAsMoment?valueAsMoment.toISOString():value}function shouldRenderDatePicker(){return Boolean(props.showDatePicker||props.showAutoRefreshOnly)}const classes=classnames_default()("kbnQueryBar",{"kbnQueryBar--withDatePicker":props.showDatePicker});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{className:classes,responsive:!!props.showDatePicker,gutterSize:"s",justifyContent:"flexEnd"},function(){if(Boolean(props.showQueryInput&&props.indexPatterns&&props.query&&storage))return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(QueryStringInput,{disableAutoFocus:props.disableAutoFocus,indexPatterns:props.indexPatterns,prepend:props.prepend,query:props.query,screenTitle:props.screenTitle,onChange:onQueryChange,onChangeQueryInputFocus:onChangeQueryInputFocus,onSubmit:onInputSubmit,persistedLog:persistedLog,dataTestSubj:props.dataTestSubj,placeholder:props.placeholder,isClearable:props.isClearable,iconType:props.iconType,nonKqlMode:props.nonKqlMode,nonKqlModeHelpText:props.nonKqlModeHelpText}))}(),function(){const{from:from,to:to}=getDateRange(),dateRangePretty=Object(external_kbnSharedDeps_ElasticEui_.prettyDuration)(toAbsoluteString(from),toAbsoluteString(to),[],uiSettings.get("dateFormat"));return external_kbnSharedDeps_React_default.a.createElement("div",{"data-shared-timefilter-duration":dateRangePretty,"data-test-subj":"dataSharedTimefilterDuration"})}(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},function(){const button=props.customSubmitButton?external_kbnSharedDeps_React_default.a.cloneElement(props.customSubmitButton,{onClick:onClickSubmitButton}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSuperUpdateButton,{needsUpdate:props.isDirty,isDisabled:isDateRangeInvalid,isLoading:props.isLoading,onClick:onClickSubmitButton,"data-test-subj":"querySubmitButton"});return shouldRenderDatePicker()?external_kbnSharedDeps_React_default.a.createElement(NoDataPopover,{storage:storage,showNoDataPopover:props.indicateNoData},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{responsive:!1,gutterSize:"s"},function(){if(!shouldRenderDatePicker())return null;let recentlyUsedRanges;props.timeHistory&&(recentlyUsedRanges=props.timeHistory.get().map(({from:from,to:to})=>({start:from,end:to})));const commonlyUsedRanges=uiSettings.get(common.UI_SETTINGS.TIMEPICKER_QUICK_RANGES).map(({from:from,to:to,display:display})=>({start:from,end:to,label:display})),wrapperClasses=classnames_default()("kbnQueryBar__datePickerWrapper",{"kbnQueryBar__datePickerWrapper-isHidden":isQueryInputFocused});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{className:wrapperClasses},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSuperDatePicker,{start:props.dateRangeFrom,end:props.dateRangeTo,isPaused:props.isRefreshPaused,refreshInterval:props.refreshInterval,onTimeChange:onTimeChange,onRefresh:onRefresh,onRefreshChange:props.onRefreshChange,showUpdateButton:!1,recentlyUsedRanges:recentlyUsedRanges,commonlyUsedRanges:commonlyUsedRanges,dateFormat:uiSettings.get("dateFormat"),isAutoRefreshOnly:props.showAutoRefreshOnly,className:"kbnQueryBar__datePicker"}))}(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},button))):button}()))}QueryBarTopRow.defaultProps={showQueryInput:!0,showDatePicker:!0,showAutoRefreshOnly:!1}}}]);