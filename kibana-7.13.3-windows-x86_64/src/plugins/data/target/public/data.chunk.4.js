(window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[]).push([[4,8],{166:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var external_kbnSharedDeps_Lodash_=__webpack_require__(2),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(16),classnames=__webpack_require__(167),classnames_default=__webpack_require__.n(classnames),external_kbnSharedDeps_React_=__webpack_require__(3),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnAnalytics_=__webpack_require__(159),public_=__webpack_require__(25),query_bar_top_row=__webpack_require__(171),external_kbnSharedDeps_ElasticEui_=__webpack_require__(11),filter_editor=__webpack_require__(169),filter_item=__webpack_require__(160);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class filter_options_FilterOptionsUI extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),_defineProperty(this,"buttonRef",external_kbnSharedDeps_React_default.a.createRef()),_defineProperty(this,"state",{isPopoverOpen:!1}),_defineProperty(this,"togglePopover",()=>{this.setState(prevState=>({isPopoverOpen:!prevState.isPopoverOpen}))}),_defineProperty(this,"closePopover",()=>{var _this$buttonRef$curre;this.setState({isPopoverOpen:!1}),null===(_this$buttonRef$curre=this.buttonRef.current)||void 0===_this$buttonRef$curre||_this$buttonRef$curre.focus()})}render(){const panelTree={id:0,items:[{name:this.props.intl.formatMessage({id:"data.filter.options.enableAllFiltersButtonLabel",defaultMessage:"Enable all"}),icon:"eye",onClick:()=>{this.closePopover(),this.props.onEnableAll()},"data-test-subj":"enableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.disableAllFiltersButtonLabel",defaultMessage:"Disable all"}),icon:"eyeClosed",onClick:()=>{this.closePopover(),this.props.onDisableAll()},"data-test-subj":"disableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.pinAllFiltersButtonLabel",defaultMessage:"Pin all"}),icon:"pin",onClick:()=>{this.closePopover(),this.props.onPinAll()},"data-test-subj":"pinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.unpinAllFiltersButtonLabel",defaultMessage:"Unpin all"}),icon:"pin",onClick:()=>{this.closePopover(),this.props.onUnpinAll()},"data-test-subj":"unpinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertNegatedFiltersButtonLabel",defaultMessage:"Invert inclusion"}),icon:"invert",onClick:()=>{this.closePopover(),this.props.onToggleAllNegated()},"data-test-subj":"invertInclusionAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertDisabledFiltersButtonLabel",defaultMessage:"Invert enabled/disabled"}),icon:"eye",onClick:()=>{this.closePopover(),this.props.onToggleAllDisabled()},"data-test-subj":"invertEnableDisableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.deleteAllFiltersButtonLabel",defaultMessage:"Remove all"}),icon:"trash",onClick:()=>{this.closePopover(),this.props.onRemoveAll()},"data-test-subj":"removeAllFilters"}]};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"popoverForAllFilters",className:"globalFilterGroup__allFiltersPopover",isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:this.togglePopover,iconType:"filter","aria-label":this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),title:this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),"data-test-subj":"showFilterActions",buttonRef:this.buttonRef}),anchorPosition:"rightUp",panelPaddingSize:"none",repositionOnScroll:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverTitle,{paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.filter.searchBar.changeAllFiltersTitle",defaultMessage:"Change all filters"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiContextMenu,{initialPanelId:0,panels:[panelTree]}))}}const FilterOptions=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)(filter_options_FilterOptionsUI);var common=__webpack_require__(1);const FilterBar=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)((function(props){const groupRef=Object(external_kbnSharedDeps_React_.useRef)(null),[isAddFilterPopoverOpen,setIsAddFilterPopoverOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),kibana=Object(public_.useKibana)(),{appName:appName,usageCollection:usageCollection,uiSettings:uiSettings}=kibana.services;if(!uiSettings)return null;const reportUiCounter=null==usageCollection?void 0:usageCollection.reportUiCounter.bind(usageCollection,appName);function onFiltersUpdated(filters){props.onFiltersUpdated&&props.onFiltersUpdated(filters)}function onAdd(filter){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:added"),setIsAddFilterPopoverOpen(!1);onFiltersUpdated([...props.filters,filter])}const classes=classnames_default()("globalFilterBar",props.className);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{className:"globalFilterGroup",gutterSize:"none",alignItems:"flexStart",responsive:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{className:"globalFilterGroup__branch",grow:!1},external_kbnSharedDeps_React_default.a.createElement(FilterOptions,{onEnableAll:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:enable_all"),onFiltersUpdated(props.filters.map(common.enableFilter))},onDisableAll:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:disable_all"),onFiltersUpdated(props.filters.map(common.disableFilter))},onPinAll:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:pin_all"),onFiltersUpdated(props.filters.map(common.pinFilter))},onUnpinAll:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:unpin_all"),onFiltersUpdated(props.filters.map(common.unpinFilter))},onToggleAllNegated:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:invert_all"),onFiltersUpdated(props.filters.map(common.toggleFilterNegated))},onToggleAllDisabled:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:toggle_all"),onFiltersUpdated(props.filters.map(common.toggleFilterDisabled))},onRemoveAll:function(){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:remove_all"),onFiltersUpdated([])}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{className:"globalFilterGroup__filterFlexItem"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{ref:groupRef,className:classes,wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center",tabIndex:-1},props.filters.map((filter,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:i,grow:!1,className:"globalFilterBar__flexItem"},external_kbnSharedDeps_React_default.a.createElement(filter_item.FilterItem,{id:""+i,intl:props.intl,filter:filter,onUpdate:newFilter=>function(i,filter){null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:edited");const filters=[...props.filters];filters[i]=filter,onFiltersUpdated(filters)}(i,newFilter),onRemove:()=>function(i){var _groupRef$current;null==reportUiCounter||reportUiCounter(external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"filter:removed");const filters=[...props.filters];filters.splice(i,1),onFiltersUpdated(filters),null===(_groupRef$current=groupRef.current)||void 0===_groupRef$current||_groupRef$current.focus()}(i),indexPatterns:props.indexPatterns,uiSettings:uiSettings}))),function(){const isPinned=uiSettings.get(common.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT),[indexPattern]=props.indexPatterns,index=indexPattern&&indexPattern.id,newFilter=Object(common.buildEmptyFilter)(isPinned,index),button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",onClick:()=>setIsAddFilterPopoverOpen(!0),"data-test-subj":"addFilter",className:"globalFilterBar__addButton"},"+"," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.filter.filterBar.addFilterButtonLabel",defaultMessage:"Add filter"}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"addFilterPopover",button:button,isOpen:isAddFilterPopoverOpen,closePopover:()=>setIsAddFilterPopoverOpen(!1),anchorPosition:"downLeft",panelPaddingSize:"none",initialFocus:".filterEditor__hiddenItem",ownFocus:!0,repositionOnScroll:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:filter_item.FILTER_EDITOR_WIDTH,maxWidth:"100%"}},external_kbnSharedDeps_React_default.a.createElement(filter_editor.a,{filter:newFilter,indexPatterns:props.indexPatterns,onSubmit:onAdd,onCancel:()=>setIsAddFilterPopoverOpen(!1),key:JSON.stringify(newFilter)})))))}())))}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);function SaveQueryForm({savedQuery:savedQuery,savedQueryService:savedQueryService,onSave:onSave,onClose:onClose,showFilterOption:showFilterOption=!0,showTimeFilterOption:showTimeFilterOption=!0}){const[title,setTitle]=Object(external_kbnSharedDeps_React_.useState)(savedQuery?savedQuery.title:""),[enabledSaveButton,setEnabledSaveButton]=Object(external_kbnSharedDeps_React_.useState)(Boolean(savedQuery)),[description,setDescription]=Object(external_kbnSharedDeps_React_.useState)(savedQuery?savedQuery.description:""),[savedQueries,setSavedQueries]=Object(external_kbnSharedDeps_React_.useState)([]),[shouldIncludeFilters,setShouldIncludeFilters]=Object(external_kbnSharedDeps_React_.useState)(!savedQuery||!!savedQuery.filters),[shouldIncludeTimefilter,setIncludeTimefilter]=Object(external_kbnSharedDeps_React_.useState)(!!savedQuery&&!!savedQuery.timefilter),[formErrors,setFormErrors]=Object(external_kbnSharedDeps_React_.useState)([]),titleConflictErrorText=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryForm.titleConflictText",{defaultMessage:"Name conflicts with an existing saved query"}),savedQueryDescriptionText=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."});Object(external_kbnSharedDeps_React_.useEffect)(()=>{(async()=>{const allSavedQueries=await savedQueryService.getAllSavedQueries(),sortedAllSavedQueries=Object(external_kbnSharedDeps_Lodash_.sortBy)(allSavedQueries,"attributes.title");setSavedQueries(sortedAllSavedQueries)})()},[savedQueryService]);const validate=Object(external_kbnSharedDeps_React_.useCallback)(()=>{const errors=[];return savedQueries.find(existingSavedQuery=>!savedQuery&&existingSavedQuery.attributes.title===title)&&errors.push(titleConflictErrorText),Object(external_kbnSharedDeps_Lodash_.isEqual)(errors,formErrors)?!formErrors.length:(setFormErrors(errors),!1)},[savedQueries,savedQuery,title,titleConflictErrorText,formErrors]),onClickSave=Object(external_kbnSharedDeps_React_.useCallback)(()=>{validate()&&onSave({title:title,description:description,shouldIncludeFilters:shouldIncludeFilters,shouldIncludeTimefilter:shouldIncludeTimefilter})},[validate,onSave,title,description,shouldIncludeFilters,shouldIncludeTimefilter]),onInputChange=Object(external_kbnSharedDeps_React_.useCallback)(event=>{setEnabledSaveButton(Boolean(event.target.value)),setFormErrors([]),setTitle(event.target.value)},[]),autoTrim=Object(external_kbnSharedDeps_React_.useCallback)(()=>{const trimmedTitle=title.trim();title.length>trimmedTitle.length&&setTitle(trimmedTitle)},[title]),hasErrors=formErrors.length>0,saveQueryForm=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiForm,{isInvalid:hasErrors,error:formErrors,"data-test-subj":"saveQueryForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{color:"subdued"},savedQueryDescriptionText)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryNameLabelText",{defaultMessage:"Name"}),helpText:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryNameHelpText",{defaultMessage:"Name is required. Name cannot contain leading or trailing whitespace. Name must be unique."}),isInvalid:hasErrors},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{disabled:!!savedQuery,value:title,name:"title",onChange:onInputChange,"data-test-subj":"saveQueryFormTitle",isInvalid:hasErrors,onBlur:autoTrim})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryDescriptionLabelText",{defaultMessage:"Description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{value:description,name:"description",onChange:event=>{setDescription(event.target.value)},"data-test-subj":"saveQueryFormDescription"})),showFilterOption&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{name:"shouldIncludeFilters",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryIncludeFiltersLabelText",{defaultMessage:"Include filters"}),checked:shouldIncludeFilters,onChange:()=>{setShouldIncludeFilters(!shouldIncludeFilters)},"data-test-subj":"saveQueryFormIncludeFiltersOption"})),showTimeFilterOption&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSwitch,{name:"shouldIncludeTimefilter",label:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryIncludeTimeFilterLabelText",{defaultMessage:"Include time filter"}),checked:shouldIncludeTimefilter,onChange:()=>{setIncludeTimefilter(!shouldIncludeTimefilter)},"data-test-subj":"saveQueryFormIncludeTimeFilterOption"})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModal,{onClose:onClose,initialFocus:"[name=title]"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeaderTitle,null,external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryFormTitle",{defaultMessage:"Save query"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalBody,null,saveQueryForm),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:onClose,"data-test-subj":"savedQueryFormCancelButton"},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryFormCancelButtonText",{defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:onClickSave,fill:!0,"data-test-subj":"savedQueryFormSaveButton",disabled:hasErrors||!enabledSaveButton},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryFormSaveButtonText",{defaultMessage:"Save"}))))}const SavedQueryListItem=({savedQuery:savedQuery,isSelected:isSelected,onSelect:onSelect,onDelete:onDelete,showWriteOperations:showWriteOperations})=>{const[showDeletionConfirmationModal,setShowDeletionConfirmationModal]=Object(external_kbnSharedDeps_React_.useState)(!1),selectButtonAriaLabelText=isSelected?external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemSelectedButtonAriaLabel",{defaultMessage:"Saved query button selected {savedQueryName}. Press to clear any changes.",values:{savedQueryName:savedQuery.attributes.title}}):external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemButtonAriaLabel",{defaultMessage:"Saved query button {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}}),selectButtonDataTestSubj=isSelected?`load-saved-query-${savedQuery.attributes.title}-button saved-query-list-item-selected`:`load-saved-query-${savedQuery.attributes.title}-button`,classes=classnames_default()("kbnSavedQueryListItem",{"kbnSavedQueryListItem-selected":isSelected}),label=external_kbnSharedDeps_React_default.a.createElement("span",{className:"kbnSavedQueryListItem__label"},external_kbnSharedDeps_React_default.a.createElement("span",{className:"kbnSavedQueryListItem__labelText"},savedQuery.attributes.title)," ",savedQuery.attributes.description&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIconTip,{type:"iInCircle",content:savedQuery.attributes.description,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemDescriptionAriaLabel",{defaultMessage:"{savedQueryName} description",values:{savedQueryName:savedQuery.attributes.title}})}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiListGroupItem,{className:classes,key:savedQuery.id,"data-test-subj":`saved-query-list-item ${selectButtonDataTestSubj} ${isSelected?"saved-query-list-item-selected":""}`,isActive:isSelected,onClick:()=>{onSelect(savedQuery)},"aria-label":selectButtonAriaLabelText,label:label,iconType:isSelected?"check":void 0,extraAction:showWriteOperations?{color:"danger",onClick:()=>setShowDeletionConfirmationModal(!0),iconType:"trash",iconSize:"s","aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}}),title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}}),"data-test-subj":`delete-saved-query-${savedQuery.attributes.title}-button`}:void 0}),showDeletionConfirmationModal&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiConfirmModal,{title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionTitle",{defaultMessage:'Delete "{savedQueryName}"?',values:{savedQueryName:savedQuery.attributes.title}}),confirmButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionConfirmButtonText",{defaultMessage:"Delete"}),cancelButtonText:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionCancelButtonText",{defaultMessage:"Cancel"}),onConfirm:()=>{onDelete(savedQuery),setShowDeletionConfirmationModal(!1)},buttonColor:"danger",onCancel:()=>{setShowDeletionConfirmationModal(!1)}}))};function SavedQueryManagementComponent({showSaveQuery:showSaveQuery,loadedSavedQuery:loadedSavedQuery,onSave:onSave,onSaveAsNew:onSaveAsNew,onLoad:onLoad,onClearSavedQuery:onClearSavedQuery,savedQueryService:savedQueryService}){const[isOpen,setIsOpen]=Object(external_kbnSharedDeps_React_.useState)(!1),[savedQueries,setSavedQueries]=Object(external_kbnSharedDeps_React_.useState)([]),[count,setTotalCount]=Object(external_kbnSharedDeps_React_.useState)(0),[activePage,setActivePage]=Object(external_kbnSharedDeps_React_.useState)(0),cancelPendingListingRequest=Object(external_kbnSharedDeps_React_.useRef)(()=>{});Object(external_kbnSharedDeps_React_.useEffect)(()=>{isOpen&&(async()=>{cancelPendingListingRequest.current();let requestGotCancelled=!1;cancelPendingListingRequest.current=()=>{requestGotCancelled=!0};const{total:savedQueryCount,queries:savedQueryItems}=await savedQueryService.findSavedQueries("",50,activePage+1);if(requestGotCancelled)return;const sortedSavedQueryItems=Object(external_kbnSharedDeps_Lodash_.sortBy)(savedQueryItems,"attributes.title");setTotalCount(savedQueryCount),setSavedQueries(sortedSavedQueryItems)})()},[isOpen,activePage,savedQueryService]);const handleTogglePopover=Object(external_kbnSharedDeps_React_.useCallback)(()=>setIsOpen(currentState=>!currentState),[setIsOpen]),handleClosePopover=Object(external_kbnSharedDeps_React_.useCallback)(()=>setIsOpen(!1),[]),handleSave=Object(external_kbnSharedDeps_React_.useCallback)(()=>{handleClosePopover(),onSave()},[handleClosePopover,onSave]),handleSaveAsNew=Object(external_kbnSharedDeps_React_.useCallback)(()=>{handleClosePopover(),onSaveAsNew()},[handleClosePopover,onSaveAsNew]),handleSelect=Object(external_kbnSharedDeps_React_.useCallback)(savedQueryToSelect=>{handleClosePopover(),onLoad(savedQueryToSelect)},[handleClosePopover,onLoad]),handleDelete=Object(external_kbnSharedDeps_React_.useCallback)(savedQueryToDelete=>{(async savedQuery=>{cancelPendingListingRequest.current(),setSavedQueries(savedQueries.filter(currentSavedQuery=>currentSavedQuery.id!==savedQuery.id)),loadedSavedQuery&&loadedSavedQuery.id===savedQuery.id&&onClearSavedQuery(),await savedQueryService.deleteSavedQuery(savedQuery.id),setActivePage(0)})(savedQueryToDelete),handleClosePopover()},[handleClosePopover,loadedSavedQuery,onClearSavedQuery,savedQueries,savedQueryService]),savedQueryDescriptionText=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."}),noSavedQueriesDescriptionText=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryNoSavedQueriesText",{defaultMessage:"There are no saved queries."})+" "+savedQueryDescriptionText,savedQueryPopoverTitleText=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverTitleText",{defaultMessage:"Saved Queries"}),savedQueryPopoverButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:handleTogglePopover,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),"data-test-subj":"saved-query-management-popover-button"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"save",className:"euiQuickSelectPopover__buttonText"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"arrowDown"}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopover,{id:"savedQueryPopover",button:savedQueryPopoverButton,isOpen:isOpen,closePopover:handleClosePopover,anchorPosition:"downLeft",panelPaddingSize:"none",buffer:-8,repositionOnScroll:!0,ownFocus:!0},external_kbnSharedDeps_React_default.a.createElement("div",{className:"kbnSavedQueryManagement__popover","data-test-subj":"saved-query-management-popover"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverTitle,{paddingSize:"m",id:"savedQueryManagementPopoverTitle"},savedQueryPopoverTitleText),savedQueries.length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},external_kbnSharedDeps_React_default.a.createElement("p",null,savedQueryDescriptionText)),external_kbnSharedDeps_React_default.a.createElement("div",{className:"kbnSavedQueryManagement__listWrapper"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiListGroup,{flush:!0,className:"kbnSavedQueryManagement__list","aria-labelledby":"savedQueryManagementPopoverTitle"},(()=>{const savedQueriesWithoutCurrent=savedQueries.filter(savedQuery=>!loadedSavedQuery||savedQuery.id!==loadedSavedQuery.id);return(loadedSavedQuery&&savedQueriesWithoutCurrent.length!==savedQueries.length?[loadedSavedQuery,...savedQueriesWithoutCurrent]:[...savedQueriesWithoutCurrent]).map(savedQuery=>external_kbnSharedDeps_React_default.a.createElement(SavedQueryListItem,{key:savedQuery.id,savedQuery:savedQuery,isSelected:!!loadedSavedQuery&&loadedSavedQuery.id===savedQuery.id,onSelect:handleSelect,onDelete:handleDelete,showWriteOperations:!!showSaveQuery}))})())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPagination,{className:"kbnSavedQueryManagement__pagination",pageCount:Math.ceil(count/50),activePage:activePage,onPageClick:pageNumber=>{setActivePage(pageNumber)}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},external_kbnSharedDeps_React_default.a.createElement("p",null,noSavedQueriesDescriptionText)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiPopoverFooter,{paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{direction:"rowReverse",gutterSize:"s",alignItems:"center",justifyContent:"flexEnd",responsive:!1,wrap:!0},showSaveQuery&&loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{size:"s",fill:!0,onClick:handleSave,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonAriaLabel",{defaultMessage:"Save changes to {title}",values:{title:loadedSavedQuery.attributes.title}}),"data-test-subj":"saved-query-management-save-changes-button"},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonText",{defaultMessage:"Save changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{size:"s",onClick:handleSaveAsNew,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonAriaLabel",{defaultMessage:"Save as new saved query"}),"data-test-subj":"saved-query-management-save-as-new-button"},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonText",{defaultMessage:"Save as new"})))),showSaveQuery&&!loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{size:"s",fill:!0,onClick:handleSave,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveButtonAriaLabel",{defaultMessage:"Save a new saved query"}),"data-test-subj":"saved-query-management-save-button"},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverSaveButtonText",{defaultMessage:"Save current query"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"s",flush:"left",onClick:onClearSavedQuery,"aria-label":external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverClearButtonAriaLabel",{defaultMessage:"Clear current saved query"}),"data-test-subj":"saved-query-management-clear-button"},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchBar.savedQueryPopoverClearButtonText",{defaultMessage:"Clear"}))))))))}function search_bar_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class search_bar_SearchBarUI extends external_kbnSharedDeps_React_.Component{constructor(...args){super(...args),search_bar_defineProperty(this,"services",this.props.kibana.services),search_bar_defineProperty(this,"savedQueryService",this.services.data.query.savedQueries),search_bar_defineProperty(this,"state",{isFiltersVisible:!0,showSaveQueryModal:!1,showSaveNewQueryModal:!1,showSavedQueryPopover:!1,currentProps:this.props,query:this.props.query?{...this.props.query}:void 0,dateRangeFrom:Object(external_kbnSharedDeps_Lodash_.get)(this.props,"dateRangeFrom","now-15m"),dateRangeTo:Object(external_kbnSharedDeps_Lodash_.get)(this.props,"dateRangeTo","now")}),search_bar_defineProperty(this,"isDirty",()=>!this.props.showDatePicker&&this.state.query&&this.props.query?this.state.query.query!==this.props.query.query:this.state.query&&this.props.query&&this.state.query.query!==this.props.query.query||this.state.dateRangeFrom!==this.props.dateRangeFrom||this.state.dateRangeTo!==this.props.dateRangeTo),search_bar_defineProperty(this,"onSave",async(savedQueryMeta,saveAsNew=!1)=>{if(!this.state.query)return;const savedQueryAttributes={title:savedQueryMeta.title,description:savedQueryMeta.description,query:this.state.query};savedQueryMeta.shouldIncludeFilters&&(savedQueryAttributes.filters=this.props.filters),savedQueryMeta.shouldIncludeTimefilter&&void 0!==this.state.dateRangeTo&&void 0!==this.state.dateRangeFrom&&void 0!==this.props.refreshInterval&&void 0!==this.props.isRefreshPaused&&(savedQueryAttributes.timefilter={from:this.state.dateRangeFrom,to:this.state.dateRangeTo,refreshInterval:{value:this.props.refreshInterval,pause:this.props.isRefreshPaused}});try{let response;response=this.props.savedQuery&&!saveAsNew?await this.savedQueryService.saveQuery(savedQueryAttributes,{overwrite:!0}):await this.savedQueryService.saveQuery(savedQueryAttributes),this.services.notifications.toasts.addSuccess(`Your query "${response.attributes.title}" was saved`),this.setState({showSaveQueryModal:!1,showSaveNewQueryModal:!1}),this.props.onSaved&&this.props.onSaved(response)}catch(error){throw this.services.notifications.toasts.addDanger("An error occured while saving your query: "+error.message),error}}),search_bar_defineProperty(this,"onInitiateSave",()=>{this.setState({showSaveQueryModal:!0})}),search_bar_defineProperty(this,"onInitiateSaveNew",()=>{this.setState({showSaveNewQueryModal:!0})}),search_bar_defineProperty(this,"onQueryBarChange",queryAndDateRange=>{this.setState({query:queryAndDateRange.query,dateRangeFrom:queryAndDateRange.dateRange.from,dateRangeTo:queryAndDateRange.dateRange.to}),this.props.onQueryChange&&this.props.onQueryChange(queryAndDateRange)}),search_bar_defineProperty(this,"onQueryBarSubmit",queryAndDateRange=>{this.setState({query:queryAndDateRange.query,dateRangeFrom:queryAndDateRange.dateRange&&queryAndDateRange.dateRange.from||this.state.dateRangeFrom,dateRangeTo:queryAndDateRange.dateRange&&queryAndDateRange.dateRange.to||this.state.dateRangeTo},()=>{var _this$services$usageC;this.props.onQuerySubmit&&this.props.onQuerySubmit({query:this.state.query,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}}),null===(_this$services$usageC=this.services.usageCollection)||void 0===_this$services$usageC||_this$services$usageC.reportUiCounter(this.services.appName,external_kbnSharedDeps_KbnAnalytics_.METRIC_TYPE.CLICK,"query_submitted")})}),search_bar_defineProperty(this,"onLoadSavedQuery",savedQuery=>{const dateRangeFrom=Object(external_kbnSharedDeps_Lodash_.get)(savedQuery,"attributes.timefilter.from",this.state.dateRangeFrom),dateRangeTo=Object(external_kbnSharedDeps_Lodash_.get)(savedQuery,"attributes.timefilter.to",this.state.dateRangeTo);this.setState({query:savedQuery.attributes.query,dateRangeFrom:dateRangeFrom,dateRangeTo:dateRangeTo}),this.props.onSavedQueryUpdated&&this.props.onSavedQueryUpdated(savedQuery)})}static getDerivedStateFromProps(nextProps,prevState){if(Object(external_kbnSharedDeps_Lodash_.isEqual)(prevState.currentProps,nextProps))return null;let nextQuery=null;nextProps.query&&nextProps.query.query!==Object(external_kbnSharedDeps_Lodash_.get)(prevState,"currentProps.query.query")?nextQuery={query:nextProps.query.query,language:nextProps.query.language}:nextProps.query&&prevState.query&&nextProps.query.language!==prevState.query.language&&(nextQuery={query:"",language:nextProps.query.language});let nextDateRange=null;nextProps.dateRangeFrom===Object(external_kbnSharedDeps_Lodash_.get)(prevState,"currentProps.dateRangeFrom")&&nextProps.dateRangeTo===Object(external_kbnSharedDeps_Lodash_.get)(prevState,"currentProps.dateRangeTo")||(nextDateRange={dateRangeFrom:nextProps.dateRangeFrom,dateRangeTo:nextProps.dateRangeTo});const nextState={currentProps:nextProps};return nextQuery&&(nextState.query=nextQuery),nextDateRange&&(nextState.dateRangeFrom=nextDateRange.dateRangeFrom,nextState.dateRangeTo=nextDateRange.dateRangeTo),nextState}shouldRenderQueryBar(){const showDatePicker=this.props.showDatePicker||this.props.showAutoRefreshOnly,showQueryInput=this.props.showQueryInput&&this.props.indexPatterns&&this.state.query;return this.props.showQueryBar&&(showDatePicker||showQueryInput)}shouldRenderFilterBar(){return this.props.showFilterBar&&this.props.filters&&this.props.indexPatterns&&Object(external_kbnSharedDeps_Lodash_.compact)(this.props.indexPatterns).length>0}shouldRenderTimeFilterInSavedQueryForm(){const{dateRangeFrom:dateRangeFrom,dateRangeTo:dateRangeTo,showDatePicker:showDatePicker}=this.props;return showDatePicker||!showDatePicker&&void 0!==dateRangeFrom&&void 0!==dateRangeTo}render(){const savedQueryManagement=this.state.query&&this.props.onClearSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(SavedQueryManagementComponent,{showSaveQuery:this.props.showSaveQuery,loadedSavedQuery:this.props.savedQuery,onSave:this.onInitiateSave,onSaveAsNew:this.onInitiateSaveNew,onLoad:this.onLoadSavedQuery,savedQueryService:this.savedQueryService,onClearSavedQuery:this.props.onClearSavedQuery});let queryBar,filterBar;if(this.shouldRenderQueryBar()&&(queryBar=external_kbnSharedDeps_React_default.a.createElement(query_bar_top_row.default,{timeHistory:this.props.timeHistory,query:this.state.query,screenTitle:this.props.screenTitle,onSubmit:this.onQueryBarSubmit,indexPatterns:this.props.indexPatterns,isLoading:this.props.isLoading,prepend:this.props.showFilterBar?savedQueryManagement:void 0,showDatePicker:this.props.showDatePicker,dateRangeFrom:this.state.dateRangeFrom,dateRangeTo:this.state.dateRangeTo,isRefreshPaused:this.props.isRefreshPaused,refreshInterval:this.props.refreshInterval,showAutoRefreshOnly:this.props.showAutoRefreshOnly,showQueryInput:this.props.showQueryInput,onRefresh:this.props.onRefresh,onRefreshChange:this.props.onRefreshChange,onChange:this.onQueryBarChange,isDirty:this.isDirty(),customSubmitButton:this.props.customSubmitButton?this.props.customSubmitButton:void 0,dataTestSubj:this.props.dataTestSubj,indicateNoData:this.props.indicateNoData,placeholder:this.props.placeholder,isClearable:this.props.isClearable,iconType:this.props.iconType,nonKqlMode:this.props.nonKqlMode,nonKqlModeHelpText:this.props.nonKqlModeHelpText})),this.shouldRenderFilterBar()){const filterGroupClasses=classnames_default()("globalFilterGroup__wrapper",{"globalFilterGroup__wrapper-isVisible":this.state.isFiltersVisible});filterBar=external_kbnSharedDeps_React_default.a.createElement("div",{id:"GlobalFilterGroup",className:filterGroupClasses},external_kbnSharedDeps_React_default.a.createElement(FilterBar,{className:"globalFilterGroup__filterBar",filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,indexPatterns:this.props.indexPatterns,appName:this.services.appName}))}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"globalQueryBar","data-test-subj":"globalQueryBar"},queryBar,filterBar,this.state.showSaveQueryModal?external_kbnSharedDeps_React_default.a.createElement(SaveQueryForm,{savedQuery:this.props.savedQuery?this.props.savedQuery.attributes:void 0,savedQueryService:this.savedQueryService,onSave:this.onSave,onClose:()=>this.setState({showSaveQueryModal:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null,this.state.showSaveNewQueryModal?external_kbnSharedDeps_React_default.a.createElement(SaveQueryForm,{savedQueryService:this.savedQueryService,onSave:savedQueryMeta=>this.onSave(savedQueryMeta,!0),onClose:()=>this.setState({showSaveNewQueryModal:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null)}}search_bar_defineProperty(search_bar_SearchBarUI,"defaultProps",{showQueryBar:!0,showFilterBar:!0,showDatePicker:!0,showAutoRefreshOnly:!1});__webpack_exports__.default=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)(Object(public_.withKibana)(search_bar_SearchBarUI))},171:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return QueryBarTopRow}));var target=__webpack_require__(18),target_default=__webpack_require__.n(target),classnames=__webpack_require__(167),classnames_default=__webpack_require__.n(classnames),external_kbnSharedDeps_React_=__webpack_require__(3),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_ElasticEui_=__webpack_require__(11),public_=__webpack_require__(25),query_string_input=__webpack_require__(170),common=__webpack_require__(1),query=__webpack_require__(15),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);function NoDataPopover({showNoDataPopover:showNoDataPopover,storage:storage,children:children}){const[noDataPopoverDismissed,setNoDataPopoverDismissed]=Object(external_kbnSharedDeps_React_.useState)(()=>Boolean(storage.get("data.noDataPopover"))),[noDataPopoverVisible,setNoDataPopoverVisible]=Object(external_kbnSharedDeps_React_.useState)(!1);return Object(external_kbnSharedDeps_React_.useEffect)(()=>{showNoDataPopover&&!noDataPopoverDismissed&&setNoDataPopoverVisible(!0)},[noDataPopoverDismissed,showNoDataPopover]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTourStep,{onFinish:()=>{},closePopover:()=>{setNoDataPopoverVisible(!1)},content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiText,{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",{style:{maxWidth:300}},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.content",{defaultMessage:"This time range doesn't contain any data. Increase or adjust the time range to see more fields and create charts."}))),minWidth:300,anchorPosition:"downCenter",anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:noDataPopoverVisible,subtitle:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.subtitle",{defaultMessage:"Tip"}),title:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.title",{defaultMessage:"Empty dataset"}),footerAction:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{size:"xs",flush:"right",color:"text","data-test-subj":"noDataPopoverDismissButton",onClick:()=>{storage.set("data.noDataPopover",!0),setNoDataPopoverDismissed(!0),setNoDataPopoverVisible(!1)}},external_kbnSharedDeps_KbnI18n_.i18n.translate("data.noDataPopover.dismissAction",{defaultMessage:"Don't show again"}))},external_kbnSharedDeps_React_default.a.createElement("div",{onFocus:()=>{setNoDataPopoverVisible(!1)}},children))}const QueryStringInput=Object(public_.withKibana)(query_string_input.default);function QueryBarTopRow(props){const[isDateRangeInvalid,setIsDateRangeInvalid]=Object(external_kbnSharedDeps_React_.useState)(!1),[isQueryInputFocused,setIsQueryInputFocused]=Object(external_kbnSharedDeps_React_.useState)(!1),kibana=Object(public_.useKibana)(),{uiSettings:uiSettings,storage:storage,appName:appName}=kibana.services,queryLanguage=props.query&&props.query.language,persistedLog=external_kbnSharedDeps_React_default.a.useMemo(()=>queryLanguage&&uiSettings&&storage&&appName?Object(query.w)(uiSettings,storage,appName,queryLanguage):void 0,[appName,queryLanguage,uiSettings,storage]);function onClickSubmitButton(event){persistedLog&&props.query&&persistedLog.add(props.query.query),event.preventDefault(),onSubmit({query:props.query,dateRange:getDateRange()})}function getDateRange(){const defaultTimeSetting=uiSettings.get(common.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS);return{from:props.dateRangeFrom||defaultTimeSetting.from,to:props.dateRangeTo||defaultTimeSetting.to}}function onQueryChange(query){props.onChange({query:query,dateRange:getDateRange()})}function onChangeQueryInputFocus(isFocused){setIsQueryInputFocused(isFocused)}function onTimeChange({start:start,end:end,isInvalid:isInvalid,isQuickSelection:isQuickSelection}){setIsDateRangeInvalid(isInvalid);const retVal={query:props.query,dateRange:{from:start,to:end}};isQuickSelection?props.onSubmit(retVal):props.onChange(retVal)}function onRefresh({start:start,end:end}){const retVal={dateRange:{from:start,to:end}};props.onRefresh&&props.onRefresh(retVal)}function onSubmit({query:query,dateRange:dateRange}){props.timeHistory&&props.timeHistory.add(dateRange),props.onSubmit({query:query,dateRange:dateRange})}function onInputSubmit(query){onSubmit({query:query,dateRange:getDateRange()})}function toAbsoluteString(value,roundUp=!1){const valueAsMoment=target_default.a.parse(value,{roundUp:roundUp});return valueAsMoment?valueAsMoment.toISOString():value}function shouldRenderDatePicker(){return Boolean(props.showDatePicker||props.showAutoRefreshOnly)}const classes=classnames_default()("kbnQueryBar",{"kbnQueryBar--withDatePicker":props.showDatePicker});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{className:classes,responsive:!!props.showDatePicker,gutterSize:"s",justifyContent:"flexEnd"},function(){if(Boolean(props.showQueryInput&&props.indexPatterns&&props.query&&storage))return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,null,external_kbnSharedDeps_React_default.a.createElement(QueryStringInput,{disableAutoFocus:props.disableAutoFocus,indexPatterns:props.indexPatterns,prepend:props.prepend,query:props.query,screenTitle:props.screenTitle,onChange:onQueryChange,onChangeQueryInputFocus:onChangeQueryInputFocus,onSubmit:onInputSubmit,persistedLog:persistedLog,dataTestSubj:props.dataTestSubj,placeholder:props.placeholder,isClearable:props.isClearable,iconType:props.iconType,nonKqlMode:props.nonKqlMode,nonKqlModeHelpText:props.nonKqlModeHelpText}))}(),function(){const{from:from,to:to}=getDateRange(),dateRangePretty=Object(external_kbnSharedDeps_ElasticEui_.prettyDuration)(toAbsoluteString(from),toAbsoluteString(to),[],uiSettings.get("dateFormat"));return external_kbnSharedDeps_React_default.a.createElement("div",{"data-shared-timefilter-duration":dateRangePretty,"data-test-subj":"dataSharedTimefilterDuration"})}(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},function(){const button=props.customSubmitButton?external_kbnSharedDeps_React_default.a.cloneElement(props.customSubmitButton,{onClick:onClickSubmitButton}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSuperUpdateButton,{needsUpdate:props.isDirty,isDisabled:isDateRangeInvalid,isLoading:props.isLoading,onClick:onClickSubmitButton,"data-test-subj":"querySubmitButton"});return shouldRenderDatePicker()?external_kbnSharedDeps_React_default.a.createElement(NoDataPopover,{storage:storage,showNoDataPopover:props.indicateNoData},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{responsive:!1,gutterSize:"s"},function(){if(!shouldRenderDatePicker())return null;let recentlyUsedRanges;props.timeHistory&&(recentlyUsedRanges=props.timeHistory.get().map(({from:from,to:to})=>({start:from,end:to})));const commonlyUsedRanges=uiSettings.get(common.UI_SETTINGS.TIMEPICKER_QUICK_RANGES).map(({from:from,to:to,display:display})=>({start:from,end:to,label:display})),wrapperClasses=classnames_default()("kbnQueryBar__datePickerWrapper",{"kbnQueryBar__datePickerWrapper-isHidden":isQueryInputFocused});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{className:wrapperClasses},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSuperDatePicker,{start:props.dateRangeFrom,end:props.dateRangeTo,isPaused:props.isRefreshPaused,refreshInterval:props.refreshInterval,onTimeChange:onTimeChange,onRefresh:onRefresh,onRefreshChange:props.onRefreshChange,showUpdateButton:!1,recentlyUsedRanges:recentlyUsedRanges,commonlyUsedRanges:commonlyUsedRanges,dateFormat:uiSettings.get("dateFormat"),isAutoRefreshOnly:props.showAutoRefreshOnly,className:"kbnQueryBar__datePicker"}))}(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},button))):button}()))}QueryBarTopRow.defaultProps={showQueryInput:!0,showDatePicker:!0,showAutoRefreshOnly:!1}}}]);