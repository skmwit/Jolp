(window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[]).push([[9],{174:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ShardFailureOpenModalButton}));var external_kbnSharedDeps_React_=__webpack_require__(3),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(16),external_kbnSharedDeps_ElasticEui_=__webpack_require__(11),services=__webpack_require__(19),public_=__webpack_require__(25),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0),external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(163),external_kbnSharedDeps_KbnStd_=__webpack_require__(164);function getFailurePropsForSummary(failure){return["shard","index","node"].filter(key=>"number"==typeof failure[key]||"string"==typeof failure[key]).map(key=>({key:key,value:String(failure[key])}))}function getFailureSummaryText(failure,failureDetails){const failureName=failure.reason.type,displayDetails="string"==typeof failureDetails?failureDetails:function(failure){return getFailurePropsForSummary(failure).map(({key:key,value:value})=>`${key}: ${value}`).join(", ")}(failure);return external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.failureHeader",{defaultMessage:"{failureName} at {failureDetails}",values:{failureName:failureName,failureDetails:displayDetails},description:'Summary of shard failures, e.g. "IllegalArgumentException at shard 0 node xyz"'})}function ShardFailureDescriptionHeader(props){const failureDetails=getFailurePropsForSummary(props).map(kv=>external_kbnSharedDeps_React_default.a.createElement("span",{className:"shardFailureModal__keyValueTitle",key:kv.key},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCode,null,kv.key)," ",kv.value));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTitle,{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h2",null,getFailureSummaryText(props,""),failureDetails))}function formatKey(key){return(key.charAt(0).toUpperCase()+key.slice(1)).replace(/[\._]/g," ")}function formatValueByKey(value,key){if("script"===key||"script_stack"===key){const valueScript=Array.isArray(value)?value.join("\n"):String(value);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCodeBlock,{language:"java",paddingSize:"s",isCopyable:!0},valueScript)}return String(value)}function ShardFailureDescription(props){const flattendReason=Object(external_kbnSharedDeps_KbnStd_.getFlattenedObject)(props.reason),listItems=Object.entries(flattendReason).map(([key,value])=>({title:formatKey(key),description:formatValueByKey(value,key)}));return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(ShardFailureDescriptionHeader,props),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiSpacer,{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiDescriptionList,{listItems:listItems,type:"column",compressed:!0,className:"shardFailureModal__desc",titleProps:{className:"shardFailureModal__descTitle"},descriptionProps:{className:"shardFailureModal__descValue"}}))}function ShardFailureTable({failures:failures}){const itemList=failures.map((failure,idx)=>({id:String(idx),...failure})),[expandMap,setExpandMap]=Object(external_kbnSharedDeps_React_.useState)({}),columns=[{align:external_kbnSharedDeps_ElasticEuiLibServices_.RIGHT_ALIGNMENT,width:"40px",isExpander:!0,render:item=>{const failureSummeryText=getFailureSummaryText(item),collapseLabel=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableRowCollapse",{defaultMessage:"Collapse {rowDescription}",description:"Collapse a row of a table with failures",values:{rowDescription:failureSummeryText}}),expandLabel=external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableRowExpand",{defaultMessage:"Expand {rowDescription}",description:"Expand a row of a table with failures",values:{rowDescription:failureSummeryText}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonIcon,{onClick:()=>{const map=Object.assign({},expandMap);map[item.id]?delete map[item.id]:map[item.id]=external_kbnSharedDeps_React_default.a.createElement(ShardFailureDescription,item),setExpandMap(map)},"aria-label":expandMap[item.id]?collapseLabel:expandLabel,iconType:expandMap[item.id]?"arrowUp":"arrowDown"})}},{field:"shard",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableColShard",{defaultMessage:"Shard"}),sortable:!0,truncateText:!0,width:"80px"},{field:"index",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableColIndex",{defaultMessage:"Index"}),sortable:!0,truncateText:!0},{field:"node",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableColNode",{defaultMessage:"Node"}),sortable:!0,truncateText:!0},{field:"reason.type",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tableColReason",{defaultMessage:"Reason"}),truncateText:!0}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiInMemoryTable,{itemId:"id",items:itemList,columns:columns,pagination:!0,sorting:{sort:{field:"index",direction:"desc"}},itemIdToExpandedRowMap:expandMap})}function ShardFailureModal({request:request,response:response,title:title,onClose:onClose}){if(!(response&&response._shards&&Array.isArray(response._shards.failures)&&request))return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCallOut,{title:"Sorry, there was an error",color:"danger",iconType:"alert"},"The ShardFailureModal component received invalid properties");const failures=response._shards.failures,requestJSON=JSON.stringify(request,null,2),responseJSON=JSON.stringify(response,null,2),tabs=[{id:"table",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderShardFailures",{defaultMessage:"Shard failures",description:"Name of the tab displaying shard failures"}),content:external_kbnSharedDeps_React_default.a.createElement(ShardFailureTable,{failures:failures})},{id:"json-request",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderRequest",{defaultMessage:"Request",description:"Name of the tab displaying the JSON request"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCodeBlock,{language:"json",isCopyable:!0},requestJSON)},{id:"json-response",name:external_kbnSharedDeps_KbnI18n_.i18n.translate("data.search.searchSource.fetch.shardsFailedModal.tabHeaderResponse",{defaultMessage:"Response",description:"Name of the tab displaying the JSON response"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCodeBlock,{language:"json",isCopyable:!0},responseJSON)}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalHeaderTitle,null,title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalBody,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],autoFocus:"selected"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiModalFooter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiCopy,{textToCopy:responseJSON},copy=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:copy},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.search.searchSource.fetch.shardsFailedModal.copyToClipboard",defaultMessage:"Copy response to clipboard"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{onClick:()=>onClose(),fill:!0,"data-test-sub":"closeShardFailureModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.search.searchSource.fetch.shardsFailedModal.close",defaultMessage:"Close",description:"Closing the Modal"}))))}function ShardFailureOpenModalButton({request:request,response:response,title:title}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiTextAlign,{textAlign:"right"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{color:"warning",size:"s",onClick:function(){const modal=Object(services.c)().openModal(Object(public_.toMountPoint)(external_kbnSharedDeps_React_default.a.createElement(ShardFailureModal,{request:request,response:response,title:title,onClose:()=>modal.close()})),{className:"shardFailureModal"})},"data-test-subj":"openShardFailureModalBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"data.search.searchSource.fetch.shardsFailedModal.showDetails",defaultMessage:"Show details",description:"Open the modal to show details"})))}}}]);