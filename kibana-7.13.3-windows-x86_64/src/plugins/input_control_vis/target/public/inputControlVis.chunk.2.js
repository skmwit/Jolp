(window.inputControlVis_bundle_jsonpfunction=window.inputControlVis_bundle_jsonpfunction||[]).push([[2],[,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var memo,isOldIE=function(){return void 0===memo&&(memo=Boolean(window&&document&&document.all&&!window.atob)),memo},getTarget=function(){var memo={};return function(target){if(void 0===memo[target]){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}}(),stylesInDom=[];function getIndexByIdentifier(identifier){for(var result=-1,i=0;i<stylesInDom.length;i++)if(stylesInDom[i].identifier===identifier){result=i;break}return result}function modulesToDom(list,options){for(var idCountMap={},identifiers=[],i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],count=idCountMap[id]||0,identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var index=getIndexByIdentifier(identifier),obj={css:item[1],media:item[2],sourceMap:item[3]};-1!==index?(stylesInDom[index].references++,stylesInDom[index].updater(obj)):stylesInDom.push({identifier:identifier,updater:addStyle(obj,options),references:1}),identifiers.push(identifier)}return identifiers}function insertStyleElement(options){var style=document.createElement("style"),attributes=options.attributes||{};if(void 0===attributes.nonce){var nonce=__webpack_require__.nc;nonce&&(attributes.nonce=nonce)}if(Object.keys(attributes).forEach((function(key){style.setAttribute(key,attributes[key])})),"function"==typeof options.insert)options.insert(style);else{var target=getTarget(options.insert||"head");if(!target)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");target.appendChild(style)}return style}var textStore,replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")});function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.media?"@media ".concat(obj.media," {").concat(obj.css,"}"):obj.css;if(style.styleSheet)style.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=style.childNodes;childNodes[index]&&style.removeChild(childNodes[index]),childNodes.length?style.insertBefore(cssNode,childNodes[index]):style.appendChild(cssNode)}}function applyToTag(style,options,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media?style.setAttribute("media",media):style.removeAttribute("media"),sourceMap&&btoa&&(css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")),style.styleSheet)style.styleSheet.cssText=css;else{for(;style.firstChild;)style.removeChild(style.firstChild);style.appendChild(document.createTextNode(css))}}var singleton=null,singletonCounter=0;function addStyle(obj,options){var style,update,remove;if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=insertStyleElement(options)),update=applyToSingletonTag.bind(null,style,styleIndex,!1),remove=applyToSingletonTag.bind(null,style,styleIndex,!0)}else style=insertStyleElement(options),update=applyToTag.bind(null,style,options),remove=function(){!function(style){if(null===style.parentNode)return!1;style.parentNode.removeChild(style)}(style)};return update(obj),function(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}module.exports=function(list,options){(options=options||{}).singleton||"boolean"==typeof options.singleton||(options.singleton=isOldIE());var lastIdentifiers=modulesToDom(list=list||[],options);return function(newList){if(newList=newList||[],"[object Array]"===Object.prototype.toString.call(newList)){for(var i=0;i<lastIdentifiers.length;i++){var index=getIndexByIdentifier(lastIdentifiers[i]);stylesInDom[index].references--}for(var newLastIdentifiers=modulesToDom(newList,options),_i=0;_i<lastIdentifiers.length;_i++){var _index=getIndexByIdentifier(lastIdentifiers[_i]);0===stylesInDom[_index].references&&(stylesInDom[_index].updater(),stylesInDom.splice(_index,1))}lastIdentifiers=newLastIdentifiers}}}},function(module,exports,__webpack_require__){"use strict";module.exports=function(useSourceMap){var list=[];return list.toString=function(){return this.map((function(item){var content=function(item,useSourceMap){var content=item[1]||"",cssMapping=item[3];if(!cssMapping)return content;if(useSourceMap&&"function"==typeof btoa){var sourceMapping=(sourceMap=cssMapping,base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64),"/*# ".concat(data," */")),sourceURLs=cssMapping.sources.map((function(source){return"/*# sourceURL=".concat(cssMapping.sourceRoot||"").concat(source," */")}));return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}var sourceMap,base64,data;return[content].join("\n")}(item,useSourceMap);return item[2]?"@media ".concat(item[2]," {").concat(content,"}"):content})).join("")},list.i=function(modules,mediaQuery,dedupe){"string"==typeof modules&&(modules=[[null,modules,""]]);var alreadyImportedModules={};if(dedupe)for(var i=0;i<this.length;i++){var id=this[i][0];null!=id&&(alreadyImportedModules[id]=!0)}for(var _i=0;_i<modules.length;_i++){var item=[].concat(modules[_i]);dedupe&&alreadyImportedModules[item[0]]||(mediaQuery&&(item[2]?item[2]="".concat(mediaQuery," and ").concat(item[2]):item[2]=mediaQuery),list.push(item))}},list}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CONTROL_TYPES})),__webpack_require__.d(__webpack_exports__,"g",(function(){return setControl})),__webpack_require__.d(__webpack_exports__,"b",(function(){return addControl})),__webpack_require__.d(__webpack_exports__,"d",(function(){return moveControl})),__webpack_require__.d(__webpack_exports__,"f",(function(){return removeControl})),__webpack_require__.d(__webpack_exports__,"e",(function(){return newControl})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getTitle}));const CONTROL_TYPES={LIST:"list",RANGE:"range"},setControl=(controls,controlIndex,control)=>[...controls.slice(0,controlIndex),control,...controls.slice(controlIndex+1)],addControl=(controls,control)=>[...controls,control],moveControl=(controls,controlIndex,direction)=>{let newIndex;if(newIndex=direction>=0?controlIndex+1:controlIndex-1,newIndex<0)return[...controls.slice(1),controls[0]];if(newIndex>=controls.length){const lastItemIndex=controls.length-1;return[controls[lastItemIndex],...controls.slice(0,lastItemIndex)]}{const swapped=controls.slice(),temp=swapped[newIndex];return swapped[newIndex]=swapped[controlIndex],swapped[controlIndex]=temp,swapped}},removeControl=(controls,controlIndex)=>[...controls.slice(0,controlIndex),...controls.slice(controlIndex+1)],getDefaultOptions=type=>{const defaultOptions={};switch(type){case CONTROL_TYPES.RANGE:defaultOptions.decimalPlaces=0,defaultOptions.step=1;break;case CONTROL_TYPES.LIST:defaultOptions.type="terms",defaultOptions.multiselect=!0,defaultOptions.dynamicOptions=!0,defaultOptions.size=5,defaultOptions.order="desc"}return defaultOptions},newControl=type=>({id:(new Date).getTime().toString(),indexPattern:"",fieldName:"",parent:"",label:"",type:type,options:getDefaultOptions(type)}),getTitle=(controlParams,controlIndex)=>{let title=`${controlParams.type}: ${controlIndex}`;return controlParams.label?title=""+controlParams.label:controlParams.fieldName&&(title=""+controlParams.fieldName),title}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getLineageMap})),__webpack_require__.d(__webpack_exports__,"b",(function(){return getParentCandidates}));var external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);function getLineageMap(controlParamsList){const lineageMap=new Map;return controlParamsList.forEach(rootControlParams=>{const lineage=[rootControlParams.id],getLineage=controlParams=>{if(external_kbnSharedDeps_Lodash_default.a.has(controlParams,"parent")&&""!==controlParams.parent&&!lineage.includes(controlParams.parent)){lineage.push(controlParams.parent);const parent=(controlId=controlParams.parent,controlParamsList.find(controlParams=>controlParams.id===controlId));parent&&getLineage(parent)}var controlId};getLineage(rootControlParams),lineageMap.set(rootControlParams.id,lineage)}),lineageMap}var editor_utils=__webpack_require__(15);function getParentCandidates(controlParamsList,controlId,lineageMap){return controlParamsList.filter(controlParams=>{if(!controlParams.indexPattern||!controlParams.fieldName)return!1;const lineage=lineageMap.get(controlParams.id);return null==lineage||!lineage.includes(controlId)}).map((controlParams,controlIndex)=>({value:controlParams.id,text:Object(editor_utils.c)(controlParams,controlIndex)}))}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(18);case"v7light":return __webpack_require__(20);case"v8dark":return __webpack_require__(22);case"v8light":return __webpack_require__(24)}},function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(19);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".icvContainer__wrapper{scrollbar-width:thin;min-height:0;flex:1 1 0;display:flex;overflow:auto}.icvContainer__wrapper::-webkit-scrollbar{width:16px;height:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);border:6px solid rgba(0,0,0,0);background-clip:content-box}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.icvContainer{width:100%;margin:0 4px;padding:8px}\n",""]),module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(21);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".icvContainer__wrapper{scrollbar-width:thin;min-height:0;flex:1 1 0;display:flex;overflow:auto}.icvContainer__wrapper::-webkit-scrollbar{width:16px;height:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);border:6px solid rgba(0,0,0,0);background-clip:content-box}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.icvContainer{width:100%;margin:0 4px;padding:8px}\n",""]),module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(23);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".icvContainer__wrapper{scrollbar-width:thin;min-height:0;flex:1 1 0;display:flex;overflow:auto}.icvContainer__wrapper::-webkit-scrollbar{width:16px;height:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,0.5);border:6px solid rgba(0,0,0,0);background-clip:content-box}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.icvContainer{width:100%;margin:0 4px;padding:8px}\n",""]),module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(13),content=__webpack_require__(25);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){(exports=__webpack_require__(14)(!1)).push([module.i,".icvContainer__wrapper{scrollbar-width:thin;min-height:0;flex:1 1 0;display:flex;overflow:auto}.icvContainer__wrapper::-webkit-scrollbar{width:16px;height:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,0.5);border:6px solid rgba(0,0,0,0);background-clip:content-box}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.icvContainer{width:100%;margin:0 4px;padding:8px}\n",""]),module.exports=exports},,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"createInputControlVisController",(function(){return createInputControlVisController}));var external_kbnSharedDeps_React_=__webpack_require__(1),external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_),external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_),external_kbnSharedDeps_ReactDom_=__webpack_require__(11),public_=__webpack_require__(3),external_kbnSharedDeps_ElasticEui_=__webpack_require__(8),external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(9),editor_utils=__webpack_require__(15),external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);function FormRow(props){let control=props.children;props.disableMsg&&(control=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{position:"top",content:props.disableMsg,anchorClassName:"eui-displayBlock"},control));const label=props.warningMsg?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiToolTip,{position:"top",content:props.warningMsg},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiIcon,{type:"alert"})),props.label):props.label;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFormRow,{label:label,id:props.id,"data-test-subj":"inputControl"+props.controlIndex},control)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class list_control_ListControlUi extends external_kbnSharedDeps_React_.PureComponent{constructor(props){super(props),_defineProperty(this,"isMounted",!1),_defineProperty(this,"state",{isLoading:!1}),_defineProperty(this,"textInput",void 0),_defineProperty(this,"componentDidMount",()=>{this.textInput&&this.textInput.setAttribute("focusable","false"),this.isMounted=!0}),_defineProperty(this,"componentWillUnmount",()=>{this.isMounted=!1}),_defineProperty(this,"setTextInputRef",ref=>{this.textInput=ref}),_defineProperty(this,"handleOnChange",selectedOptions=>{const selectedValues=selectedOptions.map(({value:value})=>value);this.props.stageFilter(this.props.controlIndex,selectedValues)}),_defineProperty(this,"debouncedFetch",external_kbnSharedDeps_Lodash_default.a.debounce(async searchValue=>{this.props.fetchOptions&&await this.props.fetchOptions(searchValue),this.isMounted&&this.setState({isLoading:!1})},300)),_defineProperty(this,"onSearchChange",searchValue=>{this.setState({isLoading:!0},this.debouncedFetch.bind(null,searchValue))}),this.textInput=null}renderControl(){var _this$props$options;const{intl:intl}=this.props;if(this.props.disableMsg)return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFieldText,{"aria-label":intl.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),placeholder:intl.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),disabled:!0});const options=null===(_this$props$options=this.props.options)||void 0===_this$props$options?void 0:_this$props$options.map(option=>({label:this.props.formatOptionLabel(option).toString(),value:option,"data-test-subj":"option_"+option.toString().replace(" ","_")})).sort((a,b)=>a.label.toLowerCase().localeCompare(b.label.toLowerCase())),selectedOptions=this.props.selectedOptions.map(selectedOption=>({label:this.props.formatOptionLabel(selectedOption).toString(),value:selectedOption}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiComboBox,{placeholder:intl.formatMessage({id:"inputControl.vis.listControl.selectPlaceholder",defaultMessage:"Select..."}),options:options,isLoading:this.state.isLoading,async:this.props.dynamicOptions,onSearchChange:this.props.dynamicOptions?this.onSearchChange:void 0,selectedOptions:selectedOptions,onChange:this.handleOnChange,singleSelection:!this.props.multiselect,"data-test-subj":"listControlSelect"+this.props.controlIndex,inputRef:this.setTextInputRef})}render(){const partialResultsWarningMessage=external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.vis.listControl.partialResultsWarningMessage",{defaultMessage:"Terms list might be incomplete because the request is taking too long. Adjust the autocomplete settings in kibana.yml for complete results."});return external_kbnSharedDeps_React_default.a.createElement(FormRow,{id:this.props.id,label:this.props.label,warningMsg:this.props.partialResults?partialResultsWarningMessage:void 0,controlIndex:this.props.controlIndex,disableMsg:this.props.disableMsg},this.renderControl())}}_defineProperty(list_control_ListControlUi,"defaultProps",{dynamicOptions:!1,multiselect:!0,selectedOptions:[],options:[]});const list_control_ListControl=Object(external_kbnSharedDeps_KbnI18nReact_.injectI18n)(list_control_ListControlUi);var kibanaReact_public_=__webpack_require__(12);function range_control_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function roundWithPrecision(value,decimalPlaces,roundFunction){if(decimalPlaces<=0)return roundFunction(value);let results=value;return results*=Math.pow(10,decimalPlaces),results=roundFunction(results),results/=Math.pow(10,decimalPlaces),results}class range_control_RangeControl extends external_kbnSharedDeps_React_.PureComponent{constructor(...args){super(...args),range_control_defineProperty(this,"state",{}),range_control_defineProperty(this,"onChangeComplete",external_kbnSharedDeps_Lodash_default.a.debounce(value=>{const controlValue={min:value[0],max:value[1]};this.props.stageFilter(this.props.controlIndex,controlValue)},200))}static getDerivedStateFromProps(nextProps,prevState){const nextValue=nextProps.control.hasValue()?[nextProps.control.value.min,nextProps.control.value.max]:["",""];return nextProps.control.hasValue()&&null==nextProps.control.value.min&&(nextValue[0]=""),nextProps.control.hasValue()&&null==nextProps.control.value.max&&(nextValue[1]=""),nextValue!==prevState.prevValue?{value:nextValue,prevValue:nextValue}:null}renderControl(){if(!this.props.control.isEnabled())return external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_.ValidatedDualRange,{disabled:!0,showInput:!0});const decimalPlaces=external_kbnSharedDeps_Lodash_default.a.get(this.props,"control.options.decimalPlaces",0),min=function(value,decimalPlaces){return roundWithPrecision(value,decimalPlaces,Math.floor)}(this.props.control.min,decimalPlaces),max=function(value,decimalPlaces){return roundWithPrecision(value,decimalPlaces,Math.ceil)}(this.props.control.max,decimalPlaces),ticks=[{value:min,label:min},{value:max,label:max}];return external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_.ValidatedDualRange,{id:this.props.control.id,min:min,max:max,value:this.state.value,onChange:this.onChangeComplete,showInput:!0,showRange:!0,showTicks:!0,ticks:ticks})}render(){return external_kbnSharedDeps_React_default.a.createElement(FormRow,{id:this.props.control.id,label:this.props.control.label,controlIndex:this.props.controlIndex,disableMsg:this.props.control.isEnabled()?void 0:this.props.control.disabledReason},this.renderControl())}}__webpack_require__(17);class input_control_vis_InputControlVis extends external_kbnSharedDeps_React_.Component{constructor(props){super(props),this.handleSubmit=this.handleSubmit.bind(this),this.handleReset=this.handleReset.bind(this),this.handleClearAll=this.handleClearAll.bind(this)}handleSubmit(){this.props.submitFilters()}handleReset(){this.props.resetControls()}handleClearAll(){this.props.clearControls()}renderControls(){return this.props.controls.map((control,index)=>{let controlComponent=null;if(function(control){return control.type===editor_utils.a.LIST}(control))controlComponent=external_kbnSharedDeps_React_default.a.createElement(list_control_ListControl,{id:control.id,label:control.label,options:control.selectOptions,selectedOptions:control.value,formatOptionLabel:control.format,disableMsg:control.isEnabled()?void 0:control.disabledReason,multiselect:control.options.multiselect,partialResults:control.partialResults,dynamicOptions:control.options.dynamicOptions,controlIndex:index,stageFilter:this.props.stageFilter,fetchOptions:query=>{this.props.refreshControl(index,query)}});else{if(!function(control){return control.type===editor_utils.a.RANGE}(control))throw new Error("Unhandled control type "+control.type);controlComponent=external_kbnSharedDeps_React_default.a.createElement(range_control_RangeControl,{control:control,controlIndex:index,stageFilter:this.props.stageFilter})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{key:control.id,style:{minWidth:"250px"},"data-test-subj":"inputControlItem"},controlComponent)})}renderStagingButtons(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{wrap:!0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButton,{fill:!0,onClick:this.handleSubmit,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlSubmitBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"inputControl.vis.inputControlVis.applyChangesButtonLabel",defaultMessage:"Apply changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:this.handleReset,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlCancelBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"inputControl.vis.inputControlVis.cancelChangesButtonLabel",defaultMessage:"Cancel changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexItem,{grow:!1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiButtonEmpty,{onClick:this.handleClearAll,disabled:!this.props.hasValues(),"data-test-subj":"inputControlClearBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_.FormattedMessage,{id:"inputControl.vis.inputControlVis.clearFormButtonLabel",defaultMessage:"Clear form"}))))}render(){let stagingButtons;return this.props.controls.length>0&&!this.props.updateFiltersOnChange&&(stagingButtons=this.renderStagingButtons()),external_kbnSharedDeps_React_default.a.createElement("div",{className:"icvContainer__wrapper"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"icvContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_.EuiFlexGroup,{wrap:!0},this.renderControls()),stagingButtons))}}function control_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function noValuesDisableMsg(fieldName,indexPatternName){return external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.control.noValuesDisableTooltip",{defaultMessage:'Filtering occurs on the "{fieldName}" field, which doesn\'t exist on any documents in the "{indexPatternName}" index pattern. Choose a different field or index documents that contain values for this field.',values:{fieldName:fieldName,indexPatternName:indexPatternName}})}function noIndexPatternMsg(indexPatternId){return external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.control.noIndexPatternTooltip",{defaultMessage:"Could not locate index-pattern id: {indexPatternId}.",values:{indexPatternId:indexPatternId}})}class control_Control{constructor(controlParams,filterManager,useTimeFilter){this.controlParams=controlParams,this.filterManager=filterManager,this.useTimeFilter=useTimeFilter,control_defineProperty(this,"kbnFilter",null),control_defineProperty(this,"enable",!1),control_defineProperty(this,"disabledReason",""),control_defineProperty(this,"value",void 0),control_defineProperty(this,"id",void 0),control_defineProperty(this,"options",void 0),control_defineProperty(this,"type",void 0),control_defineProperty(this,"label",void 0),control_defineProperty(this,"ancestors",[]),control_defineProperty(this,"format",value=>{const indexPattern=this.filterManager.getIndexPattern(),field=this.filterManager.getField();return field&&indexPattern?indexPattern.getFormatterForField(field).convert(value):value}),this.id=controlParams.id,this.controlParams=controlParams,this.options=controlParams.options,this.type=controlParams.type,this.label=controlParams.label?controlParams.label:controlParams.fieldName,this.reset(),this.disable(external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.control.notInitializedTooltip",{defaultMessage:"Control has not been initialized"}))}setAncestors(ancestors){this.ancestors=ancestors}hasAncestors(){return this.ancestors&&this.ancestors.length>0}hasUnsetAncestor(){return this.ancestors.reduce((accumulator,ancestor)=>accumulator||!ancestor.hasValue(),!1)}getAncestorValues(){return this.ancestors.map(ancestor=>ancestor.value)}getAncestorFilters(){return this.ancestors.map(ancestor=>ancestor.filterManager.createFilter(ancestor.value))}isEnabled(){return this.enable}disable(reason){this.enable=!1,this.disabledReason=reason}set(newValue){this.value=newValue,this.hasValue()?this.kbnFilter=this.filterManager.createFilter(this.value):this.kbnFilter=null}reset(){this.kbnFilter=null,this.value=this.filterManager.getValueFromFilterBar()}clear(){this.value=void 0}hasChanged(){return!external_kbnSharedDeps_Lodash_default.a.isEqual(this.value,this.filterManager.getValueFromFilterBar())}hasKbnFilter(){return!!this.kbnFilter}getKbnFilter(){return this.kbnFilter}hasValue(){return void 0!==this.value}}class filter_manager_FilterManager{constructor(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter){var obj,key,value;this.controlId=controlId,this.fieldName=fieldName,this.indexPatternId=indexPatternId,this.indexPatternsService=indexPatternsService,this.queryFilter=queryFilter,value=void 0,(key="indexPattern")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}async init(){try{this.indexPattern||(this.indexPattern=await this.indexPatternsService.get(this.indexPatternId))}catch(e){}}getIndexPattern(){return this.indexPattern}getField(){var _this$indexPattern;return null===(_this$indexPattern=this.indexPattern)||void 0===_this$indexPattern?void 0:_this$indexPattern.fields.getByName(this.fieldName)}findFilters(){return external_kbnSharedDeps_Lodash_default.a.flatten([this.queryFilter.getAppFilters(),this.queryFilter.getGlobalFilters()]).filter(kbnFilter=>external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"meta.controlledBy")===this.controlId)}}var data_public_=__webpack_require__(10);class range_filter_manager_RangeFilterManager extends filter_manager_FilterManager{createFilter(value){const indexPattern=this.getIndexPattern(),newFilter=data_public_.esFilters.buildRangeFilter(indexPattern.fields.getByName(this.fieldName),{gte:(sliderValue=value).min,lte:sliderValue.max},indexPattern);var sliderValue;return newFilter.meta.key=this.fieldName,newFilter.meta.controlledBy=this.controlId,newFilter}getValueFromFilterBar(){const kbnFilters=this.findFilters();if(0===kbnFilters.length)return;let range;return range=external_kbnSharedDeps_Lodash_default.a.has(kbnFilters[0],"script")?external_kbnSharedDeps_Lodash_default.a.get(kbnFilters[0],"script.script.params"):external_kbnSharedDeps_Lodash_default.a.get(kbnFilters[0],["range",this.fieldName]),range?function(range){const sliderValue={};return external_kbnSharedDeps_Lodash_default.a.has(range,"gte")&&(sliderValue.min=external_kbnSharedDeps_Lodash_default.a.get(range,"gte")),external_kbnSharedDeps_Lodash_default.a.has(range,"gt")&&(sliderValue.min=external_kbnSharedDeps_Lodash_default.a.get(range,"gt")),external_kbnSharedDeps_Lodash_default.a.has(range,"lte")&&(sliderValue.max=external_kbnSharedDeps_Lodash_default.a.get(range,"lte")),external_kbnSharedDeps_Lodash_default.a.has(range,"lt")&&(sliderValue.max=external_kbnSharedDeps_Lodash_default.a.get(range,"lt")),sliderValue}(range):void 0}}async function createSearchSource({create:create},initialState,indexPattern,aggs,useTimeFilter,filters=[],timefilter){const searchSource=await create(initialState||{});return searchSource.setParent(void 0),searchSource.setField("filter",()=>{const activeFilters=[...filters];if(useTimeFilter){const filter=timefilter.createFilter(indexPattern);filter&&activeFilters.push(filter)}return activeFilters}),searchSource.setField("size",0),searchSource.setField("index",indexPattern),searchSource.setField("aggs",aggs),searchSource}function range_control_factory_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class range_control_factory_RangeControl extends control_Control{constructor(controlParams,filterManager,useTimeFilter,searchSource,deps){super(controlParams,filterManager,useTimeFilter),range_control_factory_defineProperty(this,"searchSource",void 0),range_control_factory_defineProperty(this,"timefilter",void 0),range_control_factory_defineProperty(this,"abortController",void 0),range_control_factory_defineProperty(this,"min",void 0),range_control_factory_defineProperty(this,"max",void 0),this.timefilter=deps.data.query.timefilter.timefilter,this.searchSource=searchSource}async fetch(){this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const indexPattern=this.filterManager.getIndexPattern();if(!indexPattern)return void this.disable(noIndexPatternMsg(this.controlParams.indexPattern));const fieldName=this.filterManager.fieldName,aggs=(field=>{const aggBody={};return field&&(field.scripted?aggBody.script={source:field.script,lang:field.lang}:aggBody.field=field.name),{maxAgg:{max:aggBody},minAgg:{min:aggBody}}})(indexPattern.fields.getByName(fieldName)),searchSource=await createSearchSource(this.searchSource,null,indexPattern,aggs,this.useTimeFilter,[],this.timefilter),abortSignal=this.abortController.signal;let resp;try{resp=await searchSource.fetch({abortSignal:abortSignal})}catch(error){if("AbortError"===error.name)return;return void this.disable(external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.rangeControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch range min and max, error: {errorMessage}",values:{errorMessage:error.message}}))}const min=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.minAgg.value",null),max=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.maxAgg.value",null);null!==min&&null!==max?(this.min=min,this.max=max,this.enable=!0):this.disable(noValuesDisableMsg(fieldName,indexPattern.title))}destroy(){this.abortController&&this.abortController.abort()}}async function rangeControlFactory(controlParams,useTimeFilter,deps){const[,{data:dataPluginStart}]=await deps.core.getStartServices(),rangeControl=new range_control_factory_RangeControl(controlParams,new range_filter_manager_RangeFilterManager(controlParams.id,controlParams.fieldName,controlParams.indexPattern,dataPluginStart.indexPatterns,deps.data.query.filterManager),useTimeFilter,dataPluginStart.search.searchSource,deps);return await rangeControl.filterManager.init(),rangeControl}class phrase_filter_manager_PhraseFilterManager extends filter_manager_FilterManager{constructor(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter){super(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter)}createFilter(phrases){const indexPattern=this.getIndexPattern();let newFilter;const value=indexPattern.fields.getByName(this.fieldName);if(!value)throw new Error(`Unable to find field with name: ${this.fieldName} on indexPattern`);return newFilter=1===phrases.length?data_public_.esFilters.buildPhraseFilter(value,phrases[0],indexPattern):data_public_.esFilters.buildPhrasesFilter(value,phrases,indexPattern),newFilter.meta.key=this.fieldName,newFilter.meta.controlledBy=this.controlId,newFilter}getValueFromFilterBar(){const kbnFilters=this.findFilters();if(0===kbnFilters.length)return;const values=kbnFilters.map(kbnFilter=>this.getValueFromFilter(kbnFilter)).filter(value=>null!=value);return 0!==values.length?values.reduce((accumulator,currentValue)=>accumulator.concat(currentValue),[]):void 0}getValueFromFilter(kbnFilter){if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,"query.bool.should"))return external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"query.bool.should").map(kbnQueryFilter=>this.getValueFromFilter(kbnQueryFilter)).filter(value=>!!value);if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,"script"))return external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"script.script.params.value");if(data_public_.esFilters.isPhraseFilter(kbnFilter)){if(data_public_.esFilters.getPhraseFilterField(kbnFilter)!==this.fieldName)return;return data_public_.esFilters.getPhraseFilterValue(kbnFilter)}return external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,["match_phrase",this.fieldName])?external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,["match_phrase",this.fieldName]):void 0}}function list_control_factory_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class list_control_factory_ListControl extends control_Control{constructor(controlParams,filterManager,useTimeFilter,_searchSource,deps){super(controlParams,filterManager,useTimeFilter),list_control_factory_defineProperty(this,"getSettings",void 0),list_control_factory_defineProperty(this,"timefilter",void 0),list_control_factory_defineProperty(this,"searchSource",void 0),list_control_factory_defineProperty(this,"abortController",void 0),list_control_factory_defineProperty(this,"lastAncestorValues",void 0),list_control_factory_defineProperty(this,"lastQuery",void 0),list_control_factory_defineProperty(this,"partialResults",void 0),list_control_factory_defineProperty(this,"selectOptions",void 0),list_control_factory_defineProperty(this,"fetch",async query=>{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const indexPattern=this.filterManager.getIndexPattern();if(!indexPattern)return void this.disable(noIndexPatternMsg(this.controlParams.indexPattern));let ancestorFilters;if(this.hasAncestors()){if(this.hasUnsetAncestor())return this.disable(external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.listControl.disableTooltip",{defaultMessage:"Disabled until '{label}' is set.",values:{label:this.ancestors[0].label}})),void(this.lastAncestorValues=void 0);const ancestorValues=this.getAncestorValues();if(external_kbnSharedDeps_Lodash_default.a.isEqual(ancestorValues,this.lastAncestorValues)&&external_kbnSharedDeps_Lodash_default.a.isEqual(query,this.lastQuery))return;this.lastAncestorValues=ancestorValues,this.lastQuery=query,ancestorFilters=this.getAncestorFilters()}const fieldName=this.filterManager.fieldName,settings=await this.getSettings(),initialSearchSourceState={timeout:settings.autocompleteTimeout+"ms",terminate_after:Number(settings.autocompleteTerminateAfter)},field=null==indexPattern?void 0:indexPattern.fields.getAll().find(({name:name})=>name===this.controlParams.fieldName);field&&"string"!==field.type&&(this.options.dynamicOptions=!1);const aggs=(({field:field,size:size,direction:direction,query:query})=>{const terms={order:{_count:direction}};return size&&(terms.size=size<1?1:size),null!=field&&field.scripted?(terms.script={source:field.script,lang:field.lang},terms.value_type="number"===field.type?"float":field.type):terms.field=null==field?void 0:field.name,query&&(terms.include=`.*${function(query=""){return query.replace(/[.?+*|{}[\]()"\\#@&<>~]/g,match=>"\\"+match)}(query)}.*`),{termsAgg:{terms:terms}}})({field:indexPattern.fields.getByName(fieldName),size:this.options.dynamicOptions?null:external_kbnSharedDeps_Lodash_default.a.get(this.options,"size",5),direction:"desc",query:query}),searchSource=await createSearchSource(this.searchSource,initialSearchSourceState,indexPattern,aggs,this.useTimeFilter,ancestorFilters,this.timefilter),abortSignal=this.abortController.signal;let resp;this.lastQuery=query;try{resp=await searchSource.fetch({abortSignal:abortSignal})}catch(error){if("AbortError"===error.name)return;return void this.disable(external_kbnSharedDeps_KbnI18n_.i18n.translate("inputControl.listControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch terms, error: {errorMessage}",values:{errorMessage:error.message}}))}if(query&&this.lastQuery!==query)return;const selectOptions=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.termsAgg.buckets",[]).map(bucket=>null==bucket?void 0:bucket.key);0!==selectOptions.length||query?(this.partialResults=resp.terminated_early||resp.timed_out,this.selectOptions=selectOptions,this.enable=!0,this.disabledReason=""):this.disable(noValuesDisableMsg(fieldName,indexPattern.title))}),this.getSettings=deps.getSettings,this.timefilter=deps.data.query.timefilter.timefilter,this.searchSource=_searchSource}destroy(){this.abortController&&this.abortController.abort()}hasValue(){return void 0!==this.value&&this.value.length>0}}async function listControlFactory(controlParams,useTimeFilter,deps){const[,{data:dataPluginStart}]=await deps.core.getStartServices(),listControl=new list_control_factory_ListControl(controlParams,new phrase_filter_manager_PhraseFilterManager(controlParams.id,controlParams.fieldName,controlParams.indexPattern,dataPluginStart.indexPatterns,deps.data.query.filterManager),useTimeFilter,dataPluginStart.search.searchSource,deps);return await listControl.filterManager.init(),listControl}var lineage=__webpack_require__(16);function vis_controller_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const createInputControlVisController=(deps,handlers)=>class{constructor(el){this.el=el,vis_controller_defineProperty(this,"I18nContext",void 0),vis_controller_defineProperty(this,"_isLoaded",!1),vis_controller_defineProperty(this,"controls",void 0),vis_controller_defineProperty(this,"queryBarUpdateHandler",void 0),vis_controller_defineProperty(this,"filterManager",void 0),vis_controller_defineProperty(this,"updateSubsciption",void 0),vis_controller_defineProperty(this,"timeFilterSubscription",void 0),vis_controller_defineProperty(this,"visParams",void 0),vis_controller_defineProperty(this,"drawVis",()=>{var _this$visParams;if(!this.I18nContext)throw new Error("no i18n context found");Object(external_kbnSharedDeps_ReactDom_.render)(external_kbnSharedDeps_React_default.a.createElement(this.I18nContext,null,external_kbnSharedDeps_React_default.a.createElement(public_.VisualizationContainer,{handlers:handlers},external_kbnSharedDeps_React_default.a.createElement(input_control_vis_InputControlVis,{updateFiltersOnChange:null===(_this$visParams=this.visParams)||void 0===_this$visParams?void 0:_this$visParams.updateFiltersOnChange,controls:this.controls,stageFilter:this.stageFilter,submitFilters:this.submitFilters,resetControls:this.updateControlsFromKbn,clearControls:this.clearControls,hasChanges:this.hasChanges,hasValues:this.hasValues,refreshControl:this.refreshControl}))),this.el)}),vis_controller_defineProperty(this,"stageFilter",async(controlIndex,newValue)=>{var _this$visParams2;this.controls[controlIndex].set(newValue),null!==(_this$visParams2=this.visParams)&&void 0!==_this$visParams2&&_this$visParams2.updateFiltersOnChange?this.submitFilters():(await this.updateNestedControls(),this.drawVis())}),vis_controller_defineProperty(this,"submitFilters",()=>{var _this$visParams3;const stagedControls=this.controls.filter(control=>control.hasChanged()),newFilters=stagedControls.map(control=>control.getKbnFilter()).filter(filter=>null!==filter);stagedControls.forEach(control=>{control.filterManager.findFilters().forEach(existingFilter=>{this.filterManager.removeFilter(existingFilter)})}),this.controls.map(control=>{control.hasAncestors()&&control.hasUnsetAncestor()&&control.filterManager.findFilters().forEach(existingFilter=>{this.filterManager.removeFilter(existingFilter)})}),this.filterManager.addFilters(newFilters,null===(_this$visParams3=this.visParams)||void 0===_this$visParams3?void 0:_this$visParams3.pinFilters)}),vis_controller_defineProperty(this,"clearControls",async()=>{this.controls.forEach(control=>{control.clear()}),await this.updateNestedControls(),this.drawVis()}),vis_controller_defineProperty(this,"updateControlsFromKbn",async()=>{this.controls.forEach(control=>{control.reset()}),await this.updateNestedControls(),this.drawVis()}),vis_controller_defineProperty(this,"hasChanges",()=>this.controls.map(control=>control.hasChanged()).some(control=>control)),vis_controller_defineProperty(this,"hasValues",()=>this.controls.map(control=>control.hasValue()).reduce((a,b)=>a||b)),vis_controller_defineProperty(this,"refreshControl",async(controlIndex,query)=>{await this.controls[controlIndex].fetch(query),this.drawVis()}),this.controls=[],this.queryBarUpdateHandler=this.updateControlsFromKbn.bind(this),this.filterManager=deps.data.query.filterManager,this.updateSubsciption=this.filterManager.getUpdates$().subscribe(this.queryBarUpdateHandler),this.timeFilterSubscription=deps.data.query.timefilter.timefilter.getTimeUpdate$().subscribe(()=>{var _this$visParams4;null!==(_this$visParams4=this.visParams)&&void 0!==_this$visParams4&&_this$visParams4.useTimeFilter&&(this._isLoaded=!1)})}async render(visParams){if(!this.I18nContext){const[{i18n:i18n}]=await deps.core.getStartServices();this.I18nContext=i18n.Context}this._isLoaded&&Object(external_kbnSharedDeps_Lodash_.isEqual)(visParams,this.visParams)||(this.visParams=visParams,this.controls=[],this.controls=await this.initControls(visParams),this._isLoaded=!0),this.drawVis()}destroy(){this.updateSubsciption.unsubscribe(),this.timeFilterSubscription.unsubscribe(),Object(external_kbnSharedDeps_ReactDom_.unmountComponentAtNode)(this.el),this.controls.forEach(control=>control.destroy())}async initControls(visParams){const controlParamsList=visParams.controls.filter(controlParams=>controlParams.indexPattern&&controlParams.fieldName),controlFactoryPromises=controlParamsList.map(controlParams=>function(controlParams){let factory=null;switch(controlParams.type){case editor_utils.a.RANGE:factory=rangeControlFactory;break;case editor_utils.a.LIST:factory=listControlFactory;break;default:throw new Error("Unhandled control type "+controlParams.type)}return factory}(controlParams)(controlParams,visParams.useTimeFilter,deps)),controls=await Promise.all(controlFactoryPromises),getControl=controlId=>controls.find(({id:id})=>id===controlId),controlInitPromises=[];return Object(lineage.a)(controlParamsList).forEach((lineage,controlId)=>{lineage.shift();const ancestors=[];lineage.forEach(ancestorId=>{const control=getControl(ancestorId);control&&ancestors.push(control)});const control=getControl(controlId);control&&(control.setAncestors(ancestors),controlInitPromises.push(control.fetch()))}),await Promise.all(controlInitPromises),controls}async updateNestedControls(){const fetchPromises=this.controls.map(async control=>{control.hasAncestors()&&await control.fetch()});return await Promise.all(fetchPromises)}}}]]);