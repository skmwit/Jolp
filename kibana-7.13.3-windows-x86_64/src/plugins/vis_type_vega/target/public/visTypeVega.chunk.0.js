(window.visTypeVega_bundle_jsonpfunction=window.visTypeVega_bundle_jsonpfunction||[]).push([[0],Array(37).concat([function(module,exports,__webpack_require__){!function(exports){"use strict";function accessor(fn,fields,name){return fn.fields=fields||[],fn.fname=name,fn}function accessorFields(fn){return null==fn?null:fn.fields}function getter(path){return 1===path.length?get1(path[0]):getN(path)}const get1=field=>function(obj){return obj[field]},getN=path=>{const len=path.length;return function(obj){for(let i=0;i<len;++i)obj=obj[path[i]];return obj}};function error(message){throw Error(message)}function splitAccessPath(p){const path=[],n=p.length;let i,j,c,q=null,b=0,s="";function push(){path.push(s+p.substring(i,j)),s="",i=j+1}for(p+="",i=j=0;j<n;++j)if(c=p[j],"\\"===c)s+=p.substring(i,j),s+=p.substring(++j,++j),i=j;else if(c===q)push(),q=null,b=-1;else{if(q)continue;i===b&&'"'===c||i===b&&"'"===c?(i=j+1,q=c):"."!==c||b?"["===c?(j>i&&push(),b=i=j+1):"]"===c&&(b||error("Access path missing open bracket: "+p),b>0&&push(),b=0,i=j+1):j>i?push():i=j+1}return b&&error("Access path missing closing bracket: "+p),q&&error("Access path missing closing quote: "+p),j>i&&(j++,push()),path}function field(field,name,opt){const path=splitAccessPath(field);return field=1===path.length?path[0]:field,accessor((opt&&opt.get||getter)(path),[field],name||field)}const id=field("id"),identity=accessor(_=>_,[],"identity"),zero=accessor(()=>0,[],"zero"),one=accessor(()=>1,[],"one"),truthy=accessor(()=>!0,[],"true"),falsy=accessor(()=>!1,[],"false");function log(method,level,input){const args=[level].concat([].slice.call(input));console[method].apply(console,args)}var isArray=Array.isArray;function isObject(_){return _===Object(_)}const isLegalKey=key=>"__proto__"!==key;function writeConfig(output,key,value,recurse){if(!isLegalKey(key))return;let k,o;if(isObject(value)&&!isArray(value))for(k in o=isObject(output[key])?output[key]:output[key]={},value)recurse&&(!0===recurse||recurse[k])?writeConfig(o,k,value[k]):isLegalKey(k)&&(o[k]=value[k]);else output[key]=value}function mergeNamed(a,b){if(null==a)return b;const map={},out=[];function add(_){map[_.name]||(map[_.name]=1,out.push(_))}return b.forEach(add),a.forEach(add),out}function peek(array){return array[array.length-1]}function toNumber(_){return null==_||""===_?null:+_}const exp=sign=>x=>sign*Math.exp(x),log$1=sign=>x=>Math.log(sign*x),symlog=c=>x=>Math.sign(x)*Math.log1p(Math.abs(x/c)),symexp=c=>x=>Math.sign(x)*Math.expm1(Math.abs(x))*c,pow=exponent=>x=>x<0?-Math.pow(-x,exponent):Math.pow(x,exponent);function pan(domain,delta,lift,ground){const d0=lift(domain[0]),d1=lift(peek(domain)),dd=(d1-d0)*delta;return[ground(d0-dd),ground(d1-dd)]}function zoom(domain,anchor,scale,lift,ground){const d0=lift(domain[0]),d1=lift(peek(domain)),da=null!=anchor?lift(anchor):(d0+d1)/2;return[ground(da+(d0-da)*scale),ground(da+(d1-da)*scale)]}function array(_){return null!=_?isArray(_)?_:[_]:[]}function isFunction(_){return"function"==typeof _}const ascending=(u,v)=>(u<v||null==u)&&null!=v?-1:(u>v||null==v)&&null!=u?1:(v=v instanceof Date?+v:v,(u=u instanceof Date?+u:u)!==u&&v==v?-1:v!=v&&u==u?1:0),comparator=(fields,orders)=>1===fields.length?compare1(fields[0],orders[0]):compareN(fields,orders,fields.length),compare1=(field,order)=>function(a,b){return ascending(field(a),field(b))*order},compareN=(fields,orders,n)=>(orders.push(0),function(a,b){let f,c=0,i=-1;for(;0===c&&++i<n;)f=fields[i],c=ascending(f(a),f(b));return c*orders[i]});function extend(_){for(let x,k,i=1,len=arguments.length;i<len;++i)for(k in x=arguments[i],x)_[k]=x[k];return _}const hop=Object.prototype.hasOwnProperty;function has(object,property){return hop.call(object,property)}const NULL={};function isDate(_){return"[object Date]"===Object.prototype.toString.call(_)}function isNumber(_){return"number"==typeof _}function isString(_){return"string"==typeof _}function repeat(str,reps){let s="";for(;--reps>=0;)s+=str;return s}const defaultParser=_=>isNumber(_)||isDate(_)?_:Date.parse(_);exports.Debug=4,exports.Error=1,exports.Info=3,exports.None=0,exports.Warn=2,exports.accessor=accessor,exports.accessorFields=accessorFields,exports.accessorName=function(fn){return null==fn?null:fn.fname},exports.array=array,exports.ascending=ascending,exports.clampRange=function(range,min,max){let span,lo=range[0],hi=range[1];return hi<lo&&(span=hi,hi=lo,lo=span),span=hi-lo,span>=max-min?[min,max]:[lo=Math.min(Math.max(lo,min),max-span),lo+span]},exports.compare=function(fields,orders,opt){opt=opt||{},orders=array(orders)||[];const ord=[],get=[],fmap={},gen=opt.comparator||comparator;return array(fields).forEach((f,i)=>{null!=f&&(ord.push("descending"===orders[i]?-1:1),get.push(f=isFunction(f)?f:field(f,null,opt)),(accessorFields(f)||[]).forEach(_=>fmap[_]=1))}),0===get.length?null:accessor(gen(get,ord),Object.keys(fmap))},exports.constant=function(_){return isFunction(_)?_:()=>_},exports.debounce=function(delay,handler){let tid;return e=>{tid&&clearTimeout(tid),tid=setTimeout(()=>(handler(e),tid=null),delay)}},exports.error=error,exports.extend=extend,exports.extent=function(array,f){let n,v,min,max,i=0;if(array&&(n=array.length))if(null==f){for(v=array[i];i<n&&(null==v||v!=v);v=array[++i]);for(min=max=v;i<n;++i)v=array[i],null!=v&&(v<min&&(min=v),v>max&&(max=v))}else{for(v=f(array[i]);i<n&&(null==v||v!=v);v=f(array[++i]));for(min=max=v;i<n;++i)v=f(array[i]),null!=v&&(v<min&&(min=v),v>max&&(max=v))}return[min,max]},exports.extentIndex=function(array,f){const n=array.length;let a,b,c,u,v,i=-1;if(null==f){for(;++i<n;)if(b=array[i],null!=b&&b>=b){a=c=b;break}if(i===n)return[-1,-1];for(u=v=i;++i<n;)b=array[i],null!=b&&(a>b&&(a=b,u=i),c<b&&(c=b,v=i))}else{for(;++i<n;)if(b=f(array[i],i,array),null!=b&&b>=b){a=c=b;break}if(i===n)return[-1,-1];for(u=v=i;++i<n;)b=f(array[i],i,array),null!=b&&(a>b&&(a=b,u=i),c<b&&(c=b,v=i))}return[u,v]},exports.falsy=falsy,exports.fastmap=function(input){let test,obj={};function has$1(key){return has(obj,key)&&obj[key]!==NULL}const map={size:0,empty:0,object:obj,has:has$1,get:key=>has$1(key)?obj[key]:void 0,set(key,value){return has$1(key)||(++map.size,obj[key]===NULL&&--map.empty),obj[key]=value,this},delete(key){return has$1(key)&&(--map.size,++map.empty,obj[key]=NULL),this},clear(){map.size=map.empty=0,map.object=obj={}},test(_){return arguments.length?(test=_,map):test},clean(){const next={};let size=0;for(const key in obj){const value=obj[key];value===NULL||test&&test(value)||(next[key]=value,++size)}map.size=size,map.empty=0,map.object=obj=next}};return input&&Object.keys(input).forEach(key=>{map.set(key,input[key])}),map},exports.field=field,exports.flush=function(range,value,threshold,left,right,center){if(!threshold&&0!==threshold)return center;const t=+threshold;let l,a=range[0],b=peek(range);b<a&&(l=a,a=b,b=l),l=Math.abs(value-a);const r=Math.abs(b-value);return l<r&&l<=t?left:r<=t?right:center},exports.hasOwnProperty=has,exports.id=id,exports.identity=identity,exports.inherits=function(child,parent,members){const proto=child.prototype=Object.create(parent.prototype);return proto.constructor=child,extend(proto,members)},exports.inrange=function(value,range,left,right){let t,r0=range[0],r1=range[range.length-1];return r0>r1&&(t=r0,r0=r1,r1=t),right=void 0===right||right,((left=void 0===left||left)?r0<=value:r0<value)&&(right?value<=r1:value<r1)},exports.isArray=isArray,exports.isBoolean=function(_){return"boolean"==typeof _},exports.isDate=isDate,exports.isFunction=isFunction,exports.isIterable=function(_){return _&&isFunction(_[Symbol.iterator])},exports.isNumber=isNumber,exports.isObject=isObject,exports.isRegExp=function(_){return"[object RegExp]"===Object.prototype.toString.call(_)},exports.isString=isString,exports.key=function(fields,flat,opt){fields&&(fields=flat?array(fields).map(f=>f.replace(/\\(.)/g,"$1")):array(fields));const len=fields&&fields.length,gen=opt&&opt.get||getter,map=f=>gen(flat?[f]:splitAccessPath(f));let fn;if(len)if(1===len){const get=map(fields[0]);fn=function(_){return""+get(_)}}else{const get=fields.map(map);fn=function(_){let s=""+get[0](_),i=0;for(;++i<len;)s+="|"+get[i](_);return s}}else fn=function(){return""};return accessor(fn,fields,"key")},exports.lerp=function(array,frac){const lo=array[0],hi=peek(array),f=+frac;return f?1===f?hi:lo+f*(hi-lo):lo},exports.logger=function(_,method){let level=_||0;return{level(_){return arguments.length?(level=+_,this):level},error(){return level>=1&&log(method||"error","ERROR",arguments),this},warn(){return level>=2&&log(method||"warn","WARN",arguments),this},info(){return level>=3&&log(method||"log","INFO",arguments),this},debug(){return level>=4&&log(method||"log","DEBUG",arguments),this}}},exports.lruCache=function(maxsize){let curr,prev,size;maxsize=+maxsize||1e4;const clear=()=>{curr={},prev={},size=0},update=(key,value)=>(++size>maxsize&&(prev=curr,curr={},size=1),curr[key]=value);return clear(),{clear:clear,has:key=>has(curr,key)||has(prev,key),get:key=>has(curr,key)?curr[key]:has(prev,key)?update(key,prev[key]):void 0,set:(key,value)=>has(curr,key)?curr[key]=value:update(key,value)}},exports.merge=function(compare,array0,array1,output){const n0=array0.length,n1=array1.length;if(!n1)return array0;if(!n0)return array1;const merged=output||new array0.constructor(n0+n1);let i0=0,i1=0,i=0;for(;i0<n0&&i1<n1;++i)merged[i]=compare(array0[i0],array1[i1])>0?array1[i1++]:array0[i0++];for(;i0<n0;++i0,++i)merged[i]=array0[i0];for(;i1<n1;++i1,++i)merged[i]=array1[i1];return merged},exports.mergeConfig=function(...configs){return configs.reduce((out,source)=>{for(const key in source)if("signals"===key)out.signals=mergeNamed(out.signals,source.signals);else{const r="legend"===key?{layout:1}:"style"===key||null;writeConfig(out,key,source[key],r)}return out},{})},exports.one=one,exports.pad=function(str,length,padchar,align){const c=padchar||" ",s=str+"",n=length-s.length;return n<=0?s:"left"===align?repeat(c,n)+s:"center"===align?repeat(c,~~(n/2))+s+repeat(c,Math.ceil(n/2)):s+repeat(c,n)},exports.panLinear=function(domain,delta){return pan(domain,delta,toNumber,identity)},exports.panLog=function(domain,delta){var sign=Math.sign(domain[0]);return pan(domain,delta,log$1(sign),exp(sign))},exports.panPow=function(domain,delta,exponent){return pan(domain,delta,pow(exponent),pow(1/exponent))},exports.panSymlog=function(domain,delta,constant){return pan(domain,delta,symlog(constant),symexp(constant))},exports.peek=peek,exports.quarter=function(date){return 1+~~(new Date(date).getMonth()/3)},exports.repeat=repeat,exports.span=function(array){return array&&peek(array)-array[0]||0},exports.splitAccessPath=splitAccessPath,exports.stringValue=function $(x){return isArray(x)?"["+x.map($)+"]":isObject(x)||isString(x)?JSON.stringify(x).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):x},exports.toBoolean=function(_){return null==_||""===_?null:!(!_||"false"===_||"0"===_||!_)},exports.toDate=function(_,parser){return parser=parser||defaultParser,null==_||""===_?null:parser(_)},exports.toNumber=toNumber,exports.toSet=function(_){const s={},n=_.length;for(let i=0;i<n;++i)s[_[i]]=!0;return s},exports.toString=function(_){return null==_||""===_?null:_+""},exports.truncate=function(str,length,align,ellipsis){const e=null!=ellipsis?ellipsis:"â€¦",s=str+"",n=s.length,l=Math.max(0,length-e.length);return n<=length?s:"left"===align?e+s.slice(n-l):"center"===align?s.slice(0,Math.ceil(l/2))+e+s.slice(n-~~(l/2)):s.slice(0,l)+e},exports.truthy=truthy,exports.utcquarter=function(date){return 1+~~(new Date(date).getUTCMonth()/3)},exports.visitArray=function(array,filter,visitor){if(array)if(filter){const n=array.length;for(let i=0;i<n;++i){const t=filter(array[i]);t&&visitor(t,i,array)}}else array.forEach(visitor)},exports.writeConfig=writeConfig,exports.zero=zero,exports.zoomLinear=function(domain,anchor,scale){return zoom(domain,anchor,scale,toNumber,identity)},exports.zoomLog=function(domain,anchor,scale){const sign=Math.sign(domain[0]);return zoom(domain,anchor,scale,log$1(sign),exp(sign))},exports.zoomPow=function(domain,anchor,scale,exponent){return zoom(domain,anchor,scale,pow(exponent),pow(1/exponent))},exports.zoomSymlog=function(domain,anchor,scale,constant){return zoom(domain,anchor,scale,symlog(constant),symexp(constant))},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},,,function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaLoader,vegaFormat){"use strict";function UniqueList(idFunc){const $=idFunc||vegaUtil.identity,list=[],ids={};return list.add=_=>{const id=$(_);return ids[id]||(ids[id]=1,list.push(_)),list},list.remove=_=>{const id=$(_);if(ids[id]){ids[id]=0;const idx=list.indexOf(_);idx>=0&&list.splice(idx,1)}return list},list}async function asyncCallback(df,callback){try{await callback(df)}catch(err){df.error(err)}}const TUPLE_ID_KEY=Symbol("vega_id");let TUPLE_ID=1;function tupleid(t){return t[TUPLE_ID_KEY]}function setid(t,id){return t[TUPLE_ID_KEY]=id,t}function ingest(datum){const t=datum===Object(datum)?datum:{data:datum};return tupleid(t)?t:setid(t,TUPLE_ID++)}function rederive(t,d){for(const k in t)d[k]=t[k];return d}function isChangeSet(v){return v&&v.constructor===changeset}function changeset(){const add=[],rem=[],mod=[],remp=[],modp=[];let clean=null,reflow=!1;return{constructor:changeset,insert(t){const d=vegaUtil.array(t),n=d.length;for(let i=0;i<n;++i)add.push(d[i]);return this},remove(t){const a=vegaUtil.isFunction(t)?remp:rem,d=vegaUtil.array(t),n=d.length;for(let i=0;i<n;++i)a.push(d[i]);return this},modify(t,field,value){const m={field:field,value:vegaUtil.constant(value)};return vegaUtil.isFunction(t)?(m.filter=t,modp.push(m)):(m.tuple=t,mod.push(m)),this},encode(t,set){return vegaUtil.isFunction(t)?modp.push({filter:t,field:set}):mod.push({tuple:t,field:set}),this},clean(value){return clean=value,this},reflow(){return reflow=!0,this},pulse(pulse,tuples){const cur={},out={};let i,n,m,f,t,id;for(i=0,n=tuples.length;i<n;++i)cur[tupleid(tuples[i])]=1;for(i=0,n=rem.length;i<n;++i)t=rem[i],cur[tupleid(t)]=-1;for(i=0,n=remp.length;i<n;++i)f=remp[i],tuples.forEach(t=>{f(t)&&(cur[tupleid(t)]=-1)});for(i=0,n=add.length;i<n;++i)t=add[i],id=tupleid(t),cur[id]?cur[id]=1:pulse.add.push(ingest(add[i]));for(i=0,n=tuples.length;i<n;++i)t=tuples[i],cur[tupleid(t)]<0&&pulse.rem.push(t);function modify(t,f,v){v?t[f]=v(t):pulse.encode=f,reflow||(out[tupleid(t)]=t)}for(i=0,n=mod.length;i<n;++i)m=mod[i],t=m.tuple,f=m.field,id=cur[tupleid(t)],id>0&&(modify(t,f,m.value),pulse.modifies(f));for(i=0,n=modp.length;i<n;++i)m=modp[i],f=m.filter,tuples.forEach(t=>{f(t)&&cur[tupleid(t)]>0&&modify(t,m.field,m.value)}),pulse.modifies(m.field);if(reflow)pulse.mod=rem.length||remp.length?tuples.filter(t=>cur[tupleid(t)]>0):tuples.slice();else for(id in out)pulse.mod.push(out[id]);return(clean||null==clean&&(rem.length||remp.length))&&pulse.clean(!0),pulse}}}function Parameters(){Object.defineProperty(this,"_:mod:_",{writable:!0,value:{}})}Parameters.prototype={set(name,index,value,force){const o=this,v=o[name],mod=o["_:mod:_"];return null!=index&&index>=0?(v[index]!==value||force)&&(v[index]=value,mod[index+":"+name]=-1,mod[name]=-1):(v!==value||force)&&(o[name]=value,mod[name]=vegaUtil.isArray(value)?1+value.length:-1),o},modified(name,index){const mod=this["_:mod:_"];if(!arguments.length){for(const k in mod)if(mod[k])return!0;return!1}if(vegaUtil.isArray(name)){for(let k=0;k<name.length;++k)if(mod[name[k]])return!0;return!1}return null!=index&&index>=0?index+1<mod[name]||!!mod[index+":"+name]:!!mod[name]},clear(){return this["_:mod:_"]={},this}};let OP_ID=0;const NO_PARAMS=new Parameters;function Operator(init,update,params,react){this.id=++OP_ID,this.value=init,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,update&&(this._update=update),params&&this.parameters(params,react)}function flag(bit){return function(state){const f=this.flags;return 0===arguments.length?!!(f&bit):(this.flags=state?f|bit:f&~bit,this)}}Operator.prototype={targets(){return this._targets||(this._targets=UniqueList(vegaUtil.id))},set(value){return this.value!==value?(this.value=value,1):0},skip:flag(1),modified:flag(2),parameters(params,react,initonly){react=!1!==react;const argval=this._argval=this._argval||new Parameters,argops=this._argops=this._argops||[],deps=[];let name,value,n,i;const add=(name,index,value)=>{value instanceof Operator?(value!==this&&(react&&value.targets().add(this),deps.push(value)),argops.push({op:value,name:name,index:index})):argval.set(name,index,value)};for(name in params)if(value=params[name],"pulse"===name)vegaUtil.array(value).forEach(op=>{op instanceof Operator?op!==this&&(op.targets().add(this),deps.push(op)):vegaUtil.error("Pulse parameters must be operator instances.")}),this.source=value;else if(vegaUtil.isArray(value))for(argval.set(name,-1,Array(n=value.length)),i=0;i<n;++i)add(name,i,value[i]);else add(name,-1,value);return this.marshall().clear(),initonly&&(argops.initonly=!0),deps},marshall(stamp){const argval=this._argval||NO_PARAMS,argops=this._argops;let item,i,op,mod;if(argops){const n=argops.length;for(i=0;i<n;++i)item=argops[i],op=item.op,mod=op.modified()&&op.stamp===stamp,argval.set(item.name,item.index,op.value,mod);if(argops.initonly){for(i=0;i<n;++i)item=argops[i],item.op.targets().remove(this);this._argops=null,this._update=null}}return argval},detach(){const argops=this._argops;let i,n,item,op;if(argops)for(i=0,n=argops.length;i<n;++i)item=argops[i],op=item.op,op._targets&&op._targets.remove(this)},evaluate(pulse){const update=this._update;if(update){const params=this.marshall(pulse.stamp),v=update.call(this,params,pulse);if(params.clear(),v!==this.value)this.value=v;else if(!this.modified())return pulse.StopPropagation}},run(pulse){if(pulse.stamp<this.stamp)return pulse.StopPropagation;let rv;return this.skip()?(this.skip(!1),rv=0):rv=this.evaluate(pulse),this.pulse=rv||pulse}};let STREAM_ID=0;function EventStream(filter,apply,receive){this.id=++STREAM_ID,this.value=null,receive&&(this.receive=receive),filter&&(this._filter=filter),apply&&(this._apply=apply)}function stream(filter,apply,receive){return new EventStream(filter,apply,receive)}EventStream.prototype={_filter:vegaUtil.truthy,_apply:vegaUtil.identity,targets(){return this._targets||(this._targets=UniqueList(vegaUtil.id))},consume(_){return arguments.length?(this._consume=!!_,this):!!this._consume},receive(evt){if(this._filter(evt)){const val=this.value=this._apply(evt),trg=this._targets,n=trg?trg.length:0;for(let i=0;i<n;++i)trg[i].receive(val);this._consume&&(evt.preventDefault(),evt.stopPropagation())}},filter(filter){const s=stream(filter);return this.targets().add(s),s},apply(apply){const s=stream(null,apply);return this.targets().add(s),s},merge(){const s=stream();this.targets().add(s);for(let i=0,n=arguments.length;i<n;++i)arguments[i].targets().add(s);return s},throttle(pause){let t=-1;return this.filter(()=>{const now=Date.now();return now-t>pause?(t=now,1):0})},debounce(delay){const s=stream();return this.targets().add(stream(null,null,vegaUtil.debounce(delay,e=>{const df=e.dataflow;s.receive(e),df&&df.run&&df.run()}))),s},between(a,b){let active=!1;return a.targets().add(stream(null,null,()=>active=!0)),b.targets().add(stream(null,null,()=>active=!1)),this.filter(()=>active)},detach(){}};const SKIP$1={skip:!0};function onStream(df,stream,target,update,params,options){const opt=vegaUtil.extend({},options,SKIP$1);let func,op;vegaUtil.isFunction(target)||(target=vegaUtil.constant(target)),void 0===update?func=e=>df.touch(target(e)):vegaUtil.isFunction(update)?(op=new Operator(null,update,params,!1),func=e=>{op.evaluate(e);const t=target(e),v=op.value;isChangeSet(v)?df.pulse(t,v,options):df.update(t,v,opt)}):func=e=>df.update(target(e),update,opt),stream.apply(func)}function onOperator(df,source,target,update,params,options){if(void 0===update)source.targets().add(target);else{const opt=options||{},op=new Operator(null,function(target,update){return update=vegaUtil.isFunction(update)?update:vegaUtil.constant(update),target?function(_,pulse){const value=update(_,pulse);return target.skip()||(target.skip(value!==this.value).value=value),value}:update}(target,update),params,!1);op.modified(opt.force),op.rank=source.rank,source.targets().add(op),target&&(op.skip(!0),op.value=target.value,op.targets().add(target),df.connect(target,[op]))}}const StopPropagation={};function Pulse(dataflow,stamp,encode){this.dataflow=dataflow,this.stamp=null==stamp?-1:stamp,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=encode||null}function materialize(data,filter){const out=[];return vegaUtil.visitArray(data,filter,_=>out.push(_)),out}function filter(pulse,flags){const map={};return pulse.visit(flags,t=>{map[tupleid(t)]=1}),t=>map[tupleid(t)]?null:t}function addFilter(a,b){return a?(t,i)=>a(t,i)&&b(t,i):b}function MultiPulse(dataflow,stamp,pulses,encode){const p=this,n=pulses.length;let c=0;this.dataflow=dataflow,this.stamp=stamp,this.fields=null,this.encode=encode||null,this.pulses=pulses;for(let i=0;i<n;++i){const pulse=pulses[i];if(pulse.stamp===stamp){if(pulse.fields){const hash=p.fields||(p.fields={});for(const f in pulse.fields)hash[f]=1}pulse.changed(p.ADD)&&(c|=p.ADD),pulse.changed(p.REM)&&(c|=p.REM),pulse.changed(p.MOD)&&(c|=p.MOD)}}this.changes=c}function reentrant(df){return df.error("Dataflow already running. Use runAsync() to chain invocations."),df}Pulse.prototype={StopPropagation:StopPropagation,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(flags){return new Pulse(this.dataflow).init(this,flags)},clone(){const p=this.fork(7);return p.add=p.add.slice(),p.rem=p.rem.slice(),p.mod=p.mod.slice(),p.source&&(p.source=p.source.slice()),p.materialize(23)},addAll(){let p=this;return!p.source||p.add===p.rem||!p.rem.length&&p.source.length===p.add.length||(p=new Pulse(this.dataflow).init(this),p.add=p.source,p.rem=[]),p},init(src,flags){const p=this;return p.stamp=src.stamp,p.encode=src.encode,!src.fields||64&flags||(p.fields=src.fields),1&flags?(p.addF=src.addF,p.add=src.add):(p.addF=null,p.add=[]),2&flags?(p.remF=src.remF,p.rem=src.rem):(p.remF=null,p.rem=[]),4&flags?(p.modF=src.modF,p.mod=src.mod):(p.modF=null,p.mod=[]),32&flags?(p.srcF=null,p.source=null):(p.srcF=src.srcF,p.source=src.source,src.cleans&&(p.cleans=src.cleans)),p},runAfter(func){this.dataflow.runAfter(func)},changed(flags){const f=flags||7;return 1&f&&this.add.length||2&f&&this.rem.length||4&f&&this.mod.length},reflow(fork){if(fork)return this.fork(7).reflow();const len=this.add.length,src=this.source&&this.source.length;return src&&src!==len&&(this.mod=this.source,len&&this.filter(4,filter(this,1))),this},clean(value){return arguments.length?(this.cleans=!!value,this):this.cleans},modifies(_){const hash=this.fields||(this.fields={});return vegaUtil.isArray(_)?_.forEach(f=>hash[f]=!0):hash[_]=!0,this},modified(_,nomod){const fields=this.fields;return!(!nomod&&!this.mod.length||!fields)&&(arguments.length?vegaUtil.isArray(_)?_.some(f=>fields[f]):fields[_]:!!fields)},filter(flags,filter){const p=this;return 1&flags&&(p.addF=addFilter(p.addF,filter)),2&flags&&(p.remF=addFilter(p.remF,filter)),4&flags&&(p.modF=addFilter(p.modF,filter)),16&flags&&(p.srcF=addFilter(p.srcF,filter)),p},materialize(flags){const p=this;return 1&(flags=flags||7)&&p.addF&&(p.add=materialize(p.add,p.addF),p.addF=null),2&flags&&p.remF&&(p.rem=materialize(p.rem,p.remF),p.remF=null),4&flags&&p.modF&&(p.mod=materialize(p.mod,p.modF),p.modF=null),16&flags&&p.srcF&&(p.source=p.source.filter(p.srcF),p.srcF=null),p},visit(flags,visitor){const p=this,v=visitor;if(16&flags)return vegaUtil.visitArray(p.source,p.srcF,v),p;1&flags&&vegaUtil.visitArray(p.add,p.addF,v),2&flags&&vegaUtil.visitArray(p.rem,p.remF,v),4&flags&&vegaUtil.visitArray(p.mod,p.modF,v);const src=p.source;if(8&flags&&src){const sum=p.add.length+p.mod.length;sum===src.length||(sum?vegaUtil.visitArray(src,filter(p,5),v):vegaUtil.visitArray(src,p.srcF,v))}return p}},vegaUtil.inherits(MultiPulse,Pulse,{fork(flags){const p=new Pulse(this.dataflow).init(this,flags&this.NO_FIELDS);return void 0!==flags&&(flags&p.ADD&&this.visit(p.ADD,t=>p.add.push(t)),flags&p.REM&&this.visit(p.REM,t=>p.rem.push(t)),flags&p.MOD&&this.visit(p.MOD,t=>p.mod.push(t))),p},changed(flags){return this.changes&flags},modified(_){const p=this,fields=p.fields;return fields&&p.changes&p.MOD?vegaUtil.isArray(_)?_.some(f=>fields[f]):fields[_]:0},filter(){vegaUtil.error("MultiPulse does not support filtering.")},materialize(){vegaUtil.error("MultiPulse does not support materialization.")},visit(flags,visitor){const p=this,pulses=p.pulses,n=pulses.length;let i=0;if(flags&p.SOURCE)for(;i<n;++i)pulses[i].visit(flags,visitor);else for(;i<n;++i)pulses[i].stamp===p.stamp&&pulses[i].visit(flags,visitor);return p}});const NO_OPT={skip:!1,force:!1};function Heap(cmp){let nodes=[];return{clear:()=>nodes=[],size:()=>nodes.length,peek:()=>nodes[0],push:x=>(nodes.push(x),siftdown(nodes,0,nodes.length-1,cmp)),pop:()=>{const last=nodes.pop();let item;return nodes.length?(item=nodes[0],nodes[0]=last,function(array,idx,cmp){const start=idx,end=array.length,item=array[idx];let ridx,cidx=1+(idx<<1);for(;cidx<end;)ridx=cidx+1,ridx<end&&cmp(array[cidx],array[ridx])>=0&&(cidx=ridx),array[idx]=array[cidx],cidx=1+((idx=cidx)<<1);array[idx]=item,siftdown(array,start,idx,cmp)}(nodes,0,cmp)):item=last,item}}}function siftdown(array,start,idx,cmp){let parent,pidx;const item=array[idx];for(;idx>start&&(pidx=idx-1>>1,parent=array[pidx],cmp(item,parent)<0);)array[idx]=parent,idx=pidx;return array[idx]=item}function Dataflow(){this.logger(vegaUtil.logger()),this.logLevel(vegaUtil.Error),this._clock=0,this._rank=0,this._locale=vegaFormat.defaultLocale();try{this._loader=vegaLoader.loader()}catch(e){}this._touched=UniqueList(vegaUtil.id),this._input={},this._pulse=null,this._heap=Heap((a,b)=>a.qrank-b.qrank),this._postrun=[]}function logMethod(method){return function(){return this._log[method].apply(this,arguments)}}function Transform(init,params){Operator.call(this,init,null,params)}Dataflow.prototype={stamp(){return this._clock},loader(_){return arguments.length?(this._loader=_,this):this._loader},locale(_){return arguments.length?(this._locale=_,this):this._locale},logger(logger){return arguments.length?(this._log=logger,this):this._log},error:logMethod("error"),warn:logMethod("warn"),info:logMethod("info"),debug:logMethod("debug"),logLevel:logMethod("level"),cleanThreshold:1e4,add:function(init,update,params,react){let op,shift=1;return init instanceof Operator?op=init:init&&init.prototype instanceof Operator?op=new init:vegaUtil.isFunction(init)?op=new Operator(null,init):(shift=0,op=new Operator(init,update)),this.rank(op),shift&&(react=params,params=update),params&&this.connect(op,op.parameters(params,react)),this.touch(op),op},connect:function(target,sources){const targetRank=target.rank,n=sources.length;for(let i=0;i<n;++i)if(targetRank<sources[i].rank)return void this.rerank(target)},rank:function(op){op.rank=++this._rank},rerank:function(op){const queue=[op];let cur,list,i;for(;queue.length;)if(this.rank(cur=queue.pop()),list=cur._targets)for(i=list.length;--i>=0;)queue.push(cur=list[i]),cur===op&&vegaUtil.error("Cycle detected in dataflow graph.")},pulse:function(op,changeset,options){this.touch(op,options||NO_OPT);const p=new Pulse(this,this._clock+(this._pulse?0:1)),t=op.pulse&&op.pulse.source||[];return p.target=op,this._input[op.id]=changeset.pulse(p,t),this},touch:function(op,options){const opt=options||NO_OPT;return this._pulse?this._enqueue(op):this._touched.add(op),opt.skip&&op.skip(!0),this},update:function(op,value,options){const opt=options||NO_OPT;return(op.set(value)||opt.force)&&this.touch(op,opt),this},changeset:changeset,ingest:function(target,data,format){return data=this.parse(data,format),this.pulse(target,this.changeset().insert(data))},parse:function(data,format){const locale=this.locale();return vegaLoader.read(data,format,locale.timeParse,locale.utcParse)},preload:async function(target,url,format){const df=this,pending=df._pending||function(df){let accept;const pending=new Promise(a=>accept=a);return pending.requests=0,pending.done=()=>{0==--pending.requests&&(df._pending=null,accept(df))},df._pending=pending}(df);pending.requests+=1;const res=await df.request(url,format);return df.pulse(target,df.changeset().remove(vegaUtil.truthy).insert(res.data||[])),pending.done(),res},request:async function(url,format){const df=this;let data,status=0;try{data=await df.loader().load(url,{context:"dataflow",response:vegaLoader.responseType(format&&format.type)});try{data=df.parse(data,format)}catch(err){status=-2,df.warn("Data ingestion failed",url,err)}}catch(err){status=-1,df.warn("Loading failed",url,err)}return{data:data,status:status}},events:function(source,type,filter,apply){const df=this,s=stream(filter,apply),send=function(e){e.dataflow=df;try{s.receive(e)}catch(error){df.error(error)}finally{df.run()}};let sources;sources="string"==typeof source&&"undefined"!=typeof document?document.querySelectorAll(source):vegaUtil.array(source);const n=sources.length;for(let i=0;i<n;++i)sources[i].addEventListener(type,send);return s},on:function(source,target,update,params,options){return(source instanceof Operator?onOperator:onStream)(this,source,target,update,params,options),this},evaluate:async function(encode,prerun,postrun){const df=this,async=[];if(df._pulse)return reentrant(df);if(df._pending&&await df._pending,prerun&&await asyncCallback(df,prerun),!df._touched.length)return df.debug("Dataflow invoked, but nothing to do."),df;const stamp=++df._clock;df._pulse=new Pulse(df,stamp,encode),df._touched.forEach(op=>df._enqueue(op,!0)),df._touched=UniqueList(vegaUtil.id);let op,next,error,count=0;try{for(;df._heap.size()>0;)op=df._heap.pop(),op.rank===op.qrank?(next=op.run(df._getPulse(op,encode)),next.then?next=await next:next.async&&(async.push(next.async),next=StopPropagation),next!==StopPropagation&&op._targets&&op._targets.forEach(op=>df._enqueue(op)),++count):df._enqueue(op,!0)}catch(err){df._heap.clear(),error=err}if(df._input={},df._pulse=null,df.debug(`Pulse ${stamp}: ${count} operators`),error&&(df._postrun=[],df.error(error)),df._postrun.length){const pr=df._postrun.sort((a,b)=>b.priority-a.priority);df._postrun=[];for(let i=0;i<pr.length;++i)await asyncCallback(df,pr[i].callback)}return postrun&&await asyncCallback(df,postrun),async.length&&Promise.all(async).then(cb=>df.runAsync(null,()=>{cb.forEach(f=>{try{f(df)}catch(err){df.error(err)}})})),df},run:function(encode,prerun,postrun){return this._pulse?reentrant(this):(this.evaluate(encode,prerun,postrun),this)},runAsync:async function(encode,prerun,postrun){for(;this._running;)await this._running;const clear=()=>this._running=null;return(this._running=this.evaluate(encode,prerun,postrun)).then(clear,clear),this._running},runAfter:function(callback,enqueue,priority){if(this._pulse||enqueue)this._postrun.push({priority:priority||0,callback:callback});else try{callback(this)}catch(err){this.error(err)}},_enqueue:function(op,force){const q=op.stamp<this._clock;q&&(op.stamp=this._clock),(q||force)&&(op.qrank=op.rank,this._heap.push(op))},_getPulse:function(op,encode){const s=op.source,stamp=this._clock;return s&&vegaUtil.isArray(s)?new MultiPulse(this,stamp,s.map(_=>_.pulse),encode):this._input[op.id]||function(p,s){return s&&s.stamp===p.stamp?s:(p=p.fork(),s&&s!==StopPropagation&&(p.source=s.source),p)}(this._pulse,s&&s.pulse)}},vegaUtil.inherits(Transform,Operator,{run(pulse){if(pulse.stamp<this.stamp)return pulse.StopPropagation;let rv;return this.skip()?this.skip(!1):rv=this.evaluate(pulse),rv=rv||pulse,rv.then?rv=rv.then(_=>this.pulse=_):rv!==pulse.StopPropagation&&(this.pulse=rv),rv},evaluate(pulse){const params=this.marshall(pulse.stamp),out=this.transform(params,pulse);return params.clear(),out},transform(){}});const transforms={};function transform(type){return type=type&&type.toLowerCase(),vegaUtil.hasOwnProperty(transforms,type)?transforms[type]:null}exports.Dataflow=Dataflow,exports.EventStream=EventStream,exports.MultiPulse=MultiPulse,exports.Operator=Operator,exports.Parameters=Parameters,exports.Pulse=Pulse,exports.Transform=Transform,exports.UniqueList=UniqueList,exports.asyncCallback=asyncCallback,exports.changeset=changeset,exports.definition=function(type){const t=transform(type);return t&&t.Definition||null},exports.derive=function(t){return rederive(t,ingest({}))},exports.ingest=ingest,exports.isChangeSet=isChangeSet,exports.isTuple=function(t){return!(!t||!tupleid(t))},exports.rederive=rederive,exports.replace=function(t,d){return setid(d,tupleid(t))},exports.stableCompare=function(cmp,f){return cmp?f?(a,b)=>cmp(a,b)||tupleid(f(a))-tupleid(f(b)):(a,b)=>cmp(a,b)||tupleid(a)-tupleid(b):null},exports.transform=transform,exports.transforms=transforms,exports.tupleid=tupleid,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(59),__webpack_require__(51))},,,,function(module,exports,__webpack_require__){!function(exports,d3Array){"use strict";function*numbers(values,valueof){if(null==valueof)for(let value of values)null!=value&&""!==value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)value=valueof(value,++index,values),null!=value&&""!==value&&(value=+value)>=value&&(yield value)}}function quantiles(array,p,f){const values=Float64Array.from(numbers(array,f));return values.sort(d3Array.ascending),p.map(_=>d3Array.quantileSorted(values,_))}function quartiles(array,f){return quantiles(array,[.25,.5,.75],f)}function estimateBandwidth(array,f){const n=array.length,d=d3Array.deviation(array,f),q=quartiles(array,f),h=(q[2]-q[0])/1.34;return 1.06*(Math.min(d,h)||d||Math.abs(q[0])||1)*Math.pow(n,-.2)}exports.random=Math.random;const SQRT2PI=Math.sqrt(2*Math.PI),SQRT2=Math.SQRT2;let nextSample=NaN;function sampleNormal(mean,stdev){mean=mean||0,stdev=null==stdev?1:stdev;let rds,c,x=0,y=0;if(nextSample==nextSample)x=nextSample,nextSample=NaN;else{do{x=2*exports.random()-1,y=2*exports.random()-1,rds=x*x+y*y}while(0===rds||rds>1);c=Math.sqrt(-2*Math.log(rds)/rds),x*=c,nextSample=y*c}return mean+x*stdev}function densityNormal(value,mean,stdev){const z=(value-(mean||0))/(stdev=null==stdev?1:stdev);return Math.exp(-.5*z*z)/(stdev*SQRT2PI)}function cumulativeNormal(value,mean,stdev){const z=(value-(mean=mean||0))/(stdev=null==stdev?1:stdev),Z=Math.abs(z);let cd;if(Z>37)cd=0;else{const exp=Math.exp(-Z*Z/2);let sum;Z<7.07106781186547?(sum=.0352624965998911*Z+.700383064443688,sum=sum*Z+6.37396220353165,sum=sum*Z+33.912866078383,sum=sum*Z+112.079291497871,sum=sum*Z+221.213596169931,sum=sum*Z+220.206867912376,cd=exp*sum,sum=.0883883476483184*Z+1.75566716318264,sum=sum*Z+16.064177579207,sum=sum*Z+86.7807322029461,sum=sum*Z+296.564248779674,sum=sum*Z+637.333633378831,sum=sum*Z+793.826512519948,sum=sum*Z+440.413735824752,cd/=sum):(sum=Z+.65,sum=Z+4/sum,sum=Z+3/sum,sum=Z+2/sum,sum=Z+1/sum,cd=exp/sum/2.506628274631)}return z>0?1-cd:cd}function quantileNormal(p,mean,stdev){return p<0||p>1?NaN:(mean||0)+(null==stdev?1:stdev)*SQRT2*function(x){let p,w=-Math.log((1-x)*(1+x));return w<6.25?(w-=3.125,p=-364441206401782e-35,p=p*w-16850591381820166e-35,p=128584807152564e-32+p*w,p=11157877678025181e-33+p*w,p=p*w-1333171662854621e-31,p=20972767875968562e-33+p*w,p=6637638134358324e-30+p*w,p=p*w-4054566272975207e-29,p=p*w-8151934197605472e-29,p=26335093153082323e-28+p*w,p=p*w-12975133253453532e-27,p=p*w-5415412054294628e-26,p=1.0512122733215323e-9+p*w,p=p*w-4.112633980346984e-9,p=p*w-2.9070369957882005e-8,p=4.2347877827932404e-7+p*w,p=p*w-13654692000834679e-22,p=p*w-13882523362786469e-21,p=.00018673420803405714+p*w,p=p*w-.000740702534166267,p=p*w-.006033670871430149,p=.24015818242558962+p*w,p=1.6536545626831027+p*w):w<16?(w=Math.sqrt(w)-3.25,p=2.2137376921775787e-9,p=9.075656193888539e-8+p*w,p=p*w-2.7517406297064545e-7,p=1.8239629214389228e-8+p*w,p=15027403968909828e-22+p*w,p=p*w-4013867526981546e-21,p=29234449089955446e-22+p*w,p=12475304481671779e-21+p*w,p=p*w-47318229009055734e-21,p=6828485145957318e-20+p*w,p=24031110387097894e-21+p*w,p=p*w-.0003550375203628475,p=.0009532893797373805+p*w,p=p*w-.0016882755560235047,p=.002491442096107851+p*w,p=p*w-.003751208507569241,p=.005370914553590064+p*w,p=1.0052589676941592+p*w,p=3.0838856104922208+p*w):Number.isFinite(w)?(w=Math.sqrt(w)-5,p=-27109920616438573e-27,p=p*w-2.555641816996525e-10,p=1.5076572693500548e-9+p*w,p=p*w-3.789465440126737e-9,p=7.61570120807834e-9+p*w,p=p*w-1.496002662714924e-8,p=2.914795345090108e-8+p*w,p=p*w-6.771199775845234e-8,p=2.2900482228026655e-7+p*w,p=p*w-9.9298272942317e-7,p=4526062597223154e-21+p*w,p=p*w-1968177810553167e-20,p=7599527703001776e-20+p*w,p=p*w-.00021503011930044477,p=p*w-.00013871931833623122,p=1.0103004648645344+p*w,p=4.849906401408584+p*w):p=1/0,p*x}(2*p-1)}function gaussian(mean,stdev){let mu,sigma;const dist={mean(_){return arguments.length?(mu=_||0,dist):mu},stdev(_){return arguments.length?(sigma=null==_?1:_,dist):sigma},sample:()=>sampleNormal(mu,sigma),pdf:value=>densityNormal(value,mu,sigma),cdf:value=>cumulativeNormal(value,mu,sigma),icdf:p=>quantileNormal(p,mu,sigma)};return dist.mean(mean).stdev(stdev)}function sampleLogNormal(mean,stdev){return mean=mean||0,stdev=null==stdev?1:stdev,Math.exp(mean+sampleNormal()*stdev)}function densityLogNormal(value,mean,stdev){if(value<=0)return 0;mean=mean||0,stdev=null==stdev?1:stdev;const z=(Math.log(value)-mean)/stdev;return Math.exp(-.5*z*z)/(stdev*SQRT2PI*value)}function cumulativeLogNormal(value,mean,stdev){return cumulativeNormal(Math.log(value),mean,stdev)}function quantileLogNormal(p,mean,stdev){return Math.exp(quantileNormal(p,mean,stdev))}function sampleUniform(min,max){return null==max&&(max=null==min?1:min,min=0),min+(max-min)*exports.random()}function densityUniform(value,min,max){return null==max&&(max=null==min?1:min,min=0),value>=min&&value<=max?1/(max-min):0}function cumulativeUniform(value,min,max){return null==max&&(max=null==min?1:min,min=0),value<min?0:value>max?1:(value-min)/(max-min)}function quantileUniform(p,min,max){return null==max&&(max=null==min?1:min,min=0),p>=0&&p<=1?min+p*(max-min):NaN}function ols(uX,uY,uXY,uX2){const delta=uX2-uX*uX,slope=Math.abs(delta)<1e-24?0:(uXY-uX*uY)/delta;return[uY-slope*uX,slope]}function points(data,x,y,sort){data=data.filter(d=>{let u=x(d),v=y(d);return null!=u&&(u=+u)>=u&&null!=v&&(v=+v)>=v}),sort&&data.sort((a,b)=>x(a)-x(b));const n=data.length,X=new Float64Array(n),Y=new Float64Array(n);let xv,yv,d,i=0,ux=0,uy=0;for(d of data)X[i]=xv=+x(d),Y[i]=yv=+y(d),++i,ux+=(xv-ux)/i,uy+=(yv-uy)/i;for(i=0;i<n;++i)X[i]-=ux,Y[i]-=uy;return[X,Y,ux,uy]}function visitPoints(data,x,y,callback){let u,v,i=-1;for(const d of data)u=x(d),v=y(d),null!=u&&(u=+u)>=u&&null!=v&&(v=+v)>=v&&callback(u,v,++i)}function rSquared(data,x,y,uY,predict){let SSE=0,SST=0;return visitPoints(data,x,y,(dx,dy)=>{const sse=dy-predict(dx),sst=dy-uY;SSE+=sse*sse,SST+=sst*sst}),1-SSE/SST}function linear(data,x,y){let X=0,Y=0,XY=0,X2=0,n=0;visitPoints(data,x,y,(dx,dy)=>{++n,X+=(dx-X)/n,Y+=(dy-Y)/n,XY+=(dx*dy-XY)/n,X2+=(dx*dx-X2)/n});const coef=ols(X,Y,XY,X2),predict=x=>coef[0]+coef[1]*x;return{coef:coef,predict:predict,rSquared:rSquared(data,x,y,Y,predict)}}function quad(data,x,y){const[xv,yv,ux,uy]=points(data,x,y),n=xv.length;let i,dx,dy,x2,X2=0,X3=0,X4=0,XY=0,X2Y=0;for(i=0;i<n;)dx=xv[i],dy=yv[i++],x2=dx*dx,X2+=(x2-X2)/i,X3+=(x2*dx-X3)/i,X4+=(x2*x2-X4)/i,XY+=(dx*dy-XY)/i,X2Y+=(x2*dy-X2Y)/i;const X2X2=X4-X2*X2,d=X2*X2X2-X3*X3,a=(X2Y*X2-XY*X3)/d,b=(XY*X2X2-X2Y*X3)/d,c=-a*X2,predict=x=>a*(x-=ux)*x+b*x+c+uy;return{coef:[c-b*ux+a*ux*ux+uy,b-2*a*ux,a],predict:predict,rSquared:rSquared(data,x,y,uy,predict)}}function uncenter(k,a,x,y){const z=Array(k);let i,j,v,c;for(i=0;i<k;++i)z[i]=0;for(i=k-1;i>=0;--i)for(v=a[i],c=1,z[i]+=v,j=1;j<=i;++j)c*=(i+1-j)/j,z[i-j]+=v*Math.pow(x,j)*c;return z[0]+=y,z}function tricube(x){return(x=1-x*x*x)*x*x}function updateInterval(xv,i,interval){const val=xv[i];let left=interval[0],right=interval[1]+1;if(!(right>=xv.length))for(;i>left&&xv[right]-val<=val-xv[left];)interval[0]=++left,interval[1]=right,++right}const MIN_RADIANS=.1*Math.PI/180;function angleDelta(p,q,r){const a0=Math.atan2(r[1]-p[1],r[0]-p[0]),a1=Math.atan2(q[1]-p[1],q[0]-p[0]);return Math.abs(a0-a1)}exports.bandwidthNRD=estimateBandwidth,exports.bin=function(_){const maxb=_.maxbins||20,base=_.base||10,logb=Math.log(base),div=_.divide||[5,2];let step,level,minstep,v,i,n,min=_.extent[0],max=_.extent[1];const span=_.span||max-min||Math.abs(min)||1;if(_.step)step=_.step;else if(_.steps){for(v=span/maxb,i=0,n=_.steps.length;i<n&&_.steps[i]<v;++i);step=_.steps[Math.max(0,i-1)]}else{for(level=Math.ceil(Math.log(maxb)/logb),minstep=_.minstep||0,step=Math.max(minstep,Math.pow(base,Math.round(Math.log(span)/logb)-level));Math.ceil(span/step)>maxb;)step*=base;for(i=0,n=div.length;i<n;++i)v=step/div[i],v>=minstep&&span/v<=maxb&&(step=v)}v=Math.log(step);const precision=v>=0?0:1+~~(-v/logb),eps=Math.pow(base,-precision-1);return(_.nice||void 0===_.nice)&&(v=Math.floor(min/step+eps)*step,min=min<v?v-step:v,max=Math.ceil(max/step)*step),{start:min,stop:max===min?min+step:max,step:step}},exports.bootstrapCI=function(array,samples,alpha,f){if(!array.length)return[void 0,void 0];const values=Float64Array.from(numbers(array,f)),n=values.length,m=samples;let a,i,j,mu;for(j=0,mu=Array(m);j<m;++j){for(a=0,i=0;i<n;++i)a+=values[~~(exports.random()*n)];mu[j]=a/n}return mu.sort(d3Array.ascending),[d3Array.quantile(mu,alpha/2),d3Array.quantile(mu,1-alpha/2)]},exports.cumulativeLogNormal=cumulativeLogNormal,exports.cumulativeNormal=cumulativeNormal,exports.cumulativeUniform=cumulativeUniform,exports.densityLogNormal=densityLogNormal,exports.densityNormal=densityNormal,exports.densityUniform=densityUniform,exports.dotbin=function(array,step,smooth,f){f=f||(_=>_);const n=array.length,v=new Float64Array(n);let x,i=0,j=1,a=f(array[0]),b=a,w=a+step;for(;j<n;++j){if(x=f(array[j]),x>=w){for(b=(a+b)/2;i<j;++i)v[i]=b;w=x+step,a=x}b=x}for(b=(a+b)/2;i<j;++i)v[i]=b;return smooth?function(v,thresh){const n=v.length;let c,d,a=0,b=1;for(;v[a]===v[b];)++b;for(;b<n;){for(c=b+1;v[b]===v[c];)++c;if(v[b]-v[b-1]<thresh){for(d=b+(a+c-b-b>>1);d<b;)v[d++]=v[b];for(;d>b;)v[d--]=v[a]}a=b,b=c}return v}(v,step+step/4):v},exports.quantileLogNormal=quantileLogNormal,exports.quantileNormal=quantileNormal,exports.quantileUniform=quantileUniform,exports.quantiles=quantiles,exports.quartiles=quartiles,exports.randomInteger=function(min,max){let a,b,d;null==max&&(max=min,min=0);const dist={min(_){return arguments.length?(a=_||0,d=b-a,dist):a},max(_){return arguments.length?(b=_||0,d=b-a,dist):b},sample:()=>a+Math.floor(d*exports.random()),pdf:x=>x===Math.floor(x)&&x>=a&&x<b?1/d:0,cdf(x){const v=Math.floor(x);return v<a?0:v>=b?1:(v-a+1)/d},icdf:p=>p>=0&&p<=1?a-1+Math.floor(p*d):NaN};return dist.min(min).max(max)},exports.randomKDE=function(support,bandwidth){const kernel=gaussian();let n=0;const dist={data(_){return arguments.length?(support=_,n=_?_.length:0,dist.bandwidth(bandwidth)):support},bandwidth(_){return arguments.length?(!(bandwidth=_)&&support&&(bandwidth=estimateBandwidth(support)),dist):bandwidth},sample:()=>support[~~(exports.random()*n)]+bandwidth*kernel.sample(),pdf(x){let y=0,i=0;for(;i<n;++i)y+=kernel.pdf((x-support[i])/bandwidth);return y/bandwidth/n},cdf(x){let y=0,i=0;for(;i<n;++i)y+=kernel.cdf((x-support[i])/bandwidth);return y/n},icdf(){throw Error("KDE icdf not supported.")}};return dist.data(support)},exports.randomLCG=function(seed){return function(){return(seed=(1103515245*seed+12345)%2147483647)/2147483647}},exports.randomLogNormal=function(mean,stdev){let mu,sigma;const dist={mean(_){return arguments.length?(mu=_||0,dist):mu},stdev(_){return arguments.length?(sigma=null==_?1:_,dist):sigma},sample:()=>sampleLogNormal(mu,sigma),pdf:value=>densityLogNormal(value,mu,sigma),cdf:value=>cumulativeLogNormal(value,mu,sigma),icdf:p=>quantileLogNormal(p,mu,sigma)};return dist.mean(mean).stdev(stdev)},exports.randomMixture=function(dists,weights){let w,m=0;const dist={weights(_){return arguments.length?(w=function(x){const w=[];let i,sum=0;for(i=0;i<m;++i)sum+=w[i]=null==x[i]?1:+x[i];for(i=0;i<m;++i)w[i]/=sum;return w}(weights=_||[]),dist):weights},distributions(_){return arguments.length?(_?(m=_.length,dists=_):(m=0,dists=[]),dist.weights(weights)):dists},sample(){const r=exports.random();let d=dists[m-1],v=w[0],i=0;for(;i<m-1;v+=w[++i])if(r<v){d=dists[i];break}return d.sample()},pdf(x){let p=0,i=0;for(;i<m;++i)p+=w[i]*dists[i].pdf(x);return p},cdf(x){let p=0,i=0;for(;i<m;++i)p+=w[i]*dists[i].cdf(x);return p},icdf(){throw Error("Mixture icdf not supported.")}};return dist.distributions(dists).weights(weights)},exports.randomNormal=gaussian,exports.randomUniform=function(min,max){let a,b;const dist={min(_){return arguments.length?(a=_||0,dist):a},max(_){return arguments.length?(b=null==_?1:_,dist):b},sample:()=>sampleUniform(a,b),pdf:value=>densityUniform(value,a,b),cdf:value=>cumulativeUniform(value,a,b),icdf:p=>quantileUniform(p,a,b)};return null==max&&(max=null==min?1:min,min=0),dist.min(min).max(max)},exports.regressionExp=function(data,x,y){const[xv,yv,ux,uy]=points(data,x,y);let dx,ly,xy,YL=0,XY=0,XYL=0,X2Y=0,n=0;visitPoints(data,x,y,(_,dy)=>{dx=xv[n++],ly=Math.log(dy),xy=dx*dy,YL+=(dy*ly-YL)/n,XY+=(xy-XY)/n,XYL+=(xy*ly-XYL)/n,X2Y+=(dx*xy-X2Y)/n});const[c0,c1]=ols(XY/uy,YL/uy,XYL/uy,X2Y/uy),predict=x=>Math.exp(c0+c1*(x-ux));return{coef:[Math.exp(c0-c1*ux),c1],predict:predict,rSquared:rSquared(data,x,y,uy,predict)}},exports.regressionLinear=linear,exports.regressionLoess=function(data,x,y,bandwidth){const[xv,yv,ux,uy]=points(data,x,y,!0),n=xv.length,bw=Math.max(2,~~(bandwidth*n)),yhat=new Float64Array(n),residuals=new Float64Array(n),robustWeights=new Float64Array(n).fill(1);for(let iter=-1;++iter<=2;){const interval=[0,bw-1];for(let i=0;i<n;++i){const dx=xv[i],i0=interval[0],i1=interval[1],edge=dx-xv[i0]>xv[i1]-dx?i0:i1;let W=0,X=0,Y=0,XY=0,X2=0;const denom=1/Math.abs(xv[edge]-dx||1);for(let k=i0;k<=i1;++k){const xk=xv[k],yk=yv[k],w=tricube(Math.abs(dx-xk)*denom)*robustWeights[k],xkw=xk*w;W+=w,X+=xkw,Y+=yk*w,XY+=yk*xkw,X2+=xk*xkw}const[a,b]=ols(X/W,Y/W,XY/W,X2/W);yhat[i]=a+b*dx,residuals[i]=Math.abs(yv[i]-yhat[i]),updateInterval(xv,i+1,interval)}if(2===iter)break;const medianResidual=d3Array.median(residuals);if(Math.abs(medianResidual)<1e-12)break;for(let arg,w,i=0;i<n;++i)arg=residuals[i]/(6*medianResidual),robustWeights[i]=arg>=1?1e-12:(w=1-arg*arg)*w}return function(xv,yhat,ux,uy){const n=xv.length,out=[];let v,i=0,cnt=0,prev=[];for(;i<n;++i)v=xv[i]+ux,prev[0]===v?prev[1]+=(yhat[i]-prev[1])/++cnt:(cnt=0,prev[1]+=uy,prev=[v,yhat[i]],out.push(prev));return prev[1]+=uy,out}(xv,yhat,ux,uy)},exports.regressionLog=function(data,x,y){let X=0,Y=0,XY=0,X2=0,n=0;visitPoints(data,x,y,(dx,dy)=>{++n,dx=Math.log(dx),X+=(dx-X)/n,Y+=(dy-Y)/n,XY+=(dx*dy-XY)/n,X2+=(dx*dx-X2)/n});const coef=ols(X,Y,XY,X2),predict=x=>coef[0]+coef[1]*Math.log(x);return{coef:coef,predict:predict,rSquared:rSquared(data,x,y,Y,predict)}},exports.regressionPoly=function(data,x,y,order){if(1===order)return linear(data,x,y);if(2===order)return quad(data,x,y);const[xv,yv,ux,uy]=points(data,x,y),n=xv.length,lhs=[],rhs=[],k=order+1;let i,j,l,v,c;for(i=0;i<k;++i){for(l=0,v=0;l<n;++l)v+=Math.pow(xv[l],i)*yv[l];for(lhs.push(v),c=new Float64Array(k),j=0;j<k;++j){for(l=0,v=0;l<n;++l)v+=Math.pow(xv[l],i+j);c[j]=v}rhs.push(c)}rhs.push(lhs);const coef=function(matrix){const n=matrix.length-1,coef=[];let i,j,k,r,t;for(i=0;i<n;++i){for(r=i,j=i+1;j<n;++j)Math.abs(matrix[i][j])>Math.abs(matrix[i][r])&&(r=j);for(k=i;k<n+1;++k)t=matrix[k][i],matrix[k][i]=matrix[k][r],matrix[k][r]=t;for(j=i+1;j<n;++j)for(k=n;k>=i;k--)matrix[k][j]-=matrix[k][i]*matrix[i][j]/matrix[i][i]}for(j=n-1;j>=0;--j){for(t=0,k=j+1;k<n;++k)t+=matrix[k][j]*coef[k];coef[j]=(matrix[n][j]-t)/matrix[j][j]}return coef}(rhs),predict=x=>{x-=ux;let y=uy+coef[0]+coef[1]*x+coef[2]*x*x;for(i=3;i<k;++i)y+=coef[i]*Math.pow(x,i);return y};return{coef:uncenter(k,coef,-ux,uy),predict:predict,rSquared:rSquared(data,x,y,uy,predict)}},exports.regressionPow=function(data,x,y){let X=0,Y=0,XY=0,X2=0,YS=0,n=0;visitPoints(data,x,y,(dx,dy)=>{const lx=Math.log(dx),ly=Math.log(dy);++n,X+=(lx-X)/n,Y+=(ly-Y)/n,XY+=(lx*ly-XY)/n,X2+=(lx*lx-X2)/n,YS+=(dy-YS)/n});const coef=ols(X,Y,XY,X2),predict=x=>coef[0]*Math.pow(x,coef[1]);return coef[0]=Math.exp(coef[0]),{coef:coef,predict:predict,rSquared:rSquared(data,x,y,YS,predict)}},exports.regressionQuad=quad,exports.sampleCurve=function(f,extent,minSteps,maxSteps){minSteps=minSteps||25,maxSteps=Math.max(minSteps,maxSteps||200);const point=x=>[x,f(x)],minX=extent[0],maxX=extent[1],span=maxX-minX,stop=span/maxSteps,prev=[point(minX)],next=[];if(minSteps===maxSteps){for(let i=1;i<maxSteps;++i)prev.push(point(minX+i/minSteps*span));return prev.push(point(maxX)),prev}next.push(point(maxX));for(let i=minSteps;--i>0;)next.push(point(minX+i/minSteps*span));let p0=prev[0],p1=next[next.length-1];for(;p1;){const pm=point((p0[0]+p1[0])/2);pm[0]-p0[0]>=stop&&angleDelta(p0,pm,p1)>MIN_RADIANS?next.push(pm):(p0=p1,prev.push(p1),next.pop()),p1=next[next.length-1]}return prev},exports.sampleLogNormal=sampleLogNormal,exports.sampleNormal=sampleNormal,exports.sampleUniform=sampleUniform,exports.setRandom=function(r){exports.random=r},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(96))},function(module,exports,__webpack_require__){!function(exports,vegaUtil,d3Array,$,$$1,vegaTime){"use strict";function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var $__namespace=_interopNamespace($$1);function bandSpace(count,paddingInner,paddingOuter){const space=count-paddingInner+2*paddingOuter;return count?space>0?space:1:0}const Log="log",Time="time",UTC="utc",Continuous="continuous";function band(){const scale=$.scaleOrdinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range;let step,bandwidth,range=[0,1],round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){const n=domain().length,reverse=range[1]<range[0],stop=range[1-reverse],space=bandSpace(n,paddingInner,paddingOuter);let start=range[reverse-0];step=(stop-start)/(space||1),round&&(step=Math.floor(step)),start+=(stop-start-step*(n-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start=Math.round(start),bandwidth=Math.round(bandwidth));const values=d3Array.range(n).map(i=>start+step*i);return ordinalRange(reverse?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?(range=[+_[0],+_[1]],rescale()):range.slice()},scale.rangeRound=function(_){return range=[+_[0],+_[1]],round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),paddingInner=paddingOuter,rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.invertRange=function(_){if(null==_[0]||null==_[1])return;const reverse=range[1]<range[0],values=reverse?ordinalRange().reverse():ordinalRange(),n=values.length-1;let a,b,t,lo=+_[0],hi=+_[1];return lo!=lo||hi!=hi||(hi<lo&&(t=lo,lo=hi,hi=t),hi<values[0]||lo>range[1-reverse])?void 0:(a=Math.max(0,d3Array.bisectRight(values,lo)-1),b=lo===hi?a:d3Array.bisectRight(values,hi)-1,lo-values[a]>bandwidth+1e-10&&++a,reverse&&(t=a,a=n-b,b=n-t),a>b?void 0:domain().slice(a,b+1))},scale.invert=function(_){const value=scale.invertRange([_,_]);return value?value[0]:value},scale.copy=function(){return band().domain(domain()).range(range).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},rescale()}var map=Array.prototype.map;function numbers(_){return map.call(_,vegaUtil.toNumber)}const slice=Array.prototype.slice,scales={};function create(type,constructor,metadata){const ctr=function(){const s=constructor();return s.invertRange||(s.invertRange=s.invert?function(scale){return function(_){let t,lo=_[0],hi=_[1];return hi<lo&&(t=lo,lo=hi,hi=t),[scale.invert(lo),scale.invert(hi)]}}(s):s.invertExtent?function(scale){return function(_){const range=scale.range();let max,t,i,n,lo=_[0],hi=_[1],min=-1;for(hi<lo&&(t=lo,lo=hi,hi=t),i=0,n=range.length;i<n;++i)range[i]>=lo&&range[i]<=hi&&(min<0&&(min=i),max=i);if(!(min<0))return lo=scale.invertExtent(range[min]),hi=scale.invertExtent(range[max]),[void 0===lo[0]?lo[1]:lo[0],void 0===hi[1]?hi[0]:hi[1]]}}(s):void 0),s.type=type,s};return ctr.metadata=vegaUtil.toSet(vegaUtil.array(metadata)),ctr}function scale(type,scale,metadata){return arguments.length>1?(scales[type]=create(type,scale,metadata),this):isValidScaleType(type)?scales[type]:void 0}function isValidScaleType(type){return vegaUtil.hasOwnProperty(scales,type)}function hasType(key,type){const s=scales[key];return s&&s.metadata[type]}function isDiscrete(key){return hasType(key,"discrete")}function isDiscretizing(key){return hasType(key,"discretizing")}function isLogarithmic(key){return hasType(key,Log)}function isTemporal(key){return hasType(key,"temporal")}scale("identity",$.scaleIdentity),scale("linear",$.scaleLinear,Continuous),scale(Log,$.scaleLog,[Continuous,Log]),scale("pow",$.scalePow,Continuous),scale("sqrt",$.scaleSqrt,Continuous),scale("symlog",$.scaleSymlog,Continuous),scale(Time,$.scaleTime,[Continuous,"temporal"]),scale(UTC,$.scaleUtc,[Continuous,"temporal"]),scale("sequential",$.scaleSequential,[Continuous,"interpolating"]),scale("sequential-linear",$.scaleSequential,[Continuous,"interpolating"]),scale("sequential-log",$.scaleSequentialLog,[Continuous,"interpolating",Log]),scale("sequential-pow",$.scaleSequentialPow,[Continuous,"interpolating"]),scale("sequential-sqrt",$.scaleSequentialSqrt,[Continuous,"interpolating"]),scale("sequential-symlog",$.scaleSequentialSymlog,[Continuous,"interpolating"]),scale("diverging-linear",$.scaleDiverging,[Continuous,"interpolating"]),scale("diverging-log",$.scaleDivergingLog,[Continuous,"interpolating",Log]),scale("diverging-pow",$.scaleDivergingPow,[Continuous,"interpolating"]),scale("diverging-sqrt",$.scaleDivergingSqrt,[Continuous,"interpolating"]),scale("diverging-symlog",$.scaleDivergingSymlog,[Continuous,"interpolating"]),scale("quantile",$.scaleQuantile,["discretizing","quantile"]),scale("quantize",$.scaleQuantize,"discretizing"),scale("threshold",$.scaleThreshold,"discretizing"),scale("bin-ordinal",(function scaleBinOrdinal(){let domain=[],range=[];function scale(x){return null==x||x!=x?void 0:range[(d3Array.bisect(domain,x)-1)%range.length]}return scale.domain=function(_){return arguments.length?(domain=numbers(_),scale):domain.slice()},scale.range=function(_){return arguments.length?(range=slice.call(_),scale):range.slice()},scale.tickFormat=function(count,specifier){return $.tickFormat(domain[0],vegaUtil.peek(domain),null==count?10:count,specifier)},scale.copy=function(){return scaleBinOrdinal().domain(scale.domain()).range(scale.range())},scale}),["discrete","discretizing"]),scale("ordinal",$.scaleOrdinal,"discrete"),scale("band",band,"discrete"),scale("point",(function(){return function pointish(scale){const copy=scale.copy;return scale.padding=scale.paddingOuter,delete scale.paddingInner,scale.copy=function(){return pointish(copy())},scale}(band().paddingInner(1))}),"discrete");const scaleProps=["clamp","base","constant","exponent"];function interpolateColors(colors,type,gamma){return $$1.piecewise(interpolate(type||"rgb",gamma),colors)}function interpolate(type,gamma){const interp=$__namespace[function(type){return"interpolate"+type.toLowerCase().split("-").map(s=>s[0].toUpperCase()+s.slice(1)).join("")}(type)];return null!=gamma&&interp&&interp.gamma?interp.gamma(gamma):interp}function colors(palette){const n=palette.length/6|0,c=new Array(n);for(let i=0;i<n;)c[i]="#"+palette.slice(6*i,6*++i);return c}function apply(_,f){for(const k in _)scheme(k,f(_[k]))}const schemes={};function scheme(name,scheme){return name=name&&name.toLowerCase(),arguments.length>1?(schemes[name]=scheme,this):schemes[name]}apply({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},colors),apply({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},_=>interpolateColors(colors(_)));const defaultFormatter=value=>vegaUtil.isArray(value)?value.map(v=>String(v)):String(value),ascending=(a,b)=>a[1]-b[1],descending=(a,b)=>b[1]-a[1];function validTicks(scale,ticks,count){let range=scale.range(),lo=range[0],hi=vegaUtil.peek(range),cmp=ascending;if(lo>hi&&(range=hi,hi=lo,lo=range,cmp=descending),lo=Math.floor(lo),hi=Math.ceil(hi),ticks=ticks.map(v=>[v,scale(v)]).filter(_=>lo<=_[1]&&_[1]<=hi).sort(cmp).map(_=>_[0]),count>0&&ticks.length>1){const endpoints=[ticks[0],vegaUtil.peek(ticks)];for(;ticks.length>count&&ticks.length>=3;)ticks=ticks.filter((_,i)=>!(i%2));ticks.length<3&&(ticks=endpoints)}return ticks}function tickValues(scale,count){return scale.bins?validTicks(scale,scale.bins):scale.ticks?scale.ticks(count):scale.domain()}function tickFormat(locale,scale,count,specifier,formatType,noSkip){const type=scale.type;let format=defaultFormatter;if(type===Time||formatType===Time)format=locale.timeFormat(specifier);else if(type===UTC||formatType===UTC)format=locale.utcFormat(specifier);else if(isLogarithmic(type)){const varfmt=locale.formatFloat(specifier);if(noSkip||scale.bins)format=varfmt;else{const test=tickLog(scale,count,!1);format=_=>test(_)?varfmt(_):""}}else if(scale.tickFormat){const d=scale.domain();format=locale.formatSpan(d[0],d[d.length-1],count,specifier)}else specifier&&(format=locale.format(specifier));return format}function tickLog(scale,count,values){const ticks=tickValues(scale,count),base=scale.base(),logb=Math.log(base),k=Math.max(1,base*count/ticks.length),test=d=>{let i=d/Math.pow(base,Math.round(Math.log(d)/logb));return i*base<base-.5&&(i*=base),i<=k};return values?ticks.filter(test):test}const symbols={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},formats={quantile:"quantiles",quantize:"domain"};function labelValues(scale,count){return scale.bins?function(bins){const values=bins.slice(0,-1);return values.max=vegaUtil.peek(bins),values}(scale.bins):scale.type===Log?tickLog(scale,count,!0):symbols[scale.type]?function(thresholds){const values=[-1/0].concat(thresholds);return values.max=1/0,values}(scale[symbols[scale.type]]()):tickValues(scale,count)}function labelFormat(locale,scale,count,type,specifier,formatType,noSkip){const format=formats[scale.type]&&formatType!==Time&&formatType!==UTC?function(locale,scale,specifier){const _=scale[formats[scale.type]](),n=_.length;let i,d=n>1?_[1]-_[0]:_[0];for(i=1;i<n;++i)d=Math.min(d,_[i]-_[i-1]);return locale.formatSpan(0,d,30,specifier)}(locale,scale,specifier):tickFormat(locale,scale,count,specifier,formatType,noSkip);return"symbol"===type&&(scale=>symbols[scale.type]||scale.bins)(scale)?formatRange(format):"discrete"===type?formatDiscrete(format):formatPoint(format)}const formatRange=format=>(value,index,array)=>{const limit=get(array[index+1],get(array.max,1/0)),lo=formatValue(value,format),hi=formatValue(limit,format);return lo&&hi?lo+" â€“ "+hi:hi?"< "+hi:"â‰¥ "+lo},get=(value,dflt)=>null!=value?value:dflt,formatDiscrete=format=>(value,index)=>index?format(value):null,formatPoint=format=>value=>format(value),formatValue=(value,format)=>Number.isFinite(value)?format(value):null;Object.defineProperty(exports,"scaleImplicit",{enumerable:!0,get:function(){return $.scaleImplicit}}),exports.Band="band",exports.BinOrdinal="bin-ordinal",exports.DiscreteLegend="discrete",exports.Diverging="diverging",exports.GradientLegend="gradient",exports.Identity="identity",exports.Linear="linear",exports.Log=Log,exports.Ordinal="ordinal",exports.Point="point",exports.Pow="pow",exports.Quantile="quantile",exports.Quantize="quantize",exports.Sequential="sequential",exports.Sqrt="sqrt",exports.SymbolLegend="symbol",exports.Symlog="symlog",exports.Threshold="threshold",exports.Time=Time,exports.UTC=UTC,exports.bandSpace=bandSpace,exports.domainCaption=function(locale,scale,opt){opt=opt||{};const max=Math.max(3,opt.maxlen||7),fmt=function(locale,scale,specifier,formatType){const type=formatType||scale.type;return vegaUtil.isString(specifier)&&isTemporal(type)&&(specifier=specifier.replace(/%a/g,"%A").replace(/%b/g,"%B")),specifier||type!==Time?specifier||type!==UTC?labelFormat(locale,scale,5,null,specifier,formatType,!0):locale.utcFormat("%A, %d %B %Y, %X UTC"):locale.timeFormat("%A, %d %B %Y, %X")}(locale,scale,opt.format,opt.formatType);if(isDiscretizing(scale.type)){const v=labelValues(scale).slice(1).map(fmt),n=v.length;return`${n} boundar${1===n?"y":"ies"}: ${v.join(", ")}`}if(isDiscrete(scale.type)){const d=scale.domain(),n=d.length;return`${n} value${1===n?"":"s"}: ${n>max?d.slice(0,max-2).map(fmt).join(", ")+", ending with "+d.slice(-1).map(fmt):d.map(fmt).join(", ")}`}{const d=scale.domain();return`values from ${fmt(d[0])} to ${fmt(vegaUtil.peek(d))}`}},exports.interpolate=interpolate,exports.interpolateColors=interpolateColors,exports.interpolateRange=function(interpolator,range){const start=range[0],span=vegaUtil.peek(range)-start;return function(i){return interpolator(start+i*span)}},exports.isContinuous=function(key){return hasType(key,Continuous)},exports.isDiscrete=isDiscrete,exports.isDiscretizing=isDiscretizing,exports.isInterpolating=function(key){return hasType(key,"interpolating")},exports.isLogarithmic=isLogarithmic,exports.isQuantile=function(key){return hasType(key,"quantile")},exports.isTemporal=isTemporal,exports.isValidScaleType=isValidScaleType,exports.labelFormat=labelFormat,exports.labelFraction=function(scale){const domain=scale.domain(),count=domain.length-1;let lo=+domain[0],hi=+vegaUtil.peek(domain),span=hi-lo;if("threshold"===scale.type){const adjust=count?span/count:.1;lo-=adjust,hi+=adjust,span=hi-lo}return value=>(value-lo)/span},exports.labelValues=labelValues,exports.quantizeInterpolator=function(interpolator,count){const samples=new Array(count),n=count+1;for(let i=0;i<count;)samples[i]=interpolator(++i/n);return samples},exports.scale=scale,exports.scaleCopy=function(scale){const t=scale.type,s=scale.copy();return s.type=t,s},exports.scaleFraction=function(scale$1,min,max){const delta=max-min;let i,t,s;return delta&&Number.isFinite(delta)?(i=(t=scale$1.type).indexOf("-"),t=i<0?t:t.slice(i+1),s=scale(t)().domain([min,max]).range([0,1]),scaleProps.forEach(m=>scale$1[m]?s[m](scale$1[m]()):0),s):vegaUtil.constant(.5)},exports.scheme=scheme,exports.tickCount=function(scale,count,minStep){let step;return vegaUtil.isNumber(count)&&(scale.bins&&(count=Math.max(count,scale.bins.length)),null!=minStep&&(count=Math.min(count,Math.floor(vegaUtil.span(scale.domain())/minStep||1)))),vegaUtil.isObject(count)&&(step=count.step,count=count.interval),vegaUtil.isString(count)&&(count=scale.type===Time?vegaTime.timeInterval(count):scale.type==UTC?vegaTime.utcInterval(count):vegaUtil.error("Only time and utc scales accept interval strings."),step&&(count=count.every(step))),count},exports.tickFormat=tickFormat,exports.tickValues=tickValues,exports.validTicks=validTicks,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(75),__webpack_require__(100),__webpack_require__(104),__webpack_require__(49))},,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var vegaUtil=__webpack_require__(37),vegaDataflow=__webpack_require__(40),tx=__webpack_require__(95),vtx=__webpack_require__(98),encode=__webpack_require__(105),geo=__webpack_require__(108),force=__webpack_require__(114),tree=__webpack_require__(118),label=__webpack_require__(120),reg=__webpack_require__(121),voronoi=__webpack_require__(122),wordcloud=__webpack_require__(124),xf=__webpack_require__(125),vegaStatistics=__webpack_require__(44),vegaTime=__webpack_require__(49),vegaLoader=__webpack_require__(59),vegaScenegraph=__webpack_require__(50),vegaScale=__webpack_require__(45),vegaProjection=__webpack_require__(76),vegaView=__webpack_require__(127),vegaFormat=__webpack_require__(51),vegaFunctions=__webpack_require__(62),vegaParser=__webpack_require__(132),vegaRuntime=__webpack_require__(79);function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var tx__namespace=_interopNamespace(tx),vtx__namespace=_interopNamespace(vtx),encode__namespace=_interopNamespace(encode),geo__namespace=_interopNamespace(geo),force__namespace=_interopNamespace(force),tree__namespace=_interopNamespace(tree),label__namespace=_interopNamespace(label),reg__namespace=_interopNamespace(reg),voronoi__namespace=_interopNamespace(voronoi),wordcloud__namespace=_interopNamespace(wordcloud),xf__namespace=_interopNamespace(xf),pkg_version="5.19.1";vegaUtil.extend(vegaDataflow.transforms,tx__namespace,vtx__namespace,encode__namespace,geo__namespace,force__namespace,label__namespace,tree__namespace,reg__namespace,voronoi__namespace,wordcloud__namespace,xf__namespace);const version$1=pkg_version;Object.keys(vegaUtil).forEach((function(k){"default"!==k&&Object.defineProperty(exports,k,{enumerable:!0,get:function(){return vegaUtil[k]}})})),Object.keys(vegaStatistics).forEach((function(k){"default"!==k&&Object.defineProperty(exports,k,{enumerable:!0,get:function(){return vegaStatistics[k]}})})),Object.keys(vegaTime).forEach((function(k){"default"!==k&&Object.defineProperty(exports,k,{enumerable:!0,get:function(){return vegaTime[k]}})})),Object.keys(vegaLoader).forEach((function(k){"default"!==k&&Object.defineProperty(exports,k,{enumerable:!0,get:function(){return vegaLoader[k]}})})),Object.keys(vegaScenegraph).forEach((function(k){"default"!==k&&Object.defineProperty(exports,k,{enumerable:!0,get:function(){return vegaScenegraph[k]}})})),Object.defineProperty(exports,"Dataflow",{enumerable:!0,get:function(){return vegaDataflow.Dataflow}}),Object.defineProperty(exports,"EventStream",{enumerable:!0,get:function(){return vegaDataflow.EventStream}}),Object.defineProperty(exports,"MultiPulse",{enumerable:!0,get:function(){return vegaDataflow.MultiPulse}}),Object.defineProperty(exports,"Operator",{enumerable:!0,get:function(){return vegaDataflow.Operator}}),Object.defineProperty(exports,"Parameters",{enumerable:!0,get:function(){return vegaDataflow.Parameters}}),Object.defineProperty(exports,"Pulse",{enumerable:!0,get:function(){return vegaDataflow.Pulse}}),Object.defineProperty(exports,"Transform",{enumerable:!0,get:function(){return vegaDataflow.Transform}}),Object.defineProperty(exports,"changeset",{enumerable:!0,get:function(){return vegaDataflow.changeset}}),Object.defineProperty(exports,"definition",{enumerable:!0,get:function(){return vegaDataflow.definition}}),Object.defineProperty(exports,"ingest",{enumerable:!0,get:function(){return vegaDataflow.ingest}}),Object.defineProperty(exports,"isTuple",{enumerable:!0,get:function(){return vegaDataflow.isTuple}}),Object.defineProperty(exports,"transform",{enumerable:!0,get:function(){return vegaDataflow.transform}}),Object.defineProperty(exports,"transforms",{enumerable:!0,get:function(){return vegaDataflow.transforms}}),Object.defineProperty(exports,"tupleid",{enumerable:!0,get:function(){return vegaDataflow.tupleid}}),Object.defineProperty(exports,"interpolate",{enumerable:!0,get:function(){return vegaScale.interpolate}}),Object.defineProperty(exports,"interpolateColors",{enumerable:!0,get:function(){return vegaScale.interpolateColors}}),Object.defineProperty(exports,"interpolateRange",{enumerable:!0,get:function(){return vegaScale.interpolateRange}}),Object.defineProperty(exports,"quantizeInterpolator",{enumerable:!0,get:function(){return vegaScale.quantizeInterpolator}}),Object.defineProperty(exports,"scale",{enumerable:!0,get:function(){return vegaScale.scale}}),Object.defineProperty(exports,"scheme",{enumerable:!0,get:function(){return vegaScale.scheme}}),Object.defineProperty(exports,"projection",{enumerable:!0,get:function(){return vegaProjection.projection}}),Object.defineProperty(exports,"View",{enumerable:!0,get:function(){return vegaView.View}}),Object.defineProperty(exports,"defaultLocale",{enumerable:!0,get:function(){return vegaFormat.defaultLocale}}),Object.defineProperty(exports,"formatLocale",{enumerable:!0,get:function(){return vegaFormat.numberFormatDefaultLocale}}),Object.defineProperty(exports,"locale",{enumerable:!0,get:function(){return vegaFormat.locale}}),Object.defineProperty(exports,"resetDefaultLocale",{enumerable:!0,get:function(){return vegaFormat.resetDefaultLocale}}),Object.defineProperty(exports,"timeFormatLocale",{enumerable:!0,get:function(){return vegaFormat.timeFormatDefaultLocale}}),Object.defineProperty(exports,"expressionFunction",{enumerable:!0,get:function(){return vegaFunctions.expressionFunction}}),Object.defineProperty(exports,"parse",{enumerable:!0,get:function(){return vegaParser.parse}}),Object.defineProperty(exports,"runtimeContext",{enumerable:!0,get:function(){return vegaRuntime.context}}),exports.version=version$1},function(module,exports,__webpack_require__){!function(exports,vegaUtil,d3Time,d3Array){"use strict";const YEAR="year",QUARTER="quarter",MONTH="month",WEEK="week",DATE="date",DAY="day",HOURS="hours",MINUTES="minutes",SECONDS="seconds",TIME_UNITS=[YEAR,QUARTER,MONTH,WEEK,DATE,DAY,"dayofyear",HOURS,MINUTES,SECONDS,"milliseconds"],UNITS=TIME_UNITS.reduce((o,u,i)=>(o[u]=1+i,o),{});function timeUnits(units){const u=vegaUtil.array(units).slice(),m={};return u.length||vegaUtil.error("Missing time unit."),u.forEach(unit=>{vegaUtil.hasOwnProperty(UNITS,unit)?m[unit]=1:vegaUtil.error(`Invalid time unit: ${unit}.`)}),(m[WEEK]||m.day?1:0)+(m[QUARTER]||m[MONTH]||m[DATE]?1:0)+(m.dayofyear?1:0)>1&&vegaUtil.error("Incompatible time units: "+units),u.sort((a,b)=>UNITS[a]-UNITS[b]),u}const defaultSpecifiers={[YEAR]:"%Y ",[QUARTER]:"Q%q ",[MONTH]:"%b ",[DATE]:"%d ",[WEEK]:"W%U ",[DAY]:"%a ",dayofyear:"%j ",[HOURS]:"%H:00",[MINUTES]:"00:%M",[SECONDS]:":%S",milliseconds:".%L","year-month":"%Y-%m ","year-month-date":"%Y-%m-%d ",["hours-"+MINUTES]:"%H:%M"},t0=new Date;function localYear(y){return t0.setFullYear(y),t0.setMonth(0),t0.setDate(1),t0.setHours(0,0,0,0),t0}function localDayOfYear(d){return d3Time.timeDay.count(localYear(d.getFullYear())-1,d)}function localWeekNum(d){return d3Time.timeWeek.count(localYear(d.getFullYear())-1,d)}function localFirst(y){return localYear(y).getDay()}function localDate(y,m,d,H,M,S,L){if(0<=y&&y<100){const date=new Date(-1,m,d,H,M,S,L);return date.setFullYear(y),date}return new Date(y,m,d,H,M,S,L)}function utcDayOfYear(d){const y=Date.UTC(d.getUTCFullYear(),0,1);return d3Time.utcDay.count(y-1,d)}function utcWeekNum(d){const y=Date.UTC(d.getUTCFullYear(),0,1);return d3Time.utcWeek.count(y-1,d)}function utcFirst(y){return t0.setTime(Date.UTC(y,0,1)),t0.getUTCDay()}function utcDate(y,m,d,H,M,S,L){if(0<=y&&y<100){const date=new Date(Date.UTC(-1,m,d,H,M,S,L));return date.setUTCFullYear(d.y),date}return new Date(Date.UTC(y,m,d,H,M,S,L))}function floor(units,step,get,inv,newDate){const s=step||1,b=vegaUtil.peek(units),_=(unit,p,key)=>function(f,inv,step,phase){const u=step<=1?f:phase?(d,y)=>phase+step*Math.floor((f(d,y)-phase)/step):(d,y)=>step*Math.floor(f(d,y)/step);return inv?(d,y)=>inv(u(d,y),y):u}(get[key=key||unit],inv[key],unit===b&&s,p),t=new Date,u=vegaUtil.toSet(units),y=u[YEAR]?_(YEAR):vegaUtil.constant(2012),m=u[MONTH]?_(MONTH):u[QUARTER]?_(QUARTER):vegaUtil.zero,d=u[WEEK]&&u.day?_(DAY,1,WEEK+DAY):u[WEEK]?_(WEEK,1):u.day?_(DAY,1):u[DATE]?_(DATE,1):u.dayofyear?_("dayofyear",1):vegaUtil.one,H=u[HOURS]?_(HOURS):vegaUtil.zero,M=u[MINUTES]?_(MINUTES):vegaUtil.zero,S=u[SECONDS]?_(SECONDS):vegaUtil.zero,L=u.milliseconds?_("milliseconds"):vegaUtil.zero;return function(v){t.setTime(+v);const year=y(t);return newDate(year,m(t),d(t,year),H(t),M(t),S(t),L(t))}}function weekday(week,day,firstDay){return day+7*week-(firstDay+6)%7}const localGet={[YEAR]:d=>d.getFullYear(),[QUARTER]:d=>Math.floor(d.getMonth()/3),[MONTH]:d=>d.getMonth(),[DATE]:d=>d.getDate(),[HOURS]:d=>d.getHours(),[MINUTES]:d=>d.getMinutes(),[SECONDS]:d=>d.getSeconds(),milliseconds:d=>d.getMilliseconds(),dayofyear:d=>localDayOfYear(d),[WEEK]:d=>localWeekNum(d),[WEEK+DAY]:(d,y)=>weekday(localWeekNum(d),d.getDay(),localFirst(y)),[DAY]:(d,y)=>weekday(1,d.getDay(),localFirst(y))},localInv={[QUARTER]:q=>3*q,[WEEK]:(w,y)=>weekday(w,0,localFirst(y))},utcGet={[YEAR]:d=>d.getUTCFullYear(),[QUARTER]:d=>Math.floor(d.getUTCMonth()/3),[MONTH]:d=>d.getUTCMonth(),[DATE]:d=>d.getUTCDate(),[HOURS]:d=>d.getUTCHours(),[MINUTES]:d=>d.getUTCMinutes(),[SECONDS]:d=>d.getUTCSeconds(),milliseconds:d=>d.getUTCMilliseconds(),dayofyear:d=>utcDayOfYear(d),[WEEK]:d=>utcWeekNum(d),[DAY]:(d,y)=>weekday(1,d.getUTCDay(),utcFirst(y)),[WEEK+DAY]:(d,y)=>weekday(utcWeekNum(d),d.getUTCDay(),utcFirst(y))},utcInv={[QUARTER]:q=>3*q,[WEEK]:(w,y)=>weekday(w,0,utcFirst(y))},timeIntervals={[YEAR]:d3Time.timeYear,[QUARTER]:d3Time.timeMonth.every(3),[MONTH]:d3Time.timeMonth,[WEEK]:d3Time.timeWeek,[DATE]:d3Time.timeDay,[DAY]:d3Time.timeDay,dayofyear:d3Time.timeDay,[HOURS]:d3Time.timeHour,[MINUTES]:d3Time.timeMinute,[SECONDS]:d3Time.timeSecond,milliseconds:d3Time.timeMillisecond},utcIntervals={[YEAR]:d3Time.utcYear,[QUARTER]:d3Time.utcMonth.every(3),[MONTH]:d3Time.utcMonth,[WEEK]:d3Time.utcWeek,[DATE]:d3Time.utcDay,[DAY]:d3Time.utcDay,dayofyear:d3Time.utcDay,[HOURS]:d3Time.utcHour,[MINUTES]:d3Time.utcMinute,[SECONDS]:d3Time.utcSecond,milliseconds:d3Time.utcMillisecond};function timeInterval(unit){return timeIntervals[unit]}function utcInterval(unit){return utcIntervals[unit]}function offset(ival,date,step){return ival?ival.offset(date,step):void 0}function sequence(ival,start,stop,step){return ival?ival.range(start,stop,step):void 0}const Milli=[YEAR,MONTH,DATE,HOURS,MINUTES,SECONDS,"milliseconds"],Seconds=Milli.slice(0,-1),Minutes=Seconds.slice(0,-1),Hours=Minutes.slice(0,-1),Day=Hours.slice(0,-1),Month=[YEAR,MONTH],Year=[YEAR],intervals=[[Seconds,1,1e3],[Seconds,5,5e3],[Seconds,15,15e3],[Seconds,30,3e4],[Minutes,1,6e4],[Minutes,5,3e5],[Minutes,15,9e5],[Minutes,30,18e5],[Hours,1,36e5],[Hours,3,108e5],[Hours,6,216e5],[Hours,12,432e5],[Day,1,864e5],[[YEAR,WEEK],1,6048e5],[Month,1,2592e6],[Month,3,7776e6],[Year,1,31536e6]];exports.DATE=DATE,exports.DAY=DAY,exports.DAYOFYEAR="dayofyear",exports.HOURS=HOURS,exports.MILLISECONDS="milliseconds",exports.MINUTES=MINUTES,exports.MONTH=MONTH,exports.QUARTER=QUARTER,exports.SECONDS=SECONDS,exports.TIME_UNITS=TIME_UNITS,exports.WEEK=WEEK,exports.YEAR=YEAR,exports.dayofyear=function(d){return localDayOfYear(new Date(d))},exports.timeBin=function(opt){const ext=opt.extent,max=opt.maxbins||40,target=Math.abs(vegaUtil.span(ext))/max;let units,step,i=d3Array.bisector(i=>i[2]).right(intervals,target);return i===intervals.length?(units=Year,step=d3Array.tickStep(ext[0]/31536e6,ext[1]/31536e6,max)):i?(i=intervals[target/intervals[i-1][2]<intervals[i][2]/target?i-1:i],units=i[0],step=i[1]):(units=Milli,step=Math.max(d3Array.tickStep(ext[0],ext[1],max),1)),{units:units,step:step}},exports.timeFloor=function(units,step){return floor(units,step||1,localGet,localInv,localDate)},exports.timeInterval=timeInterval,exports.timeOffset=function(unit,date,step){return offset(timeInterval(unit),date,step)},exports.timeSequence=function(unit,start,stop,step){return sequence(timeInterval(unit),start,stop,step)},exports.timeUnitSpecifier=function(units,specifiers){const s=vegaUtil.extend({},defaultSpecifiers,specifiers),u=timeUnits(units),n=u.length;let end,key,fmt="",start=0;for(start=0;start<n;)for(end=u.length;end>start;--end)if(key=u.slice(start,end).join("-"),null!=s[key]){fmt+=s[key],start=end;break}return fmt.trim()},exports.timeUnits=timeUnits,exports.utcFloor=function(units,step){return floor(units,step||1,utcGet,utcInv,utcDate)},exports.utcInterval=utcInterval,exports.utcOffset=function(unit,date,step){return offset(utcInterval(unit),date,step)},exports.utcSequence=function(unit,start,stop,step){return sequence(utcInterval(unit),start,stop,step)},exports.utcdayofyear=function(d){return utcDayOfYear(new Date(d))},exports.utcweek=function(d){return utcWeekNum(new Date(d))},exports.week=function(d){return localWeekNum(new Date(d))},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(92),__webpack_require__(93))},function(module,exports,__webpack_require__){!function(exports,vegaUtil,d3Shape,d3Path,vegaCanvas,vegaLoader,vegaScale){"use strict";let gradient_id=0;function isGradient(value){return value&&value.gradient}function gradientRef(g,defs,base){const type=g.gradient;let id=g.id,prefix="radial"===type?"p_":"";return id||(id=g.id="gradient_"+gradient_id++,"radial"===type?(g.x1=get(g.x1,.5),g.y1=get(g.y1,.5),g.r1=get(g.r1,0),g.x2=get(g.x2,.5),g.y2=get(g.y2,.5),g.r2=get(g.r2,.5),prefix="p_"):(g.x1=get(g.x1,0),g.y1=get(g.y1,0),g.x2=get(g.x2,1),g.y2=get(g.y2,0))),defs[id]=g,"url("+(base||"")+"#"+prefix+id+")"}function get(val,def){return null!=val?val:def}const lookup={basis:{curve:d3Shape.curveBasis},"basis-closed":{curve:d3Shape.curveBasisClosed},"basis-open":{curve:d3Shape.curveBasisOpen},bundle:{curve:d3Shape.curveBundle,tension:"beta",value:.85},cardinal:{curve:d3Shape.curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:d3Shape.curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:d3Shape.curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:d3Shape.curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:d3Shape.curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:d3Shape.curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:d3Shape.curveLinear},"linear-closed":{curve:d3Shape.curveLinearClosed},monotone:{horizontal:d3Shape.curveMonotoneY,vertical:d3Shape.curveMonotoneX},natural:{curve:d3Shape.curveNatural},step:{curve:d3Shape.curveStep},"step-after":{curve:d3Shape.curveStepAfter},"step-before":{curve:d3Shape.curveStepBefore}};function curves(type,orientation,tension){var entry=vegaUtil.hasOwnProperty(lookup,type)&&lookup[type],curve=null;return entry&&(curve=entry.curve||entry[orientation||"vertical"],entry.tension&&null!=tension&&(curve=curve[entry.tension](tension))),curve}const cmdlen={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},regexp=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function pathParse(pathstr){const result=[];let curr,chunks,parsed,param,cmd,len,i,j,n,m;const path=pathstr.slice().replace(regexp[0],"###$1").split(regexp[1]).slice(1);for(i=0,n=path.length;i<n;++i){for(curr=path[i],chunks=curr.slice(1).trim().replace(regexp[2],"$1###$2").replace(regexp[3],"$1###$2").split(regexp[4]),cmd=curr.charAt(0),parsed=[cmd],j=0,m=chunks.length;j<m;++j)(param=+chunks[j])===param&&parsed.push(param);if(len=cmdlen[cmd.toLowerCase()],parsed.length-1>len){const m=parsed.length;for(j=1,result.push([cmd].concat(parsed.slice(j,j+=len))),cmd="M"===cmd?"L":"m"===cmd?"l":cmd;j<m;j+=len)result.push([cmd].concat(parsed.slice(j,j+len)))}else result.push(parsed)}return result}const DegToRad=Math.PI/180,HalfPi=Math.PI/2,Tau=2*Math.PI,HalfSqrt3=Math.sqrt(3)/2;var segmentCache={},bezierCache={},join=[].join;function bezier(params){const key=join.call(params);if(bezierCache[key])return bezierCache[key];var cx=params[0],cy=params[1],th0=params[2],th1=params[3],rx=params[4],ry=params[5],sin_th=params[6],cos_th=params[7];const a00=cos_th*rx,a01=-sin_th*ry,a10=sin_th*rx,a11=cos_th*ry,cos_th0=Math.cos(th0),sin_th0=Math.sin(th0),cos_th1=Math.cos(th1),sin_th1=Math.sin(th1),th_half=.5*(th1-th0),sin_th_h2=Math.sin(.5*th_half),t=8/3*sin_th_h2*sin_th_h2/Math.sin(th_half),x1=cx+cos_th0-t*sin_th0,y1=cy+sin_th0+t*cos_th0,x3=cx+cos_th1,y3=cy+sin_th1,x2=x3+t*sin_th1,y2=y3-t*cos_th1;return bezierCache[key]=[a00*x1+a01*y1,a10*x1+a11*y1,a00*x2+a01*y2,a10*x2+a11*y2,a00*x3+a01*y3,a10*x3+a11*y3]}const temp=["l",0,0,0,0,0,0,0];function scale(current,sX,sY){const c=temp[0]=current[0];if("a"===c||"A"===c)temp[1]=sX*current[1],temp[2]=sY*current[2],temp[3]=current[3],temp[4]=current[4],temp[5]=current[5],temp[6]=sX*current[6],temp[7]=sY*current[7];else if("h"===c||"H"===c)temp[1]=sX*current[1];else if("v"===c||"V"===c)temp[1]=sY*current[1];else for(var i=1,n=current.length;i<n;++i)temp[i]=(i%2==1?sX:sY)*current[i];return temp}function pathRender(context,path,l,t,sX,sY){var current,tempX,tempY,tempControlX,tempControlY,previous=null,x=0,y=0,controlX=0,controlY=0;null==l&&(l=0),null==t&&(t=0),null==sX&&(sX=1),null==sY&&(sY=sX),context.beginPath&&context.beginPath();for(var i=0,len=path.length;i<len;++i){switch(current=path[i],1===sX&&1===sY||(current=scale(current,sX,sY)),current[0]){case"l":x+=current[1],y+=current[2],context.lineTo(x+l,y+t);break;case"L":x=current[1],y=current[2],context.lineTo(x+l,y+t);break;case"h":x+=current[1],context.lineTo(x+l,y+t);break;case"H":x=current[1],context.lineTo(x+l,y+t);break;case"v":y+=current[1],context.lineTo(x+l,y+t);break;case"V":y=current[1],context.lineTo(x+l,y+t);break;case"m":x+=current[1],y+=current[2],context.moveTo(x+l,y+t);break;case"M":x=current[1],y=current[2],context.moveTo(x+l,y+t);break;case"c":tempX=x+current[5],tempY=y+current[6],controlX=x+current[3],controlY=y+current[4],context.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"C":x=current[5],y=current[6],controlX=current[3],controlY=current[4],context.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case"s":tempX=x+current[3],tempY=y+current[4],controlX=2*x-controlX,controlY=2*y-controlY,context.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t),controlX=x+current[1],controlY=y+current[2],x=tempX,y=tempY;break;case"S":tempX=current[3],tempY=current[4],controlX=2*x-controlX,controlY=2*y-controlY,context.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"q":tempX=x+current[3],tempY=y+current[4],controlX=x+current[1],controlY=y+current[2],context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"Q":tempX=current[3],tempY=current[4],context.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"t":tempX=x+current[1],tempY=y+current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):"t"===previous[0]?(controlX=2*x-tempControlX,controlY=2*y-tempControlY):"q"===previous[0]&&(controlX=2*x-controlX,controlY=2*y-controlY),tempControlX=controlX,tempControlY=controlY,context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),y=tempY,controlX=(x=tempX)+current[1],controlY=y+current[2];break;case"T":tempX=current[1],tempY=current[2],controlX=2*x-controlX,controlY=2*y-controlY,context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"a":drawArc(context,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]),x+=current[6],y+=current[7];break;case"A":drawArc(context,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]),x=current[6],y=current[7];break;case"z":case"Z":context.closePath()}previous=current}}function drawArc(context,x,y,coords){const seg=function(x,y,rx,ry,large,sweep,rotateX,ox,oy){const key=join.call(arguments);if(segmentCache[key])return segmentCache[key];const th=rotateX*DegToRad,sin_th=Math.sin(th),cos_th=Math.cos(th),px=cos_th*(ox-x)*.5+sin_th*(oy-y)*.5,py=cos_th*(oy-y)*.5-sin_th*(ox-x)*.5;let pl=px*px/((rx=Math.abs(rx))*rx)+py*py/((ry=Math.abs(ry))*ry);pl>1&&(pl=Math.sqrt(pl),rx*=pl,ry*=pl);const a00=cos_th/rx,a01=sin_th/rx,a10=-sin_th/ry,a11=cos_th/ry,x0=a00*ox+a01*oy,y0=a10*ox+a11*oy,x1=a00*x+a01*y,y1=a10*x+a11*y,d=(x1-x0)*(x1-x0)+(y1-y0)*(y1-y0);let sfactor_sq=1/d-.25;sfactor_sq<0&&(sfactor_sq=0);let sfactor=Math.sqrt(sfactor_sq);sweep==large&&(sfactor=-sfactor);const xc=.5*(x0+x1)-sfactor*(y1-y0),yc=.5*(y0+y1)+sfactor*(x1-x0),th0=Math.atan2(y0-yc,x0-xc),th1=Math.atan2(y1-yc,x1-xc);let th_arc=th1-th0;th_arc<0&&1===sweep?th_arc+=Tau:th_arc>0&&0===sweep&&(th_arc-=Tau);const segs=Math.ceil(Math.abs(th_arc/(HalfPi+.001))),result=[];for(let i=0;i<segs;++i){const th2=th0+i*th_arc/segs,th3=th0+(i+1)*th_arc/segs;result[i]=[xc,yc,th2,th3,rx,ry,sin_th,cos_th]}return segmentCache[key]=result}(coords[5],coords[6],coords[0],coords[1],coords[3],coords[4],coords[2],x,y);for(let i=0;i<seg.length;++i){const bez=bezier(seg[i]);context.bezierCurveTo(bez[0],bez[1],bez[2],bez[3],bez[4],bez[5])}}const Tan30=.5773502691896257,builtins={circle:{draw:function(context,size){const r=Math.sqrt(size)/2;context.moveTo(r,0),context.arc(0,0,r,0,Tau)}},cross:{draw:function(context,size){var r=Math.sqrt(size)/2,s=r/2.5;context.moveTo(-r,-s),context.lineTo(-r,s),context.lineTo(-s,s),context.lineTo(-s,r),context.lineTo(s,r),context.lineTo(s,s),context.lineTo(r,s),context.lineTo(r,-s),context.lineTo(s,-s),context.lineTo(s,-r),context.lineTo(-s,-r),context.lineTo(-s,-s),context.closePath()}},diamond:{draw:function(context,size){const r=Math.sqrt(size)/2;context.moveTo(-r,0),context.lineTo(0,-r),context.lineTo(r,0),context.lineTo(0,r),context.closePath()}},square:{draw:function(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}},arrow:{draw:function(context,size){var r=Math.sqrt(size)/2,s=r/7,t=r/2.5,v=r/8;context.moveTo(-s,r),context.lineTo(s,r),context.lineTo(s,-v),context.lineTo(t,-v),context.lineTo(0,-r),context.lineTo(-t,-v),context.lineTo(-s,-v),context.closePath()}},wedge:{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r,o=h-r*Tan30,b=r/4;context.moveTo(0,-h-o),context.lineTo(-b,h-o),context.lineTo(b,h-o),context.closePath()}},triangle:{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r,o=h-r*Tan30;context.moveTo(0,-h-o),context.lineTo(-r,h-o),context.lineTo(r,h-o),context.closePath()}},"triangle-up":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(0,-h),context.lineTo(-r,h),context.lineTo(r,h),context.closePath()}},"triangle-down":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(0,h),context.lineTo(-r,-h),context.lineTo(r,-h),context.closePath()}},"triangle-right":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(h,0),context.lineTo(-h,-r),context.lineTo(-h,r),context.closePath()}},"triangle-left":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(-h,0),context.lineTo(h,-r),context.lineTo(h,r),context.closePath()}},stroke:{draw:function(context,size){const r=Math.sqrt(size)/2;context.moveTo(-r,0),context.lineTo(r,0)}}};function symbols(_){return vegaUtil.hasOwnProperty(builtins,_)?builtins[_]:function(path){if(!vegaUtil.hasOwnProperty(custom,path)){const parsed=pathParse(path);custom[path]={draw:function(context,size){pathRender(context,parsed,0,0,Math.sqrt(size)/2)}}}return custom[path]}(_)}var custom={};const C=.448084975506;function rectangleX(d){return d.x}function rectangleY(d){return d.y}function rectangleWidth(d){return d.width}function rectangleHeight(d){return d.height}function number(_){return"function"==typeof _?_:()=>+_}function clamp(value,min,max){return Math.max(min,Math.min(value,max))}function vg_rect(){var x=rectangleX,y=rectangleY,width=rectangleWidth,height=rectangleHeight,crTL=number(0),crTR=crTL,crBL=crTL,crBR=crTL,context=null;function rectangle(_,x0,y0){var buffer,x1=null!=x0?x0:+x.call(this,_),y1=null!=y0?y0:+y.call(this,_),w=+width.call(this,_),h=+height.call(this,_),s=Math.min(w,h)/2,tl=clamp(+crTL.call(this,_),0,s),tr=clamp(+crTR.call(this,_),0,s),bl=clamp(+crBL.call(this,_),0,s),br=clamp(+crBR.call(this,_),0,s);if(context||(context=buffer=d3Path.path()),tl<=0&&tr<=0&&bl<=0&&br<=0)context.rect(x1,y1,w,h);else{var x2=x1+w,y2=y1+h;context.moveTo(x1+tl,y1),context.lineTo(x2-tr,y1),context.bezierCurveTo(x2-C*tr,y1,x2,y1+C*tr,x2,y1+tr),context.lineTo(x2,y2-br),context.bezierCurveTo(x2,y2-C*br,x2-C*br,y2,x2-br,y2),context.lineTo(x1+bl,y2),context.bezierCurveTo(x1+C*bl,y2,x1,y2-C*bl,x1,y2-bl),context.lineTo(x1,y1+tl),context.bezierCurveTo(x1,y1+C*tl,x1+C*tl,y1,x1+tl,y1),context.closePath()}if(buffer)return context=null,buffer+""||null}return rectangle.x=function(_){return arguments.length?(x=number(_),rectangle):x},rectangle.y=function(_){return arguments.length?(y=number(_),rectangle):y},rectangle.width=function(_){return arguments.length?(width=number(_),rectangle):width},rectangle.height=function(_){return arguments.length?(height=number(_),rectangle):height},rectangle.cornerRadius=function(tl,tr,br,bl){return arguments.length?(crTL=number(tl),crTR=null!=tr?number(tr):crTL,crBR=null!=br?number(br):crTL,crBL=null!=bl?number(bl):crTR,rectangle):crTL},rectangle.context=function(_){return arguments.length?(context=null==_?null:_,rectangle):context},rectangle}function vg_trail(){var x,y,size,defined,ready,x1,y1,r1,context=null;function point(x2,y2,w2){const r2=w2/2;if(ready){var ux=y1-y2,uy=x2-x1;if(ux||uy){var ud=Math.sqrt(ux*ux+uy*uy),rx=(ux/=ud)*r1,ry=(uy/=ud)*r1,t=Math.atan2(uy,ux);context.moveTo(x1-rx,y1-ry),context.lineTo(x2-ux*r2,y2-uy*r2),context.arc(x2,y2,r2,t-Math.PI,t),context.lineTo(x1+rx,y1+ry),context.arc(x1,y1,r1,t,t+Math.PI)}else context.arc(x2,y2,r2,0,Tau);context.closePath()}else ready=1;x1=x2,y1=y2,r1=r2}function trail(data){var i,d,buffer,n=data.length,defined0=!1;for(null==context&&(context=buffer=d3Path.path()),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&(defined0=!defined0)&&(ready=0),defined0&&point(+x(d,i,data),+y(d,i,data),+size(d,i,data));if(buffer)return context=null,buffer+""||null}return trail.x=function(_){return arguments.length?(x=_,trail):x},trail.y=function(_){return arguments.length?(y=_,trail):y},trail.size=function(_){return arguments.length?(size=_,trail):size},trail.defined=function(_){return arguments.length?(defined=_,trail):defined},trail.context=function(_){return arguments.length?(context=null==_?null:_,trail):context},trail}function value(a,b){return null!=a?a:b}const x=item=>item.x||0,y=item=>item.y||0,def=item=>!(!1===item.defined),arcShape=d3Shape.arc().startAngle(item=>item.startAngle||0).endAngle(item=>item.endAngle||0).padAngle(item=>item.padAngle||0).innerRadius(item=>item.innerRadius||0).outerRadius(item=>item.outerRadius||0).cornerRadius(item=>item.cornerRadius||0),areavShape=d3Shape.area().x(x).y1(y).y0(item=>(item.y||0)+(item.height||0)).defined(def),areahShape=d3Shape.area().y(y).x1(x).x0(item=>(item.x||0)+(item.width||0)).defined(def),lineShape=d3Shape.line().x(x).y(y).defined(def),rectShape=vg_rect().x(x).y(y).width(item=>item.width||0).height(item=>item.height||0).cornerRadius(item=>value(item.cornerRadiusTopLeft,item.cornerRadius)||0,item=>value(item.cornerRadiusTopRight,item.cornerRadius)||0,item=>value(item.cornerRadiusBottomRight,item.cornerRadius)||0,item=>value(item.cornerRadiusBottomLeft,item.cornerRadius)||0),symbolShape=d3Shape.symbol().type(item=>symbols(item.shape||"circle")).size(item=>value(item.size,64)),trailShape=vg_trail().x(x).y(y).defined(def).size(item=>item.size||1);function hasCornerRadius(item){return item.cornerRadius||item.cornerRadiusTopLeft||item.cornerRadiusTopRight||item.cornerRadiusBottomRight||item.cornerRadiusBottomLeft}function rectangle(context,item,x,y){return rectShape.context(context)(item,x,y)}var clip_id=1;function resetSVGClipId(){clip_id=1}function clip(renderer,item,size){var clip=item.clip,defs=renderer._defs,id=item.clip_id||(item.clip_id="clip"+clip_id++),c=defs.clipping[id]||(defs.clipping[id]={id:id});return vegaUtil.isFunction(clip)?c.path=clip(null):hasCornerRadius(size)?c.path=rectangle(null,size,0,0):(c.width=size.width||0,c.height=size.height||0),"url(#"+id+")"}function Bounds(b){this.clear(),b&&this.union(b)}function Item(mark){this.mark=mark,this.bounds=this.bounds||new Bounds}function GroupItem(mark){Item.call(this,mark),this.items=this.items||[]}function ResourceLoader(customLoader){this._pending=0,this._loader=customLoader||vegaLoader.loader()}function increment(loader){loader._pending+=1}function decrement(loader){loader._pending-=1}function boundStroke(bounds,item,miter){if(item.stroke&&0!==item.opacity&&0!==item.strokeOpacity){const sw=null!=item.strokeWidth?+item.strokeWidth:1;bounds.expand(sw+(miter?function(item,strokeWidth){return item.strokeJoin&&"miter"!==item.strokeJoin?0:strokeWidth}(item,sw):0))}return bounds}Bounds.prototype={clone(){return new Bounds(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(b){return this.x1===b.x1&&this.y1===b.y1&&this.x2===b.x2&&this.y2===b.y2},set(x1,y1,x2,y2){return x2<x1?(this.x2=x1,this.x1=x2):(this.x1=x1,this.x2=x2),y2<y1?(this.y2=y1,this.y1=y2):(this.y1=y1,this.y2=y2),this},add(x,y){return x<this.x1&&(this.x1=x),y<this.y1&&(this.y1=y),x>this.x2&&(this.x2=x),y>this.y2&&(this.y2=y),this},expand(d){return this.x1-=d,this.y1-=d,this.x2+=d,this.y2+=d,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(s){return this.x1*=s,this.y1*=s,this.x2*=s,this.y2*=s,this},translate(dx,dy){return this.x1+=dx,this.x2+=dx,this.y1+=dy,this.y2+=dy,this},rotate(angle,x,y){const p=this.rotatedPoints(angle,x,y);return this.clear().add(p[0],p[1]).add(p[2],p[3]).add(p[4],p[5]).add(p[6],p[7])},rotatedPoints(angle,x,y){var{x1:x1,y1:y1,x2:x2,y2:y2}=this,cos=Math.cos(angle),sin=Math.sin(angle),cx=x-x*cos+y*sin,cy=y-x*sin-y*cos;return[cos*x1-sin*y1+cx,sin*x1+cos*y1+cy,cos*x1-sin*y2+cx,sin*x1+cos*y2+cy,cos*x2-sin*y1+cx,sin*x2+cos*y1+cy,cos*x2-sin*y2+cx,sin*x2+cos*y2+cy]},union(b){return b.x1<this.x1&&(this.x1=b.x1),b.y1<this.y1&&(this.y1=b.y1),b.x2>this.x2&&(this.x2=b.x2),b.y2>this.y2&&(this.y2=b.y2),this},intersect(b){return b.x1>this.x1&&(this.x1=b.x1),b.y1>this.y1&&(this.y1=b.y1),b.x2<this.x2&&(this.x2=b.x2),b.y2<this.y2&&(this.y2=b.y2),this},encloses(b){return b&&this.x1<=b.x1&&this.x2>=b.x2&&this.y1<=b.y1&&this.y2>=b.y2},alignsWith(b){return b&&(this.x1==b.x1||this.x2==b.x2||this.y1==b.y1||this.y2==b.y2)},intersects(b){return b&&!(this.x2<b.x1||this.x1>b.x2||this.y2<b.y1||this.y1>b.y2)},contains(x,y){return!(x<this.x1||x>this.x2||y<this.y1||y>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},vegaUtil.inherits(GroupItem,Item),ResourceLoader.prototype={pending(){return this._pending},sanitizeURL(uri){const loader=this;return increment(loader),loader._loader.sanitize(uri,{context:"href"}).then(opt=>(decrement(loader),opt)).catch(()=>(decrement(loader),null))},loadImage(uri){const loader=this,Image=vegaCanvas.image();return increment(loader),loader._loader.sanitize(uri,{context:"image"}).then(opt=>{const url=opt.href;if(!url||!Image)throw{url:url};const img=new Image,cors=vegaUtil.hasOwnProperty(opt,"crossOrigin")?opt.crossOrigin:"anonymous";return null!=cors&&(img.crossOrigin=cors),img.onload=()=>decrement(loader),img.onerror=()=>decrement(loader),img.src=url,img}).catch(e=>(decrement(loader),{complete:!1,width:0,height:0,src:e&&e.url||""}))},ready(){const loader=this;return new Promise(accept=>{!function poll(value){loader.pending()?setTimeout(()=>{poll(!0)},10):accept(value)}(!1)})}};const circleThreshold=Tau-1e-8;let bounds,lx,ly,rot,ma,mb,mc,md;const add=(x,y)=>bounds.add(x,y),addL=(x,y)=>add(lx=x,ly=y),addX=x=>add(x,bounds.y1),addY=y=>add(bounds.x1,y),px=(x,y)=>ma*x+mc*y,py=(x,y)=>mb*x+md*y,addp=(x,y)=>add(px(x,y),py(x,y)),addpL=(x,y)=>addL(px(x,y),py(x,y));function boundContext(_,deg){return bounds=_,deg?(rot=deg*DegToRad,ma=md=Math.cos(rot),mb=Math.sin(rot),mc=-mb):(ma=md=1,rot=mb=mc=0),context}const context={beginPath(){},closePath(){},moveTo:addpL,lineTo:addpL,rect(x,y,w,h){rot?(addp(x+w,y),addp(x+w,y+h),addp(x,y+h),addpL(x,y)):(add(x+w,y+h),addL(x,y))},quadraticCurveTo(x1,y1,x2,y2){const px1=px(x1,y1),py1=py(x1,y1),px2=px(x2,y2),py2=py(x2,y2);quadExtrema(lx,px1,px2,addX),quadExtrema(ly,py1,py2,addY),addL(px2,py2)},bezierCurveTo(x1,y1,x2,y2,x3,y3){const px1=px(x1,y1),py1=py(x1,y1),px2=px(x2,y2),py2=py(x2,y2),px3=px(x3,y3),py3=py(x3,y3);cubicExtrema(lx,px1,px2,px3,addX),cubicExtrema(ly,py1,py2,py3,addY),addL(px3,py3)},arc(cx,cy,r,sa,ea,ccw){if(sa+=rot,ea+=rot,lx=r*Math.cos(ea)+cx,ly=r*Math.sin(ea)+cy,Math.abs(ea-sa)>circleThreshold)add(cx-r,cy-r),add(cx+r,cy+r);else{const update=a=>add(r*Math.cos(a)+cx,r*Math.sin(a)+cy);let s,i;if(update(sa),update(ea),ea!==sa)if((sa%=Tau)<0&&(sa+=Tau),(ea%=Tau)<0&&(ea+=Tau),ea<sa&&(ccw=!ccw,s=sa,sa=ea,ea=s),ccw)for(ea-=Tau,s=sa-sa%HalfPi,i=0;i<4&&s>ea;++i,s-=HalfPi)update(s);else for(s=sa-sa%HalfPi+HalfPi,i=0;i<4&&s<ea;++i,s+=HalfPi)update(s)}}};function quadExtrema(x0,x1,x2,cb){const t=(x0-x1)/(x0+x2-2*x1);0<t&&t<1&&cb(x0+(x1-x0)*t)}function cubicExtrema(x0,x1,x2,x3,cb){const a=x3-x0+3*x1-3*x2,b=x0+x2-2*x1,c=x0-x1;let r,t0=0,t1=0;Math.abs(a)>1e-14?(r=b*b+c*a,r>=0&&(r=Math.sqrt(r),t0=(-b+r)/a,t1=(-b-r)/a)):t0=.5*c/b,0<t0&&t0<1&&cb(cubic(t0,x0,x1,x2,x3)),0<t1&&t1<1&&cb(cubic(t1,x0,x1,x2,x3))}function cubic(t,x0,x1,x2,x3){const s=1-t,s2=s*s,t2=t*t;return s2*s*x0+3*s2*t*x1+3*s*t2*x2+t2*t*x3}var context$1=(context$1=vegaCanvas.canvas(1,1))?context$1.getContext("2d"):null;const b=new Bounds;function intersectPath(draw){return function(item,brush){if(!context$1)return!0;draw(context$1,item),b.clear().union(item.bounds).intersect(brush).round();const{x1:x1,y1:y1,x2:x2,y2:y2}=b;for(let y=y1;y<=y2;++y)for(let x=x1;x<=x2;++x)if(context$1.isPointInPath(x,y))return!0;return!1}}function intersectPoint(item,box){return box.contains(item.x||0,item.y||0)}function intersectRect(item,box){const x=item.x||0,y=item.y||0,w=item.width||0,h=item.height||0;return box.intersects(b.set(x,y,x+w,y+h))}function intersectRule(item,box){const x=item.x||0,y=item.y||0;return intersectBoxLine(box,x,y,null!=item.x2?item.x2:x,null!=item.y2?item.y2:y)}function intersectBoxLine(box,x,y,u,v){const{x1:x1,y1:y1,x2:x2,y2:y2}=box,dx=u-x,dy=v-y;let p,q,r,e,t0=0,t1=1;for(e=0;e<4;++e){if(0===e&&(p=-dx,q=-(x1-x)),1===e&&(p=dx,q=x2-x),2===e&&(p=-dy,q=-(y1-y)),3===e&&(p=dy,q=y2-y),Math.abs(p)<1e-10&&q<0)return!1;if(r=q/p,p<0){if(r>t1)return!1;r>t0&&(t0=r)}else if(p>0){if(r<t0)return!1;r<t1&&(t1=r)}}return!0}function blend(context,item){context.globalCompositeOperation=item.blend||"source-over"}function value$1(value,dflt){return null==value?dflt:value}function addStops(gradient,stops){const n=stops.length;for(let i=0;i<n;++i)gradient.addColorStop(stops[i].offset,stops[i].color);return gradient}function color(context,item,value){return isGradient(value)?function(context,spec,bounds){const w=bounds.width(),h=bounds.height();let gradient;if("radial"===spec.gradient)gradient=context.createRadialGradient(bounds.x1+value$1(spec.x1,.5)*w,bounds.y1+value$1(spec.y1,.5)*h,Math.max(w,h)*value$1(spec.r1,0),bounds.x1+value$1(spec.x2,.5)*w,bounds.y1+value$1(spec.y2,.5)*h,Math.max(w,h)*value$1(spec.r2,.5));else{const x1=value$1(spec.x1,0),y1=value$1(spec.y1,0),x2=value$1(spec.x2,1),y2=value$1(spec.y2,0);if(x1!==x2&&y1!==y2&&w!==h){const image=vegaCanvas.canvas(Math.ceil(w),Math.ceil(h)),ictx=image.getContext("2d");return ictx.scale(w,h),ictx.fillStyle=addStops(ictx.createLinearGradient(x1,y1,x2,y2),spec.stops),ictx.fillRect(0,0,w,h),context.createPattern(image,"no-repeat")}gradient=context.createLinearGradient(bounds.x1+x1*w,bounds.y1+y1*h,bounds.x1+x2*w,bounds.y1+y2*h)}return addStops(gradient,spec.stops)}(context,value,item.bounds):value}function fill(context,item,opacity){return(opacity*=null==item.fillOpacity?1:item.fillOpacity)>0&&(context.globalAlpha=opacity,context.fillStyle=color(context,item,item.fill),!0)}var Empty=[];function stroke(context,item,opacity){var lw=null!=(lw=item.strokeWidth)?lw:1;return!(lw<=0)&&(opacity*=null==item.strokeOpacity?1:item.strokeOpacity)>0&&(context.globalAlpha=opacity,context.strokeStyle=color(context,item,item.stroke),context.lineWidth=lw,context.lineCap=item.strokeCap||"butt",context.lineJoin=item.strokeJoin||"miter",context.miterLimit=item.strokeMiterLimit||10,context.setLineDash&&(context.setLineDash(item.strokeDash||Empty),context.lineDashOffset=item.strokeDashOffset||0),!0)}function compare(a,b){return a.zindex-b.zindex||a.index-b.index}function zorder(scene){if(!scene.zdirty)return scene.zitems;var item,i,n,items=scene.items,output=[];for(i=0,n=items.length;i<n;++i)(item=items[i]).index=i,item.zindex&&output.push(item);return scene.zdirty=!1,scene.zitems=output.sort(compare)}function visit(scene,visitor){var i,n,items=scene.items;if(!items||!items.length)return;const zitems=zorder(scene);if(zitems&&zitems.length){for(i=0,n=items.length;i<n;++i)items[i].zindex||visitor(items[i]);items=zitems}for(i=0,n=items.length;i<n;++i)visitor(items[i])}function pickVisit(scene,visitor){var hit,i,items=scene.items;if(!items||!items.length)return null;const zitems=zorder(scene);for(zitems&&zitems.length&&(items=zitems),i=items.length;--i>=0;)if(hit=visitor(items[i]))return hit;if(items===zitems)for(i=(items=scene.items).length;--i>=0;)if(!items[i].zindex&&(hit=visitor(items[i])))return hit;return null}function drawAll(path){return function(context,scene,bounds){visit(scene,item=>{bounds&&!bounds.intersects(item.bounds)||drawPath(path,context,item,item)})}}function drawOne(path){return function(context,scene,bounds){!scene.items.length||bounds&&!bounds.intersects(scene.bounds)||drawPath(path,context,scene.items[0],scene.items)}}function drawPath(path,context,item,items){var opacity=null==item.opacity?1:item.opacity;0!==opacity&&(path(context,items)||(blend(context,item),item.fill&&fill(context,item,opacity)&&context.fill(),item.stroke&&stroke(context,item,opacity)&&context.stroke()))}function pick(test){return test=test||vegaUtil.truthy,function(context,scene,x,y,gx,gy){return x*=context.pixelRatio,y*=context.pixelRatio,pickVisit(scene,item=>{const b=item.bounds;if((!b||b.contains(gx,gy))&&b)return test(context,item,x,y,gx,gy)?item:void 0})}}function hitPath(path,filled){return function(context,o,x,y){var lw,lc,item=Array.isArray(o)?o[0]:o,fill=null==filled?item.fill:filled,stroke=item.stroke&&context.isPointInStroke;return stroke&&(lw=item.strokeWidth,lc=item.strokeCap,context.lineWidth=null!=lw?lw:1,context.lineCap=null!=lc?lc:"butt"),!path(context,o)&&(fill&&context.isPointInPath(x,y)||stroke&&context.isPointInStroke(x,y))}}function pickPath(path){return pick(hitPath(path))}function translate(x,y){return"translate("+x+","+y+")"}function rotate(a){return"rotate("+a+")"}function translateItem(item){return translate(item.x||0,item.y||0)}function markItemPath(type,shape,isect){function draw(context,item){var x=item.x||0,y=item.y||0,a=item.angle||0;context.translate(x,y),a&&context.rotate(a*=DegToRad),context.beginPath(),shape(context,item),a&&context.rotate(-a),context.translate(-x,-y)}return{type:type,tag:"path",nested:!1,attr:function(emit,item){emit("transform",function(item){return translate(item.x||0,item.y||0)+(item.angle?" "+rotate(item.angle):"")}(item)),emit("d",shape(null,item))},bound:function(bounds,item){return shape(boundContext(bounds,item.angle),item),boundStroke(bounds,item).translate(item.x||0,item.y||0)},draw:drawAll(draw),pick:pickPath(draw),isect:isect||intersectPath(draw)}}var arc$1=markItemPath("arc",(function(context,item){return arcShape.context(context)(item)}));function markMultiItemPath(type,shape,tip){function draw(context,items){context.beginPath(),shape(context,items)}const hit=hitPath(draw);return{type:type,tag:"path",nested:!0,attr:function(emit,item){var items=item.mark.items;items.length&&emit("d",shape(null,items))},bound:function(bounds,mark){var items=mark.items;return 0===items.length?bounds:(shape(boundContext(bounds),items),boundStroke(bounds,items[0]))},draw:drawOne(draw),pick:function(context,scene,x,y,gx,gy){var items=scene.items,b=scene.bounds;return!items||!items.length||b&&!b.contains(gx,gy)?null:(x*=context.pixelRatio,y*=context.pixelRatio,hit(context,items,x,y)?items[0]:null)},isect:intersectPoint,tip:tip}}var area$1=markMultiItemPath("area",(function(context,items){const item=items[0],interp=item.interpolate||"linear";return("horizontal"===item.orient?areahShape:areavShape).curve(curves(interp,item.orient,item.tension)).context(context)(items)}),(function(a,p){for(var hit,d,v="horizontal"===a[0].orient?p[1]:p[0],z="horizontal"===a[0].orient?"y":"x",i=a.length,min=1/0;--i>=0;)!1!==a[i].defined&&(d=Math.abs(a[i][z]-v))<min&&(min=d,hit=a[i]);return hit}));function clipGroup(context,group){context.beginPath(),hasCornerRadius(group)?rectangle(context,group,0,0):context.rect(0,0,group.width||0,group.height||0),context.clip()}function offset(item){const sw=value$1(item.strokeWidth,1);return null!=item.strokeOffset?item.strokeOffset:item.stroke&&sw>.5&&sw<1.5?.5-Math.abs(sw-1):0}function emitRectangle(emit,item){const off=offset(item);emit("d",rectangle(null,item,off,off))}function rectanglePath(context,group,x,y){const off=offset(group);context.beginPath(),rectangle(context,group,(x||0)+off,(y||0)+off)}const hitBackground=hitPath(rectanglePath),hitForeground=hitPath(rectanglePath,!1),hitCorner=hitPath(rectanglePath,!0);var group={type:"group",tag:"g",nested:!1,attr:function(emit,item){emit("transform",translateItem(item))},bound:function(bounds,group){if(!group.clip&&group.items){const items=group.items,m=items.length;for(let j=0;j<m;++j)bounds.union(items[j].bounds)}return(group.clip||group.width||group.height)&&!group.noBound&&bounds.add(0,0).add(group.width||0,group.height||0),boundStroke(bounds,group),bounds.translate(group.x||0,group.y||0)},draw:function(context,scene,bounds){visit(scene,group=>{const gx=group.x||0,gy=group.y||0,fore=group.strokeForeground,opacity=null==group.opacity?1:group.opacity;(group.stroke||group.fill)&&opacity&&(rectanglePath(context,group,gx,gy),blend(context,group),group.fill&&fill(context,group,opacity)&&context.fill(),group.stroke&&!fore&&stroke(context,group,opacity)&&context.stroke()),context.save(),context.translate(gx,gy),group.clip&&clipGroup(context,group),bounds&&bounds.translate(-gx,-gy),visit(group,item=>{this.draw(context,item,bounds)}),bounds&&bounds.translate(gx,gy),context.restore(),fore&&group.stroke&&opacity&&(rectanglePath(context,group,gx,gy),blend(context,group),stroke(context,group,opacity)&&context.stroke())})},pick:function(context,scene,x,y,gx,gy){if(scene.bounds&&!scene.bounds.contains(gx,gy)||!scene.items)return null;const cx=x*context.pixelRatio,cy=y*context.pixelRatio;return pickVisit(scene,group=>{let hit,dx,dy;const b=group.bounds;if(b&&!b.contains(gx,gy))return;dx=group.x||0,dy=group.y||0;const dw=dx+(group.width||0),dh=dy+(group.height||0),c=group.clip;if(c&&(gx<dx||gx>dw||gy<dy||gy>dh))return;if(context.save(),context.translate(dx,dy),dx=gx-dx,dy=gy-dy,c&&hasCornerRadius(group)&&!hitCorner(context,group,cx,cy))return context.restore(),null;const fore=group.strokeForeground,ix=!1!==scene.interactive;return ix&&fore&&group.stroke&&hitForeground(context,group,cx,cy)?(context.restore(),group):(hit=pickVisit(group,mark=>function(mark,x,y){return(!1!==mark.interactive||"group"===mark.marktype)&&mark.bounds&&mark.bounds.contains(x,y)}(mark,dx,dy)?this.pick(mark,x,y,dx,dy):null),!hit&&ix&&(group.fill||!fore&&group.stroke)&&hitBackground(context,group,cx,cy)&&(hit=group),context.restore(),hit||null)})},isect:intersectRect,content:function(emit,item,renderer){emit("clip-path",item.clip?clip(renderer,item,item):null)},background:function(emit,item){emit("class","background"),emit("aria-hidden",!0),emitRectangle(emit,item)},foreground:function(emit,item){emit("class","foreground"),emit("aria-hidden",!0),item.strokeForeground?emitRectangle(emit,item):emit("d","")}},metadata={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function getImage(item,renderer){var image=item.image;return(!image||item.url&&item.url!==image.url)&&(image={complete:!1,width:0,height:0},renderer.loadImage(item.url).then(image=>{item.image=image,item.image.url=item.url})),image}function imageWidth(item,image){return null!=item.width?item.width:image&&image.width?!1!==item.aspect&&item.height?item.height*image.width/image.height:image.width:0}function imageHeight(item,image){return null!=item.height?item.height:image&&image.height?!1!==item.aspect&&item.width?item.width*image.height/image.width:image.height:0}function imageXOffset(align,w){return"center"===align?w/2:"right"===align?w:0}function imageYOffset(baseline,h){return"middle"===baseline?h/2:"bottom"===baseline?h:0}var image={type:"image",tag:"image",nested:!1,attr:function(emit,item,renderer){const img=getImage(item,renderer),w=imageWidth(item,img),h=imageHeight(item,img),x=(item.x||0)-imageXOffset(item.align,w),y=(item.y||0)-imageYOffset(item.baseline,h);emit("href",!img.src&&img.toDataURL?img.toDataURL():img.src||"",metadata["xmlns:xlink"],"xlink:href"),emit("transform",translate(x,y)),emit("width",w),emit("height",h),emit("preserveAspectRatio",!1===item.aspect?"none":"xMidYMid")},bound:function(bounds,item){const img=item.image,w=imageWidth(item,img),h=imageHeight(item,img),x=(item.x||0)-imageXOffset(item.align,w),y=(item.y||0)-imageYOffset(item.baseline,h);return bounds.set(x,y,x+w,y+h)},draw:function(context,scene,bounds){visit(scene,item=>{if(bounds&&!bounds.intersects(item.bounds))return;const img=getImage(item,this);let opacity,ar0,ar1,t,w=imageWidth(item,img),h=imageHeight(item,img),x=(item.x||0)-imageXOffset(item.align,w),y=(item.y||0)-imageYOffset(item.baseline,h);!1!==item.aspect&&(ar0=img.width/img.height,ar1=item.width/item.height,ar0==ar0&&ar1==ar1&&ar0!==ar1&&(ar1<ar0?(t=w/ar0,y+=(h-t)/2,h=t):(t=h*ar0,x+=(w-t)/2,w=t))),(img.complete||img.toDataURL)&&(blend(context,item),context.globalAlpha=null!=(opacity=item.opacity)?opacity:1,context.imageSmoothingEnabled=!1!==item.smooth,context.drawImage(img,x,y,w,h))})},pick:pick(),isect:vegaUtil.truthy,get:getImage,xOffset:imageXOffset,yOffset:imageYOffset},line$1=markMultiItemPath("line",(function(context,items){const item=items[0],interp=item.interpolate||"linear";return lineShape.curve(curves(interp,item.orient,item.tension)).context(context)(items)}),(function(a,p){for(var dx,dy,t=Math.pow(a[0].strokeWidth||1,2),i=a.length;--i>=0;)if(!1!==a[i].defined&&(dx=a[i].x-p[0])*dx+(dy=a[i].y-p[1])*dy<t)return a[i];return null}));function path(context,item){var path=item.path;if(null==path)return!0;var x=item.x||0,y=item.y||0,sx=item.scaleX||1,sy=item.scaleY||1,a=(item.angle||0)*DegToRad,cache=item.pathCache;cache&&cache.path===path||((item.pathCache=cache=pathParse(path)).path=path),a&&context.rotate&&context.translate?(context.translate(x,y),context.rotate(a),pathRender(context,cache,0,0,sx,sy),context.rotate(-a),context.translate(-x,-y)):pathRender(context,cache,x,y,sx,sy)}var path$1={type:"path",tag:"path",nested:!1,attr:function(emit,item){var sx=item.scaleX||1,sy=item.scaleY||1;1===sx&&1===sy||emit("vector-effect","non-scaling-stroke"),emit("transform",function(item){return translate(item.x||0,item.y||0)+(item.angle?" "+rotate(item.angle):"")+(item.scaleX||item.scaleY?" "+(scaleX=item.scaleX||1,scaleY=item.scaleY||1,"scale("+scaleX+","+scaleY+")"):"");var scaleX,scaleY}(item)),emit("d",item.path)},bound:function(bounds,item){return path(boundContext(bounds,item.angle),item)?bounds.set(0,0,0,0):boundStroke(bounds,item,!0)},draw:drawAll(path),pick:pickPath(path),isect:intersectPath(path)};function draw$2(context,item){context.beginPath(),rectangle(context,item)}var rect={type:"rect",tag:"path",nested:!1,attr:function(emit,item){emit("d",rectangle(null,item))},bound:function(bounds,item){var x,y;return boundStroke(bounds.set(x=item.x||0,y=item.y||0,x+item.width||0,y+item.height||0),item)},draw:drawAll(draw$2),pick:pickPath(draw$2),isect:intersectRect};function path$2(context,item,opacity){var x1,y1,x2,y2;return!(!item.stroke||!stroke(context,item,opacity)||(x1=item.x||0,y1=item.y||0,x2=null!=item.x2?item.x2:x1,y2=null!=item.y2?item.y2:y1,context.beginPath(),context.moveTo(x1,y1),context.lineTo(x2,y2),0))}var rule={type:"rule",tag:"line",nested:!1,attr:function(emit,item){emit("transform",translateItem(item)),emit("x2",null!=item.x2?item.x2-(item.x||0):0),emit("y2",null!=item.y2?item.y2-(item.y||0):0)},bound:function(bounds,item){var x1,y1;return boundStroke(bounds.set(x1=item.x||0,y1=item.y||0,null!=item.x2?item.x2:x1,null!=item.y2?item.y2:y1),item)},draw:function(context,scene,bounds){visit(scene,item=>{if(!bounds||bounds.intersects(item.bounds)){var opacity=null==item.opacity?1:item.opacity;opacity&&path$2(context,item,opacity)&&(blend(context,item),context.stroke())}})},pick:pick((function(context,item,x,y){return!!context.isPointInStroke&&path$2(context,item,1)&&context.isPointInStroke(x,y)})),isect:intersectRule},shape$1=markItemPath("shape",(function(context,item){return(item.mark.shape||item.shape).context(context)(item)})),symbol$1=markItemPath("symbol",(function(context,item){return symbolShape.context(context)(item)}),intersectPoint);const widthCache=vegaUtil.lruCache();var textMetrics={height:fontSize,measureWidth:measureWidth,estimateWidth:estimateWidth,width:estimateWidth,canvas:useCanvas};function useCanvas(use){textMetrics.width=use&&context$1?measureWidth:estimateWidth}function estimateWidth(item,text){return _estimateWidth(textValue(item,text),fontSize(item))}function _estimateWidth(text,currentFontHeight){return~~(.8*text.length*currentFontHeight)}function measureWidth(item,text){return fontSize(item)<=0||!(text=textValue(item,text))?0:_measureWidth(text,font(item))}function _measureWidth(text,currentFont){const key=`(${currentFont}) ${text}`;let width=widthCache.get(key);return void 0===width&&(context$1.font=currentFont,width=context$1.measureText(text).width,widthCache.set(key,width)),width}function fontSize(item){return null!=item.fontSize?+item.fontSize||0:11}function lineHeight(item){return null!=item.lineHeight?item.lineHeight:fontSize(item)+2}function textLines(item){return _=item.lineBreak&&item.text&&!vegaUtil.isArray(item.text)?item.text.split(item.lineBreak):item.text,vegaUtil.isArray(_)?_.length>1?_:_[0]:_;var _}function textValue(item,line){const text=null==line?"":(line+"").trim();return item.limit>0&&text.length?function(item,text){var limit=+item.limit,width=function(item){if(textMetrics.width===measureWidth){const currentFont=font(item);return text=>_measureWidth(text,currentFont)}{const currentFontHeight=fontSize(item);return text=>_estimateWidth(text,currentFontHeight)}}(item);if(width(text)<limit)return text;var mid,ellipsis=item.ellipsis||"â€¦",rtl="rtl"===item.dir,lo=0,hi=text.length;if(limit-=width(ellipsis),rtl){for(;lo<hi;)mid=lo+hi>>>1,width(text.slice(mid))>limit?lo=mid+1:hi=mid;return ellipsis+text.slice(lo)}for(;lo<hi;)mid=1+(lo+hi>>>1),width(text.slice(0,mid))<limit?lo=mid:hi=mid-1;return text.slice(0,lo)+ellipsis}(item,text):text}function fontFamily(item,quote){var font=item.font;return(quote&&font?String(font).replace(/"/g,"'"):font)||"sans-serif"}function font(item,quote){return(item.fontStyle?item.fontStyle+" ":"")+(item.fontVariant?item.fontVariant+" ":"")+(item.fontWeight?item.fontWeight+" ":"")+fontSize(item)+"px "+fontFamily(item,quote)}function offset$1(item){var baseline=item.baseline,h=fontSize(item);return Math.round("top"===baseline?.79*h:"middle"===baseline?.3*h:"bottom"===baseline?-.21*h:"line-top"===baseline?.29*h+.5*lineHeight(item):"line-bottom"===baseline?.29*h-.5*lineHeight(item):0)}useCanvas(!0);const textAlign={left:"start",center:"middle",right:"end"},tempBounds=new Bounds;function anchorPoint(item){var t,x=item.x||0,y=item.y||0,r=item.radius||0;return r&&(t=(item.theta||0)-HalfPi,x+=r*Math.cos(t),y+=r*Math.sin(t)),tempBounds.x1=x,tempBounds.y1=y,tempBounds}function bound$5(bounds,item,mode){var w,h=textMetrics.height(item),a=item.align,p=anchorPoint(item),x=p.x1,y=p.y1,dx=item.dx||0,dy=(item.dy||0)+offset$1(item)-Math.round(.8*h),tl=textLines(item);if(vegaUtil.isArray(tl)?(h+=lineHeight(item)*(tl.length-1),w=tl.reduce((w,t)=>Math.max(w,textMetrics.width(item,t)),0)):w=textMetrics.width(item,tl),"center"===a?dx-=w/2:"right"===a&&(dx-=w),bounds.set(dx+=x,dy+=y,dx+w,dy+h),item.angle&&!mode)bounds.rotate(item.angle*DegToRad,x,y);else if(2===mode)return bounds.rotatedPoints(item.angle*DegToRad,x,y);return bounds}var text={type:"text",tag:"text",nested:!1,attr:function(emit,item){var t,dx=item.dx||0,dy=(item.dy||0)+offset$1(item),p=anchorPoint(item),x=p.x1,y=p.y1,a=item.angle||0;emit("text-anchor",textAlign[item.align]||"start"),a?(t=translate(x,y)+" "+rotate(a),(dx||dy)&&(t+=" "+translate(dx,dy))):t=translate(x+dx,y+dy),emit("transform",t)},bound:bound$5,draw:function(context,scene,bounds){visit(scene,item=>{var p,x,y,i,lh,tl,str,opacity=null==item.opacity?1:item.opacity;if(!(bounds&&!bounds.intersects(item.bounds)||0===opacity||item.fontSize<=0||null==item.text||0===item.text.length)){if(context.font=font(item),context.textAlign=item.align||"left",x=(p=anchorPoint(item)).x1,y=p.y1,item.angle&&(context.save(),context.translate(x,y),context.rotate(item.angle*DegToRad),x=y=0),x+=item.dx||0,y+=(item.dy||0)+offset$1(item),tl=textLines(item),blend(context,item),vegaUtil.isArray(tl))for(lh=lineHeight(item),i=0;i<tl.length;++i)str=textValue(item,tl[i]),item.fill&&fill(context,item,opacity)&&context.fillText(str,x,y),item.stroke&&stroke(context,item,opacity)&&context.strokeText(str,x,y),y+=lh;else str=textValue(item,tl),item.fill&&fill(context,item,opacity)&&context.fillText(str,x,y),item.stroke&&stroke(context,item,opacity)&&context.strokeText(str,x,y);item.angle&&context.restore()}})},pick:pick((function(context,item,x,y,gx,gy){if(item.fontSize<=0)return!1;if(!item.angle)return!0;var p=anchorPoint(item),ax=p.x1,ay=p.y1,b=bound$5(tempBounds,item,1),a=-item.angle*DegToRad,cos=Math.cos(a),sin=Math.sin(a),px=cos*gx-sin*gy+(ax-cos*ax+sin*ay),py=sin*gx+cos*gy+(ay-sin*ax-cos*ay);return b.contains(px,py)})),isect:function(item,box){const p=bound$5(tempBounds,item,2);return intersectBoxLine(box,p[0],p[1],p[2],p[3])||intersectBoxLine(box,p[0],p[1],p[4],p[5])||intersectBoxLine(box,p[4],p[5],p[6],p[7])||intersectBoxLine(box,p[2],p[3],p[6],p[7])}},trail$1=markMultiItemPath("trail",(function(context,items){return trailShape.context(context)(items)}),(function(a,p){for(var dx,dy,i=a.length;--i>=0;)if(!1!==a[i].defined&&(dx=a[i].x-p[0])*dx+(dy=a[i].y-p[1])*dy<(dx=a[i].size||1)*dx)return a[i];return null})),Marks={arc:arc$1,area:area$1,group:group,image:image,line:line$1,path:path$1,rect:rect,rule:rule,shape:shape$1,symbol:symbol$1,text:text,trail:trail$1};function boundItem(item,func,opt){var type=Marks[item.mark.marktype],bound=func||type.bound;return type.nested&&(item=item.mark),bound(item.bounds||(item.bounds=new Bounds),item,opt)}var DUMMY={mark:null};function boundMark(mark,bounds,opt){var i,n,item,b,type=Marks[mark.marktype],bound=type.bound,items=mark.items,hasItems=items&&items.length;if(type.nested)return hasItems?item=items[0]:(DUMMY.mark=mark,item=DUMMY),b=boundItem(item,bound,opt),bounds=bounds&&bounds.union(b)||b;if(bounds=bounds||mark.bounds&&mark.bounds.clear()||new Bounds,hasItems)for(i=0,n=items.length;i<n;++i)bounds.union(boundItem(items[i],bound,opt));return mark.bounds=bounds}const keys=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function sceneToJSON(scene,indent){return JSON.stringify(scene,keys,indent)}function sceneFromJSON(json){return function initialize(scene){var parent,i,n,type=scene.marktype,items=scene.items;if(items)for(i=0,n=items.length;i<n;++i)parent=type?"mark":"group",items[i][parent]=scene,items[i].zindex&&(items[i][parent].zdirty=!0),"group"===(type||parent)&&initialize(items[i]);return type&&boundMark(scene),scene}("string"==typeof json?JSON.parse(json):json)}function Scenegraph(scene){arguments.length?this.root=sceneFromJSON(scene):(this.root=createMark({marktype:"group",name:"root",role:"frame"}),this.root.items=[new GroupItem(this.root)])}function createMark(def,group){const mark={bounds:new Bounds,clip:!!def.clip,group:group,interactive:!1!==def.interactive,items:[],marktype:def.marktype,name:def.name||void 0,role:def.role||void 0,zindex:def.zindex||0};return null!=def.aria&&(mark.aria=def.aria),def.description&&(mark.description=def.description),mark}function domCreate(doc,tag,ns){return!doc&&"undefined"!=typeof document&&document.createElement&&(doc=document),doc?ns?doc.createElementNS(ns,tag):doc.createElement(tag):null}function domFind(el,tag){tag=tag.toLowerCase();for(var nodes=el.childNodes,i=0,n=nodes.length;i<n;++i)if(nodes[i].tagName.toLowerCase()===tag)return nodes[i]}function domChild(el,index,tag,ns){var b,a=el.childNodes[index];return a&&a.tagName.toLowerCase()===tag.toLowerCase()||(b=a||null,a=domCreate(el.ownerDocument,tag,ns),el.insertBefore(a,b)),a}function domClear(el,index){for(var nodes=el.childNodes,curr=nodes.length;curr>index;)el.removeChild(nodes[--curr]);return el}function cssClass(mark){return"mark-"+mark.marktype+(mark.role?" role-"+mark.role:"")+(mark.name?" "+mark.name:"")}function point(event,el){const rect=el.getBoundingClientRect();return[event.clientX-rect.left-(el.clientLeft||0),event.clientY-rect.top-(el.clientTop||0)]}function Handler(customLoader,customTooltip){this._active=null,this._handlers={},this._loader=customLoader||vegaLoader.loader(),this._tooltip=customTooltip||defaultTooltip}function defaultTooltip(handler,event,item,value){handler.element().setAttribute("title",value||"")}function Renderer(loader){this._el=null,this._bgcolor=null,this._loader=new ResourceLoader(loader)}Scenegraph.prototype={toJSON(indent){return sceneToJSON(this.root,indent||0)},mark(markdef,group,index){const mark=createMark(markdef,group=group||this.root.items[0]);return group.items[index]=mark,mark.zindex&&(mark.group.zdirty=!0),mark}},Handler.prototype={initialize(el,origin,obj){return this._el=el,this._obj=obj||null,this.origin(origin)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(origin){return arguments.length?(this._origin=origin||[0,0],this):this._origin.slice()},scene(scene){return arguments.length?(this._scene=scene,this):this._scene},on(){},off(){},_handlerIndex(h,type,handler){for(let i=h?h.length:0;--i>=0;)if(h[i].type===type&&(!handler||h[i].handler===handler))return i;return-1},handlers(type){const h=this._handlers,a=[];if(type)a.push(...h[this.eventName(type)]);else for(const k in h)a.push(...h[k]);return a},eventName(name){const i=name.indexOf(".");return i<0?name:name.slice(0,i)},handleHref(event,item,href){this._loader.sanitize(href,{context:"href"}).then(opt=>{const e=new MouseEvent(event.type,event),a=domCreate(null,"a");for(const name in opt)a.setAttribute(name,opt[name]);a.dispatchEvent(e)}).catch(()=>{})},handleTooltip(event,item,show){if(item&&null!=item.tooltip){item=function(item,event,el,origin){var mdef,p,mark=item&&item.mark;if(mark&&(mdef=Marks[mark.marktype]).tip){for((p=point(event,el))[0]-=origin[0],p[1]-=origin[1];item=item.mark.group;)p[0]-=item.x||0,p[1]-=item.y||0;item=mdef.tip(mark.items,p)}return item}(item,event,this.canvas(),this._origin);const value=show&&item&&item.tooltip||null;this._tooltip.call(this._obj,this,event,item,value)}},getItemBoundingClientRect(item){const el=this.canvas();if(!el)return;const rect=el.getBoundingClientRect(),origin=this._origin,bounds=item.bounds,width=bounds.width(),height=bounds.height();let x=bounds.x1+origin[0]+rect.left,y=bounds.y1+origin[1]+rect.top;for(;item.mark&&(item=item.mark.group);)x+=item.x||0,y+=item.y||0;return{x:x,y:y,width:width,height:height,left:x,top:y,right:x+width,bottom:y+height}}},Renderer.prototype={initialize(el,width,height,origin,scaleFactor){return this._el=el,this.resize(width,height,origin,scaleFactor)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(bgcolor){return 0===arguments.length?this._bgcolor:(this._bgcolor=bgcolor,this)},resize(width,height,origin,scaleFactor){return this._width=width,this._height=height,this._origin=origin||[0,0],this._scale=scaleFactor||1,this},dirty(){},render(scene){const r=this;return r._call=function(){r._render(scene)},r._call(),r._call=null,r},_render(){},renderAsync(scene){const r=this.render(scene);return this._ready?this._ready.then(()=>r):Promise.resolve(r)},_load(method,uri){var r=this,p=r._loader[method](uri);if(!r._ready){const call=r._call;r._ready=r._loader.ready().then(redraw=>{redraw&&call(),r._ready=null})}return p},sanitizeURL(uri){return this._load("sanitizeURL",uri)},loadImage(uri){return this._load("loadImage",uri)}};const DragLeaveEvent="dragleave",MouseDownEvent="mousedown",MouseMoveEvent="mousemove",MouseOutEvent="mouseout",ClickEvent="click",Events=["keydown","keypress","keyup","dragenter",DragLeaveEvent,"dragover",MouseDownEvent,"mouseup",MouseMoveEvent,MouseOutEvent,"mouseover",ClickEvent,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],TooltipShowEvent=MouseMoveEvent,TooltipHideEvent=MouseOutEvent,HrefEvent=ClickEvent;function CanvasHandler(loader,tooltip){Handler.call(this,loader,tooltip),this._down=null,this._touch=null,this._first=!0,this._events={}}function eventListenerCheck(handler,type){(type=>"touchstart"===type||"touchmove"===type||"touchend"===type?["touchstart","touchmove","touchend"]:[type])(type).forEach(_=>function(handler,type){const canvas=handler.canvas();canvas&&!handler._events[type]&&(handler._events[type]=1,canvas.addEventListener(type,handler[type]?evt=>handler[type](evt):evt=>handler.fire(type,evt)))}(handler,_))}function move(moveEvent,overEvent,outEvent){return function(evt){const a=this._active,p=this.pickEvent(evt);p===a||(a&&a.exit||this.fire(outEvent,evt),this._active=p,this.fire(overEvent,evt)),this.fire(moveEvent,evt)}}function inactive(type){return function(evt){this.fire(type,evt),this._active=null}}vegaUtil.inherits(CanvasHandler,Handler,{initialize(el,origin,obj){return this._canvas=el&&domFind(el,"canvas"),[ClickEvent,MouseDownEvent,MouseMoveEvent,MouseOutEvent,DragLeaveEvent].forEach(type=>eventListenerCheck(this,type)),Handler.prototype.initialize.call(this,el,origin,obj)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Events,DOMMouseScroll(evt){this.fire("mousewheel",evt)},mousemove:move(MouseMoveEvent,"mouseover",MouseOutEvent),dragover:move("dragover","dragenter",DragLeaveEvent),mouseout:inactive(MouseOutEvent),dragleave:inactive(DragLeaveEvent),mousedown(evt){this._down=this._active,this.fire(MouseDownEvent,evt)},click(evt){this._down===this._active&&(this.fire(ClickEvent,evt),this._down=null)},touchstart(evt){this._touch=this.pickEvent(evt.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",evt,!0)},touchmove(evt){this.fire("touchmove",evt,!0)},touchend(evt){this.fire("touchend",evt,!0),this._touch=null},fire(type,evt,touch){const a=touch?this._touch:this._active,h=this._handlers[type];if(evt.vegaType=type,type===HrefEvent&&a&&a.href?this.handleHref(evt,a,a.href):type!==TooltipShowEvent&&type!==TooltipHideEvent||this.handleTooltip(evt,a,type!==TooltipHideEvent),h)for(let i=0,len=h.length;i<len;++i)h[i].handler.call(this._obj,evt,a)},on(type,handler){const name=this.eventName(type),h=this._handlers;return this._handlerIndex(h[name],type,handler)<0&&(eventListenerCheck(this,type),(h[name]||(h[name]=[])).push({type:type,handler:handler})),this},off(type,handler){const name=this.eventName(type),h=this._handlers[name],i=this._handlerIndex(h,type,handler);return i>=0&&h.splice(i,1),this},pickEvent(evt){const p=point(evt,this._canvas),o=this._origin;return this.pick(this._scene,p[0],p[1],p[0]-o[0],p[1]-o[1])},pick(scene,x,y,gx,gy){const g=this.context();return Marks[scene.marktype].pick.call(this,g,scene,x,y,gx,gy)}});var pixelRatio="undefined"!=typeof window&&window.devicePixelRatio||1;function CanvasRenderer(loader){Renderer.call(this,loader),this._options={},this._redraw=!1,this._dirty=new Bounds,this._tempb=new Bounds}const base=Renderer.prototype;function SVGHandler(loader,tooltip){Handler.call(this,loader,tooltip);const h=this;h._hrefHandler=listener(h,(evt,item)=>{item&&item.href&&h.handleHref(evt,item,item.href)}),h._tooltipHandler=listener(h,(evt,item)=>{h.handleTooltip(evt,item,evt.type!==TooltipHideEvent)})}vegaUtil.inherits(CanvasRenderer,Renderer,{initialize(el,width,height,origin,scaleFactor,options){return this._options=options||{},this._canvas=this._options.externalContext?null:vegaCanvas.canvas(1,1,this._options.type),el&&this._canvas&&(domClear(el,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),base.initialize.call(this,el,width,height,origin,scaleFactor)},resize(width,height,origin,scaleFactor){if(base.resize.call(this,width,height,origin,scaleFactor),this._canvas)!function(canvas,width,height,origin,scaleFactor,opt){const inDOM="undefined"!=typeof HTMLElement&&canvas instanceof HTMLElement&&null!=canvas.parentNode,context=canvas.getContext("2d"),ratio=inDOM?pixelRatio:scaleFactor;canvas.width=width*ratio,canvas.height=height*ratio;for(const key in opt)context[key]=opt[key];inDOM&&1!==ratio&&(canvas.style.width=width+"px",canvas.style.height=height+"px"),context.pixelRatio=ratio,context.setTransform(ratio,0,0,ratio,ratio*origin[0],ratio*origin[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const ctx=this._options.externalContext;ctx||vegaUtil.error("CanvasRenderer is missing a valid canvas or context"),ctx.scale(this._scale,this._scale),ctx.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(item){const b=this._tempb.clear().union(item.bounds);let g=item.mark.group;for(;g;)b.translate(g.x||0,g.y||0),g=g.mark.group;this._dirty.union(b)},_render(scene){const g=this.context(),o=this._origin,w=this._width,h=this._height,db=this._dirty,vb=(origin=o,width=w,height=h,(new Bounds).set(0,0,width,height).translate(-origin[0],-origin[1]));var origin,width,height;g.save();const b=this._redraw||db.empty()?(this._redraw=!1,vb.expand(1)):function(g,b,origin){return b.expand(1).round(),g.pixelRatio%1&&b.scale(g.pixelRatio).round().scale(1/g.pixelRatio),b.translate(-origin[0]%1,-origin[1]%1),g.beginPath(),g.rect(b.x1,b.y1,b.width(),b.height()),g.clip(),b}(g,vb.intersect(db),o);return this.clear(-o[0],-o[1],w,h),this.draw(g,scene,b),g.restore(),db.clear(),this},draw(ctx,scene,bounds){const mark=Marks[scene.marktype];scene.clip&&function(context,scene){var clip=scene.clip;context.save(),vegaUtil.isFunction(clip)?(context.beginPath(),clip(context),context.clip()):clipGroup(context,scene.group)}(ctx,scene),mark.draw.call(this,ctx,scene,bounds),scene.clip&&ctx.restore()},clear(x,y,w,h){const opt=this._options,g=this.context();"pdf"===opt.type||opt.externalContext||g.clearRect(x,y,w,h),null!=this._bgcolor&&(g.fillStyle=this._bgcolor,g.fillRect(x,y,w,h))}});const listener=(context,handler)=>evt=>{let item=evt.target.__data__;item=Array.isArray(item)?item[0]:item,evt.vegaType=evt.type,handler.call(context._obj,evt,item)};vegaUtil.inherits(SVGHandler,Handler,{initialize(el,origin,obj){let svg=this._svg;return svg&&(svg.removeEventListener(HrefEvent,this._hrefHandler),svg.removeEventListener(TooltipShowEvent,this._tooltipHandler),svg.removeEventListener(TooltipHideEvent,this._tooltipHandler)),this._svg=svg=el&&domFind(el,"svg"),svg&&(svg.addEventListener(HrefEvent,this._hrefHandler),svg.addEventListener(TooltipShowEvent,this._tooltipHandler),svg.addEventListener(TooltipHideEvent,this._tooltipHandler)),Handler.prototype.initialize.call(this,el,origin,obj)},canvas(){return this._svg},on(type,handler){const name=this.eventName(type),h=this._handlers;if(this._handlerIndex(h[name],type,handler)<0){const x={type:type,handler:handler,listener:listener(this,handler)};(h[name]||(h[name]=[])).push(x),this._svg&&this._svg.addEventListener(name,x.listener)}return this},off(type,handler){const name=this.eventName(type),h=this._handlers[name],i=this._handlerIndex(h,type,handler);return i>=0&&(this._svg&&this._svg.removeEventListener(name,h[i].listener),h.splice(i,1)),this}});const bundle=(role,roledesc,label)=>({role:role,"aria-roledescription":roledesc,"aria-label":label||void 0}),AriaIgnore=vegaUtil.toSet(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),AriaGuides={axis:{desc:"axis",caption:function(item){const datum=item.datum,orient=item.orient,title=datum.title?extractTitle(item):null,ctx=item.context,scale=ctx.scales[datum.scale].value,locale=ctx.dataflow.locale(),type=scale.type;return("left"===orient||"right"===orient?"Y":"X")+"-axis"+(title?` titled '${title}'`:"")+` for a ${vegaScale.isDiscrete(type)?"discrete":type} scale with `+vegaScale.domainCaption(locale,scale,item)}},legend:{desc:"legend",caption:function(item){const datum=item.datum,title=datum.title?extractTitle(item):null,type=((datum.type||"")+" legend").trim(),scales=datum.scales,props=Object.keys(scales),ctx=item.context,scale=ctx.scales[scales[props[0]]].value,locale=ctx.dataflow.locale();return((s=type).length?s[0].toUpperCase()+s.slice(1):s)+(title?` titled '${title}'`:"")+" for "+function(props){return(props=props.map(p=>p+("fill"===p||"stroke"===p?" color":""))).length<2?props[0]:props.slice(0,-1).join(", ")+" and "+vegaUtil.peek(props)}(props)+" with "+vegaScale.domainCaption(locale,scale,item);var s}},"title-text":{desc:"title",caption:item=>`Title text '${titleCaption(item)}'`},"title-subtitle":{desc:"subtitle",caption:item=>`Subtitle text '${titleCaption(item)}'`}},AriaEncode={ariaRole:"role",ariaRoleDescription:"aria-roledescription",description:"aria-label"};function ariaItemAttributes(emit,item){const hide=!1===item.aria;if(emit("aria-hidden",hide||void 0),hide||null==item.description)for(const prop in AriaEncode)emit(AriaEncode[prop],void 0);else{const type=item.mark.marktype;emit("aria-label",item.description),emit("role",item.ariaRole||("group"===type?"graphics-object":"graphics-symbol")),emit("aria-roledescription",item.ariaRoleDescription||type+" mark")}}function ariaMarkAttributes(mark){return!1===mark.aria?{"aria-hidden":!0}:AriaIgnore[mark.role]?null:AriaGuides[mark.role]?function(mark,opt){try{const item=mark.items[0],caption=opt.caption||(()=>"");return bundle(opt.role||"graphics-symbol",opt.desc,item.description||caption(item))}catch(err){return null}}(mark,AriaGuides[mark.role]):function(mark){const type=mark.marktype,recurse="group"===type||"text"===type||mark.items.some(_=>null!=_.description&&!1!==_.aria);return bundle(recurse?"graphics-object":"graphics-symbol",type+" mark container",mark.description)}(mark)}function titleCaption(item){return vegaUtil.array(item.text).join(" ")}function extractTitle(item){try{return vegaUtil.array(vegaUtil.peek(item.items).items[0].text).join(" ")}catch(err){return null}}const innerText=val=>(val+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function markup(){let buf="",outer="",inner="";const stack=[],clear=()=>outer=inner="",attr=(name,value)=>{var val;return null!=value&&(outer+=` ${name}="${val=value,innerText(val).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),m},m={open(tag,...attrs){(tag=>{outer&&(buf+=`${outer}>${inner}`,clear()),stack.push(tag)})(tag),outer="<"+tag;for(const set of attrs)for(const key in set)attr(key,set[key]);return m},close(){const tag=stack.pop();return buf+=outer?outer+(inner?`>${inner}</${tag}>`:"/>"):`</${tag}>`,clear(),m},attr:attr,text:t=>(inner+=innerText(t),m),toString:()=>buf};return m}const serializeXML=node=>function _serialize(m,node){if(m.open(node.tagName),node.hasAttributes()){const attrs=node.attributes,n=attrs.length;for(let i=0;i<n;++i)m.attr(attrs[i].name,attrs[i].value)}if(node.hasChildNodes()){const children=node.childNodes,n=children.length;for(let i=0;i<n;i++){const child=children[i];3===child.nodeType?m.text(child.nodeValue):_serialize(m,child)}}return m.close()}(markup(),node)+"",styles={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},rootAttributes={fill:"none","stroke-miterlimit":10},xmlns="http://www.w3.org/2000/xmlns/",svgns=metadata.xmlns;function SVGRenderer(loader){Renderer.call(this,loader),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const base$1=Renderer.prototype;function dirtyParents(item,id){for(;item&&item.dirty!==id;item=item.mark.group){if(item.dirty=id,!item.mark||item.mark.dirty===id)return;item.mark.dirty=id}}function updateGradient(el,grad,index){let i,n,stop;if("radial"===grad.gradient){let pt=domChild(el,index++,"pattern",svgns);setAttributes(pt,{id:"p_"+grad.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),pt=domChild(pt,0,"rect",svgns),setAttributes(pt,{width:1,height:1,fill:`url(${href()}#${grad.id})`}),setAttributes(el=domChild(el,index++,"radialGradient",svgns),{id:grad.id,fx:grad.x1,fy:grad.y1,fr:grad.r1,cx:grad.x2,cy:grad.y2,r:grad.r2})}else setAttributes(el=domChild(el,index++,"linearGradient",svgns),{id:grad.id,x1:grad.x1,x2:grad.x2,y1:grad.y1,y2:grad.y2});for(i=0,n=grad.stops.length;i<n;++i)stop=domChild(el,i,"stop",svgns),stop.setAttribute("offset",grad.stops[i].offset),stop.setAttribute("stop-color",grad.stops[i].color);return domClear(el,i),index}function updateClipping(el,clip,index){let mask;return(el=domChild(el,index,"clipPath",svgns)).setAttribute("id",clip.id),clip.path?(mask=domChild(el,0,"path",svgns),mask.setAttribute("d",clip.path)):(mask=domChild(el,0,"rect",svgns),setAttributes(mask,{x:0,y:0,width:clip.width,height:clip.height})),domClear(el,1),index+1}function bind(item,el,sibling,tag,svg){let doc,node=item._svg;if(!node&&(doc=el.ownerDocument,node=domCreate(doc,tag,svgns),item._svg=node,item.mark&&(node.__data__=item,node.__values__={fill:"default"},"g"===tag))){const bg=domCreate(doc,"path",svgns);node.appendChild(bg),bg.__data__=item;const cg=domCreate(doc,"g",svgns);node.appendChild(cg),cg.__data__=item;const fg=domCreate(doc,"path",svgns);node.appendChild(fg),fg.__data__=item,fg.__values__={fill:"default"}}return(node.ownerSVGElement!==svg||function(node,sibling){return node.parentNode&&node.parentNode.childNodes.length>1&&node.previousSibling!=sibling}(node,sibling))&&el.insertBefore(node,sibling?sibling.nextSibling:el.firstChild),node}vegaUtil.inherits(SVGRenderer,Renderer,{initialize(el,width,height,origin,scaleFactor){return this._defs={},this._clearDefs(),el&&(this._svg=domChild(el,0,"svg",svgns),this._svg.setAttributeNS(xmlns,"xmlns",svgns),this._svg.setAttributeNS(xmlns,"xmlns:xlink",metadata["xmlns:xlink"]),this._svg.setAttribute("version",metadata.version),this._svg.setAttribute("class","marks"),domClear(el,1),this._root=domChild(this._svg,0,"g",svgns),setAttributes(this._root,rootAttributes),domClear(this._svg,1)),this.background(this._bgcolor),base$1.initialize.call(this,el,width,height,origin,scaleFactor)},background(bgcolor){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",bgcolor),base$1.background.apply(this,arguments)},resize(width,height,origin,scaleFactor){return base$1.resize.call(this,width,height,origin,scaleFactor),this._svg&&(setAttributes(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const svg=this._svg,bg=this._bgcolor;if(!svg)return null;let node;bg&&(svg.removeAttribute("style"),node=domChild(svg,0,"rect",svgns),setAttributes(node,{width:this._width,height:this._height,fill:bg}));const text=serializeXML(svg);return bg&&(svg.removeChild(node),this._svg.style.setProperty("background-color",bg)),text},_render(scene){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,scene),domClear(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(item){item.dirty!==this._dirtyID&&(item.dirty=this._dirtyID,this._dirty.push(item))},isDirty(item){return this._dirtyAll||!item._svg||item.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const items=this._dirty;if(!items.length||!this._dirtyID)return!0;const id=++this._dirtyID;let item,mark,type,mdef,i,n,o;for(i=0,n=items.length;i<n;++i)item=items[i],mark=item.mark,mark.marktype!==type&&(type=mark.marktype,mdef=Marks[type]),mark.zdirty&&mark.dirty!==id&&(this._dirtyAll=!1,dirtyParents(item,id),mark.items.forEach(i=>{i.dirty=id})),mark.zdirty||(item.exit?(mdef.nested&&mark.items.length?(o=mark.items[0],o._svg&&this._update(mdef,o._svg,o)):item._svg&&(o=item._svg.parentNode,o&&o.removeChild(item._svg)),item._svg=null):(item=mdef.nested?mark.items[0]:item,item._update!==id&&(item._svg&&item._svg.ownerSVGElement?this._update(mdef,item._svg,item):(this._dirtyAll=!1,dirtyParents(item,id)),item._update=id)));return!this._dirtyAll},mark(el,scene,prev){if(!this.isDirty(scene))return scene._svg;const svg=this._svg,mdef=Marks[scene.marktype],events=!1===scene.interactive?"none":null,isGroup="g"===mdef.tag;let sibling=null,i=0;const parent=bind(scene,el,prev,"g",svg);parent.setAttribute("class",cssClass(scene));const aria=ariaMarkAttributes(scene);for(const key in aria)setAttribute(parent,key,aria[key]);isGroup||setAttribute(parent,"pointer-events",events),setAttribute(parent,"clip-path",scene.clip?clip(this,scene,scene.group):null);const process=item=>{const dirty=this.isDirty(item),node=bind(item,parent,sibling,mdef.tag,svg);dirty&&(this._update(mdef,node,item),isGroup&&function(renderer,el,group){el=el.lastChild.previousSibling;let prev,idx=0;visit(group,item=>{prev=renderer.mark(el,item,prev),++idx}),domClear(el,1+idx)}(this,node,item)),sibling=node,++i};return mdef.nested?scene.items.length&&process(scene.items[0]):visit(scene,process),domClear(parent,i),parent},_update(mdef,el,item){element=el,values=el.__values__,ariaItemAttributes(emit,item),mdef.attr(emit,item,this);const extra=mark_extras[mdef.type];extra&&extra.call(this,mdef,el,item),element&&this.style(element,item)},style(el,item){if(null!=item)for(const prop in styles){let value="font"===prop?fontFamily(item):item[prop];if(value===values[prop])continue;const name=styles[prop];null==value?el.removeAttribute(name):(isGradient(value)&&(value=gradientRef(value,this._defs.gradient,href())),el.setAttribute(name,value+"")),values[prop]=value}},defs(){const svg=this._svg,defs=this._defs;let el=defs.el,index=0;for(const id in defs.gradient)el||(defs.el=el=domChild(svg,1,"defs",svgns)),index=updateGradient(el,defs.gradient[id],index);for(const id in defs.clipping)el||(defs.el=el=domChild(svg,1,"defs",svgns)),index=updateClipping(el,defs.clipping[id],index);el&&(0===index?(svg.removeChild(el),defs.el=null):domClear(el,index))},_clearDefs(){const def=this._defs;def.gradient={},def.clipping={}}});let element=null,values=null;const mark_extras={group(mdef,el,item){const fg=element=el.childNodes[2];values=fg.__values__,mdef.foreground(emit,item,this),values=el.__values__,element=el.childNodes[1],mdef.content(emit,item,this);const bg=element=el.childNodes[0];mdef.background(emit,item,this);const value=!1===item.mark.interactive?"none":null;if(value!==values.events&&(setAttribute(fg,"pointer-events",value),setAttribute(bg,"pointer-events",value),values.events=value),item.strokeForeground&&item.stroke){const fill=item.fill;setAttribute(fg,"display",null),this.style(bg,item),setAttribute(bg,"stroke",null),fill&&(item.fill=null),values=fg.__values__,this.style(fg,item),fill&&(item.fill=fill),element=null}else setAttribute(fg,"display","none")},image(mdef,el,item){!1===item.smooth?(setStyle(el,"image-rendering","optimizeSpeed"),setStyle(el,"image-rendering","pixelated")):setStyle(el,"image-rendering",null)},text(mdef,el,item){const tl=textLines(item);let key,value,doc,lh;vegaUtil.isArray(tl)?(value=tl.map(_=>textValue(item,_)),key=value.join("\n"),key!==values.text&&(domClear(el,0),doc=el.ownerDocument,lh=lineHeight(item),value.forEach((t,i)=>{const ts=domCreate(doc,"tspan",svgns);ts.__data__=item,ts.textContent=t,i&&(ts.setAttribute("x",0),ts.setAttribute("dy",lh)),el.appendChild(ts)}),values.text=key)):(value=textValue(item,tl),value!==values.text&&(el.textContent=value,values.text=value)),setAttribute(el,"font-family",fontFamily(item)),setAttribute(el,"font-size",fontSize(item)+"px"),setAttribute(el,"font-style",item.fontStyle),setAttribute(el,"font-variant",item.fontVariant),setAttribute(el,"font-weight",item.fontWeight)}};function emit(name,value,ns){value!==values[name]&&(ns?function(el,name,value,ns){null!=value?el.setAttributeNS(ns,name,value):el.removeAttributeNS(ns,name)}(element,name,value,ns):setAttribute(element,name,value),values[name]=value)}function setStyle(el,name,value){value!==values[name]&&(null==value?el.style.removeProperty(name):el.style.setProperty(name,value+""),values[name]=value)}function setAttributes(el,attrs){for(const key in attrs)setAttribute(el,key,attrs[key])}function setAttribute(el,name,value){null!=value?el.setAttribute(name,value):el.removeAttribute(name)}function href(){let loc;return"undefined"==typeof window?"":(loc=window.location).hash?loc.href.slice(0,-loc.hash.length):loc.href}function SVGStringRenderer(loader){Renderer.call(this,loader),this._text=null,this._defs={gradient:{},clipping:{}}}vegaUtil.inherits(SVGStringRenderer,Renderer,{svg(){return this._text},_render(scene){const m=markup();m.open("svg",vegaUtil.extend({},metadata,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const bg=this._bgcolor;return bg&&"transparent"!==bg&&"none"!==bg&&m.open("rect",{width:this._width,height:this._height,fill:bg}).close(),m.open("g",rootAttributes,{transform:"translate("+this._origin+")"}),this.mark(m,scene),m.close(),this.defs(m),this._text=m.close()+"",this},mark(m,scene){const mdef=Marks[scene.marktype],tag=mdef.tag,attrList=[ariaItemAttributes,mdef.attr];m.open("g",{class:cssClass(scene),"clip-path":scene.clip?clip(this,scene,scene.group):null},ariaMarkAttributes(scene),{"pointer-events":"g"!==tag&&!1===scene.interactive?"none":null});const process=item=>{const href=this.href(item);if(href&&m.open("a",href),m.open(tag,this.attr(scene,item,attrList,"g"!==tag?tag:null)),"text"===tag){const tl=textLines(item);if(vegaUtil.isArray(tl)){const attrs={x:0,dy:lineHeight(item)};for(let i=0;i<tl.length;++i)m.open("tspan",i?attrs:null).text(textValue(item,tl[i])).close()}else m.text(textValue(item,tl))}else if("g"===tag){const fore=item.strokeForeground,fill=item.fill,stroke=item.stroke;fore&&stroke&&(item.stroke=null),m.open("path",this.attr(scene,item,mdef.background,"bgrect")).close(),m.open("g",this.attr(scene,item,mdef.content)),visit(item,scene=>this.mark(m,scene)),m.close(),fore&&stroke?(fill&&(item.fill=null),item.stroke=stroke,m.open("path",this.attr(scene,item,mdef.foreground,"bgrect")).close(),fill&&(item.fill=fill)):m.open("path",this.attr(scene,item,mdef.foreground,"bgfore")).close()}m.close(),href&&m.close()};return mdef.nested?scene.items&&scene.items.length&&process(scene.items[0]):visit(scene,process),m.close()},href(item){const href=item.href;let attr;if(href){if(attr=this._hrefs&&this._hrefs[href])return attr;this.sanitizeURL(href).then(attr=>{attr["xlink:href"]=attr.href,attr.href=null,(this._hrefs||(this._hrefs={}))[href]=attr})}return null},attr(scene,item,attrs,tag){const object={},emit=(name,value,ns,prefixed)=>{object[prefixed||name]=value};return Array.isArray(attrs)?attrs.forEach(fn=>fn(emit,item,this)):attrs(emit,item,this),tag&&function(s,item,scene,tag,defs){if(null==item)return s;if("bgrect"===tag&&!1===scene.interactive&&(s["pointer-events"]="none"),"bgfore"===tag&&(!1===scene.interactive&&(s["pointer-events"]="none"),s.display="none",null!==item.fill))return s;"image"===tag&&!1===item.smooth&&(s.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===tag&&(s["font-family"]=fontFamily(item),s["font-size"]=fontSize(item)+"px",s["font-style"]=item.fontStyle,s["font-variant"]=item.fontVariant,s["font-weight"]=item.fontWeight);for(const prop in styles){let value=item[prop];const name=styles[prop];("transparent"!==value||"fill"!==name&&"stroke"!==name)&&null!=value&&(isGradient(value)&&(value=gradientRef(value,defs.gradient,"")),s[name]=value)}}(object,item,scene,tag,this._defs),object},defs(m){const gradient=this._defs.gradient,clipping=this._defs.clipping;if(0!==Object.keys(gradient).length+Object.keys(clipping).length){m.open("defs");for(const id in gradient){const def=gradient[id],stops=def.stops;"radial"===def.gradient?(m.open("pattern",{id:"p_"+id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),m.open("rect",{width:"1",height:"1",fill:"url(#"+id+")"}).close(),m.close(),m.open("radialGradient",{id:id,fx:def.x1,fy:def.y1,fr:def.r1,cx:def.x2,cy:def.y2,r:def.r2})):m.open("linearGradient",{id:id,x1:def.x1,x2:def.x2,y1:def.y1,y2:def.y2});for(let i=0;i<stops.length;++i)m.open("stop",{offset:stops[i].offset,"stop-color":stops[i].color}).close();m.close()}for(const id in clipping){const def=clipping[id];m.open("clipPath",{id:id}),def.path?m.open("path",{d:def.path}).close():m.open("rect",{x:0,y:0,width:def.width,height:def.height}).close(),m.close()}m.close()}}});const RenderType={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},modules={};function intersectMark(mark,box,filter,hits){if(function(mark,box,filter){return mark.bounds&&box.intersects(mark.bounds)&&("group"===mark.marktype||!1!==mark.interactive&&(!filter||filter(mark)))}(mark,box,filter)){const items=mark.items,type=mark.marktype,n=items.length;let i=0;if("group"===type)for(;i<n;++i)intersectGroup(items[i],box,filter,hits);else for(const test=Marks[type].isect;i<n;++i){const item=items[i];intersectItem(item,box,test)&&hits.push(item)}}return hits}function intersectGroup(group,box,filter,hits){filter&&filter(group.mark)&&intersectItem(group,box,Marks.group.isect)&&hits.push(group);const marks=group.items,n=marks&&marks.length;if(n){const x=group.x||0,y=group.y||0;box.translate(-x,-y);for(let i=0;i<n;++i)intersectMark(marks[i],box,filter,hits);box.translate(x,y)}return hits}function intersectItem(item,box,test){const bounds=item.bounds;return box.encloses(bounds)||box.intersects(bounds)&&test(item,box)}modules.canvas=modules.png={renderer:CanvasRenderer,headless:CanvasRenderer,handler:CanvasHandler},modules.svg={renderer:SVGRenderer,headless:SVGStringRenderer,handler:SVGHandler},modules.none={};const clipBounds=new Bounds;function sceneEqual(a,b,key){return a===b||("path"===key?pathEqual(a,b):a instanceof Date&&b instanceof Date?+a==+b:vegaUtil.isNumber(a)&&vegaUtil.isNumber(b)?Math.abs(a-b)<=1e-9:a&&b&&(vegaUtil.isObject(a)||vegaUtil.isObject(b))?function(a,b){var key,i,ka=Object.keys(a),kb=Object.keys(b);if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!sceneEqual(a[key],b[key],key))return!1;return typeof a==typeof b}(a,b):a==b)}function pathEqual(a,b){return sceneEqual(pathParse(a),pathParse(b))}exports.Bounds=Bounds,exports.CanvasHandler=CanvasHandler,exports.CanvasRenderer=CanvasRenderer,exports.Gradient=function(p0,p1){var gradient,stops=[];return gradient={gradient:"linear",x1:p0?p0[0]:0,y1:p0?p0[1]:0,x2:p1?p1[0]:1,y2:p1?p1[1]:0,stops:stops,stop:function(offset,color){return stops.push({offset:offset,color:color}),gradient}}},exports.GroupItem=GroupItem,exports.Handler=Handler,exports.Item=Item,exports.Marks=Marks,exports.RenderType=RenderType,exports.Renderer=Renderer,exports.ResourceLoader=ResourceLoader,exports.SVGHandler=SVGHandler,exports.SVGRenderer=SVGRenderer,exports.SVGStringRenderer=SVGStringRenderer,exports.Scenegraph=Scenegraph,exports.boundClip=function(mark){const clip=mark.clip;if(vegaUtil.isFunction(clip))clip(boundContext(clipBounds.clear()));else{if(!clip)return;clipBounds.set(0,0,mark.group.width,mark.group.height)}mark.bounds.intersect(clipBounds)},exports.boundContext=boundContext,exports.boundItem=boundItem,exports.boundMark=boundMark,exports.boundStroke=boundStroke,exports.domChild=domChild,exports.domClear=domClear,exports.domCreate=domCreate,exports.domFind=domFind,exports.font=font,exports.fontFamily=fontFamily,exports.fontSize=fontSize,exports.intersect=function(scene,bounds,filter){const hits=[],box=(new Bounds).union(bounds),type=scene.marktype;return type?intersectMark(scene,box,filter,hits):"group"===type?intersectGroup(scene,box,filter,hits):vegaUtil.error("Intersect scene must be mark node or group item.")},exports.intersectBoxLine=intersectBoxLine,exports.intersectPath=intersectPath,exports.intersectPoint=intersectPoint,exports.intersectRule=intersectRule,exports.lineHeight=lineHeight,exports.markup=markup,exports.multiLineOffset=function(item){const tl=textLines(item);return(vegaUtil.isArray(tl)?tl.length-1:0)*lineHeight(item)},exports.pathCurves=curves,exports.pathEqual=pathEqual,exports.pathParse=pathParse,exports.pathRectangle=vg_rect,exports.pathRender=pathRender,exports.pathSymbols=symbols,exports.pathTrail=vg_trail,exports.point=point,exports.renderModule=function(name,_){return name=String(name||"").toLowerCase(),arguments.length>1?(modules[name]=_,this):modules[name]},exports.resetSVGClipId=resetSVGClipId,exports.resetSVGDefIds=function(){resetSVGClipId(),gradient_id=0},exports.sceneEqual=sceneEqual,exports.sceneFromJSON=sceneFromJSON,exports.scenePickVisit=pickVisit,exports.sceneToJSON=sceneToJSON,exports.sceneVisit=visit,exports.sceneZOrder=zorder,exports.serializeXML=serializeXML,exports.textMetrics=textMetrics,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(99),__webpack_require__(74),__webpack_require__(58),__webpack_require__(59),__webpack_require__(45))},function(module,exports,__webpack_require__){!function(exports,d3Array,d3Format,vegaTime,vegaUtil,d3TimeFormat){"use strict";function memoize(method){const cache={};return spec=>cache[spec]||(cache[spec]=method(spec))}function numberLocale(locale){const format=memoize(locale.format),formatPrefix=locale.formatPrefix;return{format:format,formatPrefix:formatPrefix,formatFloat(spec){const s=d3Format.formatSpecifier(spec||",");if(null==s.precision){switch(s.precision=12,s.type){case"%":s.precision-=2;break;case"e":s.precision-=1}return numberFormat=format(s),decimalChar=format(".1f")(1)[1],x=>{const str=numberFormat(x),dec=str.indexOf(decimalChar);if(dec<0)return str;let idx=function(str,dec){let c,i=str.lastIndexOf("e");if(i>0)return i;for(i=str.length;--i>dec;)if(c=str.charCodeAt(i),c>=48&&c<=57)return i+1}(str,dec);const end=idx<str.length?str.slice(idx):"";for(;--idx>dec;)if("0"!==str[idx]){++idx;break}return str.slice(0,idx)+end}}return format(s);var numberFormat,decimalChar},formatSpan(start,stop,count,specifier){specifier=d3Format.formatSpecifier(null==specifier?",f":specifier);const step=d3Array.tickStep(start,stop,count),value=Math.max(Math.abs(start),Math.abs(stop));let precision;if(null==specifier.precision)switch(specifier.type){case"s":return isNaN(precision=d3Format.precisionPrefix(step,value))||(specifier.precision=precision),formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":isNaN(precision=d3Format.precisionRound(step,value))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":isNaN(precision=d3Format.precisionFixed(step))||(specifier.precision=precision-2*("%"===specifier.type))}return format(specifier)}}}let defaultNumberLocale,defaultTimeLocale;function resetNumberFormatDefaultLocale(){return defaultNumberLocale=numberLocale({format:d3Format.format,formatPrefix:d3Format.formatPrefix})}function numberFormatLocale(definition){return numberLocale(d3Format.formatLocale(definition))}function numberFormatDefaultLocale(definition){return arguments.length?defaultNumberLocale=numberFormatLocale(definition):defaultNumberLocale}function timeMultiFormat(format,interval,spec){spec=spec||{},vegaUtil.isObject(spec)||vegaUtil.error("Invalid time multi-format specifier: "+spec);const second=interval(vegaTime.SECONDS),minute=interval(vegaTime.MINUTES),hour=interval(vegaTime.HOURS),day=interval(vegaTime.DATE),week=interval(vegaTime.WEEK),month=interval(vegaTime.MONTH),quarter=interval(vegaTime.QUARTER),year=interval(vegaTime.YEAR),L=format(spec[vegaTime.MILLISECONDS]||".%L"),S=format(spec[vegaTime.SECONDS]||":%S"),M=format(spec[vegaTime.MINUTES]||"%I:%M"),H=format(spec[vegaTime.HOURS]||"%I %p"),d=format(spec[vegaTime.DATE]||spec[vegaTime.DAY]||"%a %d"),w=format(spec[vegaTime.WEEK]||"%b %d"),m=format(spec[vegaTime.MONTH]||"%B"),q=format(spec[vegaTime.QUARTER]||"%B"),y=format(spec[vegaTime.YEAR]||"%Y");return date=>(second(date)<date?L:minute(date)<date?S:hour(date)<date?M:day(date)<date?H:month(date)<date?week(date)<date?d:w:year(date)<date?quarter(date)<date?m:q:y)(date)}function timeLocale(locale){const timeFormat=memoize(locale.format),utcFormat=memoize(locale.utcFormat);return{timeFormat:spec=>vegaUtil.isString(spec)?timeFormat(spec):timeMultiFormat(timeFormat,vegaTime.timeInterval,spec),utcFormat:spec=>vegaUtil.isString(spec)?utcFormat(spec):timeMultiFormat(utcFormat,vegaTime.utcInterval,spec),timeParse:memoize(locale.parse),utcParse:memoize(locale.utcParse)}}function resetTimeFormatDefaultLocale(){return defaultTimeLocale=timeLocale({format:d3TimeFormat.timeFormat,parse:d3TimeFormat.timeParse,utcFormat:d3TimeFormat.utcFormat,utcParse:d3TimeFormat.utcParse})}function timeFormatLocale(definition){return timeLocale(d3TimeFormat.timeFormatLocale(definition))}function timeFormatDefaultLocale(definition){return arguments.length?defaultTimeLocale=timeFormatLocale(definition):defaultTimeLocale}resetNumberFormatDefaultLocale(),resetTimeFormatDefaultLocale();const createLocale=(number,time)=>vegaUtil.extend({},number,time);function defaultLocale(numberSpec,timeSpec){const args=arguments.length;return args&&2!==args&&vegaUtil.error("defaultLocale expects either zero or two arguments."),args?createLocale(numberFormatDefaultLocale(numberSpec),timeFormatDefaultLocale(timeSpec)):createLocale(numberFormatDefaultLocale(),timeFormatDefaultLocale())}exports.defaultLocale=defaultLocale,exports.locale=function(numberSpec,timeSpec){const number=numberSpec?numberFormatLocale(numberSpec):numberFormatDefaultLocale(),time=timeSpec?timeFormatLocale(timeSpec):timeFormatDefaultLocale();return createLocale(number,time)},exports.numberFormatDefaultLocale=numberFormatDefaultLocale,exports.numberFormatLocale=numberFormatLocale,exports.resetDefaultLocale=function(){return resetNumberFormatDefaultLocale(),resetTimeFormatDefaultLocale(),defaultLocale()},exports.resetNumberFormatDefaultLocale=resetNumberFormatDefaultLocale,exports.resetTimeFormatDefaultLocale=resetTimeFormatDefaultLocale,exports.timeFormatDefaultLocale=timeFormatDefaultLocale,exports.timeFormatLocale=timeFormatLocale,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(90),__webpack_require__(91),__webpack_require__(49),__webpack_require__(37),__webpack_require__(73))},function(module,exports,__webpack_require__){!function(exports,d3Array){"use strict";var epsilon=1e-6,pi=Math.PI,halfPi=pi/2,quarterPi=pi/4,tau=2*pi,degrees=180/pi,radians=pi/180,abs=Math.abs,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,ceil=Math.ceil,exp=Math.exp,hypot=Math.hypot,log=Math.log,pow=Math.pow,sin=Math.sin,sign=Math.sign||function(x){return x>0?1:x<0?-1:0},sqrt=Math.sqrt,tan=Math.tan;function acos(x){return x>1?0:x<-1?pi:Math.acos(x)}function asin(x){return x>1?halfPi:x<-1?-halfPi:Math.asin(x)}function haversin(x){return(x=sin(x/2))*x}function noop(){}function streamGeometry(geometry,stream){geometry&&streamGeometryType.hasOwnProperty(geometry.type)&&streamGeometryType[geometry.type](geometry,stream)}var streamObjectType={Feature:function(object,stream){streamGeometry(object.geometry,stream)},FeatureCollection:function(object,stream){for(var features=object.features,i=-1,n=features.length;++i<n;)streamGeometry(features[i].geometry,stream)}},streamGeometryType={Sphere:function(object,stream){stream.sphere()},Point:function(object,stream){object=object.coordinates,stream.point(object[0],object[1],object[2])},MultiPoint:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],stream.point(object[0],object[1],object[2])},LineString:function(object,stream){streamLine(object.coordinates,stream,0)},MultiLineString:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)streamLine(coordinates[i],stream,0)},Polygon:function(object,stream){streamPolygon(object.coordinates,stream)},MultiPolygon:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object,stream){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var coordinate,i=-1,n=coordinates.length-closed;for(stream.lineStart();++i<n;)coordinate=coordinates[i],stream.point(coordinate[0],coordinate[1],coordinate[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;for(stream.polygonStart();++i<n;)streamLine(coordinates[i],stream,1);stream.polygonEnd()}function geoStream(object,stream){object&&streamObjectType.hasOwnProperty(object.type)?streamObjectType[object.type](object,stream):streamGeometry(object,stream)}var lambda00,phi00,lambda0,cosPhi0,sinPhi0,lambda0$1,phi0,lambda1,phi1,lambda2,lambda00$1,phi00$1,p0,deltaSum,ranges,range,areaRingSum=new d3Array.Adder,areaSum=new d3Array.Adder,areaStream={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaRingSum=new d3Array.Adder,areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){var areaRing=+areaRingSum;areaSum.add(areaRing<0?tau+areaRing:areaRing),this.lineStart=this.lineEnd=this.point=noop},sphere:function(){areaSum.add(tau)}};function areaRingStart(){areaStream.point=areaPointFirst}function areaRingEnd(){areaPoint(lambda00,phi00)}function areaPointFirst(lambda,phi){areaStream.point=areaPoint,lambda00=lambda,phi00=phi,lambda0=lambda*=radians,cosPhi0=cos(phi=(phi*=radians)/2+quarterPi),sinPhi0=sin(phi)}function areaPoint(lambda,phi){var dLambda=(lambda*=radians)-lambda0,sdLambda=dLambda>=0?1:-1,adLambda=sdLambda*dLambda,cosPhi=cos(phi=(phi*=radians)/2+quarterPi),sinPhi=sin(phi),k=sinPhi0*sinPhi,u=cosPhi0*cosPhi+k*cos(adLambda),v=k*sdLambda*sin(adLambda);areaRingSum.add(atan2(v,u)),lambda0=lambda,cosPhi0=cosPhi,sinPhi0=sinPhi}function spherical(cartesian){return[atan2(cartesian[1],cartesian[0]),asin(cartesian[2])]}function cartesian(spherical){var lambda=spherical[0],phi=spherical[1],cosPhi=cos(phi);return[cosPhi*cos(lambda),cosPhi*sin(lambda),sin(phi)]}function cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function cartesianAddInPlace(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function cartesianNormalizeInPlace(d){var l=sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}var W0,W1,X0,Y0,Z0,X1,Y1,Z1,X2,Y2,Z2,lambda00$2,phi00$2,x0,y0,z0,boundsStream={point:boundsPoint,lineStart:boundsLineStart,lineEnd:boundsLineEnd,polygonStart:function(){boundsStream.point=boundsRingPoint,boundsStream.lineStart=boundsRingStart,boundsStream.lineEnd=boundsRingEnd,deltaSum=new d3Array.Adder,areaStream.polygonStart()},polygonEnd:function(){areaStream.polygonEnd(),boundsStream.point=boundsPoint,boundsStream.lineStart=boundsLineStart,boundsStream.lineEnd=boundsLineEnd,areaRingSum<0?(lambda0$1=-(lambda1=180),phi0=-(phi1=90)):deltaSum>epsilon?phi1=90:deltaSum<-epsilon&&(phi0=-90),range[0]=lambda0$1,range[1]=lambda1},sphere:function(){lambda0$1=-(lambda1=180),phi0=-(phi1=90)}};function boundsPoint(lambda,phi){ranges.push(range=[lambda0$1=lambda,lambda1=lambda]),phi<phi0&&(phi0=phi),phi>phi1&&(phi1=phi)}function linePoint(lambda,phi){var p=cartesian([lambda*radians,phi*radians]);if(p0){var normal=cartesianCross(p0,p),inflection=cartesianCross([normal[1],-normal[0],0],normal);cartesianNormalizeInPlace(inflection),inflection=spherical(inflection);var phii,delta=lambda-lambda2,sign=delta>0?1:-1,lambdai=inflection[0]*degrees*sign,antimeridian=abs(delta)>180;antimeridian^(sign*lambda2<lambdai&&lambdai<sign*lambda)?(phii=inflection[1]*degrees)>phi1&&(phi1=phii):antimeridian^(sign*lambda2<(lambdai=(lambdai+360)%360-180)&&lambdai<sign*lambda)?(phii=-inflection[1]*degrees)<phi0&&(phi0=phii):(phi<phi0&&(phi0=phi),phi>phi1&&(phi1=phi)),antimeridian?lambda<lambda2?angle(lambda0$1,lambda)>angle(lambda0$1,lambda1)&&(lambda1=lambda):angle(lambda,lambda1)>angle(lambda0$1,lambda1)&&(lambda0$1=lambda):lambda1>=lambda0$1?(lambda<lambda0$1&&(lambda0$1=lambda),lambda>lambda1&&(lambda1=lambda)):lambda>lambda2?angle(lambda0$1,lambda)>angle(lambda0$1,lambda1)&&(lambda1=lambda):angle(lambda,lambda1)>angle(lambda0$1,lambda1)&&(lambda0$1=lambda)}else ranges.push(range=[lambda0$1=lambda,lambda1=lambda]);phi<phi0&&(phi0=phi),phi>phi1&&(phi1=phi),p0=p,lambda2=lambda}function boundsLineStart(){boundsStream.point=linePoint}function boundsLineEnd(){range[0]=lambda0$1,range[1]=lambda1,boundsStream.point=boundsPoint,p0=null}function boundsRingPoint(lambda,phi){if(p0){var delta=lambda-lambda2;deltaSum.add(abs(delta)>180?delta+(delta>0?360:-360):delta)}else lambda00$1=lambda,phi00$1=phi;areaStream.point(lambda,phi),linePoint(lambda,phi)}function boundsRingStart(){areaStream.lineStart()}function boundsRingEnd(){boundsRingPoint(lambda00$1,phi00$1),areaStream.lineEnd(),abs(deltaSum)>epsilon&&(lambda0$1=-(lambda1=180)),range[0]=lambda0$1,range[1]=lambda1,p0=null}function angle(lambda0,lambda1){return(lambda1-=lambda0)<0?lambda1+360:lambda1}function rangeCompare(a,b){return a[0]-b[0]}function rangeContains(range,x){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}var centroidStream={sphere:noop,point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd}};function centroidPoint(lambda,phi){lambda*=radians;var cosPhi=cos(phi*=radians);centroidPointCartesian(cosPhi*cos(lambda),cosPhi*sin(lambda),sin(phi))}function centroidPointCartesian(x,y,z){++W0,X0+=(x-X0)/W0,Y0+=(y-Y0)/W0,Z0+=(z-Z0)/W0}function centroidLineStart(){centroidStream.point=centroidLinePointFirst}function centroidLinePointFirst(lambda,phi){lambda*=radians;var cosPhi=cos(phi*=radians);x0=cosPhi*cos(lambda),y0=cosPhi*sin(lambda),z0=sin(phi),centroidStream.point=centroidLinePoint,centroidPointCartesian(x0,y0,z0)}function centroidLinePoint(lambda,phi){lambda*=radians;var cosPhi=cos(phi*=radians),x=cosPhi*cos(lambda),y=cosPhi*sin(lambda),z=sin(phi),w=atan2(sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);W1+=w,X1+=w*(x0+(x0=x)),Y1+=w*(y0+(y0=y)),Z1+=w*(z0+(z0=z)),centroidPointCartesian(x0,y0,z0)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidRingPointFirst}function centroidRingEnd(){centroidRingPoint(lambda00$2,phi00$2),centroidStream.point=centroidPoint}function centroidRingPointFirst(lambda,phi){lambda00$2=lambda,phi00$2=phi,lambda*=radians,phi*=radians,centroidStream.point=centroidRingPoint;var cosPhi=cos(phi);x0=cosPhi*cos(lambda),y0=cosPhi*sin(lambda),z0=sin(phi),centroidPointCartesian(x0,y0,z0)}function centroidRingPoint(lambda,phi){lambda*=radians;var cosPhi=cos(phi*=radians),x=cosPhi*cos(lambda),y=cosPhi*sin(lambda),z=sin(phi),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=hypot(cx,cy,cz),w=asin(m),v=m&&-w/m;X2.add(v*cx),Y2.add(v*cy),Z2.add(v*cz),W1+=w,X1+=w*(x0+(x0=x)),Y1+=w*(y0+(y0=y)),Z1+=w*(z0+(z0=z)),centroidPointCartesian(x0,y0,z0)}function constant(x){return function(){return x}}function compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}return a.invert&&b.invert&&(compose.invert=function(x,y){return(x=b.invert(x,y))&&a.invert(x[0],x[1])}),compose}function rotationIdentity(lambda,phi){return[abs(lambda)>pi?lambda+Math.round(-lambda/tau)*tau:lambda,phi]}function rotateRadians(deltaLambda,deltaPhi,deltaGamma){return(deltaLambda%=tau)?deltaPhi||deltaGamma?compose(rotationLambda(deltaLambda),rotationPhiGamma(deltaPhi,deltaGamma)):rotationLambda(deltaLambda):deltaPhi||deltaGamma?rotationPhiGamma(deltaPhi,deltaGamma):rotationIdentity}function forwardRotationLambda(deltaLambda){return function(lambda,phi){return[(lambda+=deltaLambda)>pi?lambda-tau:lambda<-pi?lambda+tau:lambda,phi]}}function rotationLambda(deltaLambda){var rotation=forwardRotationLambda(deltaLambda);return rotation.invert=forwardRotationLambda(-deltaLambda),rotation}function rotationPhiGamma(deltaPhi,deltaGamma){var cosDeltaPhi=cos(deltaPhi),sinDeltaPhi=sin(deltaPhi),cosDeltaGamma=cos(deltaGamma),sinDeltaGamma=sin(deltaGamma);function rotation(lambda,phi){var cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaPhi+x*sinDeltaPhi;return[atan2(y*cosDeltaGamma-k*sinDeltaGamma,x*cosDeltaPhi-z*sinDeltaPhi),asin(k*cosDeltaGamma+y*sinDeltaGamma)]}return rotation.invert=function(lambda,phi){var cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaGamma-y*sinDeltaGamma;return[atan2(y*cosDeltaGamma+z*sinDeltaGamma,x*cosDeltaPhi+k*sinDeltaPhi),asin(k*cosDeltaPhi-x*sinDeltaPhi)]},rotation}function rotation(rotate){function forward(coordinates){return(coordinates=rotate(coordinates[0]*radians,coordinates[1]*radians))[0]*=degrees,coordinates[1]*=degrees,coordinates}return rotate=rotateRadians(rotate[0]*radians,rotate[1]*radians,rotate.length>2?rotate[2]*radians:0),forward.invert=function(coordinates){return(coordinates=rotate.invert(coordinates[0]*radians,coordinates[1]*radians))[0]*=degrees,coordinates[1]*=degrees,coordinates},forward}function circleStream(stream,radius,delta,direction,t0,t1){if(delta){var cosRadius=cos(radius),sinRadius=sin(radius),step=direction*delta;null==t0?(t0=radius+direction*tau,t1=radius-step/2):(t0=circleRadius(cosRadius,t0),t1=circleRadius(cosRadius,t1),(direction>0?t0<t1:t0>t1)&&(t0+=direction*tau));for(var point,t=t0;direction>0?t>t1:t<t1;t-=step)point=spherical([cosRadius,-sinRadius*cos(t),-sinRadius*sin(t)]),stream.point(point[0],point[1])}}function circleRadius(cosRadius,point){(point=cartesian(point))[0]-=cosRadius,cartesianNormalizeInPlace(point);var radius=acos(-point[1]);return((-point[2]<0?-radius:radius)+tau-epsilon)%tau}function clipBuffer(){var line,lines=[];return{point:function(x,y,m){line.push([x,y,m])},lineStart:function(){lines.push(line=[])},lineEnd:noop,rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;return lines=[],line=null,result}}}function pointEqual(a,b){return abs(a[0]-b[0])<epsilon&&abs(a[1]-b[1])<epsilon}function Intersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function clipRejoin(segments,compareIntersection,startInside,interpolate,stream){var i,n,subject=[],clip=[];if(segments.forEach((function(segment){if(!((n=segment.length-1)<=0)){var n,x,p0=segment[0],p1=segment[n];if(pointEqual(p0,p1)){if(!p0[2]&&!p1[2]){for(stream.lineStart(),i=0;i<n;++i)stream.point((p0=segment[i])[0],p0[1]);return void stream.lineEnd()}p1[0]+=2*epsilon}subject.push(x=new Intersection(p0,segment,null,!0)),clip.push(x.o=new Intersection(p0,null,x,!1)),subject.push(x=new Intersection(p1,segment,null,!1)),clip.push(x.o=new Intersection(p1,null,x,!0))}})),subject.length){for(clip.sort(compareIntersection),link(subject),link(clip),i=0,n=clip.length;i<n;++i)clip[i].e=startInside=!startInside;for(var points,point,start=subject[0];;){for(var current=start,isSubject=!0;current.v;)if((current=current.n)===start)return;points=current.z,stream.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points.length;i<n;++i)stream.point((point=points[i])[0],point[1]);else interpolate(current.x,current.n.x,1,stream);current=current.n}else{if(isSubject)for(points=current.p.z,i=points.length-1;i>=0;--i)stream.point((point=points[i])[0],point[1]);else interpolate(current.x,current.p.x,-1,stream);current=current.p}points=(current=current.o).z,isSubject=!isSubject}while(!current.v);stream.lineEnd()}}}function link(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}function longitude(point){return abs(point[0])<=pi?point[0]:sign(point[0])*((abs(point[0])+pi)%tau-pi)}function polygonContains(polygon,point){var lambda=longitude(point),phi=point[1],sinPhi=sin(phi),normal=[sin(lambda),-cos(lambda),0],angle=0,winding=0,sum=new d3Array.Adder;1===sinPhi?phi=halfPi+epsilon:-1===sinPhi&&(phi=-halfPi-epsilon);for(var i=0,n=polygon.length;i<n;++i)if(m=(ring=polygon[i]).length)for(var ring,m,point0=ring[m-1],lambda0=longitude(point0),phi0=point0[1]/2+quarterPi,sinPhi0=sin(phi0),cosPhi0=cos(phi0),j=0;j<m;++j,lambda0=lambda1,sinPhi0=sinPhi1,cosPhi0=cosPhi1,point0=point1){var point1=ring[j],lambda1=longitude(point1),phi1=point1[1]/2+quarterPi,sinPhi1=sin(phi1),cosPhi1=cos(phi1),delta=lambda1-lambda0,sign=delta>=0?1:-1,absDelta=sign*delta,antimeridian=absDelta>pi,k=sinPhi0*sinPhi1;if(sum.add(atan2(k*sign*sin(absDelta),cosPhi0*cosPhi1+k*cos(absDelta))),angle+=antimeridian?delta+sign*tau:delta,antimeridian^lambda0>=lambda^lambda1>=lambda){var arc=cartesianCross(cartesian(point0),cartesian(point1));cartesianNormalizeInPlace(arc);var intersection=cartesianCross(normal,arc);cartesianNormalizeInPlace(intersection);var phiArc=(antimeridian^delta>=0?-1:1)*asin(intersection[2]);(phi>phiArc||phi===phiArc&&(arc[0]||arc[1]))&&(winding+=antimeridian^delta>=0?1:-1)}}return(angle<-epsilon||angle<epsilon&&sum<-1e-12)^1&winding}function clip(pointVisible,clipLine,interpolate,start){return function(sink){var polygon,segments,ring,line=clipLine(sink),ringBuffer=clipBuffer(),ringSink=clipLine(ringBuffer),polygonStarted=!1,clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing,clip.lineStart=ringStart,clip.lineEnd=ringEnd,segments=[],polygon=[]},polygonEnd:function(){clip.point=point,clip.lineStart=lineStart,clip.lineEnd=lineEnd,segments=d3Array.merge(segments);var startInside=polygonContains(polygon,start);segments.length?(polygonStarted||(sink.polygonStart(),polygonStarted=!0),clipRejoin(segments,compareIntersection,startInside,interpolate,sink)):startInside&&(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd()),polygonStarted&&(sink.polygonEnd(),polygonStarted=!1),segments=polygon=null},sphere:function(){sink.polygonStart(),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd(),sink.polygonEnd()}};function point(lambda,phi){pointVisible(lambda,phi)&&sink.point(lambda,phi)}function pointLine(lambda,phi){line.point(lambda,phi)}function lineStart(){clip.point=pointLine,line.lineStart()}function lineEnd(){clip.point=point,line.lineEnd()}function pointRing(lambda,phi){ring.push([lambda,phi]),ringSink.point(lambda,phi)}function ringStart(){ringSink.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringSink.lineEnd();var i,m,segment,point,clean=ringSink.clean(),ringSegments=ringBuffer.result(),n=ringSegments.length;if(ring.pop(),polygon.push(ring),ring=null,n)if(1&clean){if((m=(segment=ringSegments[0]).length-1)>0){for(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),i=0;i<m;++i)sink.point((point=segment[i])[0],point[1]);sink.lineEnd()}}else n>1&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(validSegment))}return clip}}function validSegment(segment){return segment.length>1}function compareIntersection(a,b){return((a=a.x)[0]<0?a[1]-halfPi-epsilon:halfPi-a[1])-((b=b.x)[0]<0?b[1]-halfPi-epsilon:halfPi-b[1])}rotationIdentity.invert=rotationIdentity;var lengthSum,lambda0$2,sinPhi0$1,cosPhi0$1,clipAntimeridian=clip((function(){return!0}),(function(stream){var clean,lambda0=NaN,phi0=NaN,sign0=NaN;return{lineStart:function(){stream.lineStart(),clean=1},point:function(lambda1,phi1){var sign1=lambda1>0?pi:-pi,delta=abs(lambda1-lambda0);abs(delta-pi)<epsilon?(stream.point(lambda0,phi0=(phi0+phi1)/2>0?halfPi:-halfPi),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),stream.point(lambda1,phi0),clean=0):sign0!==sign1&&delta>=pi&&(abs(lambda0-sign0)<epsilon&&(lambda0-=sign0*epsilon),abs(lambda1-sign1)<epsilon&&(lambda1-=sign1*epsilon),phi0=function(lambda0,phi0,lambda1,phi1){var cosPhi0,cosPhi1,sinLambda0Lambda1=sin(lambda0-lambda1);return abs(sinLambda0Lambda1)>epsilon?atan((sin(phi0)*(cosPhi1=cos(phi1))*sin(lambda1)-sin(phi1)*(cosPhi0=cos(phi0))*sin(lambda0))/(cosPhi0*cosPhi1*sinLambda0Lambda1)):(phi0+phi1)/2}(lambda0,phi0,lambda1,phi1),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),clean=0),stream.point(lambda0=lambda1,phi0=phi1),sign0=sign1},lineEnd:function(){stream.lineEnd(),lambda0=phi0=NaN},clean:function(){return 2-clean}}}),(function(from,to,direction,stream){var phi;if(null==from)phi=direction*halfPi,stream.point(-pi,phi),stream.point(0,phi),stream.point(pi,phi),stream.point(pi,0),stream.point(pi,-phi),stream.point(0,-phi),stream.point(-pi,-phi),stream.point(-pi,0),stream.point(-pi,phi);else if(abs(from[0]-to[0])>epsilon){var lambda=from[0]<to[0]?pi:-pi;phi=direction*lambda/2,stream.point(-lambda,phi),stream.point(0,phi),stream.point(lambda,phi)}else stream.point(to[0],to[1])}),[-pi,-halfPi]);function clipCircle(radius){var cr=cos(radius),delta=6*radians,smallRadius=cr>0,notHemisphere=abs(cr)>epsilon;function visible(lambda,phi){return cos(lambda)*cos(phi)>cr}function intersect(a,b,two){var n1=[1,0,0],n2=cartesianCross(cartesian(a),cartesian(b)),n2n2=cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=cartesianCross(n1,n2),A=cartesianScale(n1,c1);cartesianAddInPlace(A,cartesianScale(n2,c2));var u=n1xn2,w=cartesianDot(A,u),uu=cartesianDot(u,u),t2=w*w-uu*(cartesianDot(A,A)-1);if(!(t2<0)){var t=sqrt(t2),q=cartesianScale(u,(-w-t)/uu);if(cartesianAddInPlace(q,A),q=spherical(q),!two)return q;var z,lambda0=a[0],lambda1=b[0],phi0=a[1],phi1=b[1];lambda1<lambda0&&(z=lambda0,lambda0=lambda1,lambda1=z);var delta=lambda1-lambda0,polar=abs(delta-pi)<epsilon;if(!polar&&phi1<phi0&&(z=phi0,phi0=phi1,phi1=z),polar||delta<epsilon?polar?phi0+phi1>0^q[1]<(abs(q[0]-lambda0)<epsilon?phi0:phi1):phi0<=q[1]&&q[1]<=phi1:delta>pi^(lambda0<=q[0]&&q[0]<=lambda1)){var q1=cartesianScale(u,(-w+t)/uu);return cartesianAddInPlace(q1,A),[q,spherical(q1)]}}}function code(lambda,phi){var r=smallRadius?radius:pi-radius,code=0;return lambda<-r?code|=1:lambda>r&&(code|=2),phi<-r?code|=4:phi>r&&(code|=8),code}return clip(visible,(function(stream){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(lambda,phi){var point2,point1=[lambda,phi],v=visible(lambda,phi),c=smallRadius?v?0:code(lambda,phi):v?code(lambda+(lambda<0?pi:-pi),phi):0;if(!point0&&(v00=v0=v)&&stream.lineStart(),v!==v0&&(!(point2=intersect(point0,point1))||pointEqual(point0,point2)||pointEqual(point1,point2))&&(point1[2]=1),v!==v0)clean=0,v?(stream.lineStart(),point2=intersect(point1,point0),stream.point(point2[0],point2[1])):(point2=intersect(point0,point1),stream.point(point2[0],point2[1],2),stream.lineEnd()),point0=point2;else if(notHemisphere&&point0&&smallRadius^v){var t;c&c0||!(t=intersect(point1,point0,!0))||(clean=0,smallRadius?(stream.lineStart(),stream.point(t[0][0],t[0][1]),stream.point(t[1][0],t[1][1]),stream.lineEnd()):(stream.point(t[1][0],t[1][1]),stream.lineEnd(),stream.lineStart(),stream.point(t[0][0],t[0][1],3)))}!v||point0&&pointEqual(point0,point1)||stream.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&stream.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}}),(function(from,to,direction,stream){circleStream(stream,radius,delta,direction,from,to)}),smallRadius?[0,-radius]:[-pi,radius-pi])}function clipRectangle(x0,y0,x1,y1){function visible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function interpolate(from,to,direction,stream){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^direction>0)do{stream.point(0===a||3===a?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1);else stream.point(to[0],to[1])}function corner(p,direction){return abs(p[0]-x0)<epsilon?direction>0?0:3:abs(p[0]-x1)<epsilon?direction>0?2:1:abs(p[1]-y0)<epsilon?direction>0?1:0:direction>0?3:2}function compareIntersection(a,b){return comparePoint(a.x,b.x)}function comparePoint(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}return function(stream){var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,activeStream=stream,bufferStream=clipBuffer(),clipStream={point:point,lineStart:function(){clipStream.point=linePoint,polygon&&polygon.push(ring=[]),first=!0,v_=!1,x_=y_=NaN},lineEnd:function(){segments&&(linePoint(x__,y__),v__&&v_&&bufferStream.rejoin(),segments.push(bufferStream.result())),clipStream.point=point,v_&&activeStream.lineEnd()},polygonStart:function(){activeStream=bufferStream,segments=[],polygon=[],clean=!0},polygonEnd:function(){var startInside=function(){for(var winding=0,i=0,n=polygon.length;i<n;++i)for(var a0,a1,ring=polygon[i],j=1,m=ring.length,point=ring[0],b0=point[0],b1=point[1];j<m;++j)a0=b0,a1=b1,point=ring[j],b0=point[0],b1=point[1],a1<=y1?b1>y1&&(b0-a0)*(y1-a1)>(b1-a1)*(x0-a0)&&++winding:b1<=y1&&(b0-a0)*(y1-a1)<(b1-a1)*(x0-a0)&&--winding;return winding}(),cleanInside=clean&&startInside,visible=(segments=d3Array.merge(segments)).length;(cleanInside||visible)&&(stream.polygonStart(),cleanInside&&(stream.lineStart(),interpolate(null,null,1,stream),stream.lineEnd()),visible&&clipRejoin(segments,compareIntersection,startInside,interpolate,stream),stream.polygonEnd()),activeStream=stream,segments=polygon=ring=null}};function point(x,y){visible(x,y)&&activeStream.point(x,y)}function linePoint(x,y){var v=visible(x,y);if(polygon&&ring.push([x,y]),first)x__=x,y__=y,v__=v,first=!1,v&&(activeStream.lineStart(),activeStream.point(x,y));else if(v&&v_)activeStream.point(x,y);else{var a=[x_=Math.max(-1e9,Math.min(1e9,x_)),y_=Math.max(-1e9,Math.min(1e9,y_))],b=[x=Math.max(-1e9,Math.min(1e9,x)),y=Math.max(-1e9,Math.min(1e9,y))];!function(a,b,x0,y0,x1,y1){var r,ax=a[0],ay=a[1],t0=0,t1=1,dx=b[0]-ax,dy=b[1]-ay;if(r=x0-ax,dx||!(r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return t0>0&&(a[0]=ax+t0*dx,a[1]=ay+t0*dy),t1<1&&(b[0]=ax+t1*dx,b[1]=ay+t1*dy),!0}}}}}(a,b,x0,y0,x1,y1)?v&&(activeStream.lineStart(),activeStream.point(x,y),clean=!1):(v_||(activeStream.lineStart(),activeStream.point(a[0],a[1])),activeStream.point(b[0],b[1]),v||activeStream.lineEnd(),clean=!1)}x_=x,y_=y,v_=v}return clipStream}}var lengthStream={sphere:noop,point:noop,lineStart:function(){lengthStream.point=lengthPointFirst,lengthStream.lineEnd=lengthLineEnd},lineEnd:noop,polygonStart:noop,polygonEnd:noop};function lengthLineEnd(){lengthStream.point=lengthStream.lineEnd=noop}function lengthPointFirst(lambda,phi){lambda0$2=lambda*=radians,sinPhi0$1=sin(phi*=radians),cosPhi0$1=cos(phi),lengthStream.point=lengthPoint}function lengthPoint(lambda,phi){lambda*=radians;var sinPhi=sin(phi*=radians),cosPhi=cos(phi),delta=abs(lambda-lambda0$2),cosDelta=cos(delta),x=cosPhi*sin(delta),y=cosPhi0$1*sinPhi-sinPhi0$1*cosPhi*cosDelta,z=sinPhi0$1*sinPhi+cosPhi0$1*cosPhi*cosDelta;lengthSum.add(atan2(sqrt(x*x+y*y),z)),lambda0$2=lambda,sinPhi0$1=sinPhi,cosPhi0$1=cosPhi}function length(object){return lengthSum=new d3Array.Adder,geoStream(object,lengthStream),+lengthSum}var coordinates=[null,null],object={type:"LineString",coordinates:coordinates};function distance(a,b){return coordinates[0]=a,coordinates[1]=b,length(object)}var containsObjectType={Feature:function(object,point){return containsGeometry(object.geometry,point)},FeatureCollection:function(object,point){for(var features=object.features,i=-1,n=features.length;++i<n;)if(containsGeometry(features[i].geometry,point))return!0;return!1}},containsGeometryType={Sphere:function(){return!0},Point:function(object,point){return containsPoint(object.coordinates,point)},MultiPoint:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsPoint(coordinates[i],point))return!0;return!1},LineString:function(object,point){return containsLine(object.coordinates,point)},MultiLineString:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsLine(coordinates[i],point))return!0;return!1},Polygon:function(object,point){return containsPolygon(object.coordinates,point)},MultiPolygon:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsPolygon(coordinates[i],point))return!0;return!1},GeometryCollection:function(object,point){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)if(containsGeometry(geometries[i],point))return!0;return!1}};function containsGeometry(geometry,point){return!(!geometry||!containsGeometryType.hasOwnProperty(geometry.type))&&containsGeometryType[geometry.type](geometry,point)}function containsPoint(coordinates,point){return 0===distance(coordinates,point)}function containsLine(coordinates,point){for(var ao,bo,ab,i=0,n=coordinates.length;i<n;i++){if(0===(bo=distance(coordinates[i],point)))return!0;if(i>0&&(ab=distance(coordinates[i],coordinates[i-1]))>0&&ao<=ab&&bo<=ab&&(ao+bo-ab)*(1-Math.pow((ao-bo)/ab,2))<1e-12*ab)return!0;ao=bo}return!1}function containsPolygon(coordinates,point){return!!polygonContains(coordinates.map(ringRadians),pointRadians(point))}function ringRadians(ring){return(ring=ring.map(pointRadians)).pop(),ring}function pointRadians(point){return[point[0]*radians,point[1]*radians]}function graticuleX(y0,y1,dy){var y=d3Array.range(y0,y1-epsilon,dy).concat(y1);return function(x){return y.map((function(y){return[x,y]}))}}function graticuleY(x0,x1,dx){var x=d3Array.range(x0,x1-epsilon,dx).concat(x1);return function(y){return x.map((function(x){return[x,y]}))}}function graticule(){var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3Array.range(ceil(X0/DX)*DX,X1,DX).map(X).concat(d3Array.range(ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3Array.range(ceil(x0/dx)*dx,x1,dx).filter((function(x){return abs(x%DX)>epsilon})).map(x)).concat(d3Array.range(ceil(y0/dy)*dy,y1,dy).filter((function(y){return abs(y%DY)>epsilon})).map(y))}return graticule.lines=function(){return lines().map((function(coordinates){return{type:"LineString",coordinates:coordinates}}))},graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}},graticule.extent=function(_){return arguments.length?graticule.extentMajor(_).extentMinor(_):graticule.extentMinor()},graticule.extentMajor=function(_){return arguments.length?(X0=+_[0][0],X1=+_[1][0],Y0=+_[0][1],Y1=+_[1][1],X0>X1&&(_=X0,X0=X1,X1=_),Y0>Y1&&(_=Y0,Y0=Y1,Y1=_),graticule.precision(precision)):[[X0,Y0],[X1,Y1]]},graticule.extentMinor=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],x0>x1&&(_=x0,x0=x1,x1=_),y0>y1&&(_=y0,y0=y1,y1=_),graticule.precision(precision)):[[x0,y0],[x1,y1]]},graticule.step=function(_){return arguments.length?graticule.stepMajor(_).stepMinor(_):graticule.stepMinor()},graticule.stepMajor=function(_){return arguments.length?(DX=+_[0],DY=+_[1],graticule):[DX,DY]},graticule.stepMinor=function(_){return arguments.length?(dx=+_[0],dy=+_[1],graticule):[dx,dy]},graticule.precision=function(_){return arguments.length?(precision=+_,x=graticuleX(y0,y1,90),y=graticuleY(x0,x1,precision),X=graticuleX(Y0,Y1,90),Y=graticuleY(X0,X1,precision),graticule):precision},graticule.extentMajor([[-180,-90+epsilon],[180,90-epsilon]]).extentMinor([[-180,-80-epsilon],[180,80+epsilon]])}var x00,y00,x0$1,y0$1,identity=x=>x,areaSum$1=new d3Array.Adder,areaRingSum$1=new d3Array.Adder,areaStream$1={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaStream$1.lineStart=areaRingStart$1,areaStream$1.lineEnd=areaRingEnd$1},polygonEnd:function(){areaStream$1.lineStart=areaStream$1.lineEnd=areaStream$1.point=noop,areaSum$1.add(abs(areaRingSum$1)),areaRingSum$1=new d3Array.Adder},result:function(){var area=areaSum$1/2;return areaSum$1=new d3Array.Adder,area}};function areaRingStart$1(){areaStream$1.point=areaPointFirst$1}function areaPointFirst$1(x,y){areaStream$1.point=areaPoint$1,x00=x0$1=x,y00=y0$1=y}function areaPoint$1(x,y){areaRingSum$1.add(y0$1*x-x0$1*y),x0$1=x,y0$1=y}function areaRingEnd$1(){areaPoint$1(x00,y00)}var x00$1,y00$1,x0$3,y0$3,x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream$1={point:function(x,y){x<x0$2&&(x0$2=x),x>x1&&(x1=x),y<y0$2&&(y0$2=y),y>y1&&(y1=y)},lineStart:noop,lineEnd:noop,polygonStart:noop,polygonEnd:noop,result:function(){var bounds=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),bounds}},X0$1=0,Y0$1=0,Z0$1=0,X1$1=0,Y1$1=0,Z1$1=0,X2$1=0,Y2$1=0,Z2$1=0,centroidStream$1={point:centroidPoint$1,lineStart:centroidLineStart$1,lineEnd:centroidLineEnd$1,polygonStart:function(){centroidStream$1.lineStart=centroidRingStart$1,centroidStream$1.lineEnd=centroidRingEnd$1},polygonEnd:function(){centroidStream$1.point=centroidPoint$1,centroidStream$1.lineStart=centroidLineStart$1,centroidStream$1.lineEnd=centroidLineEnd$1},result:function(){var centroid=Z2$1?[X2$1/Z2$1,Y2$1/Z2$1]:Z1$1?[X1$1/Z1$1,Y1$1/Z1$1]:Z0$1?[X0$1/Z0$1,Y0$1/Z0$1]:[NaN,NaN];return X0$1=Y0$1=Z0$1=X1$1=Y1$1=Z1$1=X2$1=Y2$1=Z2$1=0,centroid}};function centroidPoint$1(x,y){X0$1+=x,Y0$1+=y,++Z0$1}function centroidLineStart$1(){centroidStream$1.point=centroidPointFirstLine}function centroidPointFirstLine(x,y){centroidStream$1.point=centroidPointLine,centroidPoint$1(x0$3=x,y0$3=y)}function centroidPointLine(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2,Y1$1+=z*(y0$3+y)/2,Z1$1+=z,centroidPoint$1(x0$3=x,y0$3=y)}function centroidLineEnd$1(){centroidStream$1.point=centroidPoint$1}function centroidRingStart$1(){centroidStream$1.point=centroidPointFirstRing}function centroidRingEnd$1(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(x,y){centroidStream$1.point=centroidPointRing,centroidPoint$1(x00$1=x0$3=x,y00$1=y0$3=y)}function centroidPointRing(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2,Y1$1+=z*(y0$3+y)/2,Z1$1+=z,X2$1+=(z=y0$3*x-x0$3*y)*(x0$3+x),Y2$1+=z*(y0$3+y),Z2$1+=3*z,centroidPoint$1(x0$3=x,y0$3=y)}function PathContext(context){this._context=context}PathContext.prototype={_radius:4.5,pointRadius:function(_){return this._radius=_,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(x,y){switch(this._point){case 0:this._context.moveTo(x,y),this._point=1;break;case 1:this._context.lineTo(x,y);break;default:this._context.moveTo(x+this._radius,y),this._context.arc(x,y,this._radius,0,tau)}},result:noop};var lengthRing,x00$2,y00$2,x0$4,y0$4,lengthSum$1=new d3Array.Adder,lengthStream$1={point:noop,lineStart:function(){lengthStream$1.point=lengthPointFirst$1},lineEnd:function(){lengthRing&&lengthPoint$1(x00$2,y00$2),lengthStream$1.point=noop},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var length=+lengthSum$1;return lengthSum$1=new d3Array.Adder,length}};function lengthPointFirst$1(x,y){lengthStream$1.point=lengthPoint$1,x00$2=x0$4=x,y00$2=y0$4=y}function lengthPoint$1(x,y){x0$4-=x,y0$4-=y,lengthSum$1.add(sqrt(x0$4*x0$4+y0$4*y0$4)),x0$4=x,y0$4=y}function PathString(){this._string=[]}function circle$1(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}function transformer(methods){return function(stream){var s=new TransformStream;for(var key in methods)s[key]=methods[key];return s.stream=stream,s}}function TransformStream(){}function fit(projection,fitBounds,object){var clip=projection.clipExtent&&projection.clipExtent();return projection.scale(150).translate([0,0]),null!=clip&&projection.clipExtent(null),geoStream(object,projection.stream(boundsStream$1)),fitBounds(boundsStream$1.result()),null!=clip&&projection.clipExtent(clip),projection}function fitExtent(projection,extent,object){return fit(projection,(function(b){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x=+extent[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y=+extent[0][1]+(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x,y])}),object)}function fitSize(projection,size,object){return fitExtent(projection,[[0,0],size],object)}function fitWidth(projection,width,object){return fit(projection,(function(b){var w=+width,k=w/(b[1][0]-b[0][0]),x=(w-k*(b[1][0]+b[0][0]))/2,y=-k*b[0][1];projection.scale(150*k).translate([x,y])}),object)}function fitHeight(projection,height,object){return fit(projection,(function(b){var h=+height,k=h/(b[1][1]-b[0][1]),x=-k*b[0][0],y=(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x,y])}),object)}PathString.prototype={_radius:4.5,_circle:circle$1(4.5),pointRadius:function(_){return(_=+_)!==this._radius&&(this._radius=_,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(x,y){switch(this._point){case 0:this._string.push("M",x,",",y),this._point=1;break;case 1:this._string.push("L",x,",",y);break;default:null==this._circle&&(this._circle=circle$1(this._radius)),this._string.push("M",x,",",y,this._circle)}},result:function(){if(this._string.length){var result=this._string.join("");return this._string=[],result}return null}},TransformStream.prototype={constructor:TransformStream,point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var cosMinDistance=cos(30*radians);function resample(project,delta2){return+delta2?function(project,delta2){function resampleLineTo(x0,y0,lambda0,a0,b0,c0,x1,y1,lambda1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*delta2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=sqrt(a*a+b*b+c*c),phi2=asin(c/=m),lambda2=abs(abs(c)-1)<epsilon||abs(lambda0-lambda1)<epsilon?(lambda0+lambda1)/2:atan2(b,a),p=project(lambda2,phi2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;(dz*dz/d2>delta2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,lambda0,a0,b0,c0,x2,y2,lambda2,a/=m,b/=m,c,depth,stream),stream.point(x2,y2),resampleLineTo(x2,y2,lambda2,a,b,c,x1,y1,lambda1,a1,b1,c1,depth,stream))}}return function(stream){var lambda00,x00,y00,a00,b00,c00,lambda0,x0,y0,a0,b0,c0,resampleStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart(),resampleStream.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resampleStream.lineStart=lineStart}};function point(x,y){x=project(x,y),stream.point(x[0],x[1])}function lineStart(){x0=NaN,resampleStream.point=linePoint,stream.lineStart()}function linePoint(lambda,phi){var c=cartesian([lambda,phi]),p=project(lambda,phi);resampleLineTo(x0,y0,lambda0,a0,b0,c0,x0=p[0],y0=p[1],lambda0=lambda,a0=c[0],b0=c[1],c0=c[2],16,stream),stream.point(x0,y0)}function lineEnd(){resampleStream.point=point,stream.lineEnd()}function ringStart(){lineStart(),resampleStream.point=ringPoint,resampleStream.lineEnd=ringEnd}function ringPoint(lambda,phi){linePoint(lambda00=lambda,phi),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resampleStream.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x00,y00,lambda00,a00,b00,c00,16,stream),resampleStream.lineEnd=lineEnd,lineEnd()}return resampleStream}}(project,delta2):function(project){return transformer({point:function(x,y){x=project(x,y),this.stream.point(x[0],x[1])}})}(project)}var transformRadians=transformer({point:function(x,y){this.stream.point(x*radians,y*radians)}});function scaleTranslateRotate(k,dx,dy,sx,sy,alpha){if(!alpha)return function(k,dx,dy,sx,sy){function transform(x,y){return[dx+k*(x*=sx),dy-k*(y*=sy)]}return transform.invert=function(x,y){return[(x-dx)/k*sx,(dy-y)/k*sy]},transform}(k,dx,dy,sx,sy);var cosAlpha=cos(alpha),sinAlpha=sin(alpha),a=cosAlpha*k,b=sinAlpha*k,ai=cosAlpha/k,bi=sinAlpha/k,ci=(sinAlpha*dy-cosAlpha*dx)/k,fi=(sinAlpha*dx+cosAlpha*dy)/k;function transform(x,y){return[a*(x*=sx)-b*(y*=sy)+dx,dy-b*x-a*y]}return transform.invert=function(x,y){return[sx*(ai*x-bi*y+ci),sy*(fi-bi*x-ai*y)]},transform}function projection(project){return projectionMutator((function(){return project}))()}function projectionMutator(projectAt){var project,rotate,y0,x1,y1,projectResample,projectTransform,projectRotateTransform,cache,cacheStream,k=150,x=480,y=250,lambda=0,phi=0,deltaLambda=0,deltaPhi=0,deltaGamma=0,alpha=0,sx=1,sy=1,theta=null,preclip=clipAntimeridian,x0=null,postclip=identity,delta2=.5;function projection(point){return projectRotateTransform(point[0]*radians,point[1]*radians)}function invert(point){return(point=projectRotateTransform.invert(point[0],point[1]))&&[point[0]*degrees,point[1]*degrees]}function recenter(){var center=scaleTranslateRotate(k,0,0,sx,sy,alpha).apply(null,project(lambda,phi)),transform=scaleTranslateRotate(k,x-center[0],y-center[1],sx,sy,alpha);return rotate=rotateRadians(deltaLambda,deltaPhi,deltaGamma),projectTransform=compose(project,transform),projectRotateTransform=compose(rotate,projectTransform),projectResample=resample(projectTransform,delta2),reset()}function reset(){return cache=cacheStream=null,projection}return projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transformRadians(function(rotate){return transformer({point:function(x,y){var r=rotate(x,y);return this.stream.point(r[0],r[1])}})}(rotate)(preclip(projectResample(postclip(cacheStream=stream)))))},projection.preclip=function(_){return arguments.length?(preclip=_,theta=void 0,reset()):preclip},projection.postclip=function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip},projection.clipAngle=function(_){return arguments.length?(preclip=+_?clipCircle(theta=_*radians):(theta=null,clipAntimeridian),reset()):theta*degrees},projection.clipExtent=function(_){return arguments.length?(postclip=null==_?(x0=y0=x1=y1=null,identity):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):null==x0?null:[[x0,y0],[x1,y1]]},projection.scale=function(_){return arguments.length?(k=+_,recenter()):k},projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],recenter()):[x,y]},projection.center=function(_){return arguments.length?(lambda=_[0]%360*radians,phi=_[1]%360*radians,recenter()):[lambda*degrees,phi*degrees]},projection.rotate=function(_){return arguments.length?(deltaLambda=_[0]%360*radians,deltaPhi=_[1]%360*radians,deltaGamma=_.length>2?_[2]%360*radians:0,recenter()):[deltaLambda*degrees,deltaPhi*degrees,deltaGamma*degrees]},projection.angle=function(_){return arguments.length?(alpha=_%360*radians,recenter()):alpha*degrees},projection.reflectX=function(_){return arguments.length?(sx=_?-1:1,recenter()):sx<0},projection.reflectY=function(_){return arguments.length?(sy=_?-1:1,recenter()):sy<0},projection.precision=function(_){return arguments.length?(projectResample=resample(projectTransform,delta2=_*_),reset()):sqrt(delta2)},projection.fitExtent=function(extent,object){return fitExtent(projection,extent,object)},projection.fitSize=function(size,object){return fitSize(projection,size,object)},projection.fitWidth=function(width,object){return fitWidth(projection,width,object)},projection.fitHeight=function(height,object){return fitHeight(projection,height,object)},function(){return project=projectAt.apply(this,arguments),projection.invert=project.invert&&invert,recenter()}}function conicProjection(projectAt){var phi0=0,phi1=pi/3,m=projectionMutator(projectAt),p=m(phi0,phi1);return p.parallels=function(_){return arguments.length?m(phi0=_[0]*radians,phi1=_[1]*radians):[phi0*degrees,phi1*degrees]},p}function conicEqualAreaRaw(y0,y1){var sy0=sin(y0),n=(sy0+sin(y1))/2;if(abs(n)<epsilon)return function(phi0){var cosPhi0=cos(phi0);function forward(lambda,phi){return[lambda*cosPhi0,sin(phi)/cosPhi0]}return forward.invert=function(x,y){return[x/cosPhi0,asin(y*cosPhi0)]},forward}(y0);var c=1+sy0*(2*n-sy0),r0=sqrt(c)/n;function project(x,y){var r=sqrt(c-2*n*sin(y))/n;return[r*sin(x*=n),r0-r*cos(x)]}return project.invert=function(x,y){var r0y=r0-y,l=atan2(x,abs(r0y))*sign(r0y);return r0y*n<0&&(l-=pi*sign(x)*sign(r0y)),[l/n,asin((c-(x*x+r0y*r0y)*n*n)/(2*n))]},project}function conicEqualArea(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])}function albers(){return conicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function azimuthalRaw(scale){return function(x,y){var cx=cos(x),cy=cos(y),k=scale(cx*cy);return k===1/0?[2,0]:[k*cy*sin(x),k*sin(y)]}}function azimuthalInvert(angle){return function(x,y){var z=sqrt(x*x+y*y),c=angle(z),sc=sin(c),cc=cos(c);return[atan2(x*sc,z*cc),asin(z&&y*sc/z)]}}var azimuthalEqualAreaRaw=azimuthalRaw((function(cxcy){return sqrt(2/(1+cxcy))}));azimuthalEqualAreaRaw.invert=azimuthalInvert((function(z){return 2*asin(z/2)}));var azimuthalEquidistantRaw=azimuthalRaw((function(c){return(c=acos(c))&&c/sin(c)}));function mercatorRaw(lambda,phi){return[lambda,log(tan((halfPi+phi)/2))]}function mercatorProjection(project){var y0,x1,y1,m=projection(project),center=m.center,scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,x0=null;function reclip(){var k=pi*scale(),t=m(rotation(m.rotate()).invert([0,0]));return clipExtent(null==x0?[[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]:project===mercatorRaw?[[Math.max(t[0]-k,x0),y0],[Math.min(t[0]+k,x1),y1]]:[[x0,Math.max(t[1]-k,y0)],[x1,Math.min(t[1]+k,y1)]])}return m.scale=function(_){return arguments.length?(scale(_),reclip()):scale()},m.translate=function(_){return arguments.length?(translate(_),reclip()):translate()},m.center=function(_){return arguments.length?(center(_),reclip()):center()},m.clipExtent=function(_){return arguments.length?(null==_?x0=y0=x1=y1=null:(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reclip()):null==x0?null:[[x0,y0],[x1,y1]]},reclip()}function tany(y){return tan((halfPi+y)/2)}function conicConformalRaw(y0,y1){var cy0=cos(y0),n=y0===y1?sin(y0):log(cy0/cos(y1))/log(tany(y1)/tany(y0)),f=cy0*pow(tany(y0),n)/n;if(!n)return mercatorRaw;function project(x,y){f>0?y<-halfPi+epsilon&&(y=-halfPi+epsilon):y>halfPi-epsilon&&(y=halfPi-epsilon);var r=f/pow(tany(y),n);return[r*sin(n*x),f-r*cos(n*x)]}return project.invert=function(x,y){var fy=f-y,r=sign(n)*sqrt(x*x+fy*fy),l=atan2(x,abs(fy))*sign(fy);return fy*n<0&&(l-=pi*sign(x)*sign(fy)),[l/n,2*atan(pow(f/r,1/n))-halfPi]},project}function equirectangularRaw(lambda,phi){return[lambda,phi]}function conicEquidistantRaw(y0,y1){var cy0=cos(y0),n=y0===y1?sin(y0):(cy0-cos(y1))/(y1-y0),g=cy0/n+y0;if(abs(n)<epsilon)return equirectangularRaw;function project(x,y){var gy=g-y,nx=n*x;return[gy*sin(nx),g-gy*cos(nx)]}return project.invert=function(x,y){var gy=g-y,l=atan2(x,abs(gy))*sign(gy);return gy*n<0&&(l-=pi*sign(x)*sign(gy)),[l/n,g-sign(n)*sqrt(x*x+gy*gy)]},project}azimuthalEquidistantRaw.invert=azimuthalInvert((function(z){return z})),mercatorRaw.invert=function(x,y){return[x,2*atan(exp(y))-halfPi]},equirectangularRaw.invert=equirectangularRaw;var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M=sqrt(3)/2;function equalEarthRaw(lambda,phi){var l=asin(M*sin(phi)),l2=l*l,l6=l2*l2*l2;return[lambda*cos(l)/(M*(A1+3*A2*l2+l6*(7*A3+9*A4*l2))),l*(A1+A2*l2+l6*(A3+A4*l2))]}function gnomonicRaw(x,y){var cy=cos(y),k=cos(x)*cy;return[cy*sin(x)/k,sin(y)/k]}function naturalEarth1Raw(lambda,phi){var phi2=phi*phi,phi4=phi2*phi2;return[lambda*(.8707-.131979*phi2+phi4*(phi4*(.003971*phi2-.001529*phi4)-.013791)),phi*(1.007226+phi2*(.015085+phi4*(.028874*phi2-.044475-.005916*phi4)))]}function orthographicRaw(x,y){return[cos(y)*sin(x),sin(y)]}function stereographicRaw(x,y){var cy=cos(y),k=1+cos(x)*cy;return[cy*sin(x)/k,sin(y)/k]}function transverseMercatorRaw(lambda,phi){return[log(tan((halfPi+phi)/2)),-lambda]}equalEarthRaw.invert=function(x,y){for(var delta,l=y,l2=l*l,l6=l2*l2*l2,i=0;i<12&&(l6=(l2=(l-=delta=(l*(A1+A2*l2+l6*(A3+A4*l2))-y)/(A1+3*A2*l2+l6*(7*A3+9*A4*l2)))*l)*l2*l2,!(abs(delta)<1e-12));++i);return[M*x*(A1+3*A2*l2+l6*(7*A3+9*A4*l2))/cos(l),asin(sin(l)/M)]},gnomonicRaw.invert=azimuthalInvert(atan),naturalEarth1Raw.invert=function(x,y){var delta,phi=y,i=25;do{var phi2=phi*phi,phi4=phi2*phi2;phi-=delta=(phi*(1.007226+phi2*(.015085+phi4*(.028874*phi2-.044475-.005916*phi4)))-y)/(1.007226+phi2*(.045255+phi4*(.259866*phi2-.311325-.005916*11*phi4)))}while(abs(delta)>epsilon&&--i>0);return[x/(.8707+(phi2=phi*phi)*(phi2*(phi2*phi2*phi2*(.003971-.001529*phi2)-.013791)-.131979)),phi]},orthographicRaw.invert=azimuthalInvert(asin),stereographicRaw.invert=azimuthalInvert((function(z){return 2*atan(z)})),transverseMercatorRaw.invert=function(x,y){return[-y,2*atan(exp(x))-halfPi]},exports.geoAlbers=albers,exports.geoAlbersUsa=function(){var cache,cacheStream,lower48Point,alaskaPoint,hawaiiPoint,point,lower48=albers(),alaska=conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];return point=null,lower48Point.point(x,y),point||(alaskaPoint.point(x,y),point)||(hawaiiPoint.point(x,y),point)}function reset(){return cache=cacheStream=null,albersUsa}return albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)},albersUsa.stream=function(stream){return cache&&cacheStream===stream?cache:(streams=[lower48.stream(cacheStream=stream),alaska.stream(stream),hawaii.stream(stream)],n=streams.length,cache={point:function(x,y){for(var i=-1;++i<n;)streams[i].point(x,y)},sphere:function(){for(var i=-1;++i<n;)streams[i].sphere()},lineStart:function(){for(var i=-1;++i<n;)streams[i].lineStart()},lineEnd:function(){for(var i=-1;++i<n;)streams[i].lineEnd()},polygonStart:function(){for(var i=-1;++i<n;)streams[i].polygonStart()},polygonEnd:function(){for(var i=-1;++i<n;)streams[i].polygonEnd()}});var streams,n},albersUsa.precision=function(_){return arguments.length?(lower48.precision(_),alaska.precision(_),hawaii.precision(_),reset()):lower48.precision()},albersUsa.scale=function(_){return arguments.length?(lower48.scale(_),alaska.scale(.35*_),hawaii.scale(_),albersUsa.translate(lower48.translate())):lower48.scale()},albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];return lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream),alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+epsilon,y+.12*k+epsilon],[x-.214*k-epsilon,y+.234*k-epsilon]]).stream(pointStream),hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+epsilon,y+.166*k+epsilon],[x-.115*k-epsilon,y+.234*k-epsilon]]).stream(pointStream),reset()},albersUsa.fitExtent=function(extent,object){return fitExtent(albersUsa,extent,object)},albersUsa.fitSize=function(size,object){return fitSize(albersUsa,size,object)},albersUsa.fitWidth=function(width,object){return fitWidth(albersUsa,width,object)},albersUsa.fitHeight=function(height,object){return fitHeight(albersUsa,height,object)},albersUsa.scale(1070)},exports.geoArea=function(object){return areaSum=new d3Array.Adder,geoStream(object,areaStream),2*areaSum},exports.geoAzimuthalEqualArea=function(){return projection(azimuthalEqualAreaRaw).scale(124.75).clipAngle(179.999)},exports.geoAzimuthalEqualAreaRaw=azimuthalEqualAreaRaw,exports.geoAzimuthalEquidistant=function(){return projection(azimuthalEquidistantRaw).scale(79.4188).clipAngle(179.999)},exports.geoAzimuthalEquidistantRaw=azimuthalEquidistantRaw,exports.geoBounds=function(feature){var i,n,a,b,merged,deltaMax,delta;if(phi1=lambda1=-(lambda0$1=phi0=1/0),ranges=[],geoStream(feature,boundsStream),n=ranges.length){for(ranges.sort(rangeCompare),i=1,merged=[a=ranges[0]];i<n;++i)rangeContains(a,(b=ranges[i])[0])||rangeContains(a,b[1])?(angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]),angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])):merged.push(a=b);for(deltaMax=-1/0,i=0,a=merged[n=merged.length-1];i<=n;a=b,++i)b=merged[i],(delta=angle(a[1],b[0]))>deltaMax&&(deltaMax=delta,lambda0$1=b[0],lambda1=a[1])}return ranges=range=null,lambda0$1===1/0||phi0===1/0?[[NaN,NaN],[NaN,NaN]]:[[lambda0$1,phi0],[lambda1,phi1]]},exports.geoCentroid=function(object){W0=W1=X0=Y0=Z0=X1=Y1=Z1=0,X2=new d3Array.Adder,Y2=new d3Array.Adder,Z2=new d3Array.Adder,geoStream(object,centroidStream);var x=+X2,y=+Y2,z=+Z2,m=hypot(x,y,z);return m<1e-12&&(x=X1,y=Y1,z=Z1,W1<epsilon&&(x=X0,y=Y0,z=Z0),(m=hypot(x,y,z))<1e-12)?[NaN,NaN]:[atan2(y,x)*degrees,asin(z/m)*degrees]},exports.geoCircle=function(){var ring,rotate,center=constant([0,0]),radius=constant(90),precision=constant(6),stream={point:function(x,y){ring.push(x=rotate(x,y)),x[0]*=degrees,x[1]*=degrees}};function circle(){var c=center.apply(this,arguments),r=radius.apply(this,arguments)*radians,p=precision.apply(this,arguments)*radians;return ring=[],rotate=rotateRadians(-c[0]*radians,-c[1]*radians,0).invert,circleStream(stream,r,p,1),c={type:"Polygon",coordinates:[ring]},ring=rotate=null,c}return circle.center=function(_){return arguments.length?(center="function"==typeof _?_:constant([+_[0],+_[1]]),circle):center},circle.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant(+_),circle):radius},circle.precision=function(_){return arguments.length?(precision="function"==typeof _?_:constant(+_),circle):precision},circle},exports.geoClipAntimeridian=clipAntimeridian,exports.geoClipCircle=clipCircle,exports.geoClipExtent=function(){var cache,cacheStream,clip,x0=0,y0=0,x1=960,y1=500;return clip={stream:function(stream){return cache&&cacheStream===stream?cache:cache=clipRectangle(x0,y0,x1,y1)(cacheStream=stream)},extent:function(_){return arguments.length?(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1],cache=cacheStream=null,clip):[[x0,y0],[x1,y1]]}}},exports.geoClipRectangle=clipRectangle,exports.geoConicConformal=function(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])},exports.geoConicConformalRaw=conicConformalRaw,exports.geoConicEqualArea=conicEqualArea,exports.geoConicEqualAreaRaw=conicEqualAreaRaw,exports.geoConicEquidistant=function(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])},exports.geoConicEquidistantRaw=conicEquidistantRaw,exports.geoContains=function(object,point){return(object&&containsObjectType.hasOwnProperty(object.type)?containsObjectType[object.type]:containsGeometry)(object,point)},exports.geoDistance=distance,exports.geoEqualEarth=function(){return projection(equalEarthRaw).scale(177.158)},exports.geoEqualEarthRaw=equalEarthRaw,exports.geoEquirectangular=function(){return projection(equirectangularRaw).scale(152.63)},exports.geoEquirectangularRaw=equirectangularRaw,exports.geoGnomonic=function(){return projection(gnomonicRaw).scale(144.049).clipAngle(60)},exports.geoGnomonicRaw=gnomonicRaw,exports.geoGraticule=graticule,exports.geoGraticule10=function(){return graticule()()},exports.geoIdentity=function(){var ca,sa,y0,x1,y1,cache,cacheStream,k=1,tx=0,ty=0,sx=1,sy=1,alpha=0,x0=null,kx=1,ky=1,transform=transformer({point:function(x,y){var p=projection([x,y]);this.stream.point(p[0],p[1])}}),postclip=identity;function reset(){return kx=k*sx,ky=k*sy,cache=cacheStream=null,projection}function projection(p){var x=p[0]*kx,y=p[1]*ky;if(alpha){var t=y*ca-x*sa;x=x*ca+y*sa,y=t}return[x+tx,y+ty]}return projection.invert=function(p){var x=p[0]-tx,y=p[1]-ty;if(alpha){var t=y*ca+x*sa;x=x*ca-y*sa,y=t}return[x/kx,y/ky]},projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transform(postclip(cacheStream=stream))},projection.postclip=function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip},projection.clipExtent=function(_){return arguments.length?(postclip=null==_?(x0=y0=x1=y1=null,identity):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):null==x0?null:[[x0,y0],[x1,y1]]},projection.scale=function(_){return arguments.length?(k=+_,reset()):k},projection.translate=function(_){return arguments.length?(tx=+_[0],ty=+_[1],reset()):[tx,ty]},projection.angle=function(_){return arguments.length?(sa=sin(alpha=_%360*radians),ca=cos(alpha),reset()):alpha*degrees},projection.reflectX=function(_){return arguments.length?(sx=_?-1:1,reset()):sx<0},projection.reflectY=function(_){return arguments.length?(sy=_?-1:1,reset()):sy<0},projection.fitExtent=function(extent,object){return fitExtent(projection,extent,object)},projection.fitSize=function(size,object){return fitSize(projection,size,object)},projection.fitWidth=function(width,object){return fitWidth(projection,width,object)},projection.fitHeight=function(height,object){return fitHeight(projection,height,object)},projection},exports.geoInterpolate=function(a,b){var x0=a[0]*radians,y0=a[1]*radians,x1=b[0]*radians,y1=b[1]*radians,cy0=cos(y0),sy0=sin(y0),cy1=cos(y1),sy1=sin(y1),kx0=cy0*cos(x0),ky0=cy0*sin(x0),kx1=cy1*cos(x1),ky1=cy1*sin(x1),d=2*asin(sqrt(haversin(y1-y0)+cy0*cy1*haversin(x1-x0))),k=sin(d),interpolate=d?function(t){var B=sin(t*=d)/k,A=sin(d-t)/k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[atan2(y,x)*degrees,atan2(z,sqrt(x*x+y*y))*degrees]}:function(){return[x0*degrees,y0*degrees]};return interpolate.distance=d,interpolate},exports.geoLength=length,exports.geoMercator=function(){return mercatorProjection(mercatorRaw).scale(961/tau)},exports.geoMercatorRaw=mercatorRaw,exports.geoNaturalEarth1=function(){return projection(naturalEarth1Raw).scale(175.295)},exports.geoNaturalEarth1Raw=naturalEarth1Raw,exports.geoOrthographic=function(){return projection(orthographicRaw).scale(249.5).clipAngle(90+epsilon)},exports.geoOrthographicRaw=orthographicRaw,exports.geoPath=function(projection,context){var projectionStream,contextStream,pointRadius=4.5;function path(object){return object&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),geoStream(object,projectionStream(contextStream))),contextStream.result()}return path.area=function(object){return geoStream(object,projectionStream(areaStream$1)),areaStream$1.result()},path.measure=function(object){return geoStream(object,projectionStream(lengthStream$1)),lengthStream$1.result()},path.bounds=function(object){return geoStream(object,projectionStream(boundsStream$1)),boundsStream$1.result()},path.centroid=function(object){return geoStream(object,projectionStream(centroidStream$1)),centroidStream$1.result()},path.projection=function(_){return arguments.length?(projectionStream=null==_?(projection=null,identity):(projection=_).stream,path):projection},path.context=function(_){return arguments.length?(contextStream=null==_?(context=null,new PathString):new PathContext(context=_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),path):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.projection(projection).context(context)},exports.geoProjection=projection,exports.geoProjectionMutator=projectionMutator,exports.geoRotation=rotation,exports.geoStereographic=function(){return projection(stereographicRaw).scale(250).clipAngle(142)},exports.geoStereographicRaw=stereographicRaw,exports.geoStream=geoStream,exports.geoTransform=function(methods){return{stream:transformer(methods)}},exports.geoTransverseMercator=function(){var m=mercatorProjection(transverseMercatorRaw),center=m.center,rotate=m.rotate;return m.center=function(_){return arguments.length?center([-_[1],_[0]]):[(_=center())[1],-_[0]]},m.rotate=function(_){return arguments.length?rotate([_[0],_[1],_.length>2?_[2]+90:90]):[(_=rotate())[0],_[1],_[2]-90]},rotate([0,0,90]).scale(159.155)},exports.geoTransverseMercatorRaw=transverseMercatorRaw,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(110))},,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";function domCanvas(w,h){if("undefined"!=typeof document&&document.createElement){const c=document.createElement("canvas");if(c&&c.getContext)return c.width=w,c.height=h,c}return null}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"domCanvas",(function(){return domCanvas})),__webpack_require__.d(__webpack_exports__,"canvas",(function(){return domCanvas})),__webpack_require__.d(__webpack_exports__,"image",(function(){return domImage}));const domImage=()=>"undefined"!=typeof Image?Image:null},function(module,exports,__webpack_require__){(function(Buffer){!function(e,t,n){"use strict";const r=/^([A-Za-z]+:)?\/\//,o=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,i=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,a="file://";async function u(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function s(e,n){n=t.extend({},this.options,n);const u=this.fileAccess,s={href:null};let c,f,l;const p=o.test(e.replace(i,""));null!=e&&"string"==typeof e&&p||t.error("Sanitize failure, invalid URI: "+t.stringValue(e));const h=r.test(e);return(l=n.baseURL)&&!h&&(e.startsWith("/")||"/"===l[l.length-1]||(e="/"+e),e=l+e),f=(c=e.startsWith(a))||"file"===n.mode||"http"!==n.mode&&!h&&u,c?e=e.slice(a.length):e.startsWith("//")&&("file"===n.defaultProtocol?(e=e.slice(2),f=!0):e=(n.defaultProtocol||"http")+":"+e),Object.defineProperty(s,"localFile",{value:!!f}),s.href=e,n.target&&(s.target=n.target+""),n.rel&&(s.rel=n.rel+""),"image"===n.context&&n.crossOrigin&&(s.crossOrigin=n.crossOrigin+""),s}function c(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(e,t)=>{e?r(e):n(t)})}):f}async function f(){t.error("No file system access.")}function l(e){return e?async function(n,r){const o=t.extend({},this.options.http,r),i=r&&r.response,a=await e(n,o);return a.ok?t.isFunction(a[i])?a[i]():a.text():t.error(a.status+""+a.statusText)}:p}async function p(){t.error("No HTTP fetch method available.")}const h=e=>!(Number.isNaN(+e)||e instanceof Date),d={boolean:t.toBoolean,integer:t.toNumber,number:t.toNumber,date:t.toDate,string:t.toString,unknown:t.identity},g=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>h(e)&&Number.isInteger(+e),h,e=>!Number.isNaN(Date.parse(e))],m=["boolean","integer","number","date"];function y(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=g.length,o=g.map((e,t)=>t+1);for(let a,u,s=0,c=0;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(o[a]&&null!=(i=u)&&i==i&&!g[a](u)&&(o[a]=0,++c,c===g.length))return"string";var i;return m[o.reduce((e,t)=>0===e?t:e,0)-1]}function v(e,t){return t.reduce((t,n)=>(t[n]=y(e,n),t),{})}var b={},T={};function j(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function C(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function w(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function A(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,o=[],i=e.length,a=0,u=0,s=i<=0,c=!1;function f(){if(s)return T;if(c)return c=!1,b;var t,r,o=a;if(34===e.charCodeAt(o)){for(;a++<i&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=i?s=!0:10===(r=e.charCodeAt(a++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(a)&&++a),e.slice(o+1,t-1).replace(/""/g,'"')}for(;a<i;){if(10===(r=e.charCodeAt(t=a++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(o,t)}return s=!0,e.slice(o,i)}for(10===e.charCodeAt(i-1)&&--i,13===e.charCodeAt(i-1)&&--i;(r=f())!==T;){for(var l=[];r!==b&&r!==T;)l.push(r),r=f();t&&null==(l=t(l,u++))||o.push(l)}return o}function o(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function i(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?function(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+w(-t,6):t>9999?"+"+w(t,6):w(t,4))+"-"+w(e.getUTCMonth()+1,2)+"-"+w(e.getUTCDate(),2)+(i?"T"+w(n,2)+":"+w(r,2)+":"+w(o,2)+"."+w(i,3)+"Z":o?"T"+w(n,2)+":"+w(r,2)+":"+w(o,2)+"Z":r||n?"T"+w(n,2)+":"+w(r,2)+"Z":"")}(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,o,i=r(e,(function(e,r){if(n)return n(e,r-1);o=e,n=t?function(e,t){var n=j(e);return function(r,o){return t(n(r),o,e)}}(e,t):j(e)}));return i.columns=o||[],i},parseRows:r,format:function(t,n){return null==n&&(n=C(t)),[n.map(a).join(e)].concat(o(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=C(e)),o(e,t).join("\n")},formatRows:function(e){return e.map(i).join("\n")},formatRow:i,formatValue:a}}function x(e){const n=function(n,r){const o={delimiter:e};return O(n,r?t.extend(r,o):o)};return n.responseType="text",n}function O(e,n){return n.header&&(e=n.header.map(t.stringValue).join(n.delimiter)+"\n"+e),A(n.delimiter).parse(e+"")}function P(e,n){const r=n&&n.property?t.field(n.property):t.identity;return!t.isObject(e)||(o=e,"function"==typeof Buffer&&t.isFunction(Buffer.isBuffer)&&Buffer.isBuffer(o))?r(JSON.parse(e)):function(e,n){return!t.isArray(e)&&t.isIterable(e)&&(e=[...e]),n&&n.copy?JSON.parse(JSON.stringify(e)):e}(r(e),n);var o}function k(e){return e}function E(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return S(e,t)}))}:S(e,t)}function S(e,t){var n=t.id,r=t.bbox,o=null==t.properties?{}:t.properties,i=F(e,t);return null==n&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:n,properties:o,geometry:i}:{type:"Feature",id:n,bbox:r,properties:o,geometry:i}}function F(e,t){var n=function(e){if(null==e)return k;var t,n,r=e.scale[0],o=e.scale[1],i=e.translate[0],a=e.translate[1];return function(e,u){u||(t=n=0);var s=2,c=e.length,f=new Array(c);for(f[0]=(t+=e[0])*r+i,f[1]=(n+=e[1])*o+a;s<c;)f[s]=e[s],++s;return f}}(e.transform),r=e.arcs;function o(e,t){t.length&&t.pop();for(var o=r[e<0?~e:e],i=0,a=o.length;i<a;++i)t.push(n(o[i],i));e<0&&function(e,t){for(var n,r=e.length,o=r-t;o<--r;)n=e[o],e[o++]=e[r],e[r]=n}(t,a)}function i(e){return n(e)}function a(e){for(var t=[],n=0,r=e.length;n<r;++n)o(e[n],t);return t.length<2&&t.push(t[0]),t}function u(e){for(var t=a(e);t.length<4;)t.push(t[0]);return t}function s(e){return e.map(u)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=i(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(i);break;case"LineString":n=a(t.arcs);break;case"MultiLineString":n=t.arcs.map(a);break;case"Polygon":n=s(t.arcs);break;case"MultiPolygon":n=t.arcs.map(s);break;default:return null}return{type:r,coordinates:n}}(t)}function M(e,t){var n={},r={},o={},i=[],a=-1;function u(e,t){for(var r in e){var o=e[r];delete t[o.start],delete o.start,delete o.end,o.forEach((function(e){n[e<0?~e:e]=1})),i.push(o)}}return t.forEach((function(n,r){var o,i=e.arcs[n<0?~n:n];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++a],t[a]=n,t[r]=o)})),t.forEach((function(t){var n,i,a=function(t){var n,r=e.arcs[t<0?~t:t],o=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,o]:[o,n]}(t),u=a[0],s=a[1];if(n=o[u])if(delete o[n.end],n.push(t),n.end=s,i=r[s]){delete r[i.start];var c=i===n?n:n.concat(i);r[c.start=n.start]=o[c.end=i.end]=c}else r[n.start]=o[n.end]=n;else if(n=r[s])if(delete r[n.start],n.unshift(t),n.start=u,i=o[u]){delete o[i.end];var f=i===n?n:i.concat(n);r[f.start=i.start]=o[f.end=n.end]=f}else r[n.start]=o[n.end]=n;else r[(n=[t]).start=u]=o[n.end=s]=n})),u(o,r),u(r,o),t.forEach((function(e){n[e<0?~e:e]||i.push([e])})),i}function U(e){return F(e,z.apply(this,arguments))}function z(e,t,n){var r,o,i;if(arguments.length>1)r=B(0,t,n);else for(o=0,r=new Array(i=e.arcs.length);o<i;++o)r[o]=o;return{type:"MultiLineString",arcs:M(e,r)}}function B(e,t,n){var r,o=[],i=[];function a(e){var t=e<0?~e:e;(i[t]||(i[t]=[])).push({i:e,g:r})}function u(e){e.forEach(a)}function s(e){e.forEach(u)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":u(t.arcs);break;case"MultiLineString":case"Polygon":s(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(s)}(t.arcs)}}(t),i.forEach(null==n?function(e){o.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&o.push(e[0].i)}),o}O.responseType="text",P.responseType="json";const D={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function L(e,n){let r,o,i,a;return e=P(e,n),n&&n.feature?(r=E,i=n.feature):n&&n.mesh?(r=U,i=n.mesh,a=D[n.filter]):t.error("Missing TopoJSON feature or mesh parameter."),o=(o=e.objects[i])?r(e,o,a):t.error("Invalid TopoJSON object: "+i),o&&o.features||[o]}L.responseType="json";const I={dsv:O,csv:x(","),tsv:x("\t"),json:P,topojson:L};function J(e,n){return arguments.length>1?(I[e]=n,this):t.hasOwnProperty(I,e)?I[e]:null}const R=function(e,t){return n=>({options:n||{},sanitize:s,load:u,fileAccess:!1,file:c(null),http:l(e)})}("undefined"!=typeof fetch&&fetch);e.format=I,e.formats=J,e.inferType=y,e.inferTypes=v,e.loader=R,e.read=function(e,r,o,i){const a=J((r=r||{}).type||"json");return a||t.error("Unknown data format type: "+r.type),e=a(e,r),r.parse&&function(e,t,r,o){if(!e.length)return;const i=n.timeFormatDefaultLocale();r=r||i.timeParse,o=o||i.utcParse;let a,u,s,c,f,l,p=e.columns||Object.keys(e[0]);"auto"===t&&(t=v(e,p)),p=Object.keys(t);const h=p.map(e=>{const n=t[e];let i,a;if(n&&(n.startsWith("date:")||n.startsWith("utc:")))return i=n.split(/:(.+)?/,2),a=i[1],("'"===a[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1)),("utc"===i[0]?o:r)(a);if(!d[n])throw Error("Illegal format pattern: "+e+":"+n);return d[n]});for(s=0,f=e.length,l=p.length;s<f;++s)for(a=e[s],c=0;c<l;++c)u=p[c],a[u]=h[c](a[u])}(e,r.parse,o,i),t.hasOwnProperty(e,"columns")&&delete e.columns,e},e.responseType=function(e){const t=J(e);return t&&t.responseType||"text"},e.typeParsers=d,Object.defineProperty(e,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(51))}).call(this,__webpack_require__(72).Buffer)},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){!function(exports){"use strict";function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?rgba(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?rgba(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,t1=6/29,t2=3*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl)return hcl2lab(o);o instanceof Rgb||(o=rgbConvert(o));var x,z,r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/1);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/.96422),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/.82521)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t>.008856451679035631?Math.pow(t,1/3):t/t2+4/29}function lab2xyz(t){return t>t1?t*t*t:t2*(t-4/29)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(o instanceof Lab||(o=labConvert(o)),0===o.a&&0===o.b)return new Hcl(NaN,0<o.l&&o.l<100?0:NaN,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}function hcl2lab(o){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=.96422*lab2xyz(x))-1.6168667*(y=1*lab2xyz(y))-.4906146*(z=.82521*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function(){return hcl2lab(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);o instanceof Rgb||(o=rgbConvert(o));var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return 1===arguments.length?cubehelixConvert(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}})),exports.color=color,exports.cubehelix=cubehelix,exports.gray=function(l,opacity){return new Lab(l,0,0,null==opacity?1:opacity)},exports.hcl=hcl,exports.hsl=hsl,exports.lab=lab,exports.lch=function(l,c,h,opacity){return 1===arguments.length?hclConvert(l):new Hcl(h,c,l,null==opacity?1:opacity)},exports.rgb=rgb,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaExpression,d3Geo,d3Color,vegaDataflow,vegaScale,vegaScenegraph,vegaSelections,vegaStatistics,vegaTime,d3Array){"use strict";function data(name){const data=this.context.data[name];return data?data.values.value:[]}function indata(name,field,value){const index=this.context.data[name]["index:"+field],entry=index?index.value.get(value):void 0;return entry?entry.count:entry}function setdata(name,tuples){const df=this.context.dataflow,input=this.context.data[name].input;return df.pulse(input,df.changeset().remove(vegaUtil.truthy).insert(tuples)),1}function encode(item,name,retval){if(item){const df=this.context.dataflow,target=item.mark.source;df.pulse(target,df.changeset().encode(item,name))}return void 0!==retval?retval:item}const wrap=method=>function(value,spec){return this.context.dataflow.locale()[method](spec)(value)},format=wrap("format"),timeFormat=wrap("timeFormat"),utcFormat=wrap("utcFormat"),timeParse=wrap("timeParse"),utcParse=wrap("utcParse"),dateObj=new Date(2e3,0,1);function time(month,day,specifier){return Number.isInteger(month)&&Number.isInteger(day)?(dateObj.setYear(2e3),dateObj.setMonth(month),dateObj.setDate(day),timeFormat.call(this,dateObj,specifier)):""}function monthFormat(month){return time.call(this,month,1,"%B")}function monthAbbrevFormat(month){return time.call(this,month,1,"%b")}function dayFormat(day){return time.call(this,0,2+day,"%A")}function dayAbbrevFormat(day){return time.call(this,0,2+day,"%a")}function dataVisitor(name,args,scope,params){args[0].type!==vegaExpression.Literal&&vegaUtil.error("First argument to data functions must be a string literal.");const data=args[0].value,dataName=":"+data;if(!vegaUtil.hasOwnProperty(dataName,params))try{params[dataName]=scope.getData(data).tuplesRef()}catch(err){}}function indataVisitor(name,args,scope,params){args[0].type!==vegaExpression.Literal&&vegaUtil.error("First argument to indata must be a string literal."),args[1].type!==vegaExpression.Literal&&vegaUtil.error("Second argument to indata must be a string literal.");const data=args[0].value,field=args[1].value,indexName="@"+field;vegaUtil.hasOwnProperty(indexName,params)||(params[indexName]=scope.getData(data).indataRef(scope,field))}function scaleVisitor(name,args,scope,params){if(args[0].type===vegaExpression.Literal)addScaleDependency(scope,params,args[0].value);else for(name in scope.scales)addScaleDependency(scope,params,name)}function addScaleDependency(scope,params,name){const scaleName="%"+name;if(!vegaUtil.hasOwnProperty(params,scaleName))try{params[scaleName]=scope.scaleRef(name)}catch(err){}}function getScale(name,ctx){let s;return vegaUtil.isFunction(name)?name:vegaUtil.isString(name)?(s=ctx.scales[name])&&s.value:void 0}function geoMethod(methodName,globalMethod){return function(projection,geojson,group){if(projection){const p=getScale(projection,(group||this).context);return p&&p.path[methodName](geojson)}return globalMethod(geojson)}}const geoArea=geoMethod("area",d3Geo.geoArea),geoBounds=geoMethod("bounds",d3Geo.geoBounds),geoCentroid=geoMethod("centroid",d3Geo.geoCentroid);function inScope(item){const group=this.context.group;let value=!1;if(group)for(;item;){if(item===group){value=!0;break}item=item.mark.group}return value}function log(df,method,args){try{df[method].apply(df,["EXPRESSION"].concat([].slice.call(args)))}catch(err){df.warn(err)}return args[args.length-1]}function warn(){return log(this.context.dataflow,"warn",arguments)}function info(){return log(this.context.dataflow,"info",arguments)}function debug(){return log(this.context.dataflow,"debug",arguments)}function channel_luminance_value(channelValue){const val=channelValue/255;return val<=.03928?val/12.92:Math.pow((val+.055)/1.055,2.4)}function luminance(color){const c=d3Color.rgb(color);return.2126*channel_luminance_value(c.r)+.7152*channel_luminance_value(c.g)+.0722*channel_luminance_value(c.b)}function contrast(color1,color2){const lum1=luminance(color1),lum2=luminance(color2);return(Math.max(lum1,lum2)+.05)/(Math.min(lum1,lum2)+.05)}function merge(){const args=[].slice.call(arguments);return args.unshift({}),vegaUtil.extend(...args)}function equal(a,b){return a===b||a!=a&&b!=b||(vegaUtil.isArray(a)?!(!vegaUtil.isArray(b)||a.length!==b.length)&&function(a,b){for(let i=0,n=a.length;i<n;++i)if(!equal(a[i],b[i]))return!1;return!0}(a,b):!(!vegaUtil.isObject(a)||!vegaUtil.isObject(b))&&equalObject(a,b))}function equalObject(a,b){for(const key in a)if(!equal(a[key],b[key]))return!1;return!0}function removePredicate(props){return _=>equalObject(props,_)}function modify(name,insert,remove,toggle,modify,values){const df=this.context.dataflow,data=this.context.data[name],input=data.input,stamp=df.stamp();let predicate,key,changes=data.changes;if(!1===df._trigger||!(input.value.length||insert||toggle))return 0;if((!changes||changes.stamp<stamp)&&(data.changes=changes=df.changeset(),changes.stamp=stamp,df.runAfter(()=>{data.modified=!0,df.pulse(input,changes).run()},!0,1)),remove&&(predicate=!0===remove?vegaUtil.truthy:vegaUtil.isArray(remove)||vegaDataflow.isTuple(remove)?remove:removePredicate(remove),changes.remove(predicate)),insert&&changes.insert(insert),toggle&&(predicate=removePredicate(toggle),input.value.some(predicate)?changes.remove(predicate):changes.insert(toggle)),modify)for(key in values)changes.modify(modify,key,values[key]);return 1}function pinchDistance(event){const t=event.touches,dx=t[0].clientX-t[1].clientX,dy=t[0].clientY-t[1].clientY;return Math.sqrt(dx*dx+dy*dy)}function pinchAngle(event){const t=event.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const accessors={};function pluck(data,name){const accessor=accessors[name]||(accessors[name]=vegaUtil.field(name));return vegaUtil.isArray(data)?data.map(accessor):accessor(data)}function array(seq){return vegaUtil.isArray(seq)||ArrayBuffer.isView(seq)?seq:null}function sequence(seq){return array(seq)||(vegaUtil.isString(seq)?seq:null)}function join(seq,...args){return array(seq).join(...args)}function indexof(seq,...args){return sequence(seq).indexOf(...args)}function lastindexof(seq,...args){return sequence(seq).lastIndexOf(...args)}function slice(seq,...args){return sequence(seq).slice(...args)}function replace(str,pattern,repl){return vegaUtil.isFunction(repl)&&vegaUtil.error("Function argument passed to replace."),String(str).replace(pattern,repl)}function reverse(seq){return array(seq).slice().reverse()}function bandspace(count,paddingInner,paddingOuter){return vegaScale.bandSpace(count||0,paddingInner||0,paddingOuter||0)}function bandwidth(name,group){const s=getScale(name,(group||this).context);return s&&s.bandwidth?s.bandwidth():0}function copy(name,group){const s=getScale(name,(group||this).context);return s?s.copy():void 0}function domain(name,group){const s=getScale(name,(group||this).context);return s?s.domain():[]}function invert(name,range,group){const s=getScale(name,(group||this).context);return s?vegaUtil.isArray(range)?(s.invertRange||s.invert)(range):(s.invert||s.invertExtent)(range):void 0}function range(name,group){const s=getScale(name,(group||this).context);return s&&s.range?s.range():[]}function scale(name,value,group){const s=getScale(name,(group||this).context);return s?s(value):void 0}function scaleGradient(scale,p0,p1,count,group){scale=getScale(scale,(group||this).context);const gradient=vegaScenegraph.Gradient(p0,p1);let stops=scale.domain(),min=stops[0],max=vegaUtil.peek(stops),fraction=vegaUtil.identity;return max-min?fraction=vegaScale.scaleFraction(scale,min,max):scale=(scale.interpolator?vegaScale.scale("sequential")().interpolator(scale.interpolator()):vegaScale.scale("linear")().interpolate(scale.interpolate()).range(scale.range())).domain([min=0,max=1]),scale.ticks&&(stops=scale.ticks(+count||15),min!==stops[0]&&stops.unshift(min),max!==vegaUtil.peek(stops)&&stops.push(max)),stops.forEach(_=>gradient.stop(fraction(_),scale(_))),gradient}function geoShape(projection,geojson,group){const p=getScale(projection,(group||this).context);return function(context){return p?p.path.context(context)(geojson):""}}function pathShape(path){let p=null;return function(context){return context?vegaScenegraph.pathRender(context,p=p||vegaScenegraph.pathParse(path)):path}}const datum=d=>d.data;function treeNodes(name,context){const tree=data.call(context,name);return tree.root&&tree.root.lookup||{}}function treePath(name,source,target){const nodes=treeNodes(name,this),s=nodes[source],t=nodes[target];return s&&t?s.path(t).map(datum):void 0}function treeAncestors(name,node){const n=treeNodes(name,this)[node];return n?n.ancestors().map(datum):void 0}const _window=()=>"undefined"!=typeof window&&window||null;function screen(){const w=_window();return w?w.screen:{}}function windowSize(){const w=_window();return w?[w.innerWidth,w.innerHeight]:[void 0,void 0]}function containerSize(){const view=this.context.dataflow,el=view.container&&view.container();return el?[el.clientWidth,el.clientHeight]:[void 0,void 0]}const functionContext={random:()=>vegaStatistics.random(),cumulativeNormal:vegaStatistics.cumulativeNormal,cumulativeLogNormal:vegaStatistics.cumulativeLogNormal,cumulativeUniform:vegaStatistics.cumulativeUniform,densityNormal:vegaStatistics.densityNormal,densityLogNormal:vegaStatistics.densityLogNormal,densityUniform:vegaStatistics.densityUniform,quantileNormal:vegaStatistics.quantileNormal,quantileLogNormal:vegaStatistics.quantileLogNormal,quantileUniform:vegaStatistics.quantileUniform,sampleNormal:vegaStatistics.sampleNormal,sampleLogNormal:vegaStatistics.sampleLogNormal,sampleUniform:vegaStatistics.sampleUniform,isArray:vegaUtil.isArray,isBoolean:vegaUtil.isBoolean,isDate:vegaUtil.isDate,isDefined:_=>void 0!==_,isNumber:vegaUtil.isNumber,isObject:vegaUtil.isObject,isRegExp:vegaUtil.isRegExp,isString:vegaUtil.isString,isTuple:vegaDataflow.isTuple,isValid:_=>null!=_&&_==_,toBoolean:vegaUtil.toBoolean,toDate:vegaUtil.toDate,toNumber:vegaUtil.toNumber,toString:vegaUtil.toString,indexof:indexof,join:join,lastindexof:lastindexof,replace:replace,reverse:reverse,slice:slice,flush:vegaUtil.flush,lerp:vegaUtil.lerp,merge:merge,pad:vegaUtil.pad,peek:vegaUtil.peek,pluck:pluck,span:vegaUtil.span,inrange:vegaUtil.inrange,truncate:vegaUtil.truncate,rgb:d3Color.rgb,lab:d3Color.lab,hcl:d3Color.hcl,hsl:d3Color.hsl,luminance:luminance,contrast:contrast,sequence:d3Array.range,format:format,utcFormat:utcFormat,utcParse:utcParse,utcOffset:vegaTime.utcOffset,utcSequence:vegaTime.utcSequence,timeFormat:timeFormat,timeParse:timeParse,timeOffset:vegaTime.timeOffset,timeSequence:vegaTime.timeSequence,timeUnitSpecifier:vegaTime.timeUnitSpecifier,monthFormat:monthFormat,monthAbbrevFormat:monthAbbrevFormat,dayFormat:dayFormat,dayAbbrevFormat:dayAbbrevFormat,quarter:vegaUtil.quarter,utcquarter:vegaUtil.utcquarter,week:vegaTime.week,utcweek:vegaTime.utcweek,dayofyear:vegaTime.dayofyear,utcdayofyear:vegaTime.utcdayofyear,warn:warn,info:info,debug:debug,extent:vegaUtil.extent,inScope:inScope,intersect:function(b,opt,group){if(!b)return[];const[u,v]=b,box=(new vegaScenegraph.Bounds).set(u[0],u[1],v[0],v[1]),scene=group||this.context.dataflow.scenegraph().root;return vegaScenegraph.intersect(scene,box,function(opt){let p=null;if(opt){const types=vegaUtil.array(opt.marktype),names=vegaUtil.array(opt.markname);p=_=>(!types.length||types.some(t=>_.marktype===t))&&(!names.length||names.some(s=>_.name===s))}return p}(opt))},clampRange:vegaUtil.clampRange,pinchDistance:pinchDistance,pinchAngle:pinchAngle,screen:screen,containerSize:containerSize,windowSize:windowSize,bandspace:bandspace,setdata:setdata,pathShape:pathShape,panLinear:vegaUtil.panLinear,panLog:vegaUtil.panLog,panPow:vegaUtil.panPow,panSymlog:vegaUtil.panSymlog,zoomLinear:vegaUtil.zoomLinear,zoomLog:vegaUtil.zoomLog,zoomPow:vegaUtil.zoomPow,zoomSymlog:vegaUtil.zoomSymlog,encode:encode,modify:modify},eventFunctions=["view","item","group","xy","x","y"],astVisitors={},codegenParams={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:id=>`_[${vegaUtil.stringValue("$"+id)}]`,functions:function(codegen){const fn=vegaExpression.functions(codegen);eventFunctions.forEach(name=>fn[name]="event.vega."+name);for(const name in functionContext)fn[name]="this."+name;return vegaUtil.extend(fn,function(codegen,fnctx,visitors){fnctx.__bandwidth=s=>s&&s.bandwidth?s.bandwidth():0,visitors._bandwidth=scaleVisitor,visitors._range=scaleVisitor,visitors._scale=scaleVisitor;const ref=arg=>"_["+(arg.type===vegaExpression.Literal?vegaUtil.stringValue("%"+arg.value):vegaUtil.stringValue("%")+"+"+codegen(arg))+"]";return{_bandwidth:args=>`this.__bandwidth(${ref(args[0])})`,_range:args=>ref(args[0])+".range()",_scale:args=>`${ref(args[0])}(${codegen(args[1])})`}}(codegen,functionContext,astVisitors)),fn},constants:vegaExpression.constants,visitors:astVisitors},codeGenerator=vegaExpression.codegen(codegenParams);function expressionFunction(name,fn,visitor){return 1===arguments.length?functionContext[name]:(functionContext[name]=fn,visitor&&(astVisitors[name]=visitor),codeGenerator&&(codeGenerator.functions[name]="this."+name),this)}expressionFunction("bandwidth",bandwidth,scaleVisitor),expressionFunction("copy",copy,scaleVisitor),expressionFunction("domain",domain,scaleVisitor),expressionFunction("range",range,scaleVisitor),expressionFunction("invert",invert,scaleVisitor),expressionFunction("scale",scale,scaleVisitor),expressionFunction("gradient",scaleGradient,scaleVisitor),expressionFunction("geoArea",geoArea,scaleVisitor),expressionFunction("geoBounds",geoBounds,scaleVisitor),expressionFunction("geoCentroid",geoCentroid,scaleVisitor),expressionFunction("geoShape",geoShape,scaleVisitor),expressionFunction("indata",indata,indataVisitor),expressionFunction("data",data,dataVisitor),expressionFunction("treePath",treePath,dataVisitor),expressionFunction("treeAncestors",treeAncestors,dataVisitor),expressionFunction("vlSelectionTest",vegaSelections.selectionTest,vegaSelections.selectionVisitor),expressionFunction("vlSelectionIdTest",vegaSelections.selectionIdTest,vegaSelections.selectionVisitor),expressionFunction("vlSelectionResolve",vegaSelections.selectionResolve,vegaSelections.selectionVisitor),expressionFunction("vlSelectionTuples",vegaSelections.selectionTuples),exports.DataPrefix=":",exports.IndexPrefix="@",exports.ScalePrefix="%",exports.SignalPrefix="$",exports.bandspace=bandspace,exports.bandwidth=bandwidth,exports.codeGenerator=codeGenerator,exports.codegenParams=codegenParams,exports.containerSize=containerSize,exports.contrast=contrast,exports.copy=copy,exports.data=data,exports.dataVisitor=dataVisitor,exports.dayAbbrevFormat=dayAbbrevFormat,exports.dayFormat=dayFormat,exports.debug=debug,exports.domain=domain,exports.encode=encode,exports.expressionFunction=expressionFunction,exports.format=format,exports.functionContext=functionContext,exports.geoArea=geoArea,exports.geoBounds=geoBounds,exports.geoCentroid=geoCentroid,exports.geoShape=geoShape,exports.inScope=inScope,exports.indata=indata,exports.indataVisitor=indataVisitor,exports.indexof=indexof,exports.info=info,exports.invert=invert,exports.join=join,exports.lastindexof=lastindexof,exports.luminance=luminance,exports.merge=merge,exports.modify=modify,exports.monthAbbrevFormat=monthAbbrevFormat,exports.monthFormat=monthFormat,exports.parseExpression=function(expr,scope){const params={};let ast;try{expr=vegaUtil.isString(expr)?expr:vegaUtil.stringValue(expr)+"",ast=vegaExpression.parse(expr)}catch(err){vegaUtil.error("Expression parse error: "+expr)}ast.visit(node=>{if(node.type!==vegaExpression.CallExpression)return;const name=node.callee.name,visit=codegenParams.visitors[name];visit&&visit(name,node.arguments,scope,params)});const gen=codeGenerator(ast);return gen.globals.forEach(name=>{const signalName="$"+name;!vegaUtil.hasOwnProperty(params,signalName)&&scope.getSignal(name)&&(params[signalName]=scope.signalRef(name))}),{$expr:vegaUtil.extend({code:gen.code},scope.options.ast?{ast:ast}:null),$fields:gen.fields,$params:params}},exports.pathShape=pathShape,exports.pinchAngle=pinchAngle,exports.pinchDistance=pinchDistance,exports.pluck=pluck,exports.range=range,exports.replace=replace,exports.reverse=reverse,exports.scale=scale,exports.scaleGradient=scaleGradient,exports.scaleVisitor=scaleVisitor,exports.screen=screen,exports.setdata=setdata,exports.slice=slice,exports.timeFormat=timeFormat,exports.timeParse=timeParse,exports.treeAncestors=treeAncestors,exports.treePath=treePath,exports.utcFormat=utcFormat,exports.utcParse=utcParse,exports.warn=warn,exports.windowSize=windowSize,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(78),__webpack_require__(52),__webpack_require__(129),__webpack_require__(40),__webpack_require__(45),__webpack_require__(50),__webpack_require__(130),__webpack_require__(44),__webpack_require__(49),__webpack_require__(131))},function(module,exports){var stringOrChar=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function get(options,name,defaultValue){return name in options?options[name]:defaultValue}module.exports=function(obj,options){options=options||{};var indent=JSON.stringify([1],null,get(options,"indent",2)).slice(2,-3),addMargin=get(options,"margins",!1),maxLength=""===indent?1/0:get(options,"maxLength",80);return function _stringify(obj,currentIndent,reserved){obj&&"function"==typeof obj.toJSON&&(obj=obj.toJSON());var string=JSON.stringify(obj);if(void 0===string)return string;var length=maxLength-currentIndent.length-reserved;if(string.length<=length){var prettified=function(string,addMargin){var m=addMargin?" ":"",tokens={"{":"{"+m,"[":"["+m,"}":m+"}","]":m+"]",",":", ",":":": "};return string.replace(stringOrChar,(function(match,string){return string?match:tokens[match]}))}(string,addMargin);if(prettified.length<=length)return prettified}if("object"==typeof obj&&null!==obj){var delimiters,nextIndent=currentIndent+indent,items=[],comma=function(array,index){return index===array.length-1?0:1};if(Array.isArray(obj)){for(var index=0;index<obj.length;index++)items.push(_stringify(obj[index],nextIndent,comma(obj,index))||"null");delimiters="[]"}else Object.keys(obj).forEach((function(key,index,array){var keyPart=JSON.stringify(key)+": ",value=_stringify(obj[key],nextIndent,keyPart.length+comma(array,index));void 0!==value&&items.push(keyPart+value)})),delimiters="{}";if(items.length>0)return[delimiters[0],indent+items.join(",\n"+nextIndent),delimiters[1]].join("\n"+currentIndent)}return string}(obj,"",0)}},,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return bypassExternalUrlCheck})),__webpack_require__.d(__webpack_exports__,"a",(function(){return vega_base_view_VegaBaseView}));var external_kbnSharedDeps_Jquery_=__webpack_require__(32),external_kbnSharedDeps_Jquery_default=__webpack_require__.n(external_kbnSharedDeps_Jquery_),external_kbnSharedDeps_Moment_=__webpack_require__(31),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_),target=__webpack_require__(134),target_default=__webpack_require__.n(target),vega_node=__webpack_require__(48),vega_lite=__webpack_require__(80),utils=__webpack_require__(81),external_kbnSharedDeps_ElasticEui_=__webpack_require__(8),external_kbnSharedDeps_KbnI18n_=__webpack_require__(3),vega_tooltip=__webpack_require__(135),external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);function createRect(left,top,width,height){return{left:left,top:top,width:width,height:height,x:left,y:top,right:left+width,bottom:top+height}}class vega_tooltip_TooltipHandler{constructor(container,view,opts){this.container=container,this.position=opts.position,this.padding=opts.padding,this.centerOnMark=opts.centerOnMark,this.textTruncate=opts.textTruncate,view.tooltip(this.handler.bind(this))}handler(view,event,item,value){if(this.hideTooltip(),null==value||""===value)return;const el=document.createElement("div");let anchorBounds;if(el.setAttribute("id","vega-kibana-tooltip"),["vgaVis__tooltip","euiToolTipPopover","euiToolTip","euiToolTip--"+this.position].forEach(className=>{el.classList.add(className)}),this.textTruncate&&el.classList.add("vgaVis__tooltip--textTruncate"),el.innerHTML=Object(vega_tooltip.formatValue)(value,external_kbnSharedDeps_Lodash_default.a.escape,2),document.body.appendChild(el),item.bounds.width()>this.centerOnMark||item.bounds.height()>this.centerOnMark)anchorBounds=createRect(event.clientX,event.clientY,0,0);else{const containerBox=this.container.getBoundingClientRect();anchorBounds=createRect(containerBox.left+view._origin[0]+item.bounds.x1,containerBox.top+view._origin[1]+item.bounds.y1,item.bounds.width(),item.bounds.height())}const pos=Object(external_kbnSharedDeps_ElasticEui_.calculatePopoverPosition)(anchorBounds,el.getBoundingClientRect(),this.position,this.padding);el.setAttribute("style",`top: ${pos.top}px; left: ${pos.left}px`)}hideTooltip(){const el=document.getElementById("vega-kibana-tooltip");el&&el.remove()}}var public_=__webpack_require__(6),services=__webpack_require__(1),extract_index_pattern=__webpack_require__(17);Object(vega_node.scheme)("elastic",Object(external_kbnSharedDeps_ElasticEui_.euiPaletteColorBlind)());const vegaFunctions={kibanaAddFilter:"addFilterHandler",kibanaRemoveFilter:"removeFilterHandler",kibanaRemoveAllFilters:"removeAllFiltersHandler",kibanaSetTimeFilter:"setTimeFilterHandler"};for(const funcName of Object.keys(vegaFunctions))Object(vega_node.expressionFunction)(funcName)||Object(vega_node.expressionFunction)(funcName,(function(...args){const view=this.context.dataflow;view.runAfter(()=>view._kibanaView.vegaFunctionsHandler(funcName,...args))}));const bypassToken=Symbol();function bypassExternalUrlCheck(url){return{url:url,bypassToken:bypassToken}}class vega_base_view_VegaBaseView{constructor(opts){this._$parentEl=external_kbnSharedDeps_Jquery_default()(opts.parentEl),this._parser=opts.vegaParser,this._serviceSettings=opts.serviceSettings,this._filterManager=opts.filterManager,this._fireEvent=opts.fireEvent,this._timefilter=opts.timefilter,this._view=null,this._vegaViewConfig=null,this._$messages=null,this._destroyHandlers=[],this._initialized=!1,this._enableExternalUrls=Object(services.c)(),this._vegaStateRestorer=opts.vegaStateRestorer}async init(){if(this._initialized)throw new Error;this._initialized=!0;try{this._$parentEl.empty().addClass("vgaVis").css("flex-direction",this._parser.containerDir);for(const warn of this._parser.warnings)this._addMessage("warn",warn);if(this._parser.error)return void this._addMessage("err",this._parser.error);this._$container=external_kbnSharedDeps_Jquery_default()('<div class="vgaVis__view">').css("height","100%").appendTo(this._$parentEl),this._$controls=external_kbnSharedDeps_Jquery_default()(`<div class="vgaVis__controls vgaVis__controls--${this._parser.controlsDir}">`).appendTo(this._$parentEl),this._addDestroyHandler(()=>{if(this._$container&&(this._$container.remove(),this._$container=null),this._$controls&&(this._$controls.remove(),this._$controls=null),this._$messages&&(this._$messages.remove(),this._$messages=null),this._view){const state=this._view.getState();state&&this._vegaStateRestorer.save(state),this._view.finalize()}this._view=null}),this._vegaViewConfig=this.createViewConfig(),await this._initViewCustomizations()}catch(err){this.onError(err)}}async findIndex(index){const{indexPatterns:indexPatterns}=Object(services.a)();let idxObj;if(index){if([idxObj]=await indexPatterns.find(index),!idxObj)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.baseView.indexNotFoundErrorMessage",{defaultMessage:"Index {index} not found",values:{index:`"${index}"`}}))}else if([idxObj]=await Object(extract_index_pattern.a)(this._parser.isVegaLite?this._parser.vlspec:this._parser.spec),!idxObj){const defaultIdx=await indexPatterns.getDefault();if(!defaultIdx)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.baseView.unableToFindDefaultIndexErrorMessage",{defaultMessage:"Unable to find default index"}));idxObj=defaultIdx}return idxObj.id}createViewConfig(){const config={renderer:this._parser.renderer},vegaLoader=Object(vega_node.loader)(),originalSanitize=vegaLoader.sanitize.bind(vegaLoader);vegaLoader.sanitize=async(uri,options)=>{if(uri.bypassToken===bypassToken)uri=uri.url;else if(!this._enableExternalUrls)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.baseView.externalUrlsAreNotEnabledErrorMessage",{defaultMessage:"External URLs are not enabled. Add   {enableExternalUrls}   to {kibanaConfigFileName}",values:{enableExternalUrls:"vis_type_vega.enableExternalUrls: true",kibanaConfigFileName:"kibana.yml"}}));const result=await originalSanitize(uri,options);return result.crossOrigin=null,result},config.loader=vegaLoader;const vegaLogger=Object(vega_node.logger)(vega_node.Warn);return vegaLogger.warn=this.onWarn.bind(this),vegaLogger.error=this.onError.bind(this),config.logger=vegaLogger,config}onError(){this._addMessage("err",utils.a.formatErrorToStr(...arguments))}onWarn(){this._parser&&this._parser.hideWarnings||this._addMessage("warn",utils.a.formatWarningToStr(...arguments))}_addMessage(type,text){this._$messages||(this._$messages=external_kbnSharedDeps_Jquery_default()('<ul class="vgaVis__messages">').appendTo(this._$parentEl)),this._$messages.append(external_kbnSharedDeps_Jquery_default()(`<li class="vgaVis__message vgaVis__message--${type}">`).append(external_kbnSharedDeps_Jquery_default()('<pre class="vgaVis__messageCode">').text(text)))}resize(){if(this._parser.useResize&&this._view&&this.updateVegaSize(this._view))return this._view.runAsync()}updateVegaSize(view){const width=Math.max(0,this._$container.width()),height=Math.max(0,this._$container.height())-6;return(view.width()!==width||view.height()!==height)&&(view.width(width).height(height),!0)}setView(view){if(this._view!==view&&(this._view&&this._view.finalize(),this._view=view,view)){if(view._kibanaView=this,this._parser.tooltips){const tthandler=new vega_tooltip_TooltipHandler(this._$container[0],view,this._parser.tooltips);this._addDestroyHandler(()=>tthandler.hideTooltip())}const state=this._vegaStateRestorer.restore();return state?view.setState(state):view.runAsync()}}async vegaFunctionsHandler(funcName,...args){try{const handlerFunc=vegaFunctions[funcName];if(!handlerFunc||!this[handlerFunc])throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.baseView.functionIsNotDefinedForGraphErrorMessage",{defaultMessage:"{funcName} is not defined for this graph",values:{funcName:funcName+"()"}}));await this[handlerFunc](...args)}catch(err){this.onError(err)}}async addFilterHandler(query,index){const indexId=await this.findIndex(index),filter=public_.esFilters.buildQueryFilter(query,indexId);this._fireEvent({name:"applyFilter",data:{filters:[filter]}})}async removeFilterHandler(query,index){const indexId=await this.findIndex(index),filterToRemove=public_.esFilters.buildQueryFilter(query,indexId),existingFilter=this._filterManager.getFilters().find(filter=>public_.esFilters.compareFilters(filter,filterToRemove));if(existingFilter)try{this._filterManager.removeFilter(existingFilter)}catch(err){this.onError(err)}}removeAllFiltersHandler(){this._filterManager.removeAll()}setTimeFilterHandler(start,end){const{from:from,to:to,mode:mode}=vega_base_view_VegaBaseView._parseTimeRange(start,end);this._fireEvent({name:"applyFilter",data:{timeFieldName:"*",filters:[{range:{"*":{mode:mode,gte:from,lte:to}}}]}})}static _parseTimeRange(start,end){const absStart=external_kbnSharedDeps_Moment_default()(start),absEnd=external_kbnSharedDeps_Moment_default()(end),isValidAbsStart=absStart.isValid(),isValidAbsEnd=absEnd.isValid();let from,to,reverse,mode="absolute";if(isValidAbsStart&&isValidAbsEnd)from=absStart,to=absEnd,reverse=absStart.isAfter(absEnd);else{const startDate=target_default.a.parse(start),endDate=target_default.a.parse(end);if(!(startDate&&endDate&&startDate.isValid()&&endDate.isValid()))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.baseView.timeValuesTypeErrorMessage",{defaultMessage:"Error setting time filter: both time values must be either relative or absolute dates. {start}, {end}",values:{start:"start="+JSON.stringify(start),end:"end="+JSON.stringify(end)}}));reverse=startDate.isAfter(endDate),isValidAbsStart||isValidAbsEnd?(from=startDate,to=endDate):(mode="relative",from=start,to=end)}return reverse&&([from,to]=[to,from]),{from:from,to:to,mode:mode}}setDebugValues(view,spec,vlspec){var _this$_parser$searchA;if(null===(_this$_parser$searchA=this._parser.searchAPI.inspectorAdapters)||void 0===_this$_parser$searchA||_this$_parser$searchA.vega.bindInspectValues({view:view,spec:vlspec||spec}),window){void 0===window.VEGA_DEBUG&&console&&(console.log("%cWelcome to Kibana Vega Plugin!","font-size: 16px; font-weight: bold;"),console.log("You can access the Vega view with VEGA_DEBUG. Learn more at https://vega.github.io/vega/docs/api/debugging/."));const debugObj={};window.VEGA_DEBUG=debugObj,window.VEGA_DEBUG.VEGA_VERSION=vega_node.version,window.VEGA_DEBUG.VEGA_LITE_VERSION=vega_lite.version,window.VEGA_DEBUG.view=view,window.VEGA_DEBUG.vega_spec=spec,window.VEGA_DEBUG.vegalite_spec=vlspec,this._addDestroyHandler(()=>{debugObj===window.VEGA_DEBUG&&(window.VEGA_DEBUG=null)})}}destroy(){return this._destroyHandlers&&(this._ongoingDestroy=Promise.all(this._destroyHandlers.map(v=>v())),this._destroyHandlers=null),this._ongoingDestroy}_addDestroyHandler(handler){this._destroyHandlers?this._destroyHandlers.push(handler):handler()}}},function(module,exports,__webpack_require__){"use strict";(function(global){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var base64=__webpack_require__(87),ieee754=__webpack_require__(88),isArray=__webpack_require__(89);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array);return that}(that,value,encodingOrOffset,length):"string"==typeof value?function(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);actual!==length&&(that=that.slice(0,actual));return that}(that,value,encodingOrOffset):function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length||obj.copy(that,0,0,len),that}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||(val=obj.length)!=val?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}var val;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res}(res)}exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return function(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var newBuf,len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}}).call(this,__webpack_require__(60))},function(module,exports,__webpack_require__){!function(exports,d3Time){"use strict";function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);return date.setFullYear(d.y),date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));return date.setUTCFullYear(d.y),date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newDate(y,m,d){return{y:y,m:m,d:d,H:0,M:0,S:0,L:0}}function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths,periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths),formats={a:function(d){return locale_shortWeekdays[d.getDay()]},A:function(d){return locale_weekdays[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function(d){return locale_periods[+(d.getHours()>=12)]},q:function(d){return 1+~~(d.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},utcFormats={a:function(d){return locale_shortWeekdays[d.getUTCDay()]},A:function(d){return locale_weekdays[d.getUTCDay()]},b:function(d){return locale_shortMonths[d.getUTCMonth()]},B:function(d){return locale_months[d.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function(d){return locale_periods[+(d.getUTCHours()>=12)]},q:function(d){return 1+~~(d.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},parses={a:function(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},A:function(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},b:function(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},B:function(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},c:function(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup.get(n[0].toLowerCase()),i+n[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function(d,string,i){return parseSpecifier(d,locale_date,string,i)},X:function(d,string,i){return parseSpecifier(d,locale_time,string,i)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function newFormat(specifier,formats){return function(date){var c,pad,format,string=[],i=-1,j=0,n=specifier.length;for(date instanceof Date||(date=new Date(+date));++i<n;)37===specifier.charCodeAt(i)&&(string.push(specifier.slice(j,i)),null!=(pad=pads[c=specifier.charAt(++i)])?c=specifier.charAt(++i):pad="e"===c?" ":"0",(format=formats[c])&&(c=format(date,pad)),string.push(c),j=i+1);return string.push(specifier.slice(j,i)),string.join("")}}function newParse(specifier,Z){return function(string){var week,day,d=newDate(1900,void 0,1);if(parseSpecifier(d,specifier,string+="",0)!=string.length)return null;if("Q"in d)return new Date(d.Q);if("s"in d)return new Date(1e3*d.s+("L"in d?d.L:0));if(Z&&!("Z"in d)&&(d.Z=0),"p"in d&&(d.H=d.H%12+12*d.p),void 0===d.m&&(d.m="q"in d?d.q:0),"V"in d){if(d.V<1||d.V>53)return null;"w"in d||(d.w=1),"Z"in d?(day=(week=utcDate(newDate(d.y,0,1))).getUTCDay(),week=day>4||0===day?d3Time.utcMonday.ceil(week):d3Time.utcMonday(week),week=d3Time.utcDay.offset(week,7*(d.V-1)),d.y=week.getUTCFullYear(),d.m=week.getUTCMonth(),d.d=week.getUTCDate()+(d.w+6)%7):(day=(week=localDate(newDate(d.y,0,1))).getDay(),week=day>4||0===day?d3Time.timeMonday.ceil(week):d3Time.timeMonday(week),week=d3Time.timeDay.offset(week,7*(d.V-1)),d.y=week.getFullYear(),d.m=week.getMonth(),d.d=week.getDate()+(d.w+6)%7)}else("W"in d||"U"in d)&&("w"in d||(d.w="u"in d?d.u%7:"W"in d?1:0),day="Z"in d?utcDate(newDate(d.y,0,1)).getUTCDay():localDate(newDate(d.y,0,1)).getDay(),d.m=0,d.d="W"in d?(d.w+6)%7+7*d.W-(day+5)%7:d.w+7*d.U-(day+6)%7);return"Z"in d?(d.H+=d.Z/100|0,d.M+=d.Z%100,utcDate(d)):localDate(d)}}function parseSpecifier(d,specifier,string,j){for(var c,parse,i=0,n=specifier.length,m=string.length;i<n;){if(j>=m)return-1;if(37===(c=specifier.charCodeAt(i++))){if(c=specifier.charAt(i++),!(parse=parses[c in pads?specifier.charAt(i++):c])||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}return formats.x=newFormat(locale_date,formats),formats.X=newFormat(locale_time,formats),formats.c=newFormat(locale_dateTime,formats),utcFormats.x=newFormat(locale_date,utcFormats),utcFormats.X=newFormat(locale_time,utcFormats),utcFormats.c=newFormat(locale_dateTime,utcFormats),{format:function(specifier){var f=newFormat(specifier+="",formats);return f.toString=function(){return specifier},f},parse:function(specifier){var p=newParse(specifier+="",!1);return p.toString=function(){return specifier},p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);return f.toString=function(){return specifier},f},utcParse:function(specifier){var p=newParse(specifier+="",!0);return p.toString=function(){return specifier},p}}}var locale,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){return new Map(names.map((name,i)=>[name.toLowerCase(),i]))}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseQuarter(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.q=3*n[0]-3,i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.s=+n[0],i+n[0].length):-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+d3Time.timeDay.count(d3Time.timeYear(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return 0===day?7:day}function formatWeekNumberSunday(d,p){return pad(d3Time.timeSunday.count(d3Time.timeYear(d)-1,d),p,2)}function dISO(d){var day=d.getDay();return day>=4||0===day?d3Time.timeThursday(d):d3Time.timeThursday.ceil(d)}function formatWeekNumberISO(d,p){return d=dISO(d),pad(d3Time.timeThursday.count(d3Time.timeYear(d),d)+(4===d3Time.timeYear(d).getDay()),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(d3Time.timeMonday.count(d3Time.timeYear(d)-1,d),p,2)}function formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatYearISO(d,p){return pad((d=dISO(d)).getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatFullYearISO(d,p){var day=d.getDay();return pad((d=day>=4||0===day?d3Time.timeThursday(d):d3Time.timeThursday.ceil(d)).getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+d3Time.utcDay.count(d3Time.utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return 0===dow?7:dow}function formatUTCWeekNumberSunday(d,p){return pad(d3Time.utcSunday.count(d3Time.utcYear(d)-1,d),p,2)}function UTCdISO(d){var day=d.getUTCDay();return day>=4||0===day?d3Time.utcThursday(d):d3Time.utcThursday.ceil(d)}function formatUTCWeekNumberISO(d,p){return d=UTCdISO(d),pad(d3Time.utcThursday.count(d3Time.utcYear(d),d)+(4===d3Time.utcYear(d).getUTCDay()),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(d3Time.utcMonday.count(d3Time.utcYear(d)-1,d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCYearISO(d,p){return pad((d=UTCdISO(d)).getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCFullYearISO(d,p){var day=d.getUTCDay();return pad((d=day>=4||0===day?d3Time.utcThursday(d):d3Time.utcThursday.ceil(d)).getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}function defaultLocale(definition){return locale=formatLocale(definition),exports.timeFormat=locale.format,exports.timeParse=locale.parse,exports.utcFormat=locale.utcFormat,exports.utcParse=locale.utcParse,locale}defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var formatIso=Date.prototype.toISOString?function(date){return date.toISOString()}:exports.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ"),parseIso=+new Date("2000-01-01T00:00:00.000Z")?function(string){var date=new Date(string);return isNaN(date)?null:date}:exports.utcParse("%Y-%m-%dT%H:%M:%S.%LZ");exports.isoFormat=formatIso,exports.isoParse=parseIso,exports.timeFormatDefaultLocale=defaultLocale,exports.timeFormatLocale=formatLocale,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(94))},function(module,exports,__webpack_require__){!function(exports){"use strict";const pi=Math.PI,tau=2*pi,tauEpsilon=tau-1e-6;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=x1)+","+(this._y1=y1);else if(l01_2>1e-6)if(Math.abs(y01*x21-y21*x01)>1e-6&&r){var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;Math.abs(t01-1)>1e-6&&(this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)),this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}else this._+="L"+(this._x1=x1)+","+(this._y1=y1)},arc:function(x,y,r,a0,a1,ccw){x=+x,y=+y,ccw=!!ccw;var dx=(r=+r)*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+x0+","+y0:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(da<0&&(da=da%tau+tau),da>tauEpsilon?this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0):da>1e-6&&(this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))))},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}},exports.path=path,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,d3Geo,d3GeoProjection){"use strict";const defaultPath=d3Geo.geoPath(),projectionProperties=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function create(type,constructor){return function projection(){const p=constructor();return p.type=type,p.path=d3Geo.geoPath().projection(p),p.copy=p.copy||function(){const c=projection();return projectionProperties.forEach(prop=>{p[prop]&&c[prop](p[prop]())}),c.path.pointRadius(p.path.pointRadius()),c},p}}function projection(type,proj){if(!type||"string"!=typeof type)throw new Error("Projection type must be a name string.");return type=type.toLowerCase(),arguments.length>1?(projections[type]=create(type,proj),this):projections[type]||null}const projections={albers:d3Geo.geoAlbers,albersusa:d3Geo.geoAlbersUsa,azimuthalequalarea:d3Geo.geoAzimuthalEqualArea,azimuthalequidistant:d3Geo.geoAzimuthalEquidistant,conicconformal:d3Geo.geoConicConformal,conicequalarea:d3Geo.geoConicEqualArea,conicequidistant:d3Geo.geoConicEquidistant,equalEarth:d3Geo.geoEqualEarth,equirectangular:d3Geo.geoEquirectangular,gnomonic:d3Geo.geoGnomonic,identity:d3Geo.geoIdentity,mercator:d3Geo.geoMercator,mollweide:d3GeoProjection.geoMollweide,naturalEarth1:d3Geo.geoNaturalEarth1,orthographic:d3Geo.geoOrthographic,stereographic:d3Geo.geoStereographic,transversemercator:d3Geo.geoTransverseMercator};for(const key in projections)projection(key,projections[key]);exports.getProjectionPath=function(proj){return proj&&proj.path||defaultPath},exports.projection=projection,exports.projectionProperties=projectionProperties,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(52),__webpack_require__(111))},function(module,exports,__webpack_require__){!function(exports){"use strict";var taskHead,taskTail,frame=0,timeout=0,interval=0,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function timerFlush(){now(),++frame;for(var e,t=taskHead;t;)(e=clockNow-t._time)>=0&&t._call.call(null,e),t=t._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,function(){for(var t0,t2,t1=taskHead,time=1/0;t1;)t1._call?(time>t1._time&&(time=t1._time),t0=t1,t1=t1._next):(t2=t1._next,t1._next=null,t1=t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;delay>1e3&&(clockSkew-=delay,clockLast=now)}function sleep(time){frame||(timeout&&(timeout=clearTimeout(timeout)),time-clockNow>24?(time<1/0&&(timeout=setTimeout(wake,time-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,1e3)),frame=1,setFrame(wake)))}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}},exports.interval=function(callback,delay,time){var t=new Timer,total=delay;return null==delay?(t.restart(callback,delay,time),t):(t._restart=t.restart,t.restart=function(callback,delay,time){delay=+delay,time=null==time?now():+time,t._restart((function tick(elapsed){elapsed+=total,t._restart(tick,total+=delay,time),callback(elapsed)}),delay,time)},t.restart(callback,delay,time),t)},exports.now=now,exports.timeout=function(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart(elapsed=>{t.stop(),callback(elapsed+delay)},delay,time),t},exports.timer=timer,exports.timerFlush=timerFlush,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil){"use strict";function ASTNode(type){this.type=type}var TokenName,source,index,length,lookahead;ASTNode.prototype.visit=function(visitor){let c,i,n;if(visitor(this))return 1;for(c=function(node){switch(node.type){case"ArrayExpression":return node.elements;case"BinaryExpression":case"LogicalExpression":return[node.left,node.right];case"CallExpression":return[node.callee].concat(node.arguments);case"ConditionalExpression":return[node.test,node.consequent,node.alternate];case"MemberExpression":return[node.object,node.property];case"ObjectExpression":return node.properties;case"Property":return[node.key,node.value];case"UnaryExpression":return[node.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),i=0,n=c.length;i<n;++i)if(c[i].visit(visitor))return 1},(TokenName={})[1]="Boolean",TokenName[2]="<end>",TokenName[3]="Identifier",TokenName[4]="Keyword",TokenName[5]="Null",TokenName[6]="Numeric",TokenName[7]="Punctuator",TokenName[8]="String",TokenName[9]="RegularExpression";var ILLEGAL="ILLEGAL",RegexNonAsciiIdentifierStart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),RegexNonAsciiIdentifierPart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function assert(condition,message){if(!condition)throw new Error("ASSERT: "+message)}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return 32===ch||9===ch||11===ch||12===ch||160===ch||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function isIdentifierStart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||92===ch||ch>=128&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||92===ch||ch>=128&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch))}const keywords={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function skipComment(){for(;index<length;){const ch=source.charCodeAt(index);if(!isWhiteSpace(ch)&&!isLineTerminator(ch))break;++index}}function scanHexEscape(prefix){var i,len,ch,code=0;for(len="u"===prefix?4:2,i=0;i<len;++i)index<length&&isHexDigit(source[index])?(ch=source[index++],code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())):throwError({},"Unexpected token %0",ILLEGAL);return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;for(code=0,"}"===(ch=source[index])&&throwError({},"Unexpected token %0",ILLEGAL);index<length&&isHexDigit(ch=source[index++]);)code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase());return(code>1114111||"}"!==ch)&&throwError({},"Unexpected token %0",ILLEGAL),code<=65535?String.fromCharCode(code):(cu1=55296+(code-65536>>10),cu2=56320+(code-65536&1023),String.fromCharCode(cu1,cu2))}function getEscapedIdentifier(){var ch,id;for(ch=source.charCodeAt(index++),id=String.fromCharCode(ch),92===ch&&(117!==source.charCodeAt(index)&&throwError({},"Unexpected token %0",ILLEGAL),++index,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierStart(ch.charCodeAt(0))||throwError({},"Unexpected token %0",ILLEGAL),id=ch);index<length&&isIdentifierPart(ch=source.charCodeAt(index));)++index,id+=String.fromCharCode(ch),92===ch&&(id=id.substr(0,id.length-1),117!==source.charCodeAt(index)&&throwError({},"Unexpected token %0",ILLEGAL),++index,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierPart(ch.charCodeAt(0))||throwError({},"Unexpected token %0",ILLEGAL),id+=ch);return id}function scanIdentifier(){var start,id;return start=index,{type:1===(id=92===source.charCodeAt(index)?getEscapedIdentifier():function(){var start,ch;for(start=index++;index<length;){if(92===(ch=source.charCodeAt(index)))return index=start,getEscapedIdentifier();if(!isIdentifierPart(ch))break;++index}return source.slice(start,index)}()).length?3:keywords.hasOwnProperty(id)?4:"null"===id?5:"true"===id||"false"===id?1:3,value:id,start:start,end:index}}function scanPunctuator(){var code2,ch2,ch3,ch4,start=index,code=source.charCodeAt(index),ch1=source[index];switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++index,{type:7,value:String.fromCharCode(code),start:start,end:index};default:if(61===(code2=source.charCodeAt(index+1)))switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return index+=2,{type:7,value:String.fromCharCode(code)+String.fromCharCode(code2),start:start,end:index};case 33:case 61:return index+=2,61===source.charCodeAt(index)&&++index,{type:7,value:source.slice(start,index),start:start,end:index}}}return">>>="===(ch4=source.substr(index,4))?{type:7,value:ch4,start:start,end:index+=4}:">>>"===(ch3=ch4.substr(0,3))||"<<="===ch3||">>="===ch3?{type:7,value:ch3,start:start,end:index+=3}:ch1===(ch2=ch3.substr(0,2))[1]&&"+-<>&|".indexOf(ch1)>=0||"=>"===ch2?{type:7,value:ch2,start:start,end:index+=2}:("//"===ch2&&throwError({},"Unexpected token %0",ILLEGAL),"<>=!+-*%&|^/".indexOf(ch1)>=0?{type:7,value:ch1,start:start,end:++index}:void throwError({},"Unexpected token %0",ILLEGAL))}function scanNumericLiteral(){var number,start,ch;if(assert(isDecimalDigit((ch=source[index]).charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point"),start=index,number="","."!==ch){if(number=source[index++],ch=source[index],"0"===number){if("x"===ch||"X"===ch)return++index,function(start){let number="";for(;index<length&&isHexDigit(source[index]);)number+=source[index++];return 0===number.length&&throwError({},"Unexpected token %0",ILLEGAL),isIdentifierStart(source.charCodeAt(index))&&throwError({},"Unexpected token %0",ILLEGAL),{type:6,value:parseInt("0x"+number,16),start:start,end:index}}(start);if(isOctalDigit(ch))return function(start){let number="0"+source[index++];for(;index<length&&isOctalDigit(source[index]);)number+=source[index++];return(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index)))&&throwError({},"Unexpected token %0",ILLEGAL),{type:6,value:parseInt(number,8),octal:!0,start:start,end:index}}(start);ch&&isDecimalDigit(ch.charCodeAt(0))&&throwError({},"Unexpected token %0",ILLEGAL)}for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("."===ch){for(number+=source[index++];isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("e"===ch||"E"===ch)if(number+=source[index++],"+"!==(ch=source[index])&&"-"!==ch||(number+=source[index++]),isDecimalDigit(source.charCodeAt(index)))for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];else throwError({},"Unexpected token %0",ILLEGAL);return isIdentifierStart(source.charCodeAt(index))&&throwError({},"Unexpected token %0",ILLEGAL),{type:6,value:parseFloat(number),start:start,end:index}}function scanRegExp(){var start,body,flags,value;return lookahead=null,skipComment(),start=index,body=function(){var ch,str,classMarker,terminated;for(assert("/"===(ch=source[index]),"Regular expression literal must start with a slash"),str=source[index++],classMarker=!1,terminated=!1;index<length;)if(str+=ch=source[index++],"\\"===ch)isLineTerminator((ch=source[index++]).charCodeAt(0))&&throwError({},"Invalid regular expression: missing /"),str+=ch;else if(isLineTerminator(ch.charCodeAt(0)))throwError({},"Invalid regular expression: missing /");else if(classMarker)"]"===ch&&(classMarker=!1);else{if("/"===ch){terminated=!0;break}"["===ch&&(classMarker=!0)}return terminated||throwError({},"Invalid regular expression: missing /"),{value:str.substr(1,str.length-2),literal:str}}(),flags=function(){var ch,str,flags;for(str="",flags="";index<length&&isIdentifierPart((ch=source[index]).charCodeAt(0));)++index,"\\"===ch&&index<length?throwError({},"Unexpected token %0",ILLEGAL):(flags+=ch,str+=ch);return flags.search(/[^gimuy]/g)>=0&&throwError({},"Invalid regular expression",flags),{value:flags,literal:str}}(),value=function(pattern,flags){let tmp=pattern;flags.indexOf("u")>=0&&(tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}/g,($0,$1)=>{if(parseInt($1,16)<=1114111)return"x";throwError({},"Invalid regular expression")}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(tmp)}catch(e){throwError({},"Invalid regular expression")}try{return new RegExp(pattern,flags)}catch(exception){return null}}(body.value,flags.value),{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index}}function advance(){if(skipComment(),index>=length)return{type:2,start:index,end:index};const ch=source.charCodeAt(index);return isIdentifierStart(ch)?scanIdentifier():40===ch||41===ch||59===ch?scanPunctuator():39===ch||34===ch?function(){var quote,start,ch,code,str="",octal=!1;for(assert("'"===(quote=source[index])||'"'===quote,"String literal must starts with a quote"),start=index,++index;index<length;){if((ch=source[index++])===quote){quote="";break}if("\\"===ch)if((ch=source[index++])&&isLineTerminator(ch.charCodeAt(0)))"\r"===ch&&"\n"===source[index]&&++index;else switch(ch){case"u":case"x":"{"===source[index]?(++index,str+=scanUnicodeCodePointEscape()):str+=scanHexEscape(ch);break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;default:isOctalDigit(ch)?(0!==(code="01234567".indexOf(ch))&&(octal=!0),index<length&&isOctalDigit(source[index])&&(octal=!0,code=8*code+"01234567".indexOf(source[index++]),"0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])&&(code=8*code+"01234567".indexOf(source[index++]))),str+=String.fromCharCode(code)):str+=ch}else{if(isLineTerminator(ch.charCodeAt(0)))break;str+=ch}}return""!==quote&&throwError({},"Unexpected token %0",ILLEGAL),{type:8,value:str,octal:octal,start:start,end:index}}():46===ch?isDecimalDigit(source.charCodeAt(index+1))?scanNumericLiteral():scanPunctuator():isDecimalDigit(ch)?scanNumericLiteral():scanPunctuator()}function lex(){const token=lookahead;return index=token.end,lookahead=advance(),index=token.end,token}function peek(){const pos=index;lookahead=advance(),index=pos}function finishBinaryExpression(operator,left,right){const node=new ASTNode("||"===operator||"&&"===operator?"LogicalExpression":"BinaryExpression");return node.operator=operator,node.left=left,node.right=right,node}function finishCallExpression(callee,args){const node=new ASTNode("CallExpression");return node.callee=callee,node.arguments=args,node}function finishIdentifier(name){const node=new ASTNode("Identifier");return node.name=name,node}function finishLiteral(token){const node=new ASTNode("Literal");return node.value=token.value,node.raw=source.slice(token.start,token.end),token.regex&&("//"===node.raw&&(node.raw="/(?:)/"),node.regex=token.regex),node}function finishMemberExpression(accessor,object,property){const node=new ASTNode("MemberExpression");return node.computed="["===accessor,node.object=object,node.property=property,node.computed||(property.member=!0),node}function finishProperty(kind,key,value){const node=new ASTNode("Property");return node.key=key,node.value=value,node.kind=kind,node}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,(whole,index)=>(assert(index<args.length,"Message reference must be in range"),args[index]));throw(error=new Error(msg)).index=index,error.description=msg,error}function throwUnexpected(token){2===token.type&&throwError(token,"Unexpected end of input"),6===token.type&&throwError(token,"Unexpected number"),8===token.type&&throwError(token,"Unexpected string"),3===token.type&&throwError(token,"Unexpected identifier"),4===token.type&&throwError(token,"Unexpected reserved word"),throwError(token,"Unexpected token %0",token.value)}function expect(value){const token=lex();7===token.type&&token.value===value||throwUnexpected(token)}function match(value){return 7===lookahead.type&&lookahead.value===value}function matchKeyword(keyword){return 4===lookahead.type&&lookahead.value===keyword}function parseArrayInitialiser(){const elements=[];for(index=lookahead.start,expect("[");!match("]");)match(",")?(lex(),elements.push(null)):(elements.push(parseConditionalExpression()),match("]")||expect(","));return lex(),function(elements){const node=new ASTNode("ArrayExpression");return node.elements=elements,node}(elements)}function parseObjectPropertyKey(){index=lookahead.start;const token=lex();return 8===token.type||6===token.type?(token.octal&&throwError(token,"Octal literals are not allowed in strict mode."),finishLiteral(token)):finishIdentifier(token.value)}function parseObjectProperty(){var token,key,id;return index=lookahead.start,3===(token=lookahead).type?(id=parseObjectPropertyKey(),expect(":"),finishProperty("init",id,parseConditionalExpression())):2!==token.type&&7!==token.type?(key=parseObjectPropertyKey(),expect(":"),finishProperty("init",key,parseConditionalExpression())):void throwUnexpected(token)}function parseObjectInitialiser(){var property,key,properties=[],map={},toString=String;for(index=lookahead.start,expect("{");!match("}");)key="$"+("Identifier"===(property=parseObjectProperty()).key.type?property.key.name:toString(property.key.value)),Object.prototype.hasOwnProperty.call(map,key)?throwError({},"Duplicate data property in object literal not allowed in strict mode"):map[key]=!0,properties.push(property),match("}")||expect(",");return expect("}"),function(properties){const node=new ASTNode("ObjectExpression");return node.properties=properties,node}(properties)}const legalKeywords={if:1};function parsePrimaryExpression(){var type,token,expr;if(match("("))return function(){expect("(");const expr=parseExpression();return expect(")"),expr}();if(match("["))return parseArrayInitialiser();if(match("{"))return parseObjectInitialiser();if(type=lookahead.type,index=lookahead.start,3===type||legalKeywords[lookahead.value])expr=finishIdentifier(lex().value);else if(8===type||6===type)lookahead.octal&&throwError(lookahead,"Octal literals are not allowed in strict mode."),expr=finishLiteral(lex());else{if(4===type)throw new Error("Disabled.");1===type?((token=lex()).value="true"===token.value,expr=finishLiteral(token)):5===type?((token=lex()).value=null,expr=finishLiteral(token)):match("/")||match("/=")?(expr=finishLiteral(scanRegExp()),peek()):throwUnexpected(lex())}return expr}function parseArguments(){const args=[];if(expect("("),!match(")"))for(;index<length&&(args.push(parseConditionalExpression()),!match(")"));)expect(",");return expect(")"),args}function parseNonComputedMember(){return expect("."),function(){index=lookahead.start;const token=lex();return function(token){return 3===token.type||4===token.type||1===token.type||5===token.type}(token)||throwUnexpected(token),finishIdentifier(token.value)}()}function parseComputedMember(){expect("[");const expr=parseExpression();return expect("]"),expr}function parsePostfixExpression(){const expr=function(){var expr;for(expr=parsePrimaryExpression();;)if(match("."))expr=finishMemberExpression(".",expr,parseNonComputedMember());else if(match("("))expr=finishCallExpression(expr,parseArguments());else{if(!match("["))break;expr=finishMemberExpression("[",expr,parseComputedMember())}return expr}();if(7===lookahead.type&&(match("++")||match("--")))throw new Error("Disabled.");return expr}function parseUnaryExpression(){var token,expr;if(7!==lookahead.type&&4!==lookahead.type)expr=parsePostfixExpression();else{if(match("++")||match("--"))throw new Error("Disabled.");if(match("+")||match("-")||match("~")||match("!"))token=lex(),expr=parseUnaryExpression(),expr=function(operator,argument){const node=new ASTNode("UnaryExpression");return node.operator=operator,node.argument=argument,node.prefix=!0,node}(token.value,expr);else{if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof"))throw new Error("Disabled.");expr=parsePostfixExpression()}}return expr}function binaryPrecedence(token){let prec=0;if(7!==token.type&&4!==token.type)return 0;switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":prec=7;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11}return prec}function parseConditionalExpression(){var expr,consequent;return expr=function(){var marker,markers,expr,token,prec,stack,right,operator,left,i;if(marker=lookahead,left=parseUnaryExpression(),0===(prec=binaryPrecedence(token=lookahead)))return left;for(token.prec=prec,lex(),markers=[marker,lookahead],stack=[left,token,right=parseUnaryExpression()];(prec=binaryPrecedence(lookahead))>0;){for(;stack.length>2&&prec<=stack[stack.length-2].prec;)right=stack.pop(),operator=stack.pop().value,left=stack.pop(),markers.pop(),expr=finishBinaryExpression(operator,left,right),stack.push(expr);(token=lex()).prec=prec,stack.push(token),markers.push(lookahead),expr=parseUnaryExpression(),stack.push(expr)}for(expr=stack[i=stack.length-1],markers.pop();i>1;)markers.pop(),expr=finishBinaryExpression(stack[i-1].value,stack[i-2],expr),i-=2;return expr}(),match("?")&&(lex(),consequent=parseConditionalExpression(),expect(":"),expr=function(test,consequent,alternate){const node=new ASTNode("ConditionalExpression");return node.test=test,node.consequent=consequent,node.alternate=alternate,node}(expr,consequent,parseConditionalExpression())),expr}function parseExpression(){const expr=parseConditionalExpression();if(match(","))throw new Error("Disabled.");return expr}var Constants={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Functions(codegen){function fn(name,cast,type){return args=>function(name,args,cast,type){let obj=codegen(args[0]);return cast&&(obj=cast+"("+obj+")",0===cast.lastIndexOf("new ",0)&&(obj="("+obj+")")),obj+"."+name+(type<0?"":0===type?"()":"("+args.slice(1).map(codegen).join(",")+")")}(name,args,cast,type)}const DATE="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(args){args.length<3&&vegaUtil.error("Missing arguments to clamp function."),args.length>3&&vegaUtil.error("Too many arguments to clamp function.");const a=args.map(codegen);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:DATE,date:fn("getDate",DATE,0),day:fn("getDay",DATE,0),year:fn("getFullYear",DATE,0),month:fn("getMonth",DATE,0),hours:fn("getHours",DATE,0),minutes:fn("getMinutes",DATE,0),seconds:fn("getSeconds",DATE,0),milliseconds:fn("getMilliseconds",DATE,0),time:fn("getTime",DATE,0),timezoneoffset:fn("getTimezoneOffset",DATE,0),utcdate:fn("getUTCDate",DATE,0),utcday:fn("getUTCDay",DATE,0),utcyear:fn("getUTCFullYear",DATE,0),utcmonth:fn("getUTCMonth",DATE,0),utchours:fn("getUTCHours",DATE,0),utcminutes:fn("getUTCMinutes",DATE,0),utcseconds:fn("getUTCSeconds",DATE,0),utcmilliseconds:fn("getUTCMilliseconds",DATE,0),length:fn("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:fn("toUpperCase","String",0),lower:fn("toLowerCase","String",0),substring:fn("substring","String"),split:fn("split","String"),trim:fn("trim","String",0),regexp:"RegExp",test:fn("test","RegExp"),if:function(args){args.length<3&&vegaUtil.error("Missing arguments to if function."),args.length>3&&vegaUtil.error("Too many arguments to if function.");const a=args.map(codegen);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}exports.ASTNode=ASTNode,exports.ArrayExpression="ArrayExpression",exports.BinaryExpression="BinaryExpression",exports.CallExpression="CallExpression",exports.ConditionalExpression="ConditionalExpression",exports.Identifier="Identifier",exports.Literal="Literal",exports.LogicalExpression="LogicalExpression",exports.MemberExpression="MemberExpression",exports.ObjectExpression="ObjectExpression",exports.Property="Property",exports.RawCode="RawCode",exports.UnaryExpression="UnaryExpression",exports.codegen=function(opt){const allowed=(opt=opt||{}).allowed?vegaUtil.toSet(opt.allowed):{},forbidden=opt.forbidden?vegaUtil.toSet(opt.forbidden):{},constants=opt.constants||Constants,functions=(opt.functions||Functions)(visit),globalvar=opt.globalvar,fieldvar=opt.fieldvar,outputGlobal=vegaUtil.isFunction(globalvar)?globalvar:id=>`${globalvar}["${id}"]`;let globals={},fields={},memberDepth=0;function visit(ast){if(vegaUtil.isString(ast))return ast;const generator=Generators[ast.type];return null==generator&&vegaUtil.error("Unsupported type: "+ast.type),generator(ast)}const Generators={Literal:n=>n.raw,Identifier:n=>{const id=n.name;return memberDepth>0?id:vegaUtil.hasOwnProperty(forbidden,id)?vegaUtil.error("Illegal identifier: "+id):vegaUtil.hasOwnProperty(constants,id)?constants[id]:vegaUtil.hasOwnProperty(allowed,id)?id:(globals[id]=1,outputGlobal(id))},MemberExpression:n=>{const d=!n.computed,o=visit(n.object);d&&(memberDepth+=1);const p=visit(n.property);return o===fieldvar&&(fields[function(s){const n=s&&s.length-1;return n&&('"'===s[0]&&'"'===s[n]||"'"===s[0]&&"'"===s[n])?s.slice(1,-1):s}(p)]=1),d&&(memberDepth-=1),o+(d?"."+p:"["+p+"]")},CallExpression:n=>{"Identifier"!==n.callee.type&&vegaUtil.error("Illegal callee type: "+n.callee.type);const callee=n.callee.name,args=n.arguments,fn=vegaUtil.hasOwnProperty(functions,callee)&&functions[callee];return fn||vegaUtil.error("Unrecognized function: "+callee),vegaUtil.isFunction(fn)?fn(args):fn+"("+args.map(visit).join(",")+")"},ArrayExpression:n=>"["+n.elements.map(visit).join(",")+"]",BinaryExpression:n=>"("+visit(n.left)+" "+n.operator+" "+visit(n.right)+")",UnaryExpression:n=>"("+n.operator+visit(n.argument)+")",ConditionalExpression:n=>"("+visit(n.test)+"?"+visit(n.consequent)+":"+visit(n.alternate)+")",LogicalExpression:n=>"("+visit(n.left)+n.operator+visit(n.right)+")",ObjectExpression:n=>"{"+n.properties.map(visit).join(",")+"}",Property:n=>{memberDepth+=1;const k=visit(n.key);return memberDepth-=1,k+":"+visit(n.value)}};function codegen(ast){const result={code:visit(ast),globals:Object.keys(globals),fields:Object.keys(fields)};return globals={},fields={},result}return codegen.functions=functions,codegen.constants=constants,codegen},exports.constants=Constants,exports.functions=Functions,exports.parse=function(code){index=0,length=(source=code).length,lookahead=null,peek();const expr=parseExpression();if(2!==lookahead.type)throw new Error("Unexpect token after expression.");return expr},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37))},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaDataflow){"use strict";const Skip=vegaUtil.toSet(["rule"]),Swap=vegaUtil.toSet(["group","image","rect"]);function canonicalType(type){return(type+"").toLowerCase()}function expression(ctx,args,code){";"!==code[code.length-1]&&(code="return("+code+");");const fn=Function(...args.concat(code));return ctx&&ctx.functions?fn.bind(ctx.functions):fn}var expressionCodegen={operator:(ctx,expr)=>expression(ctx,["_"],expr.code),parameter:(ctx,expr)=>expression(ctx,["datum","_"],expr.code),event:(ctx,expr)=>expression(ctx,["event"],expr.code),handler:(ctx,expr)=>expression(ctx,["_","event"],`var datum=event.item&&event.item.datum;return ${expr.code};`),encode:(ctx,encode)=>{const{marktype:marktype,channels:channels}=encode;let code="var o=item,datum=o.datum,m=0,$;";for(const name in channels){const o="o["+vegaUtil.stringValue(name)+"]";code+=`$=${channels[name].code};if(${o}!==$)${o}=$,m=1;`}return code+=function(encode,marktype){let code="";return Skip[marktype]||(encode.x2&&(encode.x?(Swap[marktype]&&(code+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),code+="o.width=o.x2-o.x;"):code+="o.x=o.x2-(o.width||0);"),encode.xc&&(code+="o.x=o.xc-(o.width||0)/2;"),encode.y2&&(encode.y?(Swap[marktype]&&(code+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),code+="o.height=o.y2-o.y;"):code+="o.y=o.y2-(o.height||0);"),encode.yc&&(code+="o.y=o.yc-(o.height||0)/2;")),code}(channels,marktype),code+="return m;",expression(ctx,["item","_"],code)},codegen:{get(path){const ref=`[${path.map(vegaUtil.stringValue).join("][")}]`,get=Function("_",`return _${ref};`);return get.path=ref,get},comparator(fields,orders){let t;const fn=Function("a","b","var u, v; return "+fields.map((f,i)=>{const o=orders[i];let u,v;return f.path?(u="a"+f.path,v="b"+f.path):((t=t||{})["f"+i]=f,u=`this.f${i}(a)`,v=`this.f${i}(b)`),function(u,v,lt,gt){return`((u = ${u}) < (v = ${v}) || u == null) && v != null ? ${lt}\n  : (u > v || v == null) && u != null ? ${gt}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${lt}\n  : v !== v && u === u ? ${gt} : `}(u,v,-o,o)}).join("")+"0;");return t?fn.bind(t):fn}}};function parseParameter(spec,ctx,params){if(!spec||!vegaUtil.isObject(spec))return spec;for(let p,i=0,n=PARSERS.length;i<n;++i)if(p=PARSERS[i],vegaUtil.hasOwnProperty(spec,p.key))return p.parse(spec,ctx,params);return spec}var PARSERS=[{key:"$ref",parse:function(_,ctx){return ctx.get(_.$ref)||vegaUtil.error("Operator not defined: "+_.$ref)}},{key:"$key",parse:function(_,ctx){const k="k:"+_.$key+"_"+!!_.$flat;return ctx.fn[k]||(ctx.fn[k]=vegaUtil.key(_.$key,_.$flat,ctx.expr.codegen))}},{key:"$expr",parse:function(_,ctx,params){_.$params&&ctx.parseParameters(_.$params,params);const k="e:"+_.$expr.code+"_"+_.$name;return ctx.fn[k]||(ctx.fn[k]=vegaUtil.accessor(ctx.parameterExpression(_.$expr),_.$fields,_.$name))}},{key:"$field",parse:function(_,ctx){if(!_.$field)return null;const k="f:"+_.$field+"_"+_.$name;return ctx.fn[k]||(ctx.fn[k]=vegaUtil.field(_.$field,_.$name,ctx.expr.codegen))}},{key:"$encode",parse:function(_,ctx){const spec=_.$encode,encode={};for(const name in spec){const enc=spec[name];encode[name]=vegaUtil.accessor(ctx.encodeExpression(enc.$expr),enc.$fields),encode[name].output=enc.$output}return encode}},{key:"$compare",parse:function(_,ctx){const k="c:"+_.$compare+"_"+_.$order,c=vegaUtil.array(_.$compare).map(_=>_&&_.$tupleid?vegaDataflow.tupleid:_);return ctx.fn[k]||(ctx.fn[k]=vegaUtil.compare(c,_.$order,ctx.expr.codegen))}},{key:"$context",parse:function(_,ctx){return ctx}},{key:"$subflow",parse:function(_,ctx){const spec=_.$subflow;return function(dataflow,key,parent){const subctx=ctx.fork().parse(spec),op=subctx.get(spec.operators[0].id),p=subctx.signals.parent;return p&&p.set(parent),op.detachSubflow=()=>ctx.detach(subctx),op}}},{key:"$tupleid",parse:function(){return vegaDataflow.tupleid}}];const SKIP={skip:!0};function Context(df,transforms,functions,expr){this.dataflow=df,this.transforms=transforms,this.events=df.events.bind(df),this.expr=expr||expressionCodegen,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},functions&&(this.functions=Object.create(functions),this.functions.context=this)}function Subcontext(ctx){this.dataflow=ctx.dataflow,this.transforms=ctx.transforms,this.events=ctx.events,this.expr=ctx.expr,this.signals=Object.create(ctx.signals),this.scales=Object.create(ctx.scales),this.nodes=Object.create(ctx.nodes),this.data=Object.create(ctx.data),this.fn=Object.create(ctx.fn),ctx.functions&&(this.functions=Object.create(ctx.functions),this.functions.context=this)}Context.prototype=Subcontext.prototype={fork(){const ctx=new Subcontext(this);return(this.subcontext||(this.subcontext=[])).push(ctx),ctx},detach(ctx){this.subcontext=this.subcontext.filter(c=>c!==ctx);const keys=Object.keys(ctx.nodes);for(const key of keys)ctx.nodes[key]._targets=null;for(const key of keys)ctx.nodes[key].detach();ctx.nodes=null},get(id){return this.nodes[id]},set(id,node){return this.nodes[id]=node},add(spec,op){const ctx=this,df=ctx.dataflow,data=spec.value;if(ctx.set(spec.id,op),"collect"===canonicalType(spec.type)&&data&&(data.$ingest?df.ingest(op,data.$ingest,data.$format):data.$request?df.preload(op,data.$request,data.$format):df.pulse(op,df.changeset().insert(data))),spec.root&&(ctx.root=op),spec.parent){let p=ctx.get(spec.parent.$ref);p?(df.connect(p,[op]),op.targets().add(p)):(ctx.unresolved=ctx.unresolved||[]).push(()=>{p=ctx.get(spec.parent.$ref),df.connect(p,[op]),op.targets().add(p)})}if(spec.signal&&(ctx.signals[spec.signal]=op),spec.scale&&(ctx.scales[spec.scale]=op),spec.data)for(const name in spec.data){const data=ctx.data[name]||(ctx.data[name]={});spec.data[name].forEach(role=>data[role]=op)}},resolve(){return(this.unresolved||[]).forEach(fn=>fn()),delete this.unresolved,this},operator(spec,update){this.add(spec,this.dataflow.add(spec.value,update))},transform(spec,type){this.add(spec,this.dataflow.add(this.transforms[canonicalType(type)]))},stream(spec,stream){this.set(spec.id,stream)},update(spec,stream,target,update,params){this.dataflow.on(stream,target,update,params,spec.options)},operatorExpression(expr){return this.expr.operator(this,expr)},parameterExpression(expr){return this.expr.parameter(this,expr)},eventExpression(expr){return this.expr.event(this,expr)},handlerExpression(expr){return this.expr.handler(this,expr)},encodeExpression(encode){return this.expr.encode(this,encode)},parse:function(spec){const ctx=this,operators=spec.operators||[];return spec.background&&(ctx.background=spec.background),spec.eventConfig&&(ctx.eventConfig=spec.eventConfig),spec.locale&&(ctx.locale=spec.locale),operators.forEach(entry=>ctx.parseOperator(entry)),operators.forEach(entry=>ctx.parseOperatorParameters(entry)),(spec.streams||[]).forEach(entry=>ctx.parseStream(entry)),(spec.updates||[]).forEach(entry=>ctx.parseUpdate(entry)),ctx.resolve()},parseOperator:function(spec){const ctx=this;"operator"!==canonicalType(spec.type)&&spec.type?ctx.transform(spec,spec.type):ctx.operator(spec,spec.update?ctx.operatorExpression(spec.update):null)},parseOperatorParameters:function(spec){const ctx=this;if(spec.params){const op=ctx.get(spec.id);op||vegaUtil.error("Invalid operator id: "+spec.id),ctx.dataflow.connect(op,op.parameters(ctx.parseParameters(spec.params),spec.react,spec.initonly))}},parseParameters:function(spec,params){params=params||{};const ctx=this;for(const key in spec){const value=spec[key];params[key]=vegaUtil.isArray(value)?value.map(v=>parseParameter(v,ctx,params)):parseParameter(value,ctx,params)}return params},parseStream:function(spec){var args,ctx=this,filter=null!=spec.filter?ctx.eventExpression(spec.filter):void 0,stream=null!=spec.stream?ctx.get(spec.stream):void 0;spec.source?stream=ctx.events(spec.source,spec.type,filter):spec.merge&&(stream=(args=spec.merge.map(_=>ctx.get(_)))[0].merge.apply(args[0],args.slice(1))),spec.between&&(args=spec.between.map(_=>ctx.get(_)),stream=stream.between(args[0],args[1])),spec.filter&&(stream=stream.filter(filter)),null!=spec.throttle&&(stream=stream.throttle(+spec.throttle)),null!=spec.debounce&&(stream=stream.debounce(+spec.debounce)),null==stream&&vegaUtil.error("Invalid stream definition: "+JSON.stringify(spec)),spec.consume&&stream.consume(!0),ctx.stream(spec,stream)},parseUpdate:function(spec){var target,srcid=vegaUtil.isObject(srcid=spec.source)?srcid.$ref:srcid,source=this.get(srcid),update=spec.update,params=void 0;source||vegaUtil.error("Source not defined: "+spec.source),target=spec.target&&spec.target.$expr?this.eventExpression(spec.target.$expr):this.get(spec.target),update&&update.$expr&&(update.$params&&(params=this.parseParameters(update.$params)),update=this.handlerExpression(update.$expr)),this.update(spec,source,target,update,params)},getState:function(options){var ctx=this,state={};if(options.signals){var signals=state.signals={};Object.keys(ctx.signals).forEach(key=>{const op=ctx.signals[key];options.signals(key,op)&&(signals[key]=op.value)})}if(options.data){var data=state.data={};Object.keys(ctx.data).forEach(key=>{const dataset=ctx.data[key];options.data(key,dataset)&&(data[key]=dataset.input.value)})}return ctx.subcontext&&!1!==options.recurse&&(state.subcontext=ctx.subcontext.map(ctx=>ctx.getState(options))),state},setState:function(state){var ctx=this,df=ctx.dataflow,data=state.data,signals=state.signals;Object.keys(signals||{}).forEach(key=>{df.update(ctx.signals[key],signals[key],SKIP)}),Object.keys(data||{}).forEach(key=>{df.pulse(ctx.data[key].input,df.changeset().remove(vegaUtil.truthy).insert(data[key]))}),(state.subcontext||[]).forEach((substate,i)=>{const subctx=ctx.subcontext[i];subctx&&subctx.setState(substate)})}},exports.context=function(df,transforms,functions,expr){return new Context(df,transforms,functions,expr)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(40))},function(module,exports,__webpack_require__){(function(Buffer){!function(exports,vegaUtil,vega){"use strict";var pkg_version="5.0.0";Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function r(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(a,e){return Array.isArray(e)?a.push.apply(a,r.call(e,t-1)):a.push(e),a}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(r){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var clone_1=function(fn){var module={exports:{}};return fn(module,module.exports),module.exports}((function(module){var clone=function(){function _instanceof(obj,type){return null!=type&&obj instanceof type}var nativeMap,nativeSet,nativePromise;try{nativeMap=Map}catch(_){nativeMap=function(){}}try{nativeSet=Set}catch(_){nativeSet=function(){}}try{nativePromise=Promise}catch(_){nativePromise=function(){}}function clone(parent,circular,depth,prototype,includeNonEnumerable){"object"==typeof circular&&(depth=circular.depth,prototype=circular.prototype,includeNonEnumerable=circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer=void 0!==Buffer;return void 0===circular&&(circular=!0),void 0===depth&&(depth=1/0),function _clone(parent,depth){if(null===parent)return null;if(0===depth)return parent;var child,proto;if("object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,nativePromise))child=new nativePromise((function(resolve,reject){parent.then((function(value){resolve(_clone(value,depth-1))}),(function(err){reject(_clone(err,depth-1))}))}));else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=Buffer.allocUnsafe?Buffer.allocUnsafe(parent.length):new Buffer(parent.length),parent.copy(child),child;_instanceof(parent,Error)?child=Object.create(parent):void 0===prototype?(proto=Object.getPrototypeOf(parent),child=Object.create(proto)):(child=Object.create(prototype),proto=prototype)}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent),allChildren.push(child)}for(var i in _instanceof(parent,nativeMap)&&parent.forEach((function(value,key){var keyChild=_clone(key,depth-1),valueChild=_clone(value,depth-1);child.set(keyChild,valueChild)})),_instanceof(parent,nativeSet)&&parent.forEach((function(value){var entryChild=_clone(value,depth-1);child.add(entryChild)})),parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i)),attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(parent);for(i=0;i<symbols.length;i++){var symbol=symbols[i];(!(descriptor=Object.getOwnPropertyDescriptor(parent,symbol))||descriptor.enumerable||includeNonEnumerable)&&(child[symbol]=_clone(parent[symbol],depth-1),descriptor.enumerable||Object.defineProperty(child,symbol,{enumerable:!1}))}}if(includeNonEnumerable){var allPropertyNames=Object.getOwnPropertyNames(parent);for(i=0;i<allPropertyNames.length;i++){var descriptor,propertyName=allPropertyNames[i];(descriptor=Object.getOwnPropertyDescriptor(parent,propertyName))&&descriptor.enumerable||(child[propertyName]=_clone(parent[propertyName],depth-1),Object.defineProperty(child,propertyName,{enumerable:!1}))}}return child}(parent,depth)}function __objToStr(o){return Object.prototype.toString.call(o)}function __getRegExpFlags(re){var flags="";return re.global&&(flags+="g"),re.ignoreCase&&(flags+="i"),re.multiline&&(flags+="m"),flags}return clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};return c.prototype=parent,new c},clone.__objToStr=__objToStr,clone.__isDate=function(o){return"object"==typeof o&&"[object Date]"===__objToStr(o)},clone.__isArray=function(o){return"object"==typeof o&&"[object Array]"===__objToStr(o)},clone.__isRegExp=function(o){return"object"==typeof o&&"[object RegExp]"===__objToStr(o)},clone.__getRegExpFlags=__getRegExpFlags,clone}();module.exports&&(module.exports=clone)})),fastJsonStableStringify=function(data,opts){opts||(opts={}),"function"==typeof opts&&(opts={cmp:opts});var f,cycles="boolean"==typeof opts.cycles&&opts.cycles,cmp=opts.cmp&&(f=opts.cmp,function(node){return function(a,b){var aobj={key:a,value:node[a]},bobj={key:b,value:node[b]};return f(aobj,bobj)}}),seen=[];return function stringify(node){if(node&&node.toJSON&&"function"==typeof node.toJSON&&(node=node.toJSON()),void 0!==node){if("number"==typeof node)return isFinite(node)?""+node:"null";if("object"!=typeof node)return JSON.stringify(node);var i,out;if(Array.isArray(node)){for(out="[",i=0;i<node.length;i++)i&&(out+=","),out+=stringify(node[i])||"null";return out+"]"}if(null===node)return"null";if(-1!==seen.indexOf(node)){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var seenIndex=seen.push(node)-1,keys=Object.keys(node).sort(cmp&&cmp(node));for(out="",i=0;i<keys.length;i++){var key=keys[i],value=stringify(node[key]);value&&(out&&(out+=","),out+=JSON.stringify(key)+":"+value)}return seen.splice(seenIndex,1),"{"+out+"}"}}(data)};function isLogicalOr(op){return!!op.or}function isLogicalAnd(op){return!!op.and}function isLogicalNot(op){return!!op.not}function normalizeLogicalComposition(op,normalizer){return isLogicalNot(op)?{not:normalizeLogicalComposition(op.not,normalizer)}:isLogicalAnd(op)?{and:op.and.map(o=>normalizeLogicalComposition(o,normalizer))}:isLogicalOr(op)?{or:op.or.map(o=>normalizeLogicalComposition(o,normalizer))}:normalizer(op)}const deepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(a.constructor!==b.constructor)return!1;var length,i,keys;if(Array.isArray(a)){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();if((length=(keys=Object.keys(a)).length)!==Object.keys(b).length)return!1;for(i=length;0!=i--;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return!1;for(i=length;0!=i--;){var key=keys[i];if(!equal(a[key],b[key]))return!1}return!0}return a!=a&&b!=b},duplicate=clone_1;function pick(obj,props){const copy={};for(const prop of props)vegaUtil.hasOwnProperty(obj,prop)&&(copy[prop]=obj[prop]);return copy}function omit(obj,props){const copy={...obj};for(const prop of props)delete copy[prop];return copy}Set.prototype.toJSON=function(){return"Set(".concat([...this].map(x=>fastJsonStableStringify(x)).join(","),")")};const stringify=fastJsonStableStringify;function hash(a){if(vegaUtil.isNumber(a))return a;const str=vegaUtil.isString(a)?a:fastJsonStableStringify(a);if(str.length<250)return str;let h=0;for(let i=0;i<str.length;i++)h=(h<<5)-h+str.charCodeAt(i),h&=h;return h}function isNullOrFalse(x){return!1===x||null===x}function contains(array,item){return array.includes(item)}function some(arr,f){let i=0;for(const[k,a]of arr.entries())if(f(a,k,i++))return!0;return!1}function every(arr,f){let i=0;for(const[k,a]of arr.entries())if(!f(a,k,i++))return!1;return!0}function mergeDeep(dest,...src){for(const s of src)deepMerge_(dest,null!=s?s:{});return dest}function deepMerge_(dest,src){for(const property of keys(src))vegaUtil.writeConfig(dest,property,src[property],!0)}function unique(values,f){const results=[],u={};let v;for(const val of values)v=f(val),v in u||(u[v]=1,results.push(val));return results}function setEqual(a,b){if(a.size!==b.size)return!1;for(const e of a)if(!b.has(e))return!1;return!0}function hasIntersection(a,b){for(const key of a)if(b.has(key))return!0;return!1}function prefixGenerator(a){const prefixes=new Set;for(const x of a){const wrappedWithAccessors=vegaUtil.splitAccessPath(x).map((y,i)=>0===i?y:"[".concat(y,"]")),computedPrefixes=wrappedWithAccessors.map((_,i)=>wrappedWithAccessors.slice(0,i+1).join(""));for(const y of computedPrefixes)prefixes.add(y)}return prefixes}function fieldIntersection(a,b){return void 0===a||void 0===b||hasIntersection(prefixGenerator(a),prefixGenerator(b))}function isEmpty(obj){return 0===keys(obj).length}const keys=Object.keys,vals=Object.values,entries=Object.entries;function isBoolean(b){return!0===b||!1===b}function varName(s){const alphanumericS=s.replace(/\W/g,"_");return(s.match(/^\d+/)?"_":"")+alphanumericS}function logicalExpr(op,cb){return isLogicalNot(op)?"!(".concat(logicalExpr(op.not,cb),")"):isLogicalAnd(op)?"(".concat(op.and.map(and=>logicalExpr(and,cb)).join(") && ("),")"):isLogicalOr(op)?"(".concat(op.or.map(or=>logicalExpr(or,cb)).join(") || ("),")"):cb(op)}function deleteNestedProperty(obj,orderedProps){if(0===orderedProps.length)return!0;const prop=orderedProps.shift();return prop in obj&&deleteNestedProperty(obj[prop],orderedProps)&&delete obj[prop],isEmpty(obj)}function titleCase(s){return s.charAt(0).toUpperCase()+s.substr(1)}function accessPathWithDatum(path,datum="datum"){const pieces=vegaUtil.splitAccessPath(path),prefixes=[];for(let i=1;i<=pieces.length;i++){const prefix="[".concat(pieces.slice(0,i).map(vegaUtil.stringValue).join("]["),"]");prefixes.push("".concat(datum).concat(prefix))}return prefixes.join(" && ")}function flatAccessWithDatum(path,datum="datum"){return"".concat(datum,"[").concat(vegaUtil.stringValue(vegaUtil.splitAccessPath(path).join(".")),"]")}function escapePathAccess(string){return string.replace(/(\[|\]|\.|'|")/g,"\\$1")}function replacePathInField(path){return"".concat(vegaUtil.splitAccessPath(path).map(escapePathAccess).join("\\."))}function replaceAll(string,find,replacement){return string.replace(new RegExp(find.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),replacement)}function removePathFromField(path){return"".concat(vegaUtil.splitAccessPath(path).join("."))}function accessPathDepth(path){return path?vegaUtil.splitAccessPath(path).length:0}function getFirstDefined(...args){for(const arg of args)if(void 0!==arg)return arg}let idCounter=42;function uniqueId(prefix){const id=++idCounter;return prefix?String(prefix)+id:id}function internalField(name){return isInternalField(name)?name:"__".concat(name)}function isInternalField(name){return name.startsWith("__")}function normalizeAngle(angle){if(void 0!==angle)return(angle%360+360)%360}function isNumeric(value){return!!vegaUtil.isNumber(value)||!isNaN(value)&&!isNaN(parseFloat(value))}const ROW="row",COLUMN="column",X="x",Y="y",X2="x2",Y2="y2",RADIUS="radius",THETA="theta",THETA2="theta2",COLOR="color",FILL="fill",STROKE="stroke",SHAPE="shape",SIZE="size",POLAR_POSITION_CHANNEL_INDEX={theta:1,theta2:1,radius:1,radius2:1};function isPolarPositionChannel(c){return c in POLAR_POSITION_CHANNEL_INDEX}const GEO_POSIITON_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1},GEOPOSITION_CHANNELS=keys(GEO_POSIITON_CHANNEL_INDEX),UNIT_CHANNEL_INDEX={x:1,y:1,x2:1,y2:1,...POLAR_POSITION_CHANNEL_INDEX,...GEO_POSIITON_CHANNEL_INDEX,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function isColorChannel(channel){return channel===COLOR||channel===FILL||channel===STROKE}const FACET_CHANNEL_INDEX={row:1,column:1,facet:1},FACET_CHANNELS=keys(FACET_CHANNEL_INDEX),CHANNEL_INDEX={...UNIT_CHANNEL_INDEX,...FACET_CHANNEL_INDEX},CHANNELS=keys(CHANNEL_INDEX),{order:_o,detail:_d,tooltip:_tt1,...SINGLE_DEF_CHANNEL_INDEX}=CHANNEL_INDEX,{row:_r,column:_c,facet:_f,...SINGLE_DEF_UNIT_CHANNEL_INDEX}=SINGLE_DEF_CHANNEL_INDEX;function isChannel(str){return!!CHANNEL_INDEX[str]}const SECONDARY_RANGE_CHANNEL=[X2,Y2,"latitude2","longitude2",THETA2,"radius2"];function isSecondaryRangeChannel(c){return getMainRangeChannel(c)!==c}function getMainRangeChannel(channel){switch(channel){case X2:return X;case Y2:return Y;case"latitude2":return"latitude";case"longitude2":return"longitude";case THETA2:return THETA;case"radius2":return RADIUS}return channel}function getVgPositionChannel(channel){if(isPolarPositionChannel(channel))switch(channel){case THETA:return"startAngle";case THETA2:return"endAngle";case RADIUS:return"outerRadius";case"radius2":return"innerRadius"}return channel}function getSecondaryRangeChannel(channel){switch(channel){case X:return X2;case Y:return Y2;case"latitude":return"latitude2";case"longitude":return"longitude2";case THETA:return THETA2;case RADIUS:return"radius2"}}function getSizeChannel(channel){switch(channel){case X:case X2:return"width";case Y:case Y2:return"height"}}const{x:_x,y:_y,x2:_x2,y2:_y2,latitude:_latitude,longitude:_longitude,latitude2:_latitude2,longitude2:_longitude2,theta:_theta,theta2:_theta2,radius:_radius,radius2:_radius2,...NONPOSITION_CHANNEL_INDEX}=UNIT_CHANNEL_INDEX,NONPOSITION_CHANNELS=keys(NONPOSITION_CHANNEL_INDEX),POSITION_SCALE_CHANNEL_INDEX={x:1,y:1},POSITION_SCALE_CHANNELS=keys(POSITION_SCALE_CHANNEL_INDEX);function isXorY(channel){return channel in POSITION_SCALE_CHANNEL_INDEX}const POLAR_POSITION_SCALE_CHANNEL_INDEX={theta:1,radius:1},POLAR_POSITION_SCALE_CHANNELS=keys(POLAR_POSITION_SCALE_CHANNEL_INDEX);function getPositionScaleChannel(sizeType){return"width"===sizeType?X:Y}const{text:_t,tooltip:_tt,href:_hr,url:_u,description:_al,detail:_dd,key:_k,order:_oo,...NONPOSITION_SCALE_CHANNEL_INDEX}=NONPOSITION_CHANNEL_INDEX,NONPOSITION_SCALE_CHANNELS=keys(NONPOSITION_SCALE_CHANNEL_INDEX),SCALE_CHANNEL_INDEX={...POSITION_SCALE_CHANNEL_INDEX,...POLAR_POSITION_SCALE_CHANNEL_INDEX,...NONPOSITION_SCALE_CHANNEL_INDEX},SCALE_CHANNELS=keys(SCALE_CHANNEL_INDEX);function isScaleChannel(channel){return!!SCALE_CHANNEL_INDEX[channel]}function supportMark(channel,mark){return function(channel){switch(channel){case COLOR:case FILL:case STROKE:case"description":case"detail":case"key":case"tooltip":case"href":case"order":case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"facet":case ROW:case COLUMN:return ALL_MARKS;case X:case Y:case"latitude":case"longitude":return ALL_MARKS_EXCEPT_GEOSHAPE;case X2:case Y2:case"latitude2":case"longitude2":return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case SIZE:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case"strokeDash":return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case SHAPE:return{point:"always",geoshape:"always"};case"text":return{text:"always"};case"angle":return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case THETA:case RADIUS:return{text:"always",arc:"always"};case THETA2:case"radius2":return{arc:"always"}}}(channel)[mark]}const ALL_MARKS={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:_g,...ALL_MARKS_EXCEPT_GEOSHAPE}=ALL_MARKS;function rangeType(channel){switch(channel){case X:case Y:case THETA:case RADIUS:case SIZE:case"angle":case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case X2:case Y2:case THETA2:case"radius2":return;case"facet":case ROW:case COLUMN:case SHAPE:case"strokeDash":case"text":case"tooltip":case"href":case"url":case"description":return"discrete";case COLOR:case FILL:case STROKE:return"flexible";case"latitude":case"longitude":case"latitude2":case"longitude2":case"detail":case"key":case"order":return}}const AGGREGATE_OP_INDEX={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},MULTIDOMAIN_SORT_OP_INDEX={count:1,min:1,max:1};function isArgminDef(a){return!!a&&!!a.argmin}function isArgmaxDef(a){return!!a&&!!a.argmax}function isAggregateOp(a){return vegaUtil.isString(a)&&!!AGGREGATE_OP_INDEX[a]}const COUNTING_OPS=["count","valid","missing","distinct"];function isCountingAggregateOp(aggregate){return vegaUtil.isString(aggregate)&&contains(COUNTING_OPS,aggregate)}const SUM_OPS=["count","sum","distinct","valid","missing"],SHARED_DOMAIN_OP_INDEX=vegaUtil.toSet(["mean","average","median","q1","q3","min","max"]);function binToString(bin){return vegaUtil.isBoolean(bin)&&(bin=normalizeBin(bin,void 0)),"bin"+keys(bin).map(p=>isParameterExtent(bin[p])?varName("_".concat(p,"_").concat(entries(bin[p]))):varName("_".concat(p,"_").concat(bin[p]))).join("")}function isBinning(bin){return!0===bin||isBinParams(bin)&&!bin.binned}function isBinned(bin){return"binned"===bin||isBinParams(bin)&&!0===bin.binned}function isBinParams(bin){return vegaUtil.isObject(bin)}function isParameterExtent(extent){return null==extent?void 0:extent.param}function autoMaxBins(channel){switch(channel){case ROW:case COLUMN:case SIZE:case COLOR:case FILL:case STROKE:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case SHAPE:return 6;case"strokeDash":return 4;default:return 10}}function isExprRef(o){return o&&!!o.expr}function replaceExprRef(index){const props=keys(index||{}),newIndex={};for(const prop of props)newIndex[prop]=signalRefOrValue(index[prop]);return newIndex}function extractTitleConfig(titleConfig){const{anchor:anchor,frame:frame,offset:offset,orient:orient,color:color,subtitleColor:subtitleColor,subtitleFont:subtitleFont,subtitleFontSize:subtitleFontSize,subtitleFontStyle:subtitleFontStyle,subtitleFontWeight:subtitleFontWeight,subtitleLineHeight:subtitleLineHeight,subtitlePadding:subtitlePadding,...rest}=titleConfig,titleMarkConfig={...rest,...color?{fill:color}:{}},nonMark={...anchor?{anchor:anchor}:{},...frame?{frame:frame}:{},...offset?{offset:offset}:{},...orient?{orient:orient}:{}},subtitle={...subtitleColor?{subtitleColor:subtitleColor}:{},...subtitleFont?{subtitleFont:subtitleFont}:{},...subtitleFontSize?{subtitleFontSize:subtitleFontSize}:{},...subtitleFontStyle?{subtitleFontStyle:subtitleFontStyle}:{},...subtitleFontWeight?{subtitleFontWeight:subtitleFontWeight}:{},...subtitleLineHeight?{subtitleLineHeight:subtitleLineHeight}:{},...subtitlePadding?{subtitlePadding:subtitlePadding}:{}};return{titleMarkConfig:titleMarkConfig,subtitleMarkConfig:pick(titleMarkConfig,["align","baseline","dx","dy","limit"]),nonMark:nonMark,subtitle:subtitle}}function isText(v){return vegaUtil.isString(v)||vegaUtil.isArray(v)&&vegaUtil.isString(v[0])}function isSignalRef(o){return o&&!!o.signal}function isVgRangeStep(range){return!!range.step}function isDataRefDomain(domain){return!vegaUtil.isArray(domain)&&"field"in domain&&"data"in domain}const VG_MARK_CONFIGS=keys({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),VG_MARK_INDEX={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},VG_CORNERRADIUS_CHANNELS=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function signalOrValueRefWithCondition(val){const condition=vegaUtil.isArray(val.condition)?val.condition.map(conditionalSignalRefOrValue):conditionalSignalRefOrValue(val.condition);return{...signalRefOrValue(val),condition:condition}}function signalRefOrValue(value){if(isExprRef(value)){const{expr:expr,...rest}=value;return{signal:expr,...rest}}return value}function conditionalSignalRefOrValue(value){if(isExprRef(value)){const{expr:expr,...rest}=value;return{signal:expr,...rest}}return value}function signalOrValueRef(value){if(isExprRef(value)){const{expr:expr,...rest}=value;return{signal:expr,...rest}}return isSignalRef(value)?value:void 0!==value?{value:value}:void 0}function exprFromValueOrSignalRef(ref){return isSignalRef(ref)?ref.signal:vegaUtil.stringValue(ref.value)}function signalOrStringValue(v){return isSignalRef(v)?v.signal:null==v?null:vegaUtil.stringValue(v)}function applyMarkConfig(e,model,propsList){for(const property of propsList){const value=getMarkConfig(property,model.markDef,model.config);void 0!==value&&(e[property]=signalOrValueRef(value))}return e}function getStyles(mark){var _mark$style;return[].concat(mark.type,null!==(_mark$style=mark.style)&&void 0!==_mark$style?_mark$style:[])}function getMarkPropOrConfig(channel,mark,config,opt={}){const{vgChannel:vgChannel,ignoreVgConfig:ignoreVgConfig}=opt;return vgChannel&&void 0!==mark[vgChannel]?mark[vgChannel]:void 0!==mark[channel]?mark[channel]:!ignoreVgConfig||vgChannel&&vgChannel!==channel?getMarkConfig(channel,mark,config,opt):void 0}function getMarkConfig(channel,mark,config,{vgChannel:vgChannel}={}){return getFirstDefined(vgChannel?getMarkStyleConfig(channel,mark,config.style):void 0,getMarkStyleConfig(channel,mark,config.style),vgChannel?config[mark.type][vgChannel]:void 0,config[mark.type][channel],vgChannel?config.mark[vgChannel]:config.mark[channel])}function getMarkStyleConfig(prop,mark,styleConfigIndex){return getStyleConfig(prop,getStyles(mark),styleConfigIndex)}function getStyleConfig(p,styles,styleConfigIndex){let value;styles=vegaUtil.array(styles);for(const style of styles){const styleConfig=styleConfigIndex[style];styleConfig&&void 0!==styleConfig[p]&&(value=styleConfig[p])}return value}function sortParams(orderDef,fieldRefOption){return vegaUtil.array(orderDef).reduce((s,orderChannelDef)=>{var _orderChannelDef$sort;return s.field.push(vgField(orderChannelDef,fieldRefOption)),s.order.push(null!==(_orderChannelDef$sort=orderChannelDef.sort)&&void 0!==_orderChannelDef$sort?_orderChannelDef$sort:"ascending"),s},{field:[],order:[]})}function mergeTitleFieldDefs(f1,f2){const merged=[...f1];return f2.forEach(fdToMerge=>{for(const fieldDef1 of merged)if(deepEqual(fieldDef1,fdToMerge))return;merged.push(fdToMerge)}),merged}function mergeTitle(title1,title2){return deepEqual(title1,title2)||!title2?title1:title1?[...vegaUtil.array(title1),...vegaUtil.array(title2)].join(", "):title2}function mergeTitleComponent(v1,v2){const v1Val=v1.value,v2Val=v2.value;if(null==v1Val||null===v2Val)return{explicit:v1.explicit,value:null};if((isText(v1Val)||isSignalRef(v1Val))&&(isText(v2Val)||isSignalRef(v2Val)))return{explicit:v1.explicit,value:mergeTitle(v1Val,v2Val)};if(isText(v1Val)||isSignalRef(v1Val))return{explicit:v1.explicit,value:v1Val};if(isText(v2Val)||isSignalRef(v2Val))return{explicit:v1.explicit,value:v2Val};if(!(isText(v1Val)||isSignalRef(v1Val)||isText(v2Val)||isSignalRef(v2Val)))return{explicit:v1.explicit,value:mergeTitleFieldDefs(v1Val,v2Val)};throw new Error("It should never reach here")}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function invalidSpec(spec){return"Invalid specification ".concat(stringify(spec),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}function containerSizeNonSingle(name){return"".concat("width"==name?"Width":"Height",' "container" only works for single views and layered views.')}function containerSizeNotCompatibleWithAutosize(name){const fitDirection="width"==name?"x":"y";return"".concat("width"==name?"Width":"Height",' "container" only works well with autosize "fit" or "fit-').concat(fitDirection,'".')}function droppingFit(channel){return channel?'Dropping "fit-'.concat(channel,'" because spec has discrete ').concat(getSizeChannel(channel),"."):'Dropping "fit" because spec has discrete size.'}function unknownField(channel){return"Unknown field for ".concat(channel,". Cannot calculate view size.")}function cannotProjectOnChannelWithoutField(channel){return'Cannot project a selection on encoding channel "'.concat(channel,'", which has no field.')}function cannotProjectAggregate(channel,aggregate){return'Cannot project a selection on encoding channel "'.concat(channel,'" as it uses an aggregate function ("').concat(aggregate,'").')}function selectionNotSupported(mark){return"Selection not supported for ".concat(mark," yet.")}function columnsNotSupportByRowCol(type){return'The "columns" property cannot be used when "'.concat(type,'" has nested row/column.')}function differentParse(field,local,ancestor){return'An ancestor parsed field "'.concat(field,'" as ').concat(ancestor," but a child wants to parse the field as ").concat(local,".")}function customFormatTypeNotAllowed(channel){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(channel," are dropped.")}function invalidFieldType(type){return'Invalid field type "'.concat(type,'".')}function droppingColor(type,opt){const{fill:fill,stroke:stroke}=opt;return"Dropping color ".concat(type," as the plot also has ").concat(fill&&stroke?"fill and stroke":fill?"fill":"stroke",".")}function emptyFieldDef(fieldDef,channel){return"Dropping ".concat(stringify(fieldDef),' from channel "').concat(channel,'" since it does not contain any data field, datum, value, or signal.')}function incompatibleChannel(channel,markOrFacet,when){return"".concat(channel,' dropped as it is incompatible with "').concat(markOrFacet,'"').concat(when?" when ".concat(when):"",".")}function channelShouldBeDiscrete(channel){return"".concat(channel," encoding should be discrete (ordinal / nominal / binned).")}function channelShouldBeDiscreteOrDiscretizing(channel){return"".concat(channel," encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).")}function discreteChannelCannotEncode(channel,type){return'Using discrete channel "'.concat(channel,'" to encode "').concat(type,'" field can be misleading as it does not encode ').concat("ordinal"===type?"order":"magnitude",".")}function unaggregateDomainHasNoEffectForRawField(fieldDef){return"Using unaggregated domain with raw field has no effect (".concat(stringify(fieldDef),").")}function unaggregateDomainWithNonSharedDomainOp(aggregate){return'Unaggregated domain not applicable for "'.concat(aggregate,'" since it produces values outside the origin domain of the source data.')}function unaggregatedDomainWithLogScale(fieldDef){return"Unaggregated domain is currently unsupported for log scale (".concat(stringify(fieldDef),").")}function scalePropertyNotWorkWithScaleType(scaleType,propName,channel){return"".concat(channel,"-scale's \"").concat(propName,'" is dropped as it does not work with ').concat(scaleType," scale.")}function stepDropped(channel){return'The step for "'.concat(channel,'" is dropped because the ').concat("width"===channel?"x":"y"," is continuous.")}const MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function invalidTimeUnit(unitName,value){return"Invalid ".concat(unitName,": ").concat(stringify(value),".")}function errorBand1DNotSupport(property){return"1D error band does not support ".concat(property,".")}function channelRequiredForBinned(channel){return"Channel ".concat(channel,' is required for "binned" bin.')}const main$1=vegaUtil.logger(vegaUtil.Warn);let current=main$1;function warn(...args){current.warn(...args)}function isDateTime(o){if(o&&vegaUtil.isObject(o))for(const part of TIMEUNIT_PARTS)if(part in o)return!0;return!1}const MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],SHORT_MONTHS=MONTHS.map(m=>m.substr(0,3)),DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],SHORT_DAYS=DAYS.map(d=>d.substr(0,3));function dateTimeParts(d,normalize){const parts=[];if(normalize&&void 0!==d.day&&keys(d).length>1&&(warn(function(d){return"Dropping day from datetime ".concat(stringify(d)," as day cannot be combined with other units.")}(d)),delete(d=duplicate(d)).day),void 0!==d.year?parts.push(d.year):parts.push(2012),void 0!==d.month){const month=normalize?function(m){if(isNumeric(m)&&(m=+m),vegaUtil.isNumber(m))return m-1;{const lowerM=m.toLowerCase(),monthIndex=MONTHS.indexOf(lowerM);if(-1!==monthIndex)return monthIndex;const shortM=lowerM.substr(0,3),shortMonthIndex=SHORT_MONTHS.indexOf(shortM);if(-1!==shortMonthIndex)return shortMonthIndex;throw new Error(invalidTimeUnit("month",m))}}(d.month):d.month;parts.push(month)}else if(void 0!==d.quarter){const quarter=normalize?function(q){if(isNumeric(q)&&(q=+q),vegaUtil.isNumber(q))return q>4&&warn(invalidTimeUnit("quarter",q)),q-1;throw new Error(invalidTimeUnit("quarter",q))}(d.quarter):d.quarter;parts.push(vegaUtil.isNumber(quarter)?3*quarter:"".concat(quarter,"*3"))}else parts.push(0);if(void 0!==d.date)parts.push(d.date);else if(void 0!==d.day){const day=normalize?function(d){if(isNumeric(d)&&(d=+d),vegaUtil.isNumber(d))return d%7;{const lowerD=d.toLowerCase(),dayIndex=DAYS.indexOf(lowerD);if(-1!==dayIndex)return dayIndex;const shortD=lowerD.substr(0,3),shortDayIndex=SHORT_DAYS.indexOf(shortD);if(-1!==shortDayIndex)return shortDayIndex;throw new Error(invalidTimeUnit("day",d))}}(d.day):d.day;parts.push(vegaUtil.isNumber(day)?day+1:"".concat(day,"+1"))}else parts.push(1);for(const timeUnit of["hours","minutes","seconds","milliseconds"]){const unit=d[timeUnit];parts.push(void 0===unit?0:unit)}return parts}function dateTimeToExpr(d){const string=dateTimeParts(d,!0).join(", ");return d.utc?"utc(".concat(string,")"):"datetime(".concat(string,")")}const LOCAL_SINGLE_TIMEUNIT_INDEX={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},TIMEUNIT_PARTS=keys(LOCAL_SINGLE_TIMEUNIT_INDEX);function isUTCTimeUnit(t){return t.startsWith("utc")}const VEGALITE_TIMEFORMAT={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function getTimeUnitParts(timeUnit){return TIMEUNIT_PARTS.filter(part=>containsTimeUnit(timeUnit,part))}function containsTimeUnit(fullTimeUnit,timeUnit){const index=fullTimeUnit.indexOf(timeUnit);return!(index<0||index>0&&"seconds"===timeUnit&&"i"===fullTimeUnit.charAt(index-1)||fullTimeUnit.length>index+3&&"day"===timeUnit&&"o"===fullTimeUnit.charAt(index+3)||index>0&&"year"===timeUnit&&"f"===fullTimeUnit.charAt(index-1))}function fieldExpr(fullTimeUnit,field,{end:end}={end:!1}){const fieldRef=accessPathWithDatum(field),utc=isUTCTimeUnit(fullTimeUnit)?"utc":"";let lastTimeUnit;const dateExpr={};for(const part of TIMEUNIT_PARTS)containsTimeUnit(fullTimeUnit,part)&&(dateExpr[part]="quarter"===(timeUnit=part)?"(".concat(utc,"quarter(").concat(fieldRef,")-1)"):"".concat(utc).concat(timeUnit,"(").concat(fieldRef,")"),lastTimeUnit=part);var timeUnit;return end&&(dateExpr[lastTimeUnit]+="+1"),function(d){const string=dateTimeParts(d,!1).join(", ");return d.utc?"utc(".concat(string,")"):"datetime(".concat(string,")")}(dateExpr)}function timeUnitSpecifierExpression(timeUnit){if(!timeUnit)return;const timeUnitParts=getTimeUnitParts(timeUnit);return"timeUnitSpecifier(".concat(stringify(timeUnitParts),", ").concat(stringify(VEGALITE_TIMEFORMAT),")")}function normalizeTimeUnit(timeUnit){if(!timeUnit)return;let params;return vegaUtil.isString(timeUnit)?params={unit:timeUnit}:vegaUtil.isObject(timeUnit)&&(params={...timeUnit,...timeUnit.unit?{unit:timeUnit.unit}:{}}),isUTCTimeUnit(params.unit)&&(params.utc=!0,params.unit=params.unit.substr(3)),params}function isFieldEqualPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.equal}function isFieldLTPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.lt}function isFieldLTEPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.lte}function isFieldGTPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.gt}function isFieldGTEPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.gte}function isFieldRangePredicate(predicate){if(predicate&&predicate.field){if(vegaUtil.isArray(predicate.range)&&2===predicate.range.length)return!0;if(isSignalRef(predicate.range))return!0}return!1}function isFieldOneOfPredicate(predicate){return predicate&&!!predicate.field&&(vegaUtil.isArray(predicate.oneOf)||vegaUtil.isArray(predicate.in))}function isFieldPredicate(predicate){return isFieldOneOfPredicate(predicate)||isFieldEqualPredicate(predicate)||isFieldRangePredicate(predicate)||isFieldLTPredicate(predicate)||isFieldGTPredicate(predicate)||isFieldLTEPredicate(predicate)||isFieldGTEPredicate(predicate)}function predicateValueExpr(v,timeUnit){return valueExpr(v,{timeUnit:timeUnit,wrapTime:!0})}function fieldFilterExpression(predicate,useInRange=!0){var _normalizeTimeUnit;const{field:field}=predicate,timeUnit=null===(_normalizeTimeUnit=normalizeTimeUnit(predicate.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit,fieldExpr$1=timeUnit?"time(".concat(fieldExpr(timeUnit,field),")"):vgField(predicate,{expr:"datum"});if(isFieldEqualPredicate(predicate))return"".concat(fieldExpr$1,"===").concat(predicateValueExpr(predicate.equal,timeUnit));if(isFieldLTPredicate(predicate)){const upper=predicate.lt;return"".concat(fieldExpr$1,"<").concat(predicateValueExpr(upper,timeUnit))}if(isFieldGTPredicate(predicate)){const lower=predicate.gt;return"".concat(fieldExpr$1,">").concat(predicateValueExpr(lower,timeUnit))}if(isFieldLTEPredicate(predicate)){const upper=predicate.lte;return"".concat(fieldExpr$1,"<=").concat(predicateValueExpr(upper,timeUnit))}if(isFieldGTEPredicate(predicate)){const lower=predicate.gte;return"".concat(fieldExpr$1,">=").concat(predicateValueExpr(lower,timeUnit))}if(isFieldOneOfPredicate(predicate))return"indexof([".concat(function(vals,timeUnit){return vals.map(v=>predicateValueExpr(v,timeUnit))}(predicate.oneOf,timeUnit).join(","),"], ").concat(fieldExpr$1,") !== -1");if(function(predicate){return predicate&&!!predicate.field&&void 0!==predicate.valid}(predicate))return fieldValidPredicate(fieldExpr$1,predicate.valid);if(isFieldRangePredicate(predicate)){const{range:range}=predicate,lower=isSignalRef(range)?{signal:"".concat(range.signal,"[0]")}:range[0],upper=isSignalRef(range)?{signal:"".concat(range.signal,"[1]")}:range[1];if(null!==lower&&null!==upper&&useInRange)return"inrange("+fieldExpr$1+", ["+predicateValueExpr(lower,timeUnit)+", "+predicateValueExpr(upper,timeUnit)+"])";const exprs=[];return null!==lower&&exprs.push("".concat(fieldExpr$1," >= ").concat(predicateValueExpr(lower,timeUnit))),null!==upper&&exprs.push("".concat(fieldExpr$1," <= ").concat(predicateValueExpr(upper,timeUnit))),exprs.length>0?exprs.join(" && "):"true"}throw new Error("Invalid field predicate: ".concat(stringify(predicate)))}function fieldValidPredicate(fieldExpr,valid=!0){return valid?"isValid(".concat(fieldExpr,") && isFinite(+").concat(fieldExpr,")"):"!isValid(".concat(fieldExpr,") || !isFinite(+").concat(fieldExpr,")")}function normalizePredicate(f){var _normalizeTimeUnit2;return isFieldPredicate(f)&&f.timeUnit?{...f,timeUnit:null===(_normalizeTimeUnit2=normalizeTimeUnit(f.timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit}:f}const Type_quantitative="quantitative",Type_ordinal="ordinal",Type_temporal="temporal",Type_nominal="nominal",Type_geojson="geojson",QUANTITATIVE=Type_quantitative,ORDINAL=Type_ordinal,TEMPORAL=Type_temporal,NOMINAL=Type_nominal,GEOJSON=Type_geojson,ScaleType_LINEAR="linear",ScaleType_LOG="log",ScaleType_POW="pow",ScaleType_SQRT="sqrt",ScaleType_SYMLOG="symlog",ScaleType_TIME="time",ScaleType_UTC="utc",ScaleType_QUANTILE="quantile",ScaleType_QUANTIZE="quantize",ScaleType_THRESHOLD="threshold",ScaleType_POINT="point",ScaleType_BAND="band",SCALE_CATEGORY_INDEX={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function scaleCompatible(scaleType1,scaleType2){const scaleCategory1=SCALE_CATEGORY_INDEX[scaleType1],scaleCategory2=SCALE_CATEGORY_INDEX[scaleType2];return scaleCategory1===scaleCategory2||"ordinal-position"===scaleCategory1&&"time"===scaleCategory2||"ordinal-position"===scaleCategory2&&"time"===scaleCategory1}const SCALE_PRECEDENCE_INDEX={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function scaleTypePrecedence(scaleType){return SCALE_PRECEDENCE_INDEX[scaleType]}const CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","log","pow","sqrt","symlog","time","utc"],CONTINUOUS_TO_CONTINUOUS_INDEX=vegaUtil.toSet(CONTINUOUS_TO_CONTINUOUS_SCALES),QUANTITATIVE_SCALES_INDEX=vegaUtil.toSet(["linear","log","pow","sqrt","symlog"]),CONTINUOUS_TO_DISCRETE_INDEX=vegaUtil.toSet(["quantile","quantize","threshold"]),CONTINUOUS_DOMAIN_SCALES=CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["quantile","quantize","threshold","sequential","identity"]),CONTINUOUS_DOMAIN_INDEX=vegaUtil.toSet(CONTINUOUS_DOMAIN_SCALES),DISCRETE_DOMAIN_INDEX=vegaUtil.toSet(["ordinal","bin-ordinal","point","band"]);function hasDiscreteDomain(type){return type in DISCRETE_DOMAIN_INDEX}function hasContinuousDomain(type){return type in CONTINUOUS_DOMAIN_INDEX}function isContinuousToContinuous(type){return type in CONTINUOUS_TO_CONTINUOUS_INDEX}function isContinuousToDiscrete(type){return type in CONTINUOUS_TO_DISCRETE_INDEX}function isParameterDomain(domain){return null==domain?void 0:domain.param}const{type:type,domain:domain,range:range,rangeMax:rangeMax,rangeMin:rangeMin,scheme:scheme,...NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX}={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=keys(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX);function scaleTypeSupportProperty(scaleType,propName){switch(propName){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(scaleType);case"bins":return!["point","band","identity","ordinal"].includes(scaleType);case"round":return isContinuousToContinuous(scaleType)||"band"===scaleType||"point"===scaleType;case"padding":case"rangeMin":case"rangeMax":return isContinuousToContinuous(scaleType)||["point","band"].includes(scaleType);case"paddingOuter":case"align":return["point","band"].includes(scaleType);case"paddingInner":return"band"===scaleType;case"domainMax":case"domainMid":case"domainMin":case"clamp":return isContinuousToContinuous(scaleType);case"nice":return isContinuousToContinuous(scaleType)||"quantize"===scaleType||"threshold"===scaleType;case"exponent":return"pow"===scaleType;case"base":return"log"===scaleType;case"constant":return"symlog"===scaleType;case"zero":return hasContinuousDomain(scaleType)&&!contains(["log","time","utc","threshold","quantile"],scaleType)}}function channelScalePropertyIncompatability(channel,propName){switch(propName){case"interpolate":case"scheme":case"domainMid":return isColorChannel(channel)?void 0:'Cannot use the scale property "'.concat(channel,'" with non-color channel.');case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}const Mark={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},ARC=Mark.arc,AREA=Mark.area,BAR=Mark.bar,IMAGE=Mark.image,LINE=Mark.line,POINT=Mark.point,RECT=Mark.rect,RULE=Mark.rule,TEXT$1=Mark.text,TICK=Mark.tick,TRAIL=Mark.trail,CIRCLE=Mark.circle,SQUARE=Mark.square,GEOSHAPE=Mark.geoshape;function isPathMark(m){return["line","area","trail"].includes(m)}function isRectBasedMark(m){return["rect","bar","image","arc"].includes(m)}const PRIMITIVE_MARKS=keys(Mark);function isMarkDef(mark){return mark.type}vegaUtil.toSet(PRIMITIVE_MARKS);const FILL_STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],VL_ONLY_MARK_CONFIG_PROPERTIES=keys({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),MARK_CONFIGS=keys({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1});function isRelativeBandSize(o){return o&&null!=o.band}const BAR_CORNER_RADIUS_INDEX={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},defaultBarConfig={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},defaultRectConfig={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function midPointRefWithPositionInvalidTest(params){const{channel:channel,channelDef:channelDef,markDef:markDef,scale:scale,config:config}=params,ref=midPoint(params);return isFieldDef(channelDef)&&!isCountingAggregateOp(channelDef.aggregate)&&scale&&isContinuousToContinuous(scale.get("type"))&&!1===scale.get("zero")?wrapPositionInvalidTest({fieldDef:channelDef,channel:channel,markDef:markDef,ref:ref,config:config}):ref}function wrapPositionInvalidTest({fieldDef:fieldDef,channel:channel,markDef:markDef,ref:ref,config:config}){return isPathMark(markDef.type)||null===getMarkPropOrConfig("invalid",markDef,config)?ref:[fieldInvalidTestValueRef(fieldDef,channel),ref]}function fieldInvalidTestValueRef(fieldDef,channel){return{test:fieldInvalidPredicate(fieldDef,!0),..."y"===getMainRangeChannel(channel)?{field:{group:"height"}}:{value:0}}}function fieldInvalidPredicate(field,invalid=!0){return fieldValidPredicate(vegaUtil.isString(field)?field:vgField(field,{expr:"datum"}),!invalid)}function valueRefForFieldOrDatumDef(fieldDef,scaleName,opt,encode){const ref={};if(scaleName&&(ref.scale=scaleName),isDatumDef(fieldDef)){const{datum:datum}=fieldDef;isDateTime(datum)?ref.signal=dateTimeToExpr(datum):isSignalRef(datum)?ref.signal=datum.signal:isExprRef(datum)?ref.signal=datum.expr:ref.value=datum}else ref.field=vgField(fieldDef,opt);if(encode){const{offset:offset,band:band}=encode;offset&&(ref.offset=offset),band&&(ref.band=band)}return ref}function interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:fieldOrDatumDef,fieldOrDatumDef2:fieldOrDatumDef2,offset:offset,startSuffix:startSuffix,bandPosition:bandPosition=.5}){const expr=0<bandPosition&&bandPosition<1?"datum":void 0,start=vgField(fieldOrDatumDef,{expr:expr,suffix:startSuffix}),end=void 0!==fieldOrDatumDef2?vgField(fieldOrDatumDef2,{expr:expr}):vgField(fieldOrDatumDef,{suffix:"end",expr:expr}),ref={};if(0===bandPosition||1===bandPosition){ref.scale=scaleName;const val=0===bandPosition?start:end;ref.field=val}else{const datum=isSignalRef(bandPosition)?"".concat(bandPosition.signal," * ").concat(start," + (1-").concat(bandPosition.signal,") * ").concat(end):"".concat(bandPosition," * ").concat(start," + ").concat(1-bandPosition," * ").concat(end);ref.signal='scale("'.concat(scaleName,'", ').concat(datum,")")}return offset&&(ref.offset=offset),ref}function midPoint({channel:channel,channelDef:channelDef,channel2Def:channel2Def,markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:defaultRef,bandPosition:bandPosition}){if(channelDef){if(isFieldOrDatumDef(channelDef)){var _ref,_bandPosition2;if(isTypedFieldDef(channelDef)){var _bandPosition;null!==(_bandPosition=bandPosition)&&void 0!==_bandPosition||(bandPosition=getBandPosition({fieldDef:channelDef,fieldDef2:channel2Def,markDef:markDef,config:config}));const{bin:bin,timeUnit:timeUnit,type:type}=channelDef;if(isBinning(bin)||bandPosition&&timeUnit&&type===TEMPORAL)return stack&&stack.impute?valueRefForFieldOrDatumDef(channelDef,scaleName,{binSuffix:"mid"},{offset:offset}):bandPosition?interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:channelDef,bandPosition:bandPosition,offset:offset}):valueRefForFieldOrDatumDef(channelDef,scaleName,binRequiresRange(channelDef,channel)?{binSuffix:"range"}:{},{offset:offset});if(isBinned(bin)){if(isFieldDef(channel2Def))return interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:channelDef,fieldOrDatumDef2:channel2Def,bandPosition:bandPosition,offset:offset});warn(channelRequiredForBinned(channel===X?X2:Y2))}}const scaleType=null==scale?void 0:scale.get("type");return valueRefForFieldOrDatumDef(channelDef,scaleName,hasDiscreteDomain(scaleType)?{binSuffix:"range"}:{},{offset:offset,band:"band"===scaleType?null!==(_ref=null!==(_bandPosition2=bandPosition)&&void 0!==_bandPosition2?_bandPosition2:channelDef.bandPosition)&&void 0!==_ref?_ref:.5:void 0})}if(isValueDef(channelDef)){const offsetMixins=offset?{offset:offset}:{};return{...widthHeightValueOrSignalRef(channel,channelDef.value),...offsetMixins}}}return vegaUtil.isFunction(defaultRef)&&(defaultRef=defaultRef()),defaultRef?{...defaultRef,...offset?{offset:offset}:{}}:defaultRef}function widthHeightValueOrSignalRef(channel,value){return contains(["x","x2"],channel)&&"width"===value?{field:{group:"width"}}:contains(["y","y2"],channel)&&"height"===value?{field:{group:"height"}}:signalOrValueRef(value)}function isCustomFormatType(formatType){return formatType&&"number"!==formatType&&"time"!==formatType}function customFormatExpr(formatType,field,format){return"".concat(formatType,"(").concat(field).concat(format?", ".concat(stringify(format)):"",")")}function formatSignalRef({fieldOrDatumDef:fieldOrDatumDef,format:format,formatType:formatType,expr:expr,normalizeStack:normalizeStack,config:config}){if(isCustomFormatType(formatType))return formatCustomType({fieldOrDatumDef:fieldOrDatumDef,format:format,formatType:formatType,expr:expr,config:config});const field=fieldToFormat(fieldOrDatumDef,expr,normalizeStack);if(isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)){var _normalizeTimeUnit,_fieldOrDatumDef$scal;const signal=function(field,timeUnit,format,rawTimeFormat,isUTCScale){return!timeUnit||format?(format=vegaUtil.isString(format)?format:rawTimeFormat,"".concat(isUTCScale?"utc":"time","Format(").concat(field,", '").concat(format,"')")):function(timeUnit,field,isUTCScale){if(!timeUnit)return;const expr=timeUnitSpecifierExpression(timeUnit),utc=isUTCScale||isUTCTimeUnit(timeUnit);return"".concat(utc?"utc":"time","Format(").concat(field,", ").concat(expr,")")}(timeUnit,field,isUTCScale)}(field,isFieldDef(fieldOrDatumDef)?null===(_normalizeTimeUnit=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit:void 0,format,config.timeFormat,isScaleFieldDef(fieldOrDatumDef)&&(null===(_fieldOrDatumDef$scal=fieldOrDatumDef.scale)||void 0===_fieldOrDatumDef$scal?void 0:_fieldOrDatumDef$scal.type)===ScaleType_UTC);return signal?{signal:signal}:void 0}return format=numberFormat(channelDefType(fieldOrDatumDef),format,config),isFieldDef(fieldOrDatumDef)&&isBinning(fieldOrDatumDef.bin)?{signal:binFormatExpression(field,vgField(fieldOrDatumDef,{expr:expr,binSuffix:"end"}),format,formatType,config)}:format||"quantitative"===channelDefType(fieldOrDatumDef)?{signal:"".concat(formatExpr(field,format))}:{signal:"isValid(".concat(field,") ? ").concat(field,' : ""+').concat(field)}}function fieldToFormat(fieldOrDatumDef,expr,normalizeStack){return isFieldDef(fieldOrDatumDef)?normalizeStack?"".concat(vgField(fieldOrDatumDef,{expr:expr,suffix:"end"}),"-").concat(vgField(fieldOrDatumDef,{expr:expr,suffix:"start"})):vgField(fieldOrDatumDef,{expr:expr}):function(datumDef){const{datum:datum}=datumDef;return isDateTime(datum)?dateTimeToExpr(datum):"".concat(stringify(datum))}(fieldOrDatumDef)}function formatCustomType({fieldOrDatumDef:fieldOrDatumDef,format:format,formatType:formatType,expr:expr,normalizeStack:normalizeStack,config:config,field:field}){var _field;return null!==(_field=field)&&void 0!==_field||(field=fieldToFormat(fieldOrDatumDef,expr,normalizeStack)),isFieldDef(fieldOrDatumDef)&&isBinning(fieldOrDatumDef.bin)?{signal:binFormatExpression(field,vgField(fieldOrDatumDef,{expr:expr,binSuffix:"end"}),format,formatType,config)}:{signal:customFormatExpr(formatType,field,format)}}function guideFormat(fieldOrDatumDef,type,format,formatType,config,omitTimeFormatConfig){var _normalizeTimeUnit2;if(!isCustomFormatType(formatType))return isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)?function(specifiedFormat,timeUnit,config,omitTimeFormatConfig){return specifiedFormat||(timeUnit?{signal:timeUnitSpecifierExpression(timeUnit)}:omitTimeFormatConfig?void 0:config.timeFormat)}(format,isFieldDef(fieldOrDatumDef)?null===(_normalizeTimeUnit2=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit:void 0,config,omitTimeFormatConfig):numberFormat(type,format,config)}function guideFormatType(formatType,fieldOrDatumDef,scaleType){return formatType&&(isSignalRef(formatType)||"number"===formatType||"time"===formatType)?formatType:isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)&&"time"!==scaleType&&"utc"!==scaleType?"time":void 0}function numberFormat(type,specifiedFormat,config){return vegaUtil.isString(specifiedFormat)?specifiedFormat:type===QUANTITATIVE?config.numberFormat:void 0}function formatExpr(field,format){return"format(".concat(field,', "').concat(format||"",'")')}function binNumberFormatExpr(field,format,formatType,config){var _ref;return isCustomFormatType(formatType)?customFormatExpr(formatType,field,format):formatExpr(field,null!==(_ref=vegaUtil.isString(format)?format:void 0)&&void 0!==_ref?_ref:config.numberFormat)}function binFormatExpression(startField,endField,format,formatType,config){const start=binNumberFormatExpr(startField,format,formatType,config),end=binNumberFormatExpr(endField,format,formatType,config);return"".concat(fieldValidPredicate(startField,!1),' ? "null" : ').concat(start,' + "').concat(" â€“ ",'" + ').concat(end)}const DEFAULT_SORT_OP="min",SORT_BY_CHANNEL_INDEX={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function isSortByChannel(c){return c in SORT_BY_CHANNEL_INDEX}function isSortByEncoding(sort){return!!sort&&!!sort.encoding}function isSortField(sort){return!(!sort||"count"!==sort.op&&!sort.field)}function isSortArray(sort){return!!sort&&vegaUtil.isArray(sort)}function isFacetMapping(f){return"row"in f||"column"in f}function isFacetFieldDef(channelDef){return!!channelDef&&"header"in channelDef}function isFacetSpec(spec){return"facet"in spec}function toFieldDefBase(fieldDef){const{field:field,timeUnit:timeUnit,bin:bin,aggregate:aggregate}=fieldDef;return{...timeUnit?{timeUnit:timeUnit}:{},...bin?{bin:bin}:{},...aggregate?{aggregate:aggregate}:{},field:field}}function isSortableFieldDef(fieldDef){return"sort"in fieldDef}function getBandPosition({fieldDef:fieldDef,fieldDef2:fieldDef2,markDef:mark,config:config}){if(isFieldOrDatumDef(fieldDef)&&void 0!==fieldDef.bandPosition)return fieldDef.bandPosition;if(isFieldDef(fieldDef)){const{timeUnit:timeUnit,bin:bin}=fieldDef;if(timeUnit&&!fieldDef2)return isRectBasedMark(mark.type)?0:getMarkConfig("timeUnitBandPosition",mark,config);if(isBinning(bin))return.5}}function getBandSize({channel:channel,fieldDef:fieldDef,fieldDef2:fieldDef2,markDef:mark,config:config,scaleType:scaleType,useVlSizeChannel:useVlSizeChannel}){const sizeChannel=getSizeChannel(channel),size=getMarkPropOrConfig(useVlSizeChannel?"size":sizeChannel,mark,config,{vgChannel:sizeChannel});if(void 0!==size)return size;if(isFieldDef(fieldDef)){const{timeUnit:timeUnit,bin:bin}=fieldDef;if(timeUnit&&!fieldDef2)return{band:getMarkConfig("timeUnitBandSize",mark,config)};if(isBinning(bin)&&!hasDiscreteDomain(scaleType))return{band:1}}var _config$mark$type3,_config$mark$type,_config$mark$type2;return isRectBasedMark(mark.type)?scaleType?hasDiscreteDomain(scaleType)?(null===(_config$mark$type=config[mark.type])||void 0===_config$mark$type?void 0:_config$mark$type.discreteBandSize)||{band:1}:null===(_config$mark$type2=config[mark.type])||void 0===_config$mark$type2?void 0:_config$mark$type2.continuousBandSize:null===(_config$mark$type3=config[mark.type])||void 0===_config$mark$type3?void 0:_config$mark$type3.discreteBandSize:void 0}function hasBandEnd(fieldDef,fieldDef2,markDef,config){return!!(isBinning(fieldDef.bin)||fieldDef.timeUnit&&isTypedFieldDef(fieldDef)&&"temporal"===fieldDef.type)&&void 0!==getBandPosition({fieldDef:fieldDef,fieldDef2:fieldDef2,markDef:markDef,config:config})}function isConditionalDef(channelDef){return!!channelDef&&"condition"in channelDef}function hasConditionalFieldDef(channelDef){const condition=channelDef&&channelDef.condition;return!!condition&&!vegaUtil.isArray(condition)&&isFieldDef(condition)}function hasConditionalFieldOrDatumDef(channelDef){const condition=channelDef&&channelDef.condition;return!!condition&&!vegaUtil.isArray(condition)&&isFieldOrDatumDef(condition)}function isFieldDef(channelDef){return!(!channelDef||!channelDef.field&&"count"!==channelDef.aggregate)}function channelDefType(channelDef){return channelDef&&channelDef.type}function isDatumDef(channelDef){return!!channelDef&&"datum"in channelDef}function isContinuousFieldOrDatumDef(cd){return isTypedFieldDef(cd)&&!isDiscrete(cd)||isNumericDataDef(cd)}function isNumericDataDef(cd){return isDatumDef(cd)&&vegaUtil.isNumber(cd.datum)}function isFieldOrDatumDef(channelDef){return isFieldDef(channelDef)||isDatumDef(channelDef)}function isTypedFieldDef(channelDef){return!!channelDef&&("field"in channelDef||"count"===channelDef.aggregate)&&"type"in channelDef}function isValueDef(channelDef){return channelDef&&"value"in channelDef&&"value"in channelDef}function isScaleFieldDef(channelDef){return!!channelDef&&("scale"in channelDef||"sort"in channelDef)}function isPositionFieldOrDatumDef(channelDef){return channelDef&&("axis"in channelDef||"stack"in channelDef||"impute"in channelDef)}function isMarkPropFieldOrDatumDef(channelDef){return!!channelDef&&"legend"in channelDef}function isStringFieldOrDatumDef(channelDef){return!!channelDef&&("format"in channelDef||"formatType"in channelDef)}function toStringFieldDef(fieldDef){return omit(fieldDef,["legend","axis","header","scale"])}function vgField(fieldDef,opt={}){let field=fieldDef.field;const prefix=opt.prefix;let suffix=opt.suffix,argAccessor="";if(function(fieldDef){return"count"===fieldDef.aggregate}(fieldDef))field=internalField("count");else{let fn;if(!opt.nofn)if(function(fieldDef){return"op"in fieldDef}(fieldDef))fn=fieldDef.op;else{const{bin:bin,aggregate:aggregate,timeUnit:timeUnit}=fieldDef;var _opt$binSuffix,_opt$suffix;if(isBinning(bin))fn=binToString(bin),suffix=(null!==(_opt$binSuffix=opt.binSuffix)&&void 0!==_opt$binSuffix?_opt$binSuffix:"")+(null!==(_opt$suffix=opt.suffix)&&void 0!==_opt$suffix?_opt$suffix:"");else if(aggregate)isArgmaxDef(aggregate)?(argAccessor='["'.concat(field,'"]'),field="argmax_".concat(aggregate.argmax)):isArgminDef(aggregate)?(argAccessor='["'.concat(field,'"]'),field="argmin_".concat(aggregate.argmin)):fn=String(aggregate);else if(timeUnit){var _opt$suffix2;fn=function(tu){const{utc:utc,...rest}=normalizeTimeUnit(tu);return rest.unit?(utc?"utc":"")+keys(rest).map(p=>varName("".concat("unit"===p?"":"_".concat(p,"_")).concat(rest[p]))).join(""):(utc?"utc":"")+"timeunit"+keys(rest).map(p=>varName("_".concat(p,"_").concat(rest[p]))).join("")}(timeUnit),suffix=(!["range","mid"].includes(opt.binSuffix)&&opt.binSuffix||"")+(null!==(_opt$suffix2=opt.suffix)&&void 0!==_opt$suffix2?_opt$suffix2:"")}}fn&&(field=field?"".concat(fn,"_").concat(field):fn)}return suffix&&(field="".concat(field,"_").concat(suffix)),prefix&&(field="".concat(prefix,"_").concat(field)),opt.forAs?removePathFromField(field):opt.expr?flatAccessWithDatum(field,opt.expr)+argAccessor:replacePathInField(field)+argAccessor}function isDiscrete(def){switch(def.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return isFieldDef(def)&&!!def.bin;case"temporal":return!1}throw new Error(invalidFieldType(def.type))}const defaultTitleFormatter=(fieldDef,config)=>{switch(config.fieldTitle){case"plain":return fieldDef.field;case"functional":return function(fieldDef){const{aggregate:aggregate,bin:bin,timeUnit:timeUnit,field:field}=fieldDef;if(isArgmaxDef(aggregate))return"".concat(field," for argmax(").concat(aggregate.argmax,")");if(isArgminDef(aggregate))return"".concat(field," for argmin(").concat(aggregate.argmin,")");const timeUnitParams=normalizeTimeUnit(timeUnit),fn=aggregate||(null==timeUnitParams?void 0:timeUnitParams.unit)||(null==timeUnitParams?void 0:timeUnitParams.maxbins)&&"timeunit"||isBinning(bin)&&"bin";return fn?"".concat(fn.toUpperCase(),"(").concat(field,")"):field}(fieldDef);default:return function(fieldDef,config){const{field:field,bin:bin,timeUnit:timeUnit,aggregate:aggregate}=fieldDef;if("count"===aggregate)return config.countTitle;if(isBinning(bin))return"".concat(field," (binned)");if(timeUnit){var _normalizeTimeUnit;const unit=null===(_normalizeTimeUnit=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit;if(unit)return"".concat(field," (").concat(getTimeUnitParts(unit).join("-"),")")}else if(aggregate)return isArgmaxDef(aggregate)?"".concat(field," for max ").concat(aggregate.argmax):isArgminDef(aggregate)?"".concat(field," for min ").concat(aggregate.argmin):"".concat(titleCase(aggregate)," of ").concat(field);return field}(fieldDef,config)}};let titleFormatter=defaultTitleFormatter;function setTitleFormatter(formatter){titleFormatter=formatter}function title(fieldOrDatumDef,config,{allowDisabling:allowDisabling,includeDefault:includeDefault=!0}){var _getGuide;const guideTitle=null===(_getGuide=getGuide(fieldOrDatumDef))||void 0===_getGuide?void 0:_getGuide.title;if(!isFieldDef(fieldOrDatumDef))return guideTitle;const fieldDef=fieldOrDatumDef,def=includeDefault?defaultTitle(fieldDef,config):void 0;return allowDisabling?getFirstDefined(guideTitle,fieldDef.title,def):null!==(_ref=null!=guideTitle?guideTitle:fieldDef.title)&&void 0!==_ref?_ref:def;var _ref}function getGuide(fieldDef){return isPositionFieldOrDatumDef(fieldDef)&&fieldDef.axis?fieldDef.axis:isMarkPropFieldOrDatumDef(fieldDef)&&fieldDef.legend?fieldDef.legend:isFacetFieldDef(fieldDef)&&fieldDef.header?fieldDef.header:void 0}function defaultTitle(fieldDef,config){return titleFormatter(fieldDef,config)}function getFormatMixins(fieldDef){if(isStringFieldOrDatumDef(fieldDef)){const{format:format,formatType:formatType}=fieldDef;return{format:format,formatType:formatType}}{var _getGuide2;const guide=null!==(_getGuide2=getGuide(fieldDef))&&void 0!==_getGuide2?_getGuide2:{},{format:format,formatType:formatType}=guide;return{format:format,formatType:formatType}}}function getFieldDef(channelDef){return isFieldDef(channelDef)?channelDef:hasConditionalFieldDef(channelDef)?channelDef.condition:void 0}function getFieldOrDatumDef(channelDef){return isFieldOrDatumDef(channelDef)?channelDef:hasConditionalFieldOrDatumDef(channelDef)?channelDef.condition:void 0}function initChannelDef(channelDef,channel,config,opt={}){return vegaUtil.isString(channelDef)||vegaUtil.isNumber(channelDef)||vegaUtil.isBoolean(channelDef)?(warn(function(channel,type,value){return"Channel ".concat(channel," is a ").concat(type,". Converted to {value: ").concat(stringify(value),"}.")}(channel,vegaUtil.isString(channelDef)?"string":vegaUtil.isNumber(channelDef)?"number":"boolean",channelDef)),{value:channelDef}):isFieldOrDatumDef(channelDef)?initFieldOrDatumDef(channelDef,channel,config,opt):hasConditionalFieldOrDatumDef(channelDef)?{...channelDef,condition:initFieldOrDatumDef(channelDef.condition,channel,config,opt)}:channelDef}function initFieldOrDatumDef(fd,channel,config,opt){if(isStringFieldOrDatumDef(fd)){const{format:format,formatType:formatType,...rest}=fd;if(isCustomFormatType(formatType)&&!config.customFormatTypes)return warn(customFormatTypeNotAllowed(channel)),initFieldOrDatumDef(rest,channel,config,opt)}else{const guideType=isPositionFieldOrDatumDef(fd)?"axis":isMarkPropFieldOrDatumDef(fd)?"legend":isFacetFieldDef(fd)?"header":null;if(guideType&&fd[guideType]){const{format:format,formatType:formatType,...newGuide}=fd[guideType];if(isCustomFormatType(formatType)&&!config.customFormatTypes)return warn(customFormatTypeNotAllowed(channel)),initFieldOrDatumDef({...fd,[guideType]:newGuide},channel,config,opt)}}return isFieldDef(fd)?initFieldDef(fd,channel,opt):function(datumDef){let type=datumDef.type;if(type)return datumDef;const{datum:datum}=datumDef;return type=vegaUtil.isNumber(datum)?"quantitative":vegaUtil.isString(datum)?"nominal":isDateTime(datum)?"temporal":void 0,{...datumDef,type:type}}(fd)}function initFieldDef(fd,channel,{compositeMark:compositeMark=!1}={}){const{aggregate:aggregate,timeUnit:timeUnit,bin:bin,field:field}=fd,fieldDef={...fd};if(compositeMark||!aggregate||isAggregateOp(aggregate)||isArgmaxDef(aggregate)||isArgminDef(aggregate)||(warn(function(aggregate){return'Invalid aggregation operator "'.concat(aggregate,'".')}(aggregate)),delete fieldDef.aggregate),timeUnit&&(fieldDef.timeUnit=normalizeTimeUnit(timeUnit)),field&&(fieldDef.field="".concat(field)),isBinning(bin)&&(fieldDef.bin=normalizeBin(bin,channel)),isBinned(bin)&&!isXorY(channel)&&warn(function(channel){return"Channel ".concat(channel,' should not be used with "binned" bin.')}(channel)),isTypedFieldDef(fieldDef)){const{type:type}=fieldDef,fullType=function(type){if(type)switch(type=type.toLowerCase()){case"q":case QUANTITATIVE:return"quantitative";case"t":case TEMPORAL:return"temporal";case"o":case ORDINAL:return"ordinal";case"n":case NOMINAL:return"nominal";case GEOJSON:return"geojson"}}(type);type!==fullType&&(fieldDef.type=fullType),"quantitative"!==type&&isCountingAggregateOp(aggregate)&&(warn(function(type,aggregate){return'Invalid field type "'.concat(type,'" for aggregate: "').concat(aggregate,'", using "quantitative" instead.')}(type,aggregate)),fieldDef.type="quantitative")}else if(!isSecondaryRangeChannel(channel)){const newType=function(fieldDef,channel){var _fieldDef$scale;switch(channel){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(isSortableFieldDef(fieldDef)&&vegaUtil.isArray(fieldDef.sort))return"ordinal";const{aggregate:aggregate,bin:bin,timeUnit:timeUnit}=fieldDef;if(timeUnit)return"temporal";if(bin||aggregate&&!isArgmaxDef(aggregate)&&!isArgminDef(aggregate))return"quantitative";if(isScaleFieldDef(fieldDef)&&null!==(_fieldDef$scale=fieldDef.scale)&&void 0!==_fieldDef$scale&&_fieldDef$scale.type)switch(SCALE_CATEGORY_INDEX[fieldDef.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(fieldDef,channel);fieldDef.type=newType}if(isTypedFieldDef(fieldDef)){const{compatible:compatible,warning:warning}=function(fieldDef,channel){const type=fieldDef.type;if("geojson"===type&&"shape"!==channel)return{compatible:!1,warning:"Channel ".concat(channel," should not be used with a geojson data.")};switch(channel){case ROW:case COLUMN:case"facet":return isDiscrete(fieldDef)?COMPATIBLE:{compatible:!1,warning:channelShouldBeDiscrete(channel)};case X:case Y:case COLOR:case FILL:case STROKE:case"text":case"detail":case"key":case"tooltip":case"href":case"url":case"angle":case THETA:case RADIUS:case"description":return COMPATIBLE;case"longitude":case"longitude2":case"latitude":case"latitude2":return type!==QUANTITATIVE?{compatible:!1,warning:"Channel ".concat(channel," should be used with a quantitative field only, not ").concat(fieldDef.type," field.")}:COMPATIBLE;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case SIZE:case THETA2:case"radius2":case X2:case Y2:return"nominal"!==type||fieldDef.sort?COMPATIBLE:{compatible:!1,warning:"Channel ".concat(channel," should not be used with an unsorted discrete field.")};case SHAPE:case"strokeDash":return isDiscrete(fieldDef)||isScaleFieldDef(def=fieldDef)&&isContinuousToDiscrete(null===(_def$scale=def.scale)||void 0===_def$scale?void 0:_def$scale.type)?COMPATIBLE:{compatible:!1,warning:channelShouldBeDiscreteOrDiscretizing(channel)};case"order":return"nominal"!==fieldDef.type||"sort"in fieldDef?COMPATIBLE:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}var def,_def$scale}(fieldDef,channel)||{};!1===compatible&&warn(warning)}if(isSortableFieldDef(fieldDef)&&vegaUtil.isString(fieldDef.sort)){const{sort:sort}=fieldDef;if(isSortByChannel(sort))return{...fieldDef,sort:{encoding:sort}};const sub=sort.substr(1);if("-"===sort.charAt(0)&&isSortByChannel(sub))return{...fieldDef,sort:{encoding:sub,order:"descending"}}}if(isFacetFieldDef(fieldDef)){const{header:header}=fieldDef;if(header){const{orient:orient,...rest}=header;if(orient)return{...fieldDef,header:{...rest,labelOrient:header.labelOrient||orient,titleOrient:header.titleOrient||orient}}}}return fieldDef}function normalizeBin(bin,channel){return vegaUtil.isBoolean(bin)?{maxbins:autoMaxBins(channel)}:"binned"===bin?{binned:!0}:bin.maxbins||bin.step?bin:{...bin,maxbins:autoMaxBins(channel)}}const COMPATIBLE={compatible:!0};function isFieldOrDatumDefForTimeFormat(fieldOrDatumDef){const{formatType:formatType}=getFormatMixins(fieldOrDatumDef);return"time"===formatType||!formatType&&(def=fieldOrDatumDef)&&("temporal"===def.type||isFieldDef(def)&&!!def.timeUnit);var def}function valueExpr(v,{timeUnit:timeUnit,type:type,wrapTime:wrapTime,undefinedIfExprNotRequired:undefinedIfExprNotRequired}){var _normalizeTimeUnit2;const unit=timeUnit&&(null===(_normalizeTimeUnit2=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit);let expr,isTime=unit||"temporal"===type;return isExprRef(v)?expr=v.expr:isSignalRef(v)?expr=v.signal:isDateTime(v)?(isTime=!0,expr=dateTimeToExpr(v)):(vegaUtil.isString(v)||vegaUtil.isNumber(v))&&isTime&&(expr="datetime(".concat(stringify(v),")"),function(timeUnit){return!!LOCAL_SINGLE_TIMEUNIT_INDEX[timeUnit]}(unit)&&(vegaUtil.isNumber(v)&&v<1e4||vegaUtil.isString(v)&&isNaN(Date.parse(v)))&&(expr=dateTimeToExpr({[unit]:v}))),expr?wrapTime&&isTime?"time(".concat(expr,")"):expr:undefinedIfExprNotRequired?void 0:stringify(v)}function valueArray(fieldOrDatumDef,values){const{type:type}=fieldOrDatumDef;return values.map(v=>{const expr=valueExpr(v,{timeUnit:isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.timeUnit:void 0,type:type,undefinedIfExprNotRequired:!0});return void 0!==expr?{signal:expr}:v})}function binRequiresRange(fieldDef,channel){return isBinning(fieldDef.bin)?isScaleChannel(channel)&&["ordinal","nominal"].includes(fieldDef.type):(console.warn("Only call this method for binned field defs."),!1)}const CONDITIONAL_AXIS_PROP_INDEX={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function isConditionalAxisValue(v){return v&&v.condition}const AXIS_PARTS=["domain","grid","labels","ticks","title"],AXIS_PROPERTY_TYPE={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},COMMON_AXIS_PROPERTIES_INDEX={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},AXIS_PROPERTIES_INDEX={...COMMON_AXIS_PROPERTIES_INDEX,style:1,labelExpr:1,encoding:1};function isAxisProperty(prop){return!!AXIS_PROPERTIES_INDEX[prop]}const AXIS_CONFIGS=keys({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});function isUnitSpec(spec){return"mark"in spec}class CompositeMarkNormalizer{constructor(name,run){this.name=name,this.run=run}hasMatchingType(spec){return!!isUnitSpec(spec)&&(isMarkDef(m=spec.mark)?m.type:m)===this.name;var m}}function channelHasField(encoding,channel){const channelDef=encoding&&encoding[channel];return!!channelDef&&(vegaUtil.isArray(channelDef)?some(channelDef,fieldDef=>!!fieldDef.field):isFieldDef(channelDef)||hasConditionalFieldDef(channelDef))}function isAggregate(encoding){return some(CHANNELS,channel=>{if(channelHasField(encoding,channel)){const channelDef=encoding[channel];if(vegaUtil.isArray(channelDef))return some(channelDef,fieldDef=>!!fieldDef.aggregate);{const fieldDef=getFieldDef(channelDef);return fieldDef&&!!fieldDef.aggregate}}return!1})}function extractTransformsFromEncoding(oldEncoding,config){const groupby=[],bins=[],timeUnits=[],aggregate=[],encoding={};return forEach(oldEncoding,(channelDef,channel)=>{if(isFieldDef(channelDef)){const{field:field,aggregate:aggOp,bin:bin,timeUnit:timeUnit,...remaining}=channelDef;if(aggOp||timeUnit||bin){const guide=getGuide(channelDef),isTitleDefined=guide&&guide.title;let newField=vgField(channelDef,{forAs:!0});const newFieldDef={...isTitleDefined?[]:{title:title(channelDef,config,{allowDisabling:!0})},...remaining,field:newField};if(aggOp){let op;if(isArgmaxDef(aggOp)?(op="argmax",newField=vgField({op:"argmax",field:aggOp.argmax},{forAs:!0}),newFieldDef.field="".concat(newField,".").concat(field)):isArgminDef(aggOp)?(op="argmin",newField=vgField({op:"argmin",field:aggOp.argmin},{forAs:!0}),newFieldDef.field="".concat(newField,".").concat(field)):"boxplot"!==aggOp&&"errorbar"!==aggOp&&"errorband"!==aggOp&&(op=aggOp),op){const aggregateEntry={op:op,as:newField};field&&(aggregateEntry.field=field),aggregate.push(aggregateEntry)}}else if(groupby.push(newField),isTypedFieldDef(channelDef)&&isBinning(bin)){if(bins.push({bin:bin,field:field,as:newField}),groupby.push(vgField(channelDef,{binSuffix:"end"})),binRequiresRange(channelDef,channel)&&groupby.push(vgField(channelDef,{binSuffix:"range"})),isXorY(channel)){const secondaryChannel={field:"".concat(newField,"_end")};encoding["".concat(channel,"2")]=secondaryChannel}newFieldDef.bin="binned",isSecondaryRangeChannel(channel)||(newFieldDef.type=QUANTITATIVE)}else if(timeUnit){timeUnits.push({timeUnit:timeUnit,field:field,as:newField});const formatType=isTypedFieldDef(channelDef)&&channelDef.type!==TEMPORAL&&"time";formatType&&("text"===channel||"tooltip"===channel?newFieldDef.formatType=formatType:function(channel){return!!NONPOSITION_CHANNEL_INDEX[channel]}(channel)?newFieldDef.legend={formatType:formatType,...newFieldDef.legend}:isXorY(channel)&&(newFieldDef.axis={formatType:formatType,...newFieldDef.axis}))}encoding[channel]=newFieldDef}else groupby.push(field),encoding[channel]=oldEncoding[channel]}else encoding[channel]=oldEncoding[channel]}),{bins:bins,timeUnits:timeUnits,aggregate:aggregate,groupby:groupby,encoding:encoding}}function initEncoding(encoding,mark,filled,config){return keys(encoding).reduce((normalizedEncoding,channel)=>{if(!isChannel(channel))return warn(function(channel){return"".concat(channel,"-encoding is dropped as ").concat(channel," is not a valid encoding channel.")}(channel)),normalizedEncoding;const channelDef=encoding[channel];if("angle"!==channel||"arc"!==mark||encoding.theta||(warn("Arc marks uses theta channel rather than angle, replacing angle with theta."),channel=THETA),!function(encoding,channel,mark){const markSupported=supportMark(channel,mark);if(!markSupported)return!1;if("binned"===markSupported){const primaryFieldDef=encoding[channel===X2?X:Y];return!!(isFieldDef(primaryFieldDef)&&isFieldDef(encoding[channel])&&isBinned(primaryFieldDef.bin))}return!0}(encoding,channel,mark))return warn(incompatibleChannel(channel,mark)),normalizedEncoding;if(channel===SIZE&&"line"===mark){const fieldDef=getFieldDef(encoding[channel]);if(null!=fieldDef&&fieldDef.aggregate)return warn("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),normalizedEncoding}if(channel===COLOR&&(filled?"fill"in encoding:"stroke"in encoding))return warn(droppingColor("encoding",{fill:"fill"in encoding,stroke:"stroke"in encoding})),normalizedEncoding;if("detail"===channel||"order"===channel&&!vegaUtil.isArray(channelDef)&&!isValueDef(channelDef)||"tooltip"===channel&&vegaUtil.isArray(channelDef))channelDef&&(normalizedEncoding[channel]=vegaUtil.array(channelDef).reduce((defs,fieldDef)=>(isFieldDef(fieldDef)?defs.push(initFieldDef(fieldDef,channel)):warn(emptyFieldDef(fieldDef,channel)),defs),[]));else{if("tooltip"===channel&&null===channelDef)normalizedEncoding[channel]=null;else if(!(isFieldDef(channelDef)||isDatumDef(channelDef)||isValueDef(channelDef)||isConditionalDef(channelDef)||isSignalRef(channelDef)))return warn(emptyFieldDef(channelDef,channel)),normalizedEncoding;normalizedEncoding[channel]=initChannelDef(channelDef,channel,config)}return normalizedEncoding},{})}function normalizeEncoding(encoding,config){const normalizedEncoding={};for(const channel of keys(encoding)){const newChannelDef=initChannelDef(encoding[channel],channel,config,{compositeMark:!0});normalizedEncoding[channel]=newChannelDef}return normalizedEncoding}function forEach(mapping,f,thisArg){if(mapping)for(const channel of keys(mapping)){const el=mapping[channel];if(vegaUtil.isArray(el))for(const channelDef of el)f.call(thisArg,channelDef,channel);else f.call(thisArg,el,channel)}}function pathGroupingFields(mark,encoding){return keys(encoding).reduce((details,channel)=>{switch(channel){case X:case Y:case"href":case"description":case"url":case X2:case Y2:case THETA:case THETA2:case RADIUS:case"radius2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case SHAPE:case"angle":case"tooltip":return details;case"order":if("line"===mark||"trail"===mark)return details;case"detail":case"key":{const channelDef=encoding[channel];if(vegaUtil.isArray(channelDef)||isFieldDef(channelDef))for(const fieldDef of vegaUtil.array(channelDef))fieldDef.aggregate||details.push(vgField(fieldDef,{}));return details}case SIZE:if("trail"===mark)return details;case COLOR:case FILL:case STROKE:case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const fieldDef=getFieldDef(encoding[channel]);return fieldDef&&!fieldDef.aggregate&&details.push(vgField(fieldDef,{})),details}}},[])}function getCompositeMarkTooltip(tooltipSummary,continuousAxisChannelDef,encodingWithoutContinuousAxis,withFieldName=!0){return"tooltip"in encodingWithoutContinuousAxis?{tooltip:encodingWithoutContinuousAxis.tooltip}:{tooltip:[...tooltipSummary.map(({fieldPrefix:fieldPrefix,titlePrefix:titlePrefix})=>{const mainTitle=withFieldName?" of ".concat(getTitle(continuousAxisChannelDef)):"";return{field:fieldPrefix+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type,title:isSignalRef(titlePrefix)?{signal:"".concat(titlePrefix,'"').concat(escape(mainTitle),'"')}:titlePrefix+mainTitle}}),...unique(function(encoding){const arr=[];for(const channel of keys(encoding))if(channelHasField(encoding,channel)){const channelDef=encoding[channel],channelDefArray=vegaUtil.array(channelDef);for(const def of channelDefArray)isFieldDef(def)?arr.push(def):hasConditionalFieldDef(def)&&arr.push(def.condition)}return arr}(encodingWithoutContinuousAxis).map(toStringFieldDef),hash)]}}function getTitle(continuousAxisChannelDef){const{title:title,field:field}=continuousAxisChannelDef;return getFirstDefined(title,field)}function makeCompositeAggregatePartFactory(compositeMarkDef,continuousAxis,continuousAxisChannelDef,sharedEncoding,compositeMarkConfig){const{scale:scale,axis:axis}=continuousAxisChannelDef;return({partName:partName,mark:mark,positionPrefix:positionPrefix,endPositionPrefix:endPositionPrefix,extraEncoding:extraEncoding={}})=>{const title=getTitle(continuousAxisChannelDef);return partLayerMixins(compositeMarkDef,partName,compositeMarkConfig,{mark:mark,encoding:{[continuousAxis]:{field:"".concat(positionPrefix,"_").concat(continuousAxisChannelDef.field),type:continuousAxisChannelDef.type,...void 0!==title?{title:title}:{},...void 0!==scale?{scale:scale}:{},...void 0!==axis?{axis:axis}:{}},...vegaUtil.isString(endPositionPrefix)?{["".concat(continuousAxis,"2")]:{field:"".concat(endPositionPrefix,"_").concat(continuousAxisChannelDef.field)}}:{},...sharedEncoding,...extraEncoding}})}}function partLayerMixins(markDef,part,compositeMarkConfig,partBaseSpec){const{clip:clip,color:color,opacity:opacity}=markDef,mark=markDef.type;return markDef[part]||void 0===markDef[part]&&compositeMarkConfig[part]?[{...partBaseSpec,mark:{...compositeMarkConfig[part],...clip?{clip:clip}:{},...color?{color:color}:{},...opacity?{opacity:opacity}:{},...isMarkDef(partBaseSpec.mark)?partBaseSpec.mark:{type:partBaseSpec.mark},style:"".concat(mark,"-").concat(part),...vegaUtil.isBoolean(markDef[part])?{}:markDef[part]}}]:[]}function compositeMarkContinuousAxis(spec,orient,compositeMark){const{encoding:encoding}=spec,continuousAxis="vertical"===orient?"y":"x",continuousAxisChannelDef=encoding[continuousAxis],continuousAxisChannelDef2=encoding["".concat(continuousAxis,"2")],continuousAxisChannelDefError=encoding["".concat(continuousAxis,"Error")],continuousAxisChannelDefError2=encoding["".concat(continuousAxis,"Error2")];return{continuousAxisChannelDef:filterAggregateFromChannelDef(continuousAxisChannelDef,compositeMark),continuousAxisChannelDef2:filterAggregateFromChannelDef(continuousAxisChannelDef2,compositeMark),continuousAxisChannelDefError:filterAggregateFromChannelDef(continuousAxisChannelDefError,compositeMark),continuousAxisChannelDefError2:filterAggregateFromChannelDef(continuousAxisChannelDefError2,compositeMark),continuousAxis:continuousAxis}}function filterAggregateFromChannelDef(continuousAxisChannelDef,compositeMark){if(continuousAxisChannelDef&&continuousAxisChannelDef.aggregate){const{aggregate:aggregate,...continuousAxisWithoutAggregate}=continuousAxisChannelDef;return aggregate!==compositeMark&&warn(function(aggregate,compositeMark){return"Continuous axis should not have customized aggregation function ".concat(aggregate,"; ").concat(compositeMark," already agregates the axis.")}(aggregate,compositeMark)),continuousAxisWithoutAggregate}return continuousAxisChannelDef}function compositeMarkOrient(spec,compositeMark){const{mark:mark,encoding:encoding}=spec,{x:x,y:y}=encoding;if(isMarkDef(mark)&&mark.orient)return mark.orient;if(isContinuousFieldOrDatumDef(x)){if(isContinuousFieldOrDatumDef(y)){const xAggregate=isFieldDef(x)&&x.aggregate,yAggregate=isFieldDef(y)&&y.aggregate;if(xAggregate||yAggregate!==compositeMark){if(yAggregate||xAggregate!==compositeMark){if(xAggregate===compositeMark&&yAggregate===compositeMark)throw new Error("Both x and y cannot have aggregate");return isFieldOrDatumDefForTimeFormat(y)&&!isFieldOrDatumDefForTimeFormat(x)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(isContinuousFieldOrDatumDef(y))return"vertical";throw new Error("Need a valid continuous axis for ".concat(compositeMark,"s"))}const boxPlotNormalizer=new CompositeMarkNormalizer("boxplot",normalizeBoxPlot);function getBoxPlotType(extent){return vegaUtil.isNumber(extent)?"tukey":extent}function normalizeBoxPlot(spec,{config:config}){var _markDef$extent;spec={...spec,encoding:normalizeEncoding(spec.encoding,config)};const{mark:mark,encoding:_encoding,params:params,projection:_p,...outerSpec}=spec,markDef=isMarkDef(mark)?mark:{type:mark};params&&warn(selectionNotSupported("boxplot"));const extent=null!==(_markDef$extent=markDef.extent)&&void 0!==_markDef$extent?_markDef$extent:config.boxplot.extent,sizeValue=getMarkPropOrConfig("size",markDef,config),boxPlotType=getBoxPlotType(extent),{bins:bins,timeUnits:timeUnits,transform:transform,continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis,groupby:groupby,aggregate:aggregate,encodingWithoutContinuousAxis:encodingWithoutContinuousAxis,ticksOrient:ticksOrient,boxOrient:boxOrient,customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField}=function(spec,extent,config){const orient=compositeMarkOrient(spec,"boxplot"),{continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis}=compositeMarkContinuousAxis(spec,orient,"boxplot"),continuousFieldName=continuousAxisChannelDef.field,boxPlotType=getBoxPlotType(extent),boxplotSpecificAggregate=[...boxParamsQuartiles(continuousFieldName),{op:"median",field:continuousFieldName,as:"mid_box_".concat(continuousFieldName)},{op:"min",field:continuousFieldName,as:("min-max"===boxPlotType?"lower_whisker_":"min_")+continuousFieldName},{op:"max",field:continuousFieldName,as:("min-max"===boxPlotType?"upper_whisker_":"max_")+continuousFieldName}],postAggregateCalculates="min-max"===boxPlotType||"tukey"===boxPlotType?[]:[{calculate:'datum["upper_box_'.concat(continuousFieldName,'"] - datum["lower_box_').concat(continuousFieldName,'"]'),as:"iqr_".concat(continuousFieldName)},{calculate:'min(datum["upper_box_'.concat(continuousFieldName,'"] + datum["iqr_').concat(continuousFieldName,'"] * ').concat(extent,', datum["max_').concat(continuousFieldName,'"])'),as:"upper_whisker_".concat(continuousFieldName)},{calculate:'max(datum["lower_box_'.concat(continuousFieldName,'"] - datum["iqr_').concat(continuousFieldName,'"] * ').concat(extent,', datum["min_').concat(continuousFieldName,'"])'),as:"lower_whisker_".concat(continuousFieldName)}],{[continuousAxis]:oldContinuousAxisChannelDef,...oldEncodingWithoutContinuousAxis}=spec.encoding,{customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField,filteredEncoding:filteredEncoding}=function(oldEncoding){const{tooltip:tooltip,...filteredEncoding}=oldEncoding;if(!tooltip)return{filteredEncoding:filteredEncoding};let customTooltipWithAggregatedField,customTooltipWithoutAggregatedField;if(vegaUtil.isArray(tooltip)){for(const t of tooltip)t.aggregate?(customTooltipWithAggregatedField||(customTooltipWithAggregatedField=[]),customTooltipWithAggregatedField.push(t)):(customTooltipWithoutAggregatedField||(customTooltipWithoutAggregatedField=[]),customTooltipWithoutAggregatedField.push(t));customTooltipWithAggregatedField&&(filteredEncoding.tooltip=customTooltipWithAggregatedField)}else tooltip.aggregate?filteredEncoding.tooltip=tooltip:customTooltipWithoutAggregatedField=tooltip;return vegaUtil.isArray(customTooltipWithoutAggregatedField)&&1===customTooltipWithoutAggregatedField.length&&(customTooltipWithoutAggregatedField=customTooltipWithoutAggregatedField[0]),{customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField,filteredEncoding:filteredEncoding}}(oldEncodingWithoutContinuousAxis),{bins:bins,timeUnits:timeUnits,aggregate:aggregate,groupby:groupby,encoding:encodingWithoutContinuousAxis}=extractTransformsFromEncoding(filteredEncoding,config),ticksOrient="vertical"===orient?"horizontal":"vertical",boxOrient=orient,transform=[...bins,...timeUnits,{aggregate:[...aggregate,...boxplotSpecificAggregate],groupby:groupby},...postAggregateCalculates];return{bins:bins,timeUnits:timeUnits,transform:transform,groupby:groupby,aggregate:aggregate,continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis,encodingWithoutContinuousAxis:encodingWithoutContinuousAxis,ticksOrient:ticksOrient,boxOrient:boxOrient,customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField}}(spec,extent,config),{color:color,size:size,...encodingWithoutSizeColorAndContinuousAxis}=encodingWithoutContinuousAxis,makeBoxPlotPart=sharedEncoding=>makeCompositeAggregatePartFactory(markDef,continuousAxis,continuousAxisChannelDef,sharedEncoding,config.boxplot),makeBoxPlotExtent=makeBoxPlotPart(encodingWithoutSizeColorAndContinuousAxis),makeBoxPlotBox=makeBoxPlotPart(encodingWithoutContinuousAxis),makeBoxPlotMidTick=makeBoxPlotPart({...encodingWithoutSizeColorAndContinuousAxis,...size?{size:size}:{}}),fiveSummaryTooltipEncoding=getCompositeMarkTooltip([{fieldPrefix:"min-max"===boxPlotType?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===boxPlotType?"lower_whisker_":"min_",titlePrefix:"Min"}],continuousAxisChannelDef,encodingWithoutContinuousAxis),endTick={type:"tick",color:"black",opacity:1,orient:ticksOrient,invalid:null,aria:!1},whiskerTooltipEncoding="min-max"===boxPlotType?fiveSummaryTooltipEncoding:getCompositeMarkTooltip([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],continuousAxisChannelDef,encodingWithoutContinuousAxis),whiskerLayers=[...makeBoxPlotExtent({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:whiskerTooltipEncoding}),...makeBoxPlotExtent({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:whiskerTooltipEncoding}),...makeBoxPlotExtent({partName:"ticks",mark:endTick,positionPrefix:"lower_whisker",extraEncoding:whiskerTooltipEncoding}),...makeBoxPlotExtent({partName:"ticks",mark:endTick,positionPrefix:"upper_whisker",extraEncoding:whiskerTooltipEncoding})],boxLayers=[..."tukey"!==boxPlotType?whiskerLayers:[],...makeBoxPlotBox({partName:"box",mark:{type:"bar",...sizeValue?{size:sizeValue}:{},orient:boxOrient,invalid:null,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:fiveSummaryTooltipEncoding}),...makeBoxPlotMidTick({partName:"median",mark:{type:"tick",invalid:null,...vegaUtil.isObject(config.boxplot.median)&&config.boxplot.median.color?{color:config.boxplot.median.color}:{},...sizeValue?{size:sizeValue}:{},orient:ticksOrient,aria:!1},positionPrefix:"mid_box",extraEncoding:fiveSummaryTooltipEncoding})];var _outerSpec$transform;if("min-max"===boxPlotType)return{...outerSpec,transform:(null!==(_outerSpec$transform=outerSpec.transform)&&void 0!==_outerSpec$transform?_outerSpec$transform:[]).concat(transform),layer:boxLayers};const lowerBoxExpr='datum["lower_box_'.concat(continuousAxisChannelDef.field,'"]'),upperBoxExpr='datum["upper_box_'.concat(continuousAxisChannelDef.field,'"]'),iqrExpr="(".concat(upperBoxExpr," - ").concat(lowerBoxExpr,")"),lowerWhiskerExpr="".concat(lowerBoxExpr," - ").concat(extent," * ").concat(iqrExpr),upperWhiskerExpr="".concat(upperBoxExpr," + ").concat(extent," * ").concat(iqrExpr),fieldExpr='datum["'.concat(continuousAxisChannelDef.field,'"]'),joinaggregateTransform={joinaggregate:boxParamsQuartiles(continuousAxisChannelDef.field),groupby:groupby},filteredWhiskerSpec={transform:[{filter:"(".concat(lowerWhiskerExpr," <= ").concat(fieldExpr,") && (").concat(fieldExpr," <= ").concat(upperWhiskerExpr,")")},{aggregate:[{op:"min",field:continuousAxisChannelDef.field,as:"lower_whisker_".concat(continuousAxisChannelDef.field)},{op:"max",field:continuousAxisChannelDef.field,as:"upper_whisker_".concat(continuousAxisChannelDef.field)},{op:"min",field:"lower_box_".concat(continuousAxisChannelDef.field),as:"lower_box_".concat(continuousAxisChannelDef.field)},{op:"max",field:"upper_box_".concat(continuousAxisChannelDef.field),as:"upper_box_".concat(continuousAxisChannelDef.field)},...aggregate],groupby:groupby}],layer:whiskerLayers},{tooltip:tooltip,...encodingWithoutSizeColorContinuousAxisAndTooltip}=encodingWithoutSizeColorAndContinuousAxis,{scale:scale,axis:axis}=continuousAxisChannelDef,title=getTitle(continuousAxisChannelDef),axisWithoutTitle=omit(axis,["title"]),outlierLayersMixins=partLayerMixins(markDef,"outliers",config.boxplot,{transform:[{filter:"(".concat(fieldExpr," < ").concat(lowerWhiskerExpr,") || (").concat(fieldExpr," > ").concat(upperWhiskerExpr,")")}],mark:"point",encoding:{[continuousAxis]:{field:continuousAxisChannelDef.field,type:continuousAxisChannelDef.type,...void 0!==title?{title:title}:{},...void 0!==scale?{scale:scale}:{},...isEmpty(axisWithoutTitle)?{}:{axis:axisWithoutTitle}},...encodingWithoutSizeColorContinuousAxisAndTooltip,...color?{color:color}:{},...customTooltipWithoutAggregatedField?{tooltip:customTooltipWithoutAggregatedField}:{}}})[0];let filteredLayersMixins;const filteredLayersMixinsTransforms=[...bins,...timeUnits,joinaggregateTransform];return outlierLayersMixins?filteredLayersMixins={transform:filteredLayersMixinsTransforms,layer:[outlierLayersMixins,filteredWhiskerSpec]}:(filteredLayersMixins=filteredWhiskerSpec,filteredLayersMixins.transform.unshift(...filteredLayersMixinsTransforms)),{...outerSpec,layer:[filteredLayersMixins,{transform:transform,layer:boxLayers}]}}function boxParamsQuartiles(continousAxisField){return[{op:"q1",field:continousAxisField,as:"lower_box_".concat(continousAxisField)},{op:"q3",field:continousAxisField,as:"upper_box_".concat(continousAxisField)}]}const errorBarNormalizer=new CompositeMarkNormalizer("errorbar",normalizeErrorBar);function normalizeErrorBar(spec,{config:config}){spec={...spec,encoding:normalizeEncoding(spec.encoding,config)};const{transform:transform,continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis,encodingWithoutContinuousAxis:encodingWithoutContinuousAxis,ticksOrient:ticksOrient,markDef:markDef,outerSpec:outerSpec,tooltipEncoding:tooltipEncoding}=errorBarParams(spec,"errorbar",config);delete encodingWithoutContinuousAxis.size;const makeErrorBarPart=makeCompositeAggregatePartFactory(markDef,continuousAxis,continuousAxisChannelDef,encodingWithoutContinuousAxis,config.errorbar),thickness=markDef.thickness,size=markDef.size,tick={type:"tick",orient:ticksOrient,aria:!1,...void 0!==thickness?{thickness:thickness}:{},...void 0!==size?{size:size}:{}},layer=[...makeErrorBarPart({partName:"ticks",mark:tick,positionPrefix:"lower",extraEncoding:tooltipEncoding}),...makeErrorBarPart({partName:"ticks",mark:tick,positionPrefix:"upper",extraEncoding:tooltipEncoding}),...makeErrorBarPart({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...void 0!==thickness?{size:thickness}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:tooltipEncoding})];return{...outerSpec,transform:transform,...layer.length>1?{layer:layer}:{...layer[0]}}}function errorBarOrientAndInputType(spec,compositeMark){const{encoding:encoding}=spec;if(function(encoding){return(isFieldOrDatumDef(encoding.x)||isFieldOrDatumDef(encoding.y))&&!isFieldOrDatumDef(encoding.x2)&&!isFieldOrDatumDef(encoding.y2)&&!isFieldOrDatumDef(encoding.xError)&&!isFieldOrDatumDef(encoding.xError2)&&!isFieldOrDatumDef(encoding.yError)&&!isFieldOrDatumDef(encoding.yError2)}(encoding))return{orient:compositeMarkOrient(spec,compositeMark),inputType:"raw"};const isTypeAggregatedUpperLower=function(encoding){return isFieldOrDatumDef(encoding.x2)||isFieldOrDatumDef(encoding.y2)}(encoding),isTypeAggregatedError=function(encoding){return isFieldOrDatumDef(encoding.xError)||isFieldOrDatumDef(encoding.xError2)||isFieldOrDatumDef(encoding.yError)||isFieldOrDatumDef(encoding.yError2)}(encoding),x=encoding.x,y=encoding.y;if(isTypeAggregatedUpperLower){if(isTypeAggregatedError)throw new Error("".concat(compositeMark," cannot be both type aggregated-upper-lower and aggregated-error"));const x2=encoding.x2,y2=encoding.y2;if(isFieldOrDatumDef(x2)&&isFieldOrDatumDef(y2))throw new Error("".concat(compositeMark," cannot have both x2 and y2"));if(isFieldOrDatumDef(x2)){if(isContinuousFieldOrDatumDef(x))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in ".concat(compositeMark))}if(isFieldOrDatumDef(y2)){if(isContinuousFieldOrDatumDef(y))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in ".concat(compositeMark))}throw new Error("No ranged axis")}{const xError=encoding.xError,xError2=encoding.xError2,yError=encoding.yError,yError2=encoding.yError2;if(isFieldOrDatumDef(xError2)&&!isFieldOrDatumDef(xError))throw new Error("".concat(compositeMark," cannot have xError2 without xError"));if(isFieldOrDatumDef(yError2)&&!isFieldOrDatumDef(yError))throw new Error("".concat(compositeMark," cannot have yError2 without yError"));if(isFieldOrDatumDef(xError)&&isFieldOrDatumDef(yError))throw new Error("".concat(compositeMark," cannot have both xError and yError with both are quantiative"));if(isFieldOrDatumDef(xError)){if(isContinuousFieldOrDatumDef(x))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(isFieldOrDatumDef(yError)){if(isContinuousFieldOrDatumDef(y))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function errorBarParams(spec,compositeMark,config){var _outerSpec$transform;const{mark:mark,encoding:encoding,params:params,projection:_p,...outerSpec}=spec,markDef=isMarkDef(mark)?mark:{type:mark};params&&warn(selectionNotSupported(compositeMark));const{orient:orient,inputType:inputType}=errorBarOrientAndInputType(spec,compositeMark),{continuousAxisChannelDef:continuousAxisChannelDef,continuousAxisChannelDef2:continuousAxisChannelDef2,continuousAxisChannelDefError:continuousAxisChannelDefError,continuousAxisChannelDefError2:continuousAxisChannelDefError2,continuousAxis:continuousAxis}=compositeMarkContinuousAxis(spec,orient,compositeMark),{errorBarSpecificAggregate:errorBarSpecificAggregate,postAggregateCalculates:postAggregateCalculates,tooltipSummary:tooltipSummary,tooltipTitleWithFieldName:tooltipTitleWithFieldName}=function(markDef,continuousAxisChannelDef,continuousAxisChannelDef2,continuousAxisChannelDefError,continuousAxisChannelDefError2,inputType,compositeMark,config){let errorBarSpecificAggregate=[],postAggregateCalculates=[];const continuousFieldName=continuousAxisChannelDef.field;let tooltipSummary,tooltipTitleWithFieldName=!1;if("raw"===inputType){const center=markDef.center?markDef.center:markDef.extent?"iqr"===markDef.extent?"median":"mean":config.errorbar.center,extent=markDef.extent?markDef.extent:"mean"===center?"stderr":"iqr";if("median"===center!=("iqr"===extent)&&warn(function(center,extent,mark){return"".concat(center," is not usually used with ").concat(extent," for ").concat(mark,".")}(center,extent,compositeMark)),"stderr"===extent||"stdev"===extent)errorBarSpecificAggregate=[{op:extent,field:continuousFieldName,as:"extent_".concat(continuousFieldName)},{op:center,field:continuousFieldName,as:"center_".concat(continuousFieldName)}],postAggregateCalculates=[{calculate:'datum["center_'.concat(continuousFieldName,'"] + datum["extent_').concat(continuousFieldName,'"]'),as:"upper_".concat(continuousFieldName)},{calculate:'datum["center_'.concat(continuousFieldName,'"] - datum["extent_').concat(continuousFieldName,'"]'),as:"lower_".concat(continuousFieldName)}],tooltipSummary=[{fieldPrefix:"center_",titlePrefix:titleCase(center)},{fieldPrefix:"upper_",titlePrefix:getTitlePrefix(center,extent,"+")},{fieldPrefix:"lower_",titlePrefix:getTitlePrefix(center,extent,"-")}],tooltipTitleWithFieldName=!0;else{let centerOp,lowerExtentOp,upperExtentOp;"ci"===extent?(centerOp="mean",lowerExtentOp="ci0",upperExtentOp="ci1"):(centerOp="median",lowerExtentOp="q1",upperExtentOp="q3"),errorBarSpecificAggregate=[{op:lowerExtentOp,field:continuousFieldName,as:"lower_".concat(continuousFieldName)},{op:upperExtentOp,field:continuousFieldName,as:"upper_".concat(continuousFieldName)},{op:centerOp,field:continuousFieldName,as:"center_".concat(continuousFieldName)}],tooltipSummary=[{fieldPrefix:"upper_",titlePrefix:title({field:continuousFieldName,aggregate:upperExtentOp,type:"quantitative"},config,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:title({field:continuousFieldName,aggregate:lowerExtentOp,type:"quantitative"},config,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:title({field:continuousFieldName,aggregate:centerOp,type:"quantitative"},config,{allowDisabling:!1})}]}}else{(markDef.center||markDef.extent)&&warn((center=markDef.center,extent=markDef.extent,"".concat(extent?"extent ":"").concat(extent&&center?"and ":"").concat(center?"center ":"").concat(extent&&center?"are ":"is ","not needed when data are aggregated."))),"aggregated-upper-lower"===inputType?(tooltipSummary=[],postAggregateCalculates=[{calculate:'datum["'.concat(continuousAxisChannelDef2.field,'"]'),as:"upper_".concat(continuousFieldName)},{calculate:'datum["'.concat(continuousFieldName,'"]'),as:"lower_".concat(continuousFieldName)}]):"aggregated-error"===inputType&&(tooltipSummary=[{fieldPrefix:"",titlePrefix:continuousFieldName}],postAggregateCalculates=[{calculate:'datum["'.concat(continuousFieldName,'"] + datum["').concat(continuousAxisChannelDefError.field,'"]'),as:"upper_".concat(continuousFieldName)}],continuousAxisChannelDefError2?postAggregateCalculates.push({calculate:'datum["'.concat(continuousFieldName,'"] + datum["').concat(continuousAxisChannelDefError2.field,'"]'),as:"lower_".concat(continuousFieldName)}):postAggregateCalculates.push({calculate:'datum["'.concat(continuousFieldName,'"] - datum["').concat(continuousAxisChannelDefError.field,'"]'),as:"lower_".concat(continuousFieldName)}));for(const postAggregateCalculate of postAggregateCalculates)tooltipSummary.push({fieldPrefix:postAggregateCalculate.as.substring(0,6),titlePrefix:replaceAll(replaceAll(postAggregateCalculate.calculate,'datum["',""),'"]',"")})}var center,extent;return{postAggregateCalculates:postAggregateCalculates,errorBarSpecificAggregate:errorBarSpecificAggregate,tooltipSummary:tooltipSummary,tooltipTitleWithFieldName:tooltipTitleWithFieldName}}(markDef,continuousAxisChannelDef,continuousAxisChannelDef2,continuousAxisChannelDefError,continuousAxisChannelDefError2,inputType,compositeMark,config),{[continuousAxis]:oldContinuousAxisChannelDef,["x"===continuousAxis?"x2":"y2"]:oldContinuousAxisChannelDef2,["x"===continuousAxis?"xError":"yError"]:oldContinuousAxisChannelDefError,["x"===continuousAxis?"xError2":"yError2"]:oldContinuousAxisChannelDefError2,...oldEncodingWithoutContinuousAxis}=encoding,{bins:bins,timeUnits:timeUnits,aggregate:oldAggregate,groupby:oldGroupBy,encoding:encodingWithoutContinuousAxis}=extractTransformsFromEncoding(oldEncodingWithoutContinuousAxis,config),aggregate=[...oldAggregate,...errorBarSpecificAggregate],groupby="raw"!==inputType?[]:oldGroupBy,tooltipEncoding=getCompositeMarkTooltip(tooltipSummary,continuousAxisChannelDef,encodingWithoutContinuousAxis,tooltipTitleWithFieldName);return{transform:[...null!==(_outerSpec$transform=outerSpec.transform)&&void 0!==_outerSpec$transform?_outerSpec$transform:[],...bins,...timeUnits,...0===aggregate.length?[]:[{aggregate:aggregate,groupby:groupby}],...postAggregateCalculates],groupby:groupby,continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis,encodingWithoutContinuousAxis:encodingWithoutContinuousAxis,ticksOrient:"vertical"===orient?"horizontal":"vertical",markDef:markDef,outerSpec:outerSpec,tooltipEncoding:tooltipEncoding}}function getTitlePrefix(center,extent,operation){return"".concat(titleCase(center)," ").concat(operation," ").concat(extent)}const errorBandNormalizer=new CompositeMarkNormalizer("errorband",normalizeErrorBand);function normalizeErrorBand(spec,{config:config}){spec={...spec,encoding:normalizeEncoding(spec.encoding,config)};const{transform:transform,continuousAxisChannelDef:continuousAxisChannelDef,continuousAxis:continuousAxis,encodingWithoutContinuousAxis:encodingWithoutContinuousAxis,markDef:markDef,outerSpec:outerSpec,tooltipEncoding:tooltipEncoding}=errorBarParams(spec,"errorband",config),errorBandDef=markDef,makeErrorBandPart=makeCompositeAggregatePartFactory(errorBandDef,continuousAxis,continuousAxisChannelDef,encodingWithoutContinuousAxis,config.errorband),is2D=void 0!==spec.encoding.x&&void 0!==spec.encoding.y;let bandMark={type:is2D?"area":"rect"},bordersMark={type:is2D?"line":"rule"};const interpolate={...errorBandDef.interpolate?{interpolate:errorBandDef.interpolate}:{},...errorBandDef.tension&&errorBandDef.interpolate?{tension:errorBandDef.tension}:{}};return is2D?(bandMark={...bandMark,...interpolate,ariaRoleDescription:"errorband"},bordersMark={...bordersMark,...interpolate,aria:!1}):errorBandDef.interpolate?warn(errorBand1DNotSupport("interpolate")):errorBandDef.tension&&warn(errorBand1DNotSupport("tension")),{...outerSpec,transform:transform,layer:[...makeErrorBandPart({partName:"band",mark:bandMark,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:tooltipEncoding}),...makeErrorBandPart({partName:"borders",mark:bordersMark,positionPrefix:"lower",extraEncoding:tooltipEncoding}),...makeErrorBandPart({partName:"borders",mark:bordersMark,positionPrefix:"upper",extraEncoding:tooltipEncoding})]}}const compositeMarkRegistry={};function add(mark,run,parts){const normalizer=new CompositeMarkNormalizer(mark,run);compositeMarkRegistry[mark]={normalizer:normalizer,parts:parts}}add("boxplot",normalizeBoxPlot,["box","median","outliers","rule","ticks"]),add("errorbar",normalizeErrorBar,["ticks","rule"]),add("errorband",normalizeErrorBand,["band","borders"]);const VL_ONLY_LEGEND_CONFIG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],HEADER_TITLE_PROPERTIES_MAP={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},HEADER_LABEL_PROPERTIES_MAP={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},HEADER_TITLE_PROPERTIES=keys(HEADER_TITLE_PROPERTIES_MAP),HEADER_LABEL_PROPERTIES=keys(HEADER_LABEL_PROPERTIES_MAP),HEADER_CONFIGS=keys({header:1,headerRow:1,headerColumn:1,headerFacet:1}),LEGEND_SCALE_CHANNELS=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],defaultConfig={point:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function isLegendBinding(bind){return!(!bind||"legend"!==bind&&!bind.legend)}function isLegendStreamBinding(bind){return isLegendBinding(bind)&&vegaUtil.isObject(bind)}function isSelectionParameter(param){return!!param.select}function assembleParameterSignals(params){const signals=[];for(const param of params||[]){if(isSelectionParameter(param))continue;const{expr:expr,bind:bind,...rest}=param;if(bind&&expr){const signal={...rest,bind:bind,init:expr};signals.push(signal)}else{const signal={...rest,...expr?{update:expr}:{},...bind?{bind:bind}:{}};signals.push(signal)}}return signals}function isConcatSpec(spec){return"concat"in spec}function isVConcatSpec(spec){return"vconcat"in spec}function isHConcatSpec(spec){return"hconcat"in spec}const TOP_LEVEL_PROPERTIES=["background","padding"];function extractTopLevelProperties(t,includeParams){const o={};for(const p of TOP_LEVEL_PROPERTIES)t&&void 0!==t[p]&&(o[p]=signalRefOrValue(t[p]));return includeParams&&(o.params=t.params),o}function isStep(size){return vegaUtil.isObject(size)&&void 0!==size.step}function isFrameMixins(o){return o.view||o.width||o.height}const COMPOSITION_LAYOUT_PROPERTIES=keys({align:1,bounds:1,center:1,columns:1,spacing:1});function getViewConfigContinuousSize(viewConfig,channel){var _viewConfig$channel;return null!==(_viewConfig$channel=viewConfig[channel])&&void 0!==_viewConfig$channel?_viewConfig$channel:viewConfig["width"===channel?"continuousWidth":"continuousHeight"]}function getViewConfigDiscreteStep(viewConfig,channel){const size=getViewConfigDiscreteSize(viewConfig,channel);return isStep(size)?size.step:DEFAULT_STEP}function getViewConfigDiscreteSize(viewConfig,channel){var _viewConfig$channel2;return getFirstDefined(null!==(_viewConfig$channel2=viewConfig[channel])&&void 0!==_viewConfig$channel2?_viewConfig$channel2:viewConfig["width"===channel?"discreteWidth":"discreteHeight"],{step:viewConfig.step})}const DEFAULT_STEP=20,defaultConfig$1={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:DEFAULT_STEP},mark:{color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},arc:{},area:{},bar:defaultBarConfig,circle:{},geoshape:{},image:{},line:{},point:{},rect:defaultRectConfig,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:defaultConfig,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},tab10=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],DEFAULT_FONT_SIZE={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},DEFAULT_COLOR={blue:tab10[0],orange:tab10[1],red:tab10[2],teal:tab10[3],green:tab10[4],yellow:tab10[5],purple:tab10[6],pink:tab10[7],brown:tab10[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function getAxisConfigInternal(axisConfig){const props=keys(axisConfig||{}),axisConfigInternal={};for(const prop of props){const val=axisConfig[prop];axisConfigInternal[prop]=isConditionalAxisValue(val)?signalOrValueRefWithCondition(val):signalRefOrValue(val)}return axisConfigInternal}const configPropsWithExpr=[...MARK_CONFIGS,...AXIS_CONFIGS,...HEADER_CONFIGS,"background","padding","legend","lineBreak","scale","style","title","view"];function initConfig(specifiedConfig={}){const{color:color,font:font,fontSize:fontSize,...restConfig}=specifiedConfig,mergedConfig=vegaUtil.mergeConfig({},defaultConfig$1,font?function(font){return{text:{font:font},style:{"guide-label":{font:font},"guide-title":{font:font},"group-title":{font:font},"group-subtitle":{font:font}}}}(font):{},color?function(color={}){return{signals:[{name:"color",value:vegaUtil.isObject(color)?{...DEFAULT_COLOR,...color}:DEFAULT_COLOR}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(color):{},fontSize?function(fontSize){return{signals:[{name:"fontSize",value:vegaUtil.isObject(fontSize)?{...DEFAULT_FONT_SIZE,...fontSize}:DEFAULT_FONT_SIZE}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(fontSize):{},restConfig||{}),outputConfig=omit(mergedConfig,configPropsWithExpr);for(const prop of["background","lineBreak","padding"])mergedConfig[prop]&&(outputConfig[prop]=signalRefOrValue(mergedConfig[prop]));for(const markConfigType of MARK_CONFIGS)mergedConfig[markConfigType]&&(outputConfig[markConfigType]=replaceExprRef(mergedConfig[markConfigType]));for(const axisConfigType of AXIS_CONFIGS)mergedConfig[axisConfigType]&&(outputConfig[axisConfigType]=getAxisConfigInternal(mergedConfig[axisConfigType]));for(const headerConfigType of HEADER_CONFIGS)mergedConfig[headerConfigType]&&(outputConfig[headerConfigType]=replaceExprRef(mergedConfig[headerConfigType]));return mergedConfig.legend&&(outputConfig.legend=replaceExprRef(mergedConfig.legend)),mergedConfig.scale&&(outputConfig.scale=replaceExprRef(mergedConfig.scale)),mergedConfig.style&&(outputConfig.style=function(styleConfig){const props=keys(styleConfig),styleConfigInternal={};for(const prop of props)styleConfigInternal[prop]=getAxisConfigInternal(styleConfig[prop]);return styleConfigInternal}(mergedConfig.style)),mergedConfig.title&&(outputConfig.title=replaceExprRef(mergedConfig.title)),mergedConfig.view&&(outputConfig.view=replaceExprRef(mergedConfig.view)),outputConfig}const MARK_STYLES=["view",...PRIMITIVE_MARKS],VL_ONLY_CONFIG_PROPERTIES=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]};function stripAndRedirectConfig(config){config=duplicate(config);for(const prop of VL_ONLY_CONFIG_PROPERTIES)delete config[prop];if(config.axis)for(const prop in config.axis)isConditionalAxisValue(config.axis[prop])&&delete config.axis[prop];if(config.legend)for(const prop of VL_ONLY_LEGEND_CONFIG)delete config.legend[prop];if(config.mark){for(const prop of VL_ONLY_MARK_CONFIG_PROPERTIES)delete config.mark[prop];config.mark.tooltip&&vegaUtil.isObject(config.mark.tooltip)&&delete config.mark.tooltip}config.params&&(config.signals=(config.signals||[]).concat(assembleParameterSignals(config.params)),delete config.params);for(const markType of MARK_STYLES){for(const prop of VL_ONLY_MARK_CONFIG_PROPERTIES)delete config[markType][prop];const vlOnlyMarkSpecificConfigs=VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[markType];if(vlOnlyMarkSpecificConfigs)for(const prop of vlOnlyMarkSpecificConfigs)delete config[markType][prop];redirectConfigToStyleConfig(config,markType)}for(const m of keys(compositeMarkRegistry))delete config[m];!function(config){const{titleMarkConfig:titleMarkConfig,subtitleMarkConfig:subtitleMarkConfig,subtitle:subtitle}=extractTitleConfig(config.title);isEmpty(titleMarkConfig)||(config.style["group-title"]={...config.style["group-title"],...titleMarkConfig}),isEmpty(subtitleMarkConfig)||(config.style["group-subtitle"]={...config.style["group-subtitle"],...subtitleMarkConfig}),isEmpty(subtitle)?delete config.title:config.title=subtitle}(config);for(const prop in config)vegaUtil.isObject(config[prop])&&isEmpty(config[prop])&&delete config[prop];return isEmpty(config)?void 0:config}function redirectConfigToStyleConfig(config,prop,toProp,compositeMarkPart){var _toProp;"view"===prop&&(toProp="cell");const style={...compositeMarkPart?config[prop][compositeMarkPart]:config[prop],...config.style[null!==(_toProp=toProp)&&void 0!==_toProp?_toProp:prop]};var _toProp2;isEmpty(style)||(config.style[null!==(_toProp2=toProp)&&void 0!==_toProp2?_toProp2:prop]=style),compositeMarkPart||delete config[prop]}function isLayerSpec(spec){return"layer"in spec}class SpecMapper{map(spec,params){return isFacetSpec(spec)?this.mapFacet(spec,params):function(spec){return"repeat"in spec}(spec)?this.mapRepeat(spec,params):isHConcatSpec(spec)?this.mapHConcat(spec,params):isVConcatSpec(spec)?this.mapVConcat(spec,params):isConcatSpec(spec)?this.mapConcat(spec,params):this.mapLayerOrUnit(spec,params)}mapLayerOrUnit(spec,params){if(isLayerSpec(spec))return this.mapLayer(spec,params);if(isUnitSpec(spec))return this.mapUnit(spec,params);throw new Error(invalidSpec(spec))}mapLayer(spec,params){return{...spec,layer:spec.layer.map(subspec=>this.mapLayerOrUnit(subspec,params))}}mapHConcat(spec,params){return{...spec,hconcat:spec.hconcat.map(subspec=>this.map(subspec,params))}}mapVConcat(spec,params){return{...spec,vconcat:spec.vconcat.map(subspec=>this.map(subspec,params))}}mapConcat(spec,params){const{concat:concat,...rest}=spec;return{...rest,concat:concat.map(subspec=>this.map(subspec,params))}}mapFacet(spec,params){return{...spec,spec:this.map(spec.spec,params)}}mapRepeat(spec,params){return{...spec,spec:this.map(spec.spec,params)}}}const STACK_OFFSET_INDEX={zero:1,center:1,normalize:1},STACKABLE_MARKS=new Set([ARC,BAR,AREA,RULE,POINT,CIRCLE,SQUARE,LINE,TEXT$1,TICK]),STACK_BY_DEFAULT_MARKS=new Set([BAR,AREA,ARC]);function potentialStackedChannel(encoding,x){const y="x"===x?"y":"radius",xDef=encoding[x],yDef=encoding[y];if(isFieldDef(xDef)&&isFieldDef(yDef))if("quantitative"===channelDefType(xDef)&&"quantitative"===channelDefType(yDef)){if(xDef.stack)return x;if(yDef.stack)return y;const xAggregate=isFieldDef(xDef)&&!!xDef.aggregate;if(xAggregate!==(isFieldDef(yDef)&&!!yDef.aggregate))return xAggregate?x:y;{var _xDef$scale,_yDef$scale;const xScale=null===(_xDef$scale=xDef.scale)||void 0===_xDef$scale?void 0:_xDef$scale.type,yScale=null===(_yDef$scale=yDef.scale)||void 0===_yDef$scale?void 0:_yDef$scale.type;if(xScale&&"linear"!==xScale)return y;if(yScale&&"linear"!==yScale)return x}}else{if("quantitative"===channelDefType(xDef))return x;if("quantitative"===channelDefType(yDef))return y}else{if("quantitative"===channelDefType(xDef))return x;if("quantitative"===channelDefType(yDef))return y}}function stack(m,encoding,opt={}){var _stackedFieldDef$scal,_stackedFieldDef$scal2;const mark=isMarkDef(m)?m.type:m;if(!STACKABLE_MARKS.has(mark))return null;const fieldChannel=potentialStackedChannel(encoding,"x")||potentialStackedChannel(encoding,"theta");if(!fieldChannel)return null;const stackedFieldDef=encoding[fieldChannel],stackedField=isFieldDef(stackedFieldDef)?vgField(stackedFieldDef,{}):void 0;let dimensionChannel=function(channel){switch(channel){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(fieldChannel),dimensionDef=encoding[dimensionChannel],dimensionField=isFieldDef(dimensionDef)?vgField(dimensionDef,{}):void 0;dimensionField===stackedField&&(dimensionField=void 0,dimensionDef=void 0,dimensionChannel=void 0);const stackBy=NONPOSITION_CHANNELS.reduce((sc,channel)=>{if("tooltip"!==channel&&channelHasField(encoding,channel)){const channelDef=encoding[channel];for(const cDef of vegaUtil.array(channelDef)){const fieldDef=getFieldDef(cDef);if(fieldDef.aggregate)continue;const f=vgField(fieldDef,{});f&&f===dimensionField||sc.push({channel:channel,fieldDef:fieldDef})}}return sc},[]);let offset;if(void 0!==stackedFieldDef.stack?offset=vegaUtil.isBoolean(stackedFieldDef.stack)?stackedFieldDef.stack?"zero":null:stackedFieldDef.stack:STACK_BY_DEFAULT_MARKS.has(mark)&&(offset="zero"),!offset||!(offset in STACK_OFFSET_INDEX))return null;var channel,aggregate;if(isAggregate(encoding)&&0===stackBy.length)return null;if(null!=stackedFieldDef&&null!==(_stackedFieldDef$scal=stackedFieldDef.scale)&&void 0!==_stackedFieldDef$scal&&_stackedFieldDef$scal.type&&(null==stackedFieldDef||null===(_stackedFieldDef$scal2=stackedFieldDef.scale)||void 0===_stackedFieldDef$scal2?void 0:_stackedFieldDef$scal2.type)!==ScaleType_LINEAR){if(opt.disallowNonLinearStack)return null;warn(function(scaleType){return"Cannot stack non-linear scale (".concat(scaleType,").")}(stackedFieldDef.scale.type))}return isFieldOrDatumDef(encoding[getSecondaryRangeChannel(fieldChannel)])?(void 0!==stackedFieldDef.stack&&warn('Cannot stack "'.concat(channel=fieldChannel,'" if there is already "').concat(channel,'2".')),null):(isFieldDef(stackedFieldDef)&&stackedFieldDef.aggregate&&!contains(SUM_OPS,stackedFieldDef.aggregate)&&warn((aggregate=stackedFieldDef.aggregate,'Stacking is applied even though the aggregate function is non-summative ("'.concat(aggregate,'").'))),{groupbyChannel:dimensionDef?dimensionChannel:void 0,groupbyField:dimensionField,fieldChannel:fieldChannel,impute:null!==stackedFieldDef.impute&&isPathMark(mark),stackBy:stackBy,offset:offset})}function dropLineAndPoint(markDef){const{point:_point,line:_line,...mark}=markDef;return keys(mark).length>1?mark:mark.type}function dropLineAndPointFromConfig(config){for(const mark of["line","area","rule","trail"])config[mark]&&(config={...config,[mark]:omit(config[mark],["point","line"])});return config}function getPointOverlay(markDef,markConfig={},encoding){return"transparent"===markDef.point?{opacity:0}:markDef.point?vegaUtil.isObject(markDef.point)?markDef.point:{}:void 0!==markDef.point?null:markConfig.point||encoding.shape?vegaUtil.isObject(markConfig.point)?markConfig.point:{}:void 0}function getLineOverlay(markDef,markConfig={}){return markDef.line?!0===markDef.line?{}:markDef.line:void 0!==markDef.line?null:markConfig.line?!0===markConfig.line?{}:markConfig.line:void 0}class PathOverlayNormalizer{constructor(){_defineProperty(this,"name","path-overlay")}hasMatchingType(spec,config){if(isUnitSpec(spec)){const{mark:mark,encoding:encoding}=spec,markDef=isMarkDef(mark)?mark:{type:mark};switch(markDef.type){case"line":case"rule":case"trail":return!!getPointOverlay(markDef,config[markDef.type],encoding);case"area":return!!getPointOverlay(markDef,config[markDef.type],encoding)||!!getLineOverlay(markDef,config[markDef.type])}}return!1}run(spec,normParams,normalize){const{config:config}=normParams,{params:params,projection:projection,mark:mark,encoding:e,...outerSpec}=spec,encoding=normalizeEncoding(e,config),markDef=isMarkDef(mark)?mark:{type:mark},pointOverlay=getPointOverlay(markDef,config[markDef.type],encoding),lineOverlay="area"===markDef.type&&getLineOverlay(markDef,config[markDef.type]),layer=[{...params?{params:params}:{},mark:dropLineAndPoint({..."area"===markDef.type&&void 0===markDef.opacity&&void 0===markDef.fillOpacity?{opacity:.7}:{},...markDef}),encoding:omit(encoding,["shape"])}],stackProps=stack(markDef,encoding);let overlayEncoding=encoding;if(stackProps){const{fieldChannel:stackFieldChannel,offset:offset}=stackProps;overlayEncoding={...encoding,[stackFieldChannel]:{...encoding[stackFieldChannel],...offset?{stack:offset}:{}}}}return lineOverlay&&layer.push({...projection?{projection:projection}:{},mark:{type:"line",...pick(markDef,["clip","interpolate","tension","tooltip"]),...lineOverlay},encoding:overlayEncoding}),pointOverlay&&layer.push({...projection?{projection:projection}:{},mark:{type:"point",opacity:1,filled:!0,...pick(markDef,["clip","tooltip"]),...pointOverlay},encoding:overlayEncoding}),normalize({...outerSpec,layer:layer},{...normParams,config:dropLineAndPointFromConfig(config)})}}function replaceRepeaterInFacet(facet,repeater){return repeater?isFacetMapping(facet)?replaceRepeaterInMapping(facet,repeater):replaceRepeaterInFieldDef(facet,repeater):facet}function replaceRepeaterInEncoding(encoding,repeater){return repeater?replaceRepeaterInMapping(encoding,repeater):encoding}function replaceRepeatInProp(prop,o,repeater){const val=o[prop];return(field=val)&&!vegaUtil.isString(field)&&"repeat"in field?val.repeat in repeater?{...o,[prop]:repeater[val.repeat]}:void warn(function(field){return'Unknown repeated value "'.concat(field,'".')}(val.repeat)):o;var field}function replaceRepeaterInFieldDef(fieldDef,repeater){if(void 0!==(fieldDef=replaceRepeatInProp("field",fieldDef,repeater))){if(null===fieldDef)return null;if(isSortableFieldDef(fieldDef)&&isSortField(fieldDef.sort)){const sort=replaceRepeatInProp("field",fieldDef.sort,repeater);fieldDef={...fieldDef,...sort?{sort:sort}:{}}}return fieldDef}}function replaceRepeaterInFieldOrDatumDef(def,repeater){if(isFieldDef(def))return replaceRepeaterInFieldDef(def,repeater);{const datumDef=replaceRepeatInProp("datum",def,repeater);return datumDef===def||datumDef.type||(datumDef.type="nominal"),datumDef}}function replaceRepeaterInChannelDef(channelDef,repeater){if(!isFieldOrDatumDef(channelDef)){if(hasConditionalFieldOrDatumDef(channelDef)){const fd=replaceRepeaterInFieldOrDatumDef(channelDef.condition,repeater);if(fd)return{...channelDef,condition:fd};{const{condition:condition,...channelDefWithoutCondition}=channelDef;return channelDefWithoutCondition}}return channelDef}{const fd=replaceRepeaterInFieldOrDatumDef(channelDef,repeater);if(fd)return fd;if(isConditionalDef(channelDef))return{condition:channelDef.condition}}}function replaceRepeaterInMapping(mapping,repeater){const out={};for(const channel in mapping)if(vegaUtil.hasOwnProperty(mapping,channel)){const channelDef=mapping[channel];if(vegaUtil.isArray(channelDef))out[channel]=channelDef.map(cd=>replaceRepeaterInChannelDef(cd,repeater)).filter(cd=>cd);else{const cd=replaceRepeaterInChannelDef(channelDef,repeater);void 0!==cd&&(out[channel]=cd)}}return out}class RuleForRangedLineNormalizer{constructor(){_defineProperty(this,"name","RuleForRangedLine")}hasMatchingType(spec){if(isUnitSpec(spec)){const{encoding:encoding,mark:mark}=spec;if("line"===mark||isMarkDef(mark)&&"line"===mark.type)for(const channel of SECONDARY_RANGE_CHANNEL){const mainChannelDef=encoding[getMainRangeChannel(channel)];if(encoding[channel]&&(isFieldDef(mainChannelDef)&&!isBinned(mainChannelDef.bin)||isDatumDef(mainChannelDef)))return!0}}return!1}run(spec,params,normalize){const{encoding:encoding,mark:mark}=spec;var hasX2,hasY2;return warn((hasX2=!!encoding.x2,hasY2=!!encoding.y2,"Line mark is for continuous lines and thus cannot be used with ".concat(hasX2&&hasY2?"x2 and y2":hasX2?"x2":"y2",". We will use the rule mark (line segments) instead."))),console.log(mark),normalize({...spec,mark:vegaUtil.isObject(mark)?{...mark,type:"rule"}:"rule"},params)}}function mergeEncoding({parentEncoding:parentEncoding,encoding:encoding={},layer:layer}){let merged={};if(parentEncoding){const channels=new Set([...keys(parentEncoding),...keys(encoding)]);for(const channel of channels){const channelDef=encoding[channel],parentChannelDef=parentEncoding[channel];if(isFieldOrDatumDef(channelDef)){const mergedChannelDef={...parentChannelDef,...channelDef};merged[channel]=mergedChannelDef}else hasConditionalFieldOrDatumDef(channelDef)?merged[channel]={...channelDef,condition:{...parentChannelDef,...channelDef.condition}}:channelDef||null===channelDef?merged[channel]=channelDef:(layer||isValueDef(parentChannelDef)||isSignalRef(parentChannelDef)||isFieldOrDatumDef(parentChannelDef)||vegaUtil.isArray(parentChannelDef))&&(merged[channel]=parentChannelDef)}}else merged=encoding;return!merged||isEmpty(merged)?void 0:merged}function mergeProjection(opt){const{parentProjection:parentProjection,projection:projection}=opt;return parentProjection&&projection&&warn(function(opt){const{parentProjection:parentProjection,projection:projection}=opt;return"Layer's shared projection ".concat(stringify(parentProjection)," is overridden by a child projection ").concat(stringify(projection),".")}({parentProjection:parentProjection,projection:projection})),null!=projection?projection:parentProjection}function isFilter(t){return"filter"in t}function isLookup(t){return"lookup"in t}function isPivot(t){return"pivot"in t}function isDensity(t){return"density"in t}function isQuantile(t){return"quantile"in t}function isRegression(t){return"regression"in t}function isLoess(t){return"loess"in t}function isSample(t){return"sample"in t}function isWindow(t){return"window"in t}function isJoinAggregate(t){return"joinaggregate"in t}function isFlatten(t){return"flatten"in t}function isCalculate(t){return"calculate"in t}function isBin(t){return"bin"in t}function isImpute(t){return"impute"in t}function isTimeUnit(t){return"timeUnit"in t}function isAggregate$1(t){return"aggregate"in t}function isStack(t){return"stack"in t}function isFold(t){return"fold"in t}function normalizeTransforms(spec,normParams){const{transform:tx,...rest}=spec;return tx?{...rest,transform:tx.map(t=>{if(isFilter(t))return{filter:normalizePredicate$1(t,normParams)};if(isBin(t)&&isBinParams(t.bin))return{...t,bin:normalizeBinExtent(t.bin)};if(isLookup(t)){const{selection:param,...from}=t.from;return param?{...t,from:{param:param,...from}}:t}return t})}:spec}function normalizeChannelDef(obj,normParams){var _enc$scale,_enc$scale$domain;const enc=duplicate(obj);if(isFieldDef(enc)&&isBinParams(enc.bin)&&(enc.bin=normalizeBinExtent(enc.bin)),isScaleFieldDef(enc)&&null!==(_enc$scale=enc.scale)&&void 0!==_enc$scale&&null!==(_enc$scale$domain=_enc$scale.domain)&&void 0!==_enc$scale$domain&&_enc$scale$domain.selection){const{selection:param,...domain}=enc.scale.domain;enc.scale.domain={...domain,...param?{param:param}:{}}}if(isConditionalDef(enc))if(vega.isArray(enc.condition))enc.condition=enc.condition.map(c=>{const{selection:selection,param:param,test:test,...cond}=c;return param?c:{...cond,test:normalizePredicate$1(c,normParams)}});else{const{selection:selection,param:param,test:test,...cond}=normalizeChannelDef(enc.condition,normParams);enc.condition=param?enc.condition:{...cond,test:normalizePredicate$1(enc.condition,normParams)}}return enc}function normalizeBinExtent(bin){const ext=bin.extent;if(null!=ext&&ext.selection){const{selection:param,...rest}=ext;return{...bin,extent:{...rest,param:param}}}return bin}function normalizePredicate$1(op,normParams){const normalizeSelectionComposition=o=>normalizeLogicalComposition(o,param=>{var _normParams$emptySele2,_normParams$selection3,_normParams$selection4;const pred={param:param,empty:null===(_normParams$emptySele2=normParams.emptySelections[param])||void 0===_normParams$emptySele2||_normParams$emptySele2};return null!==(_normParams$selection4=(_normParams$selection3=normParams.selectionPredicates)[param])&&void 0!==_normParams$selection4||(_normParams$selection3[param]=[]),normParams.selectionPredicates[param].push(pred),pred});return op.selection?normalizeSelectionComposition(op.selection):normalizeLogicalComposition(op.test||op.filter,o=>o.selection?normalizeSelectionComposition(o.selection):o)}class TopLevelSelectionsNormalizer extends SpecMapper{map(spec,normParams){var _normParams$selection;const selections=null!==(_normParams$selection=normParams.selections)&&void 0!==_normParams$selection?_normParams$selection:[];if(spec.params&&!isUnitSpec(spec)){const params=[];for(const param of spec.params)isSelectionParameter(param)?selections.push(param):params.push(param);spec.params=params}return normParams.selections=selections,super.map(spec,addSpecNameToParams(spec,normParams))}mapUnit(spec,normParams){var _normParams$path;const selections=normParams.selections;if(!selections||!selections.length)return spec;const path=(null!==(_normParams$path=normParams.path)&&void 0!==_normParams$path?_normParams$path:[]).concat(spec.name),params=[];for(const selection of selections)if(selection.views&&selection.views.length)for(const view of selection.views)(vega.isString(view)&&(view===spec.name||path.indexOf(view)>=0)||vega.isArray(view)&&view.map(v=>path.indexOf(v)).every((v,i,arr)=>-1!==v&&(0===i||v>arr[i-1])))&&params.push(selection);else params.push(selection);return params.length&&(spec.params=params),spec}}for(const method of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const proto=TopLevelSelectionsNormalizer.prototype[method];TopLevelSelectionsNormalizer.prototype[method]=function(spec,params){return proto.call(this,spec,addSpecNameToParams(spec,params))}}function addSpecNameToParams(spec,params){var _params$path;return spec.name?{...params,path:(null!==(_params$path=params.path)&&void 0!==_params$path?_params$path:[]).concat(spec.name)}:params}function normalize(spec,config){void 0===config&&(config=initConfig(spec.config));const normalizedSpec=function(spec,config={}){const normParams={config:config};return topLevelSelectionNormalizer.map(coreNormalizer.map(selectionCompatNormalizer.map(spec,normParams),normParams),normParams)}(spec,config),{width:width,height:height}=spec,autosize=function(spec,sizeInfo,config){let{width:width,height:height}=sizeInfo;const isFitCompatible=isUnitSpec(spec)||isLayerSpec(spec),autosizeDefault={};isFitCompatible?"container"==width&&"container"==height?(autosizeDefault.type="fit",autosizeDefault.contains="padding"):"container"==width?(autosizeDefault.type="fit-x",autosizeDefault.contains="padding"):"container"==height&&(autosizeDefault.type="fit-y",autosizeDefault.contains="padding"):("container"==width&&(warn(containerSizeNonSingle("width")),width=void 0),"container"==height&&(warn(containerSizeNonSingle("height")),height=void 0));const autosize={type:"pad",...autosizeDefault,...config?_normalizeAutoSize(config.autosize):{},..._normalizeAutoSize(spec.autosize)};if("fit"!==autosize.type||isFitCompatible||(warn('Autosize "fit" only works for single views and layered views.'),autosize.type="pad"),"container"==width&&"fit"!=autosize.type&&"fit-x"!=autosize.type&&warn(containerSizeNotCompatibleWithAutosize("width")),"container"==height&&"fit"!=autosize.type&&"fit-y"!=autosize.type&&warn(containerSizeNotCompatibleWithAutosize("height")),!deepEqual(autosize,{type:"pad"}))return autosize}(normalizedSpec,{width:width,height:height,autosize:spec.autosize},config);return{...normalizedSpec,...autosize?{autosize:autosize}:{}}}const coreNormalizer=new class extends SpecMapper{constructor(...args){super(...args),_defineProperty(this,"nonFacetUnitNormalizers",[boxPlotNormalizer,errorBarNormalizer,errorBandNormalizer,new PathOverlayNormalizer,new RuleForRangedLineNormalizer])}map(spec,params){if(isUnitSpec(spec)){const hasRow=channelHasField(spec.encoding,ROW),hasColumn=channelHasField(spec.encoding,COLUMN),hasFacet=channelHasField(spec.encoding,"facet");if(hasRow||hasColumn||hasFacet)return this.mapFacetedUnit(spec,params)}return super.map(spec,params)}mapUnit(spec,params){const{parentEncoding:parentEncoding,parentProjection:parentProjection}=params,encoding=replaceRepeaterInEncoding(spec.encoding,params.repeater),specWithReplacedEncoding={...spec,...encoding?{encoding:encoding}:{}};if(parentEncoding||parentProjection)return this.mapUnitWithParentEncodingOrProjection(specWithReplacedEncoding,params);const normalizeLayerOrUnit=this.mapLayerOrUnit.bind(this);for(const unitNormalizer of this.nonFacetUnitNormalizers)if(unitNormalizer.hasMatchingType(specWithReplacedEncoding,params.config))return unitNormalizer.run(specWithReplacedEncoding,params,normalizeLayerOrUnit);return specWithReplacedEncoding}mapRepeat(spec,params){return function(spec){return!vegaUtil.isArray(spec.repeat)&&spec.repeat.layer}(spec)?this.mapLayerRepeat(spec,params):this.mapNonLayerRepeat(spec,params)}mapLayerRepeat(spec,params){const{repeat:repeat,spec:childSpec,...rest}=spec,{row:row,column:column,layer:layer}=repeat,{repeater:repeater={},repeaterPrefix:repeaterPrefix=""}=params;return row||column?this.mapRepeat({...spec,repeat:{...row?{row:row}:{},...column?{column:column}:{}},spec:{repeat:{layer:layer},spec:childSpec}},params):{...rest,layer:layer.map(layerValue=>{const childRepeater={...repeater,layer:layerValue},childName="".concat((childSpec.name||"")+repeaterPrefix,"child__layer_").concat(varName(layerValue)),child=this.mapLayerOrUnit(childSpec,{...params,repeater:childRepeater,repeaterPrefix:childName});return child.name=childName,child})}}mapNonLayerRepeat(spec,params){var _childSpec$data;const{repeat:repeat,spec:childSpec,data:data,...remainingProperties}=spec;!vegaUtil.isArray(repeat)&&spec.columns&&(spec=omit(spec,["columns"]),warn(columnsNotSupportByRowCol("repeat")));const concat=[],{repeater:repeater={},repeaterPrefix:repeaterPrefix=""}=params,row=!vegaUtil.isArray(repeat)&&repeat.row||[repeater?repeater.row:null],column=!vegaUtil.isArray(repeat)&&repeat.column||[repeater?repeater.column:null],repeatValues=vegaUtil.isArray(repeat)&&repeat||[repeater?repeater.repeat:null];for(const repeatValue of repeatValues)for(const rowValue of row)for(const columnValue of column){const childRepeater={repeat:repeatValue,row:rowValue,column:columnValue,layer:repeater.layer},childName=(childSpec.name||"")+repeaterPrefix+"child__"+(vegaUtil.isArray(repeat)?"".concat(varName(repeatValue)):(repeat.row?"row_".concat(varName(rowValue)):"")+(repeat.column?"column_".concat(varName(columnValue)):"")),child=this.map(childSpec,{...params,repeater:childRepeater,repeaterPrefix:childName});child.name=childName,concat.push(omit(child,["data"]))}const columns=vegaUtil.isArray(repeat)?spec.columns:repeat.column?repeat.column.length:1;return{data:null!==(_childSpec$data=childSpec.data)&&void 0!==_childSpec$data?_childSpec$data:data,align:"all",...remainingProperties,columns:columns,concat:concat}}mapFacet(spec,params){const{facet:facet}=spec;return isFacetMapping(facet)&&spec.columns&&(spec=omit(spec,["columns"]),warn(columnsNotSupportByRowCol("facet"))),super.mapFacet(spec,params)}mapUnitWithParentEncodingOrProjection(spec,params){const{encoding:encoding,projection:projection}=spec,{parentEncoding:parentEncoding,parentProjection:parentProjection,config:config}=params,mergedProjection=mergeProjection({parentProjection:parentProjection,projection:projection}),mergedEncoding=mergeEncoding({parentEncoding:parentEncoding,encoding:replaceRepeaterInEncoding(encoding,params.repeater)});return this.mapUnit({...spec,...mergedProjection?{projection:mergedProjection}:{},...mergedEncoding?{encoding:mergedEncoding}:{}},{config:config})}mapFacetedUnit(spec,normParams){const{row:row,column:column,facet:facet,...encoding}=spec.encoding,{mark:mark,width:width,projection:projection,height:height,view:view,params:params,encoding:_,...outerSpec}=spec,{facetMapping:facetMapping,layout:layout}=this.getFacetMappingAndLayout({row:row,column:column,facet:facet},normParams),newEncoding=replaceRepeaterInEncoding(encoding,normParams.repeater);return this.mapFacet({...outerSpec,...layout,facet:facetMapping,spec:{...width?{width:width}:{},...height?{height:height}:{},...view?{view:view}:{},...projection?{projection:projection}:{},mark:mark,encoding:newEncoding,...params?{params:params}:{}}},normParams)}getFacetMappingAndLayout(facets,params){const{row:row,column:column,facet:facet}=facets;if(row||column){facet&&warn((channels=[...row?[ROW]:[],...column?[COLUMN]:[]],"Facet encoding dropped as ".concat(channels.join(" and ")," ").concat(channels.length>1?"are":"is"," also specified.")));const facetMapping={},layout={};for(const channel of[ROW,COLUMN]){const def=facets[channel];if(def){const{align:align,center:center,spacing:spacing,columns:columns,...defWithoutLayout}=def;facetMapping[channel]=defWithoutLayout;for(const prop of["align","center","spacing"]){var _layout$prop;void 0!==def[prop]&&(null!==(_layout$prop=layout[prop])&&void 0!==_layout$prop||(layout[prop]={}),layout[prop][channel]=def[prop])}}}return{facetMapping:facetMapping,layout:layout}}{const{align:align,center:center,spacing:spacing,columns:columns,...facetMapping}=facet;return{facetMapping:replaceRepeaterInFacet(facetMapping,params.repeater),layout:{...align?{align:align}:{},...center?{center:center}:{},...spacing?{spacing:spacing}:{},...columns?{columns:columns}:{}}}}var channels}mapLayer(spec,{parentEncoding:parentEncoding,parentProjection:parentProjection,...otherParams}){const{encoding:encoding,projection:projection,...rest}=spec,params={...otherParams,parentEncoding:mergeEncoding({parentEncoding:parentEncoding,encoding:encoding,layer:!0}),parentProjection:mergeProjection({parentProjection:parentProjection,projection:projection})};return super.mapLayer(rest,params)}},selectionCompatNormalizer=new class extends SpecMapper{map(spec,normParams){var _normParams$emptySele,_normParams$selection;return null!==(_normParams$emptySele=normParams.emptySelections)&&void 0!==_normParams$emptySele||(normParams.emptySelections={}),null!==(_normParams$selection=normParams.selectionPredicates)&&void 0!==_normParams$selection||(normParams.selectionPredicates={}),spec=normalizeTransforms(spec,normParams),super.map(spec,normParams)}mapLayerOrUnit(spec,normParams){if((spec=normalizeTransforms(spec,normParams)).encoding){const encoding={};for(const[channel,enc]of entries(spec.encoding))encoding[channel]=normalizeChannelDef(enc,normParams);spec={...spec,encoding:encoding}}return super.mapLayerOrUnit(spec,normParams)}mapUnit(spec,normParams){const{selection:selection,...rest}=spec;return selection?{...rest,params:entries(selection).map(([name,selDef])=>{const{init:value,bind:bind,empty:empty,...select}=selDef;"single"===select.type?(select.type="point",select.toggle=!1):"multi"===select.type&&(select.type="point"),normParams.emptySelections[name]="none"!==empty;for(const pred of vals(null!==(_normParams$selection2=normParams.selectionPredicates[name])&&void 0!==_normParams$selection2?_normParams$selection2:{})){var _normParams$selection2;pred.empty="none"!==empty}return{name:name,value:value,select:select,bind:bind}})}:spec}},topLevelSelectionNormalizer=new TopLevelSelectionsNormalizer;function _normalizeAutoSize(autosize){return vegaUtil.isString(autosize)?{type:autosize}:null!=autosize?autosize:{}}class Split{constructor(explicit={},implicit={}){this.explicit=explicit,this.implicit=implicit}clone(){return new Split(duplicate(this.explicit),duplicate(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(key){return getFirstDefined(this.explicit[key],this.implicit[key])}getWithExplicit(key){return void 0!==this.explicit[key]?{explicit:!0,value:this.explicit[key]}:void 0!==this.implicit[key]?{explicit:!1,value:this.implicit[key]}:{explicit:!1,value:void 0}}setWithExplicit(key,{value:value,explicit:explicit}){void 0!==value&&this.set(key,value,explicit)}set(key,value,explicit){return delete this[explicit?"implicit":"explicit"][key],this[explicit?"explicit":"implicit"][key]=value,this}copyKeyFromSplit(key,{explicit:explicit,implicit:implicit}){void 0!==explicit[key]?this.set(key,explicit[key],!0):void 0!==implicit[key]&&this.set(key,implicit[key],!1)}copyKeyFromObject(key,s){void 0!==s[key]&&this.set(key,s[key],!0)}copyAll(other){for(const key of keys(other.combine())){const val=other.getWithExplicit(key);this.setWithExplicit(key,val)}}}function makeExplicit(value){return{explicit:!0,value:value}}function makeImplicit(value){return{explicit:!1,value:value}}function tieBreakByComparing(compare){return(v1,v2,property,propertyOf)=>{const diff=compare(v1.value,v2.value);return diff>0?v1:diff<0?v2:defaultTieBreaker(v1,v2,property,propertyOf)}}function defaultTieBreaker(v1,v2,property,propertyOf){return v1.explicit&&v2.explicit&&warn(function(property,propertyOf,v1,v2){return"Conflicting ".concat(propertyOf.toString(),' property "').concat(property.toString(),'" (').concat(stringify(v1)," and ").concat(stringify(v2),"). Using ").concat(stringify(v1),".")}(property,propertyOf,v1.value,v2.value)),v1}function mergeValuesWithExplicit(v1,v2,property,propertyOf,tieBreaker=defaultTieBreaker){return void 0===v1||void 0===v1.value?v2:v1.explicit&&!v2.explicit?v1:v2.explicit&&!v1.explicit?v2:deepEqual(v1.value,v2.value)?v1:tieBreaker(v1,v2,property,propertyOf)}class AncestorParse extends Split{constructor(explicit={},implicit={},parseNothing=!1){super(explicit,implicit),this.explicit=explicit,this.implicit=implicit,this.parseNothing=parseNothing}clone(){const clone=super.clone();return clone.parseNothing=this.parseNothing,clone}}function isUrlData(data){return"url"in data}function isInlineData(data){return"values"in data}function isNamedData(data){return"name"in data&&!isUrlData(data)&&!isInlineData(data)&&!isGenerator(data)}function isGenerator(data){return data&&(isSequenceGenerator(data)||isSphereGenerator(data)||isGraticuleGenerator(data))}function isSequenceGenerator(data){return"sequence"in data}function isSphereGenerator(data){return"sphere"in data}function isGraticuleGenerator(data){return"graticule"in data}let DataSourceType;!function(DataSourceType){DataSourceType[DataSourceType.Raw=0]="Raw",DataSourceType[DataSourceType.Main=1]="Main",DataSourceType[DataSourceType.Row=2]="Row",DataSourceType[DataSourceType.Column=3]="Column",DataSourceType[DataSourceType.Lookup=4]="Lookup"}(DataSourceType||(DataSourceType={}));const ILLEGAL=/[[\]{}]/,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let DEFAULT_SOURCE,MARKS;function eventSelector(selector,source,marks){return DEFAULT_SOURCE=source||"view",MARKS=marks||DEFAULT_MARKS,parseMerge(selector.trim()).map(parseSelector)}function find(s,i,endChar,pushChar,popChar){const n=s.length;let c,count=0;for(;i<n;++i){if(c=s[i],!count&&c===endChar)return i;popChar&&popChar.indexOf(c)>=0?--count:pushChar&&pushChar.indexOf(c)>=0&&++count}return i}function parseMerge(s){const output=[],n=s.length;let start=0,i=0;for(;i<n;)i=find(s,i,",","[{","]}"),output.push(s.substring(start,i).trim()),start=++i;if(0===output.length)throw"Empty event selector: "+s;return output}function parseSelector(s){return"["===s[0]?function(s){const n=s.length;let b,i=1;if(i=find(s,i,"]","[","]"),i===n)throw"Empty between selector: "+s;if(b=parseMerge(s.substring(1,i)),2!==b.length)throw"Between selector must have two elements: "+s;if(">"!==(s=s.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+s;b=b.map(parseSelector);const stream=parseSelector(s.slice(1).trim());return stream.between?{between:b,stream:stream}:(stream.between=b,stream)}(s):function(s){const stream={source:DEFAULT_SOURCE},source=[];let j,filter,throttle=[0,0],markname=0,start=0,n=s.length,i=0;if("}"===s[n-1]){if(i=s.lastIndexOf("{"),!(i>=0))throw"Unmatched right brace: "+s;try{throttle=function(s){const a=s.split(",");if(!s.length||a.length>2)throw s;return a.map(_=>{const x=+_;if(x!=x)throw s;return x})}(s.substring(i+1,n-1))}catch(e){throw"Invalid throttle specification: "+s}s=s.slice(0,i).trim(),n=s.length,i=0}if(!n)throw s;if("@"===s[0]&&(markname=++i),j=find(s,i,":"),j<n&&(source.push(s.substring(start,j).trim()),start=i=++j),i=find(s,i,"["),i===n)source.push(s.substring(start,n).trim());else if(source.push(s.substring(start,i).trim()),filter=[],start=++i,start===n)throw"Unmatched left bracket: "+s;for(;i<n;){if(i=find(s,i,"]"),i===n)throw"Unmatched left bracket: "+s;if(filter.push(s.substring(start,i).trim()),i<n-1&&"["!==s[++i])throw"Expected left bracket: "+s;start=++i}if(!(n=source.length)||ILLEGAL.test(source[n-1]))throw"Invalid event selector: "+s;return n>1?(stream.type=source[1],markname?stream.markname=source[0].slice(1):function(type){return MARKS[type]}(source[0])?stream.marktype=source[0]:stream.source=source[0]):stream.type=source[0],"!"===stream.type.slice(-1)&&(stream.consume=!0,stream.type=stream.type.slice(0,-1)),null!=filter&&(stream.filter=filter),throttle[0]&&(stream.throttle=throttle[0]),throttle[1]&&(stream.debounce=throttle[1]),stream}(s)}function assembleInit(init,isExpr=!0,wrap=vegaUtil.identity){if(vegaUtil.isArray(init)){const assembled=init.map(v=>assembleInit(v,isExpr,wrap));return isExpr?"[".concat(assembled.join(", "),"]"):assembled}return isDateTime(init)?wrap(isExpr?dateTimeToExpr(init):function(d){const parts=dateTimeParts(d,!0);return d.utc?+new Date(Date.UTC(...parts)):+new Date(...parts)}(init)):isExpr?wrap(stringify(init)):init}function assembleUnitSelectionSignals(model,signals){for(const selCmpt of vals(null!==(_model$component$sele=model.component.selection)&&void 0!==_model$component$sele?_model$component$sele:{})){var _model$component$sele;const name=selCmpt.name;let modifyExpr="".concat(name).concat(TUPLE,", ")+("global"===selCmpt.resolve?"true":"{unit: ".concat(unitName(model),"}"));for(const c of selectionCompilers)c.defined(selCmpt)&&(c.signals&&(signals=c.signals(model,selCmpt,signals)),c.modifyExpr&&(modifyExpr=c.modifyExpr(model,selCmpt,modifyExpr)));signals.push({name:name+MODIFY,on:[{events:{signal:selCmpt.name+TUPLE},update:"modify(".concat(vegaUtil.stringValue(selCmpt.name+STORE),", ").concat(modifyExpr,")")}]})}return cleanupEmptyOnArray(signals)}function assembleFacetSignals(model,signals){if(model.component.selection&&keys(model.component.selection).length){const name=vegaUtil.stringValue(model.getName("cell"));signals.unshift({name:"facet",value:{},on:[{events:eventSelector("mousemove","scope"),update:"isTuple(facet) ? facet : group(".concat(name,").datum")}]})}return cleanupEmptyOnArray(signals)}function assembleUnitSelectionMarks(model,marks){for(const selCmpt of vals(null!==(_model$component$sele4=model.component.selection)&&void 0!==_model$component$sele4?_model$component$sele4:{})){var _model$component$sele4;for(const c of selectionCompilers)c.defined(selCmpt)&&c.marks&&(marks=c.marks(model,selCmpt,marks))}return marks}function cleanupEmptyOnArray(signals){return signals.map(s=>(s.on&&!s.on.length&&delete s.on,s))}class DataFlowNode{constructor(parent,debugName){this.debugName=debugName,_defineProperty(this,"_children",[]),_defineProperty(this,"_parent",null),_defineProperty(this,"_hash",void 0),parent&&(this.parent=parent)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(parent){this._parent=parent,parent&&parent.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(child,loc){this._children.includes(child)?warn("Attempt to add the same child twice."):void 0!==loc?this._children.splice(loc,0,child):this._children.push(child)}removeChild(oldChild){const loc=this._children.indexOf(oldChild);return this._children.splice(loc,1),loc}remove(){let loc=this._parent.removeChild(this);for(const child of this._children)child._parent=this._parent,this._parent.addChild(child,loc++)}insertAsParentOf(other){const parent=other.parent;parent.removeChild(this),this.parent=parent,other.parent=this}swapWithParent(){const parent=this._parent,newParent=parent.parent;for(const child of this._children)child.parent=parent;this._children=[],parent.removeChild(this),parent.parent.removeChild(parent),this.parent=newParent,parent.parent=this}}class OutputNode extends DataFlowNode{clone(){const cloneObj=new this.constructor;return cloneObj.debugName="clone_".concat(this.debugName),cloneObj._source=this._source,cloneObj._name="clone_".concat(this._name),cloneObj.type=this.type,cloneObj.refCounts=this.refCounts,cloneObj.refCounts[cloneObj._name]=0,cloneObj}constructor(parent,source,type,refCounts){super(parent,source),this.type=type,this.refCounts=refCounts,_defineProperty(this,"_source",void 0),_defineProperty(this,"_name",void 0),this._source=this._name=source,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output ".concat(uniqueId())),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(source){this._source=source}}class TimeUnitNode extends DataFlowNode{clone(){return new TimeUnitNode(null,duplicate(this.formula))}constructor(parent,formula){super(parent),this.formula=formula}static makeFromEncoding(parent,model){const formula=model.reduceFieldDef((timeUnitComponent,fieldDef)=>{const{field:field,timeUnit:timeUnit}=fieldDef;if(timeUnit){const as=vgField(fieldDef,{forAs:!0});timeUnitComponent[hash({as:as,field:field,timeUnit:timeUnit})]={as:as,field:field,timeUnit:timeUnit}}return timeUnitComponent},{});return isEmpty(formula)?null:new TimeUnitNode(parent,formula)}static makeFromTransform(parent,t){const{timeUnit:timeUnit,...other}={...t},component={...other,timeUnit:normalizeTimeUnit(timeUnit)};return new TimeUnitNode(parent,{[hash(component)]:component})}merge(other){this.formula={...this.formula};for(const key in other.formula)this.formula[key]||(this.formula[key]=other.formula[key]);for(const child of other.children)other.removeChild(child),child.parent=this;other.remove()}removeFormulas(fields){const newFormula={};for(const[key,timeUnit]of entries(this.formula))fields.has(timeUnit.as)||(newFormula[key]=timeUnit);this.formula=newFormula}producedFields(){return new Set(vals(this.formula).map(f=>f.as))}dependentFields(){return new Set(vals(this.formula).map(f=>f.field))}hash(){return"TimeUnit ".concat(hash(this.formula))}assemble(){const transforms=[];for(const f of vals(this.formula)){const{field:field,as:as,timeUnit:timeUnit}=f,{unit:unit,utc:utc,...params}=normalizeTimeUnit(timeUnit);transforms.push({field:replacePathInField(field),type:"timeunit",...unit?{units:getTimeUnitParts(unit)}:{},...utc?{timezone:"utc"}:{},...params,as:[as,"".concat(as,"_end")]})}return transforms}}class SelectionProjectionComponent{constructor(...items){_defineProperty(this,"hasChannel",void 0),_defineProperty(this,"hasField",void 0),_defineProperty(this,"timeUnit",void 0),_defineProperty(this,"items",void 0),this.items=items,this.hasChannel={},this.hasField={}}}const project={defined:()=>!0,parse:(model,selCmpt,selDef)=>{var _selCmpt$project;const name=selCmpt.name,proj=null!==(_selCmpt$project=selCmpt.project)&&void 0!==_selCmpt$project?_selCmpt$project:selCmpt.project=new SelectionProjectionComponent,parsed={},timeUnits={},signals=new Set,signalName=(p,range)=>{const suffix="visual"===range?p.channel:p.field;let sg=varName("".concat(name,"_").concat(suffix));for(let counter=1;signals.has(sg);counter++)sg=varName("".concat(name,"_").concat(suffix,"_").concat(counter));return signals.add(sg),{[range]:sg}},type=selCmpt.type,cfg=model.config.selection[type],init=void 0!==selDef.value?vegaUtil.array(selDef.value):null;let{fields:fields,encodings:encodings}=vegaUtil.isObject(selDef.select)?selDef.select:{};if(!fields&&!encodings&&init)for(const initVal of init)if(vegaUtil.isObject(initVal))for(const key of keys(initVal))SINGLE_DEF_UNIT_CHANNEL_INDEX[key]?(encodings||(encodings=[])).push(key):"interval"===type?(warn('Interval selections should be initialized using "x" and/or "y" keys.'),encodings=cfg.encodings):(fields||(fields=[])).push(key);fields||encodings||(encodings=cfg.encodings,fields=cfg.fields);for(const channel of null!==(_encodings=encodings)&&void 0!==_encodings?_encodings:[]){var _encodings;const fieldDef=model.fieldDef(channel);if(fieldDef){let field=fieldDef.field;if(fieldDef.aggregate){warn(cannotProjectAggregate(channel,fieldDef.aggregate));continue}if(!field){warn(cannotProjectOnChannelWithoutField(channel));continue}if(fieldDef.timeUnit){field=model.vgField(channel);const component={timeUnit:fieldDef.timeUnit,as:field,field:fieldDef.field};timeUnits[hash(component)]=component}if(!parsed[field]){let tplType="E";"interval"===type?hasContinuousDomain(model.getScaleComponent(channel).get("type"))&&(tplType="R"):fieldDef.bin&&(tplType="R-RE");const p={field:field,channel:channel,type:tplType};p.signals={...signalName(p,"data"),...signalName(p,"visual")},proj.items.push(parsed[field]=p),proj.hasField[field]=proj.hasChannel[channel]=parsed[field]}}else warn(cannotProjectOnChannelWithoutField(channel))}for(const field of null!==(_fields=fields)&&void 0!==_fields?_fields:[]){var _fields;if(proj.hasField[field])continue;const p={type:"E",field:field};p.signals={...signalName(p,"data")},proj.items.push(p),proj.hasField[field]=p}init&&(selCmpt.init=init.map(v=>proj.items.map(p=>vegaUtil.isObject(v)?void 0!==v[p.channel]?v[p.channel]:v[p.field]:v))),isEmpty(timeUnits)||(proj.timeUnit=new TimeUnitNode(null,timeUnits))},signals:(model,selCmpt,allSignals)=>{const name=selCmpt.name+"_tuple_fields";return allSignals.filter(s=>s.name===name).length>0?allSignals:allSignals.concat({name:name,value:selCmpt.project.items.map(proj=>{const{signals:signals,hasLegend:hasLegend,...rest}=proj;return rest.field=replacePathInField(rest.field),rest})})}},scaleBindings={defined:selCmpt=>"interval"===selCmpt.type&&"global"===selCmpt.resolve&&selCmpt.bind&&"scales"===selCmpt.bind,parse:(model,selCmpt)=>{const bound=selCmpt.scales=[];for(const proj of selCmpt.project.items){const channel=proj.channel;if(!isScaleChannel(channel))continue;const scale=model.getScaleComponent(channel),scaleType=scale?scale.get("type"):void 0;scale&&hasContinuousDomain(scaleType)?(scale.set("selectionExtent",{param:selCmpt.name,field:proj.field},!0),bound.push(proj)):warn("Scale bindings are currently only supported for scales with unbinned, continuous domains.")}},topLevelSignals:(model,selCmpt,signals)=>{const bound=selCmpt.scales.filter(proj=>0===signals.filter(s=>s.name===proj.signals.data).length);if(!model.parent||isTopLevelLayer(model)||0===bound.length)return signals;const namedSg=signals.filter(s=>s.name===selCmpt.name)[0];let update=namedSg.update;if(update.indexOf(VL_SELECTION_RESOLVE)>=0)namedSg.update="{".concat(bound.map(proj=>"".concat(vegaUtil.stringValue(replacePathInField(proj.field)),": ").concat(proj.signals.data)).join(", "),"}");else{for(const proj of bound){const mapping="".concat(vegaUtil.stringValue(replacePathInField(proj.field)),": ").concat(proj.signals.data);update.includes(mapping)||(update="".concat(update.substring(0,update.length-1),", ").concat(mapping,"}"))}namedSg.update=update}return signals.concat(bound.map(proj=>({name:proj.signals.data})))},signals:(model,selCmpt,signals)=>{if(model.parent&&!isTopLevelLayer(model))for(const proj of selCmpt.scales){const signal=signals.filter(s=>s.name===proj.signals.data)[0];signal.push="outer",delete signal.value,delete signal.update}return signals}};function domain$1(model,channel){const scale=vegaUtil.stringValue(model.scaleName(channel));return"domain(".concat(scale,")")}function isTopLevelLayer(model){var _model$parent$parent;return model.parent&&isLayerModel(model.parent)&&(null!==(_model$parent$parent=!model.parent.parent)&&void 0!==_model$parent$parent?_model$parent$parent:isTopLevelLayer(model.parent.parent))}const interval={defined:selCmpt=>"interval"===selCmpt.type,signals:(model,selCmpt,signals)=>{const name=selCmpt.name,fieldsSg=name+"_tuple_fields",hasScales=scaleBindings.defined(selCmpt),init=selCmpt.init?selCmpt.init[0]:null,dataSignals=[],scaleTriggers=[];if(selCmpt.translate&&!hasScales){const filterExpr="!event.item || event.item.mark.name !== ".concat(vegaUtil.stringValue(name+"_brush"));events(selCmpt,(on,evt)=>{var _evt$between$,_evt$between$$filter;const filters=vegaUtil.array(null!==(_evt$between$$filter=(_evt$between$=evt.between[0]).filter)&&void 0!==_evt$between$$filter?_evt$between$$filter:_evt$between$.filter=[]);return filters.includes(filterExpr)||filters.push(filterExpr),on})}selCmpt.project.items.forEach((proj,i)=>{const channel=proj.channel;if(channel!==X&&channel!==Y)return void warn("Interval selections only support x and y encoding channels.");const val=init?init[i]:null,cs=function(model,selCmpt,proj,init){const channel=proj.channel,vname=proj.signals.visual,dname=proj.signals.data,hasScales=scaleBindings.defined(selCmpt),scaleName=vegaUtil.stringValue(model.scaleName(channel)),scale=model.getScaleComponent(channel),scaleType=scale?scale.get("type"):void 0,scaled=str=>"scale(".concat(scaleName,", ").concat(str,")"),size=model.getSizeSignalRef(channel===X?"width":"height").signal,coord="".concat(channel,"(unit)"),on=events(selCmpt,(def,evt)=>[...def,{events:evt.between[0],update:"[".concat(coord,", ").concat(coord,"]")},{events:evt,update:"[".concat(vname,"[0], clamp(").concat(coord,", 0, ").concat(size,")]")}]);return on.push({events:{signal:selCmpt.name+"_scale_trigger"},update:hasContinuousDomain(scaleType)?"[".concat(scaled("".concat(dname,"[0]")),", ").concat(scaled("".concat(dname,"[1]")),"]"):"[0, 0]"}),hasScales?[{name:dname,on:[]}]:[{name:vname,...init?{init:assembleInit(init,!0,scaled)}:{value:[]},on:on},{name:dname,...init?{init:assembleInit(init)}:{},on:[{events:{signal:vname},update:"".concat(vname,"[0] === ").concat(vname,"[1] ? null : invert(").concat(scaleName,", ").concat(vname,")")}]}]}(model,selCmpt,proj,val),dname=proj.signals.data,vname=proj.signals.visual,scaleName=vegaUtil.stringValue(model.scaleName(channel)),toNum=hasContinuousDomain(model.getScaleComponent(channel).get("type"))?"+":"";signals.push(...cs),dataSignals.push(dname),scaleTriggers.push({scaleName:model.scaleName(channel),expr:"(!isArray(".concat(dname,") || ")+"(".concat(toNum,"invert(").concat(scaleName,", ").concat(vname,")[0] === ").concat(toNum).concat(dname,"[0] && ")+"".concat(toNum,"invert(").concat(scaleName,", ").concat(vname,")[1] === ").concat(toNum).concat(dname,"[1]))")})}),hasScales||signals.push({name:name+"_scale_trigger",value:{},on:[{events:scaleTriggers.map(t=>({scale:t.scaleName})),update:"".concat(scaleTriggers.map(t=>t.expr).join(" && ")," ? ").concat(name+"_scale_trigger"," : {}")}]});const update="unit: ".concat(unitName(model),", fields: ").concat(fieldsSg,", values");return signals.concat({name:name+TUPLE,...init?{init:"{".concat(update,": ").concat(assembleInit(init),"}")}:{},on:[{events:[{signal:dataSignals.join(" || ")}],update:"".concat(dataSignals.join(" && ")," ? {").concat(update,": [").concat(dataSignals,"]} : null")}]})},marks:(model,selCmpt,marks)=>{const name=selCmpt.name,{x:x,y:y}=selCmpt.project.hasChannel,xvname=x&&x.signals.visual,yvname=y&&y.signals.visual,store="data(".concat(vegaUtil.stringValue(selCmpt.name+STORE),")");if(scaleBindings.defined(selCmpt))return marks;const update={x:void 0!==x?{signal:"".concat(xvname,"[0]")}:{value:0},y:void 0!==y?{signal:"".concat(yvname,"[0]")}:{value:0},x2:void 0!==x?{signal:"".concat(xvname,"[1]")}:{field:{group:"width"}},y2:void 0!==y?{signal:"".concat(yvname,"[1]")}:{field:{group:"height"}}};if("global"===selCmpt.resolve)for(const key of keys(update))update[key]=[{test:"".concat(store,".length && ").concat(store,"[0].unit === ").concat(unitName(model)),...update[key]},{value:0}];const{fill:fill,fillOpacity:fillOpacity,cursor:cursor,...stroke}=selCmpt.mark,vgStroke=keys(stroke).reduce((def,k)=>(def[k]=[{test:[void 0!==x&&"".concat(xvname,"[0] !== ").concat(xvname,"[1]"),void 0!==y&&"".concat(yvname,"[0] !== ").concat(yvname,"[1]")].filter(t=>t).join(" && "),value:stroke[k]},{value:null}],def),{});return[{name:"".concat(name+"_brush","_bg"),type:"rect",clip:!0,encode:{enter:{fill:{value:fill},fillOpacity:{value:fillOpacity}},update:update}},...marks,{name:name+"_brush",type:"rect",clip:!0,encode:{enter:{...cursor?{cursor:{value:cursor}}:{},fill:{value:"transparent"}},update:{...update,...vgStroke}}}]}};function events(selCmpt,cb){return selCmpt.events.reduce((on,evt)=>evt.between?cb(on,evt):(warn("".concat(evt," is not an ordered event stream for interval selections.")),on),[])}const point={defined:selCmpt=>"point"===selCmpt.type,signals:(model,selCmpt,signals)=>{const name=selCmpt.name,fieldsSg=name+"_tuple_fields",project=selCmpt.project,datum="(item().isVoronoi ? datum.datum : datum)",values=project.items.map(p=>{const fieldDef=model.fieldDef(p.channel);return fieldDef&&fieldDef.bin?"[".concat(datum,"[").concat(vegaUtil.stringValue(model.vgField(p.channel,{})),"], ")+"".concat(datum,"[").concat(vegaUtil.stringValue(model.vgField(p.channel,{binSuffix:"end"})),"]]"):"".concat(datum,"[").concat(vegaUtil.stringValue(p.field),"]")}).join(", "),update="unit: ".concat(unitName(model),", fields: ").concat(fieldsSg,", values"),events=selCmpt.events;return signals.concat([{name:name+TUPLE,on:events?[{events:events,update:"datum && item().mark.marktype !== 'group' ? {".concat(update,": [").concat(values,"]} : null"),force:!0}]:[]}])}};function wrapCondition(model,channelDef,vgChannel,refFn){const condition=isConditionalDef(channelDef)&&channelDef.condition,valueRef=refFn(channelDef);return condition?{[vgChannel]:[...vegaUtil.array(condition).map(c=>{const conditionValueRef=refFn(c);if(function(c){return c.param}(c)){const{param:param,empty:empty}=c;return{test:parseSelectionPredicate(model,{param:param,empty:empty}),...conditionValueRef}}return{test:expression(model,c.test),...conditionValueRef}}),...void 0!==valueRef?[valueRef]:[]]}:void 0!==valueRef?{[vgChannel]:valueRef}:{}}function text(model,channel="text"){const channelDef=model.encoding[channel];return wrapCondition(model,channelDef,channel,cDef=>textRef(cDef,model.config))}function textRef(channelDef,config,expr="datum"){if(channelDef){if(isValueDef(channelDef))return signalOrValueRef(channelDef.value);if(isFieldOrDatumDef(channelDef)){const{format:format,formatType:formatType}=getFormatMixins(channelDef);return formatSignalRef({fieldOrDatumDef:channelDef,format:format,formatType:formatType,expr:expr,config:config})}}}function tooltip(model,opt={}){const{encoding:encoding,markDef:markDef,config:config,stack:stack}=model,channelDef=encoding.tooltip;if(vegaUtil.isArray(channelDef))return{tooltip:tooltipRefForEncoding({tooltip:channelDef},stack,config,opt)};{const datum=opt.reactiveGeom?"datum.datum":"datum";return wrapCondition(model,channelDef,"tooltip",cDef=>{const tooltipRefFromChannelDef=textRef(cDef,config,datum);if(tooltipRefFromChannelDef)return tooltipRefFromChannelDef;if(null===cDef)return;let markTooltip=getMarkPropOrConfig("tooltip",markDef,config);return!0===markTooltip&&(markTooltip={content:"encoding"}),vegaUtil.isString(markTooltip)?{value:markTooltip}:vegaUtil.isObject(markTooltip)?isSignalRef(markTooltip)?markTooltip:"encoding"===markTooltip.content?tooltipRefForEncoding(encoding,stack,config,opt):{signal:datum}:void 0})}}function tooltipData(encoding,stack,config,{reactiveGeom:reactiveGeom}={}){const toSkip={},expr=reactiveGeom?"datum.datum":"datum",tuples=[];function add(fDef,channel){var _value;const mainChannel=getMainRangeChannel(channel),fieldDef=isTypedFieldDef(fDef)?fDef:{...fDef,type:encoding[mainChannel].type},title=fieldDef.title||defaultTitle(fieldDef,config),key=vegaUtil.array(title).join(", ");let value;if(isXorY(channel)){const channel2="x"===channel?"x2":"y2",fieldDef2=getFieldDef(encoding[channel2]);if(isBinned(fieldDef.bin)&&fieldDef2){const startField=vgField(fieldDef,{expr:expr}),endField=vgField(fieldDef2,{expr:expr}),{format:format,formatType:formatType}=getFormatMixins(fieldDef);value=binFormatExpression(startField,endField,format,formatType,config),toSkip[channel2]=!0}else if(stack&&stack.fieldChannel===channel&&"normalize"===stack.offset){const{format:format,formatType:formatType}=getFormatMixins(fieldDef);value=formatSignalRef({fieldOrDatumDef:fieldDef,format:format,formatType:formatType,expr:expr,config:config,normalizeStack:!0}).signal}}null!==(_value=value)&&void 0!==_value||(value=textRef(fieldDef,config,expr).signal),tuples.push({channel:channel,key:key,value:value})}forEach(encoding,(channelDef,channel)=>{isFieldDef(channelDef)?add(channelDef,channel):hasConditionalFieldDef(channelDef)&&add(channelDef.condition,channel)});const out={};for(const{channel:channel,key:key,value:value}of tuples)toSkip[channel]||out[key]||(out[key]=value);return out}function tooltipRefForEncoding(encoding,stack,config,{reactiveGeom:reactiveGeom}={}){const data=tooltipData(encoding,stack,config,{reactiveGeom:reactiveGeom}),keyValues=entries(data).map(([key,value])=>'"'.concat(key,'": ').concat(value));return keyValues.length>0?{signal:"{".concat(keyValues.join(", "),"}")}:void 0}function aria(model){const{markDef:markDef,config:config}=model,enableAria=getMarkPropOrConfig("aria",markDef,config);return!1===enableAria?{}:{...enableAria?{aria:enableAria}:{},...ariaRoleDescription(model),...description$1(model)}}function ariaRoleDescription(model){const{mark:mark,markDef:markDef,config:config}=model;if(!1===config.aria)return{};const ariaRoleDesc=getMarkPropOrConfig("ariaRoleDescription",markDef,config);return null!=ariaRoleDesc?{ariaRoleDescription:{value:ariaRoleDesc}}:mark in VG_MARK_INDEX?{}:{ariaRoleDescription:{value:mark}}}function description$1(model){const{encoding:encoding,markDef:markDef,config:config,stack:stack}=model,channelDef=encoding.description;if(channelDef)return wrapCondition(model,channelDef,"description",cDef=>textRef(cDef,model.config));const descriptionValue=getMarkPropOrConfig("description",markDef,config);if(null!=descriptionValue)return{description:signalOrValueRef(descriptionValue)};if(!1===config.aria)return{};const data=tooltipData(encoding,stack,config);return isEmpty(data)?void 0:{description:{signal:entries(data).map(([key,value],index)=>'"'.concat(index>0?"; ":"").concat(key,': " + (').concat(value,")")).join(" + ")}}}function nonPosition(channel,model,opt={}){const{markDef:markDef,encoding:encoding,config:config}=model,{vgChannel:vgChannel}=opt;let{defaultRef:defaultRef,defaultValue:defaultValue}=opt;var _defaultValue;void 0===defaultRef&&(null!==(_defaultValue=defaultValue)&&void 0!==_defaultValue||(defaultValue=getMarkPropOrConfig(channel,markDef,config,{vgChannel:vgChannel,ignoreVgConfig:!0})),void 0!==defaultValue&&(defaultRef=signalOrValueRef(defaultValue)));const channelDef=encoding[channel];return wrapCondition(model,channelDef,null!=vgChannel?vgChannel:channel,cDef=>midPoint({channel:channel,channelDef:cDef,markDef:markDef,config:config,scaleName:model.scaleName(channel),scale:model.getScaleComponent(channel),stack:null,defaultRef:defaultRef}))}function color(model,opt={filled:void 0}){var _opt$filled,_ref,_getMarkPropOrConfig,_getMarkPropOrConfig2;const{markDef:markDef,encoding:encoding,config:config}=model,{type:markType}=markDef,filled=null!==(_opt$filled=opt.filled)&&void 0!==_opt$filled?_opt$filled:getMarkPropOrConfig("filled",markDef,config),transparentIfNeeded=contains(["bar","point","circle","square","geoshape"],markType)?"transparent":void 0,defaultFill=null!==(_ref=null!==(_getMarkPropOrConfig=getMarkPropOrConfig(!0===filled?"color":void 0,markDef,config,{vgChannel:"fill"}))&&void 0!==_getMarkPropOrConfig?_getMarkPropOrConfig:config.mark[!0===filled&&"color"])&&void 0!==_ref?_ref:transparentIfNeeded,defaultStroke=null!==(_getMarkPropOrConfig2=getMarkPropOrConfig(!1===filled?"color":void 0,markDef,config,{vgChannel:"stroke"}))&&void 0!==_getMarkPropOrConfig2?_getMarkPropOrConfig2:config.mark[!1===filled&&"color"],colorVgChannel=filled?"fill":"stroke",fillStrokeMarkDefAndConfig={...defaultFill?{fill:signalOrValueRef(defaultFill)}:{},...defaultStroke?{stroke:signalOrValueRef(defaultStroke)}:{}};return markDef.color&&(filled?markDef.fill:markDef.stroke)&&warn(droppingColor("property",{fill:"fill"in markDef,stroke:"stroke"in markDef})),{...fillStrokeMarkDefAndConfig,...nonPosition("color",model,{vgChannel:colorVgChannel,defaultValue:filled?defaultFill:defaultStroke}),...nonPosition("fill",model,{defaultValue:encoding.fill?defaultFill:void 0}),...nonPosition("stroke",model,{defaultValue:encoding.stroke?defaultStroke:void 0})}}function zindex(model){const{encoding:encoding,mark:mark}=model,order=encoding.order;return!isPathMark(mark)&&isValueDef(order)?wrapCondition(model,order,"zindex",cd=>signalOrValueRef(cd.value)):{}}function getOffset(channel,markDef){const markDefOffsetValue=markDef[function(channel){switch(channel){case X:return"xOffset";case Y:return"yOffset";case X2:return"x2Offset";case Y2:return"y2Offset";case THETA:return"thetaOffset";case RADIUS:return"radiusOffset";case THETA2:return"theta2Offset";case"radius2":return"radius2Offset"}}(channel)];if(markDefOffsetValue)return markDefOffsetValue}function pointPosition(channel,model,{defaultPos:defaultPos,vgChannel:vgChannel}){const{encoding:encoding,markDef:markDef,config:config,stack:stack}=model,channelDef=encoding[channel],channel2Def=encoding[getSecondaryRangeChannel(channel)],scaleName=model.scaleName(channel),scale=model.getScaleComponent(channel),offset=getOffset(channel,markDef),defaultRef=pointPositionDefaultRef({model:model,defaultPos:defaultPos,channel:channel,scaleName:scaleName,scale:scale}),valueRef=!channelDef&&isXorY(channel)&&(encoding.latitude||encoding.longitude)?{field:model.getName(channel)}:function(params){const{channel:channel,channelDef:channelDef,scaleName:scaleName,stack:stack,offset:offset,markDef:markDef}=params;if(isFieldOrDatumDef(channelDef)&&stack&&channel===stack.fieldChannel){if(isFieldDef(channelDef)){let bandPosition=channelDef.bandPosition;if(void 0!==bandPosition||"text"!==markDef.type||"radius"!==channel&&"theta"!==channel||(bandPosition=.5),void 0!==bandPosition)return interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:channelDef,startSuffix:"start",bandPosition:bandPosition,offset:offset})}return valueRefForFieldOrDatumDef(channelDef,scaleName,{suffix:"end"},{offset:offset})}return midPointRefWithPositionInvalidTest(params)}({channel:channel,channelDef:channelDef,channel2Def:channel2Def,markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:defaultRef});return valueRef?{[vgChannel||channel]:valueRef}:void 0}function pointPositionDefaultRef({model:model,defaultPos:defaultPos,channel:channel,scaleName:scaleName,scale:scale}){const{markDef:markDef,config:config}=model;return()=>{const mainChannel=getMainRangeChannel(channel),vgChannel=getVgPositionChannel(channel),definedValueOrConfig=getMarkPropOrConfig(channel,markDef,config,{vgChannel:vgChannel});if(void 0!==definedValueOrConfig)return widthHeightValueOrSignalRef(channel,definedValueOrConfig);switch(defaultPos){case"zeroOrMin":case"zeroOrMax":if(scaleName){const scaleType=scale.get("type");if(contains([ScaleType_LOG,ScaleType_TIME,ScaleType_UTC],scaleType));else if(scale.domainDefinitelyIncludesZero())return{scale:scaleName,value:0}}if("zeroOrMin"===defaultPos)return"y"===mainChannel?{field:{group:"height"}}:{value:0};switch(mainChannel){case"radius":return{signal:"min(".concat(model.width.signal,",").concat(model.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...model[getSizeChannel(channel)],mult:.5}}}}const ALIGNED_X_CHANNEL={left:"x",center:"xc",right:"x2"},BASELINED_Y_CHANNEL={top:"y",middle:"yc",bottom:"y2"};function vgAlignedPositionChannel(channel,markDef,config,defaultAlign="middle"){if("radius"===channel||"theta"===channel)return getVgPositionChannel(channel);const alignChannel="x"===channel?"align":"baseline",align=getMarkPropOrConfig(alignChannel,markDef,config);let alignExcludingSignal;return isSignalRef(align)?(warn(function(align){return"The ".concat(align," for range marks cannot be an expression")}(alignChannel)),alignExcludingSignal=void 0):alignExcludingSignal=align,"x"===channel?ALIGNED_X_CHANNEL[alignExcludingSignal||("top"===defaultAlign?"left":"center")]:BASELINED_Y_CHANNEL[alignExcludingSignal||defaultAlign]}function pointOrRangePosition(channel,model,{defaultPos:defaultPos,defaultPos2:defaultPos2,range:range}){return range?rangePosition(channel,model,{defaultPos:defaultPos,defaultPos2:defaultPos2}):pointPosition(channel,model,{defaultPos:defaultPos})}function rangePosition(channel,model,{defaultPos:defaultPos,defaultPos2:defaultPos2}){const{markDef:markDef,config:config}=model,channel2=getSecondaryRangeChannel(channel),sizeChannel=getSizeChannel(channel),pos2Mixins=function(model,defaultPos,channel){const{encoding:encoding,mark:mark,markDef:markDef,stack:stack,config:config}=model,baseChannel=getMainRangeChannel(channel),sizeChannel=getSizeChannel(channel),vgChannel=getVgPositionChannel(channel),channelDef=encoding[baseChannel],scaleName=model.scaleName(baseChannel),scale=model.getScaleComponent(baseChannel),offset=getOffset(channel in encoding||channel in markDef?channel:baseChannel,model.markDef);if(!channelDef&&("x2"===channel||"y2"===channel)&&(encoding.latitude||encoding.longitude))return{[vgChannel]:{field:model.getName(channel)}};const valueRef=function({channel:channel,channelDef:channelDef,channel2Def:channel2Def,markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:defaultRef}){return isFieldOrDatumDef(channelDef)&&stack&&channel.charAt(0)===stack.fieldChannel.charAt(0)?valueRefForFieldOrDatumDef(channelDef,scaleName,{suffix:"start"},{offset:offset}):midPointRefWithPositionInvalidTest({channel:channel,channelDef:channel2Def,scaleName:scaleName,scale:scale,stack:stack,markDef:markDef,config:config,offset:offset,defaultRef:defaultRef})}({channel:channel,channelDef:channelDef,channel2Def:encoding[channel],markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:void 0});return void 0!==valueRef?{[vgChannel]:valueRef}:position2orSize(channel,markDef)||position2orSize(channel,{[channel]:getMarkStyleConfig(channel,markDef,config.style),[sizeChannel]:getMarkStyleConfig(sizeChannel,markDef,config.style)})||position2orSize(channel,config[mark])||position2orSize(channel,config.mark)||{[vgChannel]:pointPositionDefaultRef({model:model,defaultPos:defaultPos,channel:channel,scaleName:scaleName,scale:scale})()}}(model,defaultPos2,channel2);return{...pointPosition(channel,model,{defaultPos:defaultPos,vgChannel:pos2Mixins[sizeChannel]?vgAlignedPositionChannel(channel,markDef,config):getVgPositionChannel(channel)}),...pos2Mixins}}function position2orSize(channel,markDef){const sizeChannel=getSizeChannel(channel),vgChannel=getVgPositionChannel(channel);if(void 0!==markDef[vgChannel])return{[vgChannel]:widthHeightValueOrSignalRef(channel,markDef[vgChannel])};if(void 0!==markDef[channel])return{[vgChannel]:widthHeightValueOrSignalRef(channel,markDef[channel])};if(markDef[sizeChannel]){const dimensionSize=markDef[sizeChannel];if(!isRelativeBandSize(dimensionSize))return{[sizeChannel]:widthHeightValueOrSignalRef(channel,dimensionSize)};warn(function(sizeChannel){return"Position range does not support relative band size for ".concat(sizeChannel,".")}(sizeChannel))}}function rectPosition(model,channel,mark){var _ref,_encoding$sizeChannel;const{config:config,encoding:encoding,markDef:markDef}=model,channel2=getSecondaryRangeChannel(channel),sizeChannel=getSizeChannel(channel),channelDef=encoding[channel],channelDef2=encoding[channel2],scale=model.getScaleComponent(channel),scaleType=scale?scale.get("type"):void 0,scaleName=model.scaleName(channel),orient=markDef.orient,hasSizeDef=null!==(_ref=null!==(_encoding$sizeChannel=encoding[sizeChannel])&&void 0!==_encoding$sizeChannel?_encoding$sizeChannel:encoding.size)&&void 0!==_ref?_ref:getMarkPropOrConfig("size",markDef,config,{vgChannel:sizeChannel}),isBarBand="bar"===mark&&("x"===channel?"vertical"===orient:"horizontal"===orient);if(!isFieldDef(channelDef)||!(isBinning(channelDef.bin)||isBinned(channelDef.bin)||channelDef.timeUnit&&!channelDef2)||hasSizeDef&&!isRelativeBandSize(hasSizeDef)||hasDiscreteDomain(scaleType))return(isFieldOrDatumDef(channelDef)&&hasDiscreteDomain(scaleType)||isBarBand)&&!channelDef2?function(mark,fieldDef,channel,model){const{markDef:markDef,encoding:encoding,config:config,stack:stack}=model,orient=markDef.orient,scaleName=model.scaleName(channel),scale=model.getScaleComponent(channel),vgSizeChannel=getSizeChannel(channel),channel2=getSecondaryRangeChannel(channel),useVlSizeChannel="horizontal"===orient&&"y"===channel||"vertical"===orient&&"x"===channel;let sizeMixins;(encoding.size||markDef.size)&&(useVlSizeChannel?sizeMixins=nonPosition("size",model,{vgChannel:vgSizeChannel,defaultRef:signalOrValueRef(markDef.size)}):warn(function(mark){return'Cannot apply size to non-oriented mark "'.concat(mark,'".')}(markDef.type)));const bandSize=getBandSize({channel:channel,fieldDef:fieldDef,markDef:markDef,config:config,scaleType:null==scale?void 0:scale.get("type"),useVlSizeChannel:useVlSizeChannel});sizeMixins=sizeMixins||{[vgSizeChannel]:defaultSizeRef(vgSizeChannel,scaleName,scale,config,bandSize)};const defaultBandAlign="band"===(null==scale?void 0:scale.get("type"))&&"band"in sizeMixins[vgSizeChannel]?"top":"middle",vgChannel=vgAlignedPositionChannel(channel,markDef,config,defaultBandAlign),center="xc"===vgChannel||"yc"===vgChannel,offset=getOffset(channel,markDef),posRef=midPointRefWithPositionInvalidTest({channel:channel,channelDef:fieldDef,markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:pointPositionDefaultRef({model:model,defaultPos:"mid",channel:channel,scaleName:scaleName,scale:scale}),bandPosition:center?.5:isSignalRef(bandSize)?{signal:"(1-".concat(bandSize,")/2")}:isRelativeBandSize(bandSize)?(1-bandSize.band)/2:0});if(vgSizeChannel)return{[vgChannel]:posRef,...sizeMixins};{const vgChannel2=getVgPositionChannel(channel2),sizeRef=sizeMixins[vgSizeChannel],sizeOffset=offset?{...sizeRef,offset:offset}:sizeRef;return{[vgChannel]:posRef,[vgChannel2]:vegaUtil.isArray(posRef)?[posRef[0],{...posRef[1],offset:sizeOffset}]:{...posRef,offset:sizeOffset}}}}(0,channelDef,channel,model):rangePosition(channel,model,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"});{var _model$component$axes,_axis$get;const bandSize=getBandSize({channel:channel,fieldDef:channelDef,markDef:markDef,config:config,scaleType:scaleType}),axis=null===(_model$component$axes=model.component.axes[channel])||void 0===_model$component$axes?void 0:_model$component$axes[0];return function({fieldDef:fieldDef,fieldDef2:fieldDef2,channel:channel,bandSize:bandSize,scaleName:scaleName,markDef:markDef,spacing:spacing=0,axisTranslate:axisTranslate,reverse:reverse,config:config}){const channel2=getSecondaryRangeChannel(channel),vgChannel=getVgPositionChannel(channel),vgChannel2=getVgPositionChannel(channel2),offset=getOffset(channel,markDef),bandPosition=isSignalRef(bandSize)?{signal:"(1-".concat(bandSize.signal,")/2")}:isRelativeBandSize(bandSize)?(1-bandSize.band)/2:.5;if(isBinning(fieldDef.bin)||fieldDef.timeUnit)return{[vgChannel2]:rectBinRef({channel:channel,fieldDef:fieldDef,scaleName:scaleName,markDef:markDef,bandPosition:bandPosition,offset:getBinSpacing(channel2,spacing,reverse,axisTranslate,offset),config:config}),[vgChannel]:rectBinRef({channel:channel,fieldDef:fieldDef,scaleName:scaleName,markDef:markDef,bandPosition:isSignalRef(bandPosition)?{signal:"1-".concat(bandPosition.signal)}:1-bandPosition,offset:getBinSpacing(channel,spacing,reverse,axisTranslate,offset),config:config})};if(isBinned(fieldDef.bin)){const startRef=valueRefForFieldOrDatumDef(fieldDef,scaleName,{},{offset:getBinSpacing(channel2,spacing,reverse,axisTranslate,offset)});if(isFieldDef(fieldDef2))return{[vgChannel2]:startRef,[vgChannel]:valueRefForFieldOrDatumDef(fieldDef2,scaleName,{},{offset:getBinSpacing(channel,spacing,reverse,axisTranslate,offset)})};if(isBinParams(fieldDef.bin)&&fieldDef.bin.step)return{[vgChannel2]:startRef,[vgChannel]:{signal:'scale("'.concat(scaleName,'", ').concat(vgField(fieldDef,{expr:"datum"})," + ").concat(fieldDef.bin.step,")"),offset:getBinSpacing(channel,spacing,reverse,axisTranslate,offset)}}}warn(channelRequiredForBinned(channel2))}({fieldDef:channelDef,fieldDef2:channelDef2,channel:channel,markDef:markDef,scaleName:scaleName,bandSize:bandSize,axisTranslate:null!==(_axis$get=null==axis?void 0:axis.get("translate"))&&void 0!==_axis$get?_axis$get:.5,spacing:isXorY(channel)?getMarkPropOrConfig("binSpacing",markDef,config):void 0,reverse:scale.get("reverse"),config:config})}}function defaultSizeRef(sizeChannel,scaleName,scale,config,bandSize){if(isRelativeBandSize(bandSize)){if(!scale)return{mult:bandSize.band,field:{group:sizeChannel}};{const scaleType=scale.get("type");if("band"===scaleType)return{scale:scaleName,band:bandSize.band};1!==bandSize.band&&(warn(function(scaleType){return"Cannot use the relative band size with ".concat(scaleType," scale.")}(scaleType)),bandSize=void 0)}}else{if(isSignalRef(bandSize))return bandSize;if(bandSize)return{value:bandSize}}if(scale){const scaleRange=scale.get("range");if(isVgRangeStep(scaleRange)&&vegaUtil.isNumber(scaleRange.step))return{value:scaleRange.step-2}}return{value:getViewConfigDiscreteStep(config.view,sizeChannel)-2}}function getBinSpacing(channel,spacing,reverse,translate,offset){if(isPolarPositionChannel(channel))return 0;const spacingOffset="x"===channel||"y2"===channel?-spacing/2:spacing/2;if(isSignalRef(reverse)||isSignalRef(offset)||isSignalRef(translate)){const reverseExpr=signalOrStringValue(reverse),offsetExpr=signalOrStringValue(offset),translateExpr=signalOrStringValue(translate);return{signal:(translateExpr?"".concat(translateExpr," + "):"")+(reverseExpr?"(".concat(reverseExpr," ? -1 : 1) * "):"")+(offsetExpr?"(".concat(offsetExpr," + ").concat(spacingOffset,")"):spacingOffset)}}return offset=offset||0,translate+(reverse?-offset-spacingOffset:+offset+spacingOffset)}function rectBinRef({channel:channel,fieldDef:fieldDef,scaleName:scaleName,markDef:markDef,bandPosition:bandPosition,offset:offset,config:config}){return wrapPositionInvalidTest({fieldDef:fieldDef,channel:channel,markDef:markDef,ref:interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:fieldDef,bandPosition:bandPosition,offset:offset}),config:config})}const ALWAYS_IGNORE=new Set(["aria","width","height"]);function baseEncodeEntry(model,ignore){const{fill:fill,stroke:stroke}="include"===ignore.color?color(model):{};return{...markDefProperties(model.markDef,ignore),...wrapAllFieldsInvalid(model,"fill",fill),...wrapAllFieldsInvalid(model,"stroke",stroke),...nonPosition("opacity",model),...nonPosition("fillOpacity",model),...nonPosition("strokeOpacity",model),...nonPosition("strokeWidth",model),...nonPosition("strokeDash",model),...zindex(model),...tooltip(model),...text(model,"href"),...aria(model)}}function wrapAllFieldsInvalid(model,channel,valueRef){const{config:config,mark:mark,markDef:markDef}=model;if("hide"===getMarkPropOrConfig("invalid",markDef,config)&&valueRef&&!isPathMark(mark)){const test=function(model,{invalid:invalid=!1,channels:channels}){const filterIndex=channels.reduce((aggregator,channel)=>{const scaleComponent=model.getScaleComponent(channel);if(scaleComponent){const scaleType=scaleComponent.get("type"),field=model.vgField(channel,{expr:"datum"});field&&hasContinuousDomain(scaleType)&&(aggregator[field]=!0)}return aggregator},{}),fields=keys(filterIndex);if(fields.length>0){const op=invalid?"||":"&&";return fields.map(field=>fieldInvalidPredicate(field,invalid)).join(" ".concat(op," "))}}(model,{invalid:!0,channels:SCALE_CHANNELS});if(test)return{[channel]:[{test:test,value:null},...vegaUtil.array(valueRef)]}}return valueRef?{[channel]:valueRef}:{}}function markDefProperties(mark,ignore){return VG_MARK_CONFIGS.reduce((m,prop)=>(ALWAYS_IGNORE.has(prop)||void 0===mark[prop]||"ignore"===ignore[prop]||(m[prop]=signalOrValueRef(mark[prop])),m),{})}function defined(model){const{config:config,markDef:markDef}=model;if(getMarkPropOrConfig("invalid",markDef,config)){const signal=function(model,{invalid:invalid=!1,channels:channels}){const filterIndex=channels.reduce((aggregator,channel)=>{const scaleComponent=model.getScaleComponent(channel);if(scaleComponent){const scaleType=scaleComponent.get("type"),field=model.vgField(channel,{expr:"datum"});field&&hasContinuousDomain(scaleType)&&(aggregator[field]=!0)}return aggregator},{}),fields=keys(filterIndex);if(fields.length>0){const op=invalid?"||":"&&";return fields.map(field=>fieldInvalidPredicate(field,invalid)).join(" ".concat(op," "))}}(model,{channels:POSITION_SCALE_CHANNELS});if(signal)return{defined:{signal:signal}}}return{}}function valueIfDefined(prop,value){if(void 0!==value)return{[prop]:signalOrValueRef(value)}}const nearest={defined:selCmpt=>"point"===selCmpt.type&&selCmpt.nearest,parse:(model,selCmpt)=>{if(selCmpt.events)for(const s of selCmpt.events)s.markname=model.getName("voronoi")},marks:(model,selCmpt,marks)=>{const{x:x,y:y}=selCmpt.project.hasChannel,markType=model.mark;if(isPathMark(markType))return warn('The "nearest" transform is not supported for '.concat(markType," marks.")),marks;const cellDef={name:model.getName("voronoi"),type:"path",interactive:!0,from:{data:model.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...tooltip(model,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:x||!y?"datum.datum.x || 0":"0"},y:{expr:y||!x?"datum.datum.y || 0":"0"},size:[model.getSizeSignalRef("width"),model.getSizeSignalRef("height")]}]};let index=0,exists=!1;return marks.forEach((mark,i)=>{var _mark$name;const name=null!==(_mark$name=mark.name)&&void 0!==_mark$name?_mark$name:"";name===model.component.mark[0].name?index=i:name.indexOf("voronoi")>=0&&(exists=!0)}),exists||marks.splice(index+1,0,cellDef),marks}},inputBindings={defined:selCmpt=>"point"===selCmpt.type&&"global"===selCmpt.resolve&&selCmpt.bind&&"scales"!==selCmpt.bind&&!isLegendBinding(selCmpt.bind),parse:(model,selCmpt,selDef)=>disableDirectManipulation(selCmpt,selDef),topLevelSignals:(model,selCmpt,signals)=>{const name=selCmpt.name,proj=selCmpt.project,bind=selCmpt.bind,init=selCmpt.init&&selCmpt.init[0],datum=nearest.defined(selCmpt)?"(item().isVoronoi ? datum.datum : datum)":"datum";return proj.items.forEach((p,i)=>{const sgname=varName("".concat(name,"_").concat(p.field));var _ref,_bind$p$field;signals.filter(s=>s.name===sgname).length||signals.unshift({name:sgname,...init?{init:assembleInit(init[i])}:{value:null},on:selCmpt.events?[{events:selCmpt.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(datum,"[").concat(vegaUtil.stringValue(p.field),"] : null")}]:[],bind:null!==(_ref=null!==(_bind$p$field=bind[p.field])&&void 0!==_bind$p$field?_bind$p$field:bind[p.channel])&&void 0!==_ref?_ref:bind})}),signals},signals:(model,selCmpt,signals)=>{const name=selCmpt.name,proj=selCmpt.project,signal=signals.filter(s=>s.name===name+TUPLE)[0],fields=name+"_tuple_fields",values=proj.items.map(p=>varName("".concat(name,"_").concat(p.field))),valid=values.map(v=>"".concat(v," !== null")).join(" && ");return values.length&&(signal.update="".concat(valid," ? {fields: ").concat(fields,", values: [").concat(values.join(", "),"]} : null")),delete signal.value,delete signal.on,signals}},toggle={defined:selCmpt=>"point"===selCmpt.type&&!!selCmpt.toggle,signals:(model,selCmpt,signals)=>signals.concat({name:selCmpt.name+"_toggle",value:!1,on:[{events:selCmpt.events,update:selCmpt.toggle}]}),modifyExpr:(model,selCmpt)=>{const tpl=selCmpt.name+TUPLE,signal=selCmpt.name+"_toggle";return"".concat(signal," ? null : ").concat(tpl,", ")+("global"===selCmpt.resolve?"".concat(signal," ? null : true, "):"".concat(signal," ? null : {unit: ").concat(unitName(model),"}, "))+"".concat(signal," ? ").concat(tpl," : null")}},clear={defined:selCmpt=>void 0!==selCmpt.clear&&!1!==selCmpt.clear,parse:(model,selCmpt)=>{selCmpt.clear&&(selCmpt.clear=vegaUtil.isString(selCmpt.clear)?eventSelector(selCmpt.clear,"view"):selCmpt.clear)},topLevelSignals:(model,selCmpt,signals)=>{if(inputBindings.defined(selCmpt))for(const proj of selCmpt.project.items){const idx=signals.findIndex(n=>n.name===varName("".concat(selCmpt.name,"_").concat(proj.field)));-1!==idx&&signals[idx].on.push({events:selCmpt.clear,update:"null"})}return signals},signals:(model,selCmpt,signals)=>{function addClear(idx,update){-1!==idx&&signals[idx].on&&signals[idx].on.push({events:selCmpt.clear,update:update})}if("interval"===selCmpt.type)for(const proj of selCmpt.project.items){const vIdx=signals.findIndex(n=>n.name===proj.signals.visual);addClear(vIdx,"[0, 0]"),-1===vIdx&&addClear(signals.findIndex(n=>n.name===proj.signals.data),"null")}else{let tIdx=signals.findIndex(n=>n.name===selCmpt.name+TUPLE);addClear(tIdx,"null"),toggle.defined(selCmpt)&&(tIdx=signals.findIndex(n=>n.name===selCmpt.name+"_toggle"),addClear(tIdx,"false"))}return signals}},legendBindings={defined:selCmpt=>{const spec="global"===selCmpt.resolve&&selCmpt.bind&&isLegendBinding(selCmpt.bind),projLen=1===selCmpt.project.items.length&&"_vgsid_"!==selCmpt.project.items[0].field;return spec&&!projLen&&warn("Legend bindings are only supported for selections over an individual field or encoding channel."),spec&&projLen},parse:(model,selCmpt,selDef)=>{const selDef_=duplicate(selDef);if(selDef_.select=vegaUtil.isString(selDef_.select)?{type:selDef_.select,toggle:selCmpt.toggle}:{...selDef_.select,toggle:selCmpt.toggle},disableDirectManipulation(selCmpt,selDef_),vega.isObject(selDef.select)&&(selDef.select.on||selDef.select.clear)){const legendFilter='event.item && indexof(event.item.mark.role, "legend") < 0';for(const evt of selCmpt.events){var _evt$filter;evt.filter=vegaUtil.array(null!==(_evt$filter=evt.filter)&&void 0!==_evt$filter?_evt$filter:[]),evt.filter.includes(legendFilter)||evt.filter.push(legendFilter)}}const evt=isLegendStreamBinding(selCmpt.bind)?selCmpt.bind.legend:"click",stream=vegaUtil.isString(evt)?eventSelector(evt,"view"):vegaUtil.array(evt);selCmpt.bind={legend:{merge:stream}}},topLevelSignals:(model,selCmpt,signals)=>{const selName=selCmpt.name,stream=isLegendStreamBinding(selCmpt.bind)&&selCmpt.bind.legend,markName=name=>s=>{const ds=duplicate(s);return ds.markname=name,ds};for(const proj of selCmpt.project.items){if(!proj.hasLegend)continue;const prefix="".concat(varName(proj.field),"_legend"),sgName="".concat(selName,"_").concat(prefix);if(0===signals.filter(s=>s.name===sgName).length){const events=stream.merge.map(markName("".concat(prefix,"_symbols"))).concat(stream.merge.map(markName("".concat(prefix,"_labels")))).concat(stream.merge.map(markName("".concat(prefix,"_entries"))));signals.unshift({name:sgName,...selCmpt.init?{}:{value:null},on:[{events:events,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:stream.merge,update:"!event.item || !datum ? null : ".concat(sgName),force:!0}]})}}return signals},signals:(model,selCmpt,signals)=>{const name=selCmpt.name,proj=selCmpt.project,tuple=signals.find(s=>s.name===name+TUPLE),fields=name+"_tuple_fields",values=proj.items.filter(p=>p.hasLegend).map(p=>varName("".concat(name,"_").concat(varName(p.field),"_legend"))),valid=values.map(v=>"".concat(v," !== null")).join(" && "),update="".concat(valid," ? {fields: ").concat(fields,", values: [").concat(values.join(", "),"]} : null");selCmpt.events&&values.length>0?tuple.on.push({events:values.map(signal=>({signal:signal})),update:update}):values.length>0&&(tuple.update=update,delete tuple.value,delete tuple.on);const toggle=signals.find(s=>s.name===name+"_toggle"),events=isLegendStreamBinding(selCmpt.bind)&&selCmpt.bind.legend;return toggle&&(selCmpt.events?toggle.on.push({...toggle.on[0],events:events}):toggle.on[0].events=events),signals}},DELTA="_translate_delta",translate={defined:selCmpt=>"interval"===selCmpt.type&&selCmpt.translate,signals:(model,selCmpt,signals)=>{const name=selCmpt.name,hasScales=scaleBindings.defined(selCmpt),anchor=name+"_translate_anchor",{x:x,y:y}=selCmpt.project.hasChannel;let events=eventSelector(selCmpt.translate,"scope");return hasScales||(events=events.map(e=>(e.between[0].markname=name+"_brush",e))),signals.push({name:anchor,value:{},on:[{events:events.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==x?", extent_x: ".concat(hasScales?domain$1(model,X):"slice(".concat(x.signals.visual,")")):"")+(void 0!==y?", extent_y: ".concat(hasScales?domain$1(model,Y):"slice(".concat(y.signals.visual,")")):"")+"}"}]},{name:name+DELTA,value:{},on:[{events:events,update:"{x: ".concat(anchor,".x - x(unit), y: ").concat(anchor,".y - y(unit)}")}]}),void 0!==x&&onDelta(model,selCmpt,x,"width",signals),void 0!==y&&onDelta(model,selCmpt,y,"height",signals),signals}};function onDelta(model,selCmpt,proj,size,signals){var _scaleCmpt$get,_scaleCmpt$get2;const name=selCmpt.name,anchor=name+"_translate_anchor",delta=name+DELTA,channel=proj.channel,hasScales=scaleBindings.defined(selCmpt),signal=signals.filter(s=>s.name===proj.signals[hasScales?"data":"visual"])[0],sizeSg=model.getSizeSignalRef(size).signal,scaleCmpt=model.getScaleComponent(channel),scaleType=scaleCmpt.get("type"),reversed=scaleCmpt.get("reverse"),sign=hasScales?channel===X?reversed?"":"-":reversed?"-":"":"",extent="".concat(anchor,".extent_").concat(channel),offset="".concat(sign).concat(delta,".").concat(channel," / ").concat(hasScales?"".concat(sizeSg):"span(".concat(extent,")")),panFn=hasScales?"log"===scaleType?"panLog":"symlog"===scaleType?"panSymlog":"pow"===scaleType?"panPow":"panLinear":"panLinear",arg=hasScales?"pow"===scaleType?", ".concat(null!==(_scaleCmpt$get=scaleCmpt.get("exponent"))&&void 0!==_scaleCmpt$get?_scaleCmpt$get:1):"symlog"===scaleType?", ".concat(null!==(_scaleCmpt$get2=scaleCmpt.get("constant"))&&void 0!==_scaleCmpt$get2?_scaleCmpt$get2:1):"":"",update="".concat(panFn,"(").concat(extent,", ").concat(offset).concat(arg,")");signal.on.push({events:{signal:delta},update:hasScales?update:"clampRange(".concat(update,", 0, ").concat(sizeSg,")")})}const zoom={defined:selCmpt=>"interval"===selCmpt.type&&selCmpt.zoom,signals:(model,selCmpt,signals)=>{const name=selCmpt.name,hasScales=scaleBindings.defined(selCmpt),delta=name+"_zoom_delta",{x:x,y:y}=selCmpt.project.hasChannel,sx=vegaUtil.stringValue(model.scaleName(X)),sy=vegaUtil.stringValue(model.scaleName(Y));let events=eventSelector(selCmpt.zoom,"scope");return hasScales||(events=events.map(e=>(e.markname=name+"_brush",e))),signals.push({name:name+"_zoom_anchor",on:[{events:events,update:hasScales?"{"+[sx?"x: invert(".concat(sx,", x(unit))"):"",sy?"y: invert(".concat(sy,", y(unit))"):""].filter(expr=>!!expr).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:delta,on:[{events:events,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==x&&onDelta$1(model,selCmpt,x,"width",signals),void 0!==y&&onDelta$1(model,selCmpt,y,"height",signals),signals}};function onDelta$1(model,selCmpt,proj,size,signals){var _scaleCmpt$get,_scaleCmpt$get2;const name=selCmpt.name,channel=proj.channel,hasScales=scaleBindings.defined(selCmpt),signal=signals.filter(s=>s.name===proj.signals[hasScales?"data":"visual"])[0],sizeSg=model.getSizeSignalRef(size).signal,scaleCmpt=model.getScaleComponent(channel),scaleType=scaleCmpt.get("type"),base=hasScales?domain$1(model,channel):signal.name,delta=name+"_zoom_delta",anchor="".concat(name).concat("_zoom_anchor",".").concat(channel),zoomFn=hasScales?"log"===scaleType?"zoomLog":"symlog"===scaleType?"zoomSymlog":"pow"===scaleType?"zoomPow":"zoomLinear":"zoomLinear",arg=hasScales?"pow"===scaleType?", ".concat(null!==(_scaleCmpt$get=scaleCmpt.get("exponent"))&&void 0!==_scaleCmpt$get?_scaleCmpt$get:1):"symlog"===scaleType?", ".concat(null!==(_scaleCmpt$get2=scaleCmpt.get("constant"))&&void 0!==_scaleCmpt$get2?_scaleCmpt$get2:1):"":"",update="".concat(zoomFn,"(").concat(base,", ").concat(anchor,", ").concat(delta).concat(arg,")");signal.on.push({events:{signal:delta},update:hasScales?update:"clampRange(".concat(update,", 0, ").concat(sizeSg,")")})}const STORE="_store",TUPLE="_tuple",MODIFY="_modify",VL_SELECTION_RESOLVE="vlSelectionResolve",selectionCompilers=[point,interval,project,toggle,inputBindings,scaleBindings,legendBindings,clear,translate,zoom,nearest];function unitName(model,{escape:escape}={escape:!0}){let name=escape?vegaUtil.stringValue(model.name):model.name;const facetModel=function(model){let parent=model.parent;for(;parent&&!isFacetModel(parent);)parent=parent.parent;return parent}(model);if(facetModel){const{facet:facet}=facetModel;for(const channel of FACET_CHANNELS)facet[channel]&&(name+=" + '__facet_".concat(channel,"_' + (facet[").concat(vegaUtil.stringValue(facetModel.vgField(channel)),"])"))}return name}function requiresSelectionId(model){var _model$component$sele;return vals(null!==(_model$component$sele=model.component.selection)&&void 0!==_model$component$sele?_model$component$sele:{}).reduce((identifier,selCmpt)=>identifier||selCmpt.project.items.some(proj=>"_vgsid_"===proj.field),!1)}function disableDirectManipulation(selCmpt,selDef){!vega.isString(selDef.select)&&selDef.select.on||delete selCmpt.events,!vega.isString(selDef.select)&&selDef.select.clear||delete selCmpt.clear,!vega.isString(selDef.select)&&selDef.select.toggle||delete selCmpt.toggle}function ASTNode(type){this.type=type}var TokenName,source,index,length,lookahead;ASTNode.prototype.visit=function(visitor){let c,i,n;if(visitor(this))return 1;for(c=function(node){switch(node.type){case"ArrayExpression":return node.elements;case"BinaryExpression":case"LogicalExpression":return[node.left,node.right];case"CallExpression":return[node.callee].concat(node.arguments);case"ConditionalExpression":return[node.test,node.consequent,node.alternate];case"MemberExpression":return[node.object,node.property];case"ObjectExpression":return node.properties;case"Property":return[node.key,node.value];case"UnaryExpression":return[node.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),i=0,n=c.length;i<n;++i)if(c[i].visit(visitor))return 1},(TokenName={})[1]="Boolean",TokenName[2]="<end>",TokenName[3]="Identifier",TokenName[4]="Keyword",TokenName[5]="Null",TokenName[6]="Numeric",TokenName[7]="Punctuator",TokenName[8]="String",TokenName[9]="RegularExpression";var RegexNonAsciiIdentifierStart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),RegexNonAsciiIdentifierPart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function assert(condition,message){if(!condition)throw new Error("ASSERT: "+message)}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return 32===ch||9===ch||11===ch||12===ch||160===ch||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function isIdentifierStart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||92===ch||ch>=128&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||92===ch||ch>=128&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch))}const keywords={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function skipComment(){for(;index<length;){const ch=source.charCodeAt(index);if(!isWhiteSpace(ch)&&!isLineTerminator(ch))break;++index}}function scanHexEscape(prefix){var i,len,ch,code=0;for(len="u"===prefix?4:2,i=0;i<len;++i)index<length&&isHexDigit(source[index])?(ch=source[index++],code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())):throwError({},"Unexpected token %0","ILLEGAL");return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;for(code=0,"}"===(ch=source[index])&&throwError({},"Unexpected token %0","ILLEGAL");index<length&&isHexDigit(ch=source[index++]);)code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase());return(code>1114111||"}"!==ch)&&throwError({},"Unexpected token %0","ILLEGAL"),code<=65535?String.fromCharCode(code):(cu1=55296+(code-65536>>10),cu2=56320+(code-65536&1023),String.fromCharCode(cu1,cu2))}function getEscapedIdentifier(){var ch,id;for(ch=source.charCodeAt(index++),id=String.fromCharCode(ch),92===ch&&(117!==source.charCodeAt(index)&&throwError({},"Unexpected token %0","ILLEGAL"),++index,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierStart(ch.charCodeAt(0))||throwError({},"Unexpected token %0","ILLEGAL"),id=ch);index<length&&isIdentifierPart(ch=source.charCodeAt(index));)++index,id+=String.fromCharCode(ch),92===ch&&(id=id.substr(0,id.length-1),117!==source.charCodeAt(index)&&throwError({},"Unexpected token %0","ILLEGAL"),++index,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierPart(ch.charCodeAt(0))||throwError({},"Unexpected token %0","ILLEGAL"),id+=ch);return id}function scanIdentifier(){var start,id;return start=index,{type:1===(id=92===source.charCodeAt(index)?getEscapedIdentifier():function(){var start,ch;for(start=index++;index<length;){if(92===(ch=source.charCodeAt(index)))return index=start,getEscapedIdentifier();if(!isIdentifierPart(ch))break;++index}return source.slice(start,index)}()).length?3:keywords.hasOwnProperty(id)?4:"null"===id?5:"true"===id||"false"===id?1:3,value:id,start:start,end:index}}function scanPunctuator(){var code2,ch2,ch3,ch4,start=index,code=source.charCodeAt(index),ch1=source[index];switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++index,{type:7,value:String.fromCharCode(code),start:start,end:index};default:if(61===(code2=source.charCodeAt(index+1)))switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return index+=2,{type:7,value:String.fromCharCode(code)+String.fromCharCode(code2),start:start,end:index};case 33:case 61:return index+=2,61===source.charCodeAt(index)&&++index,{type:7,value:source.slice(start,index),start:start,end:index}}}return">>>="===(ch4=source.substr(index,4))?{type:7,value:ch4,start:start,end:index+=4}:">>>"===(ch3=ch4.substr(0,3))||"<<="===ch3||">>="===ch3?{type:7,value:ch3,start:start,end:index+=3}:ch1===(ch2=ch3.substr(0,2))[1]&&"+-<>&|".indexOf(ch1)>=0||"=>"===ch2?{type:7,value:ch2,start:start,end:index+=2}:("//"===ch2&&throwError({},"Unexpected token %0","ILLEGAL"),"<>=!+-*%&|^/".indexOf(ch1)>=0?{type:7,value:ch1,start:start,end:++index}:void throwError({},"Unexpected token %0","ILLEGAL"))}function scanNumericLiteral(){var number,start,ch;if(assert(isDecimalDigit((ch=source[index]).charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point"),start=index,number="","."!==ch){if(number=source[index++],ch=source[index],"0"===number){if("x"===ch||"X"===ch)return++index,function(start){let number="";for(;index<length&&isHexDigit(source[index]);)number+=source[index++];return 0===number.length&&throwError({},"Unexpected token %0","ILLEGAL"),isIdentifierStart(source.charCodeAt(index))&&throwError({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt("0x"+number,16),start:start,end:index}}(start);if(isOctalDigit(ch))return function(start){let number="0"+source[index++];for(;index<length&&isOctalDigit(source[index]);)number+=source[index++];return(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index)))&&throwError({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt(number,8),octal:!0,start:start,end:index}}(start);ch&&isDecimalDigit(ch.charCodeAt(0))&&throwError({},"Unexpected token %0","ILLEGAL")}for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("."===ch){for(number+=source[index++];isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("e"===ch||"E"===ch)if(number+=source[index++],"+"!==(ch=source[index])&&"-"!==ch||(number+=source[index++]),isDecimalDigit(source.charCodeAt(index)))for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];else throwError({},"Unexpected token %0","ILLEGAL");return isIdentifierStart(source.charCodeAt(index))&&throwError({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseFloat(number),start:start,end:index}}function scanRegExp(){var start,body,flags,value;return lookahead=null,skipComment(),start=index,body=function(){var ch,str,classMarker,terminated;for(assert("/"===(ch=source[index]),"Regular expression literal must start with a slash"),str=source[index++],classMarker=!1,terminated=!1;index<length;)if(str+=ch=source[index++],"\\"===ch)isLineTerminator((ch=source[index++]).charCodeAt(0))&&throwError({},"Invalid regular expression: missing /"),str+=ch;else if(isLineTerminator(ch.charCodeAt(0)))throwError({},"Invalid regular expression: missing /");else if(classMarker)"]"===ch&&(classMarker=!1);else{if("/"===ch){terminated=!0;break}"["===ch&&(classMarker=!0)}return terminated||throwError({},"Invalid regular expression: missing /"),{value:str.substr(1,str.length-2),literal:str}}(),flags=function(){var ch,str,flags;for(str="",flags="";index<length&&isIdentifierPart((ch=source[index]).charCodeAt(0));)++index,"\\"===ch&&index<length?throwError({},"Unexpected token %0","ILLEGAL"):(flags+=ch,str+=ch);return flags.search(/[^gimuy]/g)>=0&&throwError({},"Invalid regular expression",flags),{value:flags,literal:str}}(),value=function(pattern,flags){let tmp=pattern;flags.indexOf("u")>=0&&(tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}/g,($0,$1)=>{if(parseInt($1,16)<=1114111)return"x";throwError({},"Invalid regular expression")}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(tmp)}catch(e){throwError({},"Invalid regular expression")}try{return new RegExp(pattern,flags)}catch(exception){return null}}(body.value,flags.value),{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index}}function advance(){if(skipComment(),index>=length)return{type:2,start:index,end:index};const ch=source.charCodeAt(index);return isIdentifierStart(ch)?scanIdentifier():40===ch||41===ch||59===ch?scanPunctuator():39===ch||34===ch?function(){var quote,start,ch,code,str="",octal=!1;for(assert("'"===(quote=source[index])||'"'===quote,"String literal must starts with a quote"),start=index,++index;index<length;){if((ch=source[index++])===quote){quote="";break}if("\\"===ch)if((ch=source[index++])&&isLineTerminator(ch.charCodeAt(0)))"\r"===ch&&"\n"===source[index]&&++index;else switch(ch){case"u":case"x":"{"===source[index]?(++index,str+=scanUnicodeCodePointEscape()):str+=scanHexEscape(ch);break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;default:isOctalDigit(ch)?(0!==(code="01234567".indexOf(ch))&&(octal=!0),index<length&&isOctalDigit(source[index])&&(octal=!0,code=8*code+"01234567".indexOf(source[index++]),"0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])&&(code=8*code+"01234567".indexOf(source[index++]))),str+=String.fromCharCode(code)):str+=ch}else{if(isLineTerminator(ch.charCodeAt(0)))break;str+=ch}}return""!==quote&&throwError({},"Unexpected token %0","ILLEGAL"),{type:8,value:str,octal:octal,start:start,end:index}}():46===ch?isDecimalDigit(source.charCodeAt(index+1))?scanNumericLiteral():scanPunctuator():isDecimalDigit(ch)?scanNumericLiteral():scanPunctuator()}function lex(){const token=lookahead;return index=token.end,lookahead=advance(),index=token.end,token}function peek(){const pos=index;lookahead=advance(),index=pos}function finishBinaryExpression(operator,left,right){const node=new ASTNode("||"===operator||"&&"===operator?"LogicalExpression":"BinaryExpression");return node.operator=operator,node.left=left,node.right=right,node}function finishCallExpression(callee,args){const node=new ASTNode("CallExpression");return node.callee=callee,node.arguments=args,node}function finishIdentifier(name){const node=new ASTNode("Identifier");return node.name=name,node}function finishLiteral(token){const node=new ASTNode("Literal");return node.value=token.value,node.raw=source.slice(token.start,token.end),token.regex&&("//"===node.raw&&(node.raw="/(?:)/"),node.regex=token.regex),node}function finishMemberExpression(accessor,object,property){const node=new ASTNode("MemberExpression");return node.computed="["===accessor,node.object=object,node.property=property,node.computed||(property.member=!0),node}function finishProperty(kind,key,value){const node=new ASTNode("Property");return node.key=key,node.value=value,node.kind=kind,node}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,(whole,index)=>(assert(index<args.length,"Message reference must be in range"),args[index]));throw(error=new Error(msg)).index=index,error.description=msg,error}function throwUnexpected(token){2===token.type&&throwError(token,"Unexpected end of input"),6===token.type&&throwError(token,"Unexpected number"),8===token.type&&throwError(token,"Unexpected string"),3===token.type&&throwError(token,"Unexpected identifier"),4===token.type&&throwError(token,"Unexpected reserved word"),throwError(token,"Unexpected token %0",token.value)}function expect(value){const token=lex();7===token.type&&token.value===value||throwUnexpected(token)}function match(value){return 7===lookahead.type&&lookahead.value===value}function matchKeyword(keyword){return 4===lookahead.type&&lookahead.value===keyword}function parseArrayInitialiser(){const elements=[];for(index=lookahead.start,expect("[");!match("]");)match(",")?(lex(),elements.push(null)):(elements.push(parseConditionalExpression()),match("]")||expect(","));return lex(),function(elements){const node=new ASTNode("ArrayExpression");return node.elements=elements,node}(elements)}function parseObjectPropertyKey(){index=lookahead.start;const token=lex();return 8===token.type||6===token.type?(token.octal&&throwError(token,"Octal literals are not allowed in strict mode."),finishLiteral(token)):finishIdentifier(token.value)}function parseObjectProperty(){var token,key,id;return index=lookahead.start,3===(token=lookahead).type?(id=parseObjectPropertyKey(),expect(":"),finishProperty("init",id,parseConditionalExpression())):2!==token.type&&7!==token.type?(key=parseObjectPropertyKey(),expect(":"),finishProperty("init",key,parseConditionalExpression())):void throwUnexpected(token)}function parseObjectInitialiser(){var property,key,properties=[],map={},toString=String;for(index=lookahead.start,expect("{");!match("}");)key="$"+("Identifier"===(property=parseObjectProperty()).key.type?property.key.name:toString(property.key.value)),Object.prototype.hasOwnProperty.call(map,key)?throwError({},"Duplicate data property in object literal not allowed in strict mode"):map[key]=!0,properties.push(property),match("}")||expect(",");return expect("}"),function(properties){const node=new ASTNode("ObjectExpression");return node.properties=properties,node}(properties)}const legalKeywords={if:1};function parsePrimaryExpression(){var type,token,expr;if(match("("))return function(){expect("(");const expr=parseExpression();return expect(")"),expr}();if(match("["))return parseArrayInitialiser();if(match("{"))return parseObjectInitialiser();if(type=lookahead.type,index=lookahead.start,3===type||legalKeywords[lookahead.value])expr=finishIdentifier(lex().value);else if(8===type||6===type)lookahead.octal&&throwError(lookahead,"Octal literals are not allowed in strict mode."),expr=finishLiteral(lex());else{if(4===type)throw new Error("Disabled.");1===type?((token=lex()).value="true"===token.value,expr=finishLiteral(token)):5===type?((token=lex()).value=null,expr=finishLiteral(token)):match("/")||match("/=")?(expr=finishLiteral(scanRegExp()),peek()):throwUnexpected(lex())}return expr}function parseArguments(){const args=[];if(expect("("),!match(")"))for(;index<length&&(args.push(parseConditionalExpression()),!match(")"));)expect(",");return expect(")"),args}function parseNonComputedMember(){return expect("."),function(){index=lookahead.start;const token=lex();return function(token){return 3===token.type||4===token.type||1===token.type||5===token.type}(token)||throwUnexpected(token),finishIdentifier(token.value)}()}function parseComputedMember(){expect("[");const expr=parseExpression();return expect("]"),expr}function parsePostfixExpression(){const expr=function(){var expr;for(expr=parsePrimaryExpression();;)if(match("."))expr=finishMemberExpression(".",expr,parseNonComputedMember());else if(match("("))expr=finishCallExpression(expr,parseArguments());else{if(!match("["))break;expr=finishMemberExpression("[",expr,parseComputedMember())}return expr}();if(7===lookahead.type&&(match("++")||match("--")))throw new Error("Disabled.");return expr}function parseUnaryExpression(){var token,expr;if(7!==lookahead.type&&4!==lookahead.type)expr=parsePostfixExpression();else{if(match("++")||match("--"))throw new Error("Disabled.");if(match("+")||match("-")||match("~")||match("!"))token=lex(),expr=parseUnaryExpression(),expr=function(operator,argument){const node=new ASTNode("UnaryExpression");return node.operator=operator,node.argument=argument,node.prefix=!0,node}(token.value,expr);else{if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof"))throw new Error("Disabled.");expr=parsePostfixExpression()}}return expr}function binaryPrecedence(token){let prec=0;if(7!==token.type&&4!==token.type)return 0;switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":prec=7;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11}return prec}function parseConditionalExpression(){var expr,consequent;return expr=function(){var marker,markers,expr,token,prec,stack,right,operator,left,i;if(marker=lookahead,left=parseUnaryExpression(),0===(prec=binaryPrecedence(token=lookahead)))return left;for(token.prec=prec,lex(),markers=[marker,lookahead],stack=[left,token,right=parseUnaryExpression()];(prec=binaryPrecedence(lookahead))>0;){for(;stack.length>2&&prec<=stack[stack.length-2].prec;)right=stack.pop(),operator=stack.pop().value,left=stack.pop(),markers.pop(),expr=finishBinaryExpression(operator,left,right),stack.push(expr);(token=lex()).prec=prec,stack.push(token),markers.push(lookahead),expr=parseUnaryExpression(),stack.push(expr)}for(expr=stack[i=stack.length-1],markers.pop();i>1;)markers.pop(),expr=finishBinaryExpression(stack[i-1].value,stack[i-2],expr),i-=2;return expr}(),match("?")&&(lex(),consequent=parseConditionalExpression(),expect(":"),expr=function(test,consequent,alternate){const node=new ASTNode("ConditionalExpression");return node.test=test,node.consequent=consequent,node.alternate=alternate,node}(expr,consequent,parseConditionalExpression())),expr}function parseExpression(){const expr=parseConditionalExpression();if(match(","))throw new Error("Disabled.");return expr}function getDependentFields(expression){const ast=function(code){index=0,length=(source=code).length,lookahead=null,peek();const expr=parseExpression();if(2!==lookahead.type)throw new Error("Unexpect token after expression.");return expr}(expression),dependents=new Set;return ast.visit(node=>{"MemberExpression"===node.type&&function startsWithDatum(node){return"MemberExpression"===node.object.type?startsWithDatum(node.object):"datum"===node.object.name}(node)&&dependents.add(function getName(node){const name=[];return"Identifier"===node.type?[node.name]:"Literal"===node.type?[node.value]:("MemberExpression"===node.type&&(name.push(...getName(node.object)),name.push(...getName(node.property))),name)}(node).slice(1).join("."))}),dependents}class FilterNode extends DataFlowNode{clone(){return new FilterNode(null,this.model,duplicate(this.filter))}constructor(parent,model,filter){super(parent),this.model=model,this.filter=filter,_defineProperty(this,"expr",void 0),_defineProperty(this,"_dependentFields",void 0),this.expr=expression(this.model,this.filter,this),this._dependentFields=getDependentFields(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter ".concat(this.expr)}}function parseSelectionPredicate(model,pred,dfnode,datum="datum"){const name=vegaUtil.isString(pred)?pred:pred.param,vname=varName(name),store=vegaUtil.stringValue(vname+STORE);let selCmpt;try{selCmpt=model.getSelectionComponent(vname,name)}catch(e){return"!!".concat(vname)}if(selCmpt.project.timeUnit){const child=null!=dfnode?dfnode:model.component.data.raw,tunode=selCmpt.project.timeUnit.clone();child.parent?tunode.insertAsParentOf(child):child.parent=tunode}const test="vlSelectionTest(".concat(store,", ").concat(datum)+("global"===selCmpt.resolve?")":", ".concat(vegaUtil.stringValue(selCmpt.resolve),")")),length="length(data(".concat(store,"))");return!1===pred.empty?"".concat(length," && ").concat(test):"!".concat(length," || ").concat(test)}function parseSelectionExtent(model,name,extent){const vname=varName(name),encoding=extent.encoding;let selCmpt,field=extent.field;try{selCmpt=model.getSelectionComponent(vname,name)}catch(e){return vname}if(encoding||field){if(encoding&&!field){const encodings=selCmpt.project.items.filter(p=>p.channel===encoding);!encodings.length||encodings.length>1?(field=selCmpt.project.items[0].field,warn((encodings.length?"Multiple ":"No ")+"matching ".concat(vegaUtil.stringValue(encoding)," encoding found for selection ").concat(vegaUtil.stringValue(extent.param),". ")+'Using "field": '.concat(vegaUtil.stringValue(field),"."))):field=encodings[0].field}}else field=selCmpt.project.items[0].field,selCmpt.project.items.length>1&&warn('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(vegaUtil.stringValue(field),"."));return"".concat(selCmpt.name,"[").concat(vegaUtil.stringValue(replacePathInField(field)),"]")}function expression(model,filterOp,node){return logicalExpr(filterOp,predicate=>vegaUtil.isString(predicate)?predicate:function(predicate){return null==predicate?void 0:predicate.param}(predicate)?parseSelectionPredicate(model,predicate,node):fieldFilterExpression(predicate))}function setAxisEncode(axis,part,vgProp,vgRef){var _axis$encode,_axis$encode2,_axis$encode2$part,_axis$encode$part,_axis$encode$part$upd;null!==(_axis$encode=axis.encode)&&void 0!==_axis$encode||(axis.encode={}),null!==(_axis$encode2$part=(_axis$encode2=axis.encode)[part])&&void 0!==_axis$encode2$part||(_axis$encode2[part]={}),null!==(_axis$encode$part$upd=(_axis$encode$part=axis.encode[part]).update)&&void 0!==_axis$encode$part$upd||(_axis$encode$part.update={}),axis.encode[part].update[vgProp]=vgRef}function assembleAxis(axisCmpt,kind,config,opt={header:!1}){const{disable:disable,orient:orient,scale:scale,labelExpr:labelExpr,title:title,zindex:zindex,...axis}=axisCmpt.combine();if(!disable){for(const prop in axis){const propType=AXIS_PROPERTY_TYPE[prop],propValue=axis[prop];if(propType&&propType!==kind&&"both"!==propType)delete axis[prop];else if(isConditionalAxisValue(propValue)){const{condition:condition,...valueOrSignalRef}=propValue,conditions=vegaUtil.array(condition),propIndex=CONDITIONAL_AXIS_PROP_INDEX[prop];if(propIndex){const{vgProp:vgProp,part:part}=propIndex;setAxisEncode(axis,part,vgProp,[...conditions.map(c=>{const{test:test,...valueOrSignalCRef}=c;return{test:expression(null,test),...valueOrSignalCRef}}),valueOrSignalRef]),delete axis[prop]}else if(null===propIndex){const signalRef={signal:conditions.map(c=>{const{test:test,...valueOrSignalCRef}=c;return"".concat(expression(null,test)," ? ").concat(exprFromValueOrSignalRef(valueOrSignalCRef)," : ")}).join("")+exprFromValueOrSignalRef(valueOrSignalRef)};axis[prop]=signalRef}}else if(isSignalRef(propValue)){const propIndex=CONDITIONAL_AXIS_PROP_INDEX[prop];if(propIndex){const{vgProp:vgProp,part:part}=propIndex;setAxisEncode(axis,part,vgProp,propValue),delete axis[prop]}}contains(["labelAlign","labelBaseline"],prop)&&null===axis[prop]&&delete axis[prop]}if("grid"===kind){if(!axis.grid)return;if(axis.encode){const{grid:grid}=axis.encode;axis.encode={...grid?{grid:grid}:{}},isEmpty(axis.encode)&&delete axis.encode}return{scale:scale,orient:orient,...axis,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:getFirstDefined(zindex,0)}}{if(!opt.header&&axisCmpt.mainExtracted)return;if(void 0!==labelExpr){var _axis$encode3,_axis$encode3$labels;let expr=labelExpr;null!==(_axis$encode3=axis.encode)&&void 0!==_axis$encode3&&null!==(_axis$encode3$labels=_axis$encode3.labels)&&void 0!==_axis$encode3$labels&&_axis$encode3$labels.update&&isSignalRef(axis.encode.labels.update.text)&&(expr=replaceAll(labelExpr,"datum.label",axis.encode.labels.update.text.signal)),setAxisEncode(axis,"labels","text",{signal:expr})}if(null===axis.labelAlign&&delete axis.labelAlign,axis.encode){for(const part of AXIS_PARTS)axisCmpt.hasAxisPart(part)||delete axis.encode[part];isEmpty(axis.encode)&&delete axis.encode}const titleString=function(title,config){if(title)return vegaUtil.isArray(title)&&!isText(title)?title.map(fieldDef=>defaultTitle(fieldDef,config)).join(", "):title}(title,config);return{scale:scale,orient:orient,grid:!1,...titleString?{title:titleString}:{},...axis,...!1===config.aria?{aria:!1}:{},zindex:getFirstDefined(zindex,0)}}}}function assembleAxisSignals(model){const{axes:axes}=model.component,signals=[];for(const channel of POSITION_SCALE_CHANNELS)if(axes[channel])for(const axis of axes[channel])if(!axis.get("disable")&&!axis.get("gridScale")){const sizeType="x"===channel?"height":"width",update=model.getSizeSignalRef(sizeType).signal;sizeType!==update&&signals.push({name:sizeType,update:update})}return signals}function getAxisConfigFromConfigTypes(configTypes,config,channel,orient){return Object.assign.apply(null,[{},...configTypes.map(configType=>{if("axisOrient"===configType){const orient1="x"===channel?"bottom":"left",orientConfig1=config["x"===channel?"axisBottom":"axisLeft"]||{},orientConfig2=config["x"===channel?"axisTop":"axisRight"]||{},props=new Set([...keys(orientConfig1),...keys(orientConfig2)]),conditionalOrientAxisConfig={};for(const prop of props.values())conditionalOrientAxisConfig[prop]={signal:"".concat(orient.signal,' === "').concat(orient1,'" ? ').concat(signalOrStringValue(orientConfig1[prop])," : ").concat(signalOrStringValue(orientConfig2[prop]))};return conditionalOrientAxisConfig}return config[configType]})])}function getAxisConfigs(channel,scaleType,orient,config){const typeBasedConfigTypes="band"===scaleType?["axisDiscrete","axisBand"]:"point"===scaleType?["axisDiscrete","axisPoint"]:function(type){return type in QUANTITATIVE_SCALES_INDEX}(scaleType)?["axisQuantitative"]:"time"===scaleType||"utc"===scaleType?["axisTemporal"]:[],axisChannel="x"===channel?"axisX":"axisY",axisOrient=isSignalRef(orient)?"axisOrient":"axis".concat(titleCase(orient)),vlOnlyConfigTypes=[...typeBasedConfigTypes,...typeBasedConfigTypes.map(c=>axisChannel+c.substr(4))],vgConfigTypes=["axis",axisOrient,axisChannel];return{vlOnlyAxisConfig:getAxisConfigFromConfigTypes(vlOnlyConfigTypes,config,channel,orient),vgAxisConfig:getAxisConfigFromConfigTypes(vgConfigTypes,config,channel,orient),axisConfigStyle:getAxisConfigStyle([...vgConfigTypes,...vlOnlyConfigTypes],config)}}function getAxisConfigStyle(axisConfigTypes,config){const toMerge=[{}];for(const configType of axisConfigTypes){var _config$configType;let style=null===(_config$configType=config[configType])||void 0===_config$configType?void 0:_config$configType.style;if(style){style=vegaUtil.array(style);for(const s of style)toMerge.push(config.style[s])}}return Object.assign.apply(null,toMerge)}function getAxisConfig(property,styleConfigIndex,style,axisConfigs={}){const styleConfig=getStyleConfig(property,style,styleConfigIndex);if(void 0!==styleConfig)return{configFrom:"style",configValue:styleConfig};for(const configFrom of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"]){var _axisConfigs$configFr;if(void 0!==(null===(_axisConfigs$configFr=axisConfigs[configFrom])||void 0===_axisConfigs$configFr?void 0:_axisConfigs$configFr[property]))return{configFrom:configFrom,configValue:axisConfigs[configFrom][property]}}return{}}const axisRules={scale:({model:model,channel:channel})=>model.scaleName(channel),format:({fieldOrDatumDef:fieldOrDatumDef,config:config,axis:axis})=>{const{format:format,formatType:formatType}=axis;return guideFormat(fieldOrDatumDef,fieldOrDatumDef.type,format,formatType,config,!0)},formatType:({axis:axis,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType})=>{const{formatType:formatType}=axis;return guideFormatType(formatType,fieldOrDatumDef,scaleType)},grid:({fieldOrDatumDef:fieldOrDatumDef,axis:axis,scaleType:scaleType})=>{var _axis$grid;return null!==(_axis$grid=axis.grid)&&void 0!==_axis$grid?_axis$grid:function(scaleType,fieldDef){return!hasDiscreteDomain(scaleType)&&isFieldDef(fieldDef)&&!isBinning(null==fieldDef?void 0:fieldDef.bin)&&!isBinned(null==fieldDef?void 0:fieldDef.bin)}(scaleType,fieldOrDatumDef)},gridScale:({model:model,channel:channel})=>function(model,channel){const gridChannel="x"===channel?"y":"x";if(model.getScaleComponent(gridChannel))return model.scaleName(gridChannel)}(model,channel),labelAlign:({axis:axis,labelAngle:labelAngle,orient:orient,channel:channel})=>axis.labelAlign||defaultLabelAlign(labelAngle,orient,channel),labelAngle:({labelAngle:labelAngle})=>labelAngle,labelBaseline:({axis:axis,labelAngle:labelAngle,orient:orient,channel:channel})=>axis.labelBaseline||defaultLabelBaseline(labelAngle,orient,channel),labelFlush:({axis:axis,fieldOrDatumDef:fieldOrDatumDef,channel:channel})=>{var _axis$labelFlush;return null!==(_axis$labelFlush=axis.labelFlush)&&void 0!==_axis$labelFlush?_axis$labelFlush:function(type,channel){if("x"===channel&&contains(["quantitative","temporal"],type))return!0}(fieldOrDatumDef.type,channel)},labelOverlap:({axis:axis,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType})=>{var _axis$labelOverlap;return null!==(_axis$labelOverlap=axis.labelOverlap)&&void 0!==_axis$labelOverlap?_axis$labelOverlap:function(type,scaleType,hasTimeUnit,sort){if(hasTimeUnit&&!vegaUtil.isObject(sort)||"nominal"!==type&&"ordinal"!==type)return"log"!==scaleType&&"symlog"!==scaleType||"greedy"}(fieldOrDatumDef.type,scaleType,isFieldDef(fieldOrDatumDef)&&!!fieldOrDatumDef.timeUnit,isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.sort:void 0)},orient:({orient:orient})=>orient,tickCount:({channel:channel,model:model,axis:axis,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType})=>{var _axis$tickCount;const sizeType="x"===channel?"width":"y"===channel?"height":void 0,size=sizeType?model.getSizeSignalRef(sizeType):void 0;return null!==(_axis$tickCount=axis.tickCount)&&void 0!==_axis$tickCount?_axis$tickCount:function({fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType,size:size,values:vals}){if(!vals&&!hasDiscreteDomain(scaleType)&&"log"!==scaleType){if(isFieldDef(fieldOrDatumDef)){var _normalizeTimeUnit;if(isBinning(fieldOrDatumDef.bin))return{signal:"ceil(".concat(size.signal,"/10)")};if(fieldOrDatumDef.timeUnit&&contains(["month","hours","day","quarter"],null===(_normalizeTimeUnit=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit))return}return{signal:"ceil(".concat(size.signal,"/40)")}}}({fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType,size:size,values:axis.values})},title:({axis:axis,model:model,channel:channel})=>{if(void 0!==axis.title)return axis.title;const fieldDefTitle=getFieldDefTitle(model,channel);if(void 0!==fieldDefTitle)return fieldDefTitle;const fieldDef=model.typedFieldDef(channel),channel2="x"===channel?"x2":"y2",fieldDef2=model.fieldDef(channel2);return mergeTitleFieldDefs(fieldDef?[toFieldDefBase(fieldDef)]:[],isFieldDef(fieldDef2)?[toFieldDefBase(fieldDef2)]:[])},values:({axis:axis,fieldOrDatumDef:fieldOrDatumDef})=>function(axis,fieldOrDatumDef){const vals=axis.values;return vegaUtil.isArray(vals)?valueArray(fieldOrDatumDef,vals):isSignalRef(vals)?vals:void 0}(axis,fieldOrDatumDef),zindex:({axis:axis,fieldOrDatumDef:fieldOrDatumDef,mark:mark})=>{var _axis$zindex;return null!==(_axis$zindex=axis.zindex)&&void 0!==_axis$zindex?_axis$zindex:function(mark,fieldDef){return"rect"===mark&&isDiscrete(fieldDef)?1:0}(mark,fieldOrDatumDef)}};function normalizeAngleExpr(angle){return"(((".concat(angle.signal," % 360) + 360) % 360)")}function defaultLabelBaseline(angle,orient,channel,alwaysIncludeMiddle){if(void 0!==angle){if("x"===channel){if(isSignalRef(angle)){const a=normalizeAngleExpr(angle),orientIsTop=isSignalRef(orient)?"(".concat(orient.signal,' === "top")'):"top"===orient;return{signal:"(45 < ".concat(a," && ").concat(a," < 135) || (225 < ").concat(a," && ").concat(a,' < 315) ? "middle" :')+"(".concat(a," <= 45 || 315 <= ").concat(a,") === ").concat(orientIsTop,' ? "bottom" : "top"')}}if(45<angle&&angle<135||225<angle&&angle<315)return"middle";if(isSignalRef(orient)){const op=angle<=45||315<=angle?"===":"!==";return{signal:"".concat(orient.signal," ").concat(op,' "top" ? "bottom" : "top"')}}return(angle<=45||315<=angle)==("top"===orient)?"bottom":"top"}if(isSignalRef(angle)){const a=normalizeAngleExpr(angle),orientIsLeft=isSignalRef(orient)?"(".concat(orient.signal,' === "left")'):"left"===orient,middle=alwaysIncludeMiddle?'"middle"':"null";return{signal:"".concat(a," <= 45 || 315 <= ").concat(a," || (135 <= ").concat(a," && ").concat(a," <= 225) ? ").concat(middle," : (45 <= ").concat(a," && ").concat(a," <= 135) === ").concat(orientIsLeft,' ? "top" : "bottom"')}}if(angle<=45||315<=angle||135<=angle&&angle<=225)return alwaysIncludeMiddle?"middle":null;if(isSignalRef(orient)){const op=45<=angle&&angle<=135?"===":"!==";return{signal:"".concat(orient.signal," ").concat(op,' "left" ? "top" : "bottom"')}}return(45<=angle&&angle<=135)==("left"===orient)?"top":"bottom"}}function defaultLabelAlign(angle,orient,channel){if(void 0===angle)return;const isX="x"===channel,startAngle=isX?0:90,mainOrient=isX?"bottom":"left";if(isSignalRef(angle)){const a=normalizeAngleExpr(angle),orientIsMain=isSignalRef(orient)?"(".concat(orient.signal,' === "').concat(mainOrient,'")'):orient===mainOrient;return{signal:"(".concat(startAngle?"(".concat(a," + 90)"):a," % 180 === 0) ? ").concat(isX?null:'"center"'," :")+"(".concat(startAngle," < ").concat(a," && ").concat(a," < ").concat(180+startAngle,") === ").concat(orientIsMain,' ? "left" : "right"')}}if((angle+startAngle)%180==0)return isX?null:"center";if(isSignalRef(orient)){const op=startAngle<angle&&angle<180+startAngle?"===":"!==",orientIsMain="".concat(orient.signal," ").concat(op,' "').concat(mainOrient,'"');return{signal:"".concat(orientIsMain,' ? "left" : "right"')}}return(startAngle<angle&&angle<180+startAngle)==(orient===mainOrient)?"left":"right"}function getFieldDefTitle(model,channel){const channel2="x"===channel?"x2":"y2",fieldDef=model.fieldDef(channel),fieldDef2=model.fieldDef(channel2),title1=fieldDef?fieldDef.title:void 0,title2=fieldDef2?fieldDef2.title:void 0;return title1&&title2?mergeTitle(title1,title2):title1||title2||(void 0!==title1?title1:void 0!==title2?title2:void 0)}class CalculateNode extends DataFlowNode{clone(){return new CalculateNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform,_defineProperty(this,"_dependentFields",void 0),this._dependentFields=getDependentFields(this.transform.calculate)}static parseAllForSortIndex(parent,model){return model.forEachFieldDef((fieldDef,channel)=>{if(isScaleFieldDef(fieldDef)&&isSortArray(fieldDef.sort)){const{field:field,timeUnit:timeUnit}=fieldDef,sort=fieldDef.sort,calculate=sort.map((sortValue,i)=>"".concat(fieldFilterExpression({field:field,timeUnit:timeUnit,equal:sortValue})," ? ").concat(i," : ")).join("")+sort.length;parent=new CalculateNode(parent,{calculate:calculate,as:sortArrayIndexField(fieldDef,channel,{forAs:!0})})}}),parent}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate ".concat(hash(this.transform))}}function sortArrayIndexField(fieldDef,channel,opt){return vgField(fieldDef,{prefix:channel,suffix:"sort_index",...null!=opt?opt:{}})}function getHeaderChannel(channel,orient){return contains(["top","bottom"],orient)?"column":contains(["left","right"],orient)||"row"===channel?"row":"column"}function getHeaderProperty(prop,header,config,channel){const headerSpecificConfig="row"===channel?config.headerRow:"column"===channel?config.headerColumn:config.headerFacet;return getFirstDefined((header||{})[prop],headerSpecificConfig[prop],config.header[prop])}function getHeaderProperties(properties,header,config,channel){const props={};for(const prop of properties){const value=getHeaderProperty(prop,header||{},config,channel);void 0!==value&&(props[prop]=value)}return props}const HEADER_CHANNELS=["row","column"],HEADER_TYPES=["header","footer"];function assembleTitleGroup(model,channel){const title=model.component.layoutHeaders[channel].title,config=model.config?model.config:void 0,facetFieldDef=model.component.layoutHeaders[channel].facetFieldDef?model.component.layoutHeaders[channel].facetFieldDef:void 0,{titleAnchor:titleAnchor,titleAngle:ta,titleOrient:titleOrient}=getHeaderProperties(["titleAnchor","titleAngle","titleOrient"],facetFieldDef.header,config,channel),headerChannel=getHeaderChannel(channel,titleOrient),titleAngle=normalizeAngle(ta);return{name:"".concat(channel,"-title"),type:"group",role:"".concat(headerChannel,"-title"),title:{text:title,..."row"===channel?{orient:"left"}:{},style:"guide-title",...defaultHeaderGuideBaseline(titleAngle,headerChannel),...defaultHeaderGuideAlign(headerChannel,titleAngle,titleAnchor),...assembleHeaderProperties(config,facetFieldDef,channel,HEADER_TITLE_PROPERTIES,HEADER_TITLE_PROPERTIES_MAP)}}}function defaultHeaderGuideAlign(headerChannel,angle,anchor="middle"){switch(anchor){case"start":return{align:"left"};case"end":return{align:"right"}}const align=defaultLabelAlign(angle,"row"===headerChannel?"left":"top","row"===headerChannel?"y":"x");return align?{align:align}:{}}function defaultHeaderGuideBaseline(angle,channel){const baseline=defaultLabelBaseline(angle,"row"===channel?"left":"top","row"===channel?"y":"x",!0);return baseline?{baseline:baseline}:{}}function assembleHeaderGroups(model,channel){const layoutHeader=model.component.layoutHeaders[channel],groups=[];for(const headerType of HEADER_TYPES)if(layoutHeader[headerType])for(const headerComponent of layoutHeader[headerType]){const group=assembleHeaderGroup(model,channel,headerType,layoutHeader,headerComponent);null!=group&&groups.push(group)}return groups}function getSort(facetFieldDef,channel){const{sort:sort}=facetFieldDef;var _sort$order;return isSortField(sort)?{field:vgField(sort,{expr:"datum"}),order:null!==(_sort$order=sort.order)&&void 0!==_sort$order?_sort$order:"ascending"}:vegaUtil.isArray(sort)?{field:sortArrayIndexField(facetFieldDef,channel,{expr:"datum"}),order:"ascending"}:{field:vgField(facetFieldDef,{expr:"datum"}),order:null!=sort?sort:"ascending"}}function assembleLabelTitle(facetFieldDef,channel,config){const{format:format,formatType:formatType,labelAngle:labelAngle,labelAnchor:labelAnchor,labelOrient:labelOrient,labelExpr:labelExpr}=getHeaderProperties(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],facetFieldDef.header,config,channel),titleTextExpr=formatSignalRef({fieldOrDatumDef:facetFieldDef,format:format,formatType:formatType,expr:"parent",config:config}).signal,headerChannel=getHeaderChannel(channel,labelOrient);return{text:{signal:labelExpr?replaceAll(replaceAll(labelExpr,"datum.label",titleTextExpr),"datum.value",vgField(facetFieldDef,{expr:"parent"})):titleTextExpr},..."row"===channel?{orient:"left"}:{},style:"guide-label",frame:"group",...defaultHeaderGuideBaseline(labelAngle,headerChannel),...defaultHeaderGuideAlign(headerChannel,labelAngle,labelAnchor),...assembleHeaderProperties(config,facetFieldDef,channel,HEADER_LABEL_PROPERTIES,HEADER_LABEL_PROPERTIES_MAP)}}function assembleHeaderGroup(model,channel,headerType,layoutHeader,headerComponent){if(headerComponent){let title=null;const{facetFieldDef:facetFieldDef}=layoutHeader,config=model.config?model.config:void 0;if(facetFieldDef&&headerComponent.labels){const{labelOrient:labelOrient}=getHeaderProperties(["labelOrient"],facetFieldDef.header,config,channel);("row"===channel&&!contains(["top","bottom"],labelOrient)||"column"===channel&&!contains(["left","right"],labelOrient))&&(title=assembleLabelTitle(facetFieldDef,channel,config))}const isFacetWithoutRowCol=isFacetModel(model)&&!isFacetMapping(model.facet),axes=headerComponent.axes,hasAxes=(null==axes?void 0:axes.length)>0;if(title||hasAxes){const sizeChannel="row"===channel?"height":"width";return{name:model.getName("".concat(channel,"_").concat(headerType)),type:"group",role:"".concat(channel,"-").concat(headerType),...layoutHeader.facetFieldDef?{from:{data:model.getName("".concat(channel,"_domain"))},sort:getSort(facetFieldDef,channel)}:{},...hasAxes&&isFacetWithoutRowCol?{from:{data:model.getName("facet_domain_".concat(channel))}}:{},...title?{title:title}:{},...headerComponent.sizeSignal?{encode:{update:{[sizeChannel]:headerComponent.sizeSignal}}}:{},...hasAxes?{axes:axes}:{}}}}return null}const LAYOUT_TITLE_BAND={column:{start:0,end:1},row:{start:1,end:0}};function getLayoutTitleBand(titleAnchor,headerChannel){return LAYOUT_TITLE_BAND[headerChannel][titleAnchor]}function assembleHeaderProperties(config,facetFieldDef,channel,properties,propertiesMap){const props={};for(const prop of properties){if(!propertiesMap[prop])continue;const value=getHeaderProperty(prop,null==facetFieldDef?void 0:facetFieldDef.header,config,channel);void 0!==value&&(props[propertiesMap[prop]]=value)}return props}function assembleLayoutSignals(model){return[...sizeSignals(model,"width"),...sizeSignals(model,"height"),...sizeSignals(model,"childWidth"),...sizeSignals(model,"childHeight")]}function sizeSignals(model,sizeType){const channel="width"===sizeType?"x":"y",size=model.component.layoutSize.get(sizeType);if(!size||"merged"===size)return[];const name=model.getSizeSignalRef(sizeType).signal;if("step"===size){const scaleComponent=model.getScaleComponent(channel);if(scaleComponent){const type=scaleComponent.get("type"),range=scaleComponent.get("range");if(hasDiscreteDomain(type)&&isVgRangeStep(range)){const scaleName=model.scaleName(channel);return isFacetModel(model.parent)&&"independent"===model.parent.component.resolve.scale[channel]?[stepSignal(scaleName,range)]:[stepSignal(scaleName,range),{name:name,update:sizeExpr(scaleName,scaleComponent,"domain('".concat(scaleName,"').length"))}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==size){const isWidth=name.endsWith("width"),expr=isWidth?"containerSize()[0]":"containerSize()[1]",defaultValue=getViewConfigContinuousSize(model.config.view,isWidth?"width":"height"),safeExpr="isFinite(".concat(expr,") ? ").concat(expr," : ").concat(defaultValue);return[{name:name,init:safeExpr,on:[{update:safeExpr,events:"window:resize"}]}]}return[{name:name,value:size}]}function stepSignal(scaleName,range){return{name:"".concat(scaleName,"_step"),value:range.step}}function sizeExpr(scaleName,scaleComponent,cardinality){const type=scaleComponent.get("type"),padding=scaleComponent.get("padding"),paddingOuter=getFirstDefined(scaleComponent.get("paddingOuter"),padding);let paddingInner=scaleComponent.get("paddingInner");return paddingInner="band"===type?void 0!==paddingInner?paddingInner:padding:1,"bandspace(".concat(cardinality,", ").concat(signalOrStringValue(paddingInner),", ").concat(signalOrStringValue(paddingOuter),") * ").concat(scaleName,"_step")}function getSizeTypeFromLayoutSizeType(layoutSizeType){return"childWidth"===layoutSizeType?"width":"childHeight"===layoutSizeType?"height":layoutSizeType}function guideEncodeEntry(encoding,model){return keys(encoding).reduce((encode,channel)=>{const valueDef=encoding[channel];return{...encode,...wrapCondition(model,valueDef,channel,def=>signalOrValueRef(def.value))}},{})}function defaultScaleResolve(channel,model){if(isLayerModel(model)||isFacetModel(model))return"shared";if(isConcatModel(model))return isXorY(channel)?"independent":"shared";throw new Error("invalid model type for resolve")}function parseGuideResolve(resolve,channel){const channelScaleResolve=resolve.scale[channel],guide=isXorY(channel)?"axis":"legend";return"independent"===channelScaleResolve?("shared"===resolve[guide][channel]&&warn(function(channel){return'Setting the scale to be independent for "'.concat(channel,'" means we also have to set the guide (axis or legend) to be independent.')}(channel)),"independent"):resolve[guide][channel]||"shared"}const LEGEND_COMPONENT_PROPERTY_INDEX={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},LEGEND_COMPONENT_PROPERTIES=keys(LEGEND_COMPONENT_PROPERTY_INDEX);class LegendComponent extends Split{}const legendEncodeRules={symbols:function(symbolsSpec,{fieldOrDatumDef:fieldOrDatumDef,model:model,channel:channel,legendCmpt:legendCmpt,legendType:legendType}){var _legendCmpt$get,_legendCmpt$get2,_legendCmpt$get3,_getMaxValue;if("symbol"!==legendType)return;const{markDef:markDef,encoding:encoding,config:config,mark:mark}=model,filled=markDef.filled&&"trail"!==mark;let out={...applyMarkConfig({},model,FILL_STROKE_CONFIG),...color(model,{filled:filled})};const symbolOpacity=null!==(_legendCmpt$get=legendCmpt.get("symbolOpacity"))&&void 0!==_legendCmpt$get?_legendCmpt$get:config.legend.symbolOpacity,symbolFillColor=null!==(_legendCmpt$get2=legendCmpt.get("symbolFillColor"))&&void 0!==_legendCmpt$get2?_legendCmpt$get2:config.legend.symbolFillColor,symbolStrokeColor=null!==(_legendCmpt$get3=legendCmpt.get("symbolStrokeColor"))&&void 0!==_legendCmpt$get3?_legendCmpt$get3:config.legend.symbolStrokeColor,opacity=void 0===symbolOpacity?null!==(_getMaxValue=getMaxValue(encoding.opacity))&&void 0!==_getMaxValue?_getMaxValue:markDef.opacity:void 0;var _config$legend$symbol;if(out.fill)if("fill"===channel||filled&&channel===COLOR)delete out.fill;else if(out.fill.field)symbolFillColor?delete out.fill:(out.fill=signalOrValueRef(null!==(_config$legend$symbol=config.legend.symbolBaseFillColor)&&void 0!==_config$legend$symbol?_config$legend$symbol:"black"),out.fillOpacity=signalOrValueRef(null!=opacity?opacity:1));else if(vegaUtil.isArray(out.fill)){var _ref,_getFirstConditionVal,_encoding$fill;const fill=null!==(_ref=null!==(_getFirstConditionVal=getFirstConditionValue(null!==(_encoding$fill=encoding.fill)&&void 0!==_encoding$fill?_encoding$fill:encoding.color))&&void 0!==_getFirstConditionVal?_getFirstConditionVal:markDef.fill)&&void 0!==_ref?_ref:filled&&markDef.color;fill&&(out.fill=signalOrValueRef(fill))}if(out.stroke)if("stroke"===channel||!filled&&channel===COLOR)delete out.stroke;else if(out.stroke.field||symbolStrokeColor)delete out.stroke;else if(vegaUtil.isArray(out.stroke)){const stroke=getFirstDefined(getFirstConditionValue(encoding.stroke||encoding.color),markDef.stroke,filled?markDef.color:void 0);stroke&&(out.stroke={value:stroke})}if("opacity"!==channel){const condition=isFieldDef(fieldOrDatumDef)&&selectedCondition(0,legendCmpt,fieldOrDatumDef);condition?out.opacity=[{test:condition,...signalOrValueRef(null!=opacity?opacity:1)},signalOrValueRef(config.legend.unselectedOpacity)]:opacity&&(out.opacity=signalOrValueRef(opacity))}return out={...out,...symbolsSpec},isEmpty(out)?void 0:out},gradient:function(gradientSpec,{model:model,legendType:legendType,legendCmpt:legendCmpt}){var _legendCmpt$get4;if("gradient"!==legendType)return;const{config:config,markDef:markDef,encoding:encoding}=model;let out={};const opacity=void 0===(null!==(_legendCmpt$get4=legendCmpt.get("gradientOpacity"))&&void 0!==_legendCmpt$get4?_legendCmpt$get4:config.legend.gradientOpacity)?getMaxValue(encoding.opacity)||markDef.opacity:void 0;return opacity&&(out.opacity=signalOrValueRef(opacity)),out={...out,...gradientSpec},isEmpty(out)?void 0:out},labels:function(specifiedlabelsSpec,{fieldOrDatumDef:fieldOrDatumDef,model:model,channel:channel,legendCmpt:legendCmpt}){const legend=model.legend(channel)||{},config=model.config,condition=isFieldDef(fieldOrDatumDef)?selectedCondition(0,legendCmpt,fieldOrDatumDef):void 0,opacity=condition?[{test:condition,value:1},{value:config.legend.unselectedOpacity}]:void 0,{format:format,formatType:formatType}=legend,text=isCustomFormatType(formatType)?formatCustomType({fieldOrDatumDef:fieldOrDatumDef,field:"datum.value",format:format,formatType:formatType,config:config}):void 0,labelsSpec={...opacity?{opacity:opacity}:{},...text?{text:text}:{},...specifiedlabelsSpec};return isEmpty(labelsSpec)?void 0:labelsSpec},entries:function(entriesSpec,{legendCmpt:legendCmpt}){const selections=legendCmpt.get("selections");return null!=selections&&selections.length?{...entriesSpec,fill:{value:"transparent"}}:entriesSpec}};function getMaxValue(channelDef){return getConditionValue(channelDef,(v,conditionalDef)=>Math.max(v,conditionalDef.value))}function getFirstConditionValue(channelDef){return getConditionValue(channelDef,(v,conditionalDef)=>getFirstDefined(v,conditionalDef.value))}function getConditionValue(channelDef,reducer){return function(channelDef){const condition=channelDef&&channelDef.condition;return!!condition&&(vegaUtil.isArray(condition)||isValueDef(condition))}(channelDef)?vegaUtil.array(channelDef.condition).reduce(reducer,channelDef.value):isValueDef(channelDef)?channelDef.value:void 0}function selectedCondition(model,legendCmpt,fieldDef){const selections=legendCmpt.get("selections");if(null==selections||!selections.length)return;const field=vegaUtil.stringValue(fieldDef.field);return selections.map(name=>{const store=vegaUtil.stringValue(varName(name)+STORE);return"(!length(data(".concat(store,")) || (").concat(name,"[").concat(field,"] && indexof(").concat(name,"[").concat(field,"], datum.value) >= 0))")}).join(" || ")}const legendRules={direction:({direction:direction})=>direction,format:({fieldOrDatumDef:fieldOrDatumDef,legend:legend,config:config})=>{const{format:format,formatType:formatType}=legend;return guideFormat(fieldOrDatumDef,fieldOrDatumDef.type,format,formatType,config,!1)},formatType:({legend:legend,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType})=>{const{formatType:formatType}=legend;return guideFormatType(formatType,fieldOrDatumDef,scaleType)},gradientLength:params=>{var _ref,_legend$gradientLengt;const{legend:legend,legendConfig:legendConfig}=params;return null!==(_ref=null!==(_legend$gradientLengt=legend.gradientLength)&&void 0!==_legend$gradientLengt?_legend$gradientLengt:legendConfig.gradientLength)&&void 0!==_ref?_ref:function({legendConfig:legendConfig,model:model,direction:direction,orient:orient,scaleType:scaleType}){const{gradientHorizontalMaxLength:gradientHorizontalMaxLength,gradientHorizontalMinLength:gradientHorizontalMinLength,gradientVerticalMaxLength:gradientVerticalMaxLength,gradientVerticalMinLength:gradientVerticalMinLength}=legendConfig;if(isContinuousToContinuous(scaleType))return"horizontal"===direction?"top"===orient||"bottom"===orient?gradientLengthSignal(model,"width",gradientHorizontalMinLength,gradientHorizontalMaxLength):gradientHorizontalMinLength:gradientLengthSignal(model,"height",gradientVerticalMinLength,gradientVerticalMaxLength)}(params)},labelOverlap:({legend:legend,legendConfig:legendConfig,scaleType:scaleType})=>{var _ref2,_legend$labelOverlap;return null!==(_ref2=null!==(_legend$labelOverlap=legend.labelOverlap)&&void 0!==_legend$labelOverlap?_legend$labelOverlap:legendConfig.labelOverlap)&&void 0!==_ref2?_ref2:function(scaleType){if(contains(["quantile","threshold","log","symlog"],scaleType))return"greedy"}(scaleType)},symbolType:({legend:legend,markDef:markDef,channel:channel,encoding:encoding})=>{var _legend$symbolType;return null!==(_legend$symbolType=legend.symbolType)&&void 0!==_legend$symbolType?_legend$symbolType:function(mark,channel,shapeChannelDef,markShape){if("shape"!==channel){var _getFirstConditionVal;const shape=null!==(_getFirstConditionVal=getFirstConditionValue(shapeChannelDef))&&void 0!==_getFirstConditionVal?_getFirstConditionVal:markShape;if(shape)return shape}switch(mark){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(markDef.type,channel,encoding.shape,markDef.shape)},title:({fieldOrDatumDef:fieldOrDatumDef,config:config})=>title(fieldOrDatumDef,config,{allowDisabling:!0}),type:({legendType:legendType,scaleType:scaleType,channel:channel})=>{if(isColorChannel(channel)&&isContinuousToContinuous(scaleType)){if("gradient"===legendType)return}else if("symbol"===legendType)return;return legendType},values:({fieldOrDatumDef:fieldOrDatumDef,legend:legend})=>function(legend,fieldOrDatumDef){const vals=legend.values;return vegaUtil.isArray(vals)?valueArray(fieldOrDatumDef,vals):isSignalRef(vals)?vals:void 0}(legend,fieldOrDatumDef)};function getLegendType(params){const{legend:legend}=params;return getFirstDefined(legend.type,function({channel:channel,timeUnit:timeUnit,scaleType:scaleType}){if(isColorChannel(channel)){if(contains(["quarter","month","day"],timeUnit))return"symbol";if(isContinuousToContinuous(scaleType))return"gradient"}return"symbol"}(params))}function getDirection({legendConfig:legendConfig,legendType:legendType,orient:orient,legend:legend}){var _ref3,_legend$direction;return null!==(_ref3=null!==(_legend$direction=legend.direction)&&void 0!==_legend$direction?_legend$direction:legendConfig[legendType?"gradientDirection":"symbolDirection"])&&void 0!==_ref3?_ref3:function(orient,legendType){switch(orient){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===legendType?"horizontal":void 0}}(orient,legendType)}function gradientLengthSignal(model,sizeType,min,max){const sizeSignal=model.getSizeSignalRef(sizeType).signal;return{signal:"clamp(".concat(sizeSignal,", ").concat(min,", ").concat(max,")")}}function parseLegend(model){const legendComponent=isUnitModel(model)?function(model){const{encoding:encoding}=model,legendComponent={};for(const channel of[COLOR,...LEGEND_SCALE_CHANNELS]){const def=getFieldOrDatumDef(encoding[channel]);def&&model.getScaleComponent(channel)&&(channel===SHAPE&&isFieldDef(def)&&def.type===GEOJSON||(legendComponent[channel]=parseLegendForChannel(model,channel)))}return legendComponent}(model):function(model){const{legends:legends,resolve:resolve}=model.component;for(const child of model.children){parseLegend(child);for(const channel of keys(child.component.legends))resolve.legend[channel]=parseGuideResolve(model.component.resolve,channel),"shared"===resolve.legend[channel]&&(legends[channel]=mergeLegendComponent(legends[channel],child.component.legends[channel]),legends[channel]||(resolve.legend[channel]="independent",delete legends[channel]))}for(const channel of keys(legends))for(const child of model.children)child.component.legends[channel]&&"shared"===resolve.legend[channel]&&delete child.component.legends[channel];return legends}(model);return model.component.legends=legendComponent,legendComponent}function isExplicit(value,property,legend,fieldDef){switch(property){case"disable":return void 0!==legend;case"values":return!(null==legend||!legend.values);case"title":if("title"===property&&value===(null==fieldDef?void 0:fieldDef.title))return!0}return value===(legend||{})[property]}function parseLegendForChannel(model,channel){var _normalizeTimeUnit,_legend$encoding,_legend;let legend=model.legend(channel);const{markDef:markDef,encoding:encoding,config:config}=model,legendConfig=config.legend,legendCmpt=new LegendComponent({},function(model,channel){const scale=model.scaleName(channel);if("trail"===model.mark){if("color"===channel)return{stroke:scale};if("size"===channel)return{strokeWidth:scale}}return"color"===channel?model.markDef.filled?{fill:scale}:{stroke:scale}:{[channel]:scale}}(model,channel));!function(model,channel,legendCmpt){var _model$fieldDef;const field=null===(_model$fieldDef=model.fieldDef(channel))||void 0===_model$fieldDef?void 0:_model$fieldDef.field;for(const selCmpt of vals(null!==(_model$component$sele=model.component.selection)&&void 0!==_model$component$sele?_model$component$sele:{})){var _model$component$sele,_selCmpt$project$hasF;const proj=null!==(_selCmpt$project$hasF=selCmpt.project.hasField[field])&&void 0!==_selCmpt$project$hasF?_selCmpt$project$hasF:selCmpt.project.hasChannel[channel];if(proj&&legendBindings.defined(selCmpt)){var _legendCmpt$get;const legendSelections=null!==(_legendCmpt$get=legendCmpt.get("selections"))&&void 0!==_legendCmpt$get?_legendCmpt$get:[];legendSelections.push(selCmpt.name),legendCmpt.set("selections",legendSelections,!1),proj.hasLegend=!0}}}(model,channel,legendCmpt);const disable=void 0!==legend?!legend:legendConfig.disable;if(legendCmpt.set("disable",disable,void 0!==legend),disable)return legendCmpt;legend=legend||{};const scaleType=model.getScaleComponent(channel).get("type"),fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]),timeUnit=isFieldDef(fieldOrDatumDef)?null===(_normalizeTimeUnit=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit:void 0,orient=legend.orient||config.legend.orient||"right",legendType=getLegendType({legend:legend,channel:channel,timeUnit:timeUnit,scaleType:scaleType}),ruleParams={legend:legend,channel:channel,model:model,markDef:markDef,encoding:encoding,fieldOrDatumDef:fieldOrDatumDef,legendConfig:legendConfig,config:config,scaleType:scaleType,orient:orient,legendType:legendType,direction:getDirection({legend:legend,legendType:legendType,orient:orient,legendConfig:legendConfig})};for(const property of LEGEND_COMPONENT_PROPERTIES){if("gradient"===legendType&&property.startsWith("symbol")||"symbol"===legendType&&property.startsWith("gradient"))continue;const value=property in legendRules?legendRules[property](ruleParams):legend[property];if(void 0!==value){const explicit=isExplicit(value,property,legend,model.fieldDef(channel));(explicit||void 0===config.legend[property])&&legendCmpt.set(property,value,explicit)}}const legendEncoding=null!==(_legend$encoding=null===(_legend=legend)||void 0===_legend?void 0:_legend.encoding)&&void 0!==_legend$encoding?_legend$encoding:{},selections=legendCmpt.get("selections"),legendEncode={},legendEncodeParams={fieldOrDatumDef:fieldOrDatumDef,model:model,channel:channel,legendCmpt:legendCmpt,legendType:legendType};for(const part of["labels","legend","title","symbols","gradient","entries"]){var _legendEncoding$part;const legendEncodingPart=guideEncodeEntry(null!==(_legendEncoding$part=legendEncoding[part])&&void 0!==_legendEncoding$part?_legendEncoding$part:{},model),value=part in legendEncodeRules?legendEncodeRules[part](legendEncodingPart,legendEncodeParams):legendEncodingPart;void 0===value||isEmpty(value)||(legendEncode[part]={...null!=selections&&selections.length&&isFieldDef(fieldOrDatumDef)?{name:"".concat(varName(fieldOrDatumDef.field),"_legend_").concat(part)}:{},...null!=selections&&selections.length?{interactive:!!selections}:{},update:value})}var _legend2;return isEmpty(legendEncode)||legendCmpt.set("encode",legendEncode,!(null===(_legend2=legend)||void 0===_legend2||!_legend2.encoding)),legendCmpt}function mergeLegendComponent(mergedLegend,childLegend){if(!mergedLegend)return childLegend.clone();const mergedOrient=mergedLegend.getWithExplicit("orient"),childOrient=childLegend.getWithExplicit("orient");if(mergedOrient.explicit&&childOrient.explicit&&mergedOrient.value!==childOrient.value)return;let typeMerged=!1;for(const prop of LEGEND_COMPONENT_PROPERTIES){const mergedValueWithExplicit=mergeValuesWithExplicit(mergedLegend.getWithExplicit(prop),childLegend.getWithExplicit(prop),prop,"legend",(v1,v2)=>{switch(prop){case"symbolType":return st1=v1,"circle"===(st2=v2).value?st2:st1;case"title":return mergeTitleComponent(v1,v2);case"type":return typeMerged=!0,makeImplicit("symbol")}var st1,st2;return defaultTieBreaker(v1,v2,prop,"legend")});mergedLegend.setWithExplicit(prop,mergedValueWithExplicit)}var _mergedLegend$implici,_mergedLegend$implici2,_mergedLegend$explici,_mergedLegend$explici2;return typeMerged&&(null!==(_mergedLegend$implici=mergedLegend.implicit)&&void 0!==_mergedLegend$implici&&null!==(_mergedLegend$implici2=_mergedLegend$implici.encode)&&void 0!==_mergedLegend$implici2&&_mergedLegend$implici2.gradient&&deleteNestedProperty(mergedLegend.implicit,["encode","gradient"]),null!==(_mergedLegend$explici=mergedLegend.explicit)&&void 0!==_mergedLegend$explici&&null!==(_mergedLegend$explici2=_mergedLegend$explici.encode)&&void 0!==_mergedLegend$explici2&&_mergedLegend$explici2.gradient&&deleteNestedProperty(mergedLegend.explicit,["encode","gradient"])),mergedLegend}function assembleLegends(model){const legendComponentIndex=model.component.legends,legendByDomain={};for(const channel of keys(legendComponentIndex)){const scaleComponent=model.getScaleComponent(channel),domainHash=stringify(scaleComponent.get("domains"));if(legendByDomain[domainHash])for(const mergedLegendComponent of legendByDomain[domainHash])mergeLegendComponent(mergedLegendComponent,legendComponentIndex[channel])||legendByDomain[domainHash].push(legendComponentIndex[channel]);else legendByDomain[domainHash]=[legendComponentIndex[channel].clone()]}return vals(legendByDomain).flat().map(l=>function(legendCmpt,config){var _legend$encode3;const{disable:disable,labelExpr:labelExpr,selections:selections,...legend}=legendCmpt.combine();if(!disable){if(!1===config.aria&&null==legend.aria&&(legend.aria=!1),null!==(_legend$encode3=legend.encode)&&void 0!==_legend$encode3&&_legend$encode3.symbols){const out=legend.encode.symbols.update;!out.fill||"transparent"===out.fill.value||out.stroke||legend.stroke||(out.stroke={value:"transparent"});for(const property of LEGEND_SCALE_CHANNELS)legend[property]&&delete out[property]}if(legend.title||delete legend.title,void 0!==labelExpr){var _legend$encode4,_legend$encode4$label;let expr=labelExpr;null!==(_legend$encode4=legend.encode)&&void 0!==_legend$encode4&&null!==(_legend$encode4$label=_legend$encode4.labels)&&void 0!==_legend$encode4$label&&_legend$encode4$label.update&&isSignalRef(legend.encode.labels.update.text)&&(expr=replaceAll(labelExpr,"datum.label",legend.encode.labels.update.text.signal)),function(legend,part,vgProp,vgRef){var _legend$encode,_legend$encode2,_legend$encode2$part,_legend$encode$part,_legend$encode$part$u;null!==(_legend$encode=legend.encode)&&void 0!==_legend$encode||(legend.encode={}),null!==(_legend$encode2$part=(_legend$encode2=legend.encode)[part])&&void 0!==_legend$encode2$part||(_legend$encode2[part]={}),null!==(_legend$encode$part$u=(_legend$encode$part=legend.encode[part]).update)&&void 0!==_legend$encode$part$u||(_legend$encode$part.update={}),legend.encode[part].update[vgProp]=vgRef}(legend,"labels","text",{signal:expr})}return legend}}(l,model.config)).filter(l=>void 0!==l)}function assembleProjections(model){return isLayerModel(model)||isConcatModel(model)?function(model){return model.children.reduce((projections,child)=>projections.concat(child.assembleProjections()),assembleProjectionForModel(model))}(model):assembleProjectionForModel(model)}function assembleProjectionForModel(model){const component=model.component.projection;if(!component||component.merged)return[];const projection=component.combine(),{name:name}=projection;if(component.data){const size={signal:"[".concat(component.size.map(ref=>ref.signal).join(", "),"]")},fits=component.data.reduce((sources,data)=>{const source=isSignalRef(data)?data.signal:"data('".concat(model.lookupDataSource(data),"')");return contains(sources,source)||sources.push(source),sources},[]);if(fits.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:name,size:size,fit:{signal:fits.length>1?"[".concat(fits.join(", "),"]"):fits[0]},...projection}]}return[{name:name,translate:{signal:"[width / 2, height / 2]"},...projection}]}const PROJECTION_PROPERTIES=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class ProjectionComponent extends Split{constructor(name,specifiedProjection,size,data){super({...specifiedProjection},{name:name}),this.specifiedProjection=specifiedProjection,this.size=size,this.data=data,_defineProperty(this,"merged",!1)}get isFit(){return!!this.data}}function parseProjection(model){model.component.projection=isUnitModel(model)?function(model){if(model.hasProjection){var _replaceExprRef;const proj=replaceExprRef(model.specifiedProjection),fit=!(proj&&(null!=proj.scale||null!=proj.translate)),size=fit?[model.getSizeSignalRef("width"),model.getSizeSignalRef("height")]:void 0,data=fit?function(model){const data=[],{encoding:encoding}=model;for(const posssiblePair of[["longitude","latitude"],["longitude2","latitude2"]])(getFieldOrDatumDef(encoding[posssiblePair[0]])||getFieldOrDatumDef(encoding[posssiblePair[1]]))&&data.push({signal:model.getName("geojson_".concat(data.length))});return model.channelHasField(SHAPE)&&model.typedFieldDef(SHAPE).type===GEOJSON&&data.push({signal:model.getName("geojson_".concat(data.length))}),0===data.length&&data.push(model.requestDataName(DataSourceType.Main)),data}(model):void 0,projComp=new ProjectionComponent(model.projectionName(!0),{...null!==(_replaceExprRef=replaceExprRef(model.config.projection))&&void 0!==_replaceExprRef?_replaceExprRef:{},...null!=proj?proj:{}},size,data);return projComp.get("type")||projComp.set("type","equalEarth",!1),projComp}}(model):function(model){if(0===model.children.length)return;let nonUnitProjection;for(const child of model.children)parseProjection(child);const mergable=every(model.children,child=>{const projection=child.component.projection;if(projection){if(nonUnitProjection){const merge=function(first,second){const allPropertiesShared=every(PROJECTION_PROPERTIES,prop=>!vegaUtil.hasOwnProperty(first.explicit,prop)&&!vegaUtil.hasOwnProperty(second.explicit,prop)||!!(vegaUtil.hasOwnProperty(first.explicit,prop)&&vegaUtil.hasOwnProperty(second.explicit,prop)&&deepEqual(first.get(prop),second.get(prop))));if(deepEqual(first.size,second.size)){if(allPropertiesShared)return first;if(deepEqual(first.explicit,{}))return second;if(deepEqual(second.explicit,{}))return first}return null}(nonUnitProjection,projection);return merge&&(nonUnitProjection=merge),!!merge}return nonUnitProjection=projection,!0}return!0});if(nonUnitProjection&&mergable){const name=model.projectionName(!0),modelProjection=new ProjectionComponent(name,nonUnitProjection.specifiedProjection,nonUnitProjection.size,duplicate(nonUnitProjection.data));for(const child of model.children){const projection=child.component.projection;projection&&(projection.isFit&&modelProjection.data.push(...child.component.projection.data),child.renameProjection(projection.get("name"),name),projection.merged=!0)}return modelProjection}}(model)}function rangeFormula(model,fieldDef,channel,config){if(binRequiresRange(fieldDef,channel)){var _ref,_model$axis;const guide=isUnitModel(model)&&null!==(_ref=null!==(_model$axis=model.axis(channel))&&void 0!==_model$axis?_model$axis:model.legend(channel))&&void 0!==_ref?_ref:{},startField=vgField(fieldDef,{expr:"datum"}),endField=vgField(fieldDef,{expr:"datum",binSuffix:"end"});return{formulaAs:vgField(fieldDef,{binSuffix:"range",forAs:!0}),formula:binFormatExpression(startField,endField,guide.format,guide.formatType,config)}}return{}}function binKey(bin,field){return"".concat(binToString(bin),"_").concat(field)}function getBinSignalName(model,field,bin){var _normalizeBin;const key=binKey(null!==(_normalizeBin=normalizeBin(bin,void 0))&&void 0!==_normalizeBin?_normalizeBin:{},field);return model.getName("".concat(key,"_bins"))}function createBinComponent(t,bin,model){let as,span;as=function(t){return"as"in t}(t)?vegaUtil.isString(t.as)?[t.as,"".concat(t.as,"_end")]:[t.as[0],t.as[1]]:[vgField(t,{forAs:!0}),vgField(t,{binSuffix:"end",forAs:!0})];const normalizedBin={...normalizeBin(bin,void 0)},key=binKey(normalizedBin,t.field),{signal:signal,extentSignal:extentSignal}=function(model,key){return{signal:model.getName("".concat(key,"_bins")),extentSignal:model.getName("".concat(key,"_extent"))}}(model,key);if(isParameterExtent(normalizedBin.extent)){const ext=normalizedBin.extent;span=parseSelectionExtent(model,ext.param,ext),delete normalizedBin.extent}return{key:key,binComponent:{bin:normalizedBin,field:t.field,as:[as],...signal?{signal:signal}:{},...extentSignal?{extentSignal:extentSignal}:{},...span?{span:span}:{}}}}class BinNode extends DataFlowNode{clone(){return new BinNode(null,duplicate(this.bins))}constructor(parent,bins){super(parent),this.bins=bins}static makeFromEncoding(parent,model){const bins=model.reduceFieldDef((binComponentIndex,fieldDef,channel)=>{if(isTypedFieldDef(fieldDef)&&isBinning(fieldDef.bin)){const{key:key,binComponent:binComponent}=createBinComponent(fieldDef,fieldDef.bin,model);binComponentIndex[key]={...binComponent,...binComponentIndex[key],...rangeFormula(model,fieldDef,channel,model.config)}}return binComponentIndex},{});return isEmpty(bins)?null:new BinNode(parent,bins)}static makeFromTransform(parent,t,model){const{key:key,binComponent:binComponent}=createBinComponent(t,t.bin,model);return new BinNode(parent,{[key]:binComponent})}merge(other,renameSignal){for(const key of keys(other.bins))key in this.bins?(renameSignal(other.bins[key].signal,this.bins[key].signal),this.bins[key].as=unique([...this.bins[key].as,...other.bins[key].as],hash)):this.bins[key]=other.bins[key];for(const child of other.children)other.removeChild(child),child.parent=this;other.remove()}producedFields(){return new Set(vals(this.bins).map(c=>c.as).flat(2))}dependentFields(){return new Set(vals(this.bins).map(c=>c.field))}hash(){return"Bin ".concat(hash(this.bins))}assemble(){return vals(this.bins).flatMap(bin=>{const transform=[],[binAs,...remainingAs]=bin.as,{extent:extent,...params}=bin.bin,binTrans={type:"bin",field:replacePathInField(bin.field),as:binAs,signal:bin.signal,...isParameterExtent(extent)?{extent:null}:{extent:extent},...bin.span?{span:{signal:"span(".concat(bin.span,")")}}:{},...params};!extent&&bin.extentSignal&&(transform.push({type:"extent",field:replacePathInField(bin.field),signal:bin.extentSignal}),binTrans.extent={signal:bin.extentSignal}),transform.push(binTrans);for(const as of remainingAs)for(let i=0;i<2;i++)transform.push({type:"formula",expr:vgField({field:binAs[i]},{expr:"datum"}),as:as[i]});return bin.formula&&transform.push({type:"formula",expr:bin.formula,as:bin.formulaAs}),transform})}}function addDimension(dims,channel,fieldDef,model){const channelDef2=isUnitModel(model)?model.encoding[getSecondaryRangeChannel(channel)]:void 0;if(isTypedFieldDef(fieldDef)&&isUnitModel(model)&&hasBandEnd(fieldDef,channelDef2,model.markDef,model.config))dims.add(vgField(fieldDef,{})),dims.add(vgField(fieldDef,{suffix:"end"})),fieldDef.bin&&binRequiresRange(fieldDef,channel)&&dims.add(vgField(fieldDef,{binSuffix:"range"}));else if(channel in GEO_POSIITON_CHANNEL_INDEX){const posChannel=function(channel){switch(channel){case"latitude":return"y";case"latitude2":return"y2";case"longitude":return"x";case"longitude2":return"x2"}}(channel);dims.add(model.getName(posChannel))}else dims.add(vgField(fieldDef));return dims}class AggregateNode extends DataFlowNode{clone(){return new AggregateNode(null,new Set(this.dimensions),duplicate(this.measures))}constructor(parent,dimensions,measures){super(parent),this.dimensions=dimensions,this.measures=measures}get groupBy(){return this.dimensions}static makeFromEncoding(parent,model){let isAggregate=!1;model.forEachFieldDef(fd=>{fd.aggregate&&(isAggregate=!0)});const meas={},dims=new Set;return isAggregate?(model.forEachFieldDef((fieldDef,channel)=>{const{aggregate:aggregate,field:field}=fieldDef;if(aggregate)if("count"===aggregate){var _meas$_;null!==(_meas$_=meas["*"])&&void 0!==_meas$_||(meas["*"]={}),meas["*"].count=new Set([vgField(fieldDef,{forAs:!0})])}else{if(isArgminDef(aggregate)||isArgmaxDef(aggregate)){var _meas$argField;const op=isArgminDef(aggregate)?"argmin":"argmax",argField=aggregate[op];null!==(_meas$argField=meas[argField])&&void 0!==_meas$argField||(meas[argField]={}),meas[argField][op]=new Set([vgField({op:op,field:argField},{forAs:!0})])}else{var _meas$field;null!==(_meas$field=meas[field])&&void 0!==_meas$field||(meas[field]={}),meas[field][aggregate]=new Set([vgField(fieldDef,{forAs:!0})])}var _meas$field2;isScaleChannel(channel)&&"unaggregated"===model.scaleDomain(channel)&&(null!==(_meas$field2=meas[field])&&void 0!==_meas$field2||(meas[field]={}),meas[field].min=new Set([vgField({field:field,aggregate:"min"},{forAs:!0})]),meas[field].max=new Set([vgField({field:field,aggregate:"max"},{forAs:!0})]))}else addDimension(dims,channel,fieldDef,model)}),dims.size+keys(meas).length===0?null:new AggregateNode(parent,dims,meas)):null}static makeFromTransform(parent,t){const dims=new Set,meas={};for(const s of t.aggregate){const{op:op,field:field,as:as}=s;var _meas$_2,_meas$field3;op&&("count"===op?(null!==(_meas$_2=meas["*"])&&void 0!==_meas$_2||(meas["*"]={}),meas["*"].count=new Set([as||vgField(s,{forAs:!0})])):(null!==(_meas$field3=meas[field])&&void 0!==_meas$field3||(meas[field]={}),meas[field][op]=new Set([as||vgField(s,{forAs:!0})])))}for(const s of null!==(_t$groupby=t.groupby)&&void 0!==_t$groupby?_t$groupby:[]){var _t$groupby;dims.add(s)}return dims.size+keys(meas).length===0?null:new AggregateNode(parent,dims,meas)}merge(other){return setEqual(this.dimensions,other.dimensions)?(function(parentMeasures,childMeasures){for(const field of keys(childMeasures)){const ops=childMeasures[field];for(const op of keys(ops)){var _parentMeasures$field;field in parentMeasures?parentMeasures[field][op]=new Set([...null!==(_parentMeasures$field=parentMeasures[field][op])&&void 0!==_parentMeasures$field?_parentMeasures$field:[],...ops[op]]):parentMeasures[field]={[op]:ops[op]}}}}(this.measures,other.measures),!0):(function(...args){current.debug(...args)}("different dimensions, cannot merge"),!1)}addDimensions(fields){fields.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...keys(this.measures)])}producedFields(){const out=new Set;for(const field of keys(this.measures))for(const op of keys(this.measures[field])){const m=this.measures[field][op];0===m.size?out.add("".concat(op,"_").concat(field)):m.forEach(out.add,out)}return out}hash(){return"Aggregate ".concat(hash({dimensions:this.dimensions,measures:this.measures}))}assemble(){const ops=[],fields=[],as=[];for(const field of keys(this.measures))for(const op of keys(this.measures[field]))for(const alias of this.measures[field][op])as.push(alias),ops.push(op),fields.push("*"===field?null:replacePathInField(field));return{type:"aggregate",groupby:[...this.dimensions].map(replacePathInField),ops:ops,fields:fields,as:as}}}class FacetNode extends DataFlowNode{constructor(parent,model,name,data){super(parent),this.model=model,this.name=name,this.data=data,_defineProperty(this,"column",void 0),_defineProperty(this,"row",void 0),_defineProperty(this,"facet",void 0),_defineProperty(this,"childModel",void 0);for(const channel of FACET_CHANNELS){const fieldDef=model.facet[channel];if(fieldDef){const{bin:bin,sort:sort}=fieldDef;this[channel]={name:model.getName("".concat(channel,"_domain")),fields:[vgField(fieldDef),...isBinning(bin)?[vgField(fieldDef,{binSuffix:"end"})]:[]],...isSortField(sort)?{sortField:sort}:vegaUtil.isArray(sort)?{sortIndexField:sortArrayIndexField(fieldDef,channel)}:{}}}}this.childModel=model.child}hash(){let out="Facet";for(const channel of FACET_CHANNELS)this[channel]&&(out+=" ".concat(channel.charAt(0),":").concat(hash(this[channel])));return out}get fields(){const f=[];for(const channel of FACET_CHANNELS){var _this$channel;null!==(_this$channel=this[channel])&&void 0!==_this$channel&&_this$channel.fields&&f.push(...this[channel].fields)}return f}dependentFields(){const depFields=new Set(this.fields);for(const channel of FACET_CHANNELS)this[channel]&&(this[channel].sortField&&depFields.add(this[channel].sortField.field),this[channel].sortIndexField&&depFields.add(this[channel].sortIndexField));return depFields}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const childIndependentFieldsWithStep={};for(const channel of POSITION_SCALE_CHANNELS){const childScaleComponent=this.childModel.component.scales[channel];if(childScaleComponent&&!childScaleComponent.merged){const type=childScaleComponent.get("type"),range=childScaleComponent.get("range");if(hasDiscreteDomain(type)&&isVgRangeStep(range)){const field=getFieldFromDomain(assembleDomain(this.childModel,channel));field?childIndependentFieldsWithStep[channel]=field:warn(unknownField(channel))}}}return childIndependentFieldsWithStep}assembleRowColumnHeaderData(channel,crossedDataName,childIndependentFieldsWithStep){const childChannel={row:"y",column:"x",facet:void 0}[channel],fields=[],ops=[],as=[];childChannel&&childIndependentFieldsWithStep&&childIndependentFieldsWithStep[childChannel]&&(crossedDataName?(fields.push("distinct_".concat(childIndependentFieldsWithStep[childChannel])),ops.push("max")):(fields.push(childIndependentFieldsWithStep[childChannel]),ops.push("distinct")),as.push("distinct_".concat(childIndependentFieldsWithStep[childChannel])));const{sortField:sortField,sortIndexField:sortIndexField}=this[channel];if(sortField){const{op:op=DEFAULT_SORT_OP,field:field}=sortField;fields.push(field),ops.push(op),as.push(vgField(sortField,{forAs:!0}))}else sortIndexField&&(fields.push(sortIndexField),ops.push("max"),as.push(sortIndexField));return{name:this[channel].name,source:null!=crossedDataName?crossedDataName:this.data,transform:[{type:"aggregate",groupby:this[channel].fields,...fields.length?{fields:fields,ops:ops,as:as}:{}}]}}assembleFacetHeaderData(childIndependentFieldsWithStep){const{columns:columns}=this.model.layout,{layoutHeaders:layoutHeaders}=this.model.component,data=[],hasSharedAxis={};for(const headerChannel of HEADER_CHANNELS){for(const headerType of HEADER_TYPES){var _ref;const headers=null!==(_ref=layoutHeaders[headerChannel]&&layoutHeaders[headerChannel][headerType])&&void 0!==_ref?_ref:[];for(const header of headers){var _header$axes;if((null===(_header$axes=header.axes)||void 0===_header$axes?void 0:_header$axes.length)>0){hasSharedAxis[headerChannel]=!0;break}}}if(hasSharedAxis[headerChannel]){const cardinality='length(data("'.concat(this.facet.name,'"))'),stop="row"===headerChannel?columns?{signal:"ceil(".concat(cardinality," / ").concat(columns,")")}:1:columns?{signal:"min(".concat(cardinality,", ").concat(columns,")")}:{signal:cardinality};data.push({name:"".concat(this.facet.name,"_").concat(headerChannel),transform:[{type:"sequence",start:0,stop:stop}]})}}const{row:row,column:column}=hasSharedAxis;return(row||column)&&data.unshift(this.assembleRowColumnHeaderData("facet",null,childIndependentFieldsWithStep)),data}assemble(){const data=[];let crossedDataName=null;const childIndependentFieldsWithStep=this.getChildIndependentFieldsWithStep(),{column:column,row:row,facet:facet}=this;if(column&&row&&(childIndependentFieldsWithStep.x||childIndependentFieldsWithStep.y)){var _childIndependentFiel,_childIndependentFiel2;crossedDataName="cross_".concat(this.column.name,"_").concat(this.row.name);const fields=[].concat(null!==(_childIndependentFiel=childIndependentFieldsWithStep.x)&&void 0!==_childIndependentFiel?_childIndependentFiel:[],null!==(_childIndependentFiel2=childIndependentFieldsWithStep.y)&&void 0!==_childIndependentFiel2?_childIndependentFiel2:[]),ops=fields.map(()=>"distinct");data.push({name:crossedDataName,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:fields,ops:ops}]})}for(const channel of[COLUMN,ROW])this[channel]&&data.push(this.assembleRowColumnHeaderData(channel,crossedDataName,childIndependentFieldsWithStep));if(facet){const facetData=this.assembleFacetHeaderData(childIndependentFieldsWithStep);facetData&&data.push(...facetData)}return data}}function unquote(pattern){return"'"===pattern[0]&&"'"===pattern[pattern.length-1]||'"'===pattern[0]&&'"'===pattern[pattern.length-1]?pattern.slice(1,-1):pattern}function getImplicitFromFilterTransform(transform){const implicit={};return function forEachLeaf(op,fn){if(isLogicalNot(op))forEachLeaf(op.not,fn);else if(isLogicalAnd(op))for(const subop of op.and)forEachLeaf(subop,fn);else if(isLogicalOr(op))for(const subop of op.or)forEachLeaf(subop,fn);else fn(op)}(transform.filter,filter=>{if(isFieldPredicate(filter)){let val=null;if(isFieldEqualPredicate(filter))val=signalRefOrValue(filter.equal);else if(isFieldLTEPredicate(filter))val=signalRefOrValue(filter.lte);else if(isFieldLTPredicate(filter))val=signalRefOrValue(filter.lt);else if(isFieldGTPredicate(filter))val=signalRefOrValue(filter.gt);else if(isFieldGTEPredicate(filter))val=signalRefOrValue(filter.gte);else if(isFieldRangePredicate(filter))val=filter.range[0];else if(isFieldOneOfPredicate(filter)){var _filter$oneOf;val=(null!==(_filter$oneOf=filter.oneOf)&&void 0!==_filter$oneOf?_filter$oneOf:filter.in)[0]}val&&(isDateTime(val)?implicit[filter.field]="date":vegaUtil.isNumber(val)?implicit[filter.field]="number":vegaUtil.isString(val)&&(implicit[filter.field]="string")),filter.timeUnit&&(implicit[filter.field]="date")}}),implicit}function getImplicitFromEncoding(model){const implicit={};function add(fieldDef){var aggregate;isFieldOrDatumDefForTimeFormat(fieldDef)?implicit[fieldDef.field]="date":"quantitative"===fieldDef.type&&(aggregate=fieldDef.aggregate,vegaUtil.isString(aggregate)&&contains(["min","max"],aggregate))?implicit[fieldDef.field]="number":accessPathDepth(fieldDef.field)>1?fieldDef.field in implicit||(implicit[fieldDef.field]="flatten"):isScaleFieldDef(fieldDef)&&isSortField(fieldDef.sort)&&accessPathDepth(fieldDef.sort.field)>1&&(fieldDef.sort.field in implicit||(implicit[fieldDef.sort.field]="flatten"))}if((isUnitModel(model)||isFacetModel(model))&&model.forEachFieldDef((fieldDef,channel)=>{if(isTypedFieldDef(fieldDef))add(fieldDef);else{const mainChannel=getMainRangeChannel(channel),mainFieldDef=model.fieldDef(mainChannel);add({...fieldDef,type:mainFieldDef.type})}}),isUnitModel(model)){const{mark:mark,markDef:markDef,encoding:encoding}=model;if(isPathMark(mark)&&!model.encoding.order){const dimensionChannelDef=encoding["horizontal"===markDef.orient?"y":"x"];isFieldDef(dimensionChannelDef)&&"quantitative"===dimensionChannelDef.type&&!(dimensionChannelDef.field in implicit)&&(implicit[dimensionChannelDef.field]="number")}}return implicit}class ParseNode extends DataFlowNode{clone(){return new ParseNode(null,duplicate(this._parse))}constructor(parent,parse){super(parent),_defineProperty(this,"_parse",void 0),this._parse=parse}hash(){return"Parse ".concat(hash(this._parse))}static makeExplicit(parent,model,ancestorParse){let explicit={};const data=model.data;return!isGenerator(data)&&data&&data.format&&data.format.parse&&(explicit=data.format.parse),this.makeWithAncestors(parent,explicit,{},ancestorParse)}static makeWithAncestors(parent,explicit,implicit,ancestorParse){for(const field of keys(implicit)){const parsedAs=ancestorParse.getWithExplicit(field);void 0!==parsedAs.value&&(parsedAs.explicit||parsedAs.value===implicit[field]||"derived"===parsedAs.value||"flatten"===implicit[field]?delete implicit[field]:warn(differentParse(field,implicit[field],parsedAs.value)))}for(const field of keys(explicit)){const parsedAs=ancestorParse.get(field);void 0!==parsedAs&&(parsedAs===explicit[field]?delete explicit[field]:warn(differentParse(field,explicit[field],parsedAs)))}const parse=new Split(explicit,implicit);ancestorParse.copyAll(parse);const p={};for(const key of keys(parse.combine())){const val=parse.get(key);null!==val&&(p[key]=val)}return 0===keys(p).length||ancestorParse.parseNothing?null:new ParseNode(parent,p)}get parse(){return this._parse}merge(other){this._parse={...this._parse,...other.parse},other.remove()}assembleFormatParse(){const formatParse={};for(const field of keys(this._parse)){const p=this._parse[field];1===accessPathDepth(field)&&(formatParse[field]=p)}return formatParse}producedFields(){return new Set(keys(this._parse))}dependentFields(){return new Set(keys(this._parse))}assembleTransforms(onlyNested=!1){return keys(this._parse).filter(field=>!onlyNested||accessPathDepth(field)>1).map(field=>{const expr=function(field,parse){const f=accessPathWithDatum(field);if("number"===parse)return"toNumber(".concat(f,")");if("boolean"===parse)return"toBoolean(".concat(f,")");if("string"===parse)return"toString(".concat(f,")");if("date"===parse)return"toDate(".concat(f,")");if("flatten"===parse)return f;if(parse.startsWith("date:")){const specifier=unquote(parse.slice(5,parse.length));return"timeParse(".concat(f,",'").concat(specifier,"')")}if(parse.startsWith("utc:")){const specifier=unquote(parse.slice(4,parse.length));return"utcParse(".concat(f,",'").concat(specifier,"')")}return warn('Unrecognized parse "'.concat(parse,'".')),null}(field,this._parse[field]);return expr?{type:"formula",expr:expr,as:removePathFromField(field)}:null}).filter(t=>null!==t)}}class IdentifierNode extends DataFlowNode{clone(){return new IdentifierNode(null)}constructor(parent){super(parent)}dependentFields(){return new Set}producedFields(){return new Set(["_vgsid_"])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:"_vgsid_"}}}class GraticuleNode extends DataFlowNode{clone(){return new GraticuleNode(null,this.params)}constructor(parent,params){super(parent),this.params=params}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule ".concat(hash(this.params))}assemble(){return{type:"graticule",...!0===this.params?{}:this.params}}}class SequenceNode extends DataFlowNode{clone(){return new SequenceNode(null,this.params)}constructor(parent,params){super(parent),this.params=params}dependentFields(){return new Set}producedFields(){var _this$params$as;return new Set([null!==(_this$params$as=this.params.as)&&void 0!==_this$params$as?_this$params$as:"data"])}hash(){return"Hash ".concat(hash(this.params))}assemble(){return{type:"sequence",...this.params}}}class SourceNode extends DataFlowNode{constructor(data){var _data;let format;if(super(null),_defineProperty(this,"_data",void 0),_defineProperty(this,"_name",void 0),_defineProperty(this,"_generator",void 0),null!==(_data=data)&&void 0!==_data||(data={name:"source"}),isGenerator(data)||(format=data.format?{...omit(data.format,["parse"])}:{}),isInlineData(data))this._data={values:data.values};else if(isUrlData(data)){if(this._data={url:data.url},!format.type){let defaultExtension=/(?:\.([^.]+))?$/.exec(data.url)[1];contains(["json","csv","tsv","dsv","topojson"],defaultExtension)||(defaultExtension="json"),format.type=defaultExtension}}else isSphereGenerator(data)?this._data={values:[{type:"Sphere"}]}:(isNamedData(data)||isGenerator(data))&&(this._data={});this._generator=isGenerator(data),data.name&&(this._name=data.name),format&&!isEmpty(format)&&(this._data.format=format)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(name){this._name=name}set parent(parent){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}function isDataSourceNode(node){return node instanceof SourceNode||node instanceof GraticuleNode||node instanceof SequenceNode}var _modified=new WeakMap;class Optimizer{constructor(){_modified.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_modified,!1)}setModified(){_classPrivateFieldSet(this,_modified,!0)}get modifiedFlag(){return function(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}(this,_modified)}}class BottomUpOptimizer extends Optimizer{getNodeDepths(node,depth,depths){depths.set(node,depth);for(const child of node.children)this.getNodeDepths(child,depth+1,depths);return depths}optimize(node){const topologicalSort=[...this.getNodeDepths(node,0,new Map).entries()].sort((a,b)=>b[1]-a[1]);for(const tuple of topologicalSort)this.run(tuple[0]);return this.modifiedFlag}}class TopDownOptimizer extends Optimizer{optimize(node){this.run(node);for(const child of node.children)this.optimize(child);return this.modifiedFlag}}class MergeIdenticalNodes extends TopDownOptimizer{mergeNodes(parent,nodes){const mergedNode=nodes.shift();for(const node of nodes)parent.removeChild(node),node.parent=mergedNode,node.remove()}run(node){const hashes=node.children.map(x=>x.hash()),buckets={};for(let i=0;i<hashes.length;i++)void 0===buckets[hashes[i]]?buckets[hashes[i]]=[node.children[i]]:buckets[hashes[i]].push(node.children[i]);for(const k of keys(buckets))buckets[k].length>1&&(this.setModified(),this.mergeNodes(node,buckets[k]))}}class RemoveUnnecessaryIdentifierNodes extends TopDownOptimizer{constructor(model){super(),_defineProperty(this,"requiresSelectionId",void 0),this.requiresSelectionId=model&&requiresSelectionId(model)}run(node){node instanceof IdentifierNode&&(this.requiresSelectionId&&(isDataSourceNode(node.parent)||node.parent instanceof AggregateNode||node.parent instanceof ParseNode)||(this.setModified(),node.remove()))}}class RemoveDuplicateTimeUnits extends Optimizer{optimize(node){return this.run(node,new Set),this.modifiedFlag}run(node,timeUnitFields){let producedFields=new Set;node instanceof TimeUnitNode&&(producedFields=node.producedFields(),hasIntersection(producedFields,timeUnitFields)&&(this.setModified(),node.removeFormulas(timeUnitFields),0===node.producedFields.length&&node.remove()));for(const child of node.children)this.run(child,new Set([...timeUnitFields,...producedFields]))}}class RemoveUnnecessaryOutputNodes extends TopDownOptimizer{constructor(){super()}run(node){node instanceof OutputNode&&!node.isRequired()&&(this.setModified(),node.remove())}}class MoveParseUp extends BottomUpOptimizer{run(node){if(!(isDataSourceNode(node)||node.numChildren()>1))for(const child of node.children)if(child instanceof ParseNode)if(node instanceof ParseNode)this.setModified(),node.merge(child);else{if(fieldIntersection(node.producedFields(),child.dependentFields()))continue;this.setModified(),child.swapWithParent()}}}class MergeParse extends BottomUpOptimizer{run(node){const originalChildren=[...node.children],parseChildren=node.children.filter(child=>child instanceof ParseNode);if(node.numChildren()>1&&parseChildren.length>=1){const commonParse={},conflictingParse=new Set;for(const parseNode of parseChildren){const parse=parseNode.parse;for(const k of keys(parse))k in commonParse?commonParse[k]!==parse[k]&&conflictingParse.add(k):commonParse[k]=parse[k]}for(const field of conflictingParse)delete commonParse[field];if(!isEmpty(commonParse)){this.setModified();const mergedParseNode=new ParseNode(node,commonParse);for(const childNode of originalChildren){if(childNode instanceof ParseNode)for(const key of keys(commonParse))delete childNode.parse[key];node.removeChild(childNode),childNode.parent=mergedParseNode,childNode instanceof ParseNode&&0===keys(childNode.parse).length&&childNode.remove()}}}}}class RemoveUnusedSubtrees extends BottomUpOptimizer{run(node){node instanceof OutputNode||node.numChildren()>0||node instanceof FacetNode||node instanceof SourceNode||(this.setModified(),node.remove())}}class MergeTimeUnits extends BottomUpOptimizer{run(node){const timeUnitChildren=node.children.filter(x=>x instanceof TimeUnitNode),combination=timeUnitChildren.pop();for(const timeUnit of timeUnitChildren)this.setModified(),combination.merge(timeUnit)}}class MergeAggregates extends BottomUpOptimizer{run(node){const aggChildren=node.children.filter(child=>child instanceof AggregateNode),groupedAggregates={};for(const agg of aggChildren){const groupBys=hash(agg.groupBy);groupBys in groupedAggregates||(groupedAggregates[groupBys]=[]),groupedAggregates[groupBys].push(agg)}for(const group of keys(groupedAggregates)){const mergeableAggs=groupedAggregates[group];if(mergeableAggs.length>1){const mergedAggs=mergeableAggs.pop();for(const agg of mergeableAggs)mergedAggs.merge(agg)&&(node.removeChild(agg),agg.parent=mergedAggs,agg.remove(),this.setModified())}}}}class MergeBins extends BottomUpOptimizer{constructor(model){super(),this.model=model}run(node){const moveBinsUp=!(isDataSourceNode(node)||node instanceof FilterNode||node instanceof ParseNode||node instanceof IdentifierNode),promotableBins=[],remainingBins=[];for(const child of node.children)child instanceof BinNode&&(moveBinsUp&&!fieldIntersection(node.producedFields(),child.dependentFields())?promotableBins.push(child):remainingBins.push(child));if(promotableBins.length>0){const promotedBin=promotableBins.pop();for(const bin of promotableBins)promotedBin.merge(bin,this.model.renameSignal.bind(this.model));this.setModified(),node instanceof BinNode?node.merge(promotedBin,this.model.renameSignal.bind(this.model)):promotedBin.swapWithParent()}if(remainingBins.length>1){const remainingBin=remainingBins.pop();for(const bin of remainingBins)remainingBin.merge(bin,this.model.renameSignal.bind(this.model));this.setModified()}}}class MergeOutputs extends BottomUpOptimizer{run(node){const children=[...node.children];if(!some(children,child=>child instanceof OutputNode)||node.numChildren()<=1)return;const otherChildren=[];let mainOutput;for(const child of children)if(child instanceof OutputNode){let lastOutput=child;for(;1===lastOutput.numChildren();){const[theChild]=lastOutput.children;if(!(theChild instanceof OutputNode))break;lastOutput=theChild}otherChildren.push(...lastOutput.children),mainOutput?(node.removeChild(child),child.parent=mainOutput.parent,mainOutput.parent.removeChild(mainOutput),mainOutput.parent=lastOutput,this.setModified()):mainOutput=lastOutput}else otherChildren.push(child);if(otherChildren.length){this.setModified();for(const child of otherChildren)child.parent.removeChild(child),child.parent=mainOutput}}}class JoinAggregateTransformNode extends DataFlowNode{clone(){return new JoinAggregateTransformNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform}addDimensions(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),d=>d)}dependentFields(){const out=new Set;return this.transform.groupby&&this.transform.groupby.forEach(out.add,out),this.transform.joinaggregate.map(w=>w.field).filter(f=>void 0!==f).forEach(out.add,out),out}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(joinAggregateFieldDef){var _joinAggregateFieldDe;return null!==(_joinAggregateFieldDe=joinAggregateFieldDef.as)&&void 0!==_joinAggregateFieldDe?_joinAggregateFieldDe:vgField(joinAggregateFieldDef)}hash(){return"JoinAggregateTransform ".concat(hash(this.transform))}assemble(){const fields=[],ops=[],as=[];for(const joinaggregate of this.transform.joinaggregate)ops.push(joinaggregate.op),as.push(this.getDefaultName(joinaggregate)),fields.push(void 0===joinaggregate.field?null:joinaggregate.field);const groupby=this.transform.groupby;return{type:"joinaggregate",as:as,ops:ops,fields:fields,...void 0!==groupby?{groupby:groupby}:{}}}}class StackNode extends DataFlowNode{clone(){return new StackNode(null,duplicate(this._stack))}constructor(parent,stack){super(parent),_defineProperty(this,"_stack",void 0),this._stack=stack}static makeFromTransform(parent,stackTransform){const{stack:stack,groupby:groupby,as:as,offset:offset="zero"}=stackTransform,sortFields=[],sortOrder=[];if(void 0!==stackTransform.sort)for(const sortField of stackTransform.sort)sortFields.push(sortField.field),sortOrder.push(getFirstDefined(sortField.order,"ascending"));const sort={field:sortFields,order:sortOrder};let normalizedAs;return normalizedAs=function(as){return vegaUtil.isArray(as)&&as.every(s=>vegaUtil.isString(s))&&as.length>1}(as)?as:vegaUtil.isString(as)?[as,"".concat(as,"_end")]:["".concat(stackTransform.stack,"_start"),"".concat(stackTransform.stack,"_end")],new StackNode(parent,{stackField:stack,groupby:groupby,offset:offset,sort:sort,facetby:[],as:normalizedAs})}static makeFromEncoding(parent,model){const stackProperties=model.stack,{encoding:encoding}=model;if(!stackProperties)return null;const{groupbyChannel:groupbyChannel,fieldChannel:fieldChannel,offset:offset,impute:impute}=stackProperties;let dimensionFieldDef;groupbyChannel&&(dimensionFieldDef=getFieldDef(encoding[groupbyChannel]));const stackby=function(model){return model.stack.stackBy.reduce((fields,by)=>{const _field=vgField(by.fieldDef);return _field&&fields.push(_field),fields},[])}(model),orderDef=model.encoding.order;let sort;return sort=vegaUtil.isArray(orderDef)||isFieldDef(orderDef)?sortParams(orderDef):stackby.reduce((s,field)=>(s.field.push(field),s.order.push("y"===fieldChannel?"descending":"ascending"),s),{field:[],order:[]}),new StackNode(parent,{dimensionFieldDef:dimensionFieldDef,stackField:model.vgField(fieldChannel),facetby:[],stackby:stackby,sort:sort,offset:offset,impute:impute,as:[model.vgField(fieldChannel,{suffix:"start",forAs:!0}),model.vgField(fieldChannel,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(fields){this._stack.facetby.push(...fields)}dependentFields(){const out=new Set;return out.add(this._stack.stackField),this.getGroupbyFields().forEach(out.add,out),this._stack.facetby.forEach(out.add,out),this._stack.sort.field.forEach(out.add,out),out}producedFields(){return new Set(this._stack.as)}hash(){return"Stack ".concat(hash(this._stack))}getGroupbyFields(){const{dimensionFieldDef:dimensionFieldDef,impute:impute,groupby:groupby}=this._stack;return dimensionFieldDef?dimensionFieldDef.bin?impute?[vgField(dimensionFieldDef,{binSuffix:"mid"})]:[vgField(dimensionFieldDef,{}),vgField(dimensionFieldDef,{binSuffix:"end"})]:[vgField(dimensionFieldDef)]:null!=groupby?groupby:[]}assemble(){const transform=[],{facetby:facetby,dimensionFieldDef:dimensionFieldDef,stackField:field,stackby:stackby,sort:sort,offset:offset,impute:impute,as:as}=this._stack;if(impute&&dimensionFieldDef){const{bandPosition:bandPosition=.5,bin:bin}=dimensionFieldDef;bin&&transform.push({type:"formula",expr:"".concat(bandPosition,"*")+vgField(dimensionFieldDef,{expr:"datum"})+"+".concat(1-bandPosition,"*")+vgField(dimensionFieldDef,{expr:"datum",binSuffix:"end"}),as:vgField(dimensionFieldDef,{binSuffix:"mid",forAs:!0})}),transform.push({type:"impute",field:field,groupby:[...stackby,...facetby],key:vgField(dimensionFieldDef,{binSuffix:"mid"}),method:"value",value:0})}return transform.push({type:"stack",groupby:[...this.getGroupbyFields(),...facetby],field:field,sort:sort,as:as,offset:offset}),transform}}class WindowTransformNode extends DataFlowNode{clone(){return new WindowTransformNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform}addDimensions(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),d=>d)}dependentFields(){var _this$transform$group,_this$transform$sort;const out=new Set;return(null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]).forEach(out.add,out),(null!==(_this$transform$sort=this.transform.sort)&&void 0!==_this$transform$sort?_this$transform$sort:[]).forEach(m=>out.add(m.field)),this.transform.window.map(w=>w.field).filter(f=>void 0!==f).forEach(out.add,out),out}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(windowFieldDef){var _windowFieldDef$as;return null!==(_windowFieldDef$as=windowFieldDef.as)&&void 0!==_windowFieldDef$as?_windowFieldDef$as:vgField(windowFieldDef)}hash(){return"WindowTransform ".concat(hash(this.transform))}assemble(){const fields=[],ops=[],as=[],params=[];for(const window of this.transform.window)ops.push(window.op),as.push(this.getDefaultName(window)),params.push(void 0===window.param?null:window.param),fields.push(void 0===window.field?null:window.field);const frame=this.transform.frame,groupby=this.transform.groupby;if(frame&&null===frame[0]&&null===frame[1]&&ops.every(o=>isAggregateOp(o)))return{type:"joinaggregate",as:as,ops:ops,fields:fields,...void 0!==groupby?{groupby:groupby}:{}};const sortFields=[],sortOrder=[];if(void 0!==this.transform.sort)for(const sortField of this.transform.sort){var _sortField$order;sortFields.push(sortField.field),sortOrder.push(null!==(_sortField$order=sortField.order)&&void 0!==_sortField$order?_sortField$order:"ascending")}const sort={field:sortFields,order:sortOrder},ignorePeers=this.transform.ignorePeers;return{type:"window",params:params,as:as,ops:ops,fields:fields,sort:sort,...void 0!==ignorePeers?{ignorePeers:ignorePeers}:{},...void 0!==groupby?{groupby:groupby}:{},...void 0!==frame?{frame:frame}:{}}}}function moveFacetDown(node){if(node instanceof FacetNode)if(1!==node.numChildren()||node.children[0]instanceof OutputNode){const facetMain=node.model.component.data.main;!function moveMainDownToFacet(node){if(node instanceof OutputNode&&node.type===DataSourceType.Main&&1===node.numChildren()){const child=node.children[0];child instanceof FacetNode||(child.swapWithParent(),moveMainDownToFacet(node))}}(facetMain);const cloner=(facet=node,function clone(node){if(!(node instanceof FacetNode)){const copy=node.clone();if(copy instanceof OutputNode){const newName=FACET_SCALE_PREFIX+copy.getSource();copy.setSource(newName),facet.model.component.data.outputNodes[newName]=copy}else(copy instanceof AggregateNode||copy instanceof StackNode||copy instanceof WindowTransformNode||copy instanceof JoinAggregateTransformNode)&&copy.addDimensions(facet.fields);for(const n of node.children.flatMap(clone))n.parent=copy;return[copy]}return node.children.flatMap(clone)}),copy=node.children.map(cloner).flat();for(const c of copy)c.parent=facetMain}else{const child=node.children[0];(child instanceof AggregateNode||child instanceof StackNode||child instanceof WindowTransformNode||child instanceof JoinAggregateTransformNode)&&child.addDimensions(node.fields),child.swapWithParent(),moveFacetDown(node)}else node.children.map(moveFacetDown);var facet}const FACET_SCALE_PREFIX="scale_";function checkLinks(nodes){for(const node of nodes){for(const child of node.children)if(child.parent!==node)return!1;if(!checkLinks(node.children))return!1}return!0}function runOptimizer(optimizer,nodes){let modified=!1;for(const node of nodes)modified=optimizer.optimize(node)||modified;return modified}function optimizationDataflowHelper(dataComponent,model,firstPass){let roots=dataComponent.sources,modified=!1;return modified=runOptimizer(new RemoveUnnecessaryOutputNodes,roots)||modified,modified=runOptimizer(new RemoveUnnecessaryIdentifierNodes(model),roots)||modified,roots=roots.filter(r=>r.numChildren()>0),modified=runOptimizer(new RemoveUnusedSubtrees,roots)||modified,roots=roots.filter(r=>r.numChildren()>0),firstPass||(modified=runOptimizer(new MoveParseUp,roots)||modified,modified=runOptimizer(new MergeBins(model),roots)||modified,modified=runOptimizer(new RemoveDuplicateTimeUnits,roots)||modified,modified=runOptimizer(new MergeParse,roots)||modified,modified=runOptimizer(new MergeAggregates,roots)||modified,modified=runOptimizer(new MergeTimeUnits,roots)||modified,modified=runOptimizer(new MergeIdenticalNodes,roots)||modified,modified=runOptimizer(new MergeOutputs,roots)||modified),dataComponent.sources=roots,modified}class SignalRefWrapper{constructor(exprGenerator){_defineProperty(this,"signal",void 0),Object.defineProperty(this,"signal",{enumerable:!0,get:exprGenerator})}static fromName(rename,signalName){return new SignalRefWrapper(()=>rename(signalName))}}function parseScaleDomain(model){isUnitModel(model)?function(model){const localScaleComponents=model.component.scales;for(const channel of keys(localScaleComponents)){const domains=parseDomainForChannel(model,channel);if(localScaleComponents[channel].setWithExplicit("domains",domains),parseSelectionDomain(model,channel),model.component.data.isFaceted){let facetParent=model;for(;!isFacetModel(facetParent)&&facetParent.parent;)facetParent=facetParent.parent;if("shared"===facetParent.component.resolve.scale[channel])for(const domain of domains.value)isDataRefDomain(domain)&&(domain.data=FACET_SCALE_PREFIX+domain.data.replace(FACET_SCALE_PREFIX,""))}}}(model):function(model){for(const child of model.children)parseScaleDomain(child);const localScaleComponents=model.component.scales;for(const channel of keys(localScaleComponents)){let domains,selectionExtent=null;for(const child of model.children){const childComponent=child.component.scales[channel];if(childComponent){domains=void 0===domains?childComponent.getWithExplicit("domains"):mergeValuesWithExplicit(domains,childComponent.getWithExplicit("domains"),"domains","scale",domainsTieBreaker);const se=childComponent.get("selectionExtent");selectionExtent&&se&&selectionExtent.param!==se.param&&warn("The same selection must be used to override scale domains in a layered view."),selectionExtent=se}}localScaleComponents[channel].setWithExplicit("domains",domains),selectionExtent&&localScaleComponents[channel].set("selectionExtent",selectionExtent,!0)}}(model)}function parseDomainForChannel(model,channel){const scaleType=model.getScaleComponent(channel).get("type"),{encoding:encoding}=model,domain=function(domain,fieldDef,scaleType,scaleConfig){if("unaggregated"===domain){const{valid:valid,reason:reason}=canUseUnaggregatedDomain(fieldDef,scaleType);if(!valid)return void warn(reason)}else if(void 0===domain&&scaleConfig.useUnaggregatedDomain){const{valid:valid}=canUseUnaggregatedDomain(fieldDef,scaleType);if(valid)return"unaggregated"}return domain}(model.scaleDomain(channel),model.typedFieldDef(channel),scaleType,model.config.scale);return domain!==model.scaleDomain(channel)&&(model.specifiedScales[channel]={...model.specifiedScales[channel],domain:domain}),"x"===channel&&getFieldOrDatumDef(encoding.x2)?getFieldOrDatumDef(encoding.x)?mergeValuesWithExplicit(parseSingleChannelDomain(scaleType,domain,model,"x"),parseSingleChannelDomain(scaleType,domain,model,"x2"),"domain","scale",domainsTieBreaker):parseSingleChannelDomain(scaleType,domain,model,"x2"):"y"===channel&&getFieldOrDatumDef(encoding.y2)?getFieldOrDatumDef(encoding.y)?mergeValuesWithExplicit(parseSingleChannelDomain(scaleType,domain,model,"y"),parseSingleChannelDomain(scaleType,domain,model,"y2"),"domain","scale",domainsTieBreaker):parseSingleChannelDomain(scaleType,domain,model,"y2"):parseSingleChannelDomain(scaleType,domain,model,channel)}function convertDomainIfItIsDateTime(domain,type,timeUnit){var _normalizeTimeUnit;const normalizedTimeUnit=null===(_normalizeTimeUnit=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit;return"temporal"===type||normalizedTimeUnit?function(domain,type,timeUnit){return domain.map(v=>{const data=valueExpr(v,{timeUnit:timeUnit,type:type});return{signal:"{data: ".concat(data,"}")}})}(domain,type,normalizedTimeUnit):[domain]}function parseSingleChannelDomain(scaleType,domain,model,channel){const{encoding:encoding}=model,fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]),{type:type}=fieldOrDatumDef,timeUnit=fieldOrDatumDef.timeUnit;if(function(domain){return domain&&domain.unionWith}(domain)){const defaultDomain=parseSingleChannelDomain(scaleType,void 0,model,channel),unionWith=convertDomainIfItIsDateTime(domain.unionWith,type,timeUnit);return makeExplicit([...defaultDomain.value,...unionWith])}if(isSignalRef(domain))return makeExplicit([domain]);if(domain&&"unaggregated"!==domain&&!isParameterDomain(domain))return makeExplicit(convertDomainIfItIsDateTime(domain,type,timeUnit));const stack=model.stack;if(stack&&channel===stack.fieldChannel){if("normalize"===stack.offset)return makeImplicit([[0,1]]);const data=model.requestDataName(DataSourceType.Main);return makeImplicit([{data:data,field:model.vgField(channel,{suffix:"start"})},{data:data,field:model.vgField(channel,{suffix:"end"})}])}const sort=isScaleChannel(channel)&&isFieldDef(fieldOrDatumDef)?function(model,channel,scaleType){if(!hasDiscreteDomain(scaleType))return;const fieldDef=model.fieldDef(channel),sort=fieldDef.sort;if(isSortArray(sort))return{op:"min",field:sortArrayIndexField(fieldDef,channel),order:"ascending"};const{stack:stack}=model,stackDimensions=stack?[...stack.groupbyField?[stack.groupbyField]:[],...stack.stackBy.map(s=>s.fieldDef.field)]:void 0;if(isSortField(sort)){const isStackedMeasure=stack&&!contains(stackDimensions,sort.field);return normalizeSortField(sort,isStackedMeasure)}if(isSortByEncoding(sort)){const{encoding:encoding,order:order}=sort,fieldDefToSortBy=model.fieldDef(encoding),{aggregate:aggregate,field:field}=fieldDefToSortBy,isStackedMeasure=stack&&!contains(stackDimensions,field);if(isArgminDef(aggregate)||isArgmaxDef(aggregate))return normalizeSortField({field:vgField(fieldDefToSortBy),order:order},isStackedMeasure);if(isAggregateOp(aggregate)||!aggregate)return normalizeSortField({op:aggregate,field:field,order:order},isStackedMeasure)}else{if("descending"===sort)return{op:"min",field:model.vgField(channel),order:"descending"};if(contains(["ascending",void 0],sort))return!0}}(model,channel,scaleType):void 0;if(isDatumDef(fieldOrDatumDef))return makeImplicit(convertDomainIfItIsDateTime([fieldOrDatumDef.datum],type,timeUnit));const fieldDef=fieldOrDatumDef;if("unaggregated"===domain){const data=model.requestDataName(DataSourceType.Main),{field:field}=fieldOrDatumDef;return makeImplicit([{data:data,field:vgField({field:field,aggregate:"min"})},{data:data,field:vgField({field:field,aggregate:"max"})}])}if(isBinning(fieldDef.bin)){if(hasDiscreteDomain(scaleType))return makeImplicit("bin-ordinal"===scaleType?[]:[{data:isBoolean(sort)?model.requestDataName(DataSourceType.Main):model.requestDataName(DataSourceType.Raw),field:model.vgField(channel,binRequiresRange(fieldDef,channel)?{binSuffix:"range"}:{}),sort:!0!==sort&&vegaUtil.isObject(sort)?sort:{field:model.vgField(channel,{}),op:"min"}}]);{const{bin:bin}=fieldDef;if(isBinning(bin)){const binSignal=getBinSignalName(model,fieldDef.field,bin);return makeImplicit([new SignalRefWrapper(()=>{const signal=model.getSignalName(binSignal);return"[".concat(signal,".start, ").concat(signal,".stop]")})])}return makeImplicit([{data:model.requestDataName(DataSourceType.Main),field:model.vgField(channel,{})}])}}if(fieldDef.timeUnit&&contains(["time","utc"],scaleType)&&hasBandEnd(fieldDef,isUnitModel(model)?model.encoding[getSecondaryRangeChannel(channel)]:void 0,model.markDef,model.config)){const data=model.requestDataName(DataSourceType.Main);return makeImplicit([{data:data,field:model.vgField(channel)},{data:data,field:model.vgField(channel,{suffix:"end"})}])}return makeImplicit(sort?[{data:isBoolean(sort)?model.requestDataName(DataSourceType.Main):model.requestDataName(DataSourceType.Raw),field:model.vgField(channel),sort:sort}]:[{data:model.requestDataName(DataSourceType.Main),field:model.vgField(channel)}])}function normalizeSortField(sort,isStackedMeasure){const{op:op,field:field,order:order}=sort;return{op:null!=op?op:isStackedMeasure?"sum":DEFAULT_SORT_OP,...field?{field:replacePathInField(field)}:{},...order?{order:order}:{}}}function parseSelectionDomain(model,channel){var _model$fieldDef;const scale=model.component.scales[channel],spec=model.specifiedScales[channel].domain,bin=null===(_model$fieldDef=model.fieldDef(channel))||void 0===_model$fieldDef?void 0:_model$fieldDef.bin,domain=isParameterDomain(spec)&&spec,extent=isBinParams(bin)&&isParameterExtent(bin.extent)&&bin.extent;(domain||extent)&&scale.set("selectionExtent",null!=domain?domain:extent,!0)}function canUseUnaggregatedDomain(fieldDef,scaleType){const{aggregate:aggregate,type:type}=fieldDef;return aggregate?vegaUtil.isString(aggregate)&&!SHARED_DOMAIN_OP_INDEX[aggregate]?{valid:!1,reason:unaggregateDomainWithNonSharedDomainOp(aggregate)}:"quantitative"===type&&"log"===scaleType?{valid:!1,reason:unaggregatedDomainWithLogScale(fieldDef)}:{valid:!0}:{valid:!1,reason:unaggregateDomainHasNoEffectForRawField(fieldDef)}}function domainsTieBreaker(v1,v2,property,propertyOf){return v1.explicit&&v2.explicit&&warn(function(property,propertyOf,v1,v2){return"Conflicting ".concat(propertyOf.toString(),' property "').concat(property.toString(),'" (').concat(stringify(v1)," and ").concat(stringify(v2),"). Using the union of the two domains.")}(property,propertyOf,v1.value,v2.value)),{explicit:v1.explicit,value:[...v1.value,...v2.value]}}function mergeDomains(domains){const uniqueDomains=unique(domains.map(domain=>{if(isDataRefDomain(domain)){const{sort:_s,...domainWithoutSort}=domain;return domainWithoutSort}return domain}),hash),sorts=unique(domains.map(d=>{if(isDataRefDomain(d)){const s=d.sort;return void 0===s||isBoolean(s)||("op"in s&&"count"===s.op&&delete s.field,"ascending"===s.order&&delete s.order),s}}).filter(s=>void 0!==s),hash);if(0===uniqueDomains.length)return;if(1===uniqueDomains.length){const domain=domains[0];if(isDataRefDomain(domain)&&sorts.length>0){let sort=sorts[0];if(sorts.length>1)warn(MORE_THAN_ONE_SORT),sort=!0;else if(vegaUtil.isObject(sort)&&"field"in sort){const sortField=sort.field;domain.field===sortField&&(sort=!sort.order||{order:sort.order})}return{...domain,sort:sort}}return domain}const unionDomainSorts=unique(sorts.map(s=>isBoolean(s)||!("op"in s)||vegaUtil.isString(s.op)&&s.op in MULTIDOMAIN_SORT_OP_INDEX?s:(warn(function(sort){return"Dropping sort property ".concat(stringify(sort),' as unioned domains only support boolean or op "count", "min", and "max".')}(s)),!0)),hash);let sort;1===unionDomainSorts.length?sort=unionDomainSorts[0]:unionDomainSorts.length>1&&(warn(MORE_THAN_ONE_SORT),sort=!0);const allData=unique(domains.map(d=>isDataRefDomain(d)?d.data:null),x=>x);return 1===allData.length&&null!==allData[0]?{data:allData[0],fields:uniqueDomains.map(d=>d.field),...sort?{sort:sort}:{}}:{fields:uniqueDomains,...sort?{sort:sort}:{}}}function getFieldFromDomain(domain){if(isDataRefDomain(domain)&&vegaUtil.isString(domain.field))return domain.field;if(function(domain){return!vegaUtil.isArray(domain)&&"fields"in domain&&!("data"in domain)}(domain)){let field;for(const nonUnionDomain of domain.fields)if(isDataRefDomain(nonUnionDomain)&&vegaUtil.isString(nonUnionDomain.field))if(field){if(field!==nonUnionDomain.field)return warn("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),field}else field=nonUnionDomain.field;return warn("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),field}if(function(domain){return!vegaUtil.isArray(domain)&&"fields"in domain&&"data"in domain}(domain)){warn("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const field=domain.fields[0];return vegaUtil.isString(field)?field:void 0}}function assembleDomain(model,channel){return mergeDomains(model.component.scales[channel].get("domains").map(domain=>(isDataRefDomain(domain)&&(domain.data=model.lookupDataSource(domain.data)),domain)))}function assembleScalesForModel(model){return keys(model.component.scales).reduce((scales,channel)=>{const scaleComponent=model.component.scales[channel];if(scaleComponent.merged)return scales;const scale=scaleComponent.combine(),{name:name,type:type,selectionExtent:selectionExtent,domains:_d,range:_r,reverse:reverse,...otherScaleProps}=scale,range=function(scaleRange,scaleName,channel,model){if(isXorY(channel)){if(isVgRangeStep(scaleRange))return{step:{signal:"".concat(scaleName,"_step")}}}else if(vegaUtil.isObject(scaleRange)&&isDataRefDomain(scaleRange))return{...scaleRange,data:model.lookupDataSource(scaleRange.data)};return scaleRange}(scale.range,name,channel,model),domain=assembleDomain(model,channel),domainRaw=selectionExtent?function(model,extent,scaleCmpt,domain){const parsedExtent=parseSelectionExtent(model,extent.param,extent);return{signal:hasContinuousDomain(scaleCmpt.get("type"))&&vegaUtil.isArray(domain)&&domain[0]>domain[1]?"isValid(".concat(parsedExtent,") && reverse(").concat(parsedExtent,")"):parsedExtent}}(model,selectionExtent,scaleComponent,domain):null;return scales.push({name:name,type:type,...domain?{domain:domain}:{},...domainRaw?{domainRaw:domainRaw}:{},range:range,...void 0!==reverse?{reverse:reverse}:{},...otherScaleProps}),scales},[])}class ScaleComponent extends Split{constructor(name,typeWithExplicit){super({},{name:name}),_defineProperty(this,"merged",!1),this.setWithExplicit("type",typeWithExplicit)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||some(this.get("domains"),d=>vegaUtil.isArray(d)&&2===d.length&&d[0]<=0&&d[1]>=0)}}const RANGE_PROPERTIES=["range","scheme"];function getSizeChannel$1(channel){return"x"===channel?"width":"y"===channel?"height":void 0}function getBinStepSignal(model,channel){const fieldDef=model.fieldDef(channel);if(null!=fieldDef&&fieldDef.bin){const{bin:bin,field:field}=fieldDef,sizeType=getSizeChannel$1(channel),sizeSignal=model.getName(sizeType);if(vegaUtil.isObject(bin)&&bin.binned&&void 0!==bin.step)return new SignalRefWrapper(()=>{const scaleName=model.scaleName(channel),binCount='(domain("'.concat(scaleName,'")[1] - domain("').concat(scaleName,'")[0]) / ').concat(bin.step);return"".concat(model.getSignalName(sizeSignal)," / (").concat(binCount,")")});if(isBinning(bin)){const binSignal=getBinSignalName(model,field,bin);return new SignalRefWrapper(()=>{const updatedName=model.getSignalName(binSignal),binCount="(".concat(updatedName,".stop - ").concat(updatedName,".start) / ").concat(updatedName,".step");return"".concat(model.getSignalName(sizeSignal)," / (").concat(binCount,")")})}}}function parseRangeForChannel(channel,model){const specifiedScale=model.specifiedScales[channel],{size:size}=model,scaleType=model.getScaleComponent(channel).get("type");for(const property of RANGE_PROPERTIES)if(void 0!==specifiedScale[property]){const supportedByScaleType=scaleTypeSupportProperty(scaleType,property),channelIncompatability=channelScalePropertyIncompatability(channel,property);if(supportedByScaleType)if(channelIncompatability)warn(channelIncompatability);else switch(property){case"range":{const range=specifiedScale.range;if(vegaUtil.isArray(range)){if(isXorY(channel))return makeExplicit(range.map(v=>{if("width"===v||"height"===v){const sizeSignal=model.getName(v),getSignalName=model.getSignalName.bind(model);return SignalRefWrapper.fromName(getSignalName,sizeSignal)}return v}))}else if(vegaUtil.isObject(range))return makeExplicit({data:model.requestDataName(DataSourceType.Main),field:range.field,sort:{op:"min",field:model.vgField(channel)}});return makeExplicit(range)}case"scheme":return makeExplicit(parseScheme(specifiedScale[property]))}else warn(scalePropertyNotWorkWithScaleType(scaleType,property,channel))}if(channel===X||channel===Y){const sizeChannel=channel===X?"width":"height",sizeValue=size[sizeChannel];if(isStep(sizeValue)){if(hasDiscreteDomain(scaleType))return makeExplicit({step:sizeValue.step});warn(stepDropped(sizeChannel))}}const{rangeMin:rangeMin,rangeMax:rangeMax}=specifiedScale,d=function(channel,model){const{size:size,config:config,mark:mark,encoding:encoding}=model,getSignalName=model.getSignalName.bind(model),{type:type}=getFieldOrDatumDef(encoding[channel]),scaleType=model.getScaleComponent(channel).get("type"),{domain:domain,domainMid:domainMid}=model.specifiedScales[channel];switch(channel){case X:case Y:{if(contains(["point","band"],scaleType))if(channel!==X||size.width){if(channel===Y&&!size.height){const h=getViewConfigDiscreteSize(config.view,"height");if(isStep(h))return h}}else{const w=getViewConfigDiscreteSize(config.view,"width");if(isStep(w))return w}const sizeType=getSizeChannel$1(channel),sizeSignal=model.getName(sizeType);return channel===Y&&hasContinuousDomain(scaleType)?[SignalRefWrapper.fromName(getSignalName,sizeSignal),0]:[0,SignalRefWrapper.fromName(getSignalName,sizeSignal)]}case SIZE:{const zero=model.component.scales[channel].get("zero"),rangeMin=function sizeRangeMin(mark,zero,config){if(zero)return isSignalRef(zero)?{signal:"".concat(zero.signal," ? 0 : ").concat(sizeRangeMin(mark,!1,config))}:0;switch(mark){case"bar":case"tick":return config.scale.minBandSize;case"line":case"trail":case"rule":return config.scale.minStrokeWidth;case"text":return config.scale.minFontSize;case"point":case"square":case"circle":return config.scale.minSize}throw new Error(incompatibleChannel("size",mark))}(mark,zero,config),rangeMax=function(mark,size,model,config){const xyStepSignals={x:getBinStepSignal(model,"x"),y:getBinStepSignal(model,"y")};switch(mark){case"bar":case"tick":{if(void 0!==config.scale.maxBandSize)return config.scale.maxBandSize;const min=minXYStep(size,xyStepSignals,config.view);return vegaUtil.isNumber(min)?min-1:new SignalRefWrapper(()=>"".concat(min.signal," - 1"))}case"line":case"trail":case"rule":return config.scale.maxStrokeWidth;case"text":return config.scale.maxFontSize;case"point":case"square":case"circle":{if(config.scale.maxSize)return config.scale.maxSize;const pointStep=minXYStep(size,xyStepSignals,config.view);return vegaUtil.isNumber(pointStep)?Math.pow(.95*pointStep,2):new SignalRefWrapper(()=>"pow(".concat(.95," * ").concat(pointStep.signal,", 2)"))}}throw new Error(incompatibleChannel("size",mark))}(mark,size,model,config);return isContinuousToDiscrete(scaleType)?function(rangeMin,rangeMax,cardinality){const f=()=>{const rMax=signalOrStringValue(rangeMax),rMin=signalOrStringValue(rangeMin),step="(".concat(rMax," - ").concat(rMin,") / (").concat(cardinality," - 1)");return"sequence(".concat(rMin,", ").concat(rMax," + ").concat(step,", ").concat(step,")")};return isSignalRef(rangeMax)?new SignalRefWrapper(f):{signal:f()}}(rangeMin,rangeMax,function(scaleType,config,domain,channel){switch(scaleType){case"quantile":return config.scale.quantileCount;case"quantize":return config.scale.quantizeCount;case"threshold":return void 0!==domain&&vegaUtil.isArray(domain)?domain.length+1:(warn(function(channel){return"Domain for ".concat(channel," is required for threshold scale.")}(channel)),3)}}(scaleType,config,domain,channel)):[rangeMin,rangeMax]}case THETA:return[0,2*Math.PI];case"angle":return[0,360];case RADIUS:return[0,new SignalRefWrapper(()=>{const w=model.getSignalName("width"),h=model.getSignalName("height");return"min(".concat(w,",").concat(h,")/2")})];case"strokeWidth":return[config.scale.minStrokeWidth,config.scale.maxStrokeWidth];case"strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case SHAPE:return"symbol";case COLOR:case FILL:case STROKE:return"ordinal"===scaleType?"nominal"===type?"category":"ordinal":void 0!==domainMid?"diverging":"rect"===mark||"geoshape"===mark?"heatmap":"ramp";case"opacity":case"fillOpacity":case"strokeOpacity":return[config.scale.minOpacity,config.scale.maxOpacity]}throw new Error("Scale range undefined for channel ".concat(channel))}(channel,model);return(void 0!==rangeMin||void 0!==rangeMax)&&scaleTypeSupportProperty(scaleType,"rangeMin")&&vegaUtil.isArray(d)&&2===d.length?makeExplicit([null!=rangeMin?rangeMin:d[0],null!=rangeMax?rangeMax:d[1]]):makeImplicit(d)}function parseScheme(scheme){return function(scheme){return!vegaUtil.isString(scheme)&&!!scheme.name}(scheme)?{scheme:scheme.name,...omit(scheme,["name"])}:{scheme:scheme}}function minXYStep(size,xyStepSignals,viewConfig){const widthStep=isStep(size.width)?size.width.step:getViewConfigDiscreteStep(viewConfig,"width"),heightStep=isStep(size.height)?size.height.step:getViewConfigDiscreteStep(viewConfig,"height");return xyStepSignals.x||xyStepSignals.y?new SignalRefWrapper(()=>{const exprs=[xyStepSignals.x?xyStepSignals.x.signal:widthStep,xyStepSignals.y?xyStepSignals.y.signal:heightStep];return"min(".concat(exprs.join(", "),")")}):Math.min(widthStep,heightStep)}function parseScaleProperty(model,property){isUnitModel(model)?function(model,property){const localScaleComponents=model.component.scales,{config:config,encoding:encoding,markDef:markDef,specifiedScales:specifiedScales}=model;for(const channel of keys(localScaleComponents)){const specifiedScale=specifiedScales[channel],localScaleCmpt=localScaleComponents[channel],mergedScaleCmpt=model.getScaleComponent(channel),fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]),specifiedValue=specifiedScale[property],scaleType=mergedScaleCmpt.get("type"),scalePadding=mergedScaleCmpt.get("padding"),scalePaddingInner=mergedScaleCmpt.get("paddingInner"),supportedByScaleType=scaleTypeSupportProperty(scaleType,property),channelIncompatability=channelScalePropertyIncompatability(channel,property);if(void 0!==specifiedValue&&(supportedByScaleType?channelIncompatability&&warn(channelIncompatability):warn(scalePropertyNotWorkWithScaleType(scaleType,property,channel))),supportedByScaleType&&void 0===channelIncompatability)if(void 0!==specifiedValue){const timeUnit=fieldOrDatumDef.timeUnit,type=fieldOrDatumDef.type;switch(property){case"domainMax":case"domainMin":isDateTime(specifiedScale[property])||"temporal"===type||timeUnit?localScaleCmpt.set(property,{signal:valueExpr(specifiedScale[property],{type:type,timeUnit:timeUnit})},!0):localScaleCmpt.set(property,specifiedScale[property],!0);break;default:localScaleCmpt.copyKeyFromObject(property,specifiedScale)}}else{const value=property in scaleRules?scaleRules[property]({model:model,channel:channel,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType,scalePadding:scalePadding,scalePaddingInner:scalePaddingInner,domain:specifiedScale.domain,markDef:markDef,config:config}):config.scale[property];void 0!==value&&localScaleCmpt.set(property,value,!1)}}}(model,property):parseNonUnitScaleProperty(model,property)}const scaleRules={bins:({model:model,fieldOrDatumDef:fieldOrDatumDef})=>isFieldDef(fieldOrDatumDef)?function(model,fieldDef){const bin=fieldDef.bin;if(isBinning(bin)){const binSignal=getBinSignalName(model,fieldDef.field,bin);return new SignalRefWrapper(()=>model.getSignalName(binSignal))}if(isBinned(bin)&&isBinParams(bin)&&void 0!==bin.step)return{step:bin.step}}(model,fieldOrDatumDef):void 0,interpolate:({channel:channel,fieldOrDatumDef:fieldOrDatumDef})=>function(channel,type){if(contains([COLOR,FILL,STROKE],channel)&&"nominal"!==type)return"hcl"}(channel,fieldOrDatumDef.type),nice:({scaleType:scaleType,channel:channel,domain:domain,fieldOrDatumDef:fieldOrDatumDef})=>function(scaleType,channel,specifiedDomain,fieldOrDatumDef){var _getFieldDef;if(!(null!==(_getFieldDef=getFieldDef(fieldOrDatumDef))&&void 0!==_getFieldDef&&_getFieldDef.bin||vegaUtil.isArray(specifiedDomain)||contains([ScaleType_TIME,ScaleType_UTC],scaleType)))return channel in POSITION_SCALE_CHANNEL_INDEX||void 0}(scaleType,channel,domain,fieldOrDatumDef),padding:({channel:channel,scaleType:scaleType,fieldOrDatumDef:fieldOrDatumDef,markDef:markDef,config:config})=>function(channel,scaleType,scaleConfig,fieldOrDatumDef,markDef,barConfig){if(channel in POSITION_SCALE_CHANNEL_INDEX){if(isContinuousToContinuous(scaleType)){if(void 0!==scaleConfig.continuousPadding)return scaleConfig.continuousPadding;const{type:type,orient:orient}=markDef;if("bar"===type&&(!isFieldDef(fieldOrDatumDef)||!fieldOrDatumDef.bin&&!fieldOrDatumDef.timeUnit)&&("vertical"===orient&&"x"===channel||"horizontal"===orient&&"y"===channel))return barConfig.continuousBandSize}if(scaleType===ScaleType_POINT)return scaleConfig.pointPadding}}(channel,scaleType,config.scale,fieldOrDatumDef,markDef,config.bar),paddingInner:({scalePadding:scalePadding,channel:channel,markDef:markDef,config:config})=>function(paddingValue,channel,mark,scaleConfig){if(void 0===paddingValue&&channel in POSITION_SCALE_CHANNEL_INDEX){const{bandPaddingInner:bandPaddingInner,barBandPaddingInner:barBandPaddingInner,rectBandPaddingInner:rectBandPaddingInner}=scaleConfig;return getFirstDefined(bandPaddingInner,"bar"===mark?barBandPaddingInner:rectBandPaddingInner)}}(scalePadding,channel,markDef.type,config.scale),paddingOuter:({scalePadding:scalePadding,channel:channel,scaleType:scaleType,markDef:markDef,scalePaddingInner:scalePaddingInner,config:config})=>function(paddingValue,channel,scaleType,mark,paddingInnerValue,scaleConfig){if(void 0===paddingValue&&channel in POSITION_SCALE_CHANNEL_INDEX&&scaleType===ScaleType_BAND){const{bandPaddingOuter:bandPaddingOuter}=scaleConfig;return getFirstDefined(bandPaddingOuter,isSignalRef(paddingInnerValue)?{signal:"".concat(paddingInnerValue.signal,"/2")}:paddingInnerValue/2)}}(scalePadding,channel,scaleType,markDef.type,scalePaddingInner,config.scale),reverse:({fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType,channel:channel,config:config})=>function(scaleType,sort,channel,scaleConfig){return"x"===channel&&void 0!==scaleConfig.xReverse?hasContinuousDomain(scaleType)&&"descending"===sort?isSignalRef(scaleConfig.xReverse)?{signal:"!".concat(scaleConfig.xReverse.signal)}:!scaleConfig.xReverse:scaleConfig.xReverse:!(!hasContinuousDomain(scaleType)||"descending"!==sort)||void 0}(scaleType,isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.sort:void 0,channel,config.scale),zero:({channel:channel,fieldOrDatumDef:fieldOrDatumDef,domain:domain,markDef:markDef,scaleType:scaleType})=>function(channel,fieldDef,specifiedDomain,markDef,scaleType){if(specifiedDomain&&"unaggregated"!==specifiedDomain&&hasContinuousDomain(scaleType)){if(vegaUtil.isArray(specifiedDomain)){const first=specifiedDomain[0],last=specifiedDomain[specifiedDomain.length-1];if(first<=0&&last>=0)return!0}return!1}if("size"===channel&&"quantitative"===fieldDef.type&&!isContinuousToDiscrete(scaleType))return!0;if((!isFieldDef(fieldDef)||!fieldDef.bin)&&contains([...POSITION_SCALE_CHANNELS,...POLAR_POSITION_SCALE_CHANNELS],channel)){const{orient:orient,type:type}=markDef;return!contains(["bar","area","line","trail"],type)||!("horizontal"===orient&&"y"===channel||"vertical"===orient&&"x"===channel)}return!1}(channel,fieldOrDatumDef,domain,markDef,scaleType)};function parseScaleRange(model){isUnitModel(model)?function(model){const localScaleComponents=model.component.scales;for(const channel of SCALE_CHANNELS){const localScaleCmpt=localScaleComponents[channel];if(!localScaleCmpt)continue;const rangeWithExplicit=parseRangeForChannel(channel,model);localScaleCmpt.setWithExplicit("range",rangeWithExplicit)}}(model):parseNonUnitScaleProperty(model,"range")}function parseNonUnitScaleProperty(model,property){const localScaleComponents=model.component.scales;for(const child of model.children)"range"===property?parseScaleRange(child):parseScaleProperty(child,property);for(const channel of keys(localScaleComponents)){let valueWithExplicit;for(const child of model.children){const childComponent=child.component.scales[channel];childComponent&&(valueWithExplicit=mergeValuesWithExplicit(valueWithExplicit,childComponent.getWithExplicit(property),property,"scale",tieBreakByComparing((v1,v2)=>{switch(property){case"range":return v1.step&&v2.step?v1.step-v2.step:0}return 0})))}localScaleComponents[channel].setWithExplicit(property,valueWithExplicit)}}function scaleType(specifiedScale,channel,fieldDef,mark){const defaultScaleType=function(channel,fieldDef,mark){switch(fieldDef.type){case"nominal":case"ordinal":var _fieldDef$axis;if(isColorChannel(channel)||"discrete"===rangeType(channel))return"shape"===channel&&"ordinal"===fieldDef.type&&warn(discreteChannelCannotEncode(channel,"ordinal")),"ordinal";if(channel in POSITION_SCALE_CHANNEL_INDEX){if(contains(["rect","bar","image","rule"],mark.type))return"band"}else if("arc"===mark.type&&channel in POLAR_POSITION_SCALE_CHANNEL_INDEX)return"band";return isRelativeBandSize(mark[getSizeChannel(channel)])||isPositionFieldOrDatumDef(fieldDef)&&null!==(_fieldDef$axis=fieldDef.axis)&&void 0!==_fieldDef$axis&&_fieldDef$axis.tickBand?"band":"point";case"temporal":return isColorChannel(channel)?"time":"discrete"===rangeType(channel)?(warn(discreteChannelCannotEncode(channel,"temporal")),"ordinal"):isFieldDef(fieldDef)&&fieldDef.timeUnit&&normalizeTimeUnit(fieldDef.timeUnit).utc?"utc":"time";case"quantitative":return isColorChannel(channel)?isFieldDef(fieldDef)&&isBinning(fieldDef.bin)?"bin-ordinal":"linear":"discrete"===rangeType(channel)?(warn(discreteChannelCannotEncode(channel,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(invalidFieldType(fieldDef.type))}(channel,fieldDef,mark),{type:type}=specifiedScale;return isScaleChannel(channel)?void 0!==type?function(channel,scaleType){if(!isScaleChannel(channel))return!1;switch(channel){case X:case Y:case THETA:case RADIUS:return isContinuousToContinuous(scaleType)||contains(["band","point"],scaleType);case SIZE:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case"angle":return isContinuousToContinuous(scaleType)||isContinuousToDiscrete(scaleType)||contains(["band","point","ordinal"],scaleType);case COLOR:case FILL:case STROKE:return"band"!==scaleType;case"strokeDash":case SHAPE:return"ordinal"===scaleType||isContinuousToDiscrete(scaleType)}}(channel,type)?isFieldDef(fieldDef)&&(specifiedType=type,fieldDefType=fieldDef.type,!(contains([ORDINAL,NOMINAL],fieldDefType)?void 0===specifiedType||hasDiscreteDomain(specifiedType):fieldDefType===TEMPORAL?contains([ScaleType_TIME,ScaleType_UTC,void 0],specifiedType):fieldDefType!==QUANTITATIVE||contains([ScaleType_LOG,ScaleType_POW,ScaleType_SQRT,ScaleType_SYMLOG,ScaleType_QUANTILE,ScaleType_QUANTIZE,ScaleType_THRESHOLD,ScaleType_LINEAR,void 0],specifiedType)))?(warn(function(scaleType,defaultScaleType){return'FieldDef does not work with "'.concat(scaleType,'" scale. We are using "').concat(defaultScaleType,'" scale instead.')}(type,defaultScaleType)),defaultScaleType):type:(warn(function(channel,scaleType,defaultScaleType){return'Channel "'.concat(channel,'" does not work with "').concat(scaleType,'" scale. We are using "').concat(defaultScaleType,'" scale instead.')}(channel,type,defaultScaleType)),defaultScaleType):defaultScaleType:null;var specifiedType,fieldDefType}function parseScaleCore(model){isUnitModel(model)?model.component.scales=function(model){const{encoding:encoding,mark:mark,markDef:markDef}=model;return SCALE_CHANNELS.reduce((scaleComponents,channel)=>{const fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]);if(fieldOrDatumDef&&mark===GEOSHAPE&&channel===SHAPE&&fieldOrDatumDef.type===GEOJSON)return scaleComponents;let specifiedScale=fieldOrDatumDef&&fieldOrDatumDef.scale;if(fieldOrDatumDef&&null!==specifiedScale&&!1!==specifiedScale){var _specifiedScale;null!==(_specifiedScale=specifiedScale)&&void 0!==_specifiedScale||(specifiedScale={});const sType=scaleType(specifiedScale,channel,fieldOrDatumDef,markDef);scaleComponents[channel]=new ScaleComponent(model.scaleName("".concat(channel),!0),{value:sType,explicit:specifiedScale.type===sType})}return scaleComponents},{})}(model):model.component.scales=function(model){const scaleComponents=model.component.scales={},scaleTypeWithExplicitIndex={},resolve=model.component.resolve;for(const child of model.children){parseScaleCore(child);for(const channel of keys(child.component.scales)){var _resolve$scale,_resolve$scale$channe;if(null!==(_resolve$scale$channe=(_resolve$scale=resolve.scale)[channel])&&void 0!==_resolve$scale$channe||(_resolve$scale[channel]=defaultScaleResolve(channel,model)),"shared"===resolve.scale[channel]){const explicitScaleType=scaleTypeWithExplicitIndex[channel],childScaleType=child.component.scales[channel].getWithExplicit("type");explicitScaleType?scaleCompatible(explicitScaleType.value,childScaleType.value)?scaleTypeWithExplicitIndex[channel]=mergeValuesWithExplicit(explicitScaleType,childScaleType,"type","scale",scaleTypeTieBreaker):(resolve.scale[channel]="independent",delete scaleTypeWithExplicitIndex[channel]):scaleTypeWithExplicitIndex[channel]=childScaleType}}}for(const channel of keys(scaleTypeWithExplicitIndex)){const name=model.scaleName(channel,!0),typeWithExplicit=scaleTypeWithExplicitIndex[channel];scaleComponents[channel]=new ScaleComponent(name,typeWithExplicit);for(const child of model.children){const childScale=child.component.scales[channel];childScale&&(child.renameScale(childScale.get("name"),name),childScale.merged=!0)}}return scaleComponents}(model)}const scaleTypeTieBreaker=tieBreakByComparing((st1,st2)=>scaleTypePrecedence(st1)-scaleTypePrecedence(st2));class NameMap{constructor(){_defineProperty(this,"nameMap",void 0),this.nameMap={}}rename(oldName,newName){this.nameMap[oldName]=newName}has(name){return void 0!==this.nameMap[name]}get(name){for(;this.nameMap[name]&&name!==this.nameMap[name];)name=this.nameMap[name];return name}}function isUnitModel(model){return"unit"===(null==model?void 0:model.type)}function isFacetModel(model){return"facet"===(null==model?void 0:model.type)}function isConcatModel(model){return"concat"===(null==model?void 0:model.type)}function isLayerModel(model){return"layer"===(null==model?void 0:model.type)}class Model{constructor(spec,type,parent,parentGivenName,config,resolve,view){var _spec$name,_spec$transform;this.type=type,this.parent=parent,this.config=config,_defineProperty(this,"name",void 0),_defineProperty(this,"size",void 0),_defineProperty(this,"title",void 0),_defineProperty(this,"description",void 0),_defineProperty(this,"data",void 0),_defineProperty(this,"transforms",void 0),_defineProperty(this,"layout",void 0),_defineProperty(this,"scaleNameMap",void 0),_defineProperty(this,"projectionNameMap",void 0),_defineProperty(this,"signalNameMap",void 0),_defineProperty(this,"component",void 0),_defineProperty(this,"view",void 0),_defineProperty(this,"children",[]),_defineProperty(this,"correctDataNames",mark=>(mark.from&&mark.from.data&&(mark.from.data=this.lookupDataSource(mark.from.data)),mark.from&&mark.from.facet&&mark.from.facet.data&&(mark.from.facet.data=this.lookupDataSource(mark.from.facet.data)),mark)),this.parent=parent,this.config=config,this.view=replaceExprRef(view),this.name=null!==(_spec$name=spec.name)&&void 0!==_spec$name?_spec$name:parentGivenName,this.title=isText(spec.title)?{text:spec.title}:spec.title?replaceExprRef(spec.title):void 0,this.scaleNameMap=parent?parent.scaleNameMap:new NameMap,this.projectionNameMap=parent?parent.projectionNameMap:new NameMap,this.signalNameMap=parent?parent.signalNameMap:new NameMap,this.data=spec.data,this.description=spec.description,this.transforms=(null!==(_spec$transform=spec.transform)&&void 0!==_spec$transform?_spec$transform:[]).map(t=>isFilter(t)?{filter:normalizeLogicalComposition(t.filter,normalizePredicate)}:t),this.layout="layer"===type||"unit"===type?{}:function(spec,specType,config){const compositionConfig=config[specType],layout={},{spacing:spacingConfig,columns:columns}=compositionConfig;void 0!==spacingConfig&&(layout.spacing=spacingConfig),void 0!==columns&&(isFacetSpec(spec)&&!isFacetMapping(spec.facet)||isConcatSpec(spec))&&(layout.columns=columns),isVConcatSpec(spec)&&(layout.columns=1);for(const prop of COMPOSITION_LAYOUT_PROPERTIES)if(void 0!==spec[prop])if("spacing"===prop){var _spacing$row,_spacing$column;const spacing=spec[prop];layout[prop]=vegaUtil.isNumber(spacing)?spacing:{row:null!==(_spacing$row=spacing.row)&&void 0!==_spacing$row?_spacing$row:spacingConfig,column:null!==(_spacing$column=spacing.column)&&void 0!==_spacing$column?_spacing$column:spacingConfig}}else layout[prop]=spec[prop];return layout}(spec,type,config),this.component={data:{sources:parent?parent.component.data.sources:[],outputNodes:parent?parent.component.data.outputNodes:{},outputNodeRefCounts:parent?parent.component.data.outputNodeRefCounts:{},isFaceted:isFacetSpec(spec)||parent&&parent.component.data.isFaceted&&void 0===spec.data},layoutSize:new Split,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...resolve?duplicate(resolve):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(model,{ignoreRange:ignoreRange}={}){parseScaleCore(model),parseScaleDomain(model);for(const prop of NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES)parseScaleProperty(model,prop);ignoreRange||parseScaleRange(model)}(this)}parseProjection(){parseProjection(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){parseLegend(this)}assembleGroupStyle(){var _this$view$style,_this$view;if("unit"===this.type||"layer"===this.type)return null!==(_this$view$style=null===(_this$view=this.view)||void 0===_this$view?void 0:_this$view.style)&&void 0!==_this$view$style?_this$view$style:"cell"}assembleEncodeFromView(view){const{style:_,...baseView}=view,e={};for(const property of keys(baseView)){const value=baseView[property];void 0!==value&&(e[property]=signalOrValueRef(value))}return e}assembleGroupEncodeEntry(isTopLevel){let encodeEntry={};var _encodeEntry;return this.view&&(encodeEntry=this.assembleEncodeFromView(this.view)),isTopLevel||(this.description&&(encodeEntry.description=signalOrValueRef(this.description)),"unit"!==this.type&&"layer"!==this.type)?isEmpty(encodeEntry)?void 0:encodeEntry:{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...null!==(_encodeEntry=encodeEntry)&&void 0!==_encodeEntry?_encodeEntry:{}}}assembleLayout(){if(!this.layout)return;const{spacing:spacing,...layout}=this.layout,{component:component,config:config}=this,titleBand=function(headerComponentIndex,config){const titleBand={};for(const channel of FACET_CHANNELS){const headerComponent=headerComponentIndex[channel];if(null!=headerComponent&&headerComponent.facetFieldDef){const{titleAnchor:titleAnchor,titleOrient:titleOrient}=getHeaderProperties(["titleAnchor","titleOrient"],headerComponent.facetFieldDef.header,config,channel),headerChannel=getHeaderChannel(channel,titleOrient),band=getLayoutTitleBand(titleAnchor,headerChannel);void 0!==band&&(titleBand[headerChannel]=band)}}return isEmpty(titleBand)?void 0:titleBand}(component.layoutHeaders,config);return{padding:spacing,...this.assembleDefaultLayout(),...layout,...titleBand?{titleBand:titleBand}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:layoutHeaders}=this.component;let headerMarks=[];for(const channel of FACET_CHANNELS)layoutHeaders[channel].title&&headerMarks.push(assembleTitleGroup(this,channel));for(const channel of HEADER_CHANNELS)headerMarks=headerMarks.concat(assembleHeaderGroups(this,channel));return headerMarks}assembleAxes(){return function(axisComponents,config){const{x:x=[],y:y=[]}=axisComponents;return[...x.map(a=>assembleAxis(a,"grid",config)),...y.map(a=>assembleAxis(a,"grid",config)),...x.map(a=>assembleAxis(a,"main",config)),...y.map(a=>assembleAxis(a,"main",config))].filter(a=>a)}(this.component.axes,this.config)}assembleLegends(){return assembleLegends(this)}assembleProjections(){return assembleProjections(this)}assembleTitle(){var _this$title;const{encoding:encoding,...titleNoEncoding}=null!==(_this$title=this.title)&&void 0!==_this$title?_this$title:{},title={...extractTitleConfig(this.config.title).nonMark,...titleNoEncoding,...encoding?{encode:{update:encoding}}:{}};var _title$frame,_title$anchor;if(title.text)return contains(["unit","layer"],this.type)?contains(["middle",void 0],title.anchor)&&(null!==(_title$frame=title.frame)&&void 0!==_title$frame||(title.frame="group")):null!==(_title$anchor=title.anchor)&&void 0!==_title$anchor||(title.anchor="start"),isEmpty(title)?void 0:title}assembleGroup(signals=[]){const group={};(signals=signals.concat(this.assembleSignals())).length>0&&(group.signals=signals);const layout=this.assembleLayout();layout&&(group.layout=layout),group.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const scales=!this.parent||isFacetModel(this.parent)?function assembleScales(model){return isLayerModel(model)||isConcatModel(model)?model.children.reduce((scales,child)=>scales.concat(assembleScales(child)),assembleScalesForModel(model)):assembleScalesForModel(model)}(this):[];scales.length>0&&(group.scales=scales);const axes=this.assembleAxes();axes.length>0&&(group.axes=axes);const legends=this.assembleLegends();return legends.length>0&&(group.legends=legends),group}getName(text){return varName((this.name?"".concat(this.name,"_"):"")+text)}getDataName(type){return this.getName(DataSourceType[type].toLowerCase())}requestDataName(name){const fullName=this.getDataName(name),refCounts=this.component.data.outputNodeRefCounts;return refCounts[fullName]=(refCounts[fullName]||0)+1,fullName}getSizeSignalRef(layoutSizeType){if(isFacetModel(this.parent)){const channel=getPositionScaleChannel(getSizeTypeFromLayoutSizeType(layoutSizeType)),scaleComponent=this.component.scales[channel];if(scaleComponent&&!scaleComponent.merged){const type=scaleComponent.get("type"),range=scaleComponent.get("range");if(hasDiscreteDomain(type)&&isVgRangeStep(range)){const scaleName=scaleComponent.get("name"),field=getFieldFromDomain(assembleDomain(this,channel));return field?{signal:sizeExpr(scaleName,scaleComponent,vgField({aggregate:"distinct",field:field},{expr:"datum"}))}:(warn(unknownField(channel)),null)}}}return{signal:this.signalNameMap.get(this.getName(layoutSizeType))}}lookupDataSource(name){const node=this.component.data.outputNodes[name];return node?node.getSource():name}getSignalName(oldSignalName){return this.signalNameMap.get(oldSignalName)}renameSignal(oldName,newName){this.signalNameMap.rename(oldName,newName)}renameScale(oldName,newName){this.scaleNameMap.rename(oldName,newName)}renameProjection(oldName,newName){this.projectionNameMap.rename(oldName,newName)}scaleName(originalScaleName,parse){return parse?this.getName(originalScaleName):isChannel(originalScaleName)&&isScaleChannel(originalScaleName)&&this.component.scales[originalScaleName]||this.scaleNameMap.has(this.getName(originalScaleName))?this.scaleNameMap.get(this.getName(originalScaleName)):void 0}projectionName(parse){return parse?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(channel){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const localScaleComponent=this.component.scales[channel];return localScaleComponent&&!localScaleComponent.merged?localScaleComponent:this.parent?this.parent.getScaleComponent(channel):void 0}getSelectionComponent(variableName,origName){let sel=this.component.selection[variableName];if(!sel&&this.parent&&(sel=this.parent.getSelectionComponent(variableName,origName)),!sel)throw new Error(function(name){return'Cannot find a selection named "'.concat(name,'".')}(origName));return sel}hasAxisOrientSignalRef(){var _this$component$axes$,_this$component$axes$2;return(null===(_this$component$axes$=this.component.axes.x)||void 0===_this$component$axes$?void 0:_this$component$axes$.some(a=>a.hasOrientSignalRef()))||(null===(_this$component$axes$2=this.component.axes.y)||void 0===_this$component$axes$2?void 0:_this$component$axes$2.some(a=>a.hasOrientSignalRef()))}}class ModelWithField extends Model{vgField(channel,opt={}){const fieldDef=this.fieldDef(channel);if(fieldDef)return vgField(fieldDef,opt)}reduceFieldDef(f,init){return function(mapping,f,init,thisArg){return mapping?keys(mapping).reduce((r,channel)=>{const map=mapping[channel];return vegaUtil.isArray(map)?map.reduce((r1,channelDef)=>f.call(thisArg,r1,channelDef,channel),r):f.call(thisArg,r,map,channel)},init):init}(this.getMapping(),(acc,cd,c)=>{const fieldDef=getFieldDef(cd);return fieldDef?f(acc,fieldDef,c):acc},init)}forEachFieldDef(f,t){forEach(this.getMapping(),(cd,c)=>{const fieldDef=getFieldDef(cd);fieldDef&&f(fieldDef,c)},t)}}class DensityTransformNode extends DataFlowNode{clone(){return new DensityTransformNode(null,duplicate(this.transform))}constructor(parent,transform){var _this$transform$as,_specifiedAs$,_specifiedAs$2;super(parent),this.transform=transform,this.transform=duplicate(transform);const specifiedAs=null!==(_this$transform$as=this.transform.as)&&void 0!==_this$transform$as?_this$transform$as:[void 0,void 0];this.transform.as=[null!==(_specifiedAs$=specifiedAs[0])&&void 0!==_specifiedAs$?_specifiedAs$:"value",null!==(_specifiedAs$2=specifiedAs[1])&&void 0!==_specifiedAs$2?_specifiedAs$2:"density"]}dependentFields(){var _this$transform$group;return new Set([this.transform.density,...null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform ".concat(hash(this.transform))}assemble(){const{density:density,...rest}=this.transform;return{type:"kde",field:density,...rest}}}class FilterInvalidNode extends DataFlowNode{clone(){return new FilterInvalidNode(null,{...this.filter})}constructor(parent,filter){super(parent),this.filter=filter}static make(parent,model){const{config:config,mark:mark,markDef:markDef}=model;if("filter"!==getMarkPropOrConfig("invalid",markDef,config))return null;const filter=model.reduceFieldDef((aggregator,fieldDef,channel)=>{const scaleComponent=isScaleChannel(channel)&&model.getScaleComponent(channel);return scaleComponent&&hasContinuousDomain(scaleComponent.get("type"))&&"count"!==fieldDef.aggregate&&!isPathMark(mark)&&(aggregator[fieldDef.field]=fieldDef),aggregator},{});return keys(filter).length?new FilterInvalidNode(parent,filter):null}dependentFields(){return new Set(keys(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid ".concat(hash(this.filter))}assemble(){const filters=keys(this.filter).reduce((vegaFilters,field)=>{const fieldDef=this.filter[field],ref=vgField(fieldDef,{expr:"datum"});return null!==fieldDef&&("temporal"===fieldDef.type?vegaFilters.push("(isDate(".concat(ref,") || (isValid(").concat(ref,") && isFinite(+").concat(ref,")))")):"quantitative"===fieldDef.type&&(vegaFilters.push("isValid(".concat(ref,")")),vegaFilters.push("isFinite(+".concat(ref,")")))),vegaFilters},[]);return filters.length>0?{type:"filter",expr:filters.join(" && ")}:null}}class FlattenTransformNode extends DataFlowNode{clone(){return new FlattenTransformNode(this.parent,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform,this.transform=duplicate(transform);const{flatten:flatten,as:as=[]}=this.transform;this.transform.as=flatten.map((f,i)=>{var _as$i;return null!==(_as$i=as[i])&&void 0!==_as$i?_as$i:f})}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform ".concat(hash(this.transform))}assemble(){const{flatten:fields,as:as}=this.transform;return{type:"flatten",fields:fields,as:as}}}class FoldTransformNode extends DataFlowNode{clone(){return new FoldTransformNode(null,duplicate(this.transform))}constructor(parent,transform){var _this$transform$as,_specifiedAs$,_specifiedAs$2;super(parent),this.transform=transform,this.transform=duplicate(transform);const specifiedAs=null!==(_this$transform$as=this.transform.as)&&void 0!==_this$transform$as?_this$transform$as:[void 0,void 0];this.transform.as=[null!==(_specifiedAs$=specifiedAs[0])&&void 0!==_specifiedAs$?_specifiedAs$:"key",null!==(_specifiedAs$2=specifiedAs[1])&&void 0!==_specifiedAs$2?_specifiedAs$2:"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform ".concat(hash(this.transform))}assemble(){const{fold:fold,as:as}=this.transform;return{type:"fold",fields:fold,as:as}}}class GeoJSONNode extends DataFlowNode{clone(){return new GeoJSONNode(null,duplicate(this.fields),this.geojson,this.signal)}static parseAll(parent,model){if(model.component.projection&&!model.component.projection.isFit)return parent;let geoJsonCounter=0;for(const coordinates of[["longitude","latitude"],["longitude2","latitude2"]]){const pair=coordinates.map(channel=>{const def=getFieldOrDatumDef(model.encoding[channel]);return isFieldDef(def)?def.field:isDatumDef(def)?{expr:"".concat(def.datum)}:isValueDef(def)?{expr:"".concat(def.value)}:void 0});(pair[0]||pair[1])&&(parent=new GeoJSONNode(parent,pair,null,model.getName("geojson_".concat(geoJsonCounter++))))}if(model.channelHasField(SHAPE)){const fieldDef=model.typedFieldDef(SHAPE);fieldDef.type===GEOJSON&&(parent=new GeoJSONNode(parent,null,fieldDef.field,model.getName("geojson_".concat(geoJsonCounter++))))}return parent}constructor(parent,fields,geojson,signal){super(parent),this.fields=fields,this.geojson=geojson,this.signal=signal}dependentFields(){var _this$fields;const fields=(null!==(_this$fields=this.fields)&&void 0!==_this$fields?_this$fields:[]).filter(vegaUtil.isString);return new Set([...this.geojson?[this.geojson]:[],...fields])}producedFields(){return new Set}hash(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(hash(this.fields))}assemble(){return[...this.geojson?[{type:"filter",expr:'isValid(datum["'.concat(this.geojson,'"])')}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class GeoPointNode extends DataFlowNode{clone(){return new GeoPointNode(null,this.projection,duplicate(this.fields),duplicate(this.as))}constructor(parent,projection,fields,as){super(parent),this.projection=projection,this.fields=fields,this.as=as}static parseAll(parent,model){if(!model.projectionName())return parent;for(const coordinates of[["longitude","latitude"],["longitude2","latitude2"]]){const pair=coordinates.map(channel=>{const def=getFieldOrDatumDef(model.encoding[channel]);return isFieldDef(def)?def.field:isDatumDef(def)?{expr:"".concat(def.datum)}:isValueDef(def)?{expr:"".concat(def.value)}:void 0}),suffix="longitude2"===coordinates[0]?"2":"";(pair[0]||pair[1])&&(parent=new GeoPointNode(parent,model.projectionName(),pair,[model.getName("x".concat(suffix)),model.getName("y".concat(suffix))]))}return parent}dependentFields(){return new Set(this.fields.filter(vegaUtil.isString))}producedFields(){return new Set(this.as)}hash(){return"Geopoint ".concat(this.projection," ").concat(hash(this.fields)," ").concat(hash(this.as))}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class ImputeNode extends DataFlowNode{clone(){return new ImputeNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform}dependentFields(){var _this$transform$group;return new Set([this.transform.impute,this.transform.key,...null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(keyvals){const{start:start=0,stop:stop,step:step}=keyvals,result=[start,stop,...step?[step]:[]].join(",");return{signal:"sequence(".concat(result,")")}}static makeFromTransform(parent,imputeTransform){return new ImputeNode(parent,imputeTransform)}static makeFromEncoding(parent,model){const encoding=model.encoding,xDef=encoding.x,yDef=encoding.y;if(isFieldDef(xDef)&&isFieldDef(yDef)){const imputedChannel=xDef.impute?xDef:yDef.impute?yDef:void 0;if(void 0===imputedChannel)return;const keyChannel=xDef.impute?yDef:yDef.impute?xDef:void 0,{method:method,value:value,frame:frame,keyvals:keyvals}=imputedChannel.impute,groupbyFields=pathGroupingFields(model.mark,encoding);return new ImputeNode(parent,{impute:imputedChannel.field,key:keyChannel.field,...method?{method:method}:{},...void 0!==value?{value:value}:{},...frame?{frame:frame}:{},...void 0!==keyvals?{keyvals:keyvals}:{},...groupbyFields.length?{groupby:groupbyFields}:{}})}return null}hash(){return"Impute ".concat(hash(this.transform))}assemble(){const{impute:impute,key:key,keyvals:keyvals,method:method,groupby:groupby,value:value,frame:frame=[null,null]}=this.transform,imputeTransform={type:"impute",field:impute,key:key,...keyvals?{keyvals:(t=keyvals,void 0!==(null==t?void 0:t.stop)?this.processSequence(keyvals):keyvals)}:{},method:"value",...groupby?{groupby:groupby}:{},value:method&&"value"!==method?null:value};var t;return method&&"value"!==method?[imputeTransform,{type:"window",as:["imputed_".concat(impute,"_value")],ops:[method],fields:[impute],frame:frame,ignorePeers:!1,...groupby?{groupby:groupby}:{}},{type:"formula",expr:"datum.".concat(impute," === null ? datum.imputed_").concat(impute,"_value : datum.").concat(impute),as:impute}]:[imputeTransform]}}class LoessTransformNode extends DataFlowNode{clone(){return new LoessTransformNode(null,duplicate(this.transform))}constructor(parent,transform){var _this$transform$as,_specifiedAs$,_specifiedAs$2;super(parent),this.transform=transform,this.transform=duplicate(transform);const specifiedAs=null!==(_this$transform$as=this.transform.as)&&void 0!==_this$transform$as?_this$transform$as:[void 0,void 0];this.transform.as=[null!==(_specifiedAs$=specifiedAs[0])&&void 0!==_specifiedAs$?_specifiedAs$:transform.on,null!==(_specifiedAs$2=specifiedAs[1])&&void 0!==_specifiedAs$2?_specifiedAs$2:transform.loess]}dependentFields(){var _this$transform$group;return new Set([this.transform.loess,this.transform.on,...null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform ".concat(hash(this.transform))}assemble(){const{loess:loess,on:on,...rest}=this.transform;return{type:"loess",x:on,y:loess,...rest}}}class LookupNode extends DataFlowNode{clone(){return new LookupNode(null,duplicate(this.transform),this.secondary)}constructor(parent,transform,secondary){super(parent),this.transform=transform,this.secondary=secondary}static make(parent,model,transform,counter){const sources=model.component.data.sources,{from:from}=transform;let fromOutputNode=null;if(function(from){return"data"in from}(from)){let fromSource=findSource(from.data,sources);fromSource||(fromSource=new SourceNode(from.data),sources.push(fromSource));const fromOutputName=model.getName("lookup_".concat(counter));fromOutputNode=new OutputNode(fromSource,fromOutputName,DataSourceType.Lookup,model.component.data.outputNodeRefCounts),model.component.data.outputNodes[fromOutputName]=fromOutputNode}else if(function(from){return"param"in from}(from)){const selName=from.param;let selCmpt;transform={as:selName,...transform};try{selCmpt=model.getSelectionComponent(varName(selName),selName)}catch(e){throw new Error(function(name){return'Lookups can only be performed on selection parameters. "'.concat(name,'" is a variable parameter.')}(selName))}if(fromOutputNode=selCmpt.materialized,!fromOutputNode)throw new Error(function(name){return'Cannot define and lookup the "'.concat(name,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?"}(selName))}return new LookupNode(parent,transform,fromOutputNode.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?vegaUtil.array(this.transform.as):this.transform.from.fields)}hash(){return"Lookup ".concat(hash({transform:this.transform,secondary:this.secondary}))}assemble(){let foreign;if(this.transform.from.fields)foreign={values:this.transform.from.fields,...this.transform.as?{as:vegaUtil.array(this.transform.as)}:{}};else{let asName=this.transform.as;vegaUtil.isString(asName)||(warn('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),asName="_lookup"),foreign={as:[asName]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...foreign,...this.transform.default?{default:this.transform.default}:{}}}}class QuantileTransformNode extends DataFlowNode{clone(){return new QuantileTransformNode(null,duplicate(this.transform))}constructor(parent,transform){var _this$transform$as,_specifiedAs$,_specifiedAs$2;super(parent),this.transform=transform,this.transform=duplicate(transform);const specifiedAs=null!==(_this$transform$as=this.transform.as)&&void 0!==_this$transform$as?_this$transform$as:[void 0,void 0];this.transform.as=[null!==(_specifiedAs$=specifiedAs[0])&&void 0!==_specifiedAs$?_specifiedAs$:"prob",null!==(_specifiedAs$2=specifiedAs[1])&&void 0!==_specifiedAs$2?_specifiedAs$2:"value"]}dependentFields(){var _this$transform$group;return new Set([this.transform.quantile,...null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform ".concat(hash(this.transform))}assemble(){const{quantile:quantile,...rest}=this.transform;return{type:"quantile",field:quantile,...rest}}}class RegressionTransformNode extends DataFlowNode{clone(){return new RegressionTransformNode(null,duplicate(this.transform))}constructor(parent,transform){var _this$transform$as,_specifiedAs$,_specifiedAs$2;super(parent),this.transform=transform,this.transform=duplicate(transform);const specifiedAs=null!==(_this$transform$as=this.transform.as)&&void 0!==_this$transform$as?_this$transform$as:[void 0,void 0];this.transform.as=[null!==(_specifiedAs$=specifiedAs[0])&&void 0!==_specifiedAs$?_specifiedAs$:transform.on,null!==(_specifiedAs$2=specifiedAs[1])&&void 0!==_specifiedAs$2?_specifiedAs$2:transform.regression]}dependentFields(){var _this$transform$group;return new Set([this.transform.regression,this.transform.on,...null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform ".concat(hash(this.transform))}assemble(){const{regression:regression,on:on,...rest}=this.transform;return{type:"regression",x:on,y:regression,...rest}}}class PivotTransformNode extends DataFlowNode{clone(){return new PivotTransformNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform}addDimensions(fields){var _this$transform$group;this.transform.groupby=unique((null!==(_this$transform$group=this.transform.groupby)&&void 0!==_this$transform$group?_this$transform$group:[]).concat(fields),d=>d)}producedFields(){}dependentFields(){var _this$transform$group2;return new Set([this.transform.pivot,this.transform.value,...null!==(_this$transform$group2=this.transform.groupby)&&void 0!==_this$transform$group2?_this$transform$group2:[]])}hash(){return"PivotTransform ".concat(hash(this.transform))}assemble(){const{pivot:pivot,value:value,groupby:groupby,limit:limit,op:op}=this.transform;return{type:"pivot",field:pivot,value:value,...void 0!==limit?{limit:limit}:{},...void 0!==op?{op:op}:{},...void 0!==groupby?{groupby:groupby}:{}}}}class SampleTransformNode extends DataFlowNode{clone(){return new SampleTransformNode(null,duplicate(this.transform))}constructor(parent,transform){super(parent),this.transform=transform}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform ".concat(hash(this.transform))}assemble(){return{type:"sample",size:this.transform.sample}}}function makeWalkTree(data){let datasetIndex=0;return function walkTree(node,dataSource){var _dataSource$format;if(node instanceof SourceNode&&!node.isGenerator&&!isUrlData(node.data)&&(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]}),node instanceof ParseNode&&(node.parent instanceof SourceNode&&!dataSource.source?(dataSource.format={...null!==(_dataSource$format=dataSource.format)&&void 0!==_dataSource$format?_dataSource$format:{},parse:node.assembleFormatParse()},dataSource.transform.push(...node.assembleTransforms(!0))):dataSource.transform.push(...node.assembleTransforms())),node instanceof FacetNode)return dataSource.name||(dataSource.name="data_".concat(datasetIndex++)),!dataSource.source||dataSource.transform.length>0?(data.push(dataSource),node.data=dataSource.name):node.data=dataSource.source,void data.push(...node.assemble());switch((node instanceof GraticuleNode||node instanceof SequenceNode||node instanceof FilterInvalidNode||node instanceof FilterNode||node instanceof CalculateNode||node instanceof GeoPointNode||node instanceof AggregateNode||node instanceof LookupNode||node instanceof WindowTransformNode||node instanceof JoinAggregateTransformNode||node instanceof FoldTransformNode||node instanceof FlattenTransformNode||node instanceof DensityTransformNode||node instanceof LoessTransformNode||node instanceof QuantileTransformNode||node instanceof RegressionTransformNode||node instanceof IdentifierNode||node instanceof SampleTransformNode||node instanceof PivotTransformNode)&&dataSource.transform.push(node.assemble()),(node instanceof BinNode||node instanceof TimeUnitNode||node instanceof ImputeNode||node instanceof StackNode||node instanceof GeoJSONNode)&&dataSource.transform.push(...node.assemble()),node instanceof OutputNode&&(dataSource.source&&0===dataSource.transform.length?node.setSource(dataSource.source):node.parent instanceof OutputNode?node.setSource(dataSource.name):(dataSource.name||(dataSource.name="data_".concat(datasetIndex++)),node.setSource(dataSource.name),1===node.numChildren()&&(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]}))),node.numChildren()){case 0:node instanceof OutputNode&&(!dataSource.source||dataSource.transform.length>0)&&data.push(dataSource);break;case 1:walkTree(node.children[0],dataSource);break;default:{dataSource.name||(dataSource.name="data_".concat(datasetIndex++));let source=dataSource.name;!dataSource.source||dataSource.transform.length>0?data.push(dataSource):source=dataSource.source;for(const child of node.children)walkTree(child,{name:null,source:source,transform:[]});break}}}}function getHeaderType(orient){return"top"===orient||"left"===orient||isSignalRef(orient)?"header":"footer"}function parseFacetHeader(model,channel){const{facet:facet,config:config,child:child,component:component}=model;if(model.channelHasField(channel)){var _fieldDef$header;const fieldDef=facet[channel],titleConfig=getHeaderProperty("title",null,config,channel);let title$1=title(fieldDef,config,{allowDisabling:!0,includeDefault:void 0===titleConfig||!!titleConfig});child.component.layoutHeaders[channel].title&&(title$1=vegaUtil.isArray(title$1)?title$1.join(", "):title$1,title$1+=" / ".concat(child.component.layoutHeaders[channel].title),child.component.layoutHeaders[channel].title=null);const labelOrient=getHeaderProperty("labelOrient",fieldDef.header,config,channel),labels=null!==fieldDef.header&&getFirstDefined(null===(_fieldDef$header=fieldDef.header)||void 0===_fieldDef$header?void 0:_fieldDef$header.labels,config.header.labels,!0),headerType=contains(["bottom","right"],labelOrient)?"footer":"header";component.layoutHeaders[channel]={title:null!==fieldDef.header?title$1:null,facetFieldDef:fieldDef,[headerType]:"facet"===channel?[]:[makeHeaderComponent(model,channel,labels)]}}}function makeHeaderComponent(model,channel,labels){const sizeType="row"===channel?"height":"width";return{labels:labels,sizeSignal:model.child.component.layoutSize.get(sizeType)?model.child.getSizeSignalRef(sizeType):void 0,axes:[]}}function mergeChildAxis(model,channel){const{child:child}=model;if(child.component.axes[channel]){const{layoutHeaders:layoutHeaders,resolve:resolve}=model.component;if(resolve.axis[channel]=parseGuideResolve(resolve,channel),"shared"===resolve.axis[channel]){const headerChannel="x"===channel?"column":"row",layoutHeader=layoutHeaders[headerChannel];for(const axisComponent of child.component.axes[channel]){var _layoutHeader$headerT;const headerType=getHeaderType(axisComponent.get("orient"));null!==(_layoutHeader$headerT=layoutHeader[headerType])&&void 0!==_layoutHeader$headerT||(layoutHeader[headerType]=[makeHeaderComponent(model,headerChannel,!1)]);const mainAxis=assembleAxis(axisComponent,"main",model.config,{header:!0});mainAxis&&layoutHeader[headerType][0].axes.push(mainAxis),axisComponent.mainExtracted=!0}}}}function parseChildrenLayoutSize(model){for(const child of model.children)child.parseLayoutSize()}function parseNonUnitLayoutSizeForChannel(model,layoutSizeType){const sizeType=getSizeTypeFromLayoutSizeType(layoutSizeType),channel=getPositionScaleChannel(sizeType),resolve=model.component.resolve,layoutSizeCmpt=model.component.layoutSize;let mergedSize;for(const child of model.children){var _resolve$scale$channe;const childSize=child.component.layoutSize.getWithExplicit(sizeType),scaleResolve=null!==(_resolve$scale$channe=resolve.scale[channel])&&void 0!==_resolve$scale$channe?_resolve$scale$channe:defaultScaleResolve(channel,model);if("independent"===scaleResolve&&"step"===childSize.value){mergedSize=void 0;break}if(mergedSize){if("independent"===scaleResolve&&mergedSize.value!==childSize.value){mergedSize=void 0;break}mergedSize=mergeValuesWithExplicit(mergedSize,childSize,sizeType,"")}else mergedSize=childSize}if(mergedSize){for(const child of model.children)model.renameSignal(child.getName(sizeType),model.getName(layoutSizeType)),child.component.layoutSize.set(sizeType,"merged",!1);layoutSizeCmpt.setWithExplicit(layoutSizeType,mergedSize)}else layoutSizeCmpt.setWithExplicit(layoutSizeType,{explicit:!1,value:void 0})}function defaultUnitSize(model,sizeType){const channel="width"===sizeType?"x":"y",config=model.config,scaleComponent=model.getScaleComponent(channel);if(scaleComponent){const scaleType=scaleComponent.get("type"),range=scaleComponent.get("range");if(hasDiscreteDomain(scaleType)){const size=getViewConfigDiscreteSize(config.view,sizeType);return isVgRangeStep(range)||isStep(size)?"step":size}return getViewConfigContinuousSize(config.view,sizeType)}if(model.hasProjection||"arc"===model.mark)return getViewConfigContinuousSize(config.view,sizeType);{const size=getViewConfigDiscreteSize(config.view,sizeType);return isStep(size)?size.step:size}}function facetSortFieldName(fieldDef,sort,opt){return vgField(sort,{suffix:"by_".concat(vgField(fieldDef)),...null!=opt?opt:{}})}class FacetModel extends ModelWithField{constructor(spec,parent,parentGivenName,config){super(spec,"facet",parent,parentGivenName,config,spec.resolve),_defineProperty(this,"facet",void 0),_defineProperty(this,"child",void 0),_defineProperty(this,"children",void 0),this.child=buildModel(spec.spec,this,this.getName("child"),void 0,config),this.children=[this.child],this.facet=this.initFacet(spec.facet)}initFacet(facet){if(!isFacetMapping(facet))return{facet:this.initFacetFieldDef(facet,"facet")};const channels=keys(facet),normalizedFacet={};for(const channel of channels){if(![ROW,COLUMN].includes(channel)){warn(incompatibleChannel(channel,"facet"));break}const fieldDef=facet[channel];if(void 0===fieldDef.field){warn(emptyFieldDef(fieldDef,channel));break}normalizedFacet[channel]=this.initFacetFieldDef(fieldDef,channel)}return normalizedFacet}initFacetFieldDef(fieldDef,channel){const facetFieldDef=initFieldDef(fieldDef,channel);return facetFieldDef.header?facetFieldDef.header=replaceExprRef(facetFieldDef.header):null===facetFieldDef.header&&(facetFieldDef.header=null),facetFieldDef}channelHasField(channel){return!!this.facet[channel]}fieldDef(channel){return this.facet[channel]}parseData(){this.component.data=parseData(this),this.child.parseData()}parseLayoutSize(){parseChildrenLayoutSize(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(model){for(const channel of FACET_CHANNELS)parseFacetHeader(model,channel);mergeChildAxis(model,"x"),mergeChildAxis(model,"y")}(this)}assembleSelectionTopLevelSignals(signals){return this.child.assembleSelectionTopLevelSignals(signals)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(data){return this.child.assembleSelectionData(data)}getHeaderLayoutMixins(){const layoutMixins={};for(const channel of FACET_CHANNELS)for(const headerType of HEADER_TYPES){const layoutHeaderComponent=this.component.layoutHeaders[channel],headerComponent=layoutHeaderComponent[headerType],{facetFieldDef:facetFieldDef}=layoutHeaderComponent;if(facetFieldDef){const titleOrient=getHeaderProperty("titleOrient",facetFieldDef.header,this.config,channel);if(["right","bottom"].includes(titleOrient)){var _layoutMixins$titleAn;const headerChannel=getHeaderChannel(channel,titleOrient);null!==(_layoutMixins$titleAn=layoutMixins.titleAnchor)&&void 0!==_layoutMixins$titleAn||(layoutMixins.titleAnchor={}),layoutMixins.titleAnchor[headerChannel]="end"}}if(null!=headerComponent&&headerComponent[0]){const sizeType="row"===channel?"height":"width",bandType="header"===headerType?"headerBand":"footerBand";var _layoutMixins$bandTyp,_layoutMixins$offset;"facet"===channel||this.child.component.layoutSize.get(sizeType)||(null!==(_layoutMixins$bandTyp=layoutMixins[bandType])&&void 0!==_layoutMixins$bandTyp||(layoutMixins[bandType]={}),layoutMixins[bandType][channel]=.5),layoutHeaderComponent.title&&(null!==(_layoutMixins$offset=layoutMixins.offset)&&void 0!==_layoutMixins$offset||(layoutMixins.offset={}),layoutMixins.offset["row"===channel?"rowTitle":"columnTitle"]=10)}}return layoutMixins}assembleDefaultLayout(){const{column:column,row:row}=this.facet,columns=column?this.columnDistinctSignal():row?1:void 0;let align="all";return(row||"independent"!==this.component.resolve.scale.x)&&(column||"independent"!==this.component.resolve.scale.y)||(align="none"),{...this.getHeaderLayoutMixins(),...columns?{columns:columns}:{},bounds:"full",align:align}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof FacetModel)){const facetLayoutDataName=this.getName("column_domain");return{signal:"length(data('".concat(facetLayoutDataName,"'))")}}}assembleGroup(signals){return this.parent&&this.parent instanceof FacetModel?{...this.channelHasField("column")?{encode:{update:{columns:{field:vgField(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(signals)}:super.assembleGroup(signals)}getCardinalityAggregateForChild(){const fields=[],ops=[],as=[];if(this.child instanceof FacetModel){if(this.child.channelHasField("column")){const field=vgField(this.child.facet.column);fields.push(field),ops.push("distinct"),as.push("distinct_".concat(field))}}else for(const channel of POSITION_SCALE_CHANNELS){const childScaleComponent=this.child.component.scales[channel];if(childScaleComponent&&!childScaleComponent.merged){const type=childScaleComponent.get("type"),range=childScaleComponent.get("range");if(hasDiscreteDomain(type)&&isVgRangeStep(range)){const field=getFieldFromDomain(assembleDomain(this.child,channel));field?(fields.push(field),ops.push("distinct"),as.push("distinct_".concat(field))):warn(unknownField(channel))}}}return{fields:fields,ops:ops,as:as}}assembleFacet(){const{name:name,data:data}=this.component.data.facetRoot,{row:row,column:column}=this.facet,{fields:fields,ops:ops,as:as}=this.getCardinalityAggregateForChild(),groupby=[];for(const channel of FACET_CHANNELS){const fieldDef=this.facet[channel];if(fieldDef){groupby.push(vgField(fieldDef));const{bin:bin,sort:sort}=fieldDef;if(isBinning(bin)&&groupby.push(vgField(fieldDef,{binSuffix:"end"})),isSortField(sort)){const{field:field,op:op=DEFAULT_SORT_OP}=sort,outputName=facetSortFieldName(fieldDef,sort);row&&column?(fields.push(outputName),ops.push("max"),as.push(outputName)):(fields.push(field),ops.push(op),as.push(outputName))}else if(vegaUtil.isArray(sort)){const outputName=sortArrayIndexField(fieldDef,channel);fields.push(outputName),ops.push("max"),as.push(outputName)}}}const cross=!!row&&!!column;return{name:name,data:data,groupby:groupby,...cross||fields.length>0?{aggregate:{...cross?{cross:cross}:{},...fields.length?{fields:fields,ops:ops,as:as}:{}}}:{}}}facetSortFields(channel){const{facet:facet}=this,fieldDef=facet[channel];return fieldDef?isSortField(fieldDef.sort)?[facetSortFieldName(fieldDef,fieldDef.sort,{expr:"datum"})]:vegaUtil.isArray(fieldDef.sort)?[sortArrayIndexField(fieldDef,channel,{expr:"datum"})]:[vgField(fieldDef,{expr:"datum"})]:[]}facetSortOrder(channel){const{facet:facet}=this,fieldDef=facet[channel];if(fieldDef){const{sort:sort}=fieldDef;return[(isSortField(sort)?sort.order:!vegaUtil.isArray(sort)&&sort)||"ascending"]}return[]}assembleLabelTitle(){const{facet:facet,config:config}=this;if(facet.facet)return assembleLabelTitle(facet.facet,"facet",config);const ORTHOGONAL_ORIENT={row:["top","bottom"],column:["left","right"]};for(const channel of HEADER_CHANNELS)if(facet[channel]){var _facet$channel;const labelOrient=getHeaderProperty("labelOrient",null===(_facet$channel=facet[channel])||void 0===_facet$channel?void 0:_facet$channel.header,config,channel);if(ORTHOGONAL_ORIENT[channel].includes(labelOrient))return assembleLabelTitle(facet[channel],channel,config)}}assembleMarks(){const{child:child}=this,data=function(root){const data=[],walkTree=makeWalkTree(data);for(const child of root.children)walkTree(child,{source:root.name,name:null,transform:[]});return data}(this.component.data.facetRoot),encodeEntry=child.assembleGroupEncodeEntry(!1),title=this.assembleLabelTitle()||child.assembleTitle(),style=child.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...title?{title:title}:{},...style?{style:style}:{},from:{facet:this.assembleFacet()},sort:{field:FACET_CHANNELS.map(c=>this.facetSortFields(c)).flat(),order:FACET_CHANNELS.map(c=>this.facetSortOrder(c)).flat()},...data.length>0?{data:data}:{},...encodeEntry?{encode:{update:encodeEntry}}:{},...child.assembleGroup(assembleFacetSignals(this,[]))}]}getMapping(){return this.facet}}function findSource(data,sources){for(const other of sources){var _data$format,_otherData$format,_data$format2,_otherData$format2;const otherData=other.data;if(data.name&&other.hasName()&&data.name!==other.dataName)continue;const formatMesh=null===(_data$format=data.format)||void 0===_data$format?void 0:_data$format.mesh,otherFeature=null===(_otherData$format=otherData.format)||void 0===_otherData$format?void 0:_otherData$format.feature;if(formatMesh&&otherFeature)continue;const formatFeature=null===(_data$format2=data.format)||void 0===_data$format2?void 0:_data$format2.feature;if((formatFeature||otherFeature)&&formatFeature!==otherFeature)continue;const otherMesh=null===(_otherData$format2=otherData.format)||void 0===_otherData$format2?void 0:_otherData$format2.mesh;if(!formatMesh&&!otherMesh||formatMesh===otherMesh)if(isInlineData(data)&&isInlineData(otherData)){if(deepEqual(data.values,otherData.values))return other}else if(isUrlData(data)&&isUrlData(otherData)){if(data.url===otherData.url)return other}else if(isNamedData(data)&&data.name===other.dataName)return other}return null}function parseData(model){var _data$format3,_ParseNode$makeExplic,_ParseNode$makeWithAn2;let head=function(model,sources){if(model.data||!model.parent){if(null===model.data){const source=new SourceNode({values:[]});return sources.push(source),source}const existingSource=findSource(model.data,sources);if(existingSource)return isGenerator(model.data)||(existingSource.data.format=mergeDeep({},model.data.format,existingSource.data.format)),!existingSource.hasName()&&model.data.name&&(existingSource.dataName=model.data.name),existingSource;{const source=new SourceNode(model.data);return sources.push(source),source}}return model.parent.component.data.facetRoot?model.parent.component.data.facetRoot:model.parent.component.data.main}(model,model.component.data.sources);const{outputNodes:outputNodes,outputNodeRefCounts:outputNodeRefCounts}=model.component.data,ancestorParse=model.parent?model.parent.component.data.ancestorParse.clone():new AncestorParse,data=model.data;isGenerator(data)?(isSequenceGenerator(data)?head=new SequenceNode(head,data.sequence):isGraticuleGenerator(data)&&(head=new GraticuleNode(head,data.graticule)),ancestorParse.parseNothing=!0):null===(null==data||null===(_data$format3=data.format)||void 0===_data$format3?void 0:_data$format3.parse)&&(ancestorParse.parseNothing=!0),head=null!==(_ParseNode$makeExplic=ParseNode.makeExplicit(head,model,ancestorParse))&&void 0!==_ParseNode$makeExplic?_ParseNode$makeExplic:head,head=new IdentifierNode(head);const parentIsLayer=model.parent&&isLayerModel(model.parent);var _BinNode$makeFromEnco;(isUnitModel(model)||isFacetModel(model))&&parentIsLayer&&(head=null!==(_BinNode$makeFromEnco=BinNode.makeFromEncoding(head,model))&&void 0!==_BinNode$makeFromEnco?_BinNode$makeFromEnco:head),model.transforms.length>0&&(head=function(head,model,ancestorParse){let lookupCounter=0;for(const t of model.transforms){let transformNode,derivedType=void 0;if(isCalculate(t))transformNode=head=new CalculateNode(head,t),derivedType="derived";else if(isFilter(t)){var _ParseNode$makeWithAn;const implicit=getImplicitFromFilterTransform(t);transformNode=head=null!==(_ParseNode$makeWithAn=ParseNode.makeWithAncestors(head,{},implicit,ancestorParse))&&void 0!==_ParseNode$makeWithAn?_ParseNode$makeWithAn:head,head=new FilterNode(head,model,t.filter)}else if(isBin(t))transformNode=head=BinNode.makeFromTransform(head,t,model),derivedType="number";else if(isTimeUnit(t))derivedType="date",void 0===ancestorParse.getWithExplicit(t.field).value&&(head=new ParseNode(head,{[t.field]:derivedType}),ancestorParse.set(t.field,derivedType,!1)),transformNode=head=TimeUnitNode.makeFromTransform(head,t);else if(isAggregate$1(t))transformNode=head=AggregateNode.makeFromTransform(head,t),derivedType="number",requiresSelectionId(model)&&(head=new IdentifierNode(head));else if(isLookup(t))transformNode=head=LookupNode.make(head,model,t,lookupCounter++),derivedType="derived";else if(isWindow(t))transformNode=head=new WindowTransformNode(head,t),derivedType="number";else if(isJoinAggregate(t))transformNode=head=new JoinAggregateTransformNode(head,t),derivedType="number";else if(isStack(t))transformNode=head=StackNode.makeFromTransform(head,t),derivedType="derived";else if(isFold(t))transformNode=head=new FoldTransformNode(head,t),derivedType="derived";else if(isFlatten(t))transformNode=head=new FlattenTransformNode(head,t),derivedType="derived";else if(isPivot(t))transformNode=head=new PivotTransformNode(head,t),derivedType="derived";else if(isSample(t))head=new SampleTransformNode(head,t);else if(isImpute(t))transformNode=head=ImputeNode.makeFromTransform(head,t),derivedType="derived";else if(isDensity(t))transformNode=head=new DensityTransformNode(head,t),derivedType="derived";else if(isQuantile(t))transformNode=head=new QuantileTransformNode(head,t),derivedType="derived";else if(isRegression(t))transformNode=head=new RegressionTransformNode(head,t),derivedType="derived";else{if(!isLoess(t)){warn("Ignoring an invalid transform: ".concat(stringify(t),"."));continue}transformNode=head=new LoessTransformNode(head,t),derivedType="derived"}if(transformNode&&void 0!==derivedType)for(const field of null!==(_transformNode$produc=transformNode.producedFields())&&void 0!==_transformNode$produc?_transformNode$produc:[]){var _transformNode$produc;ancestorParse.set(field,derivedType,!1)}}return head}(head,model,ancestorParse));const implicitSelection=function(model){const implicit={};if(isUnitModel(model)&&model.component.selection)for(const name of keys(model.component.selection)){const selCmpt=model.component.selection[name];for(const proj of selCmpt.project.items)!proj.channel&&accessPathDepth(proj.field)>1&&(implicit[proj.field]="flatten")}return implicit}(model),implicitEncoding=getImplicitFromEncoding(model);var _TimeUnitNode$makeFro,_BinNode$makeFromEnco2;(head=null!==(_ParseNode$makeWithAn2=ParseNode.makeWithAncestors(head,{},{...implicitSelection,...implicitEncoding},ancestorParse))&&void 0!==_ParseNode$makeWithAn2?_ParseNode$makeWithAn2:head,isUnitModel(model)&&(head=GeoJSONNode.parseAll(head,model),head=GeoPointNode.parseAll(head,model)),isUnitModel(model)||isFacetModel(model))&&(parentIsLayer||(head=null!==(_BinNode$makeFromEnco2=BinNode.makeFromEncoding(head,model))&&void 0!==_BinNode$makeFromEnco2?_BinNode$makeFromEnco2:head),head=null!==(_TimeUnitNode$makeFro=TimeUnitNode.makeFromEncoding(head,model))&&void 0!==_TimeUnitNode$makeFro?_TimeUnitNode$makeFro:head,head=CalculateNode.parseAllForSortIndex(head,model));const rawName=model.getDataName(DataSourceType.Raw),raw=new OutputNode(head,rawName,DataSourceType.Raw,outputNodeRefCounts);if(outputNodes[rawName]=raw,head=raw,isUnitModel(model)){var _ImputeNode$makeFromE,_StackNode$makeFromEn;const agg=AggregateNode.makeFromEncoding(head,model);agg&&(head=agg,requiresSelectionId(model)&&(head=new IdentifierNode(head))),head=null!==(_ImputeNode$makeFromE=ImputeNode.makeFromEncoding(head,model))&&void 0!==_ImputeNode$makeFromE?_ImputeNode$makeFromE:head,head=null!==(_StackNode$makeFromEn=StackNode.makeFromEncoding(head,model))&&void 0!==_StackNode$makeFromEn?_StackNode$makeFromEn:head}var _FilterInvalidNode$ma;isUnitModel(model)&&(head=null!==(_FilterInvalidNode$ma=FilterInvalidNode.make(head,model))&&void 0!==_FilterInvalidNode$ma?_FilterInvalidNode$ma:head);const mainName=model.getDataName(DataSourceType.Main),main=new OutputNode(head,mainName,DataSourceType.Main,outputNodeRefCounts);outputNodes[mainName]=main,head=main,isUnitModel(model)&&function(model,main){for(const[selection,selCmpt]of entries(null!==(_model$component$sele=model.component.selection)&&void 0!==_model$component$sele?_model$component$sele:{})){var _model$component$sele;const lookupName=model.getName("lookup_".concat(selection));model.component.data.outputNodes[lookupName]=selCmpt.materialized=new OutputNode(new FilterNode(main,model,{param:selection}),lookupName,DataSourceType.Lookup,model.component.data.outputNodeRefCounts)}}(model,main);let facetRoot=null;if(isFacetModel(model)){var _makeJoinAggregateFro;const facetName=model.getName("facet");head=null!==(_makeJoinAggregateFro=function(parent,facet){const{row:row,column:column}=facet;if(row&&column){let newParent=null;for(const fieldDef of[row,column])if(isSortField(fieldDef.sort)){const{field:field,op:op=DEFAULT_SORT_OP}=fieldDef.sort;parent=newParent=new JoinAggregateTransformNode(parent,{joinaggregate:[{op:op,field:field,as:facetSortFieldName(fieldDef,fieldDef.sort,{forAs:!0})}],groupby:[vgField(fieldDef)]})}return newParent}return null}(head,model.facet))&&void 0!==_makeJoinAggregateFro?_makeJoinAggregateFro:head,facetRoot=new FacetNode(head,model,facetName,main.getSource()),outputNodes[facetName]=facetRoot}return{...model.component.data,outputNodes:outputNodes,outputNodeRefCounts:outputNodeRefCounts,raw:raw,main:main,facetRoot:facetRoot,ancestorParse:ancestorParse}}class ConcatModel extends Model{constructor(spec,parent,parentGivenName,config){var _spec$resolve,_spec$resolve$axis,_spec$resolve2,_spec$resolve2$axis;super(spec,"concat",parent,parentGivenName,config,spec.resolve),_defineProperty(this,"children",void 0),"shared"!==(null===(_spec$resolve=spec.resolve)||void 0===_spec$resolve||null===(_spec$resolve$axis=_spec$resolve.axis)||void 0===_spec$resolve$axis?void 0:_spec$resolve$axis.x)&&"shared"!==(null===(_spec$resolve2=spec.resolve)||void 0===_spec$resolve2||null===(_spec$resolve2$axis=_spec$resolve2.axis)||void 0===_spec$resolve2$axis?void 0:_spec$resolve2$axis.y)||warn("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(spec).map((child,i)=>buildModel(child,this,this.getName("concat_".concat(i)),void 0,config))}parseData(){this.component.data=parseData(this);for(const child of this.children)child.parseData()}parseSelections(){this.component.selection={};for(const child of this.children){child.parseSelections();for(const key of keys(child.component.selection))this.component.selection[key]=child.component.selection[key]}}parseMarkGroup(){for(const child of this.children)child.parseMarkGroup()}parseAxesAndHeaders(){for(const child of this.children)child.parseAxesAndHeaders()}getChildren(spec){return isVConcatSpec(spec)?spec.vconcat:isHConcatSpec(spec)?spec.hconcat:spec.concat}parseLayoutSize(){!function(model){parseChildrenLayoutSize(model);const widthType=1===model.layout.columns?"width":"childWidth",heightType=void 0===model.layout.columns?"height":"childHeight";parseNonUnitLayoutSizeForChannel(model,widthType),parseNonUnitLayoutSizeForChannel(model,heightType)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(signals){return this.children.reduce((sg,child)=>child.assembleSelectionTopLevelSignals(sg),signals)}assembleSignals(){return this.children.forEach(child=>child.assembleSignals()),[]}assembleLayoutSignals(){const layoutSignals=assembleLayoutSignals(this);for(const child of this.children)layoutSignals.push(...child.assembleLayoutSignals());return layoutSignals}assembleSelectionData(data){return this.children.reduce((db,child)=>child.assembleSelectionData(db),data)}assembleMarks(){return this.children.map(child=>{const title=child.assembleTitle(),style=child.assembleGroupStyle(),encodeEntry=child.assembleGroupEncodeEntry(!1);return{type:"group",name:child.getName("group"),...title?{title:title}:{},...style?{style:style}:{},...encodeEntry?{encode:{update:encodeEntry}}:{},...child.assembleGroup()}})}assembleDefaultLayout(){const columns=this.layout.columns;return{...null!=columns?{columns:columns}:{},bounds:"full",align:"each"}}}const AXIS_COMPONENT_PROPERTIES_INDEX={disable:1,gridScale:1,scale:1,...COMMON_AXIS_PROPERTIES_INDEX,labelExpr:1,encode:1},AXIS_COMPONENT_PROPERTIES=keys(AXIS_COMPONENT_PROPERTIES_INDEX);class AxisComponent extends Split{constructor(explicit={},implicit={},mainExtracted=!1){super(),this.explicit=explicit,this.implicit=implicit,this.mainExtracted=mainExtracted}clone(){return new AxisComponent(duplicate(this.explicit),duplicate(this.implicit),this.mainExtracted)}hasAxisPart(part){return!("axis"!==part&&("grid"===part||"title"===part?!this.get(part):!1===(v=this.get(part))||null===v));var v}hasOrientSignalRef(){return isSignalRef(this.explicit.orient)}}const OPPOSITE_ORIENT={bottom:"top",top:"bottom",left:"right",right:"left"};function mergeAxisComponents(mergedAxisCmpts,childAxisCmpts){if(!mergedAxisCmpts)return childAxisCmpts.map(axisComponent=>axisComponent.clone());{if(mergedAxisCmpts.length!==childAxisCmpts.length)return;const length=mergedAxisCmpts.length;for(let i=0;i<length;i++){const merged=mergedAxisCmpts[i],child=childAxisCmpts[i];if(!!merged!=!!child)return;if(merged&&child){const mergedOrient=merged.getWithExplicit("orient"),childOrient=child.getWithExplicit("orient");if(mergedOrient.explicit&&childOrient.explicit&&mergedOrient.value!==childOrient.value)return;mergedAxisCmpts[i]=mergeAxisComponent(merged,child)}}}return mergedAxisCmpts}function mergeAxisComponent(merged,child){for(const prop of AXIS_COMPONENT_PROPERTIES){const mergedValueWithExplicit=mergeValuesWithExplicit(merged.getWithExplicit(prop),child.getWithExplicit(prop),prop,"axis",(v1,v2)=>{switch(prop){case"title":return mergeTitleComponent(v1,v2);case"gridScale":return{explicit:v1.explicit,value:getFirstDefined(v1.value,v2.value)}}return defaultTieBreaker(v1,v2,prop,"axis")});merged.setWithExplicit(prop,mergedValueWithExplicit)}return merged}function isExplicit$1(value,property,axis,model,channel){if("disable"===property)return void 0!==axis;switch(axis=axis||{},property){case"titleAngle":case"labelAngle":return value===(isSignalRef(axis.labelAngle)?axis.labelAngle:normalizeAngle(axis.labelAngle));case"values":return!!axis.values;case"encode":return!!axis.encoding||!!axis.labelAngle;case"title":if(value===getFieldDefTitle(model,channel))return!0}return value===axis[property]}const propsToAlwaysIncludeConfig=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function parseAxis(channel,model){var _axis,_config,_config$axis,_axis2,_axis$encoding;let axis=model.axis(channel);const axisComponent=new AxisComponent,fieldOrDatumDef=getFieldOrDatumDef(model.encoding[channel]),{mark:mark,config:config}=model,orient=(null===(_axis=axis)||void 0===_axis?void 0:_axis.orient)||(null===(_config=config["x"===channel?"axisX":"axisY"])||void 0===_config?void 0:_config.orient)||(null===(_config$axis=config.axis)||void 0===_config$axis?void 0:_config$axis.orient)||function(channel){return"x"===channel?"bottom":"left"}(channel),scaleType=model.getScaleComponent(channel).get("type"),axisConfigs=getAxisConfigs(channel,scaleType,orient,model.config),disable=void 0!==axis?!axis:getAxisConfig("disable",config.style,null===(_axis2=axis)||void 0===_axis2?void 0:_axis2.style,axisConfigs).configValue;if(axisComponent.set("disable",disable,void 0!==axis),disable)return axisComponent;axis=axis||{};const labelAngle=function(fieldOrDatumDef,axis,channel,styleConfig,axisConfigs){const labelAngle=null==axis?void 0:axis.labelAngle;if(void 0!==labelAngle)return isSignalRef(labelAngle)?labelAngle:normalizeAngle(labelAngle);{const{configValue:angle}=getAxisConfig("labelAngle",styleConfig,null==axis?void 0:axis.style,axisConfigs);return void 0!==angle?normalizeAngle(angle):channel!==X||!contains([NOMINAL,ORDINAL],fieldOrDatumDef.type)||isFieldDef(fieldOrDatumDef)&&fieldOrDatumDef.timeUnit?void 0:270}}(fieldOrDatumDef,axis,channel,config.style,axisConfigs),ruleParams={fieldOrDatumDef:fieldOrDatumDef,axis:axis,channel:channel,model:model,scaleType:scaleType,orient:orient,labelAngle:labelAngle,mark:mark,config:config};for(const property of AXIS_COMPONENT_PROPERTIES){const value=property in axisRules?axisRules[property](ruleParams):isAxisProperty(property)?axis[property]:void 0,hasValue=void 0!==value,explicit=isExplicit$1(value,property,axis,model,channel);if(hasValue&&explicit)axisComponent.set(property,value,explicit);else{const{configValue:configValue,configFrom:configFrom}=isAxisProperty(property)&&"values"!==property?getAxisConfig(property,config.style,axis.style,axisConfigs):{},hasConfigValue=void 0!==configValue;hasValue&&!hasConfigValue?axisComponent.set(property,value,explicit):("vgAxisConfig"!==configFrom||propsToAlwaysIncludeConfig.has(property)&&hasConfigValue||isConditionalAxisValue(configValue)||isSignalRef(configValue))&&axisComponent.set(property,configValue,!1)}}const axisEncoding=null!==(_axis$encoding=axis.encoding)&&void 0!==_axis$encoding?_axis$encoding:{},axisEncode=AXIS_PARTS.reduce((e,part)=>{var _axisEncoding$part;if(!axisComponent.hasAxisPart(part))return e;const axisEncodingPart=guideEncodeEntry(null!==(_axisEncoding$part=axisEncoding[part])&&void 0!==_axisEncoding$part?_axisEncoding$part:{},model),value="labels"===part?function(model,channel,specifiedLabelsSpec){var _getFieldOrDatumDef;const{encoding:encoding,config:config}=model,fieldOrDatumDef=null!==(_getFieldOrDatumDef=getFieldOrDatumDef(encoding[channel]))&&void 0!==_getFieldOrDatumDef?_getFieldOrDatumDef:getFieldOrDatumDef(encoding[getSecondaryRangeChannel(channel)]),axis=model.axis(channel)||{},{format:format,formatType:formatType}=axis;return isCustomFormatType(formatType)?{text:formatCustomType({fieldOrDatumDef:fieldOrDatumDef,field:"datum.value",format:format,formatType:formatType,config:config}),...specifiedLabelsSpec}:specifiedLabelsSpec}(model,channel,axisEncodingPart):axisEncodingPart;return void 0===value||isEmpty(value)||(e[part]={update:value}),e},{});return isEmpty(axisEncode)||axisComponent.set("encode",axisEncode,!!axis.encoding||void 0!==axis.labelAngle),axisComponent}function initMarkdef(originalMarkDef,encoding,config){const markDef=replaceExprRef(originalMarkDef),specifiedOrient=getMarkPropOrConfig("orient",markDef,config);var original,actual;if(markDef.orient=function(mark,encoding,specifiedOrient){switch(mark){case POINT:case CIRCLE:case SQUARE:case TEXT$1:case RECT:case IMAGE:return}const{x:x,y:y,x2:x2,y2:y2}=encoding;switch(mark){case BAR:if(isFieldDef(x)&&(isBinned(x.bin)||isFieldDef(y)&&y.aggregate&&!x.aggregate))return"vertical";if(isFieldDef(y)&&(isBinned(y.bin)||isFieldDef(x)&&x.aggregate&&!y.aggregate))return"horizontal";if(y2||x2){if(specifiedOrient)return specifiedOrient;if(!x2&&(isFieldDef(x)&&x.type===QUANTITATIVE&&!isBinning(x.bin)||isNumericDataDef(x)))return"horizontal";if(!y2&&(isFieldDef(y)&&y.type===QUANTITATIVE&&!isBinning(y.bin)||isNumericDataDef(y)))return"vertical"}case RULE:if(x2&&(!isFieldDef(x)||!isBinned(x.bin))&&y2&&(!isFieldDef(y)||!isBinned(y.bin)))return;case AREA:if(y2)return isFieldDef(y)&&isBinned(y.bin)?"horizontal":"vertical";if(x2)return isFieldDef(x)&&isBinned(x.bin)?"vertical":"horizontal";if(mark===RULE){if(x&&!y)return"vertical";if(y&&!x)return"horizontal"}case LINE:case TICK:{const xIsContinuous=isContinuousFieldOrDatumDef(x),yIsContinuous=isContinuousFieldOrDatumDef(y);if(specifiedOrient)return specifiedOrient;if(xIsContinuous&&!yIsContinuous)return"tick"!==mark?"horizontal":"vertical";if(!xIsContinuous&&yIsContinuous)return"tick"!==mark?"vertical":"horizontal";if(xIsContinuous&&yIsContinuous){const xDef=x,yDef=y,xIsTemporal=xDef.type===TEMPORAL,yIsTemporal=yDef.type===TEMPORAL;return xIsTemporal&&!yIsTemporal?"tick"!==mark?"vertical":"horizontal":!xIsTemporal&&yIsTemporal?"tick"!==mark?"horizontal":"vertical":!xDef.aggregate&&yDef.aggregate?"tick"!==mark?"vertical":"horizontal":xDef.aggregate&&!yDef.aggregate&&"tick"!==mark?"horizontal":"vertical"}return}}return"vertical"}(markDef.type,encoding,specifiedOrient),void 0!==specifiedOrient&&specifiedOrient!==markDef.orient&&warn((original=markDef.orient,actual=specifiedOrient,'Specified orient "'.concat(original,'" overridden with "').concat(actual,'".'))),"bar"===markDef.type&&markDef.orient){const cornerRadiusEnd=getMarkPropOrConfig("cornerRadiusEnd",markDef,config);if(void 0!==cornerRadiusEnd){const newProps="horizontal"===markDef.orient&&encoding.x2||"vertical"===markDef.orient&&encoding.y2?["cornerRadius"]:BAR_CORNER_RADIUS_INDEX[markDef.orient];for(const newProp of newProps)markDef[newProp]=cornerRadiusEnd;void 0!==markDef.cornerRadiusEnd&&delete markDef.cornerRadiusEnd}}return void 0===getMarkPropOrConfig("opacity",markDef,config)&&(markDef.opacity=function(mark,encoding){if(contains([POINT,TICK,CIRCLE,SQUARE],mark)&&!isAggregate(encoding))return.7}(markDef.type,encoding)),void 0===getMarkPropOrConfig("cursor",markDef,config)&&(markDef.cursor=function(markDef,encoding,config){return encoding.href||markDef.href||getMarkPropOrConfig("href",markDef,config)?"pointer":markDef.cursor}(markDef,encoding,config)),markDef}function encodeEntry(model,fixedShape){const{config:config}=model;return{...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...pointPosition("x",model,{defaultPos:"mid"}),...pointPosition("y",model,{defaultPos:"mid"}),...nonPosition("size",model),...nonPosition("angle",model),...shapeMixins(model,0,fixedShape)}}function shapeMixins(model,config,fixedShape){return fixedShape?{shape:{value:fixedShape}}:nonPosition("shape",model)}function align(markDef,encoding,config){if(void 0===getMarkPropOrConfig("align",markDef,config))return"center"}function baseline(markDef,encoding,config){if(void 0===getMarkPropOrConfig("baseline",markDef,config))return"middle"}function defaultSize(model){var _getMarkPropOrConfig;const{config:config,markDef:markDef}=model,{orient:orient}=markDef,vgSizeChannel="horizontal"===orient?"width":"height",scale=model.getScaleComponent("horizontal"===orient?"x":"y"),markPropOrConfig=null!==(_getMarkPropOrConfig=getMarkPropOrConfig("size",markDef,config,{vgChannel:vgSizeChannel}))&&void 0!==_getMarkPropOrConfig?_getMarkPropOrConfig:config.tick.bandSize;if(void 0!==markPropOrConfig)return markPropOrConfig;{const scaleRange=scale?scale.get("range"):void 0;return scaleRange&&isVgRangeStep(scaleRange)&&vegaUtil.isNumber(scaleRange.step)?3*scaleRange.step/4:3*getViewConfigDiscreteStep(config.view,vgSizeChannel)/4}}const markCompiler={arc:{vgMark:"arc",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...pointPosition("x",model,{defaultPos:"mid"}),...pointPosition("y",model,{defaultPos:"mid"}),...rectPosition(model,"radius","arc"),...rectPosition(model,"theta","arc")})},area:{vgMark:"area",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...pointOrRangePosition("x",model,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===model.markDef.orient}),...pointOrRangePosition("y",model,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===model.markDef.orient}),...defined(model)})},bar:{vgMark:"rect",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...rectPosition(model,"x","bar"),...rectPosition(model,"y","bar")})},circle:{vgMark:"symbol",encodeEntry:model=>encodeEntry(model,"circle")},geoshape:{vgMark:"shape",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:model=>{const{encoding:encoding}=model,shapeDef=encoding.shape;return[{type:"geoshape",projection:model.projectionName(),...shapeDef&&isFieldDef(shapeDef)&&shapeDef.type===GEOJSON?{field:vgField(shapeDef,{expr:"datum"})}:{}}]}},image:{vgMark:"image",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...rectPosition(model,"x","image"),...rectPosition(model,"y","image"),...text(model,"url")})},line:{vgMark:"line",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...pointPosition("x",model,{defaultPos:"mid"}),...pointPosition("y",model,{defaultPos:"mid"}),...nonPosition("size",model,{vgChannel:"strokeWidth"}),...defined(model)})},point:{vgMark:"symbol",encodeEntry:model=>encodeEntry(model)},rect:{vgMark:"rect",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...rectPosition(model,"x","rect"),...rectPosition(model,"y","rect")})},rule:{vgMark:"rule",encodeEntry:model=>{const{markDef:markDef}=model,orient=markDef.orient;return model.encoding.x||model.encoding.y||model.encoding.latitude||model.encoding.longitude?{...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...pointOrRangePosition("x",model,{defaultPos:"horizontal"===orient?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==orient}),...pointOrRangePosition("y",model,{defaultPos:"vertical"===orient?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==orient}),...nonPosition("size",model,{vgChannel:"strokeWidth"})}:{}}},square:{vgMark:"symbol",encodeEntry:model=>encodeEntry(model,"square")},text:{vgMark:"text",encodeEntry:model=>{const{config:config,encoding:encoding}=model;return{...baseEncodeEntry(model,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...pointPosition("x",model,{defaultPos:"mid"}),...pointPosition("y",model,{defaultPos:"mid"}),...text(model),...nonPosition("size",model,{vgChannel:"fontSize"}),...nonPosition("angle",model),...valueIfDefined("align",align(model.markDef,0,config)),...valueIfDefined("baseline",baseline(model.markDef,0,config)),...pointPosition("radius",model,{defaultPos:null}),...pointPosition("theta",model,{defaultPos:null})}}},tick:{vgMark:"rect",encodeEntry:model=>{const{config:config,markDef:markDef}=model,orient=markDef.orient,vgSizeChannel="horizontal"===orient?"width":"height",vgThicknessChannel="horizontal"===orient?"height":"width";return{...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...pointPosition("x",model,{defaultPos:"mid",vgChannel:"xc"}),...pointPosition("y",model,{defaultPos:"mid",vgChannel:"yc"}),...nonPosition("size",model,{defaultValue:defaultSize(model),vgChannel:vgSizeChannel}),[vgThicknessChannel]:signalOrValueRef(getMarkPropOrConfig("thickness",markDef,config))}}},trail:{vgMark:"trail",encodeEntry:model=>({...baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...pointPosition("x",model,{defaultPos:"mid"}),...pointPosition("y",model,{defaultPos:"mid"}),...nonPosition("size",model),...defined(model)})}};function parseMarkGroups(model){if(contains([LINE,AREA,TRAIL],model.mark)){const details=pathGroupingFields(model.mark,model.encoding);if(details.length>0)return function(model,details){return[{name:model.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+model.requestDataName(DataSourceType.Main),data:model.requestDataName(DataSourceType.Main),groupby:details}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:getMarkGroup(model,{fromPrefix:"faceted_path_"})}]}(model,details)}else if(model.mark===BAR){const hasCornerRadius=VG_CORNERRADIUS_CHANNELS.some(prop=>getMarkPropOrConfig(prop,model.markDef,model.config));if(model.stack&&!model.fieldDef("size")&&hasCornerRadius)return function(model){const[mark]=getMarkGroup(model,{fromPrefix:"stack_group_"}),fieldScale=model.scaleName(model.stack.fieldChannel),stackField=(opt={})=>model.vgField(model.stack.fieldChannel,opt),stackFieldGroup=(func,expr)=>{const vgFieldMinMax=[stackField({prefix:"min",suffix:"start",expr:expr}),stackField({prefix:"max",suffix:"start",expr:expr}),stackField({prefix:"min",suffix:"end",expr:expr}),stackField({prefix:"max",suffix:"end",expr:expr})];return"".concat(func,"(").concat(vgFieldMinMax.map(field=>"scale('".concat(fieldScale,"',").concat(field,")")).join(","),")")};let groupUpdate,innerGroupUpdate;"x"===model.stack.fieldChannel?(groupUpdate={...pick(mark.encode.update,["y","yc","y2","height",...VG_CORNERRADIUS_CHANNELS]),x:{signal:stackFieldGroup("min","datum")},x2:{signal:stackFieldGroup("max","datum")},clip:{value:!0}},innerGroupUpdate={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},mark.encode.update={...omit(mark.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(groupUpdate={...pick(mark.encode.update,["x","xc","x2","width"]),y:{signal:stackFieldGroup("min","datum")},y2:{signal:stackFieldGroup("max","datum")},clip:{value:!0}},innerGroupUpdate={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},mark.encode.update={...omit(mark.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const key of VG_CORNERRADIUS_CHANNELS){const configValue=getMarkConfig(key,model.markDef,model.config);mark.encode.update[key]?(groupUpdate[key]=mark.encode.update[key],delete mark.encode.update[key]):configValue&&(groupUpdate[key]=signalOrValueRef(configValue)),configValue&&(mark.encode.update[key]={value:0})}const groupby=[];if(model.stack.groupbyChannel){const groupByField=model.fieldDef(model.stack.groupbyChannel),field=vgField(groupByField);field&&groupby.push(field),(null!=groupByField&&groupByField.bin||null!=groupByField&&groupByField.timeUnit)&&groupby.push(vgField(groupByField,{binSuffix:"end"}))}return groupUpdate=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((encode,prop)=>{if(mark.encode.update[prop])return{...encode,[prop]:mark.encode.update[prop]};{const configValue=getMarkConfig(prop,model.markDef,model.config);return void 0!==configValue?{...encode,[prop]:signalOrValueRef(configValue)}:encode}},groupUpdate),groupUpdate.stroke&&(groupUpdate.strokeForeground={value:!0},groupUpdate.strokeOffset={value:0}),[{type:"group",from:{facet:{data:model.requestDataName(DataSourceType.Main),name:"stack_group_"+model.requestDataName(DataSourceType.Main),groupby:groupby,aggregate:{fields:[stackField({suffix:"start"}),stackField({suffix:"start"}),stackField({suffix:"end"}),stackField({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:groupUpdate},marks:[{type:"group",encode:{update:innerGroupUpdate},marks:[mark]}]}]}(model)}return getMarkGroup(model)}function getMarkGroup(model,opt={fromPrefix:""}){const{mark:mark,markDef:markDef,encoding:encoding,config:config}=model,clip=getFirstDefined(markDef.clip,function(model){const xScale=model.getScaleComponent("x"),yScale=model.getScaleComponent("y");return!!(xScale&&xScale.get("selectionExtent")||yScale&&yScale.get("selectionExtent"))||void 0}(model),function(model){const projection=model.component.projection;return!(!projection||projection.isFit)||void 0}(model)),style=getStyles(markDef),key=encoding.key,sort=function(model){const{encoding:encoding,stack:stack,mark:mark,markDef:markDef,config:config}=model,order=encoding.order;if(!(!vegaUtil.isArray(order)&&isValueDef(order)&&isNullOrFalse(order.value)||!order&&isNullOrFalse(getMarkPropOrConfig("order",markDef,config)))){if((vegaUtil.isArray(order)||isFieldDef(order))&&!stack)return sortParams(order,{expr:"datum"});if(isPathMark(mark)){const dimensionChannel="horizontal"===markDef.orient?"y":"x",dimensionChannelDef=encoding[dimensionChannel];if(isFieldDef(dimensionChannelDef)){const s=dimensionChannelDef.sort;return vegaUtil.isArray(s)?{field:vgField(dimensionChannelDef,{prefix:dimensionChannel,suffix:"sort_index",expr:"datum"})}:isSortField(s)?{field:vgField({aggregate:isAggregate(model.encoding)?s.op:void 0,field:s.field},{expr:"datum"})}:isSortByEncoding(s)?{field:vgField(model.fieldDef(s.encoding),{expr:"datum"}),order:s.order}:null===s?void 0:{field:vgField(dimensionChannelDef,{binSuffix:model.stack&&model.stack.impute?"mid":void 0,expr:"datum"})}}}}}(model),interactive=function(model){if(!model.component.selection)return null;const unitCount=keys(model.component.selection).length;let parentCount=unitCount,parent=model.parent;for(;parent&&0===parentCount;)parentCount=keys(parent.component.selection).length,parent=parent.parent;return parentCount?{interactive:unitCount>0||!!model.encoding.tooltip}:null}(model),aria=getMarkPropOrConfig("aria",markDef,config),postEncodingTransform=markCompiler[mark].postEncodingTransform?markCompiler[mark].postEncodingTransform(model):null;return[{name:model.getName("marks"),type:markCompiler[mark].vgMark,...clip?{clip:!0}:{},...style?{style:style}:{},...key?{key:key.field}:{},...sort?{sort:sort}:{},...interactive||{},...!1===aria?{aria:aria}:{},from:{data:opt.fromPrefix+model.requestDataName(DataSourceType.Main)},encode:{update:markCompiler[mark].encodeEntry(model)},...postEncodingTransform?{transform:postEncodingTransform}:{}}]}class UnitModel extends ModelWithField{constructor(spec,parent,parentGivenName,parentGivenSize={},config){var _spec$params;super(spec,"unit",parent,parentGivenName,config,void 0,isFrameMixins(spec)?spec.view:void 0),_defineProperty(this,"markDef",void 0),_defineProperty(this,"encoding",void 0),_defineProperty(this,"specifiedScales",{}),_defineProperty(this,"stack",void 0),_defineProperty(this,"specifiedAxes",{}),_defineProperty(this,"specifiedLegends",{}),_defineProperty(this,"specifiedProjection",{}),_defineProperty(this,"selection",[]),_defineProperty(this,"children",[]);const markDef=isMarkDef(spec.mark)?{...spec.mark}:{type:spec.mark},mark=markDef.type;void 0===markDef.filled&&(markDef.filled=function(markDef,config,{graticule:graticule}){if(graticule)return!1;const filledConfig=getMarkConfig("filled",markDef,config),mark=markDef.type;return getFirstDefined(filledConfig,mark!==POINT&&mark!==LINE&&mark!==RULE)}(markDef,config,{graticule:spec.data&&isGraticuleGenerator(spec.data)}));const encoding=this.encoding=initEncoding(spec.encoding||{},mark,markDef.filled,config);this.markDef=initMarkdef(markDef,encoding,config),this.size=function({encoding:encoding,size:size}){for(const channel of POSITION_SCALE_CHANNELS){const sizeType=getSizeChannel(channel);isStep(size[sizeType])&&isContinuousFieldOrDatumDef(encoding[channel])&&(delete size[sizeType],warn(stepDropped(sizeType)))}return size}({encoding:encoding,size:isFrameMixins(spec)?{...parentGivenSize,...spec.width?{width:spec.width}:{},...spec.height?{height:spec.height}:{}}:parentGivenSize}),this.stack=stack(mark,encoding),this.specifiedScales=this.initScales(mark,encoding),this.specifiedAxes=this.initAxes(encoding),this.specifiedLegends=this.initLegends(encoding),this.specifiedProjection=spec.projection,this.selection=(null!==(_spec$params=spec.params)&&void 0!==_spec$params?_spec$params:[]).filter(p=>isSelectionParameter(p))}get hasProjection(){const{encoding:encoding}=this,isGeoShapeMark=this.mark===GEOSHAPE,hasGeoPosition=encoding&&GEOPOSITION_CHANNELS.some(channel=>isFieldOrDatumDef(encoding[channel]));return isGeoShapeMark||hasGeoPosition}scaleDomain(channel){const scale=this.specifiedScales[channel];return scale?scale.domain:void 0}axis(channel){return this.specifiedAxes[channel]}legend(channel){return this.specifiedLegends[channel]}initScales(mark,encoding){return SCALE_CHANNELS.reduce((scales,channel)=>{const fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]);var _fieldOrDatumDef$scal;return fieldOrDatumDef&&(scales[channel]=this.initScale(null!==(_fieldOrDatumDef$scal=fieldOrDatumDef.scale)&&void 0!==_fieldOrDatumDef$scal?_fieldOrDatumDef$scal:{})),scales},{})}initScale(scale){const{domain:domain,range:range}=scale,scaleInternal=replaceExprRef(scale);return vegaUtil.isArray(domain)&&(scaleInternal.domain=domain.map(signalRefOrValue)),vegaUtil.isArray(range)&&(scaleInternal.range=range.map(signalRefOrValue)),scaleInternal}initAxes(encoding){return POSITION_SCALE_CHANNELS.reduce((_axis,channel)=>{const channelDef=encoding[channel];if(isFieldOrDatumDef(channelDef)||channel===X&&isFieldOrDatumDef(encoding.x2)||channel===Y&&isFieldOrDatumDef(encoding.y2)){const axisSpec=isFieldOrDatumDef(channelDef)?channelDef.axis:void 0;_axis[channel]=axisSpec?this.initAxis({...axisSpec}):axisSpec}return _axis},{})}initAxis(axis){const props=keys(axis),axisInternal={};for(const prop of props){const val=axis[prop];axisInternal[prop]=isConditionalAxisValue(val)?signalOrValueRefWithCondition(val):signalRefOrValue(val)}return axisInternal}initLegends(encoding){return NONPOSITION_SCALE_CHANNELS.reduce((_legend,channel)=>{const fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]);if(fieldOrDatumDef&&function(channel){switch(channel){case COLOR:case FILL:case STROKE:case SIZE:case SHAPE:case"opacity":case"strokeWidth":case"strokeDash":return!0;case"fillOpacity":case"strokeOpacity":case"angle":return!1}}(channel)){const legend=fieldOrDatumDef.legend;_legend[channel]=legend?replaceExprRef(legend):legend}return _legend},{})}parseData(){this.component.data=parseData(this)}parseLayoutSize(){!function(model){const{size:size,component:component}=model;for(const channel of POSITION_SCALE_CHANNELS){const sizeType=getSizeChannel(channel);if(size[sizeType]){const specifiedSize=size[sizeType];component.layoutSize.set(sizeType,isStep(specifiedSize)?"step":specifiedSize,!0)}else{const defaultSize=defaultUnitSize(model,sizeType);component.layoutSize.set(sizeType,defaultSize,!1)}}}(this)}parseSelections(){this.component.selection=function(model,selDefs){const selCmpts={},selectionConfig=model.config.selection;if(!selDefs||!selDefs.length)return selCmpts;for(const def of selDefs){const name=varName(def.name),selDef=def.select,type=vegaUtil.isString(selDef)?selDef:selDef.type,defaults=vegaUtil.isObject(selDef)?duplicate(selDef):{type:type},{fields:fields,encodings:encodings,...cfg}=selectionConfig[type];for(const key in cfg){var _cfg$key;"mark"===key&&(defaults[key]={...cfg[key],...defaults[key]}),(void 0===defaults[key]||!0===defaults[key])&&(defaults[key]=null!==(_cfg$key=cfg[key])&&void 0!==_cfg$key?_cfg$key:defaults[key])}const selCmpt=selCmpts[name]={...defaults,name:name,type:type,init:def.value,bind:def.bind,events:vegaUtil.isString(defaults.on)?eventSelector(defaults.on,"scope"):vegaUtil.array(duplicate(defaults.on))};for(const c of selectionCompilers)c.defined(selCmpt)&&c.parse&&c.parse(model,selCmpt,def)}return selCmpts}(this,this.selection)}parseMarkGroup(){this.component.mark=parseMarkGroups(this)}parseAxesAndHeaders(){var model;this.component.axes=(model=this,POSITION_SCALE_CHANNELS.reduce((axis,channel)=>(model.component.scales[channel]&&(axis[channel]=[parseAxis(channel,model)]),axis),{}))}assembleSelectionTopLevelSignals(signals){return function(model,signals){let hasSelections=!1;for(const selCmpt of vals(null!==(_model$component$sele2=model.component.selection)&&void 0!==_model$component$sele2?_model$component$sele2:{})){var _model$component$sele2;const name=selCmpt.name,store=vegaUtil.stringValue(name+STORE);if(0===signals.filter(s=>s.name===name).length){const resolve="global"===selCmpt.resolve?"union":selCmpt.resolve,isPoint="point"===selCmpt.type?", true, true)":")";signals.push({name:selCmpt.name,update:"".concat(VL_SELECTION_RESOLVE,"(").concat(store,", ").concat(vegaUtil.stringValue(resolve)).concat(isPoint)})}hasSelections=!0;for(const c of selectionCompilers)c.defined(selCmpt)&&c.topLevelSignals&&(signals=c.topLevelSignals(model,selCmpt,signals))}return hasSelections&&0===signals.filter(s=>"unit"===s.name).length&&signals.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),cleanupEmptyOnArray(signals)}(this,signals)}assembleSignals(){return[...assembleAxisSignals(this),...assembleUnitSelectionSignals(this,[])]}assembleSelectionData(data){return function(model,data){const dataCopy=[...data];for(const selCmpt of vals(null!==(_model$component$sele3=model.component.selection)&&void 0!==_model$component$sele3?_model$component$sele3:{})){var _model$component$sele3;const init={name:selCmpt.name+STORE};if(selCmpt.init){const fields=selCmpt.project.items.map(proj=>{const{signals:signals,...rest}=proj;return rest});init.values=selCmpt.init.map(i=>({unit:unitName(model,{escape:!1}),fields:fields,values:assembleInit(i,!1)}))}dataCopy.filter(d=>d.name===selCmpt.name+STORE).length||dataCopy.push(init)}return dataCopy}(this,data)}assembleLayout(){return null}assembleLayoutSignals(){return assembleLayoutSignals(this)}assembleMarks(){var _this$component$mark;let marks=null!==(_this$component$mark=this.component.mark)&&void 0!==_this$component$mark?_this$component$mark:[];return this.parent&&isLayerModel(this.parent)||(marks=assembleUnitSelectionMarks(this,marks)),marks.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(channel){return channelHasField(this.encoding,channel)}fieldDef(channel){return getFieldDef(this.encoding[channel])}typedFieldDef(channel){const fieldDef=this.fieldDef(channel);return isTypedFieldDef(fieldDef)?fieldDef:null}}class LayerModel extends Model{constructor(spec,parent,parentGivenName,parentGivenSize,config){super(spec,"layer",parent,parentGivenName,config,spec.resolve,spec.view),_defineProperty(this,"children",void 0);const layoutSize={...parentGivenSize,...spec.width?{width:spec.width}:{},...spec.height?{height:spec.height}:{}};this.children=spec.layer.map((layer,i)=>{if(isLayerSpec(layer))return new LayerModel(layer,this,this.getName("layer_".concat(i)),layoutSize,config);if(isUnitSpec(layer))return new UnitModel(layer,this,this.getName("layer_".concat(i)),layoutSize,config);throw new Error(invalidSpec(layer))})}parseData(){this.component.data=parseData(this);for(const child of this.children)child.parseData()}parseLayoutSize(){var model;parseChildrenLayoutSize(model=this),parseNonUnitLayoutSizeForChannel(model,"width"),parseNonUnitLayoutSizeForChannel(model,"height")}parseSelections(){this.component.selection={};for(const child of this.children){child.parseSelections();for(const key of keys(child.component.selection))this.component.selection[key]=child.component.selection[key]}}parseMarkGroup(){for(const child of this.children)child.parseMarkGroup()}parseAxesAndHeaders(){!function(model){const{axes:axes,resolve:resolve}=model.component,axisCount={top:0,bottom:0,right:0,left:0};for(const child of model.children){child.parseAxesAndHeaders();for(const channel of keys(child.component.axes))resolve.axis[channel]=parseGuideResolve(model.component.resolve,channel),"shared"===resolve.axis[channel]&&(axes[channel]=mergeAxisComponents(axes[channel],child.component.axes[channel]),axes[channel]||(resolve.axis[channel]="independent",delete axes[channel]))}for(const channel of POSITION_SCALE_CHANNELS){for(const child of model.children)if(child.component.axes[channel]){if("independent"===resolve.axis[channel]){var _axes$channel;axes[channel]=(null!==(_axes$channel=axes[channel])&&void 0!==_axes$channel?_axes$channel:[]).concat(child.component.axes[channel]);for(const axisComponent of child.component.axes[channel]){const{value:orient,explicit:explicit}=axisComponent.getWithExplicit("orient");if(!isSignalRef(orient)){if(axisCount[orient]>0&&!explicit){const oppositeOrient=OPPOSITE_ORIENT[orient];axisCount[orient]>axisCount[oppositeOrient]&&axisComponent.set("orient",oppositeOrient,!1)}axisCount[orient]++}}}delete child.component.axes[channel]}if("independent"===resolve.axis[channel]&&axes[channel]&&axes[channel].length>1)for(const axisCmpt of axes[channel])axisCmpt.get("grid")&&!axisCmpt.explicit.grid&&(axisCmpt.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(signals){return this.children.reduce((sg,child)=>child.assembleSelectionTopLevelSignals(sg),signals)}assembleSignals(){return this.children.reduce((signals,child)=>signals.concat(child.assembleSignals()),assembleAxisSignals(this))}assembleLayoutSignals(){return this.children.reduce((signals,child)=>signals.concat(child.assembleLayoutSignals()),assembleLayoutSignals(this))}assembleSelectionData(data){return this.children.reduce((db,child)=>child.assembleSelectionData(db),data)}assembleTitle(){let title=super.assembleTitle();if(title)return title;for(const child of this.children)if(title=child.assembleTitle(),title)return title}assembleLayout(){return null}assembleMarks(){return function(model,marks){for(const child of model.children)isUnitModel(child)&&(marks=assembleUnitSelectionMarks(child,marks));return marks}(this,this.children.flatMap(child=>child.assembleMarks()))}assembleLegends(){return this.children.reduce((legends,child)=>legends.concat(child.assembleLegends()),assembleLegends(this))}}function buildModel(spec,parent,parentGivenName,unitSize,config){if(isFacetSpec(spec))return new FacetModel(spec,parent,parentGivenName,config);if(isLayerSpec(spec))return new LayerModel(spec,parent,parentGivenName,unitSize,config);if(isUnitSpec(spec))return new UnitModel(spec,parent,parentGivenName,unitSize,config);if(function(spec){return isVConcatSpec(spec)||isHConcatSpec(spec)||isConcatSpec(spec)}(spec))return new ConcatModel(spec,parent,parentGivenName,config);throw new Error(invalidSpec(spec))}const version$1=pkg_version;exports.accessPathDepth=accessPathDepth,exports.accessPathWithDatum=accessPathWithDatum,exports.compile=function(inputSpec,opt={}){var newLogger;opt.logger&&(newLogger=opt.logger,current=newLogger),opt.fieldTitle&&setTitleFormatter(opt.fieldTitle);try{const config=initConfig(vegaUtil.mergeConfig(opt.config,inputSpec.config)),spec=normalize(inputSpec,config),model=buildModel(spec,null,"",void 0,config);return model.parse(),function(data,model){checkLinks(data.sources);let firstPassCounter=0,secondPassCounter=0;for(let i=0;i<5&&optimizationDataflowHelper(data,model,!0);i++)firstPassCounter++;data.sources.map(moveFacetDown);for(let i=0;i<5&&optimizationDataflowHelper(data,model,!1);i++)secondPassCounter++;checkLinks(data.sources),5===Math.max(firstPassCounter,secondPassCounter)&&warn("Maximum optimization runs(".concat(5,") reached."))}(model.component.data,model),{spec:function(model,topLevelProperties,datasets={},usermeta){const vgConfig=model.config?stripAndRedirectConfig(model.config):void 0,data=[].concat(model.assembleSelectionData([]),function(dataComponent,datasets){const data=[],walkTree=makeWalkTree(data);let sourceIndex=0;for(const root of dataComponent.sources){root.hasName()||(root.dataName="source_".concat(sourceIndex++));const newData=root.assemble();walkTree(root,newData)}for(const d of data)0===d.transform.length&&delete d.transform;let whereTo=0;for(const[i,d]of data.entries()){var _d$transform;0!==(null!==(_d$transform=d.transform)&&void 0!==_d$transform?_d$transform:[]).length||d.source||data.splice(whereTo++,0,data.splice(i,1)[0])}for(const d of data)for(const t of null!==(_d$transform2=d.transform)&&void 0!==_d$transform2?_d$transform2:[]){var _d$transform2;"lookup"===t.type&&(t.from=dataComponent.outputNodes[t.from].getSource())}for(const d of data)d.name in datasets&&(d.values=datasets[d.name]);return data}(model.component.data,datasets)),projections=model.assembleProjections(),title=model.assembleTitle(),style=model.assembleGroupStyle(),encodeEntry=model.assembleGroupEncodeEntry(!0);let layoutSignals=model.assembleLayoutSignals();layoutSignals=layoutSignals.filter(signal=>"width"!==signal.name&&"height"!==signal.name||void 0===signal.value||(topLevelProperties[signal.name]=+signal.value,!1));const{params:params,...otherTopLevelProps}=topLevelProperties;return{$schema:"https://vega.github.io/schema/vega/v5.json",...model.description?{description:model.description}:{},...otherTopLevelProps,...title?{title:title}:{},...style?{style:style}:{},...encodeEntry?{encode:{update:encodeEntry}}:{},data:data,...projections.length>0?{projections:projections}:{},...model.assembleGroup([...layoutSignals,...model.assembleSelectionTopLevelSignals([]),...assembleParameterSignals(params)]),...vgConfig?{config:vgConfig}:{},...usermeta?{usermeta:usermeta}:{}}}(model,function(inputSpec,autosize,config,model){const width=model.component.layoutSize.get("width"),height=model.component.layoutSize.get("height");if(void 0===autosize?(autosize={type:"pad"},model.hasAxisOrientSignalRef()&&(autosize.resize=!0)):vegaUtil.isString(autosize)&&(autosize={type:autosize}),width&&height&&("fit"===(autoSizeType=autosize.type)||"fit-x"===autoSizeType||"fit-y"===autoSizeType))if("step"===width&&"step"===height)warn(droppingFit()),autosize.type="pad";else if("step"===width||"step"===height){const sizeType="step"===width?"width":"height";warn(droppingFit(getPositionScaleChannel(sizeType)));const inverseSizeType="width"===sizeType?"height":"width";autosize.type=function(sizeType){return sizeType?"fit-".concat(getPositionScaleChannel(sizeType)):"fit"}(inverseSizeType)}var autoSizeType;return{...1===keys(autosize).length&&autosize.type?"pad"===autosize.type?{}:{autosize:autosize.type}:{autosize:autosize},...extractTopLevelProperties(config,!1),...extractTopLevelProperties(inputSpec,!0)}}(inputSpec,spec.autosize,config,model),inputSpec.datasets,inputSpec.usermeta),normalized:spec}}finally{opt.logger&&(current=main$1),opt.fieldTitle&&setTitleFormatter(defaultTitleFormatter)}},exports.contains=contains,exports.deepEqual=deepEqual,exports.deleteNestedProperty=deleteNestedProperty,exports.duplicate=duplicate,exports.entries=entries,exports.every=every,exports.fieldIntersection=fieldIntersection,exports.flatAccessWithDatum=flatAccessWithDatum,exports.getFirstDefined=getFirstDefined,exports.hasIntersection=hasIntersection,exports.hash=hash,exports.internalField=internalField,exports.isBoolean=isBoolean,exports.isEmpty=isEmpty,exports.isEqual=function(dict,other){const dictKeys=keys(dict),otherKeys=keys(other);if(dictKeys.length!==otherKeys.length)return!1;for(const key of dictKeys)if(dict[key]!==other[key])return!1;return!0},exports.isInternalField=isInternalField,exports.isNullOrFalse=isNullOrFalse,exports.isNumeric=isNumeric,exports.keys=keys,exports.logicalExpr=logicalExpr,exports.mergeDeep=mergeDeep,exports.normalize=normalize,exports.normalizeAngle=normalizeAngle,exports.omit=omit,exports.pick=pick,exports.prefixGenerator=prefixGenerator,exports.removePathFromField=removePathFromField,exports.replaceAll=replaceAll,exports.replacePathInField=replacePathInField,exports.resetIdCounter=function(){idCounter=42},exports.setEqual=setEqual,exports.some=some,exports.stringify=stringify,exports.titleCase=titleCase,exports.unique=unique,exports.uniqueId=uniqueId,exports.vals=vals,exports.varName=varName,exports.version=version$1,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(48))}).call(this,__webpack_require__(72).Buffer)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Utils}));var json_stringify_pretty_compact__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(63),json_stringify_pretty_compact__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(json_stringify_pretty_compact__WEBPACK_IMPORTED_MODULE_0__);class Utils{static formatWarningToStr(...args){let value=args[0];if(args.length>=2)try{"string"==typeof args[1]?value+="\n"+args[1]:value+="\n"+json_stringify_pretty_compact__WEBPACK_IMPORTED_MODULE_0___default()(args[1],{maxLength:70})}catch(err){}return value}static formatErrorToStr(...args){let error=args[0];return error?error instanceof Error&&(error=error.message):error="ERR",Utils.formatWarningToStr(error,...Array.from(args).slice(1))}}},,,,,,function(module,exports,__webpack_require__){"use strict";exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function formatDecimalParts(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return(x=formatDecimalParts(Math.abs(x)))?x[1]:NaN}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;return new FormatSpecifier({fill:match[1],align:match[2],sign:match[3],symbol:match[4],zero:match[5],width:match[6],comma:match[7],precision:match[8]&&match[8].slice(1),trim:match[9],type:match[10]})}function FormatSpecifier(specifier){this.fill=void 0===specifier.fill?" ":specifier.fill+"",this.align=void 0===specifier.align?">":specifier.align+"",this.sign=void 0===specifier.sign?"-":specifier.sign+"",this.symbol=void 0===specifier.symbol?"":specifier.symbol+"",this.zero=!!specifier.zero,this.width=void 0===specifier.width?void 0:+specifier.width,this.comma=!!specifier.comma,this.precision=void 0===specifier.precision?void 0:+specifier.precision,this.trim=!!specifier.trim,this.type=void 0===specifier.type?"":specifier.type+""}function formatRounded(x,p){var d=formatDecimalParts(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var formatTypes={"%":(x,p)=>(100*x).toFixed(p),b:x=>Math.round(x).toString(2),c:x=>x+"",d:function(x){return Math.abs(x=Math.round(x))>=1e21?x.toLocaleString("en").replace(/,/g,""):x.toString(10)},e:(x,p)=>x.toExponential(p),f:(x,p)=>x.toFixed(p),g:(x,p)=>x.toPrecision(p),o:x=>Math.round(x).toString(8),p:(x,p)=>formatRounded(100*x,p),r:formatRounded,s:function(x,p){var d=formatDecimalParts(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(exponent/3))))+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimalParts(x,Math.max(0,p+i-1))[0]},X:x=>Math.round(x).toString(16).toUpperCase(),x:x=>Math.round(x).toString(16)};function identity(x){return x}var locale,map=Array.prototype.map,prefixes=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(locale){var grouping,thousands,group=void 0===locale.grouping||void 0===locale.thousands?identity:(grouping=map.call(locale.grouping,Number),thousands=locale.thousands+"",function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}),currencyPrefix=void 0===locale.currency?"":locale.currency[0]+"",currencySuffix=void 0===locale.currency?"":locale.currency[1]+"",decimal=void 0===locale.decimal?".":locale.decimal+"",numerals=void 0===locale.numerals?identity:function(numerals){return function(value){return value.replace(/[0-9]/g,(function(i){return numerals[+i]}))}}(map.call(locale.numerals,String)),percent=void 0===locale.percent?"%":locale.percent+"",minus=void 0===locale.minus?"âˆ’":locale.minus+"",nan=void 0===locale.nan?"NaN":locale.nan+"";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(void 0===precision&&(precision=12),trim=!0,type="g"),(zero||"0"===fill&&"="===align)&&(zero=!0,fill="0",align="=");var prefix="$"===symbol?currencyPrefix:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currencySuffix:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format(value){var i,n,c,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0||1/value<0;if(value=isNaN(value)?nan:formatType(Math.abs(value),precision),trim&&(value=function(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(!+s[i])break out;i0>0&&(i0=0)}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}(value)),valueNegative&&0==+value&&"+"!==sign&&(valueNegative=!1),valuePrefix=(valueNegative?"("===sign?sign:minus:"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if(48>(c=value.charCodeAt(i))||c>57){valueSuffix=(46===c?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero&&(value=group(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero&&(value=group(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=void 0===precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format.toString=function(){return specifier+""},format}return{format:newFormat,formatPrefix:function(specifier,value){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}}}function defaultLocale(definition){return locale=formatLocale(definition),exports.format=locale.format,exports.formatPrefix=locale.formatPrefix,locale}defaultLocale({thousands:",",grouping:[3],currency:["$",""]}),exports.FormatSpecifier=FormatSpecifier,exports.formatDefaultLocale=defaultLocale,exports.formatLocale=formatLocale,exports.formatSpecifier=formatSpecifier,exports.precisionFixed=function(step){return Math.max(0,-exponent(Math.abs(step)))},exports.precisionPrefix=function(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))-exponent(Math.abs(step)))},exports.precisionRound=function(step,max){return step=Math.abs(step),max=Math.abs(max)-step,Math.max(0,exponent(max)-exponent(step))+1},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";var t0=new Date,t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=0===arguments.length?new Date:new Date(+date)),date}return interval.floor=function(date){return floori(date=new Date(+date)),date},interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range},interval.filter=function(test){return newInterval((function(date){if(date>=date)for(;floori(date),!test(date);)date.setTime(date-1)}),(function(date,step){if(date>=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;--step>=0;)for(;offseti(date,1),!test(date););}))},count&&(interval.count=function(start,end){return t0.setTime(+start),t1.setTime(+end),floori(t0),floori(t1),Math.floor(count(t0,t1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&step>0?step>1?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var millisecond=newInterval((function(){}),(function(date,step){date.setTime(+date+step)}),(function(start,end){return end-start}));millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&k>0?k>1?newInterval((function(date){date.setTime(Math.floor(date/k)*k)}),(function(date,step){date.setTime(+date+step*k)}),(function(start,end){return(end-start)/k})):millisecond:null};var milliseconds=millisecond.range,second=newInterval((function(date){date.setTime(date-date.getMilliseconds())}),(function(date,step){date.setTime(+date+1e3*step)}),(function(start,end){return(end-start)/1e3}),(function(date){return date.getUTCSeconds()})),seconds=second.range,minute=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds())}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getMinutes()})),minutes=minute.range,hour=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds()-6e4*date.getMinutes())}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getHours()})),hours=hour.range,day=newInterval(date=>date.setHours(0,0,0,0),(date,step)=>date.setDate(date.getDate()+step),(start,end)=>(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/864e5,date=>date.getDate()-1),days=day.range;function weekday(i){return newInterval((function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)}),(function(date,step){date.setDate(date.getDate()+7*step)}),(function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/6048e5}))}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),sundays=sunday.range,mondays=monday.range,tuesdays=tuesday.range,wednesdays=wednesday.range,thursdays=thursday.range,fridays=friday.range,saturdays=saturday.range,month=newInterval((function(date){date.setDate(1),date.setHours(0,0,0,0)}),(function(date,step){date.setMonth(date.getMonth()+step)}),(function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())}),(function(date){return date.getMonth()})),months=month.range,year=newInterval((function(date){date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step)}),(function(start,end){return end.getFullYear()-start.getFullYear()}),(function(date){return date.getFullYear()}));year.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step*k)})):null};var years=year.range,utcMinute=newInterval((function(date){date.setUTCSeconds(0,0)}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getUTCMinutes()})),utcMinutes=utcMinute.range,utcHour=newInterval((function(date){date.setUTCMinutes(0,0,0)}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getUTCHours()})),utcHours=utcHour.range,utcDay=newInterval((function(date){date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+step)}),(function(start,end){return(end-start)/864e5}),(function(date){return date.getUTCDate()-1})),utcDays=utcDay.range;function utcWeekday(i){return newInterval((function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+7*step)}),(function(start,end){return(end-start)/6048e5}))}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcSundays=utcSunday.range,utcMondays=utcMonday.range,utcTuesdays=utcTuesday.range,utcWednesdays=utcWednesday.range,utcThursdays=utcThursday.range,utcFridays=utcFriday.range,utcSaturdays=utcSaturday.range,utcMonth=newInterval((function(date){date.setUTCDate(1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCMonth(date.getUTCMonth()+step)}),(function(start,end){return end.getUTCMonth()-start.getUTCMonth()+12*(end.getUTCFullYear()-start.getUTCFullYear())}),(function(date){return date.getUTCMonth()})),utcMonths=utcMonth.range,utcYear=newInterval((function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)}),(function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()}),(function(date){return date.getUTCFullYear()}));utcYear.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})):null};var utcYears=utcYear.range;exports.timeDay=day,exports.timeDays=days,exports.timeFriday=friday,exports.timeFridays=fridays,exports.timeHour=hour,exports.timeHours=hours,exports.timeInterval=newInterval,exports.timeMillisecond=millisecond,exports.timeMilliseconds=milliseconds,exports.timeMinute=minute,exports.timeMinutes=minutes,exports.timeMonday=monday,exports.timeMondays=mondays,exports.timeMonth=month,exports.timeMonths=months,exports.timeSaturday=saturday,exports.timeSaturdays=saturdays,exports.timeSecond=second,exports.timeSeconds=seconds,exports.timeSunday=sunday,exports.timeSundays=sundays,exports.timeThursday=thursday,exports.timeThursdays=thursdays,exports.timeTuesday=tuesday,exports.timeTuesdays=tuesdays,exports.timeWednesday=wednesday,exports.timeWednesdays=wednesdays,exports.timeWeek=sunday,exports.timeWeeks=sundays,exports.timeYear=year,exports.timeYears=years,exports.utcDay=utcDay,exports.utcDays=utcDays,exports.utcFriday=utcFriday,exports.utcFridays=utcFridays,exports.utcHour=utcHour,exports.utcHours=utcHours,exports.utcMillisecond=millisecond,exports.utcMilliseconds=milliseconds,exports.utcMinute=utcMinute,exports.utcMinutes=utcMinutes,exports.utcMonday=utcMonday,exports.utcMondays=utcMondays,exports.utcMonth=utcMonth,exports.utcMonths=utcMonths,exports.utcSaturday=utcSaturday,exports.utcSaturdays=utcSaturdays,exports.utcSecond=second,exports.utcSeconds=seconds,exports.utcSunday=utcSunday,exports.utcSundays=utcSundays,exports.utcThursday=utcThursday,exports.utcThursdays=utcThursdays,exports.utcTuesday=utcTuesday,exports.utcTuesdays=utcTuesdays,exports.utcWednesday=utcWednesday,exports.utcWednesdays=utcWednesdays,exports.utcWeek=utcSunday,exports.utcWeeks=utcSundays,exports.utcYear=utcYear,exports.utcYears=utcYears,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";var t0=new Date,t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=0===arguments.length?new Date:new Date(+date)),date}return interval.floor=function(date){return floori(date=new Date(+date)),date},interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range},interval.filter=function(test){return newInterval((function(date){if(date>=date)for(;floori(date),!test(date);)date.setTime(date-1)}),(function(date,step){if(date>=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;--step>=0;)for(;offseti(date,1),!test(date););}))},count&&(interval.count=function(start,end){return t0.setTime(+start),t1.setTime(+end),floori(t0),floori(t1),Math.floor(count(t0,t1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&step>0?step>1?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var millisecond=newInterval((function(){}),(function(date,step){date.setTime(+date+step)}),(function(start,end){return end-start}));millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&k>0?k>1?newInterval((function(date){date.setTime(Math.floor(date/k)*k)}),(function(date,step){date.setTime(+date+step*k)}),(function(start,end){return(end-start)/k})):millisecond:null};var milliseconds=millisecond.range,second=newInterval((function(date){date.setTime(date-date.getMilliseconds())}),(function(date,step){date.setTime(+date+1e3*step)}),(function(start,end){return(end-start)/1e3}),(function(date){return date.getUTCSeconds()})),seconds=second.range,minute=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds())}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getMinutes()})),minutes=minute.range,hour=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds()-6e4*date.getMinutes())}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getHours()})),hours=hour.range,day=newInterval(date=>date.setHours(0,0,0,0),(date,step)=>date.setDate(date.getDate()+step),(start,end)=>(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/864e5,date=>date.getDate()-1),days=day.range;function weekday(i){return newInterval((function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)}),(function(date,step){date.setDate(date.getDate()+7*step)}),(function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/6048e5}))}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),sundays=sunday.range,mondays=monday.range,tuesdays=tuesday.range,wednesdays=wednesday.range,thursdays=thursday.range,fridays=friday.range,saturdays=saturday.range,month=newInterval((function(date){date.setDate(1),date.setHours(0,0,0,0)}),(function(date,step){date.setMonth(date.getMonth()+step)}),(function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())}),(function(date){return date.getMonth()})),months=month.range,year=newInterval((function(date){date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step)}),(function(start,end){return end.getFullYear()-start.getFullYear()}),(function(date){return date.getFullYear()}));year.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step*k)})):null};var years=year.range,utcMinute=newInterval((function(date){date.setUTCSeconds(0,0)}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getUTCMinutes()})),utcMinutes=utcMinute.range,utcHour=newInterval((function(date){date.setUTCMinutes(0,0,0)}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getUTCHours()})),utcHours=utcHour.range,utcDay=newInterval((function(date){date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+step)}),(function(start,end){return(end-start)/864e5}),(function(date){return date.getUTCDate()-1})),utcDays=utcDay.range;function utcWeekday(i){return newInterval((function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+7*step)}),(function(start,end){return(end-start)/6048e5}))}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcSundays=utcSunday.range,utcMondays=utcMonday.range,utcTuesdays=utcTuesday.range,utcWednesdays=utcWednesday.range,utcThursdays=utcThursday.range,utcFridays=utcFriday.range,utcSaturdays=utcSaturday.range,utcMonth=newInterval((function(date){date.setUTCDate(1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCMonth(date.getUTCMonth()+step)}),(function(start,end){return end.getUTCMonth()-start.getUTCMonth()+12*(end.getUTCFullYear()-start.getUTCFullYear())}),(function(date){return date.getUTCMonth()})),utcMonths=utcMonth.range,utcYear=newInterval((function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)}),(function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()}),(function(date){return date.getUTCFullYear()}));utcYear.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})):null};var utcYears=utcYear.range;exports.timeDay=day,exports.timeDays=days,exports.timeFriday=friday,exports.timeFridays=fridays,exports.timeHour=hour,exports.timeHours=hours,exports.timeInterval=newInterval,exports.timeMillisecond=millisecond,exports.timeMilliseconds=milliseconds,exports.timeMinute=minute,exports.timeMinutes=minutes,exports.timeMonday=monday,exports.timeMondays=mondays,exports.timeMonth=month,exports.timeMonths=months,exports.timeSaturday=saturday,exports.timeSaturdays=saturdays,exports.timeSecond=second,exports.timeSeconds=seconds,exports.timeSunday=sunday,exports.timeSundays=sundays,exports.timeThursday=thursday,exports.timeThursdays=thursdays,exports.timeTuesday=tuesday,exports.timeTuesdays=tuesdays,exports.timeWednesday=wednesday,exports.timeWednesdays=wednesdays,exports.timeWeek=sunday,exports.timeWeeks=sundays,exports.timeYear=year,exports.timeYears=years,exports.utcDay=utcDay,exports.utcDays=utcDays,exports.utcFriday=utcFriday,exports.utcFridays=utcFridays,exports.utcHour=utcHour,exports.utcHours=utcHours,exports.utcMillisecond=millisecond,exports.utcMilliseconds=milliseconds,exports.utcMinute=utcMinute,exports.utcMinutes=utcMinutes,exports.utcMonday=utcMonday,exports.utcMondays=utcMondays,exports.utcMonth=utcMonth,exports.utcMonths=utcMonths,exports.utcSaturday=utcSaturday,exports.utcSaturdays=utcSaturdays,exports.utcSecond=second,exports.utcSeconds=seconds,exports.utcSunday=utcSunday,exports.utcSundays=utcSundays,exports.utcThursday=utcThursday,exports.utcThursdays=utcThursdays,exports.utcTuesday=utcTuesday,exports.utcTuesdays=utcTuesdays,exports.utcWednesday=utcWednesday,exports.utcWednesdays=utcWednesdays,exports.utcWeek=utcSunday,exports.utcWeeks=utcSundays,exports.utcYear=utcYear,exports.utcYears=utcYears,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaDataflow,vegaStatistics,d3Array,vegaTime){"use strict";function groupkey(fields){return fields&&fields.length?1===fields.length?fields[0]:(f=fields,x=>{const n=f.length;let i=1,k=String(f[0](x));for(;i<n;++i)k+="|"+f[i](x);return k}):function(){return""};var f}function measureName(op,field,as){return as||op+(field?"_"+field:"")}const noop=()=>{},base_op={init:noop,add:noop,rem:noop,idx:0},AggregateOps={values:{init:m=>m.cell.store=!0,value:m=>m.cell.data.values(),idx:-1},count:{value:m=>m.cell.num},__count__:{value:m=>m.missing+m.valid},missing:{value:m=>m.missing},valid:{value:m=>m.valid},sum:{init:m=>m.sum=0,value:m=>m.sum,add:(m,v)=>m.sum+=+v,rem:(m,v)=>m.sum-=v},product:{init:m=>m.product=1,value:m=>m.valid?m.product:void 0,add:(m,v)=>m.product*=v,rem:(m,v)=>m.product/=v},mean:{init:m=>m.mean=0,value:m=>m.valid?m.mean:void 0,add:(m,v)=>(m.mean_d=v-m.mean,m.mean+=m.mean_d/m.valid),rem:(m,v)=>(m.mean_d=v-m.mean,m.mean-=m.valid?m.mean_d/m.valid:m.mean)},average:{value:m=>m.valid?m.mean:void 0,req:["mean"],idx:1},variance:{init:m=>m.dev=0,value:m=>m.valid>1?m.dev/(m.valid-1):void 0,add:(m,v)=>m.dev+=m.mean_d*(v-m.mean),rem:(m,v)=>m.dev-=m.mean_d*(v-m.mean),req:["mean"],idx:1},variancep:{value:m=>m.valid>1?m.dev/m.valid:void 0,req:["variance"],idx:2},stdev:{value:m=>m.valid>1?Math.sqrt(m.dev/(m.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:m=>m.valid>1?Math.sqrt(m.dev/m.valid):void 0,req:["variance"],idx:2},stderr:{value:m=>m.valid>1?Math.sqrt(m.dev/(m.valid*(m.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:m=>m.cell.data.distinct(m.get),req:["values"],idx:3},ci0:{value:m=>m.cell.data.ci0(m.get),req:["values"],idx:3},ci1:{value:m=>m.cell.data.ci1(m.get),req:["values"],idx:3},median:{value:m=>m.cell.data.q2(m.get),req:["values"],idx:3},q1:{value:m=>m.cell.data.q1(m.get),req:["values"],idx:3},q3:{value:m=>m.cell.data.q3(m.get),req:["values"],idx:3},min:{init:m=>m.min=void 0,value:m=>m.min=Number.isNaN(m.min)?m.cell.data.min(m.get):m.min,add:(m,v)=>{(v<m.min||void 0===m.min)&&(m.min=v)},rem:(m,v)=>{v<=m.min&&(m.min=NaN)},req:["values"],idx:4},max:{init:m=>m.max=void 0,value:m=>m.max=Number.isNaN(m.max)?m.cell.data.max(m.get):m.max,add:(m,v)=>{(v>m.max||void 0===m.max)&&(m.max=v)},rem:(m,v)=>{v>=m.max&&(m.max=NaN)},req:["values"],idx:4},argmin:{init:m=>m.argmin=void 0,value:m=>m.argmin||m.cell.data.argmin(m.get),add:(m,v,t)=>{v<m.min&&(m.argmin=t)},rem:(m,v)=>{v<=m.min&&(m.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:m=>m.argmax=void 0,value:m=>m.argmax||m.cell.data.argmax(m.get),add:(m,v,t)=>{v>m.max&&(m.argmax=t)},rem:(m,v)=>{v>=m.max&&(m.argmax=void 0)},req:["max","values"],idx:3}},ValidAggregateOps=Object.keys(AggregateOps);function createMeasure(op,name){return AggregateOps[op](name)}function compareIndex(a,b){return a.idx-b.idx}function init(){this.valid=0,this.missing=0,this._ops.forEach(op=>op.init(this))}function add(v,t){null!=v&&""!==v?v==v&&(++this.valid,this._ops.forEach(op=>op.add(this,v,t))):++this.missing}function rem(v,t){null!=v&&""!==v?v==v&&(--this.valid,this._ops.forEach(op=>op.rem(this,v,t))):--this.missing}function set(t){return this._out.forEach(op=>t[op.out]=op.value(this)),t}function compileMeasures(agg,field){const get=field||vegaUtil.identity,ops=function(agg){const map={};agg.forEach(a=>map[a.name]=a);const getreqs=a=>{a.req&&a.req.forEach(key=>{map[key]||getreqs(map[key]=AggregateOps[key]())})};return agg.forEach(getreqs),Object.values(map).sort(compareIndex)}(agg),out=agg.slice().sort(compareIndex);function ctr(cell){this._ops=ops,this._out=out,this.cell=cell,this.init()}return ctr.prototype.init=init,ctr.prototype.add=add,ctr.prototype.rem=rem,ctr.prototype.set=set,ctr.prototype.get=get,ctr.fields=agg.map(op=>op.out),ctr}function TupleStore(key){this._key=key?vegaUtil.field(key):vegaDataflow.tupleid,this.reset()}ValidAggregateOps.forEach(key=>{AggregateOps[key]=function(key,value){return out=>vegaUtil.extend({name:key,out:out||key},base_op,value)}(key,AggregateOps[key])});const prototype=TupleStore.prototype;function Aggregate(params){vegaDataflow.Transform.call(this,null,params),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Bin(params){vegaDataflow.Transform.call(this,null,params)}function SortedList(idFunc,source,input){const $=idFunc;let data=source||[],add=input||[],rem={},cnt=0;return{add:t=>add.push(t),remove:t=>rem[$(t)]=++cnt,size:()=>data.length,data:(compare,resort)=>(cnt&&(data=data.filter(t=>!rem[$(t)]),rem={},cnt=0),resort&&compare&&data.sort(compare),add.length&&(data=compare?vegaUtil.merge(compare,data,add.sort(compare)):data.concat(add),add=[]),data)}}function Collect(params){vegaDataflow.Transform.call(this,[],params)}function Compare(params){vegaDataflow.Operator.call(this,null,update,params)}function update(_){return this.value&&!_.modified()?this.value:vegaUtil.compare(_.fields,_.orders)}function CountPattern(params){vegaDataflow.Transform.call(this,null,params)}function Cross(params){vegaDataflow.Transform.call(this,null,params)}prototype.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},prototype.add=function(v){this._add.push(v)},prototype.rem=function(v){this._rem.push(v)},prototype.values=function(){if(this._get=null,0===this._rem.length)return this._add;const a=this._add,r=this._rem,k=this._key,n=a.length,m=r.length,x=Array(n-m),map={};let i,j,v;for(i=0;i<m;++i)map[k(r[i])]=1;for(i=0,j=0;i<n;++i)map[k(v=a[i])]?map[k(v)]=0:x[j++]=v;return this._rem=[],this._add=x},prototype.distinct=function(get){const v=this.values(),map={};let s,n=v.length,count=0;for(;--n>=0;)s=get(v[n])+"",vegaUtil.hasOwnProperty(map,s)||(map[s]=1,++count);return count},prototype.extent=function(get){if(this._get!==get||!this._ext){const v=this.values(),i=vegaUtil.extentIndex(v,get);this._ext=[v[i[0]],v[i[1]]],this._get=get}return this._ext},prototype.argmin=function(get){return this.extent(get)[0]||{}},prototype.argmax=function(get){return this.extent(get)[1]||{}},prototype.min=function(get){const m=this.extent(get)[0];return null!=m?get(m):void 0},prototype.max=function(get){const m=this.extent(get)[1];return null!=m?get(m):void 0},prototype.quartile=function(get){return this._get===get&&this._q||(this._q=vegaStatistics.quartiles(this.values(),get),this._get=get),this._q},prototype.q1=function(get){return this.quartile(get)[0]},prototype.q2=function(get){return this.quartile(get)[1]},prototype.q3=function(get){return this.quartile(get)[2]},prototype.ci=function(get){return this._get===get&&this._ci||(this._ci=vegaStatistics.bootstrapCI(this.values(),1e3,.05,get),this._get=get),this._ci},prototype.ci0=function(get){return this.ci(get)[0]},prototype.ci1=function(get){return this.ci(get)[1]},Aggregate.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ValidAggregateOps},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},vegaUtil.inherits(Aggregate,vegaDataflow.Transform,{transform(_,pulse){const aggr=this,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),mod=_.modified();return aggr.stamp=out.stamp,aggr.value&&(mod||pulse.modified(aggr._inputs,!0))?(aggr._prev=aggr.value,aggr.value=mod?aggr.init(_):{},pulse.visit(pulse.SOURCE,t=>aggr.add(t))):(aggr.value=aggr.value||aggr.init(_),pulse.visit(pulse.REM,t=>aggr.rem(t)),pulse.visit(pulse.ADD,t=>aggr.add(t))),out.modifies(aggr._outputs),aggr._drop=!1!==_.drop,_.cross&&aggr._dims.length>1&&(aggr._drop=!1,aggr.cross()),pulse.clean()&&aggr._drop&&out.clean(!0).runAfter(()=>this.clean()),aggr.changes(out)},cross(){const aggr=this,curr=aggr.value,dims=aggr._dnames,vals=dims.map(()=>({})),n=dims.length;function collect(cells){let key,i,t,v;for(key in cells)for(t=cells[key].tuple,i=0;i<n;++i)vals[i][v=t[dims[i]]]=v}collect(aggr._prev),collect(curr),function generate(base,tuple,index){const name=dims[index],v=vals[index++];for(const k in v){const key=base?base+"|"+k:k;tuple[name]=v[k],index<n?generate(key,tuple,index):curr[key]||aggr.cell(key,tuple)}}("",{},0)},init(_){const inputs=this._inputs=[],outputs=this._outputs=[],inputMap={};function inputVisit(get){const fields=vegaUtil.array(vegaUtil.accessorFields(get)),n=fields.length;let f,i=0;for(;i<n;++i)inputMap[f=fields[i]]||(inputMap[f]=1,inputs.push(f))}this._dims=vegaUtil.array(_.groupby),this._dnames=this._dims.map(d=>{const dname=vegaUtil.accessorName(d);return inputVisit(d),outputs.push(dname),dname}),this.cellkey=_.key?_.key:groupkey(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const fields=_.fields||[null],ops=_.ops||["count"],as=_.as||[],n=fields.length,map={};let field,op,m,mname,outname,i;for(n!==ops.length&&vegaUtil.error("Unmatched number of fields and aggregate ops."),i=0;i<n;++i)field=fields[i],op=ops[i],null==field&&"count"!==op&&vegaUtil.error("Null aggregate field specified."),mname=vegaUtil.accessorName(field),outname=measureName(op,mname,as[i]),outputs.push(outname),"count"!==op?(m=map[mname],m||(inputVisit(field),m=map[mname]=[],m.field=field,this._measures.push(m)),"count"!==op&&(this._countOnly=!1),m.push(createMeasure(op,outname))):this._counts.push(outname);return this._measures=this._measures.map(m=>compileMeasures(m,m.field)),{}},cellkey:groupkey(),cell(key,t){let cell=this.value[key];return cell?0===cell.num&&this._drop&&cell.stamp<this.stamp?(cell.stamp=this.stamp,this._adds[this._alen++]=cell):cell.stamp<this.stamp&&(cell.stamp=this.stamp,this._mods[this._mlen++]=cell):(cell=this.value[key]=this.newcell(key,t),this._adds[this._alen++]=cell),cell},newcell(key,t){const cell={key:key,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[key]),stamp:this.stamp,store:!1};if(!this._countOnly){const measures=this._measures,n=measures.length;cell.agg=Array(n);for(let i=0;i<n;++i)cell.agg[i]=new measures[i](cell)}return cell.store&&(cell.data=new TupleStore),cell},newtuple(t,p){const names=this._dnames,dims=this._dims,n=dims.length,x={};for(let i=0;i<n;++i)x[names[i]]=dims[i](t);return p?vegaDataflow.replace(p.tuple,x):vegaDataflow.ingest(x)},clean(){const cells=this.value;for(const key in cells)0===cells[key].num&&delete cells[key]},add(t){const key=this.cellkey(t),cell=this.cell(key,t);if(cell.num+=1,this._countOnly)return;cell.store&&cell.data.add(t);const agg=cell.agg;for(let i=0,n=agg.length;i<n;++i)agg[i].add(agg[i].get(t),t)},rem(t){const key=this.cellkey(t),cell=this.cell(key,t);if(cell.num-=1,this._countOnly)return;cell.store&&cell.data.rem(t);const agg=cell.agg;for(let i=0,n=agg.length;i<n;++i)agg[i].rem(agg[i].get(t),t)},celltuple(cell){const tuple=cell.tuple,counts=this._counts;cell.store&&cell.data.values();for(let i=0,n=counts.length;i<n;++i)tuple[counts[i]]=cell.num;if(!this._countOnly){const agg=cell.agg;for(let i=0,n=agg.length;i<n;++i)agg[i].set(tuple)}return tuple},changes(out){const adds=this._adds,mods=this._mods,prev=this._prev,drop=this._drop,add=out.add,rem=out.rem,mod=out.mod;let cell,key,i,n;if(prev)for(key in prev)cell=prev[key],drop&&!cell.num||rem.push(cell.tuple);for(i=0,n=this._alen;i<n;++i)add.push(this.celltuple(adds[i])),adds[i]=null;for(i=0,n=this._mlen;i<n;++i)cell=mods[i],(0===cell.num&&drop?rem:mod).push(this.celltuple(cell)),mods[i]=null;return this._alen=this._mlen=0,this._prev=null,out}}),Bin.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},vegaUtil.inherits(Bin,vegaDataflow.Transform,{transform(_,pulse){const band=!1!==_.interval,bins=this._bins(_),start=bins.start,step=bins.step,as=_.as||["bin0","bin1"],b0=as[0],b1=as[1];let flag;return flag=_.modified()?(pulse=pulse.reflow(!0)).SOURCE:pulse.modified(vegaUtil.accessorFields(_.field))?pulse.ADD_MOD:pulse.ADD,pulse.visit(flag,band?t=>{const v=bins(t);t[b0]=v,t[b1]=null==v?null:start+step*(1+(v-start)/step)}:t=>t[b0]=bins(t)),pulse.modifies(band?as:b0)},_bins(_){if(this.value&&!_.modified())return this.value;const field=_.field,bins=vegaStatistics.bin(_),step=bins.step;let a,d,start=bins.start,stop=start+Math.ceil((bins.stop-start)/step)*step;null!=(a=_.anchor)&&(d=a-(start+step*Math.floor((a-start)/step)),start+=d,stop+=d);const f=function(t){let v=vegaUtil.toNumber(field(t));return null==v?null:v<start?-1/0:v>stop?1/0:(v=Math.max(start,Math.min(v,stop-step)),start+step*Math.floor(1e-14+(v-start)/step))};return f.start=start,f.stop=bins.stop,f.step=step,this.value=vegaUtil.accessor(f,vegaUtil.accessorFields(field),_.name||"bin_"+vegaUtil.accessorName(field))}}),Collect.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},vegaUtil.inherits(Collect,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.ALL),list=SortedList(vegaDataflow.tupleid,this.value,out.materialize(out.ADD).add),sort=_.sort,mod=pulse.changed()||sort&&(_.modified("sort")||pulse.modified(sort.fields));return out.visit(out.REM,list.remove),this.modified(mod),this.value=out.source=list.data(vegaDataflow.stableCompare(sort),mod),pulse.source&&pulse.source.root&&(this.value.root=pulse.source.root),out}}),vegaUtil.inherits(Compare,vegaDataflow.Operator),CountPattern.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},vegaUtil.inherits(CountPattern,vegaDataflow.Transform,{transform(_,pulse){const process=update=>tuple=>{for(var t,tokens=function(text,tcase,match){switch(tcase){case"upper":text=text.toUpperCase();break;case"lower":text=text.toLowerCase()}return text.match(match)}(get(tuple),_.case,match)||[],i=0,n=tokens.length;i<n;++i)stop.test(t=tokens[i])||update(t)},init=this._parameterCheck(_,pulse),counts=this._counts,match=this._match,stop=this._stop,get=_.field,as=_.as||["text","count"],add=process(t=>counts[t]=1+(counts[t]||0)),rem=process(t=>counts[t]-=1);return init?pulse.visit(pulse.SOURCE,add):(pulse.visit(pulse.ADD,add),pulse.visit(pulse.REM,rem)),this._finish(pulse,as)},_parameterCheck(_,pulse){let init=!1;return!_.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(_.stopwords||"")+"$","i"),init=!0),!_.modified("pattern")&&this._match||(this._match=new RegExp(_.pattern||"[\\w']+","g"),init=!0),(_.modified("field")||pulse.modified(_.field.fields))&&(init=!0),init&&(this._counts={}),init},_finish(pulse,as){const counts=this._counts,tuples=this._tuples||(this._tuples={}),text=as[0],count=as[1],out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);let w,t,c;for(w in counts)t=tuples[w],c=counts[w]||0,!t&&c?(tuples[w]=t=vegaDataflow.ingest({}),t[text]=w,t[count]=c,out.add.push(t)):0===c?(t&&out.rem.push(t),counts[w]=null,tuples[w]=null):t[count]!==c&&(t[count]=c,out.mod.push(t));return out.modifies(as)}}),Cross.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},vegaUtil.inherits(Cross,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE),as=_.as||["a","b"],a=as[0],b=as[1],reset=!this.value||pulse.changed(pulse.ADD_REM)||_.modified("as")||_.modified("filter");let data=this.value;return reset?(data&&(out.rem=data),data=pulse.materialize(pulse.SOURCE).source,out.add=this.value=function(input,a,b,filter){for(var j,left,data=[],t={},n=input.length,i=0;i<n;++i)for(t[a]=left=input[i],j=0;j<n;++j)t[b]=input[j],filter(t)&&(data.push(vegaDataflow.ingest(t)),(t={})[a]=left);return data}(data,a,b,_.filter||vegaUtil.truthy)):out.mod=data,out.source=this.value,out.modifies(as)}});const Distributions={kde:vegaStatistics.randomKDE,mixture:vegaStatistics.randomMixture,normal:vegaStatistics.randomNormal,lognormal:vegaStatistics.randomLogNormal,uniform:vegaStatistics.randomUniform};function Density(params){vegaDataflow.Transform.call(this,null,params)}const distributions=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],mixture={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:distributions},{name:"weights",type:"number",array:!0}]};function fieldNames(fields,as){return fields?fields.map((f,i)=>as[i]||vegaUtil.accessorName(f)):null}function partition(data,groupby,field){const groups=[],get=f=>f(t);let map,i,n,t,k,g;if(null==groupby)groups.push(data.map(field));else for(map={},i=0,n=data.length;i<n;++i)t=data[i],k=groupby.map(get),g=map[k],g||(map[k]=g=[],g.dims=k,groups.push(g)),g.push(field(t));return groups}function DotBin(params){vegaDataflow.Transform.call(this,null,params)}function Expression(params){vegaDataflow.Operator.call(this,null,update$1,params),this.modified(!0)}function update$1(_){const expr=_.expr;return this.value&&!_.modified("expr")?this.value:vegaUtil.accessor(datum=>expr(datum,_),vegaUtil.accessorFields(expr),vegaUtil.accessorName(expr))}function Extent(params){vegaDataflow.Transform.call(this,[void 0,void 0],params)}function Subflow(pulse,parent){vegaDataflow.Operator.call(this,pulse),this.parent=parent,this.count=0}function Facet(params){vegaDataflow.Transform.call(this,{},params),this._keys=vegaUtil.fastmap();const a=this._targets=[];a.active=0,a.forEach=f=>{for(let i=0,n=a.active;i<n;++i)f(a[i],i,a)}}function Field(params){vegaDataflow.Operator.call(this,null,update$2,params)}function update$2(_){return this.value&&!_.modified()?this.value:vegaUtil.isArray(_.name)?vegaUtil.array(_.name).map(f=>vegaUtil.field(f)):vegaUtil.field(_.name,_.as)}function Filter(params){vegaDataflow.Transform.call(this,vegaUtil.fastmap(),params)}function Flatten(params){vegaDataflow.Transform.call(this,[],params)}function Fold(params){vegaDataflow.Transform.call(this,[],params)}function Formula(params){vegaDataflow.Transform.call(this,null,params)}function Generate(params){vegaDataflow.Transform.call(this,[],params)}Density.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:distributions.concat(mixture)},{name:"as",type:"string",array:!0,default:["value","density"]}]},vegaUtil.inherits(Density,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);if(!this.value||pulse.changed()||_.modified()){const dist=function parse(def,data){const func=def.function;vegaUtil.hasOwnProperty(Distributions,func)||vegaUtil.error("Unknown distribution function: "+func);const d=Distributions[func]();for(const name in def)"field"===name?d.data((def.from||data()).map(def[name])):"distributions"===name?d[name](def[name].map(_=>parse(_,data))):"function"==typeof d[name]&&d[name](def[name]);return d}(_.distribution,function(pulse){return()=>pulse.materialize(pulse.SOURCE).source}(pulse)),minsteps=_.steps||_.minsteps||25,maxsteps=_.steps||_.maxsteps||200;let method=_.method||"pdf";"pdf"!==method&&"cdf"!==method&&vegaUtil.error("Invalid density method: "+method),_.extent||dist.data||vegaUtil.error("Missing density extent parameter."),method=dist[method];const as=_.as||["value","density"],domain=_.extent||vegaUtil.extent(dist.data()),values=vegaStatistics.sampleCurve(method,domain,minsteps,maxsteps).map(v=>{const tuple={};return tuple[as[0]]=v[0],tuple[as[1]]=v[1],vegaDataflow.ingest(tuple)});this.value&&(out.rem=this.value),this.value=out.add=out.source=values}return out}}),DotBin.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},vegaUtil.inherits(DotBin,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!_.modified()&&!pulse.changed())return pulse;const source=pulse.materialize(pulse.SOURCE).source,groups=partition(pulse.source,_.groupby,vegaUtil.identity),smooth=_.smooth||!1,field=_.field,step=_.step||((data,field)=>vegaUtil.span(vegaUtil.extent(data,field))/30)(source,field),sort=vegaDataflow.stableCompare((a,b)=>field(a)-field(b)),as=_.as||"bin",n=groups.length;let j,min=1/0,max=-1/0,i=0;for(;i<n;++i){const g=groups[i].sort(sort);j=-1;for(const v of vegaStatistics.dotbin(g,step,smooth,field))v<min&&(min=v),v>max&&(max=v),g[++j][as]=v}return this.value={start:min,stop:max,step:step},pulse.reflow(!0).modifies(as)}}),vegaUtil.inherits(Expression,vegaDataflow.Operator),Extent.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},vegaUtil.inherits(Extent,vegaDataflow.Transform,{transform(_,pulse){const extent=this.value,field=_.field,mod=pulse.changed()||pulse.modified(field.fields)||_.modified("field");let min=extent[0],max=extent[1];if((mod||null==min)&&(min=1/0,max=-1/0),pulse.visit(mod?pulse.SOURCE:pulse.ADD,t=>{const v=vegaUtil.toNumber(field(t));null!=v&&(v<min&&(min=v),v>max&&(max=v))}),!Number.isFinite(min)||!Number.isFinite(max)){let name=vegaUtil.accessorName(field);name&&(name=` for field "${name}"`),pulse.dataflow.warn(`Infinite extent${name}: [${min}, ${max}]`),min=max=void 0}this.value=[min,max]}}),vegaUtil.inherits(Subflow,vegaDataflow.Operator,{connect(target){return this.detachSubflow=target.detachSubflow,this.targets().add(target),target.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(pulse){this.value.init(pulse,pulse.NO_SOURCE)},evaluate(){return this.value}}),vegaUtil.inherits(Facet,vegaDataflow.Transform,{activate(flow){this._targets[this._targets.active++]=flow},subflow(key,flow,pulse,parent){const flows=this.value;let df,p,sf=vegaUtil.hasOwnProperty(flows,key)&&flows[key];return sf?sf.value.stamp<pulse.stamp&&(sf.init(pulse),this.activate(sf)):(p=parent||(p=this._group[key])&&p.tuple,df=pulse.dataflow,sf=new Subflow(pulse.fork(pulse.NO_SOURCE),this),df.add(sf).connect(flow(df,key,p)),flows[key]=sf,this.activate(sf)),sf},clean(){const flows=this.value;for(const key in flows)if(0===flows[key].count){const detach=flows[key].detachSubflow;detach&&detach(),delete flows[key]}},initTargets(){const a=this._targets,n=a.length;for(let i=0;i<n&&null!=a[i];++i)a[i]=null;a.active=0},transform(_,pulse){const df=pulse.dataflow,key=_.key,flow=_.subflow,cache=this._keys,rekey=_.modified("key"),subflow=key=>this.subflow(key,flow,pulse);return this._group=_.group||{},this.initTargets(),pulse.visit(pulse.REM,t=>{const id=vegaDataflow.tupleid(t),k=cache.get(id);void 0!==k&&(cache.delete(id),subflow(k).rem(t))}),pulse.visit(pulse.ADD,t=>{const k=key(t);cache.set(vegaDataflow.tupleid(t),k),subflow(k).add(t)}),rekey||pulse.modified(key.fields)?pulse.visit(pulse.MOD,t=>{const id=vegaDataflow.tupleid(t),k0=cache.get(id),k1=key(t);k0===k1?subflow(k1).mod(t):(cache.set(id,k1),subflow(k0).rem(t),subflow(k1).add(t))}):pulse.changed(pulse.MOD)&&pulse.visit(pulse.MOD,t=>{subflow(cache.get(vegaDataflow.tupleid(t))).mod(t)}),rekey&&pulse.visit(pulse.REFLOW,t=>{const id=vegaDataflow.tupleid(t),k0=cache.get(id),k1=key(t);k0!==k1&&(cache.set(id,k1),subflow(k0).rem(t),subflow(k1).add(t))}),pulse.clean()?df.runAfter(()=>{this.clean(),cache.clean()}):cache.empty>df.cleanThreshold&&df.runAfter(cache.clean),pulse}}),vegaUtil.inherits(Field,vegaDataflow.Operator),Filter.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},vegaUtil.inherits(Filter,vegaDataflow.Transform,{transform(_,pulse){const df=pulse.dataflow,cache=this.value,output=pulse.fork(),add=output.add,rem=output.rem,mod=output.mod,test=_.expr;let isMod=!0;function revisit(t){const id=vegaDataflow.tupleid(t),b=test(t,_),s=cache.get(id);b&&s?(cache.delete(id),add.push(t)):b||s?isMod&&b&&!s&&mod.push(t):(cache.set(id,1),rem.push(t))}return pulse.visit(pulse.REM,t=>{const id=vegaDataflow.tupleid(t);cache.has(id)?cache.delete(id):rem.push(t)}),pulse.visit(pulse.ADD,t=>{test(t,_)?add.push(t):cache.set(vegaDataflow.tupleid(t),1)}),pulse.visit(pulse.MOD,revisit),_.modified()&&(isMod=!1,pulse.visit(pulse.REFLOW,revisit)),cache.empty>df.cleanThreshold&&df.runAfter(cache.clean),output}}),Flatten.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},vegaUtil.inherits(Flatten,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE),fields=_.fields,as=fieldNames(fields,_.as||[]),index=_.index||null,m=as.length;return out.rem=this.value,pulse.visit(pulse.SOURCE,t=>{const arrays=fields.map(f=>f(t)),maxlen=arrays.reduce((l,a)=>Math.max(l,a.length),0);let j,d,v,i=0;for(;i<maxlen;++i){for(d=vegaDataflow.derive(t),j=0;j<m;++j)d[as[j]]=null==(v=arrays[j][i])?null:v;index&&(d[index]=i),out.add.push(d)}}),this.value=out.source=out.add,index&&out.modifies(index),out.modifies(as)}}),Fold.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},vegaUtil.inherits(Fold,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE),fields=_.fields,fnames=fields.map(vegaUtil.accessorName),as=_.as||["key","value"],k=as[0],v=as[1],n=fields.length;return out.rem=this.value,pulse.visit(pulse.SOURCE,t=>{for(let d,i=0;i<n;++i)d=vegaDataflow.derive(t),d[k]=fnames[i],d[v]=fields[i](t),out.add.push(d)}),this.value=out.source=out.add,out.modifies(as)}}),Formula.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},vegaUtil.inherits(Formula,vegaDataflow.Transform,{transform(_,pulse){const func=_.expr,as=_.as,mod=_.modified(),flag=_.initonly?pulse.ADD:mod?pulse.SOURCE:pulse.modified(func.fields)||pulse.modified(as)?pulse.ADD_MOD:pulse.ADD;return mod&&(pulse=pulse.materialize().reflow(!0)),_.initonly||pulse.modifies(as),pulse.visit(flag,t=>t[as]=func(t,_))}}),vegaUtil.inherits(Generate,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.ALL),gen=_.generator;let add,rem,t,data=this.value,num=_.size-data.length;if(num>0){for(add=[];--num>=0;)add.push(t=vegaDataflow.ingest(gen(_))),data.push(t);out.add=out.add.length?out.materialize(out.ADD).add.concat(add):add}else rem=data.slice(0,-num),out.rem=out.rem.length?out.materialize(out.REM).rem.concat(rem):rem,data=data.slice(-num);return out.source=this.value=data,out}});const Methods={value:"value",median:d3Array.median,mean:d3Array.mean,min:d3Array.min,max:d3Array.max},Empty=[];function Impute(params){vegaDataflow.Transform.call(this,[],params)}function JoinAggregate(params){Aggregate.call(this,params)}function KDE(params){vegaDataflow.Transform.call(this,null,params)}function Key(params){vegaDataflow.Operator.call(this,null,update$3,params)}function update$3(_){return this.value&&!_.modified()?this.value:vegaUtil.key(_.fields,_.flat)}function Load(params){vegaDataflow.Transform.call(this,[],params),this._pending=null}function output(op,pulse,data){data.forEach(vegaDataflow.ingest);const out=pulse.fork(pulse.NO_FIELDS&pulse.NO_SOURCE);return out.rem=op.value,op.value=out.source=out.add=data,op._pending=null,out.rem.length&&out.clean(!0),out}function Lookup(params){vegaDataflow.Transform.call(this,{},params)}function MultiExtent(params){vegaDataflow.Operator.call(this,null,update$4,params)}function update$4(_){if(this.value&&!_.modified())return this.value;const ext=_.extents,n=ext.length;let i,e,min=1/0,max=-1/0;for(i=0;i<n;++i)e=ext[i],e[0]<min&&(min=e[0]),e[1]>max&&(max=e[1]);return[min,max]}function MultiValues(params){vegaDataflow.Operator.call(this,null,update$5,params)}function update$5(_){return this.value&&!_.modified()?this.value:_.values.reduce((data,_)=>data.concat(_),[])}function Params(params){vegaDataflow.Transform.call(this,null,params)}function Pivot(params){Aggregate.call(this,params)}function aggregateParams(_,pulse){const key=_.field,value=_.value,op=("count"===_.op?"__count__":_.op)||"sum",fields=vegaUtil.accessorFields(key).concat(vegaUtil.accessorFields(value)),keys=function(key,limit,pulse){const map={},list=[];return pulse.visit(pulse.SOURCE,t=>{const k=key(t);map[k]||(map[k]=1,list.push(k))}),list.sort(vegaUtil.ascending),limit?list.slice(0,limit):list}(key,_.limit||0,pulse);return pulse.changed()&&_.set("__pivot__",null,null,!0),{key:_.key,groupby:_.groupby,ops:keys.map(()=>op),fields:keys.map(k=>function(k,key,value,fields){return vegaUtil.accessor(d=>key(d)===k?value(d):NaN,fields,k+"")}(k,key,value,fields)),as:keys.map(k=>k+""),modified:_.modified.bind(_)}}function PreFacet(params){Facet.call(this,params)}function Project(params){vegaDataflow.Transform.call(this,null,params)}function Proxy(params){vegaDataflow.Transform.call(this,null,params)}function Quantile(params){vegaDataflow.Transform.call(this,null,params)}function Relay(params){vegaDataflow.Transform.call(this,null,params)}function Sample(params){vegaDataflow.Transform.call(this,[],params),this.count=0}function Sequence(params){vegaDataflow.Transform.call(this,null,params)}function Sieve(params){vegaDataflow.Transform.call(this,null,params),this.modified(!0)}function TimeUnit(params){vegaDataflow.Transform.call(this,null,params)}Impute.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},vegaUtil.inherits(Impute,vegaDataflow.Transform,{transform(_,pulse){var group,value,gVals,kVal,g,i,j,l,n,t,out=pulse.fork(pulse.ALL),impute=function(_){var v,m=_.method||Methods.value;if(null!=Methods[m])return m===Methods.value?(v=void 0!==_.value?_.value:0,()=>v):Methods[m];vegaUtil.error("Unrecognized imputation method: "+m)}(_),field=function(_){const f=_.field;return t=>t?f(t):NaN}(_),fName=vegaUtil.accessorName(_.field),kName=vegaUtil.accessorName(_.key),gNames=(_.groupby||[]).map(vegaUtil.accessorName),groups=function(data,groupby,key,keyvals){var gVals,gKey,group,i,j,k,n,t,get=f=>f(t),groups=[],domain=keyvals?keyvals.slice():[],kMap={},gMap={};for(domain.forEach((k,i)=>kMap[k]=i+1),i=0,n=data.length;i<n;++i)k=key(t=data[i]),j=kMap[k]||(kMap[k]=domain.push(k)),(group=gMap[gKey=(gVals=groupby?groupby.map(get):Empty)+""])||(group=gMap[gKey]=[],groups.push(group),group.values=gVals),group[j-1]=t;return groups.domain=domain,groups}(pulse.source,_.groupby,_.key,_.keyvals),curr=[],prev=this.value,m=groups.domain.length;for(g=0,l=groups.length;g<l;++g)for(gVals=(group=groups[g]).values,value=NaN,j=0;j<m;++j)if(null==group[j]){for(kVal=groups.domain[j],t={_impute:!0},i=0,n=gVals.length;i<n;++i)t[gNames[i]]=gVals[i];t[kName]=kVal,t[fName]=Number.isNaN(value)?value=impute(group,field):value,curr.push(vegaDataflow.ingest(t))}return curr.length&&(out.add=out.materialize(out.ADD).add.concat(curr)),prev.length&&(out.rem=out.materialize(out.REM).rem.concat(prev)),this.value=curr,out}}),JoinAggregate.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:ValidAggregateOps},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},vegaUtil.inherits(JoinAggregate,Aggregate,{transform(_,pulse){const aggr=this,mod=_.modified();let cells;return aggr.value&&(mod||pulse.modified(aggr._inputs,!0))?(cells=aggr.value=mod?aggr.init(_):{},pulse.visit(pulse.SOURCE,t=>aggr.add(t))):(cells=aggr.value=aggr.value||this.init(_),pulse.visit(pulse.REM,t=>aggr.rem(t)),pulse.visit(pulse.ADD,t=>aggr.add(t))),aggr.changes(),pulse.visit(pulse.SOURCE,t=>{vegaUtil.extend(t,cells[aggr.cellkey(t)].tuple)}),pulse.reflow(mod).modifies(this._outputs)},changes(){const adds=this._adds,mods=this._mods;let i,n;for(i=0,n=this._alen;i<n;++i)this.celltuple(adds[i]),adds[i]=null;for(i=0,n=this._mlen;i<n;++i)this.celltuple(mods[i]),mods[i]=null;this._alen=this._mlen=0}}),KDE.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},vegaUtil.inherits(KDE,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);if(!this.value||pulse.changed()||_.modified()){const source=pulse.materialize(pulse.SOURCE).source,groups=partition(source,_.groupby,_.field),names=(_.groupby||[]).map(vegaUtil.accessorName),bandwidth=_.bandwidth,method=_.cumulative?"cdf":"pdf",as=_.as||["value","density"],values=[];let domain=_.extent,minsteps=_.steps||_.minsteps||25,maxsteps=_.steps||_.maxsteps||200;"pdf"!==method&&"cdf"!==method&&vegaUtil.error("Invalid density method: "+method),"shared"===_.resolve&&(domain||(domain=vegaUtil.extent(source,_.field)),minsteps=maxsteps=_.steps||maxsteps),groups.forEach(g=>{const density=vegaStatistics.randomKDE(g,bandwidth)[method],scale=_.counts?g.length:1,local=domain||vegaUtil.extent(g);vegaStatistics.sampleCurve(density,local,minsteps,maxsteps).forEach(v=>{const t={};for(let i=0;i<names.length;++i)t[names[i]]=g.dims[i];t[as[0]]=v[0],t[as[1]]=v[1]*scale,values.push(vegaDataflow.ingest(t))})}),this.value&&(out.rem=this.value),this.value=out.add=out.source=values}return out}}),vegaUtil.inherits(Key,vegaDataflow.Operator),vegaUtil.inherits(Load,vegaDataflow.Transform,{transform(_,pulse){const df=pulse.dataflow;return this._pending?output(this,pulse,this._pending):function(_){return _.modified("async")&&!(_.modified("values")||_.modified("url")||_.modified("format"))}(_)?pulse.StopPropagation:_.values?output(this,pulse,df.parse(_.values,_.format)):_.async?{async:df.request(_.url,_.format).then(res=>(this._pending=vegaUtil.array(res.data),df=>df.touch(this)))}:df.request(_.url,_.format).then(res=>output(this,pulse,vegaUtil.array(res.data)))}}),Lookup.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},vegaUtil.inherits(Lookup,vegaDataflow.Transform,{transform(_,pulse){const keys=_.fields,index=_.index,values=_.values,defaultValue=null==_.default?null:_.default,reset=_.modified(),n=keys.length;let set,m,mods,flag=reset?pulse.SOURCE:pulse.ADD,out=pulse,as=_.as;return values?(m=values.length,n>1&&!as&&vegaUtil.error('Multi-field lookup requires explicit "as" parameter.'),as&&as.length!==n*m&&vegaUtil.error('The "as" parameter has too few output field names.'),as=as||values.map(vegaUtil.accessorName),set=function(t){for(var j,v,i=0,k=0;i<n;++i)if(null==(v=index.get(keys[i](t))))for(j=0;j<m;++j,++k)t[as[k]]=defaultValue;else for(j=0;j<m;++j,++k)t[as[k]]=values[j](v)}):(as||vegaUtil.error("Missing output field names."),set=function(t){for(var v,i=0;i<n;++i)v=index.get(keys[i](t)),t[as[i]]=null==v?defaultValue:v}),reset?out=pulse.reflow(!0):(mods=keys.some(k=>pulse.modified(k.fields)),flag|=mods?pulse.MOD:0),pulse.visit(flag,set),out.modifies(as)}}),vegaUtil.inherits(MultiExtent,vegaDataflow.Operator),vegaUtil.inherits(MultiValues,vegaDataflow.Operator),vegaUtil.inherits(Params,vegaDataflow.Transform,{transform(_,pulse){return this.modified(_.modified()),this.value=_,pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)}}),Pivot.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:ValidAggregateOps,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},vegaUtil.inherits(Pivot,Aggregate,{_transform:Aggregate.prototype.transform,transform(_,pulse){return this._transform(aggregateParams(_,pulse),pulse)}}),vegaUtil.inherits(PreFacet,Facet,{transform(_,pulse){const flow=_.subflow,field=_.field,subflow=t=>this.subflow(vegaDataflow.tupleid(t),flow,pulse,t);return(_.modified("field")||field&&pulse.modified(vegaUtil.accessorFields(field)))&&vegaUtil.error("PreFacet does not support field modification."),this.initTargets(),field?(pulse.visit(pulse.MOD,t=>{const sf=subflow(t);field(t).forEach(_=>sf.mod(_))}),pulse.visit(pulse.ADD,t=>{const sf=subflow(t);field(t).forEach(_=>sf.add(vegaDataflow.ingest(_)))}),pulse.visit(pulse.REM,t=>{const sf=subflow(t);field(t).forEach(_=>sf.rem(_))})):(pulse.visit(pulse.MOD,t=>subflow(t).mod(t)),pulse.visit(pulse.ADD,t=>subflow(t).add(t)),pulse.visit(pulse.REM,t=>subflow(t).rem(t))),pulse.clean()&&pulse.runAfter(()=>this.clean()),pulse}}),Project.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},vegaUtil.inherits(Project,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE),fields=_.fields,as=fieldNames(_.fields,_.as||[]),derive=fields?(s,t)=>function(s,t,fields,as){for(let i=0,n=fields.length;i<n;++i)t[as[i]]=fields[i](s);return t}(s,t,fields,as):vegaDataflow.rederive;let lut;return this.value?lut=this.value:(pulse=pulse.addAll(),lut=this.value={}),pulse.visit(pulse.REM,t=>{const id=vegaDataflow.tupleid(t);out.rem.push(lut[id]),lut[id]=null}),pulse.visit(pulse.ADD,t=>{const dt=derive(t,vegaDataflow.ingest({}));lut[vegaDataflow.tupleid(t)]=dt,out.add.push(dt)}),pulse.visit(pulse.MOD,t=>{out.mod.push(derive(t,lut[vegaDataflow.tupleid(t)]))}),out}}),vegaUtil.inherits(Proxy,vegaDataflow.Transform,{transform(_,pulse){return this.value=_.value,_.modified("value")?pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS):pulse.StopPropagation}}),Quantile.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},vegaUtil.inherits(Quantile,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),as=_.as||["prob","value"];if(this.value&&!_.modified()&&!pulse.changed())return out.source=this.value,out;const groups=partition(pulse.materialize(pulse.SOURCE).source,_.groupby,_.field),names=(_.groupby||[]).map(vegaUtil.accessorName),values=[],step=_.step||.01,p=_.probs||d3Array.range(step/2,1-1e-14,step),n=p.length;return groups.forEach(g=>{const q=vegaStatistics.quantiles(g,p);for(let i=0;i<n;++i){const t={};for(let i=0;i<names.length;++i)t[names[i]]=g.dims[i];t[as[0]]=p[i],t[as[1]]=q[i],values.push(vegaDataflow.ingest(t))}}),this.value&&(out.rem=this.value),this.value=out.add=out.source=values,out}}),vegaUtil.inherits(Relay,vegaDataflow.Transform,{transform(_,pulse){let out,lut;return this.value?lut=this.value:(out=pulse=pulse.addAll(),lut=this.value={}),_.derive&&(out=pulse.fork(pulse.NO_SOURCE),pulse.visit(pulse.REM,t=>{const id=vegaDataflow.tupleid(t);out.rem.push(lut[id]),lut[id]=null}),pulse.visit(pulse.ADD,t=>{const dt=vegaDataflow.derive(t);lut[vegaDataflow.tupleid(t)]=dt,out.add.push(dt)}),pulse.visit(pulse.MOD,t=>{const dt=lut[vegaDataflow.tupleid(t)];for(const k in t)dt[k]=t[k],out.modifies(k);out.mod.push(dt)})),out}}),Sample.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},vegaUtil.inherits(Sample,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE),mod=_.modified("size"),num=_.size,map=this.value.reduce((m,t)=>(m[vegaDataflow.tupleid(t)]=1,m),{});let res=this.value,cnt=this.count,cap=0;function update(t){let p,idx;res.length<num?res.push(t):(idx=~~((cnt+1)*vegaStatistics.random()),idx<res.length&&idx>=cap&&(p=res[idx],map[vegaDataflow.tupleid(p)]&&out.rem.push(p),res[idx]=t)),++cnt}if(pulse.rem.length&&(pulse.visit(pulse.REM,t=>{const id=vegaDataflow.tupleid(t);map[id]&&(map[id]=-1,out.rem.push(t)),--cnt}),res=res.filter(t=>-1!==map[vegaDataflow.tupleid(t)])),(pulse.rem.length||mod)&&res.length<num&&pulse.source&&(cap=cnt=res.length,pulse.visit(pulse.SOURCE,t=>{map[vegaDataflow.tupleid(t)]||update(t)}),cap=-1),mod&&res.length>num){const n=res.length-num;for(let i=0;i<n;++i)map[vegaDataflow.tupleid(res[i])]=-1,out.rem.push(res[i]);res=res.slice(n)}return pulse.mod.length&&pulse.visit(pulse.MOD,t=>{map[vegaDataflow.tupleid(t)]&&out.mod.push(t)}),pulse.add.length&&pulse.visit(pulse.ADD,update),(pulse.add.length||cap<0)&&(out.add=res.filter(t=>!map[vegaDataflow.tupleid(t)])),this.count=cnt,this.value=out.source=res,out}}),Sequence.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},vegaUtil.inherits(Sequence,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!_.modified())return;const out=pulse.materialize().fork(pulse.MOD),as=_.as||"data";return out.rem=this.value?pulse.rem.concat(this.value):pulse.rem,this.value=d3Array.range(_.start,_.stop,_.step||1).map(v=>{const t={};return t[as]=v,vegaDataflow.ingest(t)}),out.add=pulse.add.concat(this.value),out}}),vegaUtil.inherits(Sieve,vegaDataflow.Transform,{transform(_,pulse){return this.value=pulse.source,pulse.changed()?pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS):pulse.StopPropagation}});const OUTPUT=["unit0","unit1"];function TupleIndex(params){vegaDataflow.Transform.call(this,vegaUtil.fastmap(),params)}function Values(params){vegaDataflow.Transform.call(this,null,params)}TimeUnit.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:vegaTime.TIME_UNITS,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:OUTPUT}]},vegaUtil.inherits(TimeUnit,vegaDataflow.Transform,{transform(_,pulse){const field=_.field,band=!1!==_.interval,utc="utc"===_.timezone,floor=this._floor(_,pulse),offset=(utc?vegaTime.utcInterval:vegaTime.timeInterval)(floor.unit).offset,as=_.as||OUTPUT,u0=as[0],u1=as[1],step=floor.step;let min=floor.start||1/0,max=floor.stop||-1/0,flag=pulse.ADD;return(_.modified()||pulse.modified(vegaUtil.accessorFields(field)))&&(flag=(pulse=pulse.reflow(!0)).SOURCE,min=1/0,max=-1/0),pulse.visit(flag,t=>{const v=field(t);let a,b;null==v?(t[u0]=null,band&&(t[u1]=null)):(t[u0]=a=b=floor(v),band&&(t[u1]=b=offset(a,step)),a<min&&(min=a),b>max&&(max=b))}),floor.start=min,floor.stop=max,pulse.modifies(band?as:u0)},_floor(_,pulse){const utc="utc"===_.timezone,{units:units,step:step}=_.units?{units:_.units,step:_.step||1}:vegaTime.timeBin({extent:_.extent||vegaUtil.extent(pulse.materialize(pulse.SOURCE).source,_.field),maxbins:_.maxbins}),tunits=vegaTime.timeUnits(units),prev=this.value||{},floor=(utc?vegaTime.utcFloor:vegaTime.timeFloor)(tunits,step);return floor.unit=vegaUtil.peek(tunits),floor.units=tunits,floor.step=step,floor.start=prev.start,floor.stop=prev.stop,this.value=floor}}),vegaUtil.inherits(TupleIndex,vegaDataflow.Transform,{transform(_,pulse){const df=pulse.dataflow,field=_.field,index=this.value,set=t=>index.set(field(t),t);let mod=!0;return _.modified("field")||pulse.modified(field.fields)?(index.clear(),pulse.visit(pulse.SOURCE,set)):pulse.changed()?(pulse.visit(pulse.REM,t=>index.delete(field(t))),pulse.visit(pulse.ADD,set)):mod=!1,this.modified(mod),index.empty>df.cleanThreshold&&df.runAfter(index.clean),pulse.fork()}}),vegaUtil.inherits(Values,vegaDataflow.Transform,{transform(_,pulse){(!this.value||_.modified("field")||_.modified("sort")||pulse.changed()||_.sort&&pulse.modified(_.sort.fields))&&(this.value=(_.sort?pulse.source.slice().sort(vegaDataflow.stableCompare(_.sort)):pulse.source).map(_.field))}});const WindowOps={row_number:function(){return{next:w=>w.index+1}},rank:function(){let rank;return{init:()=>rank=1,next:w=>{const i=w.index,data=w.data;return i&&w.compare(data[i-1],data[i])?rank=i+1:rank}}},dense_rank:function(){let drank;return{init:()=>drank=1,next:w=>{const i=w.index,d=w.data;return i&&w.compare(d[i-1],d[i])?++drank:drank}}},percent_rank:function(){const rank=WindowOps.rank(),next=rank.next;return{init:rank.init,next:w=>(next(w)-1)/(w.data.length-1)}},cume_dist:function(){let cume;return{init:()=>cume=0,next:w=>{const d=w.data,c=w.compare;let i=w.index;if(cume<i){for(;i+1<d.length&&!c(d[i],d[i+1]);)++i;cume=i}return(1+cume)/d.length}}},ntile:function(field,num){(num=+num)>0||vegaUtil.error("ntile num must be greater than zero.");const cume=WindowOps.cume_dist(),next=cume.next;return{init:cume.init,next:w=>Math.ceil(num*next(w))}},lag:function(field,offset){return offset=+offset||1,{next:w=>{const i=w.index-offset;return i>=0?field(w.data[i]):null}}},lead:function(field,offset){return offset=+offset||1,{next:w=>{const i=w.index+offset,d=w.data;return i<d.length?field(d[i]):null}}},first_value:function(field){return{next:w=>field(w.data[w.i0])}},last_value:function(field){return{next:w=>field(w.data[w.i1-1])}},nth_value:function(field,nth){return(nth=+nth)>0||vegaUtil.error("nth_value nth must be greater than zero."),{next:w=>{const i=w.i0+(nth-1);return i<w.i1?field(w.data[i]):null}}},prev_value:function(field){let prev;return{init:()=>prev=null,next:w=>{const v=field(w.data[w.index]);return null!=v?prev=v:prev}}},next_value:function(field){let v,i;return{init:()=>(v=null,i=-1),next:w=>{const d=w.data;return w.index<=i?v:(i=function(field,data,index){for(let n=data.length;index<n;++index)if(null!=field(data[index]))return index;return-1}(field,d,w.index))<0?(i=d.length,v=null):v=field(d[i])}}}},ValidWindowOps=Object.keys(WindowOps);function WindowState(_){const ops=vegaUtil.array(_.ops),fields=vegaUtil.array(_.fields),params=vegaUtil.array(_.params),as=vegaUtil.array(_.as),outputs=this.outputs=[],windows=this.windows=[],inputs={},map={},counts=[],measures=[];let countOnly=!0;function visitInputs(f){vegaUtil.array(vegaUtil.accessorFields(f)).forEach(_=>inputs[_]=1)}visitInputs(_.sort),ops.forEach((op,i)=>{const field=fields[i],mname=vegaUtil.accessorName(field),name=measureName(op,mname,as[i]);if(visitInputs(field),outputs.push(name),vegaUtil.hasOwnProperty(WindowOps,op))windows.push(function(op,field,param,as){const fn=WindowOps[op](field,param);return{init:fn.init||vegaUtil.zero,update:function(w,t){t[as]=fn.next(w)}}}(op,fields[i],params[i],name));else{if(null==field&&"count"!==op&&vegaUtil.error("Null aggregate field specified."),"count"===op)return void counts.push(name);countOnly=!1;let m=map[mname];m||(m=map[mname]=[],m.field=field,measures.push(m)),m.push(createMeasure(op,name))}}),(counts.length||measures.length)&&(this.cell=function(measures,counts,countOnly){measures=measures.map(m=>compileMeasures(m,m.field));const cell={num:0,agg:null,store:!1,count:counts};if(!countOnly)for(var n=measures.length,a=cell.agg=Array(n),i=0;i<n;++i)a[i]=new measures[i](cell);if(cell.store)var store=cell.data=new TupleStore;return cell.add=function(t){if(cell.num+=1,!countOnly){store&&store.add(t);for(let i=0;i<n;++i)a[i].add(a[i].get(t),t)}},cell.rem=function(t){if(cell.num-=1,!countOnly){store&&store.rem(t);for(let i=0;i<n;++i)a[i].rem(a[i].get(t),t)}},cell.set=function(t){let i,n;for(store&&store.values(),i=0,n=counts.length;i<n;++i)t[counts[i]]=cell.num;if(!countOnly)for(i=0,n=a.length;i<n;++i)a[i].set(t)},cell.init=function(){cell.num=0,store&&store.reset();for(let i=0;i<n;++i)a[i].init()},cell}(measures,counts,countOnly)),this.inputs=Object.keys(inputs)}const prototype$1=WindowState.prototype;function Window(params){vegaDataflow.Transform.call(this,{},params),this._mlen=0,this._mods=[]}function processPartition(list,state,cmp,_){const sort=_.sort,range=sort&&!_.ignorePeers,frame=_.frame||[null,0],data=list.data(cmp),n=data.length,b=range?d3Array.bisector(sort):null,w={i0:0,i1:0,p0:0,p1:0,index:0,data:data,compare:sort||vegaUtil.constant(-1)};state.init();for(let i=0;i<n;++i)setWindow(w,frame,i,n),range&&adjustRange(w,b),state.update(w,data[i])}function setWindow(w,f,i,n){w.p0=w.i0,w.p1=w.i1,w.i0=null==f[0]?0:Math.max(0,i-Math.abs(f[0])),w.i1=null==f[1]?n:Math.min(n,i+Math.abs(f[1])+1),w.index=i}function adjustRange(w,bisect){const r0=w.i0,r1=w.i1-1,c=w.compare,d=w.data,n=d.length-1;r0>0&&!c(d[r0],d[r0-1])&&(w.i0=bisect.left(d,d[r0])),r1<n&&!c(d[r1],d[r1+1])&&(w.i1=bisect.right(d,d[r1]))}prototype$1.init=function(){this.windows.forEach(_=>_.init()),this.cell&&this.cell.init()},prototype$1.update=function(w,t){const cell=this.cell,wind=this.windows,data=w.data,m=wind&&wind.length;let j;if(cell){for(j=w.p0;j<w.i0;++j)cell.rem(data[j]);for(j=w.p1;j<w.i1;++j)cell.add(data[j]);cell.set(t)}for(j=0;j<m;++j)wind[j].update(w,t)},Window.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ValidWindowOps.concat(ValidAggregateOps)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},vegaUtil.inherits(Window,vegaDataflow.Transform,{transform(_,pulse){this.stamp=pulse.stamp;const mod=_.modified(),cmp=vegaDataflow.stableCompare(_.sort),key=groupkey(_.groupby),group=t=>this.group(key(t));let state=this.state;state&&!mod||(state=this.state=new WindowState(_)),mod||pulse.modified(state.inputs)?(this.value={},pulse.visit(pulse.SOURCE,t=>group(t).add(t))):(pulse.visit(pulse.REM,t=>group(t).remove(t)),pulse.visit(pulse.ADD,t=>group(t).add(t)));for(let i=0,n=this._mlen;i<n;++i)processPartition(this._mods[i],state,cmp,_);return this._mlen=0,this._mods=[],pulse.reflow(mod).modifies(state.outputs)},group(key){let group=this.value[key];return group||(group=this.value[key]=SortedList(vegaDataflow.tupleid),group.stamp=-1),group.stamp<this.stamp&&(group.stamp=this.stamp,this._mods[this._mlen++]=group),group}}),exports.aggregate=Aggregate,exports.bin=Bin,exports.collect=Collect,exports.compare=Compare,exports.countpattern=CountPattern,exports.cross=Cross,exports.density=Density,exports.dotbin=DotBin,exports.expression=Expression,exports.extent=Extent,exports.facet=Facet,exports.field=Field,exports.filter=Filter,exports.flatten=Flatten,exports.fold=Fold,exports.formula=Formula,exports.generate=Generate,exports.impute=Impute,exports.joinaggregate=JoinAggregate,exports.kde=KDE,exports.key=Key,exports.load=Load,exports.lookup=Lookup,exports.multiextent=MultiExtent,exports.multivalues=MultiValues,exports.params=Params,exports.pivot=Pivot,exports.prefacet=PreFacet,exports.project=Project,exports.proxy=Proxy,exports.quantile=Quantile,exports.relay=Relay,exports.sample=Sample,exports.sequence=Sequence,exports.sieve=Sieve,exports.subflow=Subflow,exports.timeunit=TimeUnit,exports.tupleindex=TupleIndex,exports.values=Values,exports.window=Window,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(40),__webpack_require__(44),__webpack_require__(97),__webpack_require__(49))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaScenegraph,vegaUtil){"use strict";const Top="top",Left="left",Right="right",End="end",Row="row";function Bound(params){vegaDataflow.Transform.call(this,null,params)}function boundItem(item,bound,opt){return bound(item.bounds.clear(),item,opt)}function Identifier(params){vegaDataflow.Transform.call(this,0,params)}function Mark(params){vegaDataflow.Transform.call(this,null,params)}function Overlap(params){vegaDataflow.Transform.call(this,null,params)}vegaUtil.inherits(Bound,vegaDataflow.Transform,{transform(_,pulse){const view=pulse.dataflow,mark=_.mark,type=mark.marktype,entry=vegaScenegraph.Marks[type],bound=entry.bound;let rebound,markBounds=mark.bounds;if(entry.nested)mark.items.length&&view.dirty(mark.items[0]),markBounds=boundItem(mark,bound),mark.items.forEach(item=>{item.bounds.clear().union(markBounds)});else if("group"===type||_.modified())switch(pulse.visit(pulse.MOD,item=>view.dirty(item)),markBounds.clear(),mark.items.forEach(item=>markBounds.union(boundItem(item,bound))),mark.role){case"axis":case"legend":case"title":pulse.reflow()}else rebound=pulse.changed(pulse.REM),pulse.visit(pulse.ADD,item=>{markBounds.union(boundItem(item,bound))}),pulse.visit(pulse.MOD,item=>{rebound=rebound||markBounds.alignsWith(item.bounds),view.dirty(item),markBounds.union(boundItem(item,bound))}),rebound&&(markBounds.clear(),mark.items.forEach(item=>markBounds.union(item.bounds)));return vegaScenegraph.boundClip(mark),pulse.modifies("bounds")}}),Identifier.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},vegaUtil.inherits(Identifier,vegaDataflow.Transform,{transform(_,pulse){const counter=(view=pulse.dataflow)._signals[":vega_identifier:"]||(view._signals[":vega_identifier:"]=view.add(0)),as=_.as;var view;let id=counter.value;return pulse.visit(pulse.ADD,t=>t[as]=t[as]||++id),counter.set(this.value=id),pulse}}),vegaUtil.inherits(Mark,vegaDataflow.Transform,{transform(_,pulse){let mark=this.value;mark||(mark=pulse.dataflow.scenegraph().mark(_.markdef,function(_){const g=_.groups,p=_.parent;return g&&1===g.size?g.get(Object.keys(g.object)[0]):g&&p?g.lookup(p):null}(_),_.index),mark.group.context=_.context,_.context.group||(_.context.group=mark.group),mark.source=this.source,mark.clip=_.clip,mark.interactive=_.interactive,this.value=mark);const Init="group"===mark.marktype?vegaScenegraph.GroupItem:vegaScenegraph.Item;return pulse.visit(pulse.ADD,item=>Init.call(item,mark)),(_.modified("clip")||_.modified("interactive"))&&(mark.clip=_.clip,mark.interactive=!!_.interactive,mark.zdirty=!0,pulse.reflow()),mark.items=pulse.source,pulse}});const methods={parity:items=>items.filter((item,i)=>i%2?item.opacity=0:1),greedy:(items,sep)=>{let a;return items.filter((b,i)=>i&&intersect(a.bounds,b.bounds,sep)?b.opacity=0:(a=b,1))}},intersect=(a,b,sep)=>sep>Math.max(b.x1-a.x2,a.x1-b.x2,b.y1-a.y2,a.y1-b.y2),hasOverlap=(items,pad)=>{for(var b,i=1,n=items.length,a=items[0].bounds;i<n;a=b,++i)if(intersect(a,b=items[i].bounds,pad))return!0},hasBounds=item=>{const b=item.bounds;return b.width()>1&&b.height()>1},reset=source=>(source.forEach(item=>item.opacity=1),source),reflow=(pulse,_)=>pulse.reflow(_.modified()).modifies("opacity");function Render(params){vegaDataflow.Transform.call(this,null,params)}vegaUtil.inherits(Overlap,vegaDataflow.Transform,{transform(_,pulse){const reduce=methods[_.method]||methods.parity,sep=_.separation||0;let items,test,source=pulse.materialize(pulse.SOURCE).source;if(!source||!source.length)return;if(!_.method)return _.modified("method")&&(reset(source),pulse=reflow(pulse,_)),pulse;if(source=source.filter(hasBounds),!source.length)return;if(_.sort&&(source=source.slice().sort(_.sort)),items=reset(source),pulse=reflow(pulse,_),items.length>=3&&hasOverlap(items,sep)){do{items=reduce(items,sep)}while(items.length>=3&&hasOverlap(items,sep));items.length<3&&!vegaUtil.peek(source).opacity&&(items.length>1&&(vegaUtil.peek(items).opacity=0),vegaUtil.peek(source).opacity=1)}var scale,orient,tolerance,range,b;_.boundScale&&_.boundTolerance>=0&&(scale=_.boundScale,orient=_.boundOrient,tolerance=+_.boundTolerance,range=scale.range(),b=new vegaScenegraph.Bounds,orient===Top||"bottom"===orient?b.set(range[0],-1/0,range[1],1/0):b.set(-1/0,range[0],1/0,range[1]),b.expand(tolerance||1),test=item=>b.encloses(item.bounds),source.forEach(item=>{test(item)||(item.opacity=0)}));const bounds=items[0].mark.bounds.clear();return source.forEach(item=>{item.opacity&&bounds.union(item.bounds)}),pulse}}),vegaUtil.inherits(Render,vegaDataflow.Transform,{transform(_,pulse){const view=pulse.dataflow;if(pulse.visit(pulse.ALL,item=>view.dirty(item)),pulse.fields&&pulse.fields.zindex){const item=pulse.source&&pulse.source[0];item&&(item.mark.zdirty=!0)}}});const tempBounds=new vegaScenegraph.Bounds;function set(item,property,value){return item[property]===value?0:(item[property]=value,1)}function isYAxis(mark){var orient=mark.items[0].orient;return orient===Left||orient===Right}function axisLayout(view,axis,width,height){var i,s,item=axis.items[0],datum=item.datum,delta=null!=item.translate?item.translate:.5,orient=item.orient,indices=function(datum){let index=+datum.grid;return[datum.ticks?index++:-1,datum.labels?index++:-1,index+ +datum.domain]}(datum),range=item.range,offset=item.offset,position=item.position,minExtent=item.minExtent,maxExtent=item.maxExtent,title=datum.title&&item.items[indices[2]].items[0],titlePadding=item.titlePadding,bounds=item.bounds,dl=title&&vegaScenegraph.multiLineOffset(title),x=0,y=0;switch(tempBounds.clear().union(bounds),bounds.clear(),(i=indices[0])>-1&&bounds.union(item.items[i].bounds),(i=indices[1])>-1&&bounds.union(item.items[i].bounds),orient){case Top:x=position||0,y=-offset,s=Math.max(minExtent,Math.min(maxExtent,-bounds.y1)),bounds.add(0,-s).add(range,0),title&&axisTitleLayout(view,title,s,titlePadding,dl,0,-1,bounds);break;case Left:x=-offset,y=position||0,s=Math.max(minExtent,Math.min(maxExtent,-bounds.x1)),bounds.add(-s,0).add(0,range),title&&axisTitleLayout(view,title,s,titlePadding,dl,1,-1,bounds);break;case Right:x=width+offset,y=position||0,s=Math.max(minExtent,Math.min(maxExtent,bounds.x2)),bounds.add(0,0).add(s,range),title&&axisTitleLayout(view,title,s,titlePadding,dl,1,1,bounds);break;case"bottom":x=position||0,y=height+offset,s=Math.max(minExtent,Math.min(maxExtent,bounds.y2)),bounds.add(0,0).add(range,s),title&&axisTitleLayout(view,title,s,titlePadding,0,0,1,bounds);break;default:x=item.x,y=item.y}return vegaScenegraph.boundStroke(bounds.translate(x,y),item),set(item,"x",x+delta)|set(item,"y",y+delta)&&(item.bounds=tempBounds,view.dirty(item),item.bounds=bounds,view.dirty(item)),item.mark.bounds.clear().union(bounds)}function axisTitleLayout(view,title,offset,pad,dl,isYAxis,sign,bounds){const b=title.bounds;if(title.auto){const v=sign*(offset+dl+pad);let dx=0,dy=0;view.dirty(title),isYAxis?dx=(title.x||0)-(title.x=v):dy=(title.y||0)-(title.y=v),title.mark.bounds.clear().union(b.translate(-dx,-dy)),view.dirty(title)}bounds.union(b)}const min=(a,b)=>Math.floor(Math.min(a,b)),max=(a,b)=>Math.ceil(Math.max(a,b));function bboxFlush(item){return(new vegaScenegraph.Bounds).set(0,0,item.width||0,item.height||0)}function bboxFull(item){const b=item.bounds.clone();return b.empty()?b.set(0,0,0,0):b.translate(-(item.x||0),-(item.y||0))}function get(opt,key,d){const v=vegaUtil.isObject(opt)?opt[key]:opt;return null!=v?v:void 0!==d?d:0}function offsetValue(v){return v<0?Math.ceil(-v):0}function gridLayout(view,groups,opt){var m,i,c,r,b,g,px,py,x,y,offset,dirty=!opt.nodirty,bbox="flush"===opt.bounds?bboxFlush:bboxFull,bounds=tempBounds.set(0,0,0,0),alignCol=get(opt.align,"column"),alignRow=get(opt.align,Row),padCol=get(opt.padding,"column"),padRow=get(opt.padding,Row),ncols=opt.columns||groups.length,nrows=ncols<=0?1:Math.ceil(groups.length/ncols),n=groups.length,xOffset=Array(n),xExtent=Array(ncols),xMax=0,yOffset=Array(n),yExtent=Array(nrows),yMax=0,dx=Array(n),dy=Array(n),boxes=Array(n);for(i=0;i<ncols;++i)xExtent[i]=0;for(i=0;i<nrows;++i)yExtent[i]=0;for(i=0;i<n;++i)g=groups[i],b=boxes[i]=bbox(g),g.x=g.x||0,dx[i]=0,g.y=g.y||0,dy[i]=0,c=i%ncols,r=~~(i/ncols),xMax=Math.max(xMax,px=Math.ceil(b.x2)),yMax=Math.max(yMax,py=Math.ceil(b.y2)),xExtent[c]=Math.max(xExtent[c],px),yExtent[r]=Math.max(yExtent[r],py),xOffset[i]=padCol+offsetValue(b.x1),yOffset[i]=padRow+offsetValue(b.y1),dirty&&view.dirty(groups[i]);for(i=0;i<n;++i)i%ncols==0&&(xOffset[i]=0),i<ncols&&(yOffset[i]=0);if("each"===alignCol)for(c=1;c<ncols;++c){for(offset=0,i=c;i<n;i+=ncols)offset<xOffset[i]&&(offset=xOffset[i]);for(i=c;i<n;i+=ncols)xOffset[i]=offset+xExtent[c-1]}else if("all"===alignCol){for(offset=0,i=0;i<n;++i)i%ncols&&offset<xOffset[i]&&(offset=xOffset[i]);for(i=0;i<n;++i)i%ncols&&(xOffset[i]=offset+xMax)}else for(alignCol=!1,c=1;c<ncols;++c)for(i=c;i<n;i+=ncols)xOffset[i]+=xExtent[c-1];if("each"===alignRow)for(r=1;r<nrows;++r){for(offset=0,m=(i=r*ncols)+ncols;i<m;++i)offset<yOffset[i]&&(offset=yOffset[i]);for(i=r*ncols;i<m;++i)yOffset[i]=offset+yExtent[r-1]}else if("all"===alignRow){for(offset=0,i=ncols;i<n;++i)offset<yOffset[i]&&(offset=yOffset[i]);for(i=ncols;i<n;++i)yOffset[i]=offset+yMax}else for(alignRow=!1,r=1;r<nrows;++r)for(m=(i=r*ncols)+ncols;i<m;++i)yOffset[i]+=yExtent[r-1];for(x=0,i=0;i<n;++i)x=xOffset[i]+(i%ncols?x:0),dx[i]+=x-groups[i].x;for(c=0;c<ncols;++c)for(y=0,i=c;i<n;i+=ncols)y+=yOffset[i],dy[i]+=y-groups[i].y;if(alignCol&&get(opt.center,"column")&&nrows>1)for(i=0;i<n;++i)(x=(b="all"===alignCol?xMax:xExtent[i%ncols])-boxes[i].x2-groups[i].x-dx[i])>0&&(dx[i]+=x/2);if(alignRow&&get(opt.center,Row)&&1!==ncols)for(i=0;i<n;++i)(y=(b="all"===alignRow?yMax:yExtent[~~(i/ncols)])-boxes[i].y2-groups[i].y-dy[i])>0&&(dy[i]+=y/2);for(i=0;i<n;++i)bounds.union(boxes[i].translate(dx[i],dy[i]));switch(x=get(opt.anchor,"x"),y=get(opt.anchor,"y"),get(opt.anchor,"column")){case End:x-=bounds.width();break;case"middle":x-=bounds.width()/2}switch(get(opt.anchor,Row)){case End:y-=bounds.height();break;case"middle":y-=bounds.height()/2}for(x=Math.round(x),y=Math.round(y),bounds.clear(),i=0;i<n;++i)groups[i].mark.bounds.clear();for(i=0;i<n;++i)(g=groups[i]).x+=dx[i]+=x,g.y+=dy[i]+=y,bounds.union(g.mark.bounds.union(g.bounds.translate(dx[i],dy[i]))),dirty&&view.dirty(g);return bounds}function boundFlush(item,field){return"x1"===field?item.x||0:"y1"===field?item.y||0:"x2"===field?(item.x||0)+(item.width||0):"y2"===field?(item.y||0)+(item.height||0):void 0}function boundFull(item,field){return item.bounds[field]}function layoutHeaders(view,headers,groups,ncols,limit,offset,agg,isX,bound,bf,start,stride,back,band){var i,j,k,m,b,h,g,x,y,n=groups.length,init=0,edge=0;if(!n)return init;for(i=start;i<n;i+=stride)groups[i]&&(init=agg(init,bound(groups[i],bf)));if(!headers.length)return init;for(headers.length>limit&&(view.warn("Grid headers exceed limit: "+limit),headers=headers.slice(0,limit)),init+=offset,j=0,m=headers.length;j<m;++j)view.dirty(headers[j]),headers[j].mark.bounds.clear();for(i=start,j=0,m=headers.length;j<m;++j,i+=stride){for(b=(h=headers[j]).mark.bounds,k=i;k>=0&&null==(g=groups[k]);k-=back);isX?(x=null==band?g.x:Math.round(g.bounds.x1+band*g.bounds.width()),y=init):(x=init,y=null==band?g.y:Math.round(g.bounds.y1+band*g.bounds.height())),b.union(h.bounds.translate(x-(h.x||0),y-(h.y||0))),h.x=x,h.y=y,view.dirty(h),edge=agg(edge,b[bf])}return edge}function layoutTitle(view,g,offset,isX,bounds,band){if(g){view.dirty(g);var x=offset,y=offset;isX?x=Math.round(bounds.x1+band*bounds.width()):y=Math.round(bounds.y1+band*bounds.height()),g.bounds.translate(x-(g.x||0),y-(g.y||0)),g.mark.bounds.clear().union(g.bounds),g.x=x,g.y=y,view.dirty(g)}}function legendParams(g,orient,config,xb,yb,w,h){const _=function(config,orient){const opt=config[orient]||{};return(key,d)=>null!=opt[key]?opt[key]:null!=config[key]?config[key]:d}(config,orient),offset=function(legends,value){let max=-1/0;return legends.forEach(item=>{null!=item.offset&&(max=Math.max(max,item.offset))}),max>-1/0?max:value}(g,_("offset",0)),anchor=_("anchor","start"),mult=anchor===End?1:"middle"===anchor?.5:0,p={align:"each",bounds:_("bounds","flush"),columns:"vertical"===_("direction")?1:g.length,padding:_("margin",8),center:_("center"),nodirty:!0};switch(orient){case Left:p.anchor={x:Math.floor(xb.x1)-offset,column:End,y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case Right:p.anchor={x:Math.ceil(xb.x2)+offset,y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case Top:p.anchor={y:Math.floor(yb.y1)-offset,row:End,x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case"bottom":p.anchor={y:Math.ceil(yb.y2)+offset,x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case"top-left":p.anchor={x:offset,y:offset};break;case"top-right":p.anchor={x:w-offset,y:offset,column:End};break;case"bottom-left":p.anchor={x:offset,y:h-offset,row:End};break;case"bottom-right":p.anchor={x:w-offset,y:h-offset,column:End,row:End}}return p}function legendLayout(view,legend){var w,h,item=legend.items[0],datum=item.datum,orient=item.orient,bounds=item.bounds,x=item.x,y=item.y;return item._bounds?item._bounds.clear().union(bounds):item._bounds=bounds.clone(),bounds.clear(),function(view,item,entry){var pad=item.padding,ex=pad-entry.x,ey=pad-entry.y;if(item.datum.title){var title=item.items[1].items[0],anchor=title.anchor,tpad=item.titlePadding||0,tx=pad-title.x,ty=pad-title.y;switch(title.orient){case Left:ex+=Math.ceil(title.bounds.width())+tpad;break;case Right:case"bottom":break;default:ey+=title.bounds.height()+tpad}switch((ex||ey)&&translate(view,entry,ex,ey),title.orient){case Left:ty+=legendTitleOffset(item,entry,title,anchor,1,1);break;case Right:tx+=legendTitleOffset(item,entry,title,End,0,0)+tpad,ty+=legendTitleOffset(item,entry,title,anchor,1,1);break;case"bottom":tx+=legendTitleOffset(item,entry,title,anchor,0,0),ty+=legendTitleOffset(item,entry,title,End,-1,0,1)+tpad;break;default:tx+=legendTitleOffset(item,entry,title,anchor,0,0)}(tx||ty)&&translate(view,title,tx,ty),(tx=Math.round(title.bounds.x1-pad))<0&&(translate(view,entry,-tx,0),translate(view,title,-tx,0))}else(ex||ey)&&translate(view,entry,ex,ey)}(view,item,item.items[0].items[0]),bounds=function(item,b){return item.items.forEach(_=>b.union(_.bounds)),b.x1=item.padding,b.y1=item.padding,b}(item,bounds),w=2*item.padding,h=2*item.padding,bounds.empty()||(w=Math.ceil(bounds.width()+w),h=Math.ceil(bounds.height()+h)),"symbol"===datum.type&&function(entries){const widths=entries.reduce((w,g)=>(w[g.column]=Math.max(g.bounds.x2-g.x,w[g.column]||0),w),{});entries.forEach(g=>{g.width=widths[g.column],g.height=g.bounds.y2-g.y})}(item.items[0].items[0].items[0].items),"none"!==orient&&(item.x=x=0,item.y=y=0),item.width=w,item.height=h,vegaScenegraph.boundStroke(bounds.set(x,y,x+w,y+h),item),item.mark.bounds.clear().union(bounds),item}function legendTitleOffset(item,entry,title,anchor,y,lr,noBar){const grad="symbol"!==item.datum.type,vgrad=title.datum.vgrad,s=(!grad||!lr&&vgrad||noBar?entry:entry.items[0]).bounds[y?"y2":"x2"]-item.padding,u=vgrad&&lr?s:0,v=vgrad&&lr?0:s,o=y<=0?0:vegaScenegraph.multiLineOffset(title);return Math.round("start"===anchor?u:anchor===End?v-o:.5*(s-o))}function translate(view,item,dx,dy){item.x+=dx,item.y+=dy,item.bounds.translate(dx,dy),item.mark.bounds.translate(dx,dy),view.dirty(item)}function ViewLayout(params){vegaDataflow.Transform.call(this,null,params)}function layoutGroup(view,group,_){var title,mark,orient,i,n,items=group.items,width=Math.max(0,group.width||0),height=Math.max(0,group.height||0),viewBounds=(new vegaScenegraph.Bounds).set(0,0,width,height),xBounds=viewBounds.clone(),yBounds=viewBounds.clone(),legends=[];for(i=0,n=items.length;i<n;++i)switch((mark=items[i]).role){case"axis":(isYAxis(mark)?xBounds:yBounds).union(axisLayout(view,mark,width,height));break;case"title":title=mark;break;case"legend":legends.push(legendLayout(view,mark));break;case"frame":case"scope":case"row-header":case"row-footer":case"row-title":case"column-header":case"column-footer":case"column-title":xBounds.union(mark.bounds),yBounds.union(mark.bounds);break;default:viewBounds.union(mark.bounds)}if(legends.length){const l={};legends.forEach(item=>{"none"!==(orient=item.orient||Right)&&(l[orient]||(l[orient]=[])).push(item)});for(const orient in l){const g=l[orient];gridLayout(view,g,legendParams(g,orient,_.legends,xBounds,yBounds,width,height))}legends.forEach(item=>{const b=item.bounds;if(b.equals(item._bounds)||(item.bounds=item._bounds,view.dirty(item),item.bounds=b,view.dirty(item)),_.autosize&&"fit"===_.autosize.type)switch(item.orient){case Left:case Right:viewBounds.add(b.x1,0).add(b.x2,0);break;case Top:case"bottom":viewBounds.add(0,b.y1).add(0,b.y2)}else viewBounds.union(b)})}viewBounds.union(xBounds).union(yBounds),title&&viewBounds.union(function(view,mark,width,height,viewBounds){var pos,group=mark.items[0],frame=group.frame,orient=group.orient,anchor=group.anchor,offset=group.offset,padding=group.padding,title=group.items[0].items[0],subtitle=group.items[1]&&group.items[1].items[0],end=orient===Left||orient===Right?height:width,start=0,x=0,y=0,sx=0,sy=0;if("group"!==frame?orient===Left?(start=viewBounds.y2,end=viewBounds.y1):orient===Right?(start=viewBounds.y1,end=viewBounds.y2):(start=viewBounds.x1,end=viewBounds.x2):orient===Left&&(start=height,end=0),pos="start"===anchor?start:anchor===End?end:(start+end)/2,subtitle&&subtitle.text){switch(orient){case Top:case"bottom":sy=title.bounds.height()+padding;break;case Left:sx=title.bounds.width()+padding;break;case Right:sx=-title.bounds.width()-padding}tempBounds.clear().union(subtitle.bounds),tempBounds.translate(sx-(subtitle.x||0),sy-(subtitle.y||0)),set(subtitle,"x",sx)|set(subtitle,"y",sy)&&(view.dirty(subtitle),subtitle.bounds.clear().union(tempBounds),subtitle.mark.bounds.clear().union(tempBounds),view.dirty(subtitle)),tempBounds.clear().union(subtitle.bounds)}else tempBounds.clear();switch(tempBounds.union(title.bounds),orient){case Top:x=pos,y=viewBounds.y1-tempBounds.height()-offset;break;case Left:x=viewBounds.x1-tempBounds.width()-offset,y=pos;break;case Right:x=viewBounds.x2+tempBounds.width()+offset,y=pos;break;case"bottom":x=pos,y=viewBounds.y2+offset;break;default:x=group.x,y=group.y}return set(group,"x",x)|set(group,"y",y)&&(tempBounds.translate(x,y),view.dirty(group),group.bounds.clear().union(tempBounds),mark.bounds.clear().union(tempBounds),view.dirty(group)),group.bounds}(view,title,width,height,viewBounds)),group.clip&&viewBounds.set(0,0,group.width||0,group.height||0),function(view,group,viewBounds,_){const auto=_.autosize||{},type=auto.type;if(view._autosize<1||!type)return;let viewWidth=view._width,viewHeight=view._height,width=Math.max(0,group.width||0),left=Math.max(0,Math.ceil(-viewBounds.x1)),height=Math.max(0,group.height||0),top=Math.max(0,Math.ceil(-viewBounds.y1));const right=Math.max(0,Math.ceil(viewBounds.x2-width)),bottom=Math.max(0,Math.ceil(viewBounds.y2-height));if("padding"===auto.contains){const padding=view.padding();viewWidth-=padding.left+padding.right,viewHeight-=padding.top+padding.bottom}"none"===type?(left=0,top=0,width=viewWidth,height=viewHeight):"fit"===type?(width=Math.max(0,viewWidth-left-right),height=Math.max(0,viewHeight-top-bottom)):"fit-x"===type?(width=Math.max(0,viewWidth-left-right),viewHeight=height+top+bottom):"fit-y"===type?(viewWidth=width+left+right,height=Math.max(0,viewHeight-top-bottom)):"pad"===type&&(viewWidth=width+left+right,viewHeight=height+top+bottom),view._resizeView(viewWidth,viewHeight,width,height,[left,top],auto.resize)}(view,group,viewBounds,_)}vegaUtil.inherits(ViewLayout,vegaDataflow.Transform,{transform(_,pulse){const view=pulse.dataflow;return _.mark.items.forEach(group=>{_.layout&&function(view,group,opt){var x,y,x2,y2,anchor,band,offset,views=function(group){var mark,items,groups=group.items,n=groups.length,i=0;const views={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(items=(mark=groups[i]).items,"group"===mark.marktype)switch(mark.role){case"axis":case"legend":case"title":break;case"row-header":views.rowheaders.push(...items);break;case"row-footer":views.rowfooters.push(...items);break;case"column-header":views.colheaders.push(...items);break;case"column-footer":views.colfooters.push(...items);break;case"row-title":views.rowtitle=items[0];break;case"column-title":views.coltitle=items[0];break;default:views.marks.push(...items)}return views}(group),groups=views.marks,bbox="flush"===opt.bounds?boundFlush:boundFull,off=opt.offset,ncols=opt.columns||groups.length,nrows=ncols<=0?1:Math.ceil(groups.length/ncols),cells=nrows*ncols;const bounds=gridLayout(view,groups,opt);bounds.empty()&&bounds.set(0,0,0,0),views.rowheaders&&(band=get(opt.headerBand,Row,null),x=layoutHeaders(view,views.rowheaders,groups,0,nrows,-get(off,"rowHeader"),min,0,bbox,"x1",0,ncols,1,band)),views.colheaders&&(band=get(opt.headerBand,"column",null),y=layoutHeaders(view,views.colheaders,groups,0,ncols,-get(off,"columnHeader"),min,1,bbox,"y1",0,1,ncols,band)),views.rowfooters&&(band=get(opt.footerBand,Row,null),x2=layoutHeaders(view,views.rowfooters,groups,0,nrows,get(off,"rowFooter"),max,0,bbox,"x2",ncols-1,ncols,1,band)),views.colfooters&&(band=get(opt.footerBand,"column",null),y2=layoutHeaders(view,views.colfooters,groups,0,ncols,get(off,"columnFooter"),max,1,bbox,"y2",cells-ncols,1,ncols,band)),views.rowtitle&&(anchor=get(opt.titleAnchor,Row),offset=get(off,"rowTitle"),offset=anchor===End?x2+offset:x-offset,band=get(opt.titleBand,Row,.5),layoutTitle(view,views.rowtitle,offset,0,bounds,band)),views.coltitle&&(anchor=get(opt.titleAnchor,"column"),offset=get(off,"columnTitle"),offset=anchor===End?y2+offset:y-offset,band=get(opt.titleBand,"column",.5),layoutTitle(view,views.coltitle,offset,1,bounds,band))}(view,group,_.layout),layoutGroup(view,group,_)}),(group=_.mark.group)&&"legend-entry"!==group.mark.role?pulse.reflow():pulse;var group}}),exports.bound=Bound,exports.identifier=Identifier,exports.mark=Mark,exports.overlap=Overlap,exports.render=Render,exports.viewlayout=ViewLayout,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(50),__webpack_require__(37))},function(module,exports,__webpack_require__){!function(exports,d3Path){"use strict";function constant(x){return function(){return x}}var abs=Math.abs,atan2=Math.atan2,cos=Math.cos,max=Math.max,min=Math.min,sin=Math.sin,sqrt=Math.sqrt,pi=Math.PI,halfPi=pi/2,tau=2*pi;function acos(x){return x>1?0:x<-1?pi:Math.acos(x)}function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=y32*x10-x32*y10;if(!(t*t<1e-12))return[x0+(t=(x32*(y0-y2)-y32*(x0-x2))/t)*x10,y0+t*y10]}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}var slice=Array.prototype.slice;function array(x){return"object"==typeof x&&"length"in x?x:Array.from(x)}function Linear(context){this._context=context}function curveLinear(context){return new Linear(context)}function x(p){return p[0]}function y(p){return p[1]}function line(x$1,y$1){var defined=constant(!0),context=null,curve=curveLinear,output=null;function line(data){var i,d,buffer,n=(data=array(data)).length,defined0=!1;for(null==context&&(output=curve(buffer=d3Path.path())),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&((defined0=!defined0)?output.lineStart():output.lineEnd()),defined0&&output.point(+x$1(d,i,data),+y$1(d,i,data));if(buffer)return output=null,buffer+""||null}return x$1="function"==typeof x$1?x$1:void 0===x$1?x:constant(x$1),y$1="function"==typeof y$1?y$1:void 0===y$1?y:constant(y$1),line.x=function(_){return arguments.length?(x$1="function"==typeof _?_:constant(+_),line):x$1},line.y=function(_){return arguments.length?(y$1="function"==typeof _?_:constant(+_),line):y$1},line.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant(!!_),line):defined},line.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),line):curve},line.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),line):context},line}function area(x0,y0,y1){var x1=null,defined=constant(!0),context=null,curve=curveLinear,output=null;function area(data){var i,j,k,d,buffer,n=(data=array(data)).length,defined0=!1,x0z=new Array(n),y0z=new Array(n);for(null==context&&(output=curve(buffer=d3Path.path())),i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0)if(defined0=!defined0)j=i,output.areaStart(),output.lineStart();else{for(output.lineEnd(),output.lineStart(),k=i-1;k>=j;--k)output.point(x0z[k],y0z[k]);output.lineEnd(),output.areaEnd()}defined0&&(x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data),output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i]))}if(buffer)return output=null,buffer+""||null}function arealine(){return line().defined(defined).curve(curve).context(context)}return x0="function"==typeof x0?x0:void 0===x0?x:constant(+x0),y0="function"==typeof y0?y0:constant(void 0===y0?0:+y0),y1="function"==typeof y1?y1:void 0===y1?y:constant(+y1),area.x=function(_){return arguments.length?(x0="function"==typeof _?_:constant(+_),x1=null,area):x0},area.x0=function(_){return arguments.length?(x0="function"==typeof _?_:constant(+_),area):x0},area.x1=function(_){return arguments.length?(x1=null==_?null:"function"==typeof _?_:constant(+_),area):x1},area.y=function(_){return arguments.length?(y0="function"==typeof _?_:constant(+_),y1=null,area):y0},area.y0=function(_){return arguments.length?(y0="function"==typeof _?_:constant(+_),area):y0},area.y1=function(_){return arguments.length?(y1=null==_?null:"function"==typeof _?_:constant(+_),area):y1},area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)},area.lineY1=function(){return arealine().x(x0).y(y1)},area.lineX1=function(){return arealine().x(x1).y(y0)},area.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant(!!_),area):defined},area.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),area):curve},area.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),area):context},area}function descending(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function identity(d){return d}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y)}}};var curveRadialLinear=curveRadial(curveLinear);function Radial(curve){this._curve=curve}function curveRadial(curve){function radial(context){return new Radial(curve(context))}return radial._curve=curve,radial}function lineRadial(l){var c=l.curve;return l.angle=l.x,delete l.x,l.radius=l.y,delete l.y,l.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve},l}function lineRadial$1(){return lineRadial(line().curve(curveRadialLinear))}function areaRadial(){var a=area().curve(curveRadialLinear),c=a.curve,x0=a.lineX0,x1=a.lineX1,y0=a.lineY0,y1=a.lineY1;return a.angle=a.x,delete a.x,a.startAngle=a.x0,delete a.x0,a.endAngle=a.x1,delete a.x1,a.radius=a.y,delete a.y,a.innerRadius=a.y0,delete a.y0,a.outerRadius=a.y1,delete a.y1,a.lineStartAngle=function(){return lineRadial(x0())},delete a.lineX0,a.lineEndAngle=function(){return lineRadial(x1())},delete a.lineX1,a.lineInnerRadius=function(){return lineRadial(y0())},delete a.lineY0,a.lineOuterRadius=function(){return lineRadial(y1())},delete a.lineY1,a.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve},a}function pointRadial(x,y){return[(y=+y)*Math.cos(x-=Math.PI/2),y*Math.sin(x)]}function linkSource(d){return d.source}function linkTarget(d){return d.target}function link(curve){var source=linkSource,target=linkTarget,x$1=x,y$1=y,context=null;function link(){var buffer,argv=slice.call(arguments),s=source.apply(this,argv),t=target.apply(this,argv);if(context||(context=buffer=d3Path.path()),curve(context,+x$1.apply(this,(argv[0]=s,argv)),+y$1.apply(this,argv),+x$1.apply(this,(argv[0]=t,argv)),+y$1.apply(this,argv)),buffer)return context=null,buffer+""||null}return link.source=function(_){return arguments.length?(source=_,link):source},link.target=function(_){return arguments.length?(target=_,link):target},link.x=function(_){return arguments.length?(x$1="function"==typeof _?_:constant(+_),link):x$1},link.y=function(_){return arguments.length?(y$1="function"==typeof _?_:constant(+_),link):y$1},link.context=function(_){return arguments.length?(context=null==_?null:_,link):context},link}function curveHorizontal(context,x0,y0,x1,y1){context.moveTo(x0,y0),context.bezierCurveTo(x0=(x0+x1)/2,y0,x0,y1,x1,y1)}function curveVertical(context,x0,y0,x1,y1){context.moveTo(x0,y0),context.bezierCurveTo(x0,y0=(y0+y1)/2,x1,y0,x1,y1)}function curveRadial$1(context,x0,y0,x1,y1){var p0=pointRadial(x0,y0),p1=pointRadial(x0,y0=(y0+y1)/2),p2=pointRadial(x1,y0),p3=pointRadial(x1,y1);context.moveTo(p0[0],p0[1]),context.bezierCurveTo(p1[0],p1[1],p2[0],p2[1],p3[0],p3[1])}Radial.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};var circle={draw:function(context,size){var r=Math.sqrt(size/pi);context.moveTo(r,0),context.arc(0,0,r,0,tau)}},cross={draw:function(context,size){var r=Math.sqrt(size/5)/2;context.moveTo(-3*r,-r),context.lineTo(-r,-r),context.lineTo(-r,-3*r),context.lineTo(r,-3*r),context.lineTo(r,-r),context.lineTo(3*r,-r),context.lineTo(3*r,r),context.lineTo(r,r),context.lineTo(r,3*r),context.lineTo(-r,3*r),context.lineTo(-r,r),context.lineTo(-3*r,r),context.closePath()}},tan30=Math.sqrt(1/3),tan30_2=2*tan30,diamond={draw:function(context,size){var y=Math.sqrt(size/tan30_2),x=y*tan30;context.moveTo(0,-y),context.lineTo(x,0),context.lineTo(0,y),context.lineTo(-x,0),context.closePath()}},kr=Math.sin(pi/10)/Math.sin(7*pi/10),kx=Math.sin(tau/10)*kr,ky=-Math.cos(tau/10)*kr,star={draw:function(context,size){var r=Math.sqrt(.8908130915292852*size),x=kx*r,y=ky*r;context.moveTo(0,-r),context.lineTo(x,y);for(var i=1;i<5;++i){var a=tau*i/5,c=Math.cos(a),s=Math.sin(a);context.lineTo(s*r,-c*r),context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}},square={draw:function(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}},sqrt3=Math.sqrt(3),triangle={draw:function(context,size){var y=-Math.sqrt(size/(3*sqrt3));context.moveTo(0,2*y),context.lineTo(-sqrt3*y,-y),context.lineTo(sqrt3*y,-y),context.closePath()}},c=-.5,s=Math.sqrt(3)/2,k=1/Math.sqrt(12),a=3*(k/2+1),wye={draw:function(context,size){var r=Math.sqrt(size/a),x0=r/2,y0=r*k,x1=x0,y1=r*k+r,x2=-x1,y2=y1;context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.lineTo(c*x0-s*y0,s*x0+c*y0),context.lineTo(c*x1-s*y1,s*x1+c*y1),context.lineTo(c*x2-s*y2,s*x2+c*y2),context.lineTo(c*x0+s*y0,c*y0-s*x0),context.lineTo(c*x1+s*y1,c*y1-s*x1),context.lineTo(c*x2+s*y2,c*y2-s*x2),context.closePath()}},symbols=[circle,cross,diamond,square,star,triangle,wye];function noop(){}function point(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}function BasisClosed(context){this._context=context}function BasisOpen(context){this._context=context}function Bundle(context,beta){this._basis=new Basis(context),this._beta=beta}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},BasisClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x2=x,this._y2=y;break;case 1:this._point=2,this._x3=x,this._y3=y;break;case 2:this._point=3,this._x4=x,this._y4=y,this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},Bundle.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var x=this._x,y=this._y,j=x.length-1;if(j>0)for(var t,x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1;++i<=j;)t=i/j,this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy));this._x=this._y=null,this._basis.lineEnd()},point:function(x,y){this._x.push(+x),this._y.push(+y)}};var bundle=function custom(beta){function bundle(context){return 1===beta?new Basis(context):new Bundle(context,beta)}return bundle.beta=function(beta){return custom(+beta)},bundle}(.85);function point$1(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context,this._k=(1-tension)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$1(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2,this._x1=x,this._y1=y;break;case 2:this._point=3;default:point$1(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinal=function custom(tension){function cardinal(context){return new Cardinal(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function CardinalClosed(context,tension){this._context=context,this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:point$1(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalClosed=function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function CardinalOpen(context,tension){this._context=context,this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$1(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalOpen=function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function point$2(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>1e-12){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n,y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>1e-12){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m,y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context,this._alpha=alpha}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:point$2(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context,this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:point$2(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomClosed=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function CatmullRomOpen(context,alpha){this._context=context,this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$2(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomOpen=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function LinearClosed(context){this._context=context}function sign(x){return x<0?-1:1}function slope3(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(sign(s0)+sign(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function point$3(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}function MonotoneY(context){this._context=new ReflectContext(context)}function ReflectContext(context){this._context=context}function Natural(context){this._context=context}function controlPoints(x){var i,m,n=x.length-1,a=new Array(n),b=new Array(n),r=new Array(n);for(a[0]=0,b[0]=2,r[0]=x[0]+2*x[1],i=1;i<n-1;++i)a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1];for(a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n],i=1;i<n;++i)m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1];for(a[n-1]=r[n-1]/b[n-1],i=n-2;i>=0;--i)a[i]=(r[i]-a[i+1])/b[i];for(b[n-1]=(x[n]+a[n-1])/2,i=0;i<n-1;++i)b[i]=2*x[i+1]-a[i+1];return[a,b]}function Step(context,t){this._context=context,this._t=t}function none(series,order){if((n=series.length)>1)for(var j,s0,n,i=1,s1=series[order[0]],m=s1.length;i<n;++i)for(s0=s1,s1=series[order[i]],j=0;j<m;++j)s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}function none$1(series){for(var n=series.length,o=new Array(n);--n>=0;)o[n]=n;return o}function stackValue(d,key){return d[key]}function stackSeries(key){const series=[];return series.key=key,series}function appearance(series){var peaks=series.map(peak);return none$1(series).sort((function(a,b){return peaks[a]-peaks[b]}))}function peak(series){for(var vi,i=-1,j=0,n=series.length,vj=-1/0;++i<n;)(vi=+series[i][1])>vj&&(vj=vi,j=i);return j}function ascending(series){var sums=series.map(sum);return none$1(series).sort((function(a,b){return sums[a]-sums[b]}))}function sum(series){for(var v,s=0,i=-1,n=series.length;++i<n;)(v=+series[i][1])&&(s+=v);return s}LinearClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(x,y){x=+x,y=+y,this._point?this._context.lineTo(x,y):(this._point=1,this._context.moveTo(x,y))}},MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$3(this,this._t0,slope2(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){var t1=NaN;if(y=+y,(x=+x)!==this._x1||y!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,point$3(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:point$3(this,this._t0,t1=slope3(this,x,y))}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y,this._t0=t1}}},(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)},ReflectContext.prototype={moveTo:function(x,y){this._context.moveTo(y,x)},closePath:function(){this._context.closePath()},lineTo:function(x,y){this._context.lineTo(y,x)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}},Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var x=this._x,y=this._y,n=x.length;if(n)if(this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]),2===n)this._context.lineTo(x[1],y[1]);else for(var px=controlPoints(x),py=controlPoints(y),i0=0,i1=1;i1<n;++i0,++i1)this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(x,y){this._x.push(+x),this._y.push(+y)}},Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,y),this._context.lineTo(x,y);else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y),this._context.lineTo(x1,y)}}this._x=x,this._y=y}},exports.arc=function(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(context||(context=buffer=d3Path.path()),r1<r0&&(r=r1,r1=r0,r0=r),r1>1e-12)if(da>tau-1e-12)context.moveTo(r1*cos(a0),r1*sin(a0)),context.arc(0,0,r1,a0,a1,!cw),r0>1e-12&&(context.moveTo(r0*cos(a1),r0*sin(a1)),context.arc(0,0,r0,a1,a0,cw));else{var t0,t1,a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>1e-12&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=min(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc;if(rp>1e-12){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));(da0-=2*p0)>1e-12?(a00+=p0*=cw?1:-1,a10-=p0):(da0=0,a00=a10=(a0+a1)/2),(da1-=2*p1)>1e-12?(a01+=p1*=cw?1:-1,a11-=p1):(da1=0,a01=a11=(a0+a1)/2)}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>1e-12){var oc,x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00);if(da<pi&&(oc=intersect(x01,y01,x00,y00,x11,y11,x10,y10))){var ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(acos((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min(rc,(r0-lc)/(kc-1)),rc1=min(rc,(r1-lc)/(kc+1))}}da1>1e-12?rc1>1e-12?(t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw),t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw),context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01),rc1<rc?context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw),context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):(context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw)):context.moveTo(x01,y01),r0>1e-12&&da0>1e-12?rc0>1e-12?(t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw),t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw),context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01),rc0<rc?context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw),context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):context.arc(0,0,r0,a10,a00,cw):context.lineTo(x10,y10)}else context.moveTo(0,0);if(context.closePath(),buffer)return context=null,buffer+""||null}return arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi/2;return[cos(a)*r,sin(a)*r]},arc.innerRadius=function(_){return arguments.length?(innerRadius="function"==typeof _?_:constant(+_),arc):innerRadius},arc.outerRadius=function(_){return arguments.length?(outerRadius="function"==typeof _?_:constant(+_),arc):outerRadius},arc.cornerRadius=function(_){return arguments.length?(cornerRadius="function"==typeof _?_:constant(+_),arc):cornerRadius},arc.padRadius=function(_){return arguments.length?(padRadius=null==_?null:"function"==typeof _?_:constant(+_),arc):padRadius},arc.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant(+_),arc):startAngle},arc.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant(+_),arc):endAngle},arc.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant(+_),arc):padAngle},arc.context=function(_){return arguments.length?(context=null==_?null:_,arc):context},arc},exports.area=area,exports.areaRadial=areaRadial,exports.curveBasis=function(context){return new Basis(context)},exports.curveBasisClosed=function(context){return new BasisClosed(context)},exports.curveBasisOpen=function(context){return new BasisOpen(context)},exports.curveBundle=bundle,exports.curveCardinal=cardinal,exports.curveCardinalClosed=cardinalClosed,exports.curveCardinalOpen=cardinalOpen,exports.curveCatmullRom=catmullRom,exports.curveCatmullRomClosed=catmullRomClosed,exports.curveCatmullRomOpen=catmullRomOpen,exports.curveLinear=curveLinear,exports.curveLinearClosed=function(context){return new LinearClosed(context)},exports.curveMonotoneX=function(context){return new MonotoneX(context)},exports.curveMonotoneY=function(context){return new MonotoneY(context)},exports.curveNatural=function(context){return new Natural(context)},exports.curveStep=function(context){return new Step(context,.5)},exports.curveStepAfter=function(context){return new Step(context,1)},exports.curveStepBefore=function(context){return new Step(context,0)},exports.line=line,exports.lineRadial=lineRadial$1,exports.linkHorizontal=function(){return link(curveHorizontal)},exports.linkRadial=function(){var l=link(curveRadial$1);return l.angle=l.x,delete l.x,l.radius=l.y,delete l.y,l},exports.linkVertical=function(){return link(curveVertical)},exports.pie=function(){var value=identity,sortValues=descending,sort=null,startAngle=constant(0),endAngle=constant(tau),padAngle=constant(0);function pie(data){var i,j,k,a1,v,n=(data=array(data)).length,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau,Math.max(-tau,endAngle.apply(this,arguments)-a0)),p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1);for(i=0;i<n;++i)(v=arcs[index[i]=i]=+value(data[i],i,data))>0&&(sum+=v);for(null!=sortValues?index.sort((function(i,j){return sortValues(arcs[i],arcs[j])})):null!=sort&&index.sort((function(i,j){return sort(data[i],data[j])})),i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1)j=index[i],a1=a0+((v=arcs[j])>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p};return arcs}return pie.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(+_),pie):value},pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues},pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant(+_),pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant(+_),pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant(+_),pie):padAngle},pie},exports.pointRadial=pointRadial,exports.radialArea=areaRadial,exports.radialLine=lineRadial$1,exports.stack=function(){var keys=constant([]),order=none$1,offset=none,value=stackValue;function stack(data){var i,oz,sz=Array.from(keys.apply(this,arguments),stackSeries),n=sz.length,j=-1;for(const d of data)for(i=0,++j;i<n;++i)(sz[i][j]=[0,+value(d,sz[i].key,j,data)]).data=d;for(i=0,oz=array(order(sz));i<n;++i)sz[oz[i]].index=i;return offset(sz,oz),sz}return stack.keys=function(_){return arguments.length?(keys="function"==typeof _?_:constant(Array.from(_)),stack):keys},stack.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(+_),stack):value},stack.order=function(_){return arguments.length?(order=null==_?none$1:"function"==typeof _?_:constant(Array.from(_)),stack):order},stack.offset=function(_){return arguments.length?(offset=null==_?none:_,stack):offset},stack},exports.stackOffsetDiverging=function(series,order){if((n=series.length)>0)for(var i,d,dy,yp,yn,n,j=0,m=series[order[0]].length;j<m;++j)for(yp=yn=0,i=0;i<n;++i)(dy=(d=series[order[i]][j])[1]-d[0])>0?(d[0]=yp,d[1]=yp+=dy):dy<0?(d[1]=yn,d[0]=yn+=dy):(d[0]=0,d[1]=dy)},exports.stackOffsetExpand=function(series,order){if((n=series.length)>0){for(var i,n,y,j=0,m=series[0].length;j<m;++j){for(y=i=0;i<n;++i)y+=series[i][j][1]||0;if(y)for(i=0;i<n;++i)series[i][j][1]/=y}none(series,order)}},exports.stackOffsetNone=none,exports.stackOffsetSilhouette=function(series,order){if((n=series.length)>0){for(var n,j=0,s0=series[order[0]],m=s0.length;j<m;++j){for(var i=0,y=0;i<n;++i)y+=series[i][j][1]||0;s0[j][1]+=s0[j][0]=-y/2}none(series,order)}},exports.stackOffsetWiggle=function(series,order){if((n=series.length)>0&&(m=(s0=series[order[0]]).length)>0){for(var s0,m,n,y=0,j=1;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){for(var si=series[order[i]],sij0=si[j][1]||0,s3=(sij0-(si[j-1][1]||0))/2,k=0;k<i;++k){var sk=series[order[k]];s3+=(sk[j][1]||0)-(sk[j-1][1]||0)}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y,s1&&(y-=s2/s1)}s0[j-1][1]+=s0[j-1][0]=y,none(series,order)}},exports.stackOrderAppearance=appearance,exports.stackOrderAscending=ascending,exports.stackOrderDescending=function(series){return ascending(series).reverse()},exports.stackOrderInsideOut=function(series){var i,j,n=series.length,sums=series.map(sum),order=appearance(series),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i)j=order[i],top<bottom?(top+=sums[j],tops.push(j)):(bottom+=sums[j],bottoms.push(j));return bottoms.reverse().concat(tops)},exports.stackOrderNone=none$1,exports.stackOrderReverse=function(series){return none$1(series).reverse()},exports.symbol=function(type,size){var context=null;function symbol(){var buffer;if(context||(context=buffer=d3Path.path()),type.apply(this,arguments).draw(context,+size.apply(this,arguments)),buffer)return context=null,buffer+""||null}return type="function"==typeof type?type:constant(type||circle),size="function"==typeof size?size:constant(void 0===size?64:+size),symbol.type=function(_){return arguments.length?(type="function"==typeof _?_:constant(_),symbol):type},symbol.size=function(_){return arguments.length?(size="function"==typeof _?_:constant(+_),symbol):size},symbol.context=function(_){return arguments.length?(context=null==_?null:_,symbol):context},symbol},exports.symbolCircle=circle,exports.symbolCross=cross,exports.symbolDiamond=diamond,exports.symbolSquare=square,exports.symbolStar=star,exports.symbolTriangle=triangle,exports.symbolWye=wye,exports.symbols=symbols,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(74))},function(module,exports,__webpack_require__){!function(exports,d3Array,d3Interpolate,d3Format,d3Time,d3TimeFormat){"use strict";function initRange(domain,range){switch(arguments.length){case 0:break;case 1:this.range(domain);break;default:this.range(range).domain(domain)}return this}function initInterpolator(domain,interpolator){switch(arguments.length){case 0:break;case 1:"function"==typeof domain?this.interpolator(domain):this.range(domain);break;default:this.domain(domain),"function"==typeof interpolator?this.interpolator(interpolator):this.range(interpolator)}return this}const implicit=Symbol("implicit");function ordinal(){var index=new Map,domain=[],range=[],unknown=implicit;function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=new Map;for(const value of _){const key=value+"";index.has(key)||index.set(key,domain.push(value))}return scale},scale.range=function(_){return arguments.length?(range=Array.from(_),scale):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal(domain,range).unknown(unknown)},initRange.apply(scale,arguments),scale}function band(){var step,bandwidth,scale=ordinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range,r0=0,r1=1,round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){var n=domain().length,reverse=r1<r0,start=reverse?r1:r0,stop=reverse?r0:r1;step=(stop-start)/Math.max(1,n-paddingInner+2*paddingOuter),round&&(step=Math.floor(step)),start+=(stop-start-step*(n-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start=Math.round(start),bandwidth=Math.round(bandwidth));var values=d3Array.range(n).map((function(i){return start+step*i}));return ordinalRange(reverse?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?([r0,r1]=_,r0=+r0,r1=+r1,rescale()):[r0,r1]},scale.rangeRound=function(_){return[r0,r1]=_,r0=+r0,r1=+r1,round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingInner=Math.min(1,paddingOuter=+_),rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.min(1,_),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=+_,rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.copy=function(){return band(domain(),[r0,r1]).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},initRange.apply(rescale(),arguments)}function pointish(scale){var copy=scale.copy;return scale.padding=scale.paddingOuter,delete scale.paddingInner,delete scale.paddingOuter,scale.copy=function(){return pointish(copy())},scale}function number(x){return+x}var unit=[0,1];function identity(x){return x}function normalize(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:(x=isNaN(b)?NaN:.5,function(){return x});var x}function bimap(domain,range,interpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];return d1<d0?(d0=normalize(d1,d0),r0=interpolate(r1,r0)):(d0=normalize(d0,d1),r0=interpolate(r0,r1)),function(x){return r0(d0(x))}}function polymap(domain,range,interpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;for(domain[j]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++i<j;)d[i]=normalize(domain[i],domain[i+1]),r[i]=interpolate(range[i],range[i+1]);return function(x){var i=d3Array.bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp()).unknown(source.unknown())}function transformer(){var transform,untransform,unknown,piecewise,output,input,domain=unit,range=unit,interpolate=d3Interpolate.interpolate,clamp=identity;function rescale(){var a,b,t,n=Math.min(domain.length,range.length);return clamp!==identity&&(a=domain[0],b=domain[n-1],a>b&&(t=a,a=b,b=t),clamp=function(x){return Math.max(a,Math.min(b,x))}),piecewise=n>2?polymap:bimap,output=input=null,scale}function scale(x){return isNaN(x=+x)?unknown:(output||(output=piecewise(domain.map(transform),range,interpolate)))(transform(clamp(x)))}return scale.invert=function(y){return clamp(untransform((input||(input=piecewise(range,domain.map(transform),d3Interpolate.interpolateNumber)))(y)))},scale.domain=function(_){return arguments.length?(domain=Array.from(_,number),rescale()):domain.slice()},scale.range=function(_){return arguments.length?(range=Array.from(_),rescale()):range.slice()},scale.rangeRound=function(_){return range=Array.from(_),interpolate=d3Interpolate.interpolateRound,rescale()},scale.clamp=function(_){return arguments.length?(clamp=!!_||identity,rescale()):clamp!==identity},scale.interpolate=function(_){return arguments.length?(interpolate=_,rescale()):interpolate},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t,u){return transform=t,untransform=u,rescale()}}function continuous(){return transformer()(identity,identity)}function tickFormat(start,stop,count,specifier){var precision,step=d3Array.tickStep(start,stop,count);switch((specifier=d3Format.formatSpecifier(null==specifier?",f":specifier)).type){case"s":var value=Math.max(Math.abs(start),Math.abs(stop));return null!=specifier.precision||isNaN(precision=d3Format.precisionPrefix(step,value))||(specifier.precision=precision),d3Format.formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":null!=specifier.precision||isNaN(precision=d3Format.precisionRound(step,Math.max(Math.abs(start),Math.abs(stop))))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":null!=specifier.precision||isNaN(precision=d3Format.precisionFixed(step))||(specifier.precision=precision-2*("%"===specifier.type))}return d3Format.format(specifier)}function linearish(scale){var domain=scale.domain;return scale.ticks=function(count){var d=domain();return d3Array.ticks(d[0],d[d.length-1],null==count?10:count)},scale.tickFormat=function(count,specifier){var d=domain();return tickFormat(d[0],d[d.length-1],null==count?10:count,specifier)},scale.nice=function(count){null==count&&(count=10);var prestep,step,d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1],maxIter=10;for(stop<start&&(step=start,start=stop,stop=step,step=i0,i0=i1,i1=step);maxIter-- >0;){if((step=d3Array.tickIncrement(start,stop,count))===prestep)return d[i0]=start,d[i1]=stop,domain(d);if(step>0)start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step;else{if(!(step<0))break;start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step}prestep=step}return scale},scale}function nice(domain,interval){var t,i0=0,i1=(domain=domain.slice()).length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(t=i0,i0=i1,i1=t,t=x0,x0=x1,x1=t),domain[i0]=interval.floor(x0),domain[i1]=interval.ceil(x1),domain}function transformLog(x){return Math.log(x)}function transformExp(x){return Math.exp(x)}function transformLogn(x){return-Math.log(-x)}function transformExpn(x){return-Math.exp(-x)}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function reflect(f){return function(x){return-f(-x)}}function loggish(transform){var logs,pows,scale=transform(transformLog,transformExp),domain=scale.domain,base=10;function rescale(){return logs=function(base){return base===Math.E?Math.log:10===base&&Math.log10||2===base&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}(base),pows=function(base){return 10===base?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}(base),domain()[0]<0?(logs=reflect(logs),pows=reflect(pows),transform(transformLogn,transformExpn)):transform(transformLog,transformExp),scale}return scale.base=function(_){return arguments.length?(base=+_,rescale()):base},scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.ticks=function(count){var r,d=domain(),u=d[0],v=d[d.length-1];(r=v<u)&&(i=u,u=v,v=i);var p,k,t,i=logs(u),j=logs(v),n=null==count?10:+count,z=[];if(!(base%1)&&j-i<n){if(i=Math.floor(i),j=Math.ceil(j),u>0){for(;i<=j;++i)for(k=1,p=pows(i);k<base;++k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}}else for(;i<=j;++i)for(k=base-1,p=pows(i);k>=1;--k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}2*z.length<n&&(z=d3Array.ticks(u,v,n))}else z=d3Array.ticks(i,j,Math.min(j-i,n)).map(pows);return r?z.reverse():z},scale.tickFormat=function(count,specifier){if(null==specifier&&(specifier=10===base?".0e":","),"function"!=typeof specifier&&(specifier=d3Format.format(specifier)),count===1/0)return specifier;null==count&&(count=10);var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));return i*base<base-.5&&(i*=base),i<=k?specifier(d):""}},scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))},scale}function transformSymlog(c){return function(x){return Math.sign(x)*Math.log1p(Math.abs(x/c))}}function transformSymexp(c){return function(x){return Math.sign(x)*Math.expm1(Math.abs(x))*c}}function symlogish(transform){var c=1,scale=transform(transformSymlog(c),transformSymexp(c));return scale.constant=function(_){return arguments.length?transform(transformSymlog(c=+_),transformSymexp(c)):c},linearish(scale)}function transformPow(exponent){return function(x){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}}function transformSqrt(x){return x<0?-Math.sqrt(-x):Math.sqrt(x)}function transformSquare(x){return x<0?-x*x:x*x}function powish(transform){var scale=transform(identity,identity),exponent=1;function rescale(){return 1===exponent?transform(identity,identity):.5===exponent?transform(transformSqrt,transformSquare):transform(transformPow(exponent),transformPow(1/exponent))}return scale.exponent=function(_){return arguments.length?(exponent=+_,rescale()):exponent},linearish(scale)}function pow(){var scale=powish(transformer());return scale.copy=function(){return copy(scale,pow()).exponent(scale.exponent())},initRange.apply(scale,arguments),scale}function square(x){return Math.sign(x)*x*x}function unsquare(x){return Math.sign(x)*Math.sqrt(Math.abs(x))}function date(t){return new Date(t)}function number$1(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(),invert=scale.invert,domain=scale.domain,formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y"),tickIntervals=[[second,1,1e3],[second,5,5e3],[second,15,15e3],[second,30,3e4],[minute,1,6e4],[minute,5,3e5],[minute,15,9e5],[minute,30,18e5],[hour,1,36e5],[hour,3,108e5],[hour,6,216e5],[hour,12,432e5],[day,1,864e5],[day,2,1728e5],[week,1,6048e5],[month,1,2592e6],[month,3,7776e6],[year,1,31536e6]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop){if(null==interval&&(interval=10),"number"==typeof interval){var step,target=Math.abs(stop-start)/interval,i=d3Array.bisector((function(i){return i[2]})).right(tickIntervals,target);return i===tickIntervals.length?(step=d3Array.tickStep(start/31536e6,stop/31536e6,interval),interval=year):i?(step=(i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i])[1],interval=i[0]):(step=Math.max(d3Array.tickStep(start,stop,interval),1),interval=millisecond),interval.every(step)}return interval}return scale.invert=function(y){return new Date(invert(y))},scale.domain=function(_){return arguments.length?domain(Array.from(_,number$1)):domain().map(date)},scale.ticks=function(interval){var t,d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0;return r&&(t=t0,t0=t1,t1=t),t=(t=tickInterval(interval,t0,t1))?t.range(t0,t1+1):[],r?t.reverse():t},scale.tickFormat=function(count,specifier){return null==specifier?tickFormat:format(specifier)},scale.nice=function(interval){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1]))?domain(nice(d,interval)):scale},scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))},scale}function transformer$1(){var t0,t1,k10,transform,unknown,x0=0,x1=1,interpolator=identity,clamp=!1;function scale(x){return isNaN(x=+x)?unknown:interpolator(0===k10?.5:(x=(transform(x)-t0)*k10,clamp?Math.max(0,Math.min(1,x)):x))}function range(interpolate){return function(_){var r0,r1;return arguments.length?([r0,r1]=_,interpolator=interpolate(r0,r1),scale):[interpolator(0),interpolator(1)]}}return scale.domain=function(_){return arguments.length?([x0,x1]=_,t0=transform(x0=+x0),t1=transform(x1=+x1),k10=t0===t1?0:1/(t1-t0),scale):[x0,x1]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.range=range(d3Interpolate.interpolate),scale.rangeRound=range(d3Interpolate.interpolateRound),scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t){return transform=t,t0=t(x0),t1=t(x1),k10=t0===t1?0:1/(t1-t0),scale}}function copy$1(source,target){return target.domain(source.domain()).interpolator(source.interpolator()).clamp(source.clamp()).unknown(source.unknown())}function sequentialPow(){var scale=powish(transformer$1());return scale.copy=function(){return copy$1(scale,sequentialPow()).exponent(scale.exponent())},initInterpolator.apply(scale,arguments)}function transformer$2(){var t0,t1,t2,k10,k21,transform,unknown,x0=0,x1=.5,x2=1,s=1,interpolator=identity,clamp=!1;function scale(x){return isNaN(x=+x)?unknown:(x=.5+((x=+transform(x))-t1)*(s*x<s*t1?k10:k21),interpolator(clamp?Math.max(0,Math.min(1,x)):x))}function range(interpolate){return function(_){var r0,r1,r2;return arguments.length?([r0,r1,r2]=_,interpolator=d3Interpolate.piecewise(interpolate,[r0,r1,r2]),scale):[interpolator(0),interpolator(.5),interpolator(1)]}}return scale.domain=function(_){return arguments.length?([x0,x1,x2]=_,t0=transform(x0=+x0),t1=transform(x1=+x1),t2=transform(x2=+x2),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1),s=t1<t0?-1:1,scale):[x0,x1,x2]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.range=range(d3Interpolate.interpolate),scale.rangeRound=range(d3Interpolate.interpolateRound),scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t){return transform=t,t0=t(x0),t1=t(x1),t2=t(x2),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1),s=t1<t0?-1:1,scale}}function divergingPow(){var scale=powish(transformer$2());return scale.copy=function(){return copy$1(scale,divergingPow()).exponent(scale.exponent())},initInterpolator.apply(scale,arguments)}exports.scaleBand=band,exports.scaleDiverging=function diverging(){var scale=linearish(transformer$2()(identity));return scale.copy=function(){return copy$1(scale,diverging())},initInterpolator.apply(scale,arguments)},exports.scaleDivergingLog=function divergingLog(){var scale=loggish(transformer$2()).domain([.1,1,10]);return scale.copy=function(){return copy$1(scale,divergingLog()).base(scale.base())},initInterpolator.apply(scale,arguments)},exports.scaleDivergingPow=divergingPow,exports.scaleDivergingSqrt=function(){return divergingPow.apply(null,arguments).exponent(.5)},exports.scaleDivergingSymlog=function divergingSymlog(){var scale=symlogish(transformer$2());return scale.copy=function(){return copy$1(scale,divergingSymlog()).constant(scale.constant())},initInterpolator.apply(scale,arguments)},exports.scaleIdentity=function identity$1(domain){var unknown;function scale(x){return isNaN(x=+x)?unknown:x}return scale.invert=scale,scale.domain=scale.range=function(_){return arguments.length?(domain=Array.from(_,number),scale):domain.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return identity$1(domain).unknown(unknown)},domain=arguments.length?Array.from(domain,number):[0,1],linearish(scale)},exports.scaleImplicit=implicit,exports.scaleLinear=function linear(){var scale=continuous();return scale.copy=function(){return copy(scale,linear())},initRange.apply(scale,arguments),linearish(scale)},exports.scaleLog=function log(){var scale=loggish(transformer()).domain([1,10]);return scale.copy=function(){return copy(scale,log()).base(scale.base())},initRange.apply(scale,arguments),scale},exports.scaleOrdinal=ordinal,exports.scalePoint=function(){return pointish(band.apply(null,arguments).paddingInner(1))},exports.scalePow=pow,exports.scaleQuantile=function quantile(){var unknown,domain=[],range=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range.length);for(thresholds=new Array(n-1);++i<n;)thresholds[i-1]=d3Array.quantileSorted(domain,i/n);return scale}function scale(x){return isNaN(x=+x)?unknown:range[d3Array.bisect(thresholds,x)]}return scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]},scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(let d of _)null==d||isNaN(d=+d)||domain.push(d);return domain.sort(d3Array.ascending),rescale()},scale.range=function(_){return arguments.length?(range=Array.from(_),rescale()):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.quantiles=function(){return thresholds.slice()},scale.copy=function(){return quantile().domain(domain).range(range).unknown(unknown)},initRange.apply(scale,arguments)},exports.scaleQuantize=function quantize(){var unknown,x0=0,x1=1,n=1,domain=[.5],range=[0,1];function scale(x){return x<=x?range[d3Array.bisect(domain,x,0,n)]:unknown}function rescale(){var i=-1;for(domain=new Array(n);++i<n;)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}return scale.domain=function(_){return arguments.length?([x0,x1]=_,x0=+x0,x1=+x1,rescale()):[x0,x1]},scale.range=function(_){return arguments.length?(n=(range=Array.from(_)).length-1,rescale()):range.slice()},scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]},scale.unknown=function(_){return arguments.length?(unknown=_,scale):scale},scale.thresholds=function(){return domain.slice()},scale.copy=function(){return quantize().domain([x0,x1]).range(range).unknown(unknown)},initRange.apply(linearish(scale),arguments)},exports.scaleRadial=function radial(){var unknown,squared=continuous(),range=[0,1],round=!1;function scale(x){var y=unsquare(squared(x));return isNaN(y)?unknown:round?Math.round(y):y}return scale.invert=function(y){return squared.invert(square(y))},scale.domain=function(_){return arguments.length?(squared.domain(_),scale):squared.domain()},scale.range=function(_){return arguments.length?(squared.range((range=Array.from(_,number)).map(square)),scale):range.slice()},scale.rangeRound=function(_){return scale.range(_).round(!0)},scale.round=function(_){return arguments.length?(round=!!_,scale):round},scale.clamp=function(_){return arguments.length?(squared.clamp(_),scale):squared.clamp()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return radial(squared.domain(),range).round(round).clamp(squared.clamp()).unknown(unknown)},initRange.apply(scale,arguments),linearish(scale)},exports.scaleSequential=function sequential(){var scale=linearish(transformer$1()(identity));return scale.copy=function(){return copy$1(scale,sequential())},initInterpolator.apply(scale,arguments)},exports.scaleSequentialLog=function sequentialLog(){var scale=loggish(transformer$1()).domain([1,10]);return scale.copy=function(){return copy$1(scale,sequentialLog()).base(scale.base())},initInterpolator.apply(scale,arguments)},exports.scaleSequentialPow=sequentialPow,exports.scaleSequentialQuantile=function sequentialQuantile(){var domain=[],interpolator=identity;function scale(x){if(!isNaN(x=+x))return interpolator((d3Array.bisect(domain,x,1)-1)/(domain.length-1))}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(let d of _)null==d||isNaN(d=+d)||domain.push(d);return domain.sort(d3Array.ascending),scale},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.range=function(){return domain.map((d,i)=>interpolator(i/(domain.length-1)))},scale.quantiles=function(n){return Array.from({length:n+1},(_,i)=>d3Array.quantile(domain,i/n))},scale.copy=function(){return sequentialQuantile(interpolator).domain(domain)},initInterpolator.apply(scale,arguments)},exports.scaleSequentialSqrt=function(){return sequentialPow.apply(null,arguments).exponent(.5)},exports.scaleSequentialSymlog=function sequentialSymlog(){var scale=symlogish(transformer$1());return scale.copy=function(){return copy$1(scale,sequentialSymlog()).constant(scale.constant())},initInterpolator.apply(scale,arguments)},exports.scaleSqrt=function(){return pow.apply(null,arguments).exponent(.5)},exports.scaleSymlog=function symlog(){var scale=symlogish(transformer());return scale.copy=function(){return copy(scale,symlog()).constant(scale.constant())},initRange.apply(scale,arguments)},exports.scaleThreshold=function threshold(){var unknown,domain=[.5],range=[0,1],n=1;function scale(x){return x<=x?range[d3Array.bisect(domain,x,0,n)]:unknown}return scale.domain=function(_){return arguments.length?(domain=Array.from(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()},scale.range=function(_){return arguments.length?(range=Array.from(_),n=Math.min(domain.length,range.length-1),scale):range.slice()},scale.invertExtent=function(y){var i=range.indexOf(y);return[domain[i-1],domain[i]]},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return threshold().domain(domain).range(range).unknown(unknown)},initRange.apply(scale,arguments)},exports.scaleTime=function(){return initRange.apply(calendar(d3Time.timeYear,d3Time.timeMonth,d3Time.timeWeek,d3Time.timeDay,d3Time.timeHour,d3Time.timeMinute,d3Time.timeSecond,d3Time.timeMillisecond,d3TimeFormat.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},exports.scaleUtc=function(){return initRange.apply(calendar(d3Time.utcYear,d3Time.utcMonth,d3Time.utcWeek,d3Time.utcDay,d3Time.utcHour,d3Time.utcMinute,d3Time.utcSecond,d3Time.utcMillisecond,d3TimeFormat.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},exports.tickFormat=tickFormat,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(75),__webpack_require__(101),__webpack_require__(102),__webpack_require__(103),__webpack_require__(73))},function(module,exports,__webpack_require__){!function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}function basis$1(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}function basisClosed(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}function constant(x){return function(){return x}}function linear(a,d){return function(t){return a+t*d}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb.gamma=rgbGamma,rgb}(1);function rgbSpline(spline){return function(colors){var i,color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color=d3Color.rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline(basis$1),rgbBasisClosed=rgbSpline(basisClosed);function numberArray(a,b){b||(b=[]);var i,n=a?Math.min(b.length,a.length):0,c=b.slice();return function(t){for(i=0;i<n;++i)c[i]=a[i]*(1-t)+b[i]*t;return c}}function isNumberArray(x){return ArrayBuffer.isView(x)&&!(x instanceof DataView)}function genericArray(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function date(a,b){var d=new Date;return a=+a,b=+b,function(t){return d.setTime(a*(1-t)+b*t),d}}function number(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function object(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),null!==b&&"object"==typeof b||(b={}),b)k in a?i[k]=value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function string(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function(b){return function(t){return b(t)+""}}(q[0].x):function(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function value(a,b){var c,t=typeof b;return null==b||"boolean"===t?constant(b):("number"===t?number:"string"===t?(c=d3Color.color(b))?(b=c,rgb):string:b instanceof d3Color.color?rgb:b instanceof Date?date:isNumberArray(b)?numberArray:Array.isArray(b)?genericArray:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:number)(a,b)}var cssNode,cssRoot,cssView,svgNode,degrees=180/Math.PI,identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform((function(value){return"none"===value?identity:(cssNode||(cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView),cssNode.style.transform=value,value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform"),cssRoot.removeChild(cssNode),decompose(+(value=value.slice(7,-1).split(","))[0],+value[1],+value[2],+value[3],+value[4],+value[5]))}),"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform((function(value){return null==value?identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):identity)}),", ",")",")"),rho=Math.SQRT2;function cosh(x){return((x=Math.exp(x))+1/x)/2}function hsl(hue){return function(start,end){var h=hue((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hsl$1=hsl(hue),hslLong=hsl(nogamma);function hcl(hue){return function(start,end){var h=hue((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hcl$1=hcl(hue),hclLong=hcl(nogamma);function cubehelix(hue){return function cubehelixGamma(y){function cubehelix(start,end){var h=hue((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix.gamma=cubehelixGamma,cubehelix}(1)}var cubehelix$1=cubehelix(hue),cubehelixLong=cubehelix(nogamma);exports.interpolate=value,exports.interpolateArray=function(a,b){return(isNumberArray(b)?numberArray:genericArray)(a,b)},exports.interpolateBasis=basis$1,exports.interpolateBasisClosed=basisClosed,exports.interpolateCubehelix=cubehelix$1,exports.interpolateCubehelixLong=cubehelixLong,exports.interpolateDate=date,exports.interpolateDiscrete=function(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}},exports.interpolateHcl=hcl$1,exports.interpolateHclLong=hclLong,exports.interpolateHsl=hsl$1,exports.interpolateHslLong=hslLong,exports.interpolateHue=function(a,b){var i=hue(+a,+b);return function(t){var x=i(t);return x-360*Math.floor(x/360)}},exports.interpolateLab=function(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.l=l(t),start.a=a(t),start.b=b(t),start.opacity=opacity(t),start+""}},exports.interpolateNumber=number,exports.interpolateNumberArray=numberArray,exports.interpolateObject=object,exports.interpolateRgb=rgb,exports.interpolateRgbBasis=rgbBasis,exports.interpolateRgbBasisClosed=rgbBasisClosed,exports.interpolateRound=function(a,b){return a=+a,b=+b,function(t){return Math.round(a*(1-t)+b*t)}},exports.interpolateString=string,exports.interpolateTransformCss=interpolateTransformCss,exports.interpolateTransformSvg=interpolateTransformSvg,exports.interpolateZoom=function(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<1e-12)S=Math.log(w1/w0)/rho,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho,i=function(t){var x,s=t*S,coshr0=cosh(r0),u=w0/(2*d1)*(coshr0*(x=rho*s+r0,((x=Math.exp(2*x))-1)/(x+1))-function(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}return i.duration=1e3*S,i},exports.piecewise=function(interpolate,values){for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}},exports.quantize=function(interpolator,n){for(var samples=new Array(n),i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(61))},function(module,exports,__webpack_require__){!function(exports){"use strict";function formatDecimal(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return(x=formatDecimal(Math.abs(x)))?x[1]:NaN}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;return new FormatSpecifier({fill:match[1],align:match[2],sign:match[3],symbol:match[4],zero:match[5],width:match[6],comma:match[7],precision:match[8]&&match[8].slice(1),trim:match[9],type:match[10]})}function FormatSpecifier(specifier){this.fill=void 0===specifier.fill?" ":specifier.fill+"",this.align=void 0===specifier.align?">":specifier.align+"",this.sign=void 0===specifier.sign?"-":specifier.sign+"",this.symbol=void 0===specifier.symbol?"":specifier.symbol+"",this.zero=!!specifier.zero,this.width=void 0===specifier.width?void 0:+specifier.width,this.comma=!!specifier.comma,this.precision=void 0===specifier.precision?void 0:+specifier.precision,this.trim=!!specifier.trim,this.type=void 0===specifier.type?"":specifier.type+""}function formatRounded(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var formatTypes={"%":function(x,p){return(100*x).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(100*x,p)},r:formatRounded,s:function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(exponent/3))))+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]},X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};function identity(x){return x}var locale,map=Array.prototype.map,prefixes=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(locale){var grouping,thousands,group=void 0===locale.grouping||void 0===locale.thousands?identity:(grouping=map.call(locale.grouping,Number),thousands=locale.thousands+"",function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}),currencyPrefix=void 0===locale.currency?"":locale.currency[0]+"",currencySuffix=void 0===locale.currency?"":locale.currency[1]+"",decimal=void 0===locale.decimal?".":locale.decimal+"",numerals=void 0===locale.numerals?identity:function(numerals){return function(value){return value.replace(/[0-9]/g,(function(i){return numerals[+i]}))}}(map.call(locale.numerals,String)),percent=void 0===locale.percent?"%":locale.percent+"",minus=void 0===locale.minus?"-":locale.minus+"",nan=void 0===locale.nan?"NaN":locale.nan+"";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(void 0===precision&&(precision=12),trim=!0,type="g"),(zero||"0"===fill&&"="===align)&&(zero=!0,fill="0",align="=");var prefix="$"===symbol?currencyPrefix:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currencySuffix:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format(value){var i,n,c,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0||1/value<0;if(value=isNaN(value)?nan:formatType(Math.abs(value),precision),trim&&(value=function(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(!+s[i])break out;i0>0&&(i0=0)}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}(value)),valueNegative&&0==+value&&"+"!==sign&&(valueNegative=!1),valuePrefix=(valueNegative?"("===sign?sign:minus:"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if(48>(c=value.charCodeAt(i))||c>57){valueSuffix=(46===c?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero&&(value=group(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero&&(value=group(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=void 0===precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format.toString=function(){return specifier+""},format}return{format:newFormat,formatPrefix:function(specifier,value){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}}}function defaultLocale(definition){return locale=formatLocale(definition),exports.format=locale.format,exports.formatPrefix=locale.formatPrefix,locale}defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),exports.FormatSpecifier=FormatSpecifier,exports.formatDefaultLocale=defaultLocale,exports.formatLocale=formatLocale,exports.formatSpecifier=formatSpecifier,exports.precisionFixed=function(step){return Math.max(0,-exponent(Math.abs(step)))},exports.precisionPrefix=function(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))-exponent(Math.abs(step)))},exports.precisionRound=function(step,max){return step=Math.abs(step),max=Math.abs(max)-step,Math.max(0,exponent(max)-exponent(step))+1},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";var t0=new Date,t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=0===arguments.length?new Date:new Date(+date)),date}return interval.floor=function(date){return floori(date=new Date(+date)),date},interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range},interval.filter=function(test){return newInterval((function(date){if(date>=date)for(;floori(date),!test(date);)date.setTime(date-1)}),(function(date,step){if(date>=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;--step>=0;)for(;offseti(date,1),!test(date););}))},count&&(interval.count=function(start,end){return t0.setTime(+start),t1.setTime(+end),floori(t0),floori(t1),Math.floor(count(t0,t1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&step>0?step>1?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var millisecond=newInterval((function(){}),(function(date,step){date.setTime(+date+step)}),(function(start,end){return end-start}));millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&k>0?k>1?newInterval((function(date){date.setTime(Math.floor(date/k)*k)}),(function(date,step){date.setTime(+date+step*k)}),(function(start,end){return(end-start)/k})):millisecond:null};var milliseconds=millisecond.range,second=newInterval((function(date){date.setTime(date-date.getMilliseconds())}),(function(date,step){date.setTime(+date+1e3*step)}),(function(start,end){return(end-start)/1e3}),(function(date){return date.getUTCSeconds()})),seconds=second.range,minute=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds())}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getMinutes()})),minutes=minute.range,hour=newInterval((function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds()-6e4*date.getMinutes())}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getHours()})),hours=hour.range,day=newInterval(date=>date.setHours(0,0,0,0),(date,step)=>date.setDate(date.getDate()+step),(start,end)=>(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/864e5,date=>date.getDate()-1),days=day.range;function weekday(i){return newInterval((function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)}),(function(date,step){date.setDate(date.getDate()+7*step)}),(function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/6048e5}))}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),sundays=sunday.range,mondays=monday.range,tuesdays=tuesday.range,wednesdays=wednesday.range,thursdays=thursday.range,fridays=friday.range,saturdays=saturday.range,month=newInterval((function(date){date.setDate(1),date.setHours(0,0,0,0)}),(function(date,step){date.setMonth(date.getMonth()+step)}),(function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())}),(function(date){return date.getMonth()})),months=month.range,year=newInterval((function(date){date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step)}),(function(start,end){return end.getFullYear()-start.getFullYear()}),(function(date){return date.getFullYear()}));year.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)}),(function(date,step){date.setFullYear(date.getFullYear()+step*k)})):null};var years=year.range,utcMinute=newInterval((function(date){date.setUTCSeconds(0,0)}),(function(date,step){date.setTime(+date+6e4*step)}),(function(start,end){return(end-start)/6e4}),(function(date){return date.getUTCMinutes()})),utcMinutes=utcMinute.range,utcHour=newInterval((function(date){date.setUTCMinutes(0,0,0)}),(function(date,step){date.setTime(+date+36e5*step)}),(function(start,end){return(end-start)/36e5}),(function(date){return date.getUTCHours()})),utcHours=utcHour.range,utcDay=newInterval((function(date){date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+step)}),(function(start,end){return(end-start)/864e5}),(function(date){return date.getUTCDate()-1})),utcDays=utcDay.range;function utcWeekday(i){return newInterval((function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCDate(date.getUTCDate()+7*step)}),(function(start,end){return(end-start)/6048e5}))}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcSundays=utcSunday.range,utcMondays=utcMonday.range,utcTuesdays=utcTuesday.range,utcWednesdays=utcWednesday.range,utcThursdays=utcThursday.range,utcFridays=utcFriday.range,utcSaturdays=utcSaturday.range,utcMonth=newInterval((function(date){date.setUTCDate(1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCMonth(date.getUTCMonth()+step)}),(function(start,end){return end.getUTCMonth()-start.getUTCMonth()+12*(end.getUTCFullYear()-start.getUTCFullYear())}),(function(date){return date.getUTCMonth()})),utcMonths=utcMonth.range,utcYear=newInterval((function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)}),(function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()}),(function(date){return date.getUTCFullYear()}));utcYear.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval((function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)}),(function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})):null};var utcYears=utcYear.range;exports.timeDay=day,exports.timeDays=days,exports.timeFriday=friday,exports.timeFridays=fridays,exports.timeHour=hour,exports.timeHours=hours,exports.timeInterval=newInterval,exports.timeMillisecond=millisecond,exports.timeMilliseconds=milliseconds,exports.timeMinute=minute,exports.timeMinutes=minutes,exports.timeMonday=monday,exports.timeMondays=mondays,exports.timeMonth=month,exports.timeMonths=months,exports.timeSaturday=saturday,exports.timeSaturdays=saturdays,exports.timeSecond=second,exports.timeSeconds=seconds,exports.timeSunday=sunday,exports.timeSundays=sundays,exports.timeThursday=thursday,exports.timeThursdays=thursdays,exports.timeTuesday=tuesday,exports.timeTuesdays=tuesdays,exports.timeWednesday=wednesday,exports.timeWednesdays=wednesdays,exports.timeWeek=sunday,exports.timeWeeks=sundays,exports.timeYear=year,exports.timeYears=years,exports.utcDay=utcDay,exports.utcDays=utcDays,exports.utcFriday=utcFriday,exports.utcFridays=utcFridays,exports.utcHour=utcHour,exports.utcHours=utcHours,exports.utcMillisecond=millisecond,exports.utcMilliseconds=milliseconds,exports.utcMinute=utcMinute,exports.utcMinutes=utcMinutes,exports.utcMonday=utcMonday,exports.utcMondays=utcMondays,exports.utcMonth=utcMonth,exports.utcMonths=utcMonths,exports.utcSaturday=utcSaturday,exports.utcSaturdays=utcSaturdays,exports.utcSecond=second,exports.utcSeconds=seconds,exports.utcSunday=utcSunday,exports.utcSundays=utcSundays,exports.utcThursday=utcThursday,exports.utcThursdays=utcThursdays,exports.utcTuesday=utcTuesday,exports.utcTuesdays=utcTuesdays,exports.utcWednesday=utcWednesday,exports.utcWednesdays=utcWednesdays,exports.utcWeek=utcSunday,exports.utcWeeks=utcSundays,exports.utcYear=utcYear,exports.utcYears=utcYears,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}function basis$1(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}function basisClosed(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}var constant=x=>()=>x;function linear(a,d){return function(t){return a+t*d}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb.gamma=rgbGamma,rgb}(1);function rgbSpline(spline){return function(colors){var i,color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color=d3Color.rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline(basis$1),rgbBasisClosed=rgbSpline(basisClosed);function numberArray(a,b){b||(b=[]);var i,n=a?Math.min(b.length,a.length):0,c=b.slice();return function(t){for(i=0;i<n;++i)c[i]=a[i]*(1-t)+b[i]*t;return c}}function isNumberArray(x){return ArrayBuffer.isView(x)&&!(x instanceof DataView)}function genericArray(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function date(a,b){var d=new Date;return a=+a,b=+b,function(t){return d.setTime(a*(1-t)+b*t),d}}function number(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function object(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),null!==b&&"object"==typeof b||(b={}),b)k in a?i[k]=value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function string(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function(b){return function(t){return b(t)+""}}(q[0].x):function(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function value(a,b){var c,t=typeof b;return null==b||"boolean"===t?constant(b):("number"===t?number:"string"===t?(c=d3Color.color(b))?(b=c,rgb):string:b instanceof d3Color.color?rgb:b instanceof Date?date:isNumberArray(b)?numberArray:Array.isArray(b)?genericArray:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:number)(a,b)}var svgNode,degrees=180/Math.PI,identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform((function(value){const m=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(value+"");return m.isIdentity?identity:decompose(m.a,m.b,m.c,m.d,m.e,m.f)}),"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform((function(value){return null==value?identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):identity)}),", ",")",")");function cosh(x){return((x=Math.exp(x))+1/x)/2}var zoom=function zoomRho(rho,rho2,rho4){function zoom(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<1e-12)S=Math.log(w1/w0)/rho,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho,i=function(t){var x,s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*(x=rho*s+r0,((x=Math.exp(2*x))-1)/(x+1))-function(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}return i.duration=1e3*S*rho/Math.SQRT2,i}return zoom.rho=function(_){var _1=Math.max(.001,+_),_2=_1*_1;return zoomRho(_1,_2,_2*_2)},zoom}(Math.SQRT2,2,4);function hsl(hue){return function(start,end){var h=hue((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hsl$1=hsl(hue),hslLong=hsl(nogamma);function hcl(hue){return function(start,end){var h=hue((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hcl$1=hcl(hue),hclLong=hcl(nogamma);function cubehelix(hue){return function cubehelixGamma(y){function cubehelix(start,end){var h=hue((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix.gamma=cubehelixGamma,cubehelix}(1)}var cubehelix$1=cubehelix(hue),cubehelixLong=cubehelix(nogamma);exports.interpolate=value,exports.interpolateArray=function(a,b){return(isNumberArray(b)?numberArray:genericArray)(a,b)},exports.interpolateBasis=basis$1,exports.interpolateBasisClosed=basisClosed,exports.interpolateCubehelix=cubehelix$1,exports.interpolateCubehelixLong=cubehelixLong,exports.interpolateDate=date,exports.interpolateDiscrete=function(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}},exports.interpolateHcl=hcl$1,exports.interpolateHclLong=hclLong,exports.interpolateHsl=hsl$1,exports.interpolateHslLong=hslLong,exports.interpolateHue=function(a,b){var i=hue(+a,+b);return function(t){var x=i(t);return x-360*Math.floor(x/360)}},exports.interpolateLab=function(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.l=l(t),start.a=a(t),start.b=b(t),start.opacity=opacity(t),start+""}},exports.interpolateNumber=number,exports.interpolateNumberArray=numberArray,exports.interpolateObject=object,exports.interpolateRgb=rgb,exports.interpolateRgbBasis=rgbBasis,exports.interpolateRgbBasisClosed=rgbBasisClosed,exports.interpolateRound=function(a,b){return a=+a,b=+b,function(t){return Math.round(a*(1-t)+b*t)}},exports.interpolateString=string,exports.interpolateTransformCss=interpolateTransformCss,exports.interpolateTransformSvg=interpolateTransformSvg,exports.interpolateZoom=zoom,exports.piecewise=function(interpolate,values){void 0===values&&(values=interpolate,interpolate=value);for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}},exports.quantize=function(interpolator,n){for(var samples=new Array(n),i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(61))},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaScale,vegaUtil,d3Array,d3Interpolate){"use strict";function AxisTicks(params){vegaDataflow.Transform.call(this,null,params)}function DataJoin(params){vegaDataflow.Transform.call(this,null,params)}function defaultItemCreate(){return vegaDataflow.ingest({})}function Encode(params){vegaDataflow.Transform.call(this,null,params)}function LegendEntries(params){vegaDataflow.Transform.call(this,[],params)}vegaUtil.inherits(AxisTicks,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!_.modified())return pulse.StopPropagation;var locale=pulse.dataflow.locale(),out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),ticks=this.value,scale=_.scale,tally=null==_.count?_.values?_.values.length:10:_.count,count=vegaScale.tickCount(scale,tally,_.minstep),format=_.format||vegaScale.tickFormat(locale,scale,count,_.formatSpecifier,_.formatType,!!_.values),values=_.values?vegaScale.validTicks(scale,_.values,count):vegaScale.tickValues(scale,count);return ticks&&(out.rem=ticks),ticks=values.map((value,i)=>vegaDataflow.ingest({index:i/(values.length-1||1),value:value,label:format(value)})),_.extra&&ticks.length&&ticks.push(vegaDataflow.ingest({index:-1,extra:{value:ticks[0].value},label:""})),out.source=ticks,out.add=ticks,this.value=ticks,out}}),vegaUtil.inherits(DataJoin,vegaDataflow.Transform,{transform(_,pulse){var df=pulse.dataflow,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),item=_.item||defaultItemCreate,key=_.key||vegaDataflow.tupleid,map=this.value;return vegaUtil.isArray(out.encode)&&(out.encode=null),map&&(_.modified("key")||pulse.modified(key))&&vegaUtil.error("DataJoin does not support modified key function or fields."),map||(pulse=pulse.addAll(),this.value=map=function(key){const map=vegaUtil.fastmap().test(t=>t.exit);return map.lookup=t=>map.get(key(t)),map}(key)),pulse.visit(pulse.ADD,t=>{const k=key(t);let x=map.get(k);x?x.exit?(map.empty--,out.add.push(x)):out.mod.push(x):(x=item(t),map.set(k,x),out.add.push(x)),x.datum=t,x.exit=!1}),pulse.visit(pulse.MOD,t=>{const k=key(t),x=map.get(k);x&&(x.datum=t,out.mod.push(x))}),pulse.visit(pulse.REM,t=>{const k=key(t),x=map.get(k);t!==x.datum||x.exit||(out.rem.push(x),x.exit=!0,++map.empty)}),pulse.changed(pulse.ADD_MOD)&&out.modifies("datum"),(pulse.clean()||_.clean&&map.empty>df.cleanThreshold)&&df.runAfter(map.clean),out}}),vegaUtil.inherits(Encode,vegaDataflow.Transform,{transform(_,pulse){var out=pulse.fork(pulse.ADD_REM),fmod=_.mod||!1,encoders=_.encoders,encode=pulse.encode;if(vegaUtil.isArray(encode)){if(!out.changed()&&!encode.every(e=>encoders[e]))return pulse.StopPropagation;encode=encode[0],out.encode=null}var reenter="enter"===encode,update=encoders.update||vegaUtil.falsy,enter=encoders.enter||vegaUtil.falsy,exit=encoders.exit||vegaUtil.falsy,set=(encode&&!reenter?encoders[encode]:update)||vegaUtil.falsy;if(pulse.changed(pulse.ADD)&&(pulse.visit(pulse.ADD,t=>{enter(t,_),update(t,_)}),out.modifies(enter.output),out.modifies(update.output),set!==vegaUtil.falsy&&set!==update&&(pulse.visit(pulse.ADD,t=>{set(t,_)}),out.modifies(set.output))),pulse.changed(pulse.REM)&&exit!==vegaUtil.falsy&&(pulse.visit(pulse.REM,t=>{exit(t,_)}),out.modifies(exit.output)),reenter||set!==vegaUtil.falsy){const flag=pulse.MOD|(_.modified()?pulse.REFLOW:0);reenter?(pulse.visit(flag,t=>{const mod=enter(t,_)||fmod;(set(t,_)||mod)&&out.mod.push(t)}),out.mod.length&&out.modifies(enter.output)):pulse.visit(flag,t=>{(set(t,_)||fmod)&&out.mod.push(t)}),out.mod.length&&out.modifies(set.output)}return out.changed()?out:pulse.StopPropagation}}),vegaUtil.inherits(LegendEntries,vegaDataflow.Transform,{transform(_,pulse){if(null!=this.value&&!_.modified())return pulse.StopPropagation;var domain,fraction,size,offset,ellipsis,locale=pulse.dataflow.locale(),out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),items=this.value,type=_.type||vegaScale.SymbolLegend,scale=_.scale,limit=+_.limit,count=vegaScale.tickCount(scale,null==_.count?5:_.count,_.minstep),lskip=!!_.values||type===vegaScale.SymbolLegend,format=_.format||vegaScale.labelFormat(locale,scale,count,type,_.formatSpecifier,_.formatType,lskip),values=_.values||vegaScale.labelValues(scale,count);return items&&(out.rem=items),type===vegaScale.SymbolLegend?(limit&&values.length>limit?(pulse.dataflow.warn("Symbol legend count exceeds limit, filtering items."),items=values.slice(0,limit-1),ellipsis=!0):items=values,vegaUtil.isFunction(size=_.size)?(_.values||0!==scale(items[0])||(items=items.slice(1)),offset=items.reduce((max,value)=>Math.max(max,size(value,_)),0)):size=vegaUtil.constant(offset=size||8),items=items.map((value,index)=>vegaDataflow.ingest({index:index,label:format(value,index,items),value:value,offset:offset,size:size(value,_)})),ellipsis&&(ellipsis=values[items.length],items.push(vegaDataflow.ingest({index:items.length,label:`â€¦${values.length-items.length} entries`,value:ellipsis,offset:offset,size:size(ellipsis,_)})))):type===vegaScale.GradientLegend?(domain=scale.domain(),fraction=vegaScale.scaleFraction(scale,domain[0],vegaUtil.peek(domain)),values.length<3&&!_.values&&domain[0]!==vegaUtil.peek(domain)&&(values=[domain[0],vegaUtil.peek(domain)]),items=values.map((value,index)=>vegaDataflow.ingest({index:index,label:format(value,index,values),value:value,perc:fraction(value)}))):(size=values.length-1,fraction=vegaScale.labelFraction(scale),items=values.map((value,index)=>vegaDataflow.ingest({index:index,label:format(value,index,values),value:value,perc:index?fraction(value):0,perc2:index===size?1:fraction(values[index+1])}))),out.source=items,out.add=items,this.value=items,out}});const sourceX=t=>t.source.x,sourceY=t=>t.source.y,targetX=t=>t.target.x,targetY=t=>t.target.y;function LinkPath(params){vegaDataflow.Transform.call(this,{},params)}LinkPath.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},vegaUtil.inherits(LinkPath,vegaDataflow.Transform,{transform(_,pulse){var sx=_.sourceX||sourceX,sy=_.sourceY||sourceY,tx=_.targetX||targetX,ty=_.targetY||targetY,as=_.as||"path",orient=_.orient||"vertical",shape=_.shape||"line",path=Paths.get(shape+"-"+orient)||Paths.get(shape);return path||vegaUtil.error("LinkPath unsupported type: "+_.shape+(_.orient?"-"+_.orient:"")),pulse.visit(pulse.SOURCE,t=>{t[as]=path(sx(t),sy(t),tx(t),ty(t))}),pulse.reflow(_.modified()).modifies(as)}});const line=(sx,sy,tx,ty)=>"M"+sx+","+sy+"L"+tx+","+ty,arc=(sx,sy,tx,ty)=>{var dx=tx-sx,dy=ty-sy,rr=Math.sqrt(dx*dx+dy*dy)/2;return"M"+sx+","+sy+"A"+rr+","+rr+" "+180*Math.atan2(dy,dx)/Math.PI+" 0 1 "+tx+","+ty},curve=(sx,sy,tx,ty)=>{const dx=tx-sx,dy=ty-sy,ix=.2*(dx+dy),iy=.2*(dy-dx);return"M"+sx+","+sy+"C"+(sx+ix)+","+(sy+iy)+" "+(tx+iy)+","+(ty-ix)+" "+tx+","+ty},Paths=vegaUtil.fastmap({line:line,"line-radial":(sa,sr,ta,tr)=>line(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta)),arc:arc,"arc-radial":(sa,sr,ta,tr)=>arc(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta)),curve:curve,"curve-radial":(sa,sr,ta,tr)=>curve(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta)),"orthogonal-horizontal":(sx,sy,tx,ty)=>"M"+sx+","+sy+"V"+ty+"H"+tx,"orthogonal-vertical":(sx,sy,tx,ty)=>"M"+sx+","+sy+"H"+tx+"V"+ty,"orthogonal-radial":(sa,sr,ta,tr)=>{const sc=Math.cos(sa),ss=Math.sin(sa),tc=Math.cos(ta),ts=Math.sin(ta);return"M"+sr*sc+","+sr*ss+"A"+sr+","+sr+" 0 0,"+((Math.abs(ta-sa)>Math.PI?ta<=sa:ta>sa)?1:0)+" "+sr*tc+","+sr*ts+"L"+tr*tc+","+tr*ts},"diagonal-horizontal":(sx,sy,tx,ty)=>{const m=(sx+tx)/2;return"M"+sx+","+sy+"C"+m+","+sy+" "+m+","+ty+" "+tx+","+ty},"diagonal-vertical":(sx,sy,tx,ty)=>{const m=(sy+ty)/2;return"M"+sx+","+sy+"C"+sx+","+m+" "+tx+","+m+" "+tx+","+ty},"diagonal-radial":(sa,sr,ta,tr)=>{const sc=Math.cos(sa),ss=Math.sin(sa),tc=Math.cos(ta),ts=Math.sin(ta),mr=(sr+tr)/2;return"M"+sr*sc+","+sr*ss+"C"+mr*sc+","+mr*ss+" "+mr*tc+","+mr*ts+" "+tr*tc+","+tr*ts}});function Pie(params){vegaDataflow.Transform.call(this,null,params)}function includePad(type){return vegaScale.isContinuous(type)&&type!==vegaScale.Sequential}Pie.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},vegaUtil.inherits(Pie,vegaDataflow.Transform,{transform(_,pulse){var i,t,v,as=_.as||["startAngle","endAngle"],startAngle=as[0],endAngle=as[1],field=_.field||vegaUtil.one,start=_.startAngle||0,stop=null!=_.endAngle?_.endAngle:2*Math.PI,data=pulse.source,values=data.map(field),n=values.length,a=start,k=(stop-start)/d3Array.sum(values),index=d3Array.range(n);for(_.sort&&index.sort((a,b)=>values[a]-values[b]),i=0;i<n;++i)v=values[index[i]],(t=data[index[i]])[startAngle]=a,t[endAngle]=a+=v*k;return this.value=values,pulse.reflow(_.modified()).modifies(as)}});const SKIP=vegaUtil.toSet(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Scale(params){vegaDataflow.Transform.call(this,null,params),this.modified(!0)}function scaleKey(_){var n,t=_.type,d="";return t===vegaScale.Sequential?vegaScale.Sequential+"-"+vegaScale.Linear:(function(_){const t=_.type;return vegaScale.isContinuous(t)&&t!==vegaScale.Time&&t!==vegaScale.UTC&&(_.scheme||_.range&&_.range.length&&_.range.every(vegaUtil.isString))}(_)&&(d=2===(n=_.rawDomain?_.rawDomain.length:_.domain?_.domain.length+ +(null!=_.domainMid):0)?vegaScale.Sequential+"-":3===n?vegaScale.Diverging+"-":""),(d+t||vegaScale.Linear).toLowerCase())}function configureDomain(scale,_,df){const raw=function(scale,raw,df){return raw?(scale.domain(domainCheck(scale.type,raw,df)),raw.length):-1}(scale,_.domainRaw,df);if(raw>-1)return raw;var n,mid,domain=_.domain,type=scale.type,zero=_.zero||void 0===_.zero&&function(scale){const type=scale.type;return!scale.bins&&(type===vegaScale.Linear||type===vegaScale.Pow||type===vegaScale.Sqrt)}(scale);if(!domain)return 0;if(includePad(type)&&_.padding&&domain[0]!==vegaUtil.peek(domain)&&(domain=function(type,domain,range,pad,exponent,constant){var span=Math.abs(vegaUtil.peek(range)-range[0]),frac=span/(span-2*pad),d=type===vegaScale.Log?vegaUtil.zoomLog(domain,null,frac):type===vegaScale.Sqrt?vegaUtil.zoomPow(domain,null,frac,.5):type===vegaScale.Pow?vegaUtil.zoomPow(domain,null,frac,exponent||1):type===vegaScale.Symlog?vegaUtil.zoomSymlog(domain,null,frac,constant||1):vegaUtil.zoomLinear(domain,null,frac);return(domain=domain.slice())[0]=d[0],domain[domain.length-1]=d[1],domain}(type,domain,_.range,_.padding,_.exponent,_.constant)),(zero||null!=_.domainMin||null!=_.domainMax||null!=_.domainMid)&&(n=(domain=domain.slice()).length-1||1,zero&&(domain[0]>0&&(domain[0]=0),domain[n]<0&&(domain[n]=0)),null!=_.domainMin&&(domain[0]=_.domainMin),null!=_.domainMax&&(domain[n]=_.domainMax),null!=_.domainMid)){const i=(mid=_.domainMid)>domain[n]?n+1:mid<domain[0]?0:n;i!==n&&df.warn("Scale domainMid exceeds domain min or max.",mid),domain.splice(i,0,mid)}return scale.domain(domainCheck(type,domain,df)),type===vegaScale.Ordinal&&scale.unknown(_.domainImplicit?vegaScale.scaleImplicit:void 0),_.nice&&scale.nice&&scale.nice(!0!==_.nice&&vegaScale.tickCount(scale,_.nice)||null),domain.length}function domainCheck(type,domain,df){return vegaScale.isLogarithmic(type)&&Math.abs(domain.reduce((s,v)=>s+(v<0?-1:v>0?1:0),0))!==domain.length&&df.warn("Log scale domain includes zero: "+vegaUtil.stringValue(domain)),domain}function configureRange(scale,_,count){var type=scale.type,round=_.round||!1,range=_.range;if(null!=_.rangeStep)range=function(type,_,count){type!==vegaScale.Band&&type!==vegaScale.Point&&vegaUtil.error("Only band and point scales support rangeStep.");var outer=(null!=_.paddingOuter?_.paddingOuter:_.padding)||0,inner=type===vegaScale.Point?1:(null!=_.paddingInner?_.paddingInner:_.padding)||0;return[0,_.rangeStep*vegaScale.bandSpace(count,inner,outer)]}(type,_,count);else if(_.scheme&&(range=function(type,_,count){var name,scheme,extent=_.schemeExtent;return vegaUtil.isArray(_.scheme)?scheme=vegaScale.interpolateColors(_.scheme,_.interpolate,_.interpolateGamma):(name=_.scheme.toLowerCase(),(scheme=vegaScale.scheme(name))||vegaUtil.error("Unrecognized scheme name: "+_.scheme)),count=type===vegaScale.Threshold?count+1:type===vegaScale.BinOrdinal?count-1:type===vegaScale.Quantile||type===vegaScale.Quantize?+_.schemeCount||5:count,vegaScale.isInterpolating(type)?adjustScheme(scheme,extent,_.reverse):vegaUtil.isFunction(scheme)?vegaScale.quantizeInterpolator(adjustScheme(scheme,extent),count):type===vegaScale.Ordinal?scheme:scheme.slice(0,count)}(type,_,count),vegaUtil.isFunction(range))){if(scale.interpolator)return scale.interpolator(range);vegaUtil.error(`Scale type ${type} does not support interpolating color schemes.`)}if(range&&vegaScale.isInterpolating(type))return scale.interpolator(vegaScale.interpolateColors(flip(range,_.reverse),_.interpolate,_.interpolateGamma));range&&_.interpolate&&scale.interpolate?scale.interpolate(vegaScale.interpolate(_.interpolate,_.interpolateGamma)):vegaUtil.isFunction(scale.round)?scale.round(round):vegaUtil.isFunction(scale.rangeRound)&&scale.interpolate(round?d3Interpolate.interpolateRound:d3Interpolate.interpolate),range&&scale.range(flip(range,_.reverse))}function adjustScheme(scheme,extent,reverse){return vegaUtil.isFunction(scheme)&&(extent||reverse)?vegaScale.interpolateRange(scheme,flip(extent||[0,1],reverse)):scheme}function flip(array,reverse){return reverse?array.slice().reverse():array}function SortItems(params){vegaDataflow.Transform.call(this,null,params)}vegaUtil.inherits(Scale,vegaDataflow.Transform,{transform(_,pulse){var df=pulse.dataflow,scale=this.value,key=scaleKey(_);for(key in scale&&key===scale.type||(this.value=scale=vegaScale.scale(key)()),_)if(!SKIP[key]){if("padding"===key&&includePad(scale.type))continue;vegaUtil.isFunction(scale[key])?scale[key](_[key]):df.warn("Unsupported scale property: "+key)}return configureRange(scale,_,function(scale,_,count){let bins=_.bins;if(bins&&!vegaUtil.isArray(bins)){const domain=scale.domain(),lo=domain[0],hi=vegaUtil.peek(domain),step=bins.step;let start=null==bins.start?lo:bins.start,stop=null==bins.stop?hi:bins.stop;step||vegaUtil.error("Scale bins parameter missing step property."),start<lo&&(start=step*Math.ceil(lo/step)),stop>hi&&(stop=step*Math.floor(hi/step)),bins=d3Array.range(start,stop+step/2,step)}return bins?scale.bins=bins:scale.bins&&delete scale.bins,scale.type===vegaScale.BinOrdinal&&(bins?_.domain||_.domainRaw||(scale.domain(bins),count=bins.length):scale.bins=scale.domain()),count}(scale,_,configureDomain(scale,_,df))),pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)}}),vegaUtil.inherits(SortItems,vegaDataflow.Transform,{transform(_,pulse){const mod=_.modified("sort")||pulse.changed(pulse.ADD)||pulse.modified(_.sort.fields)||pulse.modified("datum");return mod&&pulse.source.sort(vegaDataflow.stableCompare(_.sort)),this.modified(mod),pulse}});const DefOutput=["y0","y1"];function Stack(params){vegaDataflow.Transform.call(this,null,params)}function stackCenter(group,max,field,y0,y1){for(var t,last=(max-group.sum)/2,m=group.length,j=0;j<m;++j)(t=group[j])[y0]=last,t[y1]=last+=Math.abs(field(t))}function stackNormalize(group,max,field,y0,y1){for(var t,scale=1/group.sum,last=0,m=group.length,j=0,v=0;j<m;++j)(t=group[j])[y0]=last,t[y1]=last=scale*(v+=Math.abs(field(t)))}function stackZero(group,max,field,y0,y1){for(var v,t,lastPos=0,lastNeg=0,m=group.length,j=0;j<m;++j)(v=+field(t=group[j]))<0?(t[y0]=lastNeg,t[y1]=lastNeg+=v):(t[y0]=lastPos,t[y1]=lastPos+=v)}Stack.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:DefOutput}]},vegaUtil.inherits(Stack,vegaDataflow.Transform,{transform(_,pulse){var groups,i,n,max,as=_.as||DefOutput,y0=as[0],y1=as[1],sort=vegaDataflow.stableCompare(_.sort),field=_.field||vegaUtil.one,stack="center"===_.offset?stackCenter:"normalize"===_.offset?stackNormalize:stackZero;for(groups=function(data,groupby,sort,field){var map,i,n,m,t,k,g,s,max,groups=[],get=f=>f(t);if(null==groupby)groups.push(data.slice());else for(map={},i=0,n=data.length;i<n;++i)t=data[i],(g=map[k=groupby.map(get)])||(map[k]=g=[],groups.push(g)),g.push(t);for(k=0,max=0,m=groups.length;k<m;++k){for(i=0,s=0,n=(g=groups[k]).length;i<n;++i)s+=Math.abs(field(g[i]));g.sum=s,s>max&&(max=s),sort&&g.sort(sort)}return groups.max=max,groups}(pulse.source,_.groupby,sort,field),i=0,n=groups.length,max=groups.max;i<n;++i)stack(groups[i],max,field,y0,y1);return pulse.reflow(_.modified()).modifies(as)}}),exports.axisticks=AxisTicks,exports.datajoin=DataJoin,exports.encode=Encode,exports.legendentries=LegendEntries,exports.linkpath=LinkPath,exports.pie=Pie,exports.scale=Scale,exports.sortitems=SortItems,exports.stack=Stack,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(45),__webpack_require__(37),__webpack_require__(106),__webpack_require__(107))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}function basis$1(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}function basisClosed(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}var constant=x=>()=>x;function linear(a,d){return function(t){return a+t*d}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb.gamma=rgbGamma,rgb}(1);function rgbSpline(spline){return function(colors){var i,color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color=d3Color.rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline(basis$1),rgbBasisClosed=rgbSpline(basisClosed);function numberArray(a,b){b||(b=[]);var i,n=a?Math.min(b.length,a.length):0,c=b.slice();return function(t){for(i=0;i<n;++i)c[i]=a[i]*(1-t)+b[i]*t;return c}}function isNumberArray(x){return ArrayBuffer.isView(x)&&!(x instanceof DataView)}function genericArray(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function date(a,b){var d=new Date;return a=+a,b=+b,function(t){return d.setTime(a*(1-t)+b*t),d}}function number(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function object(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),null!==b&&"object"==typeof b||(b={}),b)k in a?i[k]=value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function string(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function(b){return function(t){return b(t)+""}}(q[0].x):function(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function value(a,b){var c,t=typeof b;return null==b||"boolean"===t?constant(b):("number"===t?number:"string"===t?(c=d3Color.color(b))?(b=c,rgb):string:b instanceof d3Color.color?rgb:b instanceof Date?date:isNumberArray(b)?numberArray:Array.isArray(b)?genericArray:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:number)(a,b)}var svgNode,degrees=180/Math.PI,identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform((function(value){const m=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(value+"");return m.isIdentity?identity:decompose(m.a,m.b,m.c,m.d,m.e,m.f)}),"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform((function(value){return null==value?identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):identity)}),", ",")",")");function cosh(x){return((x=Math.exp(x))+1/x)/2}var zoom=function zoomRho(rho,rho2,rho4){function zoom(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<1e-12)S=Math.log(w1/w0)/rho,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho,i=function(t){var x,s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*(x=rho*s+r0,((x=Math.exp(2*x))-1)/(x+1))-function(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}return i.duration=1e3*S*rho/Math.SQRT2,i}return zoom.rho=function(_){var _1=Math.max(.001,+_),_2=_1*_1;return zoomRho(_1,_2,_2*_2)},zoom}(Math.SQRT2,2,4);function hsl(hue){return function(start,end){var h=hue((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hsl$1=hsl(hue),hslLong=hsl(nogamma);function hcl(hue){return function(start,end){var h=hue((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hcl$1=hcl(hue),hclLong=hcl(nogamma);function cubehelix(hue){return function cubehelixGamma(y){function cubehelix(start,end){var h=hue((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix.gamma=cubehelixGamma,cubehelix}(1)}var cubehelix$1=cubehelix(hue),cubehelixLong=cubehelix(nogamma);exports.interpolate=value,exports.interpolateArray=function(a,b){return(isNumberArray(b)?numberArray:genericArray)(a,b)},exports.interpolateBasis=basis$1,exports.interpolateBasisClosed=basisClosed,exports.interpolateCubehelix=cubehelix$1,exports.interpolateCubehelixLong=cubehelixLong,exports.interpolateDate=date,exports.interpolateDiscrete=function(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}},exports.interpolateHcl=hcl$1,exports.interpolateHclLong=hclLong,exports.interpolateHsl=hsl$1,exports.interpolateHslLong=hslLong,exports.interpolateHue=function(a,b){var i=hue(+a,+b);return function(t){var x=i(t);return x-360*Math.floor(x/360)}},exports.interpolateLab=function(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.l=l(t),start.a=a(t),start.b=b(t),start.opacity=opacity(t),start+""}},exports.interpolateNumber=number,exports.interpolateNumberArray=numberArray,exports.interpolateObject=object,exports.interpolateRgb=rgb,exports.interpolateRgbBasis=rgbBasis,exports.interpolateRgbBasisClosed=rgbBasisClosed,exports.interpolateRound=function(a,b){return a=+a,b=+b,function(t){return Math.round(a*(1-t)+b*t)}},exports.interpolateString=string,exports.interpolateTransformCss=interpolateTransformCss,exports.interpolateTransformSvg=interpolateTransformSvg,exports.interpolateZoom=zoom,exports.piecewise=function(interpolate,values){void 0===values&&(values=interpolate,interpolate=value);for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}},exports.quantize=function(interpolator,n){for(var samples=new Array(n),i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(61))},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaUtil,d3Array,vegaStatistics,vegaProjection,d3Geo,d3Color,vegaCanvas){"use strict";function noop(){}const cases=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function contours(){var dx=1,dy=1,smooth=smoothLinear;function contours(values,tz){return tz.map(value=>contour(values,value))}function contour(values,value){var polygons=[],holes=[];return function(values,value,callback){var x,y,t0,t1,t2,t3,fragmentByStart=new Array,fragmentByEnd=new Array;for(x=y=-1,t1=values[0]>=value,cases[t1<<1].forEach(stitch);++x<dx-1;)t0=t1,t1=values[x+1]>=value,cases[t0|t1<<1].forEach(stitch);for(cases[t1<<0].forEach(stitch);++y<dy-1;){for(x=-1,t1=values[y*dx+dx]>=value,t2=values[y*dx]>=value,cases[t1<<1|t2<<2].forEach(stitch);++x<dx-1;)t0=t1,t1=values[y*dx+dx+x+1]>=value,t3=t2,t2=values[y*dx+x+1]>=value,cases[t0|t1<<1|t2<<2|t3<<3].forEach(stitch);cases[t1|t2<<3].forEach(stitch)}for(x=-1,t2=values[y*dx]>=value,cases[t2<<2].forEach(stitch);++x<dx-1;)t3=t2,t2=values[y*dx+x+1]>=value,cases[t2<<2|t3<<3].forEach(stitch);function stitch(line){var f,g,start=[line[0][0]+x,line[0][1]+y],end=[line[1][0]+x,line[1][1]+y],startIndex=index(start),endIndex=index(end);(f=fragmentByEnd[startIndex])?(g=fragmentByStart[endIndex])?(delete fragmentByEnd[f.end],delete fragmentByStart[g.start],f===g?(f.ring.push(end),callback(f.ring)):fragmentByStart[f.start]=fragmentByEnd[g.end]={start:f.start,end:g.end,ring:f.ring.concat(g.ring)}):(delete fragmentByEnd[f.end],f.ring.push(end),fragmentByEnd[f.end=endIndex]=f):(f=fragmentByStart[endIndex])?(g=fragmentByEnd[startIndex])?(delete fragmentByStart[f.start],delete fragmentByEnd[g.end],f===g?(f.ring.push(end),callback(f.ring)):fragmentByStart[g.start]=fragmentByEnd[f.end]={start:g.start,end:f.end,ring:g.ring.concat(f.ring)}):(delete fragmentByStart[f.start],f.ring.unshift(start),fragmentByStart[f.start=startIndex]=f):fragmentByStart[startIndex]=fragmentByEnd[endIndex]={start:startIndex,end:endIndex,ring:[start,end]}}cases[t2<<3].forEach(stitch)}(values,value,ring=>{smooth(ring,values,value),function(ring){for(var i=0,n=ring.length,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];++i<n;)area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];return area}(ring)>0?polygons.push([ring]):holes.push(ring)}),holes.forEach(hole=>{for(var polygon,i=0,n=polygons.length;i<n;++i)if(-1!==contains((polygon=polygons[i])[0],hole))return void polygon.push(hole)}),{type:"MultiPolygon",value:value,coordinates:polygons}}function index(point){return 2*point[0]+point[1]*(dx+1)*4}function smoothLinear(ring,values,value){ring.forEach(point=>{var v0,x=point[0],y=point[1],xt=0|x,yt=0|y,v1=values[yt*dx+xt];x>0&&x<dx&&xt===x&&(v0=values[yt*dx+xt-1],point[0]=x+(value-v0)/(v1-v0)-.5),y>0&&y<dy&&yt===y&&(v0=values[(yt-1)*dx+xt],point[1]=y+(value-v0)/(v1-v0)-.5)})}return contours.contour=contour,contours.size=function(_){if(!arguments.length)return[dx,dy];var _0=Math.floor(_[0]),_1=Math.floor(_[1]);return _0>=0&&_1>=0||vegaUtil.error("invalid size"),dx=_0,dy=_1,contours},contours.smooth=function(_){return arguments.length?(smooth=_?smoothLinear:noop,contours):smooth===smoothLinear},contours}function contains(ring,hole){for(var c,i=-1,n=hole.length;++i<n;)if(c=ringContains(ring,hole[i]))return c;return 0}function ringContains(ring,point){for(var x=point[0],y=point[1],contains=-1,i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];if(segmentContains(pi,pj,point))return 0;yi>y!=yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(contains=-contains)}return contains}function segmentContains(a,b,c){var i,p,q,r;return function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])==(c[0]-a[0])*(b[1]-a[1])}(a,b,c)&&(p=a[i=+(a[0]===b[0])],q=c[i],r=b[i],p<=q&&q<=r||r<=q&&q<=p)}function quantize(k,nice,zero){return function(values){var ex=vegaUtil.extent(values),start=zero?Math.min(ex[0],0):ex[0],stop=ex[1],span=stop-start,step=nice?d3Array.tickStep(start,stop,k):span/(k+1);return d3Array.range(start+step,stop,step)}}function Isocontour(params){vegaDataflow.Transform.call(this,null,params)}function transform(grid,sx,sy,tx,ty){const x1=grid.x1||0,y1=grid.y1||0,flip=sx*sy<0;function transformPolygon(coordinates){coordinates.forEach(transformRing)}function transformRing(coordinates){flip&&coordinates.reverse(),coordinates.forEach(transformPoint)}function transformPoint(coordinates){coordinates[0]=(coordinates[0]-x1)*sx+tx,coordinates[1]=(coordinates[1]-y1)*sy+ty}return function(geometry){return geometry.coordinates.forEach(transformPolygon),geometry}}function radius(bw,data,f){const v=bw>=0?bw:vegaStatistics.bandwidthNRD(data,f);return Math.round((Math.sqrt(4*v*v+1)-1)/2)}function number(_){return vegaUtil.isFunction(_)?_:vegaUtil.constant(+_)}function density2D(){var x=d=>d[0],y=d=>d[1],weight=vegaUtil.one,bandwidth=[-1,-1],dx=960,dy=500,k=2;function density(data,counts){const rx=radius(bandwidth[0],data,x)>>k,ry=radius(bandwidth[1],data,y)>>k,ox=rx?rx+2:0,oy=ry?ry+2:0,n=2*ox+(dx>>k),m=2*oy+(dy>>k),values0=new Float32Array(n*m),values1=new Float32Array(n*m);let values=values0;data.forEach(d=>{const xi=ox+(+x(d)>>k),yi=oy+(+y(d)>>k);xi>=0&&xi<n&&yi>=0&&yi<m&&(values0[xi+yi*n]+=+weight(d))}),rx>0&&ry>0?(blurX(n,m,values0,values1,rx),blurY(n,m,values1,values0,ry),blurX(n,m,values0,values1,rx),blurY(n,m,values1,values0,ry),blurX(n,m,values0,values1,rx),blurY(n,m,values1,values0,ry)):rx>0?(blurX(n,m,values0,values1,rx),blurX(n,m,values1,values0,rx),blurX(n,m,values0,values1,rx),values=values1):ry>0&&(blurY(n,m,values0,values1,ry),blurY(n,m,values1,values0,ry),blurY(n,m,values0,values1,ry),values=values1);const s=counts?Math.pow(2,-2*k):1/d3Array.sum(values);for(let i=0,sz=n*m;i<sz;++i)values[i]*=s;return{values:values,scale:1<<k,width:n,height:m,x1:ox,y1:oy,x2:ox+(dx>>k),y2:oy+(dy>>k)}}return density.x=function(_){return arguments.length?(x=number(_),density):x},density.y=function(_){return arguments.length?(y=number(_),density):y},density.weight=function(_){return arguments.length?(weight=number(_),density):weight},density.size=function(_){if(!arguments.length)return[dx,dy];var _0=+_[0],_1=+_[1];return _0>=0&&_1>=0||vegaUtil.error("invalid size"),dx=_0,dy=_1,density},density.cellSize=function(_){return arguments.length?((_=+_)>=1||vegaUtil.error("invalid cell size"),k=Math.floor(Math.log(_)/Math.LN2),density):1<<k},density.bandwidth=function(_){return arguments.length?(1===(_=vegaUtil.array(_)).length&&(_=[+_[0],+_[0]]),2!==_.length&&vegaUtil.error("invalid bandwidth"),bandwidth=_,density):bandwidth},density}function blurX(n,m,source,target,r){const w=1+(r<<1);for(let j=0;j<m;++j)for(let i=0,sr=0;i<n+r;++i)i<n&&(sr+=source[i+j*n]),i>=r&&(i>=w&&(sr-=source[i-w+j*n]),target[i-r+j*n]=sr/Math.min(i+1,n-1+w-i,w))}function blurY(n,m,source,target,r){const w=1+(r<<1);for(let i=0;i<n;++i)for(let j=0,sr=0;j<m+r;++j)j<m&&(sr+=source[i+j*n]),j>=r&&(j>=w&&(sr-=source[i+(j-w)*n]),target[i+(j-r)*n]=sr/Math.min(j+1,m-1+w-j,w))}function KDE2D(params){vegaDataflow.Transform.call(this,null,params)}Isocontour.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},vegaUtil.inherits(Isocontour,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!pulse.changed()&&!_.modified())return pulse.StopPropagation;var out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),source=pulse.materialize(pulse.SOURCE).source,field=_.field||vegaUtil.identity,contour=contours().smooth(!1!==_.smooth),tz=_.thresholds||function(values,f,_){const q=quantize(_.levels||10,_.nice,!1!==_.zero);return"shared"!==_.resolve?q:q(values.map(t=>d3Array.max(f(t).values)))}(source,field,_),as=null===_.as?null:_.as||"contour",values=[];return source.forEach(t=>{const grid=field(t),paths=contour.size([grid.width,grid.height])(grid.values,vegaUtil.isArray(tz)?tz:tz(grid.values));!function(paths,grid,datum,_){let s=_.scale||grid.scale,t=_.translate||grid.translate;if(vegaUtil.isFunction(s)&&(s=s(datum,_)),vegaUtil.isFunction(t)&&(t=t(datum,_)),(1===s||null==s)&&!t)return;const sx=(vegaUtil.isNumber(s)?s:s[0])||1,sy=(vegaUtil.isNumber(s)?s:s[1])||1,tx=t&&t[0]||0,ty=t&&t[1]||0;paths.forEach(transform(grid,sx,sy,tx,ty))}(paths,grid,t,_),paths.forEach(p=>{values.push(vegaDataflow.rederive(t,vegaDataflow.ingest(null!=as?{[as]:p}:p)))})}),this.value&&(out.rem=this.value),this.value=out.source=out.add=values,out}}),KDE2D.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const PARAMS=["x","y","weight","size","cellSize","bandwidth"];function params(obj,_){return PARAMS.forEach(param=>null!=_[param]?obj[param](_[param]):0),obj}function Contour(params){vegaDataflow.Transform.call(this,null,params)}function GeoJSON(params){vegaDataflow.Transform.call(this,null,params)}function GeoPath(params){vegaDataflow.Transform.call(this,null,params)}function GeoPoint(params){vegaDataflow.Transform.call(this,null,params)}function GeoShape(params){vegaDataflow.Transform.call(this,null,params)}function Graticule(params){vegaDataflow.Transform.call(this,[],params),this.generator=d3Geo.geoGraticule()}function Heatmap(params){vegaDataflow.Transform.call(this,null,params)}function dependency(f){if(!vegaUtil.isFunction(f))return!1;const set=vegaUtil.toSet(vegaUtil.accessorFields(f));return set.$x||set.$y||set.$value||set.$max}function Projection(params){vegaDataflow.Transform.call(this,null,params),this.modified(!0)}function fit(proj,_){const data=function(data){return 1===(data=vegaUtil.array(data)).length?data[0]:{type:"FeatureCollection",features:data.reduce((a,f)=>a.concat(function(f){return"FeatureCollection"===f.type?f.features:vegaUtil.array(f).filter(d=>null!=d).map(d=>"Feature"===d.type?d:{type:"Feature",geometry:d})}(f)),[])}}(_.fit);_.extent?proj.fitExtent(_.extent,data):_.size&&proj.fitSize(_.size,data)}function set(proj,key,value){vegaUtil.isFunction(proj[key])&&proj[key](value)}vegaUtil.inherits(KDE2D,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!pulse.changed()&&!_.modified())return pulse.StopPropagation;var values,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),groups=function(data,groupby){var map,i,n,t,k,g,groups=[],get=f=>f(t);if(null==groupby)groups.push(data);else for(map={},i=0,n=data.length;i<n;++i)t=data[i],(g=map[k=groupby.map(get)])||(map[k]=g=[],g.dims=k,groups.push(g)),g.push(t);return groups}(pulse.materialize(pulse.SOURCE).source,_.groupby),names=(_.groupby||[]).map(vegaUtil.accessorName),kde=params(density2D(),_),as=_.as||"grid";return values=groups.map(g=>vegaDataflow.ingest(function(t,vals){for(let i=0;i<names.length;++i)t[names[i]]=vals[i];return t}({[as]:kde(g,_.counts)},g.dims))),this.value&&(out.rem=this.value),this.value=out.source=out.add=values,out}}),Contour.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},vegaUtil.inherits(Contour,vegaDataflow.Transform,{transform(_,pulse){if(this.value&&!pulse.changed()&&!_.modified())return pulse.StopPropagation;var grid,post,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),contour=contours().smooth(!1!==_.smooth),values=_.values,thresh=_.thresholds||quantize(_.count||10,_.nice,!!values),size=_.size;return values||(values=pulse.materialize(pulse.SOURCE).source,post=transform(grid=params(density2D(),_)(values,!0),grid.scale||1,grid.scale||1,0,0),size=[grid.width,grid.height],values=grid.values),thresh=vegaUtil.isArray(thresh)?thresh:thresh(values),values=contour.size(size)(values,thresh),post&&values.forEach(post),this.value&&(out.rem=this.value),this.value=out.source=out.add=(values||[]).map(vegaDataflow.ingest),out}}),GeoJSON.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},vegaUtil.inherits(GeoJSON,vegaDataflow.Transform,{transform(_,pulse){var mod,features=this._features,points=this._points,fields=_.fields,lon=fields&&fields[0],lat=fields&&fields[1],geojson=_.geojson||!fields&&vegaUtil.identity,flag=pulse.ADD;mod=_.modified()||pulse.changed(pulse.REM)||pulse.modified(vegaUtil.accessorFields(geojson))||lon&&pulse.modified(vegaUtil.accessorFields(lon))||lat&&pulse.modified(vegaUtil.accessorFields(lat)),this.value&&!mod||(flag=pulse.SOURCE,this._features=features=[],this._points=points=[]),geojson&&pulse.visit(flag,t=>features.push(geojson(t))),lon&&lat&&(pulse.visit(flag,t=>{var x=lon(t),y=lat(t);null!=x&&null!=y&&(x=+x)===x&&(y=+y)===y&&points.push([x,y])}),features=features.concat({type:"Feature",geometry:{type:"MultiPoint",coordinates:points}})),this.value={type:"FeatureCollection",features:features}}}),GeoPath.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},vegaUtil.inherits(GeoPath,vegaDataflow.Transform,{transform(_,pulse){var out=pulse.fork(pulse.ALL),path=this.value,field=_.field||vegaUtil.identity,as=_.as||"path",flag=out.SOURCE;!path||_.modified()?(this.value=path=vegaProjection.getProjectionPath(_.projection),out.materialize().reflow()):flag=field===vegaUtil.identity||pulse.modified(field.fields)?out.ADD_MOD:out.ADD;const prev=function(path,pointRadius){const prev=path.pointRadius();return path.context(null),null!=pointRadius&&path.pointRadius(pointRadius),prev}(path,_.pointRadius);return out.visit(flag,t=>t[as]=path(field(t))),path.pointRadius(prev),out.modifies(as)}}),GeoPoint.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},vegaUtil.inherits(GeoPoint,vegaDataflow.Transform,{transform(_,pulse){var mod,proj=_.projection,lon=_.fields[0],lat=_.fields[1],as=_.as||["x","y"],x=as[0],y=as[1];function set(t){const xy=proj([lon(t),lat(t)]);xy?(t[x]=xy[0],t[y]=xy[1]):(t[x]=void 0,t[y]=void 0)}return _.modified()?pulse=pulse.materialize().reflow(!0).visit(pulse.SOURCE,set):(mod=pulse.modified(lon.fields)||pulse.modified(lat.fields),pulse.visit(mod?pulse.ADD_MOD:pulse.ADD,set)),pulse.modifies(as)}}),GeoShape.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},vegaUtil.inherits(GeoShape,vegaDataflow.Transform,{transform(_,pulse){var out=pulse.fork(pulse.ALL),shape=this.value,as=_.as||"shape",flag=out.ADD;return shape&&!_.modified()||(this.value=shape=function(path,field,pointRadius){const shape=null==pointRadius?_=>path(field(_)):_=>{var prev=path.pointRadius(),value=path.pointRadius(pointRadius)(field(_));return path.pointRadius(prev),value};return shape.context=_=>(path.context(_),shape),shape}(vegaProjection.getProjectionPath(_.projection),_.field||vegaUtil.field("datum"),_.pointRadius),out.materialize().reflow(),flag=out.SOURCE),out.visit(flag,t=>t[as]=shape),out.modifies(as)}}),Graticule.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},vegaUtil.inherits(Graticule,vegaDataflow.Transform,{transform(_,pulse){var t,src=this.value,gen=this.generator;if(!src.length||_.modified())for(const prop in _)vegaUtil.isFunction(gen[prop])&&gen[prop](_[prop]);return t=gen(),src.length?pulse.mod.push(vegaDataflow.replace(src[0],t)):pulse.add.push(vegaDataflow.ingest(t)),src[0]=t,pulse}}),Heatmap.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},vegaUtil.inherits(Heatmap,vegaDataflow.Transform,{transform(_,pulse){if(!pulse.changed()&&!_.modified())return pulse.StopPropagation;var source=pulse.materialize(pulse.SOURCE).source,shared="shared"===_.resolve,field=_.field||vegaUtil.identity,opacity=function(opacity,_){let f;return vegaUtil.isFunction(opacity)?(f=obj=>opacity(obj,_),f.dep=dependency(opacity)):opacity?f=vegaUtil.constant(opacity):(f=obj=>obj.$value/obj.$max||0,f.dep=!0),f}(_.opacity,_),color=function(color,_){let f;return vegaUtil.isFunction(color)?(f=obj=>d3Color.rgb(color(obj,_)),f.dep=dependency(color)):f=vegaUtil.constant(d3Color.rgb(color||"#888")),f}(_.color,_),as=_.as||"image",obj={$x:0,$y:0,$value:0,$max:shared?d3Array.max(source.map(t=>d3Array.max(field(t).values))):0};return source.forEach(t=>{const v=field(t),o=vegaUtil.extend({},t,obj);shared||(o.$max=d3Array.max(v.values||[])),t[as]=function(grid,obj,color,opacity){const n=grid.width,m=grid.height,x1=grid.x1||0,y1=grid.y1||0,x2=grid.x2||n,y2=grid.y2||m,val=grid.values,value=val?i=>val[i]:vegaUtil.zero,can=vegaCanvas.canvas(x2-x1,y2-y1),ctx=can.getContext("2d"),img=ctx.getImageData(0,0,x2-x1,y2-y1),pix=img.data;for(let j=y1,k=0;j<y2;++j){obj.$y=j-y1;for(let i=x1,r=j*n;i<x2;++i,k+=4){obj.$x=i-x1,obj.$value=value(i+r);const v=color(obj);pix[k+0]=v.r,pix[k+1]=v.g,pix[k+2]=v.b,pix[k+3]=~~(255*opacity(obj))}}return ctx.putImageData(img,0,0),can}(v,o,color.dep?color:vegaUtil.constant(color(o)),opacity.dep?opacity:vegaUtil.constant(opacity(o)))}),pulse.reflow(!0).modifies(as)}}),vegaUtil.inherits(Projection,vegaDataflow.Transform,{transform(_,pulse){let proj=this.value;return!proj||_.modified("type")?(this.value=proj=function(type){const constructor=vegaProjection.projection((type||"mercator").toLowerCase());return constructor||vegaUtil.error("Unrecognized projection type: "+type),constructor()}(_.type),vegaProjection.projectionProperties.forEach(prop=>{null!=_[prop]&&set(proj,prop,_[prop])})):vegaProjection.projectionProperties.forEach(prop=>{_.modified(prop)&&set(proj,prop,_[prop])}),null!=_.pointRadius&&proj.path.pointRadius(_.pointRadius),_.fit&&fit(proj,_),pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)}}),exports.contour=Contour,exports.geojson=GeoJSON,exports.geopath=GeoPath,exports.geopoint=GeoPoint,exports.geoshape=GeoShape,exports.graticule=Graticule,exports.heatmap=Heatmap,exports.isocontour=Isocontour,exports.kde2d=KDE2D,exports.projection=Projection,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(37),__webpack_require__(109),__webpack_require__(44),__webpack_require__(76),__webpack_require__(52),__webpack_require__(113),__webpack_require__(58))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,d3Geo,d3Array){"use strict";var abs=Math.abs,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,exp=Math.exp,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,round=Math.round,sign=Math.sign||function(x){return x>0?1:x<0?-1:0},sin=Math.sin,tan=Math.tan,epsilon=1e-6,pi=Math.PI,halfPi=pi/2,quarterPi=pi/4,sqrt1_2=Math.SQRT1_2,sqrt2=sqrt(2),sqrtPi=sqrt(pi),tau=2*pi,degrees=180/pi,radians=pi/180;function asin(x){return x>1?halfPi:x<-1?-halfPi:Math.asin(x)}function acos(x){return x>1?0:x<-1?pi:Math.acos(x)}function sqrt(x){return x>0?Math.sqrt(x):0}function sinh(x){return(exp(x)-exp(-x))/2}function cosh(x){return(exp(x)+exp(-x))/2}function airyRaw(beta){var tanBeta_2=tan(beta/2),b=2*log(cos(beta/2))/(tanBeta_2*tanBeta_2);function forward(x,y){var cosx=cos(x),cosy=cos(y),siny=sin(y),cosz=cosy*cosx,k=-((1-cosz?log((1+cosz)/2)/(1-cosz):-.5)+b/(1+cosz));return[k*cosy*sin(x),k*siny]}return forward.invert=function(x,y){var delta,r=sqrt(x*x+y*y),z=-beta/2,i=50;if(!r)return[0,0];do{var z_2=z/2,cosz_2=cos(z_2),sinz_2=sin(z_2),tanz_2=sinz_2/cosz_2,lnsecz_2=-log(abs(cosz_2));z-=delta=(2/tanz_2*lnsecz_2-b*tanz_2-r)/(-lnsecz_2/(sinz_2*sinz_2)+1-b/(2*cosz_2*cosz_2))*(cosz_2<0?.7:1)}while(abs(delta)>epsilon&&--i>0);var sinz=sin(z);return[atan2(x*sinz,r*cos(z)),asin(y*sinz/r)]},forward}function aitoffRaw(x,y){var cosy=cos(y),sincia=function(x){return x?x/Math.sin(x):1}(acos(cosy*cos(x/=2)));return[2*cosy*sin(x)*sincia,sin(y)*sincia]}function armadilloRaw(phi0){var sinPhi0=sin(phi0),cosPhi0=cos(phi0),sPhi0=phi0>=0?1:-1,tanPhi0=tan(sPhi0*phi0),k=(1+sinPhi0-cosPhi0)/2;function forward(lambda,phi){var cosPhi=cos(phi),cosLambda=cos(lambda/=2);return[(1+cosPhi)*sin(lambda),(sPhi0*phi>-atan2(cosLambda,tanPhi0)-.001?0:10*-sPhi0)+k+sin(phi)*cosPhi0-(1+cosPhi)*sinPhi0*cosLambda]}return forward.invert=function(x,y){var lambda=0,phi=0,i=50;do{var cosLambda=cos(lambda),sinLambda=sin(lambda),cosPhi=cos(phi),sinPhi=sin(phi),A=1+cosPhi,fx=A*sinLambda-x,fy=k+sinPhi*cosPhi0-A*sinPhi0*cosLambda-y,dxdLambda=A*cosLambda/2,dxdPhi=-sinLambda*sinPhi,dydLambda=sinPhi0*A*sinLambda/2,dydPhi=cosPhi0*cosPhi+sinPhi0*cosLambda*sinPhi,denominator=dxdPhi*dydLambda-dydPhi*dxdLambda,dLambda=(fy*dxdPhi-fx*dydPhi)/denominator/2,dPhi=(fx*dydLambda-fy*dxdLambda)/denominator;abs(dPhi)>2&&(dPhi/=2),lambda-=dLambda,phi-=dPhi}while((abs(dLambda)>epsilon||abs(dPhi)>epsilon)&&--i>0);return sPhi0*phi>-atan2(cos(lambda),tanPhi0)-.001?[2*lambda,phi]:null},forward}function augustRaw(lambda,phi){var tanPhi=tan(phi/2),k=sqrt(1-tanPhi*tanPhi),c=1+k*cos(lambda/=2),x=sin(lambda)*k/c,y=tanPhi/c,x2=x*x,y2=y*y;return[4/3*x*(3+x2-3*y2),4/3*y*(3+3*x2-y2)]}aitoffRaw.invert=function(x,y){if(!(x*x+4*y*y>pi*pi+epsilon)){var x1=x,y1=y,i=25;do{var f,sinx=sin(x1),sinx_2=sin(x1/2),cosx_2=cos(x1/2),siny=sin(y1),cosy=cos(y1),sin_2y=sin(2*y1),sin2y=siny*siny,cos2y=cosy*cosy,sin2x_2=sinx_2*sinx_2,c=1-cos2y*cosx_2*cosx_2,e=c?acos(cosy*cosx_2)*sqrt(f=1/c):f=0,fx=2*e*cosy*sinx_2-x,fy=e*siny-y,dxdx=f*(cos2y*sin2x_2+e*cosy*cosx_2*sin2y),dxdy=f*(.5*sinx*sin_2y-2*e*siny*sinx_2),dydx=.25*f*(sin_2y*sinx_2-e*siny*cos2y*sinx),dydy=f*(sin2y*cosx_2+e*sin2x_2*cosy),z=dxdy*dydx-dydy*dxdx;if(!z)break;var dx=(fy*dxdy-fx*dydy)/z,dy=(fx*dydx-fy*dxdx)/z;x1-=dx,y1-=dy}while((abs(dx)>epsilon||abs(dy)>epsilon)&&--i>0);return[x1,y1]}},augustRaw.invert=function(x,y){if(y*=3/8,!(x*=3/8)&&abs(y)>1)return null;var s=1+x*x+y*y,sin3Eta=sqrt((s-sqrt(s*s-4*y*y))/2),eta=asin(sin3Eta)/3,xi=sin3Eta?function(x){return log(x+sqrt(x*x-1))}(abs(y/sin3Eta))/3:function(x){return log(x+sqrt(x*x+1))}(abs(x))/3,cosEta=cos(eta),coshXi=cosh(xi),d=coshXi*coshXi-cosEta*cosEta;return[2*sign(x)*atan2(sinh(xi)*cosEta,.25-d),2*sign(y)*atan2(coshXi*sin(eta),.25+d)]};var sqrt8=sqrt(8),phi0=log(1+sqrt2);function bakerRaw(lambda,phi){var phi0=abs(phi);return phi0<quarterPi?[lambda,log(tan(quarterPi+phi/2))]:[lambda*cos(phi0)*(2*sqrt2-1/sin(phi0)),sign(phi)*(2*sqrt2*(phi0-quarterPi)-log(tan(phi0/2)))]}function berghausRaw(lobes){var k=2*pi/lobes;function forward(lambda,phi){var p=d3Geo.geoAzimuthalEquidistantRaw(lambda,phi);if(abs(lambda)>halfPi){var theta=atan2(p[1],p[0]),r=sqrt(p[0]*p[0]+p[1]*p[1]),theta0=k*round((theta-halfPi)/k)+halfPi,alpha=atan2(sin(theta-=theta0),2-cos(theta));theta=theta0+asin(pi/r*sin(alpha))-alpha,p[0]=r*cos(theta),p[1]=r*sin(theta)}return p}return forward.invert=function(x,y){var r=sqrt(x*x+y*y);if(r>halfPi){var theta=atan2(y,x),theta0=k*round((theta-halfPi)/k)+halfPi,s=theta>theta0?-1:1,A=r*cos(theta0-theta),cotAlpha=1/tan(s*acos((A-pi)/sqrt(pi*(pi-2*A)+r*r)));theta=theta0+2*atan((cotAlpha+s*sqrt(cotAlpha*cotAlpha-3))/3),x=r*cos(theta),y=r*sin(theta)}return d3Geo.geoAzimuthalEquidistantRaw.invert(x,y)},forward}function hammerRaw(A,B){if(arguments.length<2&&(B=A),1===B)return d3Geo.geoAzimuthalEqualAreaRaw;if(B===1/0)return hammerQuarticAuthalicRaw;function forward(lambda,phi){var coordinates=d3Geo.geoAzimuthalEqualAreaRaw(lambda/B,phi);return coordinates[0]*=A,coordinates}return forward.invert=function(x,y){var coordinates=d3Geo.geoAzimuthalEqualAreaRaw.invert(x/A,y);return coordinates[0]*=B,coordinates},forward}function hammerQuarticAuthalicRaw(lambda,phi){return[lambda*cos(phi)/cos(phi/=2),2*sin(phi)]}function solve(f,y,x){var delta,f0,f1,steps=100;x=void 0===x?0:+x,y=+y;do{(f0=f(x))===(f1=f(x+epsilon))&&(f1=f0+epsilon),x-=delta=-1*epsilon*(f0-y)/(f0-f1)}while(steps-- >0&&abs(delta)>epsilon);return steps<0?NaN:x}function solve2d(f,MAX_ITERATIONS,eps){return void 0===MAX_ITERATIONS&&(MAX_ITERATIONS=40),void 0===eps&&(eps=1e-12),function(x,y,a,b){var err2,da,db;a=void 0===a?0:+a,b=void 0===b?0:+b;for(var i=0;i<MAX_ITERATIONS;i++){var p=f(a,b),tx=p[0]-x,ty=p[1]-y;if(abs(tx)<eps&&abs(ty)<eps)break;var h=tx*tx+ty*ty;if(h>err2)a-=da/=2,b-=db/=2;else{err2=h;var ea=(a>0?-1:1)*eps,eb=(b>0?-1:1)*eps,pa=f(a+ea,b),pb=f(a,b+eb),dxa=(pa[0]-p[0])/ea,dya=(pa[1]-p[1])/ea,dxb=(pb[0]-p[0])/eb,dyb=(pb[1]-p[1])/eb,D=dyb*dxa-dya*dxb,l=(abs(D)<.5?.5:1)/D;if(a+=da=(ty*dxb-tx*dyb)*l,b+=db=(tx*dya-ty*dxa)*l,abs(da)<eps&&abs(db)<eps)break}}return[a,b]}}function bertin1953Raw(){var hammer$$1=hammerRaw(1.68,2);function forward(lambda,phi){if(lambda+phi<-1.4){var u=(lambda-phi+1.6)*(lambda+phi+1.4)/8;lambda+=u,phi-=.8*u*sin(phi+pi/2)}var r=hammer$$1(lambda,phi),d=(1-cos(lambda*phi))/12;return r[1]<0&&(r[0]*=1+d),r[1]>0&&(r[1]*=1+d/1.5*r[0]*r[0]),r}return forward.invert=solve2d(forward),forward}function mollweideBromleyTheta(cp,phi){var delta,cpsinPhi=cp*sin(phi),i=30;do{phi-=delta=(phi+sin(phi)-cpsinPhi)/(1+cos(phi))}while(abs(delta)>epsilon&&--i>0);return phi/2}function mollweideBromleyRaw(cx,cy,cp){function forward(lambda,phi){return[cx*lambda*cos(phi=mollweideBromleyTheta(cp,phi)),cy*sin(phi)]}return forward.invert=function(x,y){return y=asin(y/cy),[x/(cx*cos(y)),asin((2*y+sin(2*y))/cp)]},forward}bakerRaw.invert=function(x,y){if((y0=abs(y))<phi0)return[x,2*atan(exp(y))-halfPi];var delta,y0,phi=quarterPi,i=25;do{var cosPhi_2=cos(phi/2),tanPhi_2=tan(phi/2);phi-=delta=(sqrt8*(phi-quarterPi)-log(tanPhi_2)-y0)/(sqrt8-cosPhi_2*cosPhi_2/(2*tanPhi_2))}while(abs(delta)>1e-12&&--i>0);return[x/(cos(phi)*(sqrt8-1/sin(phi))),sign(y)*phi]},hammerQuarticAuthalicRaw.invert=function(x,y){var phi=2*asin(y/2);return[x*cos(phi/2)/cos(phi),phi]};var mollweideRaw=mollweideBromleyRaw(sqrt2/halfPi,sqrt2,pi),k=2.00276,w=1.11072;function boggsRaw(lambda,phi){var theta=mollweideBromleyTheta(pi,phi);return[k*lambda/(1/cos(phi)+w/cos(theta)),(phi+sqrt2*sin(theta))/k]}function parallel1(projectAt){var phi0=0,m=d3Geo.geoProjectionMutator(projectAt),p=m(phi0);return p.parallel=function(_){return arguments.length?m(phi0=_*radians):phi0*degrees},p}function sinusoidalRaw(lambda,phi){return[lambda*cos(phi),phi]}function bonneRaw(phi0){if(!phi0)return sinusoidalRaw;var cotPhi0=1/tan(phi0);function forward(lambda,phi){var rho=cotPhi0+phi0-phi,e=rho?lambda*cos(phi)/rho:rho;return[rho*sin(e),cotPhi0-rho*cos(e)]}return forward.invert=function(x,y){var rho=sqrt(x*x+(y=cotPhi0-y)*y),phi=cotPhi0+phi0-rho;return[rho/cos(phi)*atan2(x,y),phi]},forward}function bottomleyRaw(sinPsi){function forward(lambda,phi){var rho=halfPi-phi,eta=rho?lambda*sinPsi*sin(rho)/rho:rho;return[rho*sin(eta)/sinPsi,halfPi-rho*cos(eta)]}return forward.invert=function(x,y){var x1=x*sinPsi,y1=halfPi-y,rho=sqrt(x1*x1+y1*y1),eta=atan2(x1,y1);return[(rho?rho/sin(rho):1)*eta/sinPsi,halfPi-rho]},forward}boggsRaw.invert=function(x,y){var delta,phi,ky=k*y,theta=y<0?-quarterPi:quarterPi,i=25;do{phi=ky-sqrt2*sin(theta),theta-=delta=(sin(2*theta)+2*theta-pi*sin(phi))/(2*cos(2*theta)+2+pi*cos(phi)*sqrt2*cos(theta))}while(abs(delta)>epsilon&&--i>0);return phi=ky-sqrt2*sin(theta),[x*(1/cos(phi)+w/cos(theta))/k,phi]},sinusoidalRaw.invert=function(x,y){return[x/cos(y),y]};var bromleyRaw=mollweideBromleyRaw(1,4/pi,pi);function distance(dPhi,c1,s1,c2,s2,dLambda){var r,cosdLambda=cos(dLambda);if(abs(dPhi)>1||abs(dLambda)>1)r=acos(s1*s2+c1*c2*cosdLambda);else{var sindPhi=sin(dPhi/2),sindLambda=sin(dLambda/2);r=2*asin(sqrt(sindPhi*sindPhi+c1*c2*sindLambda*sindLambda))}return abs(r)>epsilon?[r,atan2(c2*sin(dLambda),c1*s2-s1*c2*cosdLambda)]:[0,0]}function angle(b,c,a){return acos((b*b+c*c-a*a)/(2*b*c))}function longitude(lambda){return lambda-2*pi*floor((lambda+pi)/(2*pi))}function chamberlinRaw(p0,p1,p2){for(var b,points=[[p0[0],p0[1],sin(p0[1]),cos(p0[1])],[p1[0],p1[1],sin(p1[1]),cos(p1[1])],[p2[0],p2[1],sin(p2[1]),cos(p2[1])]],a=points[2],i=0;i<3;++i,a=b)b=points[i],a.v=distance(b[1]-a[1],a[3],a[2],b[3],b[2],b[0]-a[0]),a.point=[0,0];var beta0=angle(points[0].v[0],points[2].v[0],points[1].v[0]),beta1=angle(points[0].v[0],points[1].v[0],points[2].v[0]),beta2=pi-beta0;points[2].point[1]=0,points[0].point[0]=-(points[1].point[0]=points[0].v[0]/2);var mean=[points[2].point[0]=points[0].point[0]+points[2].v[0]*cos(beta0),2*(points[0].point[1]=points[1].point[1]=points[2].v[0]*sin(beta0))];return function(lambda,phi){var i,sinPhi=sin(phi),cosPhi=cos(phi),v=new Array(3);for(i=0;i<3;++i){var p=points[i];if(v[i]=distance(phi-p[1],p[3],p[2],cosPhi,sinPhi,lambda-p[0]),!v[i][0])return p.point;v[i][1]=longitude(v[i][1]-p.v[1])}var point=mean.slice();for(i=0;i<3;++i){var j=2==i?0:i+1,a=angle(points[i].v[0],v[i][0],v[j][0]);v[i][1]<0&&(a=-a),i?1==i?(a=beta1-a,point[0]-=v[i][0]*cos(a),point[1]-=v[i][0]*sin(a)):(a=beta2-a,point[0]+=v[i][0]*cos(a),point[1]+=v[i][0]*sin(a)):(point[0]+=v[i][0]*cos(a),point[1]-=v[i][0]*sin(a))}return point[0]/=3,point[1]/=3,point}}function pointRadians(p){return p[0]*=radians,p[1]*=radians,p}function chamberlin(p0,p1,p2){var c=d3Geo.geoCentroid({type:"MultiPoint",coordinates:[p0,p1,p2]}),R=[-c[0],-c[1]],r=d3Geo.geoRotation(R),f=chamberlinRaw(pointRadians(r(p0)),pointRadians(r(p1)),pointRadians(r(p2)));f.invert=solve2d(f);var p=d3Geo.geoProjection(f).rotate(R),center=p.center;return delete p.rotate,p.center=function(_){return arguments.length?center(r(_)):r.invert(center())},p.clipAngle(90)}function collignonRaw(lambda,phi){var alpha=sqrt(1-sin(phi));return[2/sqrtPi*lambda*alpha,sqrtPi*(1-alpha)]}function craigRaw(phi0){var tanPhi0=tan(phi0);function forward(lambda,phi){return[lambda,(lambda?lambda/sin(lambda):1)*(sin(phi)*cos(lambda)-tanPhi0*cos(phi))]}return forward.invert=tanPhi0?function(x,y){x&&(y*=sin(x)/x);var cosLambda=cos(x);return[x,2*atan2(sqrt(cosLambda*cosLambda+tanPhi0*tanPhi0-y*y)-cosLambda,tanPhi0-y)]}:function(x,y){return[x,asin(x?y*tan(x)/x:y)]},forward}collignonRaw.invert=function(x,y){var lambda=(lambda=y/sqrtPi-1)*lambda;return[lambda>0?x*sqrt(pi/lambda)/2:0,asin(1-lambda)]};var sqrt3=sqrt(3);function crasterRaw(lambda,phi){return[sqrt3*lambda*(2*cos(2*phi/3)-1)/sqrtPi,sqrt3*sqrtPi*sin(phi/3)]}function cylindricalEqualAreaRaw(phi0){var cosPhi0=cos(phi0);function forward(lambda,phi){return[lambda*cosPhi0,sin(phi)/cosPhi0]}return forward.invert=function(x,y){return[x/cosPhi0,asin(y*cosPhi0)]},forward}function cylindricalStereographicRaw(phi0){var cosPhi0=cos(phi0);function forward(lambda,phi){return[lambda*cosPhi0,(1+cosPhi0)*tan(phi/2)]}return forward.invert=function(x,y){return[x/cosPhi0,2*atan(y/(1+cosPhi0))]},forward}function eckert1Raw(lambda,phi){var alpha=sqrt(8/(3*pi));return[alpha*lambda*(1-abs(phi)/pi),alpha*phi]}function eckert2Raw(lambda,phi){var alpha=sqrt(4-3*sin(abs(phi)));return[2/sqrt(6*pi)*lambda*alpha,sign(phi)*sqrt(2*pi/3)*(2-alpha)]}function eckert3Raw(lambda,phi){var k=sqrt(pi*(4+pi));return[2/k*lambda*(1+sqrt(1-4*phi*phi/(pi*pi))),4/k*phi]}function eckert4Raw(lambda,phi){var k=(2+halfPi)*sin(phi);phi/=2;for(var i=0,delta=1/0;i<10&&abs(delta)>epsilon;i++){var cosPhi=cos(phi);phi-=delta=(phi+sin(phi)*(cosPhi+2)-k)/(2*cosPhi*(1+cosPhi))}return[2/sqrt(pi*(4+pi))*lambda*(1+cos(phi)),2*sqrt(pi/(4+pi))*sin(phi)]}function eckert5Raw(lambda,phi){return[lambda*(1+cos(phi))/sqrt(2+pi),2*phi/sqrt(2+pi)]}function eckert6Raw(lambda,phi){for(var k=(1+halfPi)*sin(phi),i=0,delta=1/0;i<10&&abs(delta)>epsilon;i++)phi-=delta=(phi+sin(phi)-k)/(1+cos(phi));return k=sqrt(2+pi),[lambda*(1+cos(phi))/k,2*phi/k]}crasterRaw.invert=function(x,y){var phi=3*asin(y/(sqrt3*sqrtPi));return[sqrtPi*x/(sqrt3*(2*cos(2*phi/3)-1)),phi]},eckert1Raw.invert=function(x,y){var alpha=sqrt(8/(3*pi)),phi=y/alpha;return[x/(alpha*(1-abs(phi)/pi)),phi]},eckert2Raw.invert=function(x,y){var alpha=2-abs(y)/sqrt(2*pi/3);return[x*sqrt(6*pi)/(2*alpha),sign(y)*asin((4-alpha*alpha)/3)]},eckert3Raw.invert=function(x,y){var k=sqrt(pi*(4+pi))/2;return[x*k/(1+sqrt(1-y*y*(4+pi)/(4*pi))),y*k/2]},eckert4Raw.invert=function(x,y){var A=y*sqrt((4+pi)/pi)/2,k=asin(A),c=cos(k);return[x/(2/sqrt(pi*(4+pi))*(1+c)),asin((k+A*(c+2))/(2+halfPi))]},eckert5Raw.invert=function(x,y){var k=sqrt(2+pi),phi=y*k/2;return[k*x/(1+cos(phi)),phi]},eckert6Raw.invert=function(x,y){var j=1+halfPi,k=sqrt(j/2);return[2*x*k/(1+cos(y*=k)),asin((y+sin(y))/j)]};var eisenlohrK=3+2*sqrt2;function eisenlohrRaw(lambda,phi){var s0=sin(lambda/=2),c0=cos(lambda),k=sqrt(cos(phi)),c1=cos(phi/=2),t=sin(phi)/(c1+sqrt2*c0*k),c=sqrt(2/(1+t*t)),v=sqrt((sqrt2*c1+(c0+s0)*k)/(sqrt2*c1+(c0-s0)*k));return[eisenlohrK*(c*(v-1/v)-2*log(v)),eisenlohrK*(c*t*(v+1/v)-2*atan(t))]}eisenlohrRaw.invert=function(x,y){if(!(p=augustRaw.invert(x/1.2,1.065*y)))return null;var p,lambda=p[0],phi=p[1],i=20;x/=eisenlohrK,y/=eisenlohrK;do{var _0=lambda/2,_1=phi/2,s0=sin(_0),c0=cos(_0),s1=sin(_1),c1=cos(_1),cos1=cos(phi),k=sqrt(cos1),t=s1/(c1+sqrt2*c0*k),t2=t*t,c=sqrt(2/(1+t2)),v2=(sqrt2*c1+(c0+s0)*k)/(sqrt2*c1+(c0-s0)*k),v=sqrt(v2),vm1v=v-1/v,vp1v=v+1/v,fx=c*vm1v-2*log(v)-x,fy=c*t*vp1v-2*atan(t)-y,deltatDeltaLambda=s1&&sqrt1_2*k*s0*t2/s1,deltatDeltaPhi=(sqrt2*c0*c1+k)/(2*(c1+sqrt2*c0*k)*(c1+sqrt2*c0*k)*k),deltacDeltat=-.5*t*c*c*c,deltacDeltaLambda=deltacDeltat*deltatDeltaLambda,deltacDeltaPhi=deltacDeltat*deltatDeltaPhi,A=(A=2*c1+sqrt2*k*(c0-s0))*A*v,deltavDeltaLambda=(sqrt2*c0*c1*k+cos1)/A,deltavDeltaPhi=-sqrt2*s0*s1/(k*A),deltaxDeltaLambda=vm1v*deltacDeltaLambda-2*deltavDeltaLambda/v+c*(deltavDeltaLambda+deltavDeltaLambda/v2),deltaxDeltaPhi=vm1v*deltacDeltaPhi-2*deltavDeltaPhi/v+c*(deltavDeltaPhi+deltavDeltaPhi/v2),deltayDeltaLambda=t*vp1v*deltacDeltaLambda-2*deltatDeltaLambda/(1+t2)+c*vp1v*deltatDeltaLambda+c*t*(deltavDeltaLambda-deltavDeltaLambda/v2),deltayDeltaPhi=t*vp1v*deltacDeltaPhi-2*deltatDeltaPhi/(1+t2)+c*vp1v*deltatDeltaPhi+c*t*(deltavDeltaPhi-deltavDeltaPhi/v2),denominator=deltaxDeltaPhi*deltayDeltaLambda-deltayDeltaPhi*deltaxDeltaLambda;if(!denominator)break;var deltaLambda=(fy*deltaxDeltaPhi-fx*deltayDeltaPhi)/denominator,deltaPhi=(fx*deltayDeltaLambda-fy*deltaxDeltaLambda)/denominator;lambda-=deltaLambda,phi=max(-halfPi,min(halfPi,phi-deltaPhi))}while((abs(deltaLambda)>epsilon||abs(deltaPhi)>epsilon)&&--i>0);return abs(abs(phi)-halfPi)<epsilon?[0,phi]:i&&[lambda,phi]};var faheyK=cos(35*radians);function faheyRaw(lambda,phi){var t=tan(phi/2);return[lambda*faheyK*sqrt(1-t*t),(1+faheyK)*t]}function foucautRaw(lambda,phi){var k=phi/2,cosk=cos(k);return[2*lambda/sqrtPi*cos(phi)*cosk*cosk,sqrtPi*tan(k)]}function foucautSinusoidalRaw(alpha){var beta=1-alpha,equatorial=raw(pi,0)[0]-raw(-pi,0)[0],ratio=sqrt(2*(raw(0,halfPi)[1]-raw(0,-halfPi)[1])/equatorial);function raw(lambda,phi){var cosphi=cos(phi),sinphi=sin(phi);return[cosphi/(beta+alpha*cosphi)*lambda,beta*phi+alpha*sinphi]}function forward(lambda,phi){var p=raw(lambda,phi);return[p[0]*ratio,p[1]/ratio]}function forwardMeridian(phi){return forward(0,phi)[1]}return forward.invert=function(x,y){var phi=solve(forwardMeridian,y);return[x/ratio*(alpha+beta/cos(phi)),phi]},forward}function gilbertForward(point){return[point[0]/2,asin(tan(point[1]/2*radians))*degrees]}function gilbertInvert(point){return[2*point[0],2*atan(sin(point[1]*radians))*degrees]}function gingeryRaw(rho,n){var k=2*pi/n,rho2=rho*rho;function forward(lambda,phi){var p=d3Geo.geoAzimuthalEquidistantRaw(lambda,phi),x=p[0],y=p[1],r2=x*x+y*y;if(r2>rho2){var r=sqrt(r2),theta=atan2(y,x),theta0=k*round(theta/k),alpha=theta-theta0,rhoCosAlpha=rho*cos(alpha),k_=(rho*sin(alpha)-alpha*sin(rhoCosAlpha))/(halfPi-rhoCosAlpha),s_=gingeryLength(alpha,k_),e=(pi-rho)/gingeryIntegrate(s_,rhoCosAlpha,pi);x=r;var delta,i=50;do{x-=delta=(rho+gingeryIntegrate(s_,rhoCosAlpha,x)*e-r)/(s_(x)*e)}while(abs(delta)>epsilon&&--i>0);y=alpha*sin(x),x<halfPi&&(y-=k_*(x-halfPi));var s=sin(theta0),c=cos(theta0);p[0]=x*c-y*s,p[1]=x*s+y*c}return p}return forward.invert=function(x,y){var r2=x*x+y*y;if(r2>rho2){var r=sqrt(r2),theta=atan2(y,x),theta0=k*round(theta/k),dTheta=theta-theta0;x=r*cos(dTheta),y=r*sin(dTheta);for(var x_halfPi=x-halfPi,sinx=sin(x),alpha=y/sinx,delta=x<halfPi?1/0:0,i=10;;){var rhosinAlpha=rho*sin(alpha),rhoCosAlpha=rho*cos(alpha),sinRhoCosAlpha=sin(rhoCosAlpha),halfPi_RhoCosAlpha=halfPi-rhoCosAlpha,k_=(rhosinAlpha-alpha*sinRhoCosAlpha)/halfPi_RhoCosAlpha,s_=gingeryLength(alpha,k_);if(abs(delta)<1e-12||!--i)break;alpha-=delta=(alpha*sinx-k_*x_halfPi-y)/(sinx-2*x_halfPi*(halfPi_RhoCosAlpha*(rhoCosAlpha+alpha*rhosinAlpha*cos(rhoCosAlpha)-sinRhoCosAlpha)-rhosinAlpha*(rhosinAlpha-alpha*sinRhoCosAlpha))/(halfPi_RhoCosAlpha*halfPi_RhoCosAlpha))}x=(r=rho+gingeryIntegrate(s_,rhoCosAlpha,x)*(pi-rho)/gingeryIntegrate(s_,rhoCosAlpha,pi))*cos(theta=theta0+alpha),y=r*sin(theta)}return d3Geo.geoAzimuthalEquidistantRaw.invert(x,y)},forward}function gingeryLength(alpha,k){return function(x){var y_=alpha*cos(x);return x<halfPi&&(y_-=k),sqrt(1+y_*y_)}}function gingeryIntegrate(f,a,b){for(var h=(b-a)/50,s=f(a)+f(b),i=1,x=a;i<50;++i)s+=2*f(x+=h);return.5*s*h}function ginzburgPolyconicRaw(a,b,c,d,e,f,g,h){function forward(lambda,phi){if(!phi)return[a*lambda/pi,0];var phi2=phi*phi,xB=a+phi2*(b+phi2*(c+phi2*d)),yB=phi*(e-1+phi2*(f-h+phi2*g)),m=(xB*xB+yB*yB)/(2*yB),alpha=lambda*asin(xB/m)/pi;return[m*sin(alpha),phi*(1+phi2*h)+m*(1-cos(alpha))]}return arguments.length<8&&(h=0),forward.invert=function(x,y){var deltaLambda,deltaPhi,lambda=pi*x/a,phi=y,i=50;do{var phi2=phi*phi,xB=a+phi2*(b+phi2*(c+phi2*d)),yB=phi*(e-1+phi2*(f-h+phi2*g)),p=xB*xB+yB*yB,q=2*yB,m=p/q,m2=m*m,dAlphadLambda=asin(xB/m)/pi,alpha=lambda*dAlphadLambda,xB2=xB*xB,dxBdPhi=(2*b+phi2*(4*c+6*phi2*d))*phi,dyBdPhi=e+phi2*(3*f+5*phi2*g),dmdPhi=(2*(xB*dxBdPhi+yB*(dyBdPhi-1))*q-p*(2*(dyBdPhi-1)))/(q*q),cosAlpha=cos(alpha),sinAlpha=sin(alpha),mcosAlpha=m*cosAlpha,msinAlpha=m*sinAlpha,dAlphadPhi=lambda/pi*(1/sqrt(1-xB2/m2))*(dxBdPhi*m-xB*dmdPhi)/m2,fx=msinAlpha-x,fy=phi*(1+phi2*h)+m-mcosAlpha-y,deltaxDeltaPhi=dmdPhi*sinAlpha+mcosAlpha*dAlphadPhi,deltaxDeltaLambda=mcosAlpha*dAlphadLambda,deltayDeltaPhi=1+dmdPhi-(dmdPhi*cosAlpha-msinAlpha*dAlphadPhi),deltayDeltaLambda=msinAlpha*dAlphadLambda,denominator=deltaxDeltaPhi*deltayDeltaLambda-deltayDeltaPhi*deltaxDeltaLambda;if(!denominator)break;lambda-=deltaLambda=(fy*deltaxDeltaPhi-fx*deltayDeltaPhi)/denominator,phi-=deltaPhi=(fx*deltayDeltaLambda-fy*deltaxDeltaLambda)/denominator}while((abs(deltaLambda)>epsilon||abs(deltaPhi)>epsilon)&&--i>0);return[lambda,phi]},forward}faheyRaw.invert=function(x,y){var t=y/(1+faheyK);return[x&&x/(faheyK*sqrt(1-t*t)),2*atan(t)]},foucautRaw.invert=function(x,y){var k=atan(y/sqrtPi),cosk=cos(k),phi=2*k;return[x*sqrtPi/2/(cos(phi)*cosk*cosk),phi]};var ginzburg4Raw=ginzburgPolyconicRaw(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555),ginzburg5Raw=ginzburgPolyconicRaw(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742),ginzburg6Raw=ginzburgPolyconicRaw(5/6*pi,-.62636,-.0344,0,1.3493,-.05524,0,.045);function ginzburg8Raw(lambda,phi){var lambda2=lambda*lambda,phi2=phi*phi;return[lambda*(1-.162388*phi2)*(.87-952426e-9*lambda2*lambda2),phi*(1+phi2/12)]}ginzburg8Raw.invert=function(x,y){var delta,lambda=x,phi=y,i=50;do{var phi2=phi*phi;phi-=delta=(phi*(1+phi2/12)-y)/(1+phi2/4)}while(abs(delta)>epsilon&&--i>0);i=50,x/=1-.162388*phi2;do{var lambda4=(lambda4=lambda*lambda)*lambda4;lambda-=delta=(lambda*(.87-952426e-9*lambda4)-x)/(.87-.00476213*lambda4)}while(abs(delta)>epsilon&&--i>0);return[lambda,phi]};var ginzburg9Raw=ginzburgPolyconicRaw(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);function squareRaw(project){var dx=project(halfPi,0)[0]-project(-halfPi,0)[0];function projectSquare(lambda,phi){var s=lambda>0?-.5:.5,point=project(lambda+s*pi,phi);return point[0]-=s*dx,point}return project.invert&&(projectSquare.invert=function(x,y){var s=x>0?-.5:.5,location=project.invert(x+s*dx,y),lambda=location[0]-s*pi;return lambda<-pi?lambda+=2*pi:lambda>pi&&(lambda-=2*pi),location[0]=lambda,location}),projectSquare}function gringortenRaw(lambda,phi){var sLambda=sign(lambda),sPhi=sign(phi),cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(sPhi*phi);lambda=abs(atan2(y,z)),phi=asin(x),abs(lambda-halfPi)>epsilon&&(lambda%=halfPi);var point=function(lambda,phi){if(phi===halfPi)return[0,0];var x,i,sinPhi=sin(phi),r=sinPhi*sinPhi,r2=r*r,j=1+r2,k=1+3*r2,q=1-r2,z=asin(1/sqrt(j)),v=q+r*j*z,p2=(1-sinPhi)/v,p=sqrt(p2),a2=p2*j,a=sqrt(a2),h=p*q;if(0===lambda)return[0,-(h+r*a)];var delta,cosPhi=cos(phi),secPhi=1/cosPhi,drdPhi=2*sinPhi*cosPhi,dp2dPhi=(-v*cosPhi-(-3*r+z*k)*drdPhi*(1-sinPhi))/(v*v),mu=-secPhi*drdPhi,nu=-secPhi*(r*j*dp2dPhi+p2*k*drdPhi),zeta=-2*secPhi*(q*(.5*dp2dPhi/p)-2*r*p*drdPhi),lambda1=4*lambda/pi;if(lambda>.222*pi||phi<pi/4&&lambda>.175*pi){if(x=(h+r*sqrt(a2*(1+r2)-h*h))/(1+r2),lambda>pi/4)return[x,x];var x1=x,x0=.5*x;x=.5*(x0+x1),i=50;do{var g=sqrt(a2-x*x),f=x*(zeta+mu*g)+nu*asin(x/a)-lambda1;if(!f)break;f<0?x0=x:x1=x,x=.5*(x0+x1)}while(abs(x1-x0)>epsilon&&--i>0)}else{x=epsilon,i=25;do{var x2=x*x,g2=sqrt(a2-x2),zetaMug=zeta+mu*g2,f2=x*zetaMug+nu*asin(x/a)-lambda1,df=zetaMug+(nu-mu*x2)/g2;x-=delta=g2?f2/df:0}while(abs(delta)>epsilon&&--i>0)}return[x,-h-r*sqrt(a2-x*x)]}(lambda>pi/4?halfPi-lambda:lambda,phi);return lambda>pi/4&&(z=point[0],point[0]=-point[1],point[1]=-z),point[0]*=sLambda,point[1]*=-sPhi,point}function ellipticJ(u,m){var ai,b,phi,t,twon,x;if(m<epsilon)return[(t=sin(u))-(ai=m*(u-t*(b=cos(u)))/4)*b,b+ai*t,1-m*t*t/2,u-ai];if(m>=1-epsilon)return ai=(1-m)/4,phi=1/(b=cosh(u)),[(t=((x=exp(2*(x=u)))-1)/(x+1))+ai*((twon=b*sinh(u))-u)/(b*b),phi-ai*t*phi*(twon-u),phi+ai*t*phi*(twon+u),2*atan(exp(u))-halfPi+ai*(twon-u)/b];var a=[1,0,0,0,0,0,0,0,0],c=[sqrt(m),0,0,0,0,0,0,0,0],i=0;for(b=sqrt(1-m),twon=1;abs(c[i]/a[i])>epsilon&&i<8;)ai=a[i++],c[i]=(ai-b)/2,a[i]=(ai+b)/2,b=sqrt(ai*b),twon*=2;phi=twon*a[i]*u;do{phi=(asin(t=c[i]*sin(b=phi)/a[i])+phi)/2}while(--i);return[sin(phi),t=cos(phi),t/cos(phi-b),phi]}function ellipticF(phi,m){if(!m)return phi;if(1===m)return log(tan(phi/2+quarterPi));for(var a=1,b=sqrt(1-m),c=sqrt(m),i=0;abs(c)>epsilon;i++){if(phi%pi){var dPhi=atan(b*tan(phi)/a);dPhi<0&&(dPhi+=pi),phi+=dPhi+~~(phi/pi)*pi}else phi+=phi;c=(a+b)/2,b=sqrt(a*b),c=((a=c)-b)/2}return phi/(pow(2,i)*a)}function guyouRaw(lambda,phi){var k_=(sqrt2-1)/(sqrt2+1),k=sqrt(1-k_*k_),K=ellipticF(halfPi,k*k),psi=log(tan(pi/4+abs(phi)/2)),r=exp(-1*psi)/sqrt(k_),at=function(x,y){var x2=x*x,y_1=y+1,t=1-x2-y*y;return[.5*((x>=0?halfPi:-halfPi)-atan2(t,2*x)),-.25*log(t*t+4*x2)+.5*log(y_1*y_1+x2)]}(r*cos(-1*lambda),r*sin(-1*lambda)),t=function(phi,psi,m){var r=abs(phi),sinhPsi=sinh(abs(psi));if(r){var cscPhi=1/sin(r),cotPhi2=1/(tan(r)*tan(r)),b=-(cotPhi2+m*(sinhPsi*sinhPsi*cscPhi*cscPhi)-1+m),cotLambda2=(-b+sqrt(b*b-(m-1)*cotPhi2*4))/2;return[ellipticF(atan(1/sqrt(cotLambda2)),m)*sign(phi),ellipticF(atan(sqrt((cotLambda2/cotPhi2-1)/m)),1-m)*sign(psi)]}return[0,ellipticF(atan(sinhPsi),1-m)*sign(psi)]}(at[0],at[1],k*k);return[-t[1],(phi>=0?1:-1)*(.5*K-t[0])]}function hammerRetroazimuthalRaw(phi0){var sinPhi0=sin(phi0),cosPhi0=cos(phi0),rotate=hammerRetroazimuthalRotation(phi0);function forward(lambda,phi){var p=rotate(lambda,phi);lambda=p[0],phi=p[1];var sinPhi=sin(phi),cosPhi=cos(phi),cosLambda=cos(lambda),z=acos(sinPhi0*sinPhi+cosPhi0*cosPhi*cosLambda),sinz=sin(z),K=abs(sinz)>epsilon?z/sinz:1;return[K*cosPhi0*sin(lambda),(abs(lambda)>halfPi?K:-K)*(sinPhi0*cosPhi-cosPhi0*sinPhi*cosLambda)]}return rotate.invert=hammerRetroazimuthalRotation(-phi0),forward.invert=function(x,y){var rho=sqrt(x*x+y*y),sinz=-sin(rho),cosz=cos(rho),a=rho*cosz,b=-y*sinz,c=rho*sinPhi0,d=sqrt(a*a+b*b-c*c),phi=atan2(a*c+b*d,b*c-a*d),lambda=(rho>halfPi?-1:1)*atan2(x*sinz,rho*cos(phi)*cosz+y*sin(phi)*sinz);return rotate.invert(lambda,phi)},forward}function hammerRetroazimuthalRotation(phi0){var sinPhi0=sin(phi0),cosPhi0=cos(phi0);return function(lambda,phi){var cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(phi);return[atan2(y,x*cosPhi0-z*sinPhi0),asin(z*cosPhi0+x*sinPhi0)]}}gringortenRaw.invert=function(x,y){abs(x)>1&&(x=2*sign(x)-x),abs(y)>1&&(y=2*sign(y)-y);var sx=sign(x),sy=sign(y),x0=-sx*x,y0=-sy*y,t=y0/x0<1,p=function(x,y){for(var x0=0,x1=1,r=.5,i=50;;){var r2=r*r,sinPhi=sqrt(r),z=asin(1/sqrt(1+r2)),v=1-r2+r*(1+r2)*z,p2=(1-sinPhi)/v,p=sqrt(p2),a2=p2*(1+r2),h=p*(1-r2),g=sqrt(a2-x*x),y0=y+h+r*g;if(abs(x1-x0)<1e-12||0==--i||0===y0)break;y0>0?x0=r:x1=r,r=.5*(x0+x1)}if(!i)return null;var phi=asin(sinPhi),cosPhi=cos(phi),secPhi=1/cosPhi,drdPhi=2*sinPhi*cosPhi,dp2dPhi=(-v*cosPhi-(-3*r+z*(1+3*r2))*drdPhi*(1-sinPhi))/(v*v);return[pi/4*(x*(-2*secPhi*(.5*dp2dPhi/p*(1-r2)-2*r*p*drdPhi)+-secPhi*drdPhi*g)+-secPhi*(r*(1+r2)*dp2dPhi+p2*(1+3*r2)*drdPhi)*asin(x/sqrt(a2))),phi]}(t?y0:x0,t?x0:y0),lambda=p[0],phi=p[1],cosPhi=cos(phi);return t&&(lambda=-halfPi-lambda),[sx*(atan2(sin(lambda)*cosPhi,-sin(phi))+pi),sy*asin(cos(lambda)*cosPhi)]},guyouRaw.invert=function(x,y){var u,v,m,a,b,c,k_=(sqrt2-1)/(sqrt2+1),k=sqrt(1-k_*k_),K=ellipticF(halfPi,k*k),j=(v=-x,m=k*k,(u=.5*K-y)?(a=ellipticJ(u,m),v?(c=(b=ellipticJ(v,1-m))[1]*b[1]+m*a[0]*a[0]*b[0]*b[0],[[a[0]*b[2]/c,a[1]*a[2]*b[0]*b[1]/c],[a[1]*b[1]/c,-a[0]*a[2]*b[0]*b[2]/c],[a[2]*b[1]*b[2]/c,-m*a[0]*a[1]*b[0]/c]]):[[a[0],0],[a[1],0],[a[2],0]]):[[0,(b=ellipticJ(v,1-m))[0]/b[1]],[1/b[1],0],[b[2]/b[1],0]]),tn=function(a,b){var denominator=b[0]*b[0]+b[1]*b[1];return[(a[0]*b[0]+a[1]*b[1])/denominator,(a[1]*b[0]-a[0]*b[1])/denominator]}(j[0],j[1]);return[atan2(tn[1],tn[0])/-1,2*atan(exp(-.5*log(k_*tn[0]*tn[0]+k_*tn[1]*tn[1])))-halfPi]};var healpixParallel=asin(1-1/3)*degrees,healpixLambert=cylindricalEqualAreaRaw(0);function healpixRaw(H){var phi0=healpixParallel*radians,dx=collignonRaw(pi,phi0)[0]-collignonRaw(-pi,phi0)[0],y0=healpixLambert(0,phi0)[1],y1=collignonRaw(0,phi0)[1],dy1=sqrtPi-y1,k=tau/H,w=4/tau,h=y0+dy1*dy1*4/tau;function forward(lambda,phi){var point,phi2=abs(phi);if(phi2>phi0){var i=min(H-1,max(0,floor((lambda+pi)/k)));(point=collignonRaw(lambda+=pi*(H-1)/H-i*k,phi2))[0]=point[0]*tau/dx-tau*(H-1)/(2*H)+i*tau/H,point[1]=y0+4*(point[1]-y1)*dy1/tau,phi<0&&(point[1]=-point[1])}else point=healpixLambert(lambda,phi);return point[0]*=w,point[1]/=h,point}return forward.invert=function(x,y){x/=w;var y2=abs(y*=h);if(y2>y0){var i=min(H-1,max(0,floor((x+pi)/k)));x=(x+pi*(H-1)/H-i*k)*dx/tau;var point=collignonRaw.invert(x,.25*(y2-y0)*tau/dy1+y1);return point[0]-=pi*(H-1)/H-i*k,y<0&&(point[1]=-point[1]),point}return healpixLambert.invert(x,y)},forward}function sphereTop(x,i){return[x,1&i?90-epsilon:healpixParallel]}function sphereBottom(x,i){return[x,1&i?-90+epsilon:-healpixParallel]}function sphereNudge(d){return[d[0]*(1-epsilon),d[1]]}function hillRaw(K){var B,L=1+K,Bt=asin(sin(1/L)),A=2*sqrt(pi/(B=pi+4*Bt*L)),rho0=.5*A*(L+sqrt(K*(2+K))),K2=K*K,L2=L*L;function forward(lambda,phi){var rho,omega,t=1-sin(phi);if(t&&t<2){var delta,theta=halfPi-phi,i=25;do{var sinTheta=sin(theta),cosTheta=cos(theta),Bt_Bt1=Bt+atan2(sinTheta,L-cosTheta),C=1+L2-2*L*cosTheta;theta-=delta=(theta-K2*Bt-L*sinTheta+C*Bt_Bt1-.5*t*B)/(2*L*sinTheta*Bt_Bt1)}while(abs(delta)>1e-12&&--i>0);rho=A*sqrt(C),omega=lambda*Bt_Bt1/pi}else rho=A*(K+t),omega=lambda*Bt/pi;return[rho*sin(omega),rho0-rho*cos(omega)]}return forward.invert=function(x,y){var rho2=x*x+(y-=rho0)*y,cosTheta=(1+L2-rho2/(A*A))/(2*L),theta=acos(cosTheta),sinTheta=sin(theta),Bt_Bt1=Bt+atan2(sinTheta,L-cosTheta);return[asin(x/sqrt(rho2))*pi/Bt_Bt1,asin(1-2*(theta-K2*Bt-L*sinTheta+(1+L2-2*L*cosTheta)*Bt_Bt1)/B)]},forward}function sinuMollweideRaw(lambda,phi){return phi>-.7109889596207567?((lambda=mollweideRaw(lambda,phi))[1]+=.0528035274542,lambda):sinusoidalRaw(lambda,phi)}function homolosineRaw(lambda,phi){return abs(phi)>.7109889596207567?((lambda=mollweideRaw(lambda,phi))[1]-=phi>0?.0528035274542:-.0528035274542,lambda):sinusoidalRaw(lambda,phi)}function hufnagelRaw(a,b,psiMax,ratio){var k=sqrt(4*pi/(2*psiMax+(1+a-b/2)*sin(2*psiMax)+(a+b)/2*sin(4*psiMax)+b/2*sin(6*psiMax))),c=sqrt(ratio*sin(psiMax)*sqrt((1+a*cos(2*psiMax)+b*cos(4*psiMax))/(1+a+b))),M=psiMax*mapping(1);function radius(psi){return sqrt(1+a*cos(2*psi)+b*cos(4*psi))}function mapping(t){var psi=t*psiMax;return(2*psi+(1+a-b/2)*sin(2*psi)+(a+b)/2*sin(4*psi)+b/2*sin(6*psi))/psiMax}function inversemapping(psi){return radius(psi)*sin(psi)}var forward=function(lambda,phi){var psi=psiMax*solve(mapping,M*sin(phi)/psiMax,phi/pi);isNaN(psi)&&(psi=psiMax*sign(phi));var kr=k*radius(psi);return[kr*c*lambda/pi*cos(psi),kr/c*sin(psi)]};return forward.invert=function(x,y){var psi=solve(inversemapping,y*c/k);return[x*pi/(cos(psi)*k*c*radius(psi)),asin(psiMax*mapping(psi/psiMax)/M)]},0===psiMax&&(k=sqrt(ratio/pi),(forward=function(lambda,phi){return[lambda*k,sin(phi)/k]}).invert=function(x,y){return[x/k,asin(y*k)]}),forward}function integrate(f,a,b,tol,maxdepth){void 0===tol&&(tol=1e-8),void 0===maxdepth&&(maxdepth=20);var fa=f(a),fm=f(.5*(a+b)),fb=f(b);return function adsimp(f,a,b,fa,fm,fb,V0,tol,maxdepth,depth,state){if(state.nanEncountered)return NaN;var h,f1,f2,sl,sr,s2,m,V1,V2,err;if(f1=f(a+.25*(h=b-a)),f2=f(b-.25*h),isNaN(f1))state.nanEncountered=!0;else{if(!isNaN(f2))return err=((s2=(sl=h*(fa+4*f1+fm)/12)+(sr=h*(fm+4*f2+fb)/12))-V0)/15,depth>maxdepth?(state.maxDepthCount++,s2+err):Math.abs(err)<tol?s2+err:(V1=adsimp(f,a,m=a+.5*h,fa,f1,fm,sl,.5*tol,maxdepth,depth+1,state),isNaN(V1)?(state.nanEncountered=!0,NaN):(V2=adsimp(f,m,b,fm,f2,fb,sr,.5*tol,maxdepth,depth+1,state),isNaN(V2)?(state.nanEncountered=!0,NaN):V1+V2));state.nanEncountered=!0}}(f,a,b,fa,fm,fb,(fa+4*fm+fb)*(b-a)/6,tol,maxdepth,1,{maxDepthCount:0,nanEncountered:!1})}function hyperellipticalRaw(alpha,k,gamma){function elliptic(f){return alpha+(1-alpha)*pow(1-pow(f,k),1/k)}function z(f){return integrate(elliptic,0,f,1e-4)}for(var G=1/z(1),n=1e3,m=(1+1e-8)*G,approx=[],i=0;i<=n;i++)approx.push(z(i/n)*m);function Y(sinphi){var rmin=0,rmax=n,r=500;do{approx[r]>sinphi?rmax=r:rmin=r,r=rmin+rmax>>1}while(r>rmin);var u=approx[r+1]-approx[r];return u&&(u=(sinphi-approx[r+1])/u),(r+1+u)/n}var ratio=2*Y(1)/pi*G/gamma,forward=function(lambda,phi){var y=Y(abs(sin(phi))),x=elliptic(y)*lambda;return y/=ratio,[x,phi>=0?y:-y]};return forward.invert=function(x,y){var phi;return abs(y*=ratio)<1&&(phi=sign(y)*asin(z(abs(y))*G)),[x/elliptic(abs(y)),phi]},forward}function pointEqual(a,b){return abs(a[0]-b[0])<epsilon&&abs(a[1]-b[1])<epsilon}function interpolateLine(coordinates,m){for(var p1,dx,dy,i=-1,n=coordinates.length,p0=coordinates[0],resampled=[];++i<n;){dx=((p1=coordinates[i])[0]-p0[0])/m,dy=(p1[1]-p0[1])/m;for(var j=0;j<m;++j)resampled.push([p0[0]+j*dx,p0[1]+j*dy]);p0=p1}return resampled.push(p1),resampled}function interpolateSphere(lobes){var lobe,lambda0,phi0,phi1,lambda2,phi2,i,coordinates=[],n=lobes[0].length;for(i=0;i<n;++i)lambda0=(lobe=lobes[0][i])[0][0],phi0=lobe[0][1],phi1=lobe[1][1],lambda2=lobe[2][0],phi2=lobe[2][1],coordinates.push(interpolateLine([[lambda0+epsilon,phi0+epsilon],[lambda0+epsilon,phi1-epsilon],[lambda2-epsilon,phi1-epsilon],[lambda2-epsilon,phi2+epsilon]],30));for(i=lobes[1].length-1;i>=0;--i)lambda0=(lobe=lobes[1][i])[0][0],phi0=lobe[0][1],phi1=lobe[1][1],lambda2=lobe[2][0],phi2=lobe[2][1],coordinates.push(interpolateLine([[lambda2-epsilon,phi2-epsilon],[lambda2-epsilon,phi1+epsilon],[lambda0+epsilon,phi1+epsilon],[lambda0+epsilon,phi0-epsilon]],30));return{type:"Polygon",coordinates:[d3Array.merge(coordinates)]}}function interrupt(project,lobes,inverse){var sphere,bounds;function forward(lambda,phi){for(var sign$$1=phi<0?-1:1,lobe=lobes[+(phi<0)],i=0,n=lobe.length-1;i<n&&lambda>lobe[i][2][0];++i);var p=project(lambda-lobe[i][1][0],phi);return p[0]+=project(lobe[i][1][0],sign$$1*phi>sign$$1*lobe[i][0][1]?lobe[i][0][1]:phi)[0],p}inverse?forward.invert=inverse(forward):project.invert&&(forward.invert=function(x,y){for(var bound=bounds[+(y<0)],lobe=lobes[+(y<0)],i=0,n=bound.length;i<n;++i){var b=bound[i];if(b[0][0]<=x&&x<b[1][0]&&b[0][1]<=y&&y<b[1][1]){var p=project.invert(x-project(lobe[i][1][0],0)[0],y);return p[0]+=lobe[i][1][0],pointEqual(forward(p[0],p[1]),[x,y])?p:null}}});var p=d3Geo.geoProjection(forward),stream_=p.stream;return p.stream=function(stream){var rotate=p.rotate(),rotateStream=stream_(stream),sphereStream=(p.rotate([0,0]),stream_(stream));return p.rotate(rotate),rotateStream.sphere=function(){d3Geo.geoStream(sphere,sphereStream)},rotateStream},p.lobes=function(_){return arguments.length?(sphere=interpolateSphere(_),lobes=_.map((function(lobe){return lobe.map((function(l){return[[l[0][0]*radians,l[0][1]*radians],[l[1][0]*radians,l[1][1]*radians],[l[2][0]*radians,l[2][1]*radians]]}))})),bounds=lobes.map((function(lobe){return lobe.map((function(l){var t,x0=project(l[0][0],l[0][1])[0],x1=project(l[2][0],l[2][1])[0],y0=project(l[1][0],l[0][1])[1],y1=project(l[1][0],l[1][1])[1];return y0>y1&&(t=y0,y0=y1,y1=t),[[x0,y0],[x1,y1]]}))})),p):lobes.map((function(lobe){return lobe.map((function(l){return[[l[0][0]*degrees,l[0][1]*degrees],[l[1][0]*degrees,l[1][1]*degrees],[l[2][0]*degrees,l[2][1]*degrees]]}))}))},null!=lobes&&p.lobes(lobes),p}sinuMollweideRaw.invert=function(x,y){return y>-.7109889596207567?mollweideRaw.invert(x,y-.0528035274542):sinusoidalRaw.invert(x,y)},homolosineRaw.invert=function(x,y){return abs(y)>.7109889596207567?mollweideRaw.invert(x,y+(y>0?.0528035274542:-.0528035274542)):sinusoidalRaw.invert(x,y)};var lobes=[[[[-180,0],[-100,90],[-40,0]],[[-40,0],[30,90],[180,0]]],[[[-180,0],[-160,-90],[-100,0]],[[-100,0],[-60,-90],[-20,0]],[[-20,0],[20,-90],[80,0]],[[80,0],[140,-90],[180,0]]]],lobes$1=[[[[-180,0],[-100,90],[-40,0]],[[-40,0],[30,90],[180,0]]],[[[-180,0],[-160,-90],[-100,0]],[[-100,0],[-60,-90],[-20,0]],[[-20,0],[20,-90],[80,0]],[[80,0],[140,-90],[180,0]]]],lobes$2=[[[[-180,0],[-100,90],[-40,0]],[[-40,0],[30,90],[180,0]]],[[[-180,0],[-160,-90],[-100,0]],[[-100,0],[-60,-90],[-20,0]],[[-20,0],[20,-90],[80,0]],[[80,0],[140,-90],[180,0]]]],lobes$3=[[[[-180,0],[-90,90],[0,0]],[[0,0],[90,90],[180,0]]],[[[-180,0],[-90,-90],[0,0]],[[0,0],[90,-90],[180,0]]]],lobes$4=[[[[-180,35],[-30,90],[0,35]],[[0,35],[30,90],[180,35]]],[[[-180,-10],[-102,-90],[-65,-10]],[[-65,-10],[5,-90],[77,-10]],[[77,-10],[103,-90],[180,-10]]]],lobes$5=[[[[-180,0],[-110,90],[-40,0]],[[-40,0],[0,90],[40,0]],[[40,0],[110,90],[180,0]]],[[[-180,0],[-110,-90],[-40,0]],[[-40,0],[0,-90],[40,0]],[[40,0],[110,-90],[180,0]]]];function kavrayskiy7Raw(lambda,phi){return[3/tau*lambda*sqrt(pi*pi/3-phi*phi),phi]}function lagrangeRaw(n){function forward(lambda,phi){if(abs(abs(phi)-halfPi)<epsilon)return[0,phi<0?-2:2];var sinPhi=sin(phi),v=pow((1+sinPhi)/(1-sinPhi),n/2),c=.5*(v+1/v)+cos(lambda*=n);return[2*sin(lambda)/c,(v-1/v)/c]}return forward.invert=function(x,y){var y0=abs(y);if(abs(y0-2)<epsilon)return x?null:[0,sign(y)*halfPi];if(y0>2)return null;var x2=(x/=2)*x,y2=(y/=2)*y,t=2*y/(1+x2+y2);return t=pow((1+t)/(1-t),1/n),[atan2(2*x,1-x2-y2)/n,asin((t-1)/(t+1))]},forward}kavrayskiy7Raw.invert=function(x,y){return[tau/3*x/sqrt(pi*pi/3-y*y),y]};var pi_sqrt2=pi/sqrt2;function larriveeRaw(lambda,phi){return[lambda*(1+sqrt(cos(phi)))/2,phi/(cos(phi/2)*cos(lambda/6))]}function laskowskiRaw(lambda,phi){var lambda2=lambda*lambda,phi2=phi*phi;return[lambda*(.975534+phi2*(-.0143059*lambda2-.119161+-.0547009*phi2)),phi*(1.00384+lambda2*(.0802894+-.02855*phi2+199025e-9*lambda2)+phi2*(.0998909+-.0491032*phi2))]}function littrowRaw(lambda,phi){return[sin(lambda)/cos(phi),tan(phi)*cos(lambda)]}function loximuthalRaw(phi0){var cosPhi0=cos(phi0),tanPhi0=tan(quarterPi+phi0/2);function forward(lambda,phi){var y=phi-phi0,x=abs(y)<epsilon?lambda*cosPhi0:abs(x=quarterPi+phi/2)<epsilon||abs(abs(x)-halfPi)<epsilon?0:lambda*y/log(tan(x)/tanPhi0);return[x,y]}return forward.invert=function(x,y){var lambda,phi=y+phi0;return[abs(y)<epsilon?x/cosPhi0:abs(lambda=quarterPi+phi/2)<epsilon||abs(abs(lambda)-halfPi)<epsilon?0:x*log(tan(lambda)/tanPhi0)/y,phi]},forward}function millerRaw(lambda,phi){return[lambda,1.25*log(tan(quarterPi+.4*phi))]}function modifiedStereographicRaw(C){var m=C.length-1;function forward(lambda,phi){for(var t,cosPhi=cos(phi),k=2/(1+cosPhi*cos(lambda)),zr=k*cosPhi*sin(lambda),zi=k*sin(phi),i=m,w=C[i],ar=w[0],ai=w[1];--i>=0;)ar=(w=C[i])[0]+zr*(t=ar)-zi*ai,ai=w[1]+zr*ai+zi*t;return[ar=zr*(t=ar)-zi*ai,ai=zr*ai+zi*t]}return forward.invert=function(x,y){var i=20,zr=x,zi=y;do{for(var t,j=m,w=C[j],ar=w[0],ai=w[1],br=0,bi=0;--j>=0;)br=ar+zr*(t=br)-zi*bi,bi=ai+zr*bi+zi*t,ar=(w=C[j])[0]+zr*(t=ar)-zi*ai,ai=w[1]+zr*ai+zi*t;var deltar,deltai,denominator=(br=ar+zr*(t=br)-zi*bi)*br+(bi=ai+zr*bi+zi*t)*bi;zr-=deltar=((ar=zr*(t=ar)-zi*ai-x)*br+(ai=zr*ai+zi*t-y)*bi)/denominator,zi-=deltai=(ai*br-ar*bi)/denominator}while(abs(deltar)+abs(deltai)>1e-12&&--i>0);if(i){var rho=sqrt(zr*zr+zi*zi),c=2*atan(.5*rho),sinc=sin(c);return[atan2(zr*sinc,rho*cos(c)),rho?asin(zi*sinc/rho):0]}},forward}larriveeRaw.invert=function(x,y){var x0=abs(x),y0=abs(y),lambda=epsilon,phi=halfPi;y0<pi_sqrt2?phi*=y0/pi_sqrt2:lambda+=6*acos(pi_sqrt2/y0);for(var i=0;i<25;i++){var sinPhi=sin(phi),sqrtcosPhi=sqrt(cos(phi)),sinPhi_2=sin(phi/2),cosPhi_2=cos(phi/2),sinLambda_6=sin(lambda/6),cosLambda_6=cos(lambda/6),f0=.5*lambda*(1+sqrtcosPhi)-x0,f1=phi/(cosPhi_2*cosLambda_6)-y0,df0dPhi=sqrtcosPhi?-.25*lambda*sinPhi/sqrtcosPhi:0,df0dLambda=.5*(1+sqrtcosPhi),df1dPhi=(1+.5*phi*sinPhi_2/cosPhi_2)/(cosPhi_2*cosLambda_6),df1dLambda=phi/cosPhi_2*(sinLambda_6/6)/(cosLambda_6*cosLambda_6),denom=df0dPhi*df1dLambda-df1dPhi*df0dLambda,dPhi=(f0*df1dLambda-f1*df0dLambda)/denom,dLambda=(f1*df0dPhi-f0*df1dPhi)/denom;if(phi-=dPhi,lambda-=dLambda,abs(dPhi)<epsilon&&abs(dLambda)<epsilon)break}return[x<0?-lambda:lambda,y<0?-phi:phi]},laskowskiRaw.invert=function(x,y){var lambda=sign(x)*pi,phi=y/2,i=50;do{var lambda2=lambda*lambda,phi2=phi*phi,lambdaPhi=lambda*phi,fx=lambda*(.975534+phi2*(-.0143059*lambda2-.119161+-.0547009*phi2))-x,fy=phi*(1.00384+lambda2*(.0802894+-.02855*phi2+199025e-9*lambda2)+phi2*(.0998909+-.0491032*phi2))-y,deltaxDeltaLambda=.975534-phi2*(.119161+3*lambda2*.0143059+.0547009*phi2),deltaxDeltaPhi=-lambdaPhi*(.238322+.2188036*phi2+.0286118*lambda2),deltayDeltaLambda=lambdaPhi*(.1605788+7961e-7*lambda2+-.0571*phi2),deltayDeltaPhi=1.00384+lambda2*(.0802894+199025e-9*lambda2)+phi2*(3*(.0998909-.02855*lambda2)-.245516*phi2),denominator=deltaxDeltaPhi*deltayDeltaLambda-deltayDeltaPhi*deltaxDeltaLambda,deltaLambda=(fy*deltaxDeltaPhi-fx*deltayDeltaPhi)/denominator,deltaPhi=(fx*deltayDeltaLambda-fy*deltaxDeltaLambda)/denominator;lambda-=deltaLambda,phi-=deltaPhi}while((abs(deltaLambda)>epsilon||abs(deltaPhi)>epsilon)&&--i>0);return i&&[lambda,phi]},littrowRaw.invert=function(x,y){var x2=x*x,y2_1=y*y+1,x2_y2_1=x2+y2_1,cosPhi=x?sqrt1_2*sqrt((x2_y2_1-sqrt(x2_y2_1*x2_y2_1-4*x2))/x2):1/sqrt(y2_1);return[asin(x*cosPhi),sign(y)*acos(cosPhi)]},millerRaw.invert=function(x,y){return[x,2.5*atan(exp(.8*y))-.625*pi]};var alaska=[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48=[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50=[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller$1=[[.9245,0],[0,0],[.01943,0]],lee=[[.721316,0],[0,0],[-.00881625,-.00617325]];function modifiedStereographic(coefficients,rotate){var p=d3Geo.geoProjection(modifiedStereographicRaw(coefficients)).rotate(rotate).clipAngle(90),r=d3Geo.geoRotation(rotate),center=p.center;return delete p.rotate,p.center=function(_){return arguments.length?center(r(_)):r.invert(center())},p}var sqrt6=sqrt(6),sqrt7=sqrt(7);function mtFlatPolarParabolicRaw(lambda,phi){var theta=asin(7*sin(phi)/(3*sqrt6));return[sqrt6*lambda*(2*cos(2*theta/3)-1)/sqrt7,9*sin(theta/3)/sqrt7]}function mtFlatPolarQuarticRaw(lambda,phi){for(var delta,k=(1+sqrt1_2)*sin(phi),theta=phi,i=0;i<25&&(theta-=delta=(sin(theta/2)+sin(theta)-k)/(.5*cos(theta/2)+cos(theta)),!(abs(delta)<epsilon));i++);return[lambda*(1+2*cos(theta)/cos(theta/2))/(3*sqrt2),2*sqrt(3)*sin(theta/2)/sqrt(2+sqrt2)]}function mtFlatPolarSinusoidalRaw(lambda,phi){for(var delta,A=sqrt(6/(4+pi)),k=(1+pi/4)*sin(phi),theta=phi/2,i=0;i<25&&(theta-=delta=(theta/2+sin(theta)-k)/(.5+cos(theta)),!(abs(delta)<epsilon));i++);return[A*(.5+cos(theta))*lambda/1.5,A*theta]}function naturalEarth2Raw(lambda,phi){var phi2=phi*phi,phi4=phi2*phi2,phi6=phi2*phi4;return[lambda*(.84719-.13063*phi2+phi6*phi6*(.05494*phi2-.04515-.02326*phi4+.00331*phi6)),phi*(1.01183+phi4*phi4*(.01926*phi2-.02625-.00396*phi4))]}function nellHammerRaw(lambda,phi){return[lambda*(1+cos(phi))/2,2*(phi-tan(phi/2))]}mtFlatPolarParabolicRaw.invert=function(x,y){var theta=3*asin(y*sqrt7/9);return[x*sqrt7/(sqrt6*(2*cos(2*theta/3)-1)),asin(3*sin(theta)*sqrt6/7)]},mtFlatPolarQuarticRaw.invert=function(x,y){var sinTheta_2=y*sqrt(2+sqrt2)/(2*sqrt(3)),theta=2*asin(sinTheta_2);return[3*sqrt2*x/(1+2*cos(theta)/cos(theta/2)),asin((sinTheta_2+sin(theta))/(1+sqrt1_2))]},mtFlatPolarSinusoidalRaw.invert=function(x,y){var A=sqrt(6/(4+pi)),theta=y/A;return abs(abs(theta)-halfPi)<epsilon&&(theta=theta<0?-halfPi:halfPi),[1.5*x/(A*(.5+cos(theta))),asin((theta/2+sin(theta))/(1+pi/4))]},naturalEarth2Raw.invert=function(x,y){var delta,phi2,phi4,phi6,phi=y,i=25;do{phi-=delta=(phi*(1.01183+(phi4=(phi2=phi*phi)*phi2)*phi4*(.01926*phi2-.02625-.00396*phi4))-y)/(1.01183+phi4*phi4*(.21186*phi2-.23625+-.05148*phi4))}while(abs(delta)>1e-12&&--i>0);return[x/(.84719-.13063*(phi2=phi*phi)+(phi6=phi2*(phi4=phi2*phi2))*phi6*(.05494*phi2-.04515-.02326*phi4+.00331*phi6)),phi]},nellHammerRaw.invert=function(x,y){for(var p=y/2,i=0,delta=1/0;i<10&&abs(delta)>epsilon;++i){var c=cos(y/2);y-=delta=(y-tan(y/2)-p)/(1-.5/(c*c))}return[2*x/(1+cos(y)),y]};var lobes$6=[[[[-180,0],[-90,90],[0,0]],[[0,0],[90,90],[180,0]]],[[[-180,0],[-90,-90],[0,0]],[[0,0],[90,-90],[180,0]]]];function nicolosiRaw(lambda,phi){var sinPhi=sin(phi),q=cos(phi),s=sign(lambda);if(0===lambda||abs(phi)===halfPi)return[0,phi];if(0===phi)return[lambda,0];if(abs(lambda)===halfPi)return[lambda*q,halfPi*sinPhi];var b=pi/(2*lambda)-2*lambda/pi,c=2*phi/pi,d=(1-c*c)/(sinPhi-c),b2=b*b,d2=d*d,b2d2=1+b2/d2,d2b2=1+d2/b2,M=(b*sinPhi/d-b/2)/b2d2,N=(d2*sinPhi/b2+d/2)/d2b2,n=N*N-(d2*sinPhi*sinPhi/b2+d*sinPhi-1)/d2b2;return[halfPi*(M+sqrt(M*M+q*q/b2d2)*s),halfPi*(N+sqrt(n<0?0:n)*sign(-phi*b)*s)]}function pattersonRaw(lambda,phi){var phi2=phi*phi;return[lambda,phi*(1.0148+phi2*phi2*(.23185+phi2*(.02406*phi2-.14499)))]}function polyconicRaw(lambda,phi){if(abs(phi)<epsilon)return[lambda,0];var tanPhi=tan(phi),k=lambda*sin(phi);return[sin(k)/tanPhi,phi+(1-cos(k))/tanPhi]}function matrix(a,b){var u=subtract(a[1],a[0]),v=subtract(b[1],b[0]),phi=function(a,b){return atan2(a[0]*b[1]-a[1]*b[0],a[0]*b[0]+a[1]*b[1])}(u,v),s=length(u)/length(v);return multiply([1,0,a[0][0],0,1,a[0][1]],multiply([s,0,0,0,s,0],multiply([cos(phi),sin(phi),0,-sin(phi),cos(phi),0],[1,0,-b[0][0],0,1,-b[0][1]])))}function multiply(a,b){return[a[0]*b[0]+a[1]*b[3],a[0]*b[1]+a[1]*b[4],a[0]*b[2]+a[1]*b[5]+a[2],a[3]*b[0]+a[4]*b[3],a[3]*b[1]+a[4]*b[4],a[3]*b[2]+a[4]*b[5]+a[5]]}function subtract(a,b){return[a[0]-b[0],a[1]-b[1]]}function length(v){return sqrt(v[0]*v[0]+v[1]*v[1])}function polyhedral(root,face){function forward(lambda,phi){var t,node=face(lambda,phi),point=node.project([lambda*degrees,phi*degrees]);return(t=node.transform)?[t[0]*point[0]+t[1]*point[1]+t[2],-(t[3]*point[0]+t[4]*point[1]+t[5])]:(point[1]=-point[1],point)}!function recurse(node,parent){if(node.edges=function(face){for(var n=face.length,edges=[],a=face[n-1],i=0;i<n;++i)edges.push([a,a=face[i]]);return edges}(node.face),parent.face){var shared=node.shared=function(a,b){for(var x,y,n=a.length,found=null,i=0;i<n;++i){x=a[i];for(var j=b.length;--j>=0;)if(y=b[j],x[0]===y[0]&&x[1]===y[1]){if(found)return[found,x];found=x}}}(node.face,parent.face),m=matrix(shared.map(parent.project),shared.map(node.project));node.transform=parent.transform?multiply(parent.transform,m):m;for(var edges=parent.edges,i=0,n=edges.length;i<n;++i)pointEqual$1(shared[0],edges[i][1])&&pointEqual$1(shared[1],edges[i][0])&&(edges[i]=node),pointEqual$1(shared[0],edges[i][0])&&pointEqual$1(shared[1],edges[i][1])&&(edges[i]=node);for(edges=node.edges,i=0,n=edges.length;i<n;++i)pointEqual$1(shared[0],edges[i][0])&&pointEqual$1(shared[1],edges[i][1])&&(edges[i]=parent),pointEqual$1(shared[0],edges[i][1])&&pointEqual$1(shared[1],edges[i][0])&&(edges[i]=parent)}else node.transform=parent.transform;return node.children&&node.children.forEach((function(child){recurse(child,node)})),node}(root,{transform:null}),hasInverse(root)&&(forward.invert=function(x,y){var coordinates=function faceInvert(node,coordinates){var invert=node.project.invert,t=node.transform,point=coordinates;if(t&&(t=function(m){var k=1/(m[0]*m[4]-m[1]*m[3]);return[k*m[4],-k*m[1],k*(m[1]*m[5]-m[2]*m[4]),-k*m[3],k*m[0],k*(m[2]*m[3]-m[0]*m[5])]}(t),point=[t[0]*point[0]+t[1]*point[1]+t[2],t[3]*point[0]+t[4]*point[1]+t[5]]),invert&&node===function(coordinates){return face(coordinates[0]*radians,coordinates[1]*radians)}(p=invert(point)))return p;for(var p,children=node.children,i=0,n=children&&children.length;i<n;++i)if(p=faceInvert(children[i],coordinates))return p}(root,[x,-y]);return coordinates&&(coordinates[0]*=radians,coordinates[1]*=radians,coordinates)});var proj=d3Geo.geoProjection(forward),stream_=proj.stream;return proj.stream=function(stream){var rotate=proj.rotate(),rotateStream=stream_(stream),sphereStream=(proj.rotate([0,0]),stream_(stream));return proj.rotate(rotate),rotateStream.sphere=function(){sphereStream.polygonStart(),sphereStream.lineStart(),function outline(stream,node,parent){var point,edge,edges=node.edges,n=edges.length,multiPoint={type:"MultiPoint",coordinates:node.face},notPoles=node.face.filter((function(d){return 90!==abs(d[1])})),b=d3Geo.geoBounds({type:"MultiPoint",coordinates:notPoles}),inside=!1,j=-1,dx=b[1][0]-b[0][0],c=180===dx||360===dx?[(b[0][0]+b[1][0])/2,(b[0][1]+b[1][1])/2]:d3Geo.geoCentroid(multiPoint);if(parent)for(;++j<n&&edges[j]!==parent;);++j;for(var i=0;i<n;++i)edge=edges[(i+j)%n],Array.isArray(edge)?(inside||(stream.point((point=d3Geo.geoInterpolate(edge[0],c)(epsilon))[0],point[1]),inside=!0),stream.point((point=d3Geo.geoInterpolate(edge[1],c)(epsilon))[0],point[1])):(inside=!1,edge!==parent&&outline(stream,edge,node))}(sphereStream,root),sphereStream.lineEnd(),sphereStream.polygonEnd()},rotateStream},proj.angle(-30)}function pointEqual$1(a,b){return a&&b&&a[0]===b[0]&&a[1]===b[1]}function hasInverse(node){return node.project.invert||node.children&&node.children.some(hasInverse)}nicolosiRaw.invert=function(x,y){var x2=(x/=halfPi)*x,x2y2=x2+(y/=halfPi)*y,pi2=pi*pi;return[x?(x2y2-1+sqrt((1-x2y2)*(1-x2y2)+4*x2))/(2*x)*halfPi:0,solve((function(phi){return x2y2*(pi*sin(phi)-2*phi)*pi+4*phi*phi*(y-sin(phi))+2*pi*phi-pi2*y}),0)]},pattersonRaw.invert=function(x,y){y>1.790857183?y=1.790857183:y<-1.790857183&&(y=-1.790857183);var delta,yc=y;do{var y2=yc*yc;yc-=delta=(yc*(1.0148+y2*y2*(.23185+y2*(.02406*y2-.14499)))-y)/(1.0148+y2*y2*(5*.23185+y2*(.21654*y2-1.01493)))}while(abs(delta)>epsilon);return[x,yc]},polyconicRaw.invert=function(x,y){if(abs(y)<epsilon)return[x,0];var delta,k=x*x+y*y,phi=.5*y,i=10;do{var tanPhi=tan(phi),secPhi=1/cos(phi),j=k-2*y*phi+phi*phi;phi-=delta=(tanPhi*j+2*(phi-y))/(2+j*secPhi*secPhi+2*(phi-y)*tanPhi)}while(abs(delta)>epsilon&&--i>0);return tanPhi=tan(phi),[(abs(y)<abs(phi+1/tanPhi)?asin(x*tanPhi):sign(y)*sign(x)*(acos(abs(x*tanPhi))+halfPi))/sin(phi),phi]};var octahedron=[[0,90],[-90,0],[0,0],[90,0],[180,0],[0,-90]],octahedron$1=[[0,2,1],[0,3,2],[5,1,2],[5,2,3],[0,1,4],[0,4,3],[5,4,1],[5,3,4]].map((function(face){return face.map((function(i){return octahedron[i]}))})),kx=2/sqrt(3);function collignonK(a,b){var p=collignonRaw(a,b);return[p[0]*kx,p[1]]}function dot(a,b){for(var i=0,n=a.length,s=0;i<n;++i)s+=a[i]*b[i];return s}function spherical(cartesian){return[atan2(cartesian[1],cartesian[0])*degrees,asin(max(-1,min(1,cartesian[2])))*degrees]}function cartesian(coordinates){var lambda=coordinates[0]*radians,phi=coordinates[1]*radians,cosphi=cos(phi);return[cosphi*cos(lambda),cosphi*sin(lambda),sin(phi)]}collignonK.invert=function(x,y){return collignonRaw.invert(x/kx,y)};var noop=()=>{};function projectFeatureCollection(o,stream){return{type:"FeatureCollection",features:o.features.map((function(f){return projectFeature(f,stream)}))}}function projectFeature(o,stream){return{type:"Feature",id:o.id,properties:o.properties,geometry:projectGeometry(o.geometry,stream)}}function projectGeometry(o,stream){if(!o)return null;if("GeometryCollection"===o.type)return function(o,stream){return{type:"GeometryCollection",geometries:o.geometries.map((function(o){return projectGeometry(o,stream)}))}}(o,stream);var sink;switch(o.type){case"Point":case"MultiPoint":sink=sinkPoint;break;case"LineString":case"MultiLineString":sink=sinkLine;break;case"Polygon":case"MultiPolygon":case"Sphere":sink=sinkPolygon;break;default:return null}return d3Geo.geoStream(o,stream(sink)),sink.result()}var points=[],lines=[],sinkPoint={point:function(x,y){points.push([x,y])},result:function(){var result=points.length?points.length<2?{type:"Point",coordinates:points[0]}:{type:"MultiPoint",coordinates:points}:null;return points=[],result}},sinkLine={lineStart:noop,point:function(x,y){points.push([x,y])},lineEnd:function(){points.length&&(lines.push(points),points=[])},result:function(){var result=lines.length?lines.length<2?{type:"LineString",coordinates:lines[0]}:{type:"MultiLineString",coordinates:lines}:null;return lines=[],result}},sinkPolygon={polygonStart:noop,lineStart:noop,point:function(x,y){points.push([x,y])},lineEnd:function(){var n=points.length;if(n){do{points.push(points[0].slice())}while(++n<4);lines.push(points),points=[]}},polygonEnd:noop,result:function(){if(!lines.length)return null;var polygons=[],holes=[];return lines.forEach((function(ring){!function(ring){if((n=ring.length)<4)return!1;for(var n,i=0,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];++i<n;)area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];return area<=0}(ring)?holes.push(ring):polygons.push([ring])})),holes.forEach((function(hole){var point=hole[0];polygons.some((function(polygon){if(function(ring,point){for(var x=point[0],y=point[1],contains=!1,i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];yi>y^yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(contains=!contains)}return contains}(polygon[0],point))return polygon.push(hole),!0}))||polygons.push([hole])})),lines=[],polygons.length?polygons.length>1?{type:"MultiPolygon",coordinates:polygons}:{type:"Polygon",coordinates:polygons[0]}:null}};function quincuncial(project){var dx=project(halfPi,0)[0]-project(-halfPi,0)[0];function projectQuincuncial(lambda,phi){var t=abs(lambda)<halfPi,p=project(t?lambda:lambda>0?lambda-pi:lambda+pi,phi),x=(p[0]-p[1])*sqrt1_2,y=(p[0]+p[1])*sqrt1_2;if(t)return[x,y];var d=dx*sqrt1_2,s=x>0^y>0?-1:1;return[s*x-sign(y)*d,s*y-sign(x)*d]}return project.invert&&(projectQuincuncial.invert=function(x0,y0){var x=(x0+y0)*sqrt1_2,y=(y0-x0)*sqrt1_2,t=abs(x)<.5*dx&&abs(y)<.5*dx;if(!t){var d=dx*sqrt1_2,s=x>0^y>0?-1:1,x1=-s*x0+(y>0?1:-1)*d,y1=-s*y0+(x>0?1:-1)*d;x=(-x1-y1)*sqrt1_2,y=(x1-y1)*sqrt1_2}var p=project.invert(x,y);return t||(p[0]+=x>0?pi:-pi),p}),d3Geo.geoProjection(projectQuincuncial).rotate([-90,-90,45]).clipAngle(179.999)}function rectangularPolyconicRaw(phi0){var sinPhi0=sin(phi0);function forward(lambda,phi){var A=sinPhi0?tan(lambda*sinPhi0/2)/sinPhi0:lambda/2;if(!phi)return[2*A,-phi0];var E=2*atan(A*sin(phi)),cotPhi=1/tan(phi);return[sin(E)*cotPhi,phi+(1-cos(E))*cotPhi-phi0]}return forward.invert=function(x,y){if(abs(y+=phi0)<epsilon)return[sinPhi0?2*atan(sinPhi0*x/2)/sinPhi0:x,0];var delta,k=x*x+y*y,phi=0,i=10;do{var tanPhi=tan(phi),secPhi=1/cos(phi),j=k-2*y*phi+phi*phi;phi-=delta=(tanPhi*j+2*(phi-y))/(2+j*secPhi*secPhi+2*(phi-y)*tanPhi)}while(abs(delta)>epsilon&&--i>0);var E=x*(tanPhi=tan(phi)),A=tan(abs(y)<abs(phi+1/tanPhi)?.5*asin(E):.5*acos(E)+pi/4)/sin(phi);return[sinPhi0?2*atan(sinPhi0*A)/sinPhi0:2*A,phi]},forward}var K$1=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function robinsonRaw(lambda,phi){var k,i=min(18,36*abs(phi)/pi),i0=floor(i),di=i-i0,ax=(k=K$1[i0])[0],ay=k[1],bx=(k=K$1[++i0])[0],by=k[1],cx=(k=K$1[min(19,++i0)])[0],cy=k[1];return[lambda*(bx+di*(cx-ax)/2+di*di*(cx-2*bx+ax)/2),(phi>0?halfPi:-halfPi)*(by+di*(cy-ay)/2+di*di*(cy-2*by+ay)/2)]}function satelliteRaw(P,omega){var vertical=function(P){function forward(lambda,phi){var cosPhi=cos(phi),k=(P-1)/(P-cosPhi*cos(lambda));return[k*cosPhi*sin(lambda),k*sin(phi)]}return forward.invert=function(x,y){var rho2=x*x+y*y,rho=sqrt(rho2),sinc=(P-sqrt(1-rho2*(P+1)/(P-1)))/((P-1)/rho+rho/(P-1));return[atan2(x*sinc,rho*sqrt(1-sinc*sinc)),rho?asin(y*sinc/rho):0]},forward}(P);if(!omega)return vertical;var cosOmega=cos(omega),sinOmega=sin(omega);function forward(lambda,phi){var coordinates=vertical(lambda,phi),y=coordinates[1],A=y*sinOmega/(P-1)+cosOmega;return[coordinates[0]*cosOmega/A,y/A]}return forward.invert=function(x,y){var k=(P-1)/(P-1-y*sinOmega);return vertical.invert(k*x,k*y*cosOmega)},forward}K$1.forEach((function(d){d[1]*=1.0144})),robinsonRaw.invert=function(x,y){var yy=y/halfPi,phi=90*yy,i=min(18,abs(phi/5)),i0=max(0,floor(i));do{var ay=K$1[i0][1],by=K$1[i0+1][1],cy=K$1[min(19,i0+2)][1],u=cy-ay,v=cy-2*by+ay,t=2*(abs(yy)-by)/u,c=v/u,di=t*(1-c*t*(1-2*c*t));if(di>=0||1===i0){phi=(y>=0?5:-5)*(di+i);var delta,j=50;do{di=(i=min(18,abs(phi)/5))-(i0=floor(i)),ay=K$1[i0][1],by=K$1[i0+1][1],cy=K$1[min(19,i0+2)][1],phi-=(delta=(y>=0?halfPi:-halfPi)*(by+di*(cy-ay)/2+di*di*(cy-2*by+ay)/2)-y)*degrees}while(abs(delta)>1e-12&&--j>0);break}}while(--i0>=0);var ax=K$1[i0][0],bx=K$1[i0+1][0],cx=K$1[min(19,i0+2)][0];return[x/(bx+di*(cx-ax)/2+di*di*(cx-2*bx+ax)/2),phi*radians]};var x0e=-179.9999,x1e=179.9999,y0e=-89.9999;function nonempty(coordinates){return coordinates.length>0}function normalizePoint(y){return-90===y||90===y?[0,y]:[-180,(x=y,Math.floor(1e4*x)/1e4)];var x}function clampPoint(p){var x=p[0],y=p[1],clamped=!1;return x<=x0e?(x=-180,clamped=!0):x>=x1e&&(x=180,clamped=!0),y<=y0e?(y=-90,clamped=!0):y>=89.9999&&(y=90,clamped=!0),clamped?[x,y]:p}function clampPoints(points){return points.map(clampPoint)}function extractFragments(rings,polygon,fragments){for(var j=0,m=rings.length;j<m;++j){var ring=rings[j].slice();fragments.push({index:-1,polygon:polygon,ring:ring});for(var i=0,n=ring.length;i<n;++i){var point=ring[i],x=point[0],y=point[1];if(x<=x0e||x>=x1e||y<=y0e||y>=89.9999){ring[i]=clampPoint(point);for(var k=i+1;k<n;++k){var pointk=ring[k],xk=pointk[0],yk=pointk[1];if(xk>x0e&&xk<x1e&&yk>y0e&&yk<89.9999)break}if(k===i+1)continue;if(i){var fragmentBefore={index:-1,polygon:polygon,ring:ring.slice(0,i+1)};fragmentBefore.ring[fragmentBefore.ring.length-1]=normalizePoint(y),fragments[fragments.length-1]=fragmentBefore}else fragments.pop();if(k>=n)break;fragments.push({index:-1,polygon:polygon,ring:ring=ring.slice(k-1)}),ring[0]=normalizePoint(ring[0][1]),i=-1,n=ring.length}}}}function stitchFragments(fragments){var i,fragment,start,startFragment,end,endFragment,n=fragments.length,fragmentByStart={},fragmentByEnd={};for(i=0;i<n;++i)start=(fragment=fragments[i]).ring[0],end=fragment.ring[fragment.ring.length-1],start[0]!==end[0]||start[1]!==end[1]?(fragment.index=i,fragmentByStart[start]=fragmentByEnd[end]=fragment):(fragment.polygon.push(fragment.ring),fragments[i]=null);for(i=0;i<n;++i)if(fragment=fragments[i]){if(start=fragment.ring[0],end=fragment.ring[fragment.ring.length-1],startFragment=fragmentByEnd[start],endFragment=fragmentByStart[end],delete fragmentByStart[start],delete fragmentByEnd[end],start[0]===end[0]&&start[1]===end[1]){fragment.polygon.push(fragment.ring);continue}startFragment?(delete fragmentByEnd[start],delete fragmentByStart[startFragment.ring[0]],startFragment.ring.pop(),fragments[startFragment.index]=null,fragment={index:-1,polygon:startFragment.polygon,ring:startFragment.ring.concat(fragment.ring)},startFragment===endFragment?fragment.polygon.push(fragment.ring):(fragment.index=n++,fragments.push(fragmentByStart[fragment.ring[0]]=fragmentByEnd[fragment.ring[fragment.ring.length-1]]=fragment))):endFragment?(delete fragmentByStart[end],delete fragmentByEnd[endFragment.ring[endFragment.ring.length-1]],fragment.ring.pop(),fragment={index:n++,polygon:endFragment.polygon,ring:fragment.ring.concat(endFragment.ring)},fragments[endFragment.index]=null,fragments.push(fragmentByStart[fragment.ring[0]]=fragmentByEnd[fragment.ring[fragment.ring.length-1]]=fragment)):(fragment.ring.push(fragment.ring[0]),fragment.polygon.push(fragment.ring))}}function stitchFeature(input){var output={type:"Feature",geometry:stitchGeometry(input.geometry)};return null!=input.id&&(output.id=input.id),null!=input.bbox&&(output.bbox=input.bbox),null!=input.properties&&(output.properties=input.properties),output}function stitchGeometry(input){if(null==input)return input;var output,fragments,i,n;switch(input.type){case"GeometryCollection":output={type:"GeometryCollection",geometries:input.geometries.map(stitchGeometry)};break;case"Point":output={type:"Point",coordinates:clampPoint(input.coordinates)};break;case"MultiPoint":case"LineString":output={type:input.type,coordinates:clampPoints(input.coordinates)};break;case"MultiLineString":output={type:"MultiLineString",coordinates:input.coordinates.map(clampPoints)};break;case"Polygon":var polygon=[];extractFragments(input.coordinates,polygon,fragments=[]),stitchFragments(fragments),output={type:"Polygon",coordinates:polygon};break;case"MultiPolygon":fragments=[],i=-1,n=input.coordinates.length;for(var polygons=new Array(n);++i<n;)extractFragments(input.coordinates[i],polygons[i]=[],fragments);stitchFragments(fragments),output={type:"MultiPolygon",coordinates:polygons.filter(nonempty)};break;default:return input}return null!=input.bbox&&(output.bbox=input.bbox),output}function timesRaw(lambda,phi){var t=tan(phi/2),s=sin(quarterPi*t);return[lambda*(.74482-.34588*s*s),1.70711*t]}function twoPoint(raw,p0,p1){var i=d3Geo.geoInterpolate(p0,p1),o=i(.5),a=d3Geo.geoRotation([-o[0],-o[1]])(p0),b=i.distance/2,y=-asin(sin(a[1]*radians)/sin(b)),R=[-o[0],-o[1],-(a[0]>0?pi-y:y)*degrees],p=d3Geo.geoProjection(raw(b)).rotate(R),r=d3Geo.geoRotation(R),center=p.center;return delete p.rotate,p.center=function(_){return arguments.length?center(r(_)):r.invert(center())},p.clipAngle(90)}function twoPointAzimuthalRaw(d){var cosd=cos(d);function forward(lambda,phi){var coordinates=d3Geo.geoGnomonicRaw(lambda,phi);return coordinates[0]*=cosd,coordinates}return forward.invert=function(x,y){return d3Geo.geoGnomonicRaw.invert(x/cosd,y)},forward}function twoPointAzimuthal(p0,p1){return twoPoint(twoPointAzimuthalRaw,p0,p1)}function twoPointEquidistantRaw(z0){if(!(z0*=2))return d3Geo.geoAzimuthalEquidistantRaw;var lambdaa=-z0/2,lambdab=-lambdaa,z02=z0*z0,tanLambda0=tan(lambdab),S=.5/sin(lambdab);function forward(lambda,phi){var za=acos(cos(phi)*cos(lambda-lambdaa)),zb=acos(cos(phi)*cos(lambda-lambdab));return[((za*=za)-(zb*=zb))/(2*z0),(phi<0?-1:1)*sqrt(4*z02*zb-(z02-za+zb)*(z02-za+zb))/(2*z0)]}return forward.invert=function(x,y){var t,d,y2=y*y,cosza=cos(sqrt(y2+(t=x+lambdaa)*t)),coszb=cos(sqrt(y2+(t=x+lambdab)*t));return[atan2(d=cosza-coszb,t=(cosza+coszb)*tanLambda0),(y<0?-1:1)*acos(sqrt(t*t+d*d)*S)]},forward}function twoPointEquidistant(p0,p1){return twoPoint(twoPointEquidistantRaw,p0,p1)}function vanDerGrintenRaw(lambda,phi){if(abs(phi)<epsilon)return[lambda,0];var sinTheta=abs(phi/halfPi),theta=asin(sinTheta);if(abs(lambda)<epsilon||abs(abs(phi)-halfPi)<epsilon)return[0,sign(phi)*pi*tan(theta/2)];var cosTheta=cos(theta),A=abs(pi/lambda-lambda/pi)/2,A2=A*A,G=cosTheta/(sinTheta+cosTheta-1),P=G*(2/sinTheta-1),P2=P*P,P2_A2=P2+A2,G_P2=G-P2,Q=A2+G;return[sign(lambda)*pi*(A*G_P2+sqrt(A2*G_P2*G_P2-P2_A2*(G*G-P2)))/P2_A2,sign(phi)*pi*(P*Q-A*sqrt((A2+1)*P2_A2-Q*Q))/P2_A2]}function vanDerGrinten2Raw(lambda,phi){if(abs(phi)<epsilon)return[lambda,0];var sinTheta=abs(phi/halfPi),theta=asin(sinTheta);if(abs(lambda)<epsilon||abs(abs(phi)-halfPi)<epsilon)return[0,sign(phi)*pi*tan(theta/2)];var cosTheta=cos(theta),A=abs(pi/lambda-lambda/pi)/2,A2=A*A,x1=cosTheta*(sqrt(1+A2)-A*cosTheta)/(1+A2*sinTheta*sinTheta);return[sign(lambda)*pi*x1,sign(phi)*pi*sqrt(1-x1*(2*A+x1))]}function vanDerGrinten3Raw(lambda,phi){if(abs(phi)<epsilon)return[lambda,0];var sinTheta=phi/halfPi,theta=asin(sinTheta);if(abs(lambda)<epsilon||abs(abs(phi)-halfPi)<epsilon)return[0,pi*tan(theta/2)];var A=(pi/lambda-lambda/pi)/2,y1=sinTheta/(1+cos(theta));return[pi*(sign(lambda)*sqrt(A*A+1-y1*y1)-A),pi*y1]}function vanDerGrinten4Raw(lambda,phi){if(!phi)return[lambda,0];var phi0=abs(phi);if(!lambda||phi0===halfPi)return[0,phi];var B=phi0/halfPi,B2=B*B,C=(8*B-B2*(B2+2)-5)/(2*B2*(B-1)),C2=C*C,BC=B*C,B_C2=B2+C2+2*BC,B_3C=B+3*C,lambda0=lambda/halfPi,lambda1=lambda0+1/lambda0,D=sign(abs(lambda)-halfPi)*sqrt(lambda1*lambda1-4),D2=D*D,x1=(D*(B_C2+C2-1)+2*sqrt(B_C2*(B2+C2*D2-1)+(1-B2)*(B2*(B_3C*B_3C+4*C2)+12*BC*C2+4*C2*C2)))/(4*B_C2+D2);return[sign(lambda)*halfPi*x1,sign(phi)*halfPi*sqrt(1+D*abs(x1)-x1*x1)]}function wagnerRaw(poleline,parallels,inflation,ratio){var phi1=pi/3;poleline=max(poleline,epsilon),parallels=max(parallels,epsilon),poleline=min(poleline,halfPi),parallels=min(parallels,pi-epsilon),inflation=max(inflation,0),inflation=min(inflation,100-epsilon);var vratio=(ratio=max(ratio,epsilon))/100,m2=acos((inflation/100+1)*cos(phi1))/phi1,m1=sin(poleline)/sin(m2*halfPi),n=parallels/pi,k=sqrt(vratio*sin(poleline/2)/sin(parallels/2));return function(cx,cy,m1,m2,n){function forward(lambda,phi){var s=m1*sin(m2*phi),c0=sqrt(1-s*s),c1=sqrt(2/(1+c0*cos(lambda*=n)));return[cx*c0*c1*sin(lambda),cy*s*c1]}return forward.invert=function(x,y){var t1=x/cx,t2=y/cy,p=sqrt(t1*t1+t2*t2),c=2*asin(p/2);return[atan2(x*tan(c),cx*p)/n,p&&asin(y*sin(c)/(cy*m1*p))/m2]},forward}(k/sqrt(n*m1*m2),1/(k*sqrt(n*m1*m2)),m1,m2,n)}function wagner(){var poleline=65*radians,parallels=60*radians,inflation=20,ratio=200,mutate=d3Geo.geoProjectionMutator(wagnerRaw),projection=mutate(poleline,parallels,inflation,ratio);return projection.poleline=function(_){return arguments.length?mutate(poleline=+_*radians,parallels,inflation,ratio):poleline*degrees},projection.parallels=function(_){return arguments.length?mutate(poleline,parallels=+_*radians,inflation,ratio):parallels*degrees},projection.inflation=function(_){return arguments.length?mutate(poleline,parallels,inflation=+_,ratio):inflation},projection.ratio=function(_){return arguments.length?mutate(poleline,parallels,inflation,ratio=+_):ratio},projection.scale(163.775)}timesRaw.invert=function(x,y){var t=y/1.70711,s=sin(quarterPi*t);return[x/(.74482-.34588*s*s),2*atan(t)]},vanDerGrintenRaw.invert=function(x,y){if(abs(y)<epsilon)return[x,0];if(abs(x)<epsilon)return[0,halfPi*sin(2*atan(y/pi))];var x2=(x/=pi)*x,y2=(y/=pi)*y,x2_y2=x2+y2,z=x2_y2*x2_y2,c1=-abs(y)*(1+x2_y2),c2=c1-2*y2+x2,c3=-2*c1+1+2*y2+z,d=y2/c3+(2*c2*c2*c2/(c3*c3*c3)-9*c1*c2/(c3*c3))/27,a1=(c1-c2*c2/(3*c3))/c3,m1=2*sqrt(-a1/3),theta1=acos(3*d/(a1*m1))/3;return[pi*(x2_y2-1+sqrt(1+2*(x2-y2)+z))/(2*x),sign(y)*pi*(-m1*cos(theta1+pi/3)-c2/(3*c3))]},vanDerGrinten2Raw.invert=function(x,y){if(!x)return[0,halfPi*sin(2*atan(y/pi))];var x1=abs(x/pi),A=(1-x1*x1-(y/=pi)*y)/(2*x1),B=sqrt(A*A+1);return[sign(x)*pi*(B-A),sign(y)*halfPi*sin(2*atan2(sqrt((1-2*A*x1)*(A+B)-x1),sqrt(B+A+x1)))]},vanDerGrinten3Raw.invert=function(x,y){if(!y)return[x,0];var y1=y/pi,A=(pi*pi*(1-y1*y1)-x*x)/(2*pi*x);return[x?pi*(sign(x)*sqrt(A*A+1)-A):0,halfPi*sin(2*atan(y1))]},vanDerGrinten4Raw.invert=function(x,y){var delta;if(!x||!y)return[x,y];var sy=sign(y);y=abs(y)/pi;var x1=sign(x)*x/halfPi,D=(x1*x1-1+4*y*y)/abs(x1),D2=D*D,B=y*(2-(y>.5?min(y,abs(x)):0)),r=x*x+y*y,i=50;do{var B2=B*B,C=(8*B-B2*(B2+2)-5)/(2*B2*(B-1)),C_=(3*B-B2*B-10)/(2*B2*B),C2=C*C,BC=B*C,B_C=B+C,B_C2=B_C*B_C,B_3C=B+3*C,F_=-2*B_C*(4*BC*C2+(1-4*B2+3*B2*B2)*(1+C_)+C2*(14*B2-6-D2+(8*B2-8-2*D2)*C_)+BC*(12*B2-8+(10*B2-10-D2)*C_)),sqrtF=sqrt(B_C2*(B2+C2*D2-1)+(1-B2)*(B2*(B_3C*B_3C+4*C2)+C2*(12*BC+4*C2)));B-=delta=(D*(B_C2+C2-1)+2*sqrtF-x1*(4*B_C2+D2))/(D*(2*C*C_+2*B_C*(1+C_))+F_/sqrtF-8*B_C*(D*(-1+C2+B_C2)+2*sqrtF)*(1+C_)/(D2+4*B_C2))}while(delta*r*r>epsilon&&--i>0);return[sign(x)*(sqrt(D*D+4)+D)*pi/4,sy*halfPi*B]};var A=4*pi+3*sqrt(3),B=2*sqrt(2*pi*sqrt(3)/A),wagner4Raw=mollweideBromleyRaw(B*sqrt(3)/pi,B,A/6);function wagner6Raw(lambda,phi){return[lambda*sqrt(1-3*phi*phi/(pi*pi)),phi]}function wiechelRaw(lambda,phi){var cosPhi=cos(phi),sinPhi=cos(lambda)*cosPhi,sin1_Phi=1-sinPhi,cosLambda=cos(lambda=atan2(sin(lambda)*cosPhi,-sin(phi))),sinLambda=sin(lambda);return[sinLambda*(cosPhi=sqrt(1-sinPhi*sinPhi))-cosLambda*sin1_Phi,-cosLambda*cosPhi-sinLambda*sin1_Phi]}function winkel3Raw(lambda,phi){var coordinates=aitoffRaw(lambda,phi);return[(coordinates[0]+lambda/halfPi)/2,(coordinates[1]+phi)/2]}wagner6Raw.invert=function(x,y){return[x/sqrt(1-3*y*y/(pi*pi)),y]},wiechelRaw.invert=function(x,y){var w=(x*x+y*y)/-2,k=sqrt(-w*(2+w)),b=y*w+x*k,a=x*w-y*k,D=sqrt(a*a+b*b);return[atan2(k*b,D*(1+w)),D?-asin(k*a/D):0]},winkel3Raw.invert=function(x,y){var lambda=x,phi=y,i=25;do{var F,cosphi=cos(phi),sinphi=sin(phi),sin_2phi=sin(2*phi),sin2phi=sinphi*sinphi,cos2phi=cosphi*cosphi,sinlambda=sin(lambda),coslambda_2=cos(lambda/2),sinlambda_2=sin(lambda/2),sin2lambda_2=sinlambda_2*sinlambda_2,C=1-cos2phi*coslambda_2*coslambda_2,E=C?acos(cosphi*coslambda_2)*sqrt(F=1/C):F=0,fx=.5*(2*E*cosphi*sinlambda_2+lambda/halfPi)-x,fy=.5*(E*sinphi+phi)-y,dxdlambda=.5*F*(cos2phi*sin2lambda_2+E*cosphi*coslambda_2*sin2phi)+.5/halfPi,dxdphi=F*(sinlambda*sin_2phi/4-E*sinphi*sinlambda_2),dydlambda=.125*F*(sin_2phi*sinlambda_2-E*sinphi*cos2phi*sinlambda),dydphi=.5*F*(sin2phi*coslambda_2+E*sin2lambda_2*cosphi)+.5,denominator=dxdphi*dydlambda-dydphi*dxdlambda,dlambda=(fy*dxdphi-fx*dydphi)/denominator,dphi=(fx*dydlambda-fy*dxdlambda)/denominator;lambda-=dlambda,phi-=dphi}while((abs(dlambda)>epsilon||abs(dphi)>epsilon)&&--i>0);return[lambda,phi]},exports.geoAiry=function(){var beta=halfPi,m=d3Geo.geoProjectionMutator(airyRaw),p=m(beta);return p.radius=function(_){return arguments.length?m(beta=_*radians):beta*degrees},p.scale(179.976).clipAngle(147)},exports.geoAiryRaw=airyRaw,exports.geoAitoff=function(){return d3Geo.geoProjection(aitoffRaw).scale(152.63)},exports.geoAitoffRaw=aitoffRaw,exports.geoArmadillo=function(){var phi0=20*radians,sPhi0=phi0>=0?1:-1,tanPhi0=tan(sPhi0*phi0),m=d3Geo.geoProjectionMutator(armadilloRaw),p=m(phi0),stream_=p.stream;return p.parallel=function(_){return arguments.length?(tanPhi0=tan((sPhi0=(phi0=_*radians)>=0?1:-1)*phi0),m(phi0)):phi0*degrees},p.stream=function(stream){var rotate=p.rotate(),rotateStream=stream_(stream),sphereStream=(p.rotate([0,0]),stream_(stream)),precision=p.precision();return p.rotate(rotate),rotateStream.sphere=function(){sphereStream.polygonStart(),sphereStream.lineStart();for(var lambda=-180*sPhi0;sPhi0*lambda<180;lambda+=90*sPhi0)sphereStream.point(lambda,90*sPhi0);if(phi0)for(;sPhi0*(lambda-=3*sPhi0*precision)>=-180;)sphereStream.point(lambda,sPhi0*-atan2(cos(lambda*radians/2),tanPhi0)*degrees);sphereStream.lineEnd(),sphereStream.polygonEnd()},rotateStream},p.scale(218.695).center([0,28.0974])},exports.geoArmadilloRaw=armadilloRaw,exports.geoAugust=function(){return d3Geo.geoProjection(augustRaw).scale(66.1603)},exports.geoAugustRaw=augustRaw,exports.geoBaker=function(){return d3Geo.geoProjection(bakerRaw).scale(112.314)},exports.geoBakerRaw=bakerRaw,exports.geoBerghaus=function(){var lobes=5,m=d3Geo.geoProjectionMutator(berghausRaw),p=m(lobes),projectionStream=p.stream,cr=-cos(.01*radians),sr=sin(.01*radians);return p.lobes=function(_){return arguments.length?m(lobes=+_):lobes},p.stream=function(stream){var rotate=p.rotate(),rotateStream=projectionStream(stream),sphereStream=(p.rotate([0,0]),projectionStream(stream));return p.rotate(rotate),rotateStream.sphere=function(){sphereStream.polygonStart(),sphereStream.lineStart();for(var i=0,delta=360/lobes,delta0=2*pi/lobes,phi=90-180/lobes,phi0=halfPi;i<lobes;++i,phi-=delta,phi0-=delta0)sphereStream.point(atan2(sr*cos(phi0),cr)*degrees,asin(sr*sin(phi0))*degrees),phi<-90?(sphereStream.point(-90,-180-phi-.01),sphereStream.point(-90,-180-phi+.01)):(sphereStream.point(90,phi+.01),sphereStream.point(90,phi-.01));sphereStream.lineEnd(),sphereStream.polygonEnd()},rotateStream},p.scale(87.8076).center([0,17.1875]).clipAngle(179.999)},exports.geoBerghausRaw=berghausRaw,exports.geoBertin1953=function(){return d3Geo.geoProjection(bertin1953Raw()).rotate([-16.5,-42]).scale(176.57).center([7.93,.09])},exports.geoBertin1953Raw=bertin1953Raw,exports.geoBoggs=function(){return d3Geo.geoProjection(boggsRaw).scale(160.857)},exports.geoBoggsRaw=boggsRaw,exports.geoBonne=function(){return parallel1(bonneRaw).scale(123.082).center([0,26.1441]).parallel(45)},exports.geoBonneRaw=bonneRaw,exports.geoBottomley=function(){var sinPsi=.5,m=d3Geo.geoProjectionMutator(bottomleyRaw),p=m(sinPsi);return p.fraction=function(_){return arguments.length?m(sinPsi=+_):sinPsi},p.scale(158.837)},exports.geoBottomleyRaw=bottomleyRaw,exports.geoBromley=function(){return d3Geo.geoProjection(bromleyRaw).scale(152.63)},exports.geoBromleyRaw=bromleyRaw,exports.geoChamberlin=chamberlin,exports.geoChamberlinRaw=chamberlinRaw,exports.geoChamberlinAfrica=function(){return chamberlin([0,22],[45,22],[22.5,-22]).scale(380).center([22.5,2])},exports.geoCollignon=function(){return d3Geo.geoProjection(collignonRaw).scale(95.6464).center([0,30])},exports.geoCollignonRaw=collignonRaw,exports.geoCraig=function(){return parallel1(craigRaw).scale(249.828).clipAngle(90)},exports.geoCraigRaw=craigRaw,exports.geoCraster=function(){return d3Geo.geoProjection(crasterRaw).scale(156.19)},exports.geoCrasterRaw=crasterRaw,exports.geoCylindricalEqualArea=function(){return parallel1(cylindricalEqualAreaRaw).parallel(38.58).scale(195.044)},exports.geoCylindricalEqualAreaRaw=cylindricalEqualAreaRaw,exports.geoCylindricalStereographic=function(){return parallel1(cylindricalStereographicRaw).scale(124.75)},exports.geoCylindricalStereographicRaw=cylindricalStereographicRaw,exports.geoEckert1=function(){return d3Geo.geoProjection(eckert1Raw).scale(165.664)},exports.geoEckert1Raw=eckert1Raw,exports.geoEckert2=function(){return d3Geo.geoProjection(eckert2Raw).scale(165.664)},exports.geoEckert2Raw=eckert2Raw,exports.geoEckert3=function(){return d3Geo.geoProjection(eckert3Raw).scale(180.739)},exports.geoEckert3Raw=eckert3Raw,exports.geoEckert4=function(){return d3Geo.geoProjection(eckert4Raw).scale(180.739)},exports.geoEckert4Raw=eckert4Raw,exports.geoEckert5=function(){return d3Geo.geoProjection(eckert5Raw).scale(173.044)},exports.geoEckert5Raw=eckert5Raw,exports.geoEckert6=function(){return d3Geo.geoProjection(eckert6Raw).scale(173.044)},exports.geoEckert6Raw=eckert6Raw,exports.geoEisenlohr=function(){return d3Geo.geoProjection(eisenlohrRaw).scale(62.5271)},exports.geoEisenlohrRaw=eisenlohrRaw,exports.geoFahey=function(){return d3Geo.geoProjection(faheyRaw).scale(137.152)},exports.geoFaheyRaw=faheyRaw,exports.geoFoucaut=function(){return d3Geo.geoProjection(foucautRaw).scale(135.264)},exports.geoFoucautRaw=foucautRaw,exports.geoFoucautSinusoidal=function(){var alpha=.5,m=d3Geo.geoProjectionMutator(foucautSinusoidalRaw),p=m(alpha);return p.alpha=function(_){return arguments.length?m(alpha=+_):alpha},p.scale(168.725)},exports.geoFoucautSinusoidalRaw=foucautSinusoidalRaw,exports.geoGilbert=function(projectionType){null==projectionType&&(projectionType=d3Geo.geoOrthographic);var projection=projectionType(),equirectangular=d3Geo.geoEquirectangular().scale(degrees).precision(0).clipAngle(null).translate([0,0]);function gilbert(point){return projection(gilbertForward(point))}function property(name){gilbert[name]=function(){return arguments.length?(projection[name].apply(projection,arguments),gilbert):projection[name]()}}return projection.invert&&(gilbert.invert=function(point){return gilbertInvert(projection.invert(point))}),gilbert.stream=function(stream){var s1=projection.stream(stream),s0=equirectangular.stream({point:function(lambda,phi){s1.point(lambda/2,asin(tan(-phi/2*radians))*degrees)},lineStart:function(){s1.lineStart()},lineEnd:function(){s1.lineEnd()},polygonStart:function(){s1.polygonStart()},polygonEnd:function(){s1.polygonEnd()}});return s0.sphere=s1.sphere,s0},gilbert.rotate=function(_){return arguments.length?(equirectangular.rotate(_),gilbert):equirectangular.rotate()},gilbert.center=function(_){return arguments.length?(projection.center(gilbertForward(_)),gilbert):gilbertInvert(projection.center())},property("angle"),property("clipAngle"),property("clipExtent"),property("fitExtent"),property("fitHeight"),property("fitSize"),property("fitWidth"),property("scale"),property("translate"),property("precision"),gilbert.scale(249.5)},exports.geoGingery=function(){var n=6,rho=30*radians,cRho=cos(rho),sRho=sin(rho),m=d3Geo.geoProjectionMutator(gingeryRaw),p=m(rho,n),stream_=p.stream,cr=-cos(.01*radians),sr=sin(.01*radians);return p.radius=function(_){return arguments.length?(cRho=cos(rho=_*radians),sRho=sin(rho),m(rho,n)):rho*degrees},p.lobes=function(_){return arguments.length?m(rho,n=+_):n},p.stream=function(stream){var rotate=p.rotate(),rotateStream=stream_(stream),sphereStream=(p.rotate([0,0]),stream_(stream));return p.rotate(rotate),rotateStream.sphere=function(){sphereStream.polygonStart(),sphereStream.lineStart();for(var i=0,delta=2*pi/n,phi=0;i<n;++i,phi-=delta)sphereStream.point(atan2(sr*cos(phi),cr)*degrees,asin(sr*sin(phi))*degrees),sphereStream.point(atan2(sRho*cos(phi-delta/2),cRho)*degrees,asin(sRho*sin(phi-delta/2))*degrees);sphereStream.lineEnd(),sphereStream.polygonEnd()},rotateStream},p.rotate([90,-40]).scale(91.7095).clipAngle(179.999)},exports.geoGingeryRaw=gingeryRaw,exports.geoGinzburg4=function(){return d3Geo.geoProjection(ginzburg4Raw).scale(149.995)},exports.geoGinzburg4Raw=ginzburg4Raw,exports.geoGinzburg5=function(){return d3Geo.geoProjection(ginzburg5Raw).scale(153.93)},exports.geoGinzburg5Raw=ginzburg5Raw,exports.geoGinzburg6=function(){return d3Geo.geoProjection(ginzburg6Raw).scale(130.945)},exports.geoGinzburg6Raw=ginzburg6Raw,exports.geoGinzburg8=function(){return d3Geo.geoProjection(ginzburg8Raw).scale(131.747)},exports.geoGinzburg8Raw=ginzburg8Raw,exports.geoGinzburg9=function(){return d3Geo.geoProjection(ginzburg9Raw).scale(131.087)},exports.geoGinzburg9Raw=ginzburg9Raw,exports.geoGringorten=function(){return d3Geo.geoProjection(squareRaw(gringortenRaw)).scale(239.75)},exports.geoGringortenRaw=gringortenRaw,exports.geoGuyou=function(){return d3Geo.geoProjection(squareRaw(guyouRaw)).scale(151.496)},exports.geoGuyouRaw=guyouRaw,exports.geoHammer=function(){var B=2,m=d3Geo.geoProjectionMutator(hammerRaw),p=m(B);return p.coefficient=function(_){return arguments.length?m(B=+_):B},p.scale(169.529)},exports.geoHammerRaw=hammerRaw,exports.geoHammerRetroazimuthal=function(){var phi0=0,m=d3Geo.geoProjectionMutator(hammerRetroazimuthalRaw),p=m(phi0),rotate_=p.rotate,stream_=p.stream,circle=d3Geo.geoCircle();return p.parallel=function(_){if(!arguments.length)return phi0*degrees;var r=p.rotate();return m(phi0=_*radians).rotate(r)},p.rotate=function(_){return arguments.length?(rotate_.call(p,[_[0],_[1]-phi0*degrees]),circle.center([-_[0],-_[1]]),p):((_=rotate_.call(p))[1]+=phi0*degrees,_)},p.stream=function(stream){return(stream=stream_(stream)).sphere=function(){stream.polygonStart();var p,ring=circle.radius(89.99)().coordinates[0],n=ring.length-1,i=-1;for(stream.lineStart();++i<n;)stream.point((p=ring[i])[0],p[1]);for(stream.lineEnd(),n=(ring=circle.radius(90.01)().coordinates[0]).length-1,stream.lineStart();--i>=0;)stream.point((p=ring[i])[0],p[1]);stream.lineEnd(),stream.polygonEnd()},stream},p.scale(79.4187).parallel(45).clipAngle(179.999)},exports.geoHammerRetroazimuthalRaw=hammerRetroazimuthalRaw,exports.geoHealpix=function(){var H=4,m=d3Geo.geoProjectionMutator(healpixRaw),p=m(H),stream_=p.stream;return p.lobes=function(_){return arguments.length?m(H=+_):H},p.stream=function(stream){var rotate=p.rotate(),rotateStream=stream_(stream),sphereStream=(p.rotate([0,0]),stream_(stream));return p.rotate(rotate),rotateStream.sphere=function(){var step,c;d3Geo.geoStream((step=180/H,c=[].concat(d3Array.range(-180,180+step/2,step).map(sphereTop),d3Array.range(180,-180-step/2,-step).map(sphereBottom)),{type:"Polygon",coordinates:[180===step?c.map(sphereNudge):c]}),sphereStream)},rotateStream},p.scale(239.75)},exports.geoHealpixRaw=healpixRaw,exports.geoHill=function(){var K=1,m=d3Geo.geoProjectionMutator(hillRaw),p=m(K);return p.ratio=function(_){return arguments.length?m(K=+_):K},p.scale(167.774).center([0,18.67])},exports.geoHillRaw=hillRaw,exports.geoHomolosine=function(){return d3Geo.geoProjection(homolosineRaw).scale(152.63)},exports.geoHomolosineRaw=homolosineRaw,exports.geoHufnagel=function(){var a=1,b=0,psiMax=45*radians,ratio=2,mutate=d3Geo.geoProjectionMutator(hufnagelRaw),projection=mutate(a,b,psiMax,ratio);return projection.a=function(_){return arguments.length?mutate(a=+_,b,psiMax,ratio):a},projection.b=function(_){return arguments.length?mutate(a,b=+_,psiMax,ratio):b},projection.psiMax=function(_){return arguments.length?mutate(a,b,psiMax=+_*radians,ratio):psiMax*degrees},projection.ratio=function(_){return arguments.length?mutate(a,b,psiMax,ratio=+_):ratio},projection.scale(180.739)},exports.geoHufnagelRaw=hufnagelRaw,exports.geoHyperelliptical=function(){var alpha=0,k=2.5,gamma=1.183136,m=d3Geo.geoProjectionMutator(hyperellipticalRaw),p=m(alpha,k,gamma);return p.alpha=function(_){return arguments.length?m(alpha=+_,k,gamma):alpha},p.k=function(_){return arguments.length?m(alpha,k=+_,gamma):k},p.gamma=function(_){return arguments.length?m(alpha,k,gamma=+_):gamma},p.scale(152.63)},exports.geoHyperellipticalRaw=hyperellipticalRaw,exports.geoInterrupt=interrupt,exports.geoInterruptedBoggs=function(){return interrupt(boggsRaw,lobes).scale(160.857)},exports.geoInterruptedHomolosine=function(){return interrupt(homolosineRaw,lobes$1).scale(152.63)},exports.geoInterruptedMollweide=function(){return interrupt(mollweideRaw,lobes$2).scale(169.529)},exports.geoInterruptedMollweideHemispheres=function(){return interrupt(mollweideRaw,lobes$3).scale(169.529).rotate([20,0])},exports.geoInterruptedSinuMollweide=function(){return interrupt(sinuMollweideRaw,lobes$4,solve2d).rotate([-20,-55]).scale(164.263).center([0,-5.4036])},exports.geoInterruptedSinusoidal=function(){return interrupt(sinusoidalRaw,lobes$5).scale(152.63).rotate([-20,0])},exports.geoKavrayskiy7=function(){return d3Geo.geoProjection(kavrayskiy7Raw).scale(158.837)},exports.geoKavrayskiy7Raw=kavrayskiy7Raw,exports.geoLagrange=function(){var n=.5,m=d3Geo.geoProjectionMutator(lagrangeRaw),p=m(n);return p.spacing=function(_){return arguments.length?m(n=+_):n},p.scale(124.75)},exports.geoLagrangeRaw=lagrangeRaw,exports.geoLarrivee=function(){return d3Geo.geoProjection(larriveeRaw).scale(97.2672)},exports.geoLarriveeRaw=larriveeRaw,exports.geoLaskowski=function(){return d3Geo.geoProjection(laskowskiRaw).scale(139.98)},exports.geoLaskowskiRaw=laskowskiRaw,exports.geoLittrow=function(){return d3Geo.geoProjection(littrowRaw).scale(144.049).clipAngle(89.999)},exports.geoLittrowRaw=littrowRaw,exports.geoLoximuthal=function(){return parallel1(loximuthalRaw).parallel(40).scale(158.837)},exports.geoLoximuthalRaw=loximuthalRaw,exports.geoMiller=function(){return d3Geo.geoProjection(millerRaw).scale(108.318)},exports.geoMillerRaw=millerRaw,exports.geoModifiedStereographic=modifiedStereographic,exports.geoModifiedStereographicRaw=modifiedStereographicRaw,exports.geoModifiedStereographicAlaska=function(){return modifiedStereographic(alaska,[152,-64]).scale(1400).center([-160.908,62.4864]).clipAngle(30).angle(7.8)},exports.geoModifiedStereographicGs48=function(){return modifiedStereographic(gs48,[95,-38]).scale(1e3).clipAngle(55).center([-96.5563,38.8675])},exports.geoModifiedStereographicGs50=function(){return modifiedStereographic(gs50,[120,-45]).scale(359.513).clipAngle(55).center([-117.474,53.0628])},exports.geoModifiedStereographicMiller=function(){return modifiedStereographic(miller$1,[-20,-18]).scale(209.091).center([20,16.7214]).clipAngle(82)},exports.geoModifiedStereographicLee=function(){return modifiedStereographic(lee,[165,10]).scale(250).clipAngle(130).center([-165,-10])},exports.geoMollweide=function(){return d3Geo.geoProjection(mollweideRaw).scale(169.529)},exports.geoMollweideRaw=mollweideRaw,exports.geoMtFlatPolarParabolic=function(){return d3Geo.geoProjection(mtFlatPolarParabolicRaw).scale(164.859)},exports.geoMtFlatPolarParabolicRaw=mtFlatPolarParabolicRaw,exports.geoMtFlatPolarQuartic=function(){return d3Geo.geoProjection(mtFlatPolarQuarticRaw).scale(188.209)},exports.geoMtFlatPolarQuarticRaw=mtFlatPolarQuarticRaw,exports.geoMtFlatPolarSinusoidal=function(){return d3Geo.geoProjection(mtFlatPolarSinusoidalRaw).scale(166.518)},exports.geoMtFlatPolarSinusoidalRaw=mtFlatPolarSinusoidalRaw,exports.geoNaturalEarth2=function(){return d3Geo.geoProjection(naturalEarth2Raw).scale(175.295)},exports.geoNaturalEarth2Raw=naturalEarth2Raw,exports.geoNellHammer=function(){return d3Geo.geoProjection(nellHammerRaw).scale(152.63)},exports.geoNellHammerRaw=nellHammerRaw,exports.geoInterruptedQuarticAuthalic=function(){return interrupt(hammerRaw(1/0),lobes$6).rotate([20,0]).scale(152.63)},exports.geoNicolosi=function(){return d3Geo.geoProjection(nicolosiRaw).scale(127.267)},exports.geoNicolosiRaw=nicolosiRaw,exports.geoPatterson=function(){return d3Geo.geoProjection(pattersonRaw).scale(139.319)},exports.geoPattersonRaw=pattersonRaw,exports.geoPolyconic=function(){return d3Geo.geoProjection(polyconicRaw).scale(103.74)},exports.geoPolyconicRaw=polyconicRaw,exports.geoPolyhedral=polyhedral,exports.geoPolyhedralButterfly=function(faceProjection){faceProjection=faceProjection||function(face){var c=d3Geo.geoCentroid({type:"MultiPoint",coordinates:face});return d3Geo.geoGnomonic().scale(1).translate([0,0]).rotate([-c[0],-c[1]])};var faces=octahedron$1.map((function(face){return{face:face,project:faceProjection(face)}}));return[-1,0,0,1,0,1,4,5].forEach((function(d,i){var node=faces[d];node&&(node.children||(node.children=[])).push(faces[i])})),polyhedral(faces[0],(function(lambda,phi){return faces[lambda<-pi/2?phi<0?6:4:lambda<0?phi<0?2:0:lambda<pi/2?phi<0?3:1:phi<0?7:5]})).angle(-30).scale(101.858).center([0,45])},exports.geoPolyhedralCollignon=function(faceProjection){faceProjection=faceProjection||function(face){var c=d3Geo.geoCentroid({type:"MultiPoint",coordinates:face});return d3Geo.geoProjection(collignonK).translate([0,0]).scale(1).rotate(c[1]>0?[-c[0],0]:[180-c[0],180])};var faces=octahedron$1.map((function(face){return{face:face,project:faceProjection(face)}}));return[-1,0,0,1,0,1,4,5].forEach((function(d,i){var node=faces[d];node&&(node.children||(node.children=[])).push(faces[i])})),polyhedral(faces[0],(function(lambda,phi){return faces[lambda<-pi/2?phi<0?6:4:lambda<0?phi<0?2:0:lambda<pi/2?phi<0?3:1:phi<0?7:5]})).angle(-30).scale(121.906).center([0,48.5904])},exports.geoPolyhedralWaterman=function(faceProjection){faceProjection=faceProjection||function(face){var c=6===face.length?d3Geo.geoCentroid({type:"MultiPoint",coordinates:face}):face[0];return d3Geo.geoGnomonic().scale(1).translate([0,0]).rotate([-c[0],-c[1]])};var w5=octahedron$1.map((function(face){for(var b,xyz=face.map(cartesian),n=xyz.length,a=xyz[n-1],hexagon=[],i=0;i<n;++i)b=xyz[i],hexagon.push(spherical([.9486832980505138*a[0]+.31622776601683794*b[0],.9486832980505138*a[1]+.31622776601683794*b[1],.9486832980505138*a[2]+.31622776601683794*b[2]]),spherical([.9486832980505138*b[0]+.31622776601683794*a[0],.9486832980505138*b[1]+.31622776601683794*a[1],.9486832980505138*b[2]+.31622776601683794*a[2]])),a=b;return hexagon})),cornerNormals=[],parents=[-1,0,0,1,0,1,4,5];w5.forEach((function(hexagon,j){for(var a,b,face=octahedron$1[j],n=face.length,normals=cornerNormals[j]=[],i=0;i<n;++i)w5.push([face[i],hexagon[(2*i+2)%(2*n)],hexagon[(2*i+1)%(2*n)]]),parents.push(j),normals.push((a=cartesian(hexagon[(2*i+2)%(2*n)]),b=cartesian(hexagon[(2*i+1)%(2*n)]),[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]))}));var faces=w5.map((function(face){return{project:faceProjection(face),face:face}}));return parents.forEach((function(d,i){var parent=faces[d];parent&&(parent.children||(parent.children=[])).push(faces[i])})),polyhedral(faces[0],(function(lambda,phi){var cosphi=cos(phi),p=[cosphi*cos(lambda),cosphi*sin(lambda),sin(phi)],hexagon=lambda<-pi/2?phi<0?6:4:lambda<0?phi<0?2:0:lambda<pi/2?phi<0?3:1:phi<0?7:5,n=cornerNormals[hexagon];return faces[dot(n[0],p)<0?8+3*hexagon:dot(n[1],p)<0?8+3*hexagon+1:dot(n[2],p)<0?8+3*hexagon+2:hexagon]})).angle(-30).scale(110.625).center([0,45])},exports.geoProject=function(object,projection){var project,stream=projection.stream;if(!stream)throw new Error("invalid projection");switch(object&&object.type){case"Feature":project=projectFeature;break;case"FeatureCollection":project=projectFeatureCollection;break;default:project=projectGeometry}return project(object,stream)},exports.geoGringortenQuincuncial=function(){return quincuncial(gringortenRaw).scale(176.423)},exports.geoPeirceQuincuncial=function(){return quincuncial(guyouRaw).scale(111.48)},exports.geoQuantize=function(input,digits){if(!(0<=(digits=+digits)&&digits<=20))throw new Error("invalid digits");function quantizePoint(input){var n=input.length,i=2,output=new Array(n);for(output[0]=+input[0].toFixed(digits),output[1]=+input[1].toFixed(digits);i<n;)output[i]=input[i],++i;return output}function quantizePoints(input){return input.map(quantizePoint)}function quantizePointsNoDuplicates(input){for(var point0=quantizePoint(input[0]),output=[point0],i=1;i<input.length;i++){var point=quantizePoint(input[i]);(point.length>2||point[0]!=point0[0]||point[1]!=point0[1])&&(output.push(point),point0=point)}return 1===output.length&&input.length>1&&output.push(quantizePoint(input[input.length-1])),output}function quantizePolygon(input){return input.map(quantizePointsNoDuplicates)}function quantizeGeometry(input){if(null==input)return input;var output;switch(input.type){case"GeometryCollection":output={type:"GeometryCollection",geometries:input.geometries.map(quantizeGeometry)};break;case"Point":output={type:"Point",coordinates:quantizePoint(input.coordinates)};break;case"MultiPoint":output={type:input.type,coordinates:quantizePoints(input.coordinates)};break;case"LineString":output={type:input.type,coordinates:quantizePointsNoDuplicates(input.coordinates)};break;case"MultiLineString":case"Polygon":output={type:input.type,coordinates:quantizePolygon(input.coordinates)};break;case"MultiPolygon":output={type:"MultiPolygon",coordinates:input.coordinates.map(quantizePolygon)};break;default:return input}return null!=input.bbox&&(output.bbox=input.bbox),output}function quantizeFeature(input){var output={type:"Feature",properties:input.properties,geometry:quantizeGeometry(input.geometry)};return null!=input.id&&(output.id=input.id),null!=input.bbox&&(output.bbox=input.bbox),output}if(null!=input)switch(input.type){case"Feature":return quantizeFeature(input);case"FeatureCollection":var output={type:"FeatureCollection",features:input.features.map(quantizeFeature)};return null!=input.bbox&&(output.bbox=input.bbox),output;default:return quantizeGeometry(input)}return input},exports.geoQuincuncial=quincuncial,exports.geoRectangularPolyconic=function(){return parallel1(rectangularPolyconicRaw).scale(131.215)},exports.geoRectangularPolyconicRaw=rectangularPolyconicRaw,exports.geoRobinson=function(){return d3Geo.geoProjection(robinsonRaw).scale(152.63)},exports.geoRobinsonRaw=robinsonRaw,exports.geoSatellite=function(){var distance=2,omega=0,m=d3Geo.geoProjectionMutator(satelliteRaw),p=m(distance,omega);return p.distance=function(_){return arguments.length?m(distance=+_,omega):distance},p.tilt=function(_){return arguments.length?m(distance,omega=_*radians):omega*degrees},p.scale(432.147).clipAngle(acos(1/distance)*degrees-1e-6)},exports.geoSatelliteRaw=satelliteRaw,exports.geoSinuMollweide=function(){return d3Geo.geoProjection(sinuMollweideRaw).rotate([-20,-55]).scale(164.263).center([0,-5.4036])},exports.geoSinuMollweideRaw=sinuMollweideRaw,exports.geoSinusoidal=function(){return d3Geo.geoProjection(sinusoidalRaw).scale(152.63)},exports.geoSinusoidalRaw=sinusoidalRaw,exports.geoStitch=function(input){if(null==input)return input;switch(input.type){case"Feature":return stitchFeature(input);case"FeatureCollection":var output={type:"FeatureCollection",features:input.features.map(stitchFeature)};return null!=input.bbox&&(output.bbox=input.bbox),output;default:return stitchGeometry(input)}},exports.geoTimes=function(){return d3Geo.geoProjection(timesRaw).scale(146.153)},exports.geoTimesRaw=timesRaw,exports.geoTwoPointAzimuthal=twoPointAzimuthal,exports.geoTwoPointAzimuthalRaw=twoPointAzimuthalRaw,exports.geoTwoPointAzimuthalUsa=function(){return twoPointAzimuthal([-158,21.5],[-77,39]).clipAngle(60).scale(400)},exports.geoTwoPointEquidistant=twoPointEquidistant,exports.geoTwoPointEquidistantRaw=twoPointEquidistantRaw,exports.geoTwoPointEquidistantUsa=function(){return twoPointEquidistant([-158,21.5],[-77,39]).clipAngle(130).scale(122.571)},exports.geoVanDerGrinten=function(){return d3Geo.geoProjection(vanDerGrintenRaw).scale(79.4183)},exports.geoVanDerGrintenRaw=vanDerGrintenRaw,exports.geoVanDerGrinten2=function(){return d3Geo.geoProjection(vanDerGrinten2Raw).scale(79.4183)},exports.geoVanDerGrinten2Raw=vanDerGrinten2Raw,exports.geoVanDerGrinten3=function(){return d3Geo.geoProjection(vanDerGrinten3Raw).scale(79.4183)},exports.geoVanDerGrinten3Raw=vanDerGrinten3Raw,exports.geoVanDerGrinten4=function(){return d3Geo.geoProjection(vanDerGrinten4Raw).scale(127.16)},exports.geoVanDerGrinten4Raw=vanDerGrinten4Raw,exports.geoWagner=wagner,exports.geoWagner7=function(){return wagner().poleline(65).parallels(60).inflation(0).ratio(200).scale(172.633)},exports.geoWagnerRaw=wagnerRaw,exports.geoWagner4=function(){return d3Geo.geoProjection(wagner4Raw).scale(176.84)},exports.geoWagner4Raw=wagner4Raw,exports.geoWagner6=function(){return d3Geo.geoProjection(wagner6Raw).scale(152.63)},exports.geoWagner6Raw=wagner6Raw,exports.geoWiechel=function(){return d3Geo.geoProjection(wiechelRaw).rotate([0,-90,45]).scale(124.75).clipAngle(179.999)},exports.geoWiechelRaw=wiechelRaw,exports.geoWinkel3=function(){return d3Geo.geoProjection(winkel3Raw).scale(158.837)},exports.geoWinkel3Raw=winkel3Raw,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(52),__webpack_require__(112))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(compare){var f;return 1===compare.length&&(f=compare,compare=function(d,x){return ascending(f(d),x)}),{left:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}var ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left;function pair(a,b){return[a,b]}function number(x){return null===x?NaN:+x}function variance(values,valueof){var value,delta,n=values.length,m=0,i=-1,mean=0,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));if(m>1)return sum/(m-1)}function deviation(array,f){var v=variance(array,f);return v?Math.sqrt(v):v}function extent(values,valueof){var value,min,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(min=max=value;++i<n;)null!=(value=values[i])&&(min>value&&(min=value),max<value&&(max=value))}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(min=max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&(min>value&&(min=value),max<value&&(max=value));return[min,max]}var array=Array.prototype,slice=array.slice,map=array.map;function constant(x){return function(){return x}}function identity(x){return x}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1}function sturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function quantile(values,p,valueof){if(null==valueof&&(valueof=number),n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}}function min(values,valueof){var value,min,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(min=value;++i<n;)null!=(value=values[i])&&min>value&&(min=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(min=value;++i<n;)null!=(value=valueof(values[i],i,values))&&min>value&&(min=value);return min}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length(d){return d.length}exports.bisect=bisectRight,exports.bisectRight=bisectRight,exports.bisectLeft=bisectLeft,exports.ascending=ascending,exports.bisector=bisector,exports.cross=function(values0,values1,reduce){var i0,i1,i,value0,n0=values0.length,n1=values1.length,values=new Array(n0*n1);for(null==reduce&&(reduce=pair),i0=i=0;i0<n0;++i0)for(value0=values0[i0],i1=0;i1<n1;++i1,++i)values[i]=reduce(value0,values1[i1]);return values},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.extent=extent,exports.histogram=function(){var value=identity,domain=extent,threshold=sturges;function histogram(data){var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=tickStep(x0,x1,tz),tz=range(Math.ceil(x0/tz)*tz,x1,tz));for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram},exports.thresholdFreedmanDiaconis=function(values,min,max){return values=map.call(values,number).sort(ascending),Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))},exports.thresholdSturges=sturges,exports.max=function(values,valueof){var value,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value>=value)for(max=value;++i<n;)null!=(value=values[i])&&value>max&&(max=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value>=value)for(max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&value>max&&(max=value);return max},exports.mean=function(values,valueof){var value,n=values.length,m=n,i=-1,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))?--m:sum+=value;else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))?--m:sum+=value;if(m)return sum/m},exports.median=function(values,valueof){var value,n=values.length,i=-1,numbers=[];if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||numbers.push(value);else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||numbers.push(value);return quantile(numbers.sort(ascending),.5)},exports.merge=function(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);--n>=0;)for(m=(array=arrays[n]).length;--m>=0;)merged[--j]=array[m];return merged},exports.min=min,exports.pairs=function(array,f){null==f&&(f=pair);for(var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=f(p,p=array[++i]);return pairs},exports.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},exports.quantile=quantile,exports.range=range,exports.scan=function(values,compare){if(n=values.length){var n,xi,i=0,j=0,xj=values[j];for(null==compare&&(compare=ascending);++i<n;)(compare(xi=values[i],xj)<0||0!==compare(xj,xj))&&(xj=xi,j=i);return 0===compare(xj,xj)?j:void 0}},exports.shuffle=function(array,i0,i1){for(var t,i,m=(null==i1?array.length:i1)-(i0=null==i0?0:+i0);m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},exports.sum=function(values,valueof){var value,n=values.length,i=-1,sum=0;if(null==valueof)for(;++i<n;)(value=+values[i])&&(sum+=value);else for(;++i<n;)(value=+valueof(values[i],i,values))&&(sum+=value);return sum},exports.ticks=function(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(start=Math.floor(start*step),stop=Math.ceil(stop*step),ticks=new Array(n=Math.ceil(start-stop+1));++i<n;)ticks[i]=(start-i)/step;return reverse&&ticks.reverse(),ticks},exports.tickIncrement=tickIncrement,exports.tickStep=tickStep,exports.transpose=transpose,exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?rgba(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?rgba(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));const radians=Math.PI/180,degrees=180/Math.PI,t1=6/29,t2=3*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl)return hcl2lab(o);o instanceof Rgb||(o=rgbConvert(o));var x,z,r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/1);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/.96422),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/.82521)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t>.008856451679035631?Math.pow(t,1/3):t/t2+4/29}function lab2xyz(t){return t>t1?t*t*t:t2*(t-4/29)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(o instanceof Lab||(o=labConvert(o)),0===o.a&&0===o.b)return new Hcl(NaN,0<o.l&&o.l<100?0:NaN,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*degrees;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}function hcl2lab(o){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*radians;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=.96422*lab2xyz(x))-1.6168667*(y=1*lab2xyz(y))-.4906146*(z=.82521*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function(){return hcl2lab(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);o instanceof Rgb||(o=rgbConvert(o));var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*degrees-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return 1===arguments.length?cubehelixConvert(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*radians,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}})),exports.color=color,exports.cubehelix=cubehelix,exports.gray=function(l,opacity){return new Lab(l,0,0,null==opacity?1:opacity)},exports.hcl=hcl,exports.hsl=hsl,exports.lab=lab,exports.lch=function(l,c,h,opacity){return 1===arguments.length?hclConvert(l):new Hcl(h,c,l,null==opacity?1:opacity)},exports.rgb=rgb,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaUtil,d3Force){"use strict";const ForceMap={center:d3Force.forceCenter,collide:d3Force.forceCollide,nbody:d3Force.forceManyBody,link:d3Force.forceLink,x:d3Force.forceX,y:d3Force.forceY},ForceParams=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],ForceConfig=["static","iterations"],ForceOutput=["x","y","vx","vy"];function Force(params){vegaDataflow.Transform.call(this,null,params)}function setup(sim,_,init,pulse){var i,n,p,name,f=vegaUtil.array(_.forces);for(i=0,n=ForceParams.length;i<n;++i)"forces"!==(p=ForceParams[i])&&_.modified(p)&&sim[p](_[p]);for(i=0,n=f.length;i<n;++i)name="forces"+i,(p=init||_.modified("forces",i)?getForce(f[i]):pulse&&modified(f[i],pulse)?sim.force(name):null)&&sim.force(name,p);for(n=sim.numForces||0;i<n;++i)sim.force("forces"+i,null);return sim.numForces=f.length,sim}function modified(f,pulse){var k,v;for(k in f)if(vegaUtil.isFunction(v=f[k])&&pulse.modified(vegaUtil.accessorFields(v)))return 1;return 0}function getForce(_){var f,p;for(p in vegaUtil.hasOwnProperty(ForceMap,_.force)||vegaUtil.error("Unrecognized force: "+_.force),f=ForceMap[_.force](),_)vegaUtil.isFunction(f[p])&&setForceParam(f[p],_[p],_);return f}function setForceParam(f,v,_){f(vegaUtil.isFunction(v)?d=>v(d,_):v)}Force.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:ForceOutput}]},vegaUtil.inherits(Force,vegaDataflow.Transform,{transform(_,pulse){var df,op,sim=this.value,change=pulse.changed(pulse.ADD_REM),params=_.modified(ForceParams),iters=_.iterations||300;if(sim?(change&&(pulse.modifies("index"),sim.nodes(pulse.source)),(params||pulse.changed(pulse.MOD))&&setup(sim,_,0,pulse)):(this.value=sim=function(nodes,_){const sim=d3Force.forceSimulation(nodes),stop=sim.stop,restart=sim.restart;let stopped=!1;return sim.stopped=()=>stopped,sim.restart=()=>(stopped=!1,restart()),sim.stop=()=>(stopped=!0,stop()),setup(sim,_,!0).on("end",()=>stopped=!0)}(pulse.source,_),sim.on("tick",(df=pulse.dataflow,op=this,()=>df.touch(op).run())),_.static||(change=!0,sim.tick()),pulse.modifies("index")),params||change||_.modified(ForceConfig)||pulse.changed()&&_.restart)if(sim.alpha(Math.max(sim.alpha(),_.alpha||1)).alphaDecay(1-Math.pow(sim.alphaMin(),1/iters)),_.static)for(sim.stop();--iters>=0;)sim.tick();else if(sim.stopped()&&sim.restart(),!change)return pulse.StopPropagation;return this.finish(_,pulse)},finish(_,pulse){const dataflow=pulse.dataflow;for(let arg,args=this._argops,j=0,m=args.length;j<m;++j)if(arg=args[j],"forces"===arg.name&&"link"===arg.op._argval.force)for(var op,ops=arg.op._argops,i=0,n=ops.length;i<n;++i)if("links"===ops[i].name&&(op=ops[i].op.source)){dataflow.pulse(op,dataflow.changeset().reflow());break}return pulse.reflow(_.modified()).modifies(ForceOutput)}}),exports.force=Force,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(37),__webpack_require__(115))},function(module,exports,__webpack_require__){!function(exports,d3Quadtree,d3Dispatch,d3Timer){"use strict";function constant(x){return function(){return x}}function jiggle(random){return 1e-6*(random()-.5)}function x(d){return d.x+d.vx}function y(d){return d.y+d.vy}function index(d){return d.index}function find(nodeById,nodeId){var node=nodeById.get(nodeId);if(!node)throw new Error("node not found: "+nodeId);return node}const m=4294967296;function x$1(d){return d.x}function y$1(d){return d.y}var initialAngle=Math.PI*(3-Math.sqrt(5));exports.forceCenter=function(x,y){var nodes,strength=1;function force(){var i,node,n=nodes.length,sx=0,sy=0;for(i=0;i<n;++i)sx+=(node=nodes[i]).x,sy+=node.y;for(sx=(sx/n-x)*strength,sy=(sy/n-y)*strength,i=0;i<n;++i)(node=nodes[i]).x-=sx,node.y-=sy}return null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force},exports.forceCollide=function(radius){var nodes,radii,random,strength=1,iterations=1;function force(){for(var i,tree,node,xi,yi,ri,ri2,n=nodes.length,k=0;k<iterations;++k)for(tree=d3Quadtree.quadtree(nodes,x,y).visitAfter(prepare),i=0;i<n;++i)node=nodes[i],ri=radii[node.index],ri2=ri*ri,xi=node.x+node.vx,yi=node.y+node.vy,tree.visit(apply);function apply(quad,x0,y0,x1,y1){var data=quad.data,rj=quad.r,r=ri+rj;if(!data)return x0>xi+r||x1<xi-r||y0>yi+r||y1<yi-r;if(data.index>node.index){var x=xi-data.x-data.vx,y=yi-data.y-data.vy,l=x*x+y*y;l<r*r&&(0===x&&(l+=(x=jiggle(random))*x),0===y&&(l+=(y=jiggle(random))*y),l=(r-(l=Math.sqrt(l)))/l*strength,node.vx+=(x*=l)*(r=(rj*=rj)/(ri2+rj)),node.vy+=(y*=l)*r,data.vx-=x*(r=1-r),data.vy-=y*r)}}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i)quad[i]&&quad[i].r>quad.r&&(quad.r=quad[i].r)}function initialize(){if(nodes){var i,node,n=nodes.length;for(radii=new Array(n),i=0;i<n;++i)node=nodes[i],radii[node.index]=+radius(node,i,nodes)}}return"function"!=typeof radius&&(radius=constant(null==radius?1:+radius)),force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant(+_),initialize(),force):radius},force},exports.forceLink=function(links){var strengths,distances,nodes,count,bias,random,id=index,strength=function(link){return 1/Math.min(count[link.source.index],count[link.target.index])},distance=constant(30),iterations=1;function force(alpha){for(var k=0,n=links.length;k<iterations;++k)for(var link,source,target,x,y,l,b,i=0;i<n;++i)source=(link=links[i]).source,x=(target=link.target).x+target.vx-source.x-source.vx||jiggle(random),y=target.y+target.vy-source.y-source.vy||jiggle(random),x*=l=((l=Math.sqrt(x*x+y*y))-distances[i])/l*alpha*strengths[i],y*=l,target.vx-=x*(b=bias[i]),target.vy-=y*b,source.vx+=x*(b=1-b),source.vy+=y*b}function initialize(){if(nodes){var i,link,n=nodes.length,m=links.length,nodeById=new Map(nodes.map((d,i)=>[id(d,i,nodes),d]));for(i=0,count=new Array(n);i<m;++i)(link=links[i]).index=i,"object"!=typeof link.source&&(link.source=find(nodeById,link.source)),"object"!=typeof link.target&&(link.target=find(nodeById,link.target)),count[link.source.index]=(count[link.source.index]||0)+1,count[link.target.index]=(count[link.target.index]||0)+1;for(i=0,bias=new Array(m);i<m;++i)link=links[i],bias[i]=count[link.source.index]/(count[link.source.index]+count[link.target.index]);strengths=new Array(m),initializeStrength(),distances=new Array(m),initializeDistance()}}function initializeStrength(){if(nodes)for(var i=0,n=links.length;i<n;++i)strengths[i]=+strength(links[i],i,links)}function initializeDistance(){if(nodes)for(var i=0,n=links.length;i<n;++i)distances[i]=+distance(links[i],i,links)}return null==links&&(links=[]),force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.links=function(_){return arguments.length?(links=_,initialize(),force):links},force.id=function(_){return arguments.length?(id=_,force):id},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initializeStrength(),force):strength},force.distance=function(_){return arguments.length?(distance="function"==typeof _?_:constant(+_),initializeDistance(),force):distance},force},exports.forceManyBody=function(){var nodes,node,random,alpha,strengths,strength=constant(-30),distanceMin2=1,distanceMax2=1/0,theta2=.81;function force(_){var i,n=nodes.length,tree=d3Quadtree.quadtree(nodes,x$1,y$1).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i)node=nodes[i],tree.visit(apply)}function initialize(){if(nodes){var i,node,n=nodes.length;for(strengths=new Array(n),i=0;i<n;++i)node=nodes[i],strengths[node.index]=+strength(node,i,nodes)}}function accumulate(quad){var q,c,x,y,i,strength=0,weight=0;if(quad.length){for(x=y=i=0;i<4;++i)(q=quad[i])&&(c=Math.abs(q.value))&&(strength+=q.value,weight+=c,x+=c*q.x,y+=c*q.y);quad.x=x/weight,quad.y=y/weight}else{(q=quad).x=q.data.x,q.y=q.data.y;do{strength+=strengths[q.data.index]}while(q=q.next)}quad.value=strength}function apply(quad,x1,_,x2){if(!quad.value)return!0;var x=quad.x-node.x,y=quad.y-node.y,w=x2-x1,l=x*x+y*y;if(w*w/theta2<l)return l<distanceMax2&&(0===x&&(l+=(x=jiggle(random))*x),0===y&&(l+=(y=jiggle(random))*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)),node.vx+=x*quad.value*alpha/l,node.vy+=y*quad.value*alpha/l),!0;if(!(quad.length||l>=distanceMax2)){(quad.data!==node||quad.next)&&(0===x&&(l+=(x=jiggle(random))*x),0===y&&(l+=(y=jiggle(random))*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)));do{quad.data!==node&&(w=strengths[quad.data.index]*alpha/l,node.vx+=x*w,node.vy+=y*w)}while(quad=quad.next)}}return force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)},force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)},force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)},force},exports.forceRadial=function(radius,x,y){var nodes,strengths,radiuses,strength=constant(.1);function force(alpha){for(var i=0,n=nodes.length;i<n;++i){var node=nodes[i],dx=node.x-x||1e-6,dy=node.y-y||1e-6,r=Math.sqrt(dx*dx+dy*dy),k=(radiuses[i]-r)*strengths[i]*alpha/r;node.vx+=dx*k,node.vy+=dy*k}}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),radiuses=new Array(n),i=0;i<n;++i)radiuses[i]=+radius(nodes[i],i,nodes),strengths[i]=isNaN(radiuses[i])?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof radius&&(radius=constant(+radius)),null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant(+_),initialize(),force):radius},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force},exports.forceSimulation=function(nodes){var simulation,alpha=1,alphaMin=.001,alphaDecay=1-Math.pow(alphaMin,1/300),alphaTarget=0,velocityDecay=.6,forces=new Map,stepper=d3Timer.timer(step),event=d3Dispatch.dispatch("tick","end"),random=function(){let s=1;return()=>(s=(1664525*s+1013904223)%m)/m}();function step(){tick(),event.call("tick",simulation),alpha<alphaMin&&(stepper.stop(),event.call("end",simulation))}function tick(iterations){var i,node,n=nodes.length;void 0===iterations&&(iterations=1);for(var k=0;k<iterations;++k)for(alpha+=(alphaTarget-alpha)*alphaDecay,forces.forEach((function(force){force(alpha)})),i=0;i<n;++i)null==(node=nodes[i]).fx?node.x+=node.vx*=velocityDecay:(node.x=node.fx,node.vx=0),null==node.fy?node.y+=node.vy*=velocityDecay:(node.y=node.fy,node.vy=0);return simulation}function initializeNodes(){for(var node,i=0,n=nodes.length;i<n;++i){if((node=nodes[i]).index=i,null!=node.fx&&(node.x=node.fx),null!=node.fy&&(node.y=node.fy),isNaN(node.x)||isNaN(node.y)){var radius=10*Math.sqrt(.5+i),angle=i*initialAngle;node.x=radius*Math.cos(angle),node.y=radius*Math.sin(angle)}(isNaN(node.vx)||isNaN(node.vy))&&(node.vx=node.vy=0)}}function initializeForce(force){return force.initialize&&force.initialize(nodes,random),force}return null==nodes&&(nodes=[]),initializeNodes(),simulation={tick:tick,restart:function(){return stepper.restart(step),simulation},stop:function(){return stepper.stop(),simulation},nodes:function(_){return arguments.length?(nodes=_,initializeNodes(),forces.forEach(initializeForce),simulation):nodes},alpha:function(_){return arguments.length?(alpha=+_,simulation):alpha},alphaMin:function(_){return arguments.length?(alphaMin=+_,simulation):alphaMin},alphaDecay:function(_){return arguments.length?(alphaDecay=+_,simulation):+alphaDecay},alphaTarget:function(_){return arguments.length?(alphaTarget=+_,simulation):alphaTarget},velocityDecay:function(_){return arguments.length?(velocityDecay=1-_,simulation):1-velocityDecay},randomSource:function(_){return arguments.length?(random=_,forces.forEach(initializeForce),simulation):random},force:function(name,_){return arguments.length>1?(null==_?forces.delete(name):forces.set(name,initializeForce(_)),simulation):forces.get(name)},find:function(x,y,radius){var dx,dy,d2,node,closest,i=0,n=nodes.length;for(null==radius?radius=1/0:radius*=radius,i=0;i<n;++i)(d2=(dx=x-(node=nodes[i]).x)*dx+(dy=y-node.y)*dy)<radius&&(closest=node,radius=d2);return closest},on:function(name,_){return arguments.length>1?(event.on(name,_),simulation):event.on(name)}}},exports.forceX=function(x){var nodes,strengths,xz,strength=constant(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vx+=(xz[i]-node.x)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),xz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(xz[i]=+x(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof x&&(x=constant(null==x?0:+x)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.x=function(_){return arguments.length?(x="function"==typeof _?_:constant(+_),initialize(),force):x},force},exports.forceY=function(y){var nodes,strengths,yz,strength=constant(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vy+=(yz[i]-node.y)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),yz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(yz[i]=+y(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof y&&(y=constant(null==y?0:+y)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant(+_),initialize(),force):strength},force.y=function(_){return arguments.length?(y="function"==typeof _?_:constant(+_),initialize(),force):y},force},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(116),__webpack_require__(117),__webpack_require__(77))},function(module,exports,__webpack_require__){!function(exports){"use strict";function add(tree,x,y,d){if(isNaN(x)||isNaN(y))return tree;var parent,xm,ym,xp,yp,right,bottom,i,j,node=tree._root,leaf={data:d},x0=tree._x0,y0=tree._y0,x1=tree._x1,y1=tree._y1;if(!node)return tree._root=leaf,tree;for(;node.length;)if((right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,parent=node,!(node=node[i=bottom<<1|right]))return parent[i]=leaf,tree;if(xp=+tree._x.call(null,node.data),yp=+tree._y.call(null,node.data),x===xp&&y===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;do{parent=parent?parent[i]=new Array(4):tree._root=new Array(4),(right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym}while((i=bottom<<1|right)==(j=(yp>=ym)<<1|xp>=xm));return parent[j]=node,parent[i]=leaf,tree}function Quad(node,x0,y0,x1,y1){this.node=node,this.x0=x0,this.y0=y0,this.x1=x1,this.y1=y1}function defaultX(d){return d[0]}function defaultY(d){return d[1]}function quadtree(nodes,x,y){var tree=new Quadtree(null==x?defaultX:x,null==y?defaultY:y,NaN,NaN,NaN,NaN);return null==nodes?tree:tree.addAll(nodes)}function Quadtree(x,y,x0,y0,x1,y1){this._x=x,this._y=y,this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this._root=void 0}function leaf_copy(leaf){for(var copy={data:leaf.data},next=copy;leaf=leaf.next;)next=next.next={data:leaf.data};return copy}var treeProto=quadtree.prototype=Quadtree.prototype;treeProto.copy=function(){var nodes,child,copy=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root;if(!node)return copy;if(!node.length)return copy._root=leaf_copy(node),copy;for(nodes=[{source:node,target:copy._root=new Array(4)}];node=nodes.pop();)for(var i=0;i<4;++i)(child=node.source[i])&&(child.length?nodes.push({source:child,target:node.target[i]=new Array(4)}):node.target[i]=leaf_copy(child));return copy},treeProto.add=function(d){const x=+this._x.call(null,d),y=+this._y.call(null,d);return add(this.cover(x,y),x,y,d)},treeProto.addAll=function(data){var d,i,x,y,n=data.length,xz=new Array(n),yz=new Array(n),x0=1/0,y0=1/0,x1=-1/0,y1=-1/0;for(i=0;i<n;++i)isNaN(x=+this._x.call(null,d=data[i]))||isNaN(y=+this._y.call(null,d))||(xz[i]=x,yz[i]=y,x<x0&&(x0=x),x>x1&&(x1=x),y<y0&&(y0=y),y>y1&&(y1=y));if(x0>x1||y0>y1)return this;for(this.cover(x0,y0).cover(x1,y1),i=0;i<n;++i)add(this,xz[i],yz[i],data[i]);return this},treeProto.cover=function(x,y){if(isNaN(x=+x)||isNaN(y=+y))return this;var x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(isNaN(x0))x1=(x0=Math.floor(x))+1,y1=(y0=Math.floor(y))+1;else{for(var parent,i,z=x1-x0||1,node=this._root;x0>x||x>=x1||y0>y||y>=y1;)switch(i=(y<y0)<<1|x<x0,(parent=new Array(4))[i]=node,node=parent,z*=2,i){case 0:x1=x0+z,y1=y0+z;break;case 1:x0=x1-z,y1=y0+z;break;case 2:x1=x0+z,y0=y1-z;break;case 3:x0=x1-z,y0=y1-z}this._root&&this._root.length&&(this._root=node)}return this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this},treeProto.data=function(){var data=[];return this.visit((function(node){if(!node.length)do{data.push(node.data)}while(node=node.next)})),data},treeProto.extent=function(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},treeProto.find=function(x,y,radius){var data,x1,y1,x2,y2,q,i,x0=this._x0,y0=this._y0,x3=this._x1,y3=this._y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,x0,y0,x3,y3)),null==radius?radius=1/0:(x0=x-radius,y0=y-radius,x3=x+radius,y3=y+radius,radius*=radius);q=quads.pop();)if(!(!(node=q.node)||(x1=q.x0)>x3||(y1=q.y0)>y3||(x2=q.x1)<x0||(y2=q.y1)<y0))if(node.length){var xm=(x1+x2)/2,ym=(y1+y2)/2;quads.push(new Quad(node[3],xm,ym,x2,y2),new Quad(node[2],x1,ym,xm,y2),new Quad(node[1],xm,y1,x2,ym),new Quad(node[0],x1,y1,xm,ym)),(i=(y>=ym)<<1|x>=xm)&&(q=quads[quads.length-1],quads[quads.length-1]=quads[quads.length-1-i],quads[quads.length-1-i]=q)}else{var dx=x-+this._x.call(null,node.data),dy=y-+this._y.call(null,node.data),d2=dx*dx+dy*dy;if(d2<radius){var d=Math.sqrt(radius=d2);x0=x-d,y0=y-d,x3=x+d,y3=y+d,data=node.data}}return data},treeProto.remove=function(d){if(isNaN(x=+this._x.call(null,d))||isNaN(y=+this._y.call(null,d)))return this;var parent,retainer,previous,next,x,y,xm,ym,right,bottom,i,j,node=this._root,x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(!node)return this;if(node.length)for(;;){if((right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,parent=node,!(node=node[i=bottom<<1|right]))return this;if(!node.length)break;(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])&&(retainer=parent,j=i)}for(;node.data!==d;)if(previous=node,!(node=node.next))return this;return(next=node.next)&&delete node.next,previous?(next?previous.next=next:delete previous.next,this):parent?(next?parent[i]=next:delete parent[i],(node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length&&(retainer?retainer[j]=node:this._root=node),this):(this._root=next,this)},treeProto.removeAll=function(data){for(var i=0,n=data.length;i<n;++i)this.remove(data[i]);return this},treeProto.root=function(){return this._root},treeProto.size=function(){var size=0;return this.visit((function(node){if(!node.length)do{++size}while(node=node.next)})),size},treeProto.visit=function(callback){var q,child,x0,y0,x1,y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));q=quads.pop();)if(!callback(node=q.node,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1)&&node.length){var xm=(x0+x1)/2,ym=(y0+y1)/2;(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym))}return this},treeProto.visitAfter=function(callback){var q,quads=[],next=[];for(this._root&&quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));q=quads.pop();){var node=q.node;if(node.length){var child,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1,xm=(x0+x1)/2,ym=(y0+y1)/2;(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1))}next.push(q)}for(;q=next.pop();)callback(q.node,q.x0,q.y0,q.x1,q.y1);return this},treeProto.x=function(_){return arguments.length?(this._x=_,this):this._x},treeProto.y=function(_){return arguments.length?(this._y=_,this):this._y},exports.quadtree=quadtree,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";var noop={value:function(){}};function dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _||/[\s.]/.test(t))throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map((function(t){var name="",i=t.indexOf(".");if(i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}}))}function get(type,name){for(var c,i=0,n=type.length;i<n;++i)if((c=type[i]).name===name)return c.value}function set(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=noop,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name:name,value:callback}),type}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var t,_=this._,T=parseTypenames(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=set(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=set(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=get(_[t],typename.name)))return t},copy:function(){var copy={},_=this._;for(var t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function(type,that){if((n=arguments.length-2)>0)for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}},exports.dispatch=dispatch,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaUtil,d3Hierarchy){"use strict";function lookup(tree,key,filter){const map={};return tree.each(node=>{const t=node.data;filter(t)&&(map[key(t)]=node)}),tree.lookup=map,tree}function Nest(params){vegaDataflow.Transform.call(this,null,params)}Nest.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const children=n=>n.values;function nest(){const keys=[],nest={entries:array=>function entries(map,depth){if(++depth>keys.length)return map;const array=[];for(const key in map)array.push({key:key,values:entries(map[key],depth)});return array}(function apply(array,depth){if(depth>=keys.length)return array;const n=array.length,key=keys[depth++],valuesByKey={},result={};let keyValue,value,values,i=-1;for(;++i<n;)keyValue=key(value=array[i])+"",(values=valuesByKey[keyValue])?values.push(value):valuesByKey[keyValue]=[value];for(keyValue in valuesByKey)result[keyValue]=apply(valuesByKey[keyValue],depth);return result}(array,0),0),key:d=>(keys.push(d),nest)};return nest}function HierarchyLayout(params){vegaDataflow.Transform.call(this,null,params)}vegaUtil.inherits(Nest,vegaDataflow.Transform,{transform(_,pulse){pulse.source||vegaUtil.error("Nest transform requires an upstream data source.");var gen=_.generate,mod=_.modified(),out=pulse.clone(),tree=this.value;return(!tree||mod||pulse.changed())&&(tree&&tree.each(node=>{node.children&&vegaDataflow.isTuple(node.data)&&out.rem.push(node.data)}),this.value=tree=d3Hierarchy.hierarchy({values:vegaUtil.array(_.keys).reduce((n,k)=>(n.key(k),n),nest()).entries(out.source)},children),gen&&tree.each(node=>{node.children&&(node=vegaDataflow.ingest(node.data),out.add.push(node),out.source.push(node))}),lookup(tree,vegaDataflow.tupleid,vegaDataflow.tupleid)),out.source.root=tree,out}});const defaultSeparation=(a,b)=>a.parent===b.parent?1:2;vegaUtil.inherits(HierarchyLayout,vegaDataflow.Transform,{transform(_,pulse){pulse.source&&pulse.source.root||vegaUtil.error(this.constructor.name+" transform requires a backing tree data source.");const layout=this.layout(_.method),fields=this.fields,root=pulse.source.root,as=_.as||fields;_.field?root.sum(_.field):root.count(),_.sort&&root.sort(vegaDataflow.stableCompare(_.sort,d=>d.data)),function(layout,params,_){for(let p,i=0,n=params.length;i<n;++i)p=params[i],p in _&&layout[p](_[p])}(layout,this.params,_),layout.separation&&layout.separation(!1!==_.separation?defaultSeparation:vegaUtil.one);try{this.value=layout(root)}catch(err){vegaUtil.error(err)}return root.each(node=>function(node,fields,as){const t=node.data,n=fields.length-1;for(let i=0;i<n;++i)t[as[i]]=node[fields[i]];t[as[n]]=node.children?node.children.length:0}(node,fields,as)),pulse.reflow(_.modified()).modifies(as).modifies("leaf")}});const Output=["x","y","r","depth","children"];function Pack(params){HierarchyLayout.call(this,params)}Pack.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Output.length,default:Output}]},vegaUtil.inherits(Pack,HierarchyLayout,{layout:d3Hierarchy.pack,params:["radius","size","padding"],fields:Output});const Output$1=["x0","y0","x1","y1","depth","children"];function Partition(params){HierarchyLayout.call(this,params)}function Stratify(params){vegaDataflow.Transform.call(this,null,params)}Partition.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Output$1.length,default:Output$1}]},vegaUtil.inherits(Partition,HierarchyLayout,{layout:d3Hierarchy.partition,params:["size","round","padding"],fields:Output$1}),Stratify.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},vegaUtil.inherits(Stratify,vegaDataflow.Transform,{transform(_,pulse){pulse.source||vegaUtil.error("Stratify transform requires an upstream data source.");let tree=this.value;const mod=_.modified(),out=pulse.fork(pulse.ALL).materialize(pulse.SOURCE),run=!tree||mod||pulse.changed(pulse.ADD_REM)||pulse.modified(_.key.fields)||pulse.modified(_.parentKey.fields);return out.source=out.source.slice(),run&&(tree=out.source.length?lookup(d3Hierarchy.stratify().id(_.key).parentId(_.parentKey)(out.source),_.key,vegaUtil.truthy):lookup(d3Hierarchy.stratify()([{}]),_.key,_.key)),out.source.root=this.value=tree,out}});const Layouts={tidy:d3Hierarchy.tree,cluster:d3Hierarchy.cluster},Output$2=["x","y","depth","children"];function Tree(params){HierarchyLayout.call(this,params)}function TreeLinks(params){vegaDataflow.Transform.call(this,[],params)}Tree.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Output$2.length,default:Output$2}]},vegaUtil.inherits(Tree,HierarchyLayout,{layout(method){const m=method||"tidy";if(vegaUtil.hasOwnProperty(Layouts,m))return Layouts[m]();vegaUtil.error("Unrecognized Tree layout method: "+m)},params:["size","nodeSize"],fields:Output$2}),TreeLinks.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},vegaUtil.inherits(TreeLinks,vegaDataflow.Transform,{transform(_,pulse){const links=this.value,tree=pulse.source&&pulse.source.root,out=pulse.fork(pulse.NO_SOURCE),lut={};return tree||vegaUtil.error("TreeLinks transform requires a tree data source."),pulse.changed(pulse.ADD_REM)?(out.rem=links,pulse.visit(pulse.SOURCE,t=>lut[vegaDataflow.tupleid(t)]=1),tree.each(node=>{const t=node.data,p=node.parent&&node.parent.data;p&&lut[vegaDataflow.tupleid(t)]&&lut[vegaDataflow.tupleid(p)]&&out.add.push(vegaDataflow.ingest({source:p,target:t}))}),this.value=out.add):pulse.changed(pulse.MOD)&&(pulse.visit(pulse.MOD,t=>lut[vegaDataflow.tupleid(t)]=1),links.forEach(link=>{(lut[vegaDataflow.tupleid(link.source)]||lut[vegaDataflow.tupleid(link.target)])&&out.mod.push(link)})),out}});const Tiles={binary:d3Hierarchy.treemapBinary,dice:d3Hierarchy.treemapDice,slice:d3Hierarchy.treemapSlice,slicedice:d3Hierarchy.treemapSliceDice,squarify:d3Hierarchy.treemapSquarify,resquarify:d3Hierarchy.treemapResquarify},Output$3=["x0","y0","x1","y1","depth","children"];function Treemap(params){HierarchyLayout.call(this,params)}Treemap.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Output$3.length,default:Output$3}]},vegaUtil.inherits(Treemap,HierarchyLayout,{layout(){const x=d3Hierarchy.treemap();return x.ratio=_=>{const t=x.tile();t.ratio&&x.tile(t.ratio(_))},x.method=_=>{vegaUtil.hasOwnProperty(Tiles,_)?x.tile(Tiles[_]):vegaUtil.error("Unrecognized Treemap layout method: "+_)},x},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Output$3}),exports.nest=Nest,exports.pack=Pack,exports.partition=Partition,exports.stratify=Stratify,exports.tree=Tree,exports.treelinks=TreeLinks,exports.treemap=Treemap,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(37),__webpack_require__(119))},function(module,exports,__webpack_require__){!function(exports){"use strict";function defaultSeparation(a,b){return a.parent===b.parent?1:2}function meanXReduce(x,c){return x+c.x}function maxYReduce(y,c){return Math.max(y,c.y)}function count(node){var sum=0,children=node.children,i=children&&children.length;if(i)for(;--i>=0;)sum+=children[i].value;else sum=1;node.value=sum}function hierarchy(data,children){data instanceof Map?(data=[void 0,data],void 0===children&&(children=mapChildren)):void 0===children&&(children=objectChildren);for(var node,child,childs,i,n,root=new Node(data),nodes=[root];node=nodes.pop();)if((childs=children(node.data))&&(n=(childs=Array.from(childs)).length))for(node.children=childs,i=n-1;i>=0;--i)nodes.push(child=childs[i]=new Node(childs[i])),child.parent=node,child.depth=node.depth+1;return root.eachBefore(computeHeight)}function objectChildren(d){return d.children}function mapChildren(d){return Array.isArray(d)?d[1]:null}function copyData(node){void 0!==node.data.value&&(node.value=node.data.value),node.data=node.data.data}function computeHeight(node){var height=0;do{node.height=height}while((node=node.parent)&&node.height<++height)}function Node(data){this.data=data,this.depth=this.height=0,this.parent=null}function enclose(circles){for(var p,e,i=0,n=(circles=function(array){for(var t,i,m=array.length;m;)i=Math.random()*m--|0,t=array[m],array[m]=array[i],array[i]=t;return array}(Array.from(circles))).length,B=[];i<n;)p=circles[i],e&&enclosesWeak(e,p)?++i:(e=encloseBasis(B=extendBasis(B,p)),i=0);return e}function extendBasis(B,p){var i,j;if(enclosesWeakAll(p,B))return[p];for(i=0;i<B.length;++i)if(enclosesNot(p,B[i])&&enclosesWeakAll(encloseBasis2(B[i],p),B))return[B[i],p];for(i=0;i<B.length-1;++i)for(j=i+1;j<B.length;++j)if(enclosesNot(encloseBasis2(B[i],B[j]),p)&&enclosesNot(encloseBasis2(B[i],p),B[j])&&enclosesNot(encloseBasis2(B[j],p),B[i])&&enclosesWeakAll(encloseBasis3(B[i],B[j],p),B))return[B[i],B[j],p];throw new Error}function enclosesNot(a,b){var dr=a.r-b.r,dx=b.x-a.x,dy=b.y-a.y;return dr<0||dr*dr<dx*dx+dy*dy}function enclosesWeak(a,b){var dr=a.r-b.r+1e-9*Math.max(a.r,b.r,1),dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function enclosesWeakAll(a,B){for(var i=0;i<B.length;++i)if(!enclosesWeak(a,B[i]))return!1;return!0}function encloseBasis(B){switch(B.length){case 1:return{x:(a=B[0]).x,y:a.y,r:a.r};case 2:return encloseBasis2(B[0],B[1]);case 3:return encloseBasis3(B[0],B[1],B[2])}var a}function encloseBasis2(a,b){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x21=x2-x1,y21=y2-y1,r21=r2-r1,l=Math.sqrt(x21*x21+y21*y21);return{x:(x1+x2+x21/l*r21)/2,y:(y1+y2+y21/l*r21)/2,r:(l+r1+r2)/2}}function encloseBasis3(a,b,c){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x3=c.x,y3=c.y,r3=c.r,a2=x1-x2,a3=x1-x3,b2=y1-y2,b3=y1-y3,c2=r2-r1,c3=r3-r1,d1=x1*x1+y1*y1-r1*r1,d2=d1-x2*x2-y2*y2+r2*r2,d3=d1-x3*x3-y3*y3+r3*r3,ab=a3*b2-a2*b3,xa=(b2*d3-b3*d2)/(2*ab)-x1,xb=(b3*c2-b2*c3)/ab,ya=(a3*d2-a2*d3)/(2*ab)-y1,yb=(a2*c3-a3*c2)/ab,A=xb*xb+yb*yb-1,B=2*(r1+xa*xb+ya*yb),C=xa*xa+ya*ya-r1*r1,r=-(A?(B+Math.sqrt(B*B-4*A*C))/(2*A):C/B);return{x:x1+xa+xb*r,y:y1+ya+yb*r,r:r}}function place(b,a,c){var x,a2,y,b2,dx=b.x-a.x,dy=b.y-a.y,d2=dx*dx+dy*dy;d2?(a2=a.r+c.r,a2*=a2,b2=b.r+c.r,a2>(b2*=b2)?(x=(d2+b2-a2)/(2*d2),y=Math.sqrt(Math.max(0,b2/d2-x*x)),c.x=b.x-x*dx-y*dy,c.y=b.y-x*dy+y*dx):(x=(d2+a2-b2)/(2*d2),y=Math.sqrt(Math.max(0,a2/d2-x*x)),c.x=a.x+x*dx-y*dy,c.y=a.y+x*dy+y*dx)):(c.x=a.x+c.r,c.y=a.y)}function intersects(a,b){var dr=a.r+b.r-1e-6,dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function score(node){var a=node._,b=node.next._,ab=a.r+b.r,dx=(a.x*b.r+b.x*a.r)/ab,dy=(a.y*b.r+b.y*a.r)/ab;return dx*dx+dy*dy}function Node$1(circle){this._=circle,this.next=null,this.previous=null}function packEnclose(circles){if(!(n=(x=circles,circles="object"==typeof x&&"length"in x?x:Array.from(x)).length))return 0;var x,a,b,c,n,aa,ca,i,j,k,sj,sk;if((a=circles[0]).x=0,a.y=0,!(n>1))return a.r;if(b=circles[1],a.x=-b.r,b.x=a.r,b.y=0,!(n>2))return a.r+b.r;place(b,a,c=circles[2]),a=new Node$1(a),b=new Node$1(b),c=new Node$1(c),a.next=c.previous=b,b.next=a.previous=c,c.next=b.previous=a;pack:for(i=3;i<n;++i){place(a._,b._,c=circles[i]),c=new Node$1(c),j=b.next,k=a.previous,sj=b._.r,sk=a._.r;do{if(sj<=sk){if(intersects(j._,c._)){b=j,a.next=b,b.previous=a,--i;continue pack}sj+=j._.r,j=j.next}else{if(intersects(k._,c._)){(a=k).next=b,b.previous=a,--i;continue pack}sk+=k._.r,k=k.previous}}while(j!==k.next);for(c.previous=a,c.next=b,a.next=b.previous=b=c,aa=score(a);(c=c.next)!==b;)(ca=score(c))<aa&&(a=c,aa=ca);b=a.next}for(a=[b._],c=b;(c=c.next)!==b;)a.push(c._);for(c=enclose(a),i=0;i<n;++i)(a=circles[i]).x-=c.x,a.y-=c.y;return c.r}function optional(f){return null==f?null:required(f)}function required(f){if("function"!=typeof f)throw new Error;return f}function constantZero(){return 0}function constant(x){return function(){return x}}function defaultRadius(d){return Math.sqrt(d.value)}function radiusLeaf(radius){return function(node){node.children||(node.r=Math.max(0,+radius(node)||0))}}function packChildren(padding,k){return function(node){if(children=node.children){var children,i,e,n=children.length,r=padding(node)*k||0;if(r)for(i=0;i<n;++i)children[i].r+=r;if(e=packEnclose(children),r)for(i=0;i<n;++i)children[i].r-=r;node.r=e+r}}}function translateChild(k){return function(node){var parent=node.parent;node.r*=k,parent&&(node.x=parent.x+k*node.x,node.y=parent.y+k*node.y)}}function roundNode(node){node.x0=Math.round(node.x0),node.y0=Math.round(node.y0),node.x1=Math.round(node.x1),node.y1=Math.round(node.y1)}function treemapDice(parent,x0,y0,x1,y1){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(x1-x0)/parent.value;++i<n;)(node=nodes[i]).y0=y0,node.y1=y1,node.x0=x0,node.x1=x0+=node.value*k}Node.prototype=hierarchy.prototype={constructor:Node,count:function(){return this.eachAfter(count)},each:function(callback,that){let index=-1;for(const node of this)callback.call(that,node,++index,this);return this},eachAfter:function(callback,that){for(var children,i,n,node=this,nodes=[node],next=[],index=-1;node=nodes.pop();)if(next.push(node),children=node.children)for(i=0,n=children.length;i<n;++i)nodes.push(children[i]);for(;node=next.pop();)callback.call(that,node,++index,this);return this},eachBefore:function(callback,that){for(var children,i,node=this,nodes=[node],index=-1;node=nodes.pop();)if(callback.call(that,node,++index,this),children=node.children)for(i=children.length-1;i>=0;--i)nodes.push(children[i]);return this},find:function(callback,that){let index=-1;for(const node of this)if(callback.call(that,node,++index,this))return node},sum:function(value){return this.eachAfter((function(node){for(var sum=+value(node.data)||0,children=node.children,i=children&&children.length;--i>=0;)sum+=children[i].value;node.value=sum}))},sort:function(compare){return this.eachBefore((function(node){node.children&&node.children.sort(compare)}))},path:function(end){for(var start=this,ancestor=function(a,b){if(a===b)return a;var aNodes=a.ancestors(),bNodes=b.ancestors(),c=null;for(a=aNodes.pop(),b=bNodes.pop();a===b;)c=a,a=aNodes.pop(),b=bNodes.pop();return c}(start,end),nodes=[start];start!==ancestor;)start=start.parent,nodes.push(start);for(var k=nodes.length;end!==ancestor;)nodes.splice(k,0,end),end=end.parent;return nodes},ancestors:function(){for(var node=this,nodes=[node];node=node.parent;)nodes.push(node);return nodes},descendants:function(){return Array.from(this)},leaves:function(){var leaves=[];return this.eachBefore((function(node){node.children||leaves.push(node)})),leaves},links:function(){var root=this,links=[];return root.each((function(node){node!==root&&links.push({source:node.parent,target:node})})),links},copy:function(){return hierarchy(this).eachBefore(copyData)},[Symbol.iterator]:function*(){var current,children,i,n,node=this,next=[node];do{for(current=next.reverse(),next=[];node=current.pop();)if(yield node,children=node.children)for(i=0,n=children.length;i<n;++i)next.push(children[i])}while(next.length)}};var preroot={depth:-1},ambiguous={};function defaultId(d){return d.id}function defaultParentId(d){return d.parentId}function defaultSeparation$1(a,b){return a.parent===b.parent?1:2}function nextLeft(v){var children=v.children;return children?children[0]:v.t}function nextRight(v){var children=v.children;return children?children[children.length-1]:v.t}function moveSubtree(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change,wp.s+=shift,wm.c+=change,wp.z+=shift,wp.m+=shift}function nextAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function TreeNode(node,i){this._=node,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=i}function treemapSlice(parent,x0,y0,x1,y1){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(y1-y0)/parent.value;++i<n;)(node=nodes[i]).x0=x0,node.x1=x1,node.y0=y0,node.y1=y0+=node.value*k}TreeNode.prototype=Object.create(Node.prototype);var phi=(1+Math.sqrt(5))/2;function squarifyRatio(ratio,parent,x0,y0,x1,y1){for(var row,nodeValue,dx,dy,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta,rows=[],nodes=parent.children,i0=0,i1=0,n=nodes.length,value=parent.value;i0<n;){dx=x1-x0,dy=y1-y0;do{sumValue=nodes[i1++].value}while(!sumValue&&i1<n);for(minValue=maxValue=sumValue,beta=sumValue*sumValue*(alpha=Math.max(dy/dx,dx/dy)/(value*ratio)),minRatio=Math.max(maxValue/beta,beta/minValue);i1<n;++i1){if(sumValue+=nodeValue=nodes[i1].value,nodeValue<minValue&&(minValue=nodeValue),nodeValue>maxValue&&(maxValue=nodeValue),beta=sumValue*sumValue*alpha,(newRatio=Math.max(maxValue/beta,beta/minValue))>minRatio){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)}),row.dice?treemapDice(row,x0,y0,x1,value?y0+=dy*sumValue/value:y1):treemapSlice(row,x0,y0,value?x0+=dx*sumValue/value:x1,y1),value-=sumValue,i0=i1}return rows}var squarify=function custom(ratio){function squarify(parent,x0,y0,x1,y1){squarifyRatio(ratio,parent,x0,y0,x1,y1)}return squarify.ratio=function(x){return custom((x=+x)>1?x:1)},squarify}(phi),resquarify=function custom(ratio){function resquarify(parent,x0,y0,x1,y1){if((rows=parent._squarify)&&rows.ratio===ratio)for(var rows,row,nodes,i,n,j=-1,m=rows.length,value=parent.value;++j<m;){for(nodes=(row=rows[j]).children,i=row.value=0,n=nodes.length;i<n;++i)row.value+=nodes[i].value;row.dice?treemapDice(row,x0,y0,x1,value?y0+=(y1-y0)*row.value/value:y1):treemapSlice(row,x0,y0,value?x0+=(x1-x0)*row.value/value:x1,y1),value-=row.value}else parent._squarify=rows=squarifyRatio(ratio,parent,x0,y0,x1,y1),rows.ratio=ratio}return resquarify.ratio=function(x){return custom((x=+x)>1?x:1)},resquarify}(phi);exports.cluster=function(){var separation=defaultSeparation,dx=1,dy=1,nodeSize=!1;function cluster(root){var previousNode,x=0;root.eachAfter((function(node){var children=node.children;children?(node.x=function(children){return children.reduce(meanXReduce,0)/children.length}(children),node.y=function(children){return 1+children.reduce(maxYReduce,0)}(children)):(node.x=previousNode?x+=separation(node,previousNode):0,node.y=0,previousNode=node)}));var left=function(node){for(var children;children=node.children;)node=children[0];return node}(root),right=function(node){for(var children;children=node.children;)node=children[children.length-1];return node}(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return root.eachAfter(nodeSize?function(node){node.x=(node.x-root.x)*dx,node.y=(root.y-node.y)*dy}:function(node){node.x=(node.x-x0)/(x1-x0)*dx,node.y=(1-(root.y?node.y/root.y:1))*dy})}return cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation},cluster.size=function(x){return arguments.length?(nodeSize=!1,dx=+x[0],dy=+x[1],cluster):nodeSize?null:[dx,dy]},cluster.nodeSize=function(x){return arguments.length?(nodeSize=!0,dx=+x[0],dy=+x[1],cluster):nodeSize?[dx,dy]:null},cluster},exports.hierarchy=hierarchy,exports.pack=function(){var radius=null,dx=1,dy=1,padding=constantZero;function pack(root){return root.x=dx/2,root.y=dy/2,radius?root.eachBefore(radiusLeaf(radius)).eachAfter(packChildren(padding,.5)).eachBefore(translateChild(1)):root.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(padding,root.r/Math.min(dx,dy))).eachBefore(translateChild(Math.min(dx,dy)/(2*root.r))),root}return pack.radius=function(x){return arguments.length?(radius=optional(x),pack):radius},pack.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],pack):[dx,dy]},pack.padding=function(x){return arguments.length?(padding="function"==typeof x?x:constant(+x),pack):padding},pack},exports.packEnclose=enclose,exports.packSiblings=function(circles){return packEnclose(circles),circles},exports.partition=function(){var dx=1,dy=1,padding=0,round=!1;function partition(root){var n=root.height+1;return root.x0=root.y0=padding,root.x1=dx,root.y1=dy/n,root.eachBefore(function(dy,n){return function(node){node.children&&treemapDice(node,node.x0,dy*(node.depth+1)/n,node.x1,dy*(node.depth+2)/n);var x0=node.x0,y0=node.y0,x1=node.x1-padding,y1=node.y1-padding;x1<x0&&(x0=x1=(x0+x1)/2),y1<y0&&(y0=y1=(y0+y1)/2),node.x0=x0,node.y0=y0,node.x1=x1,node.y1=y1}}(dy,n)),round&&root.eachBefore(roundNode),root}return partition.round=function(x){return arguments.length?(round=!!x,partition):round},partition.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],partition):[dx,dy]},partition.padding=function(x){return arguments.length?(padding=+x,partition):padding},partition},exports.stratify=function(){var id=defaultId,parentId=defaultParentId;function stratify(data){var d,i,root,parent,node,nodeId,nodeKey,nodes=Array.from(data),n=nodes.length,nodeByKey=new Map;for(i=0;i<n;++i)d=nodes[i],node=nodes[i]=new Node(d),null!=(nodeId=id(d,i,data))&&(nodeId+="")&&(nodeKey=node.id=nodeId,nodeByKey.set(nodeKey,nodeByKey.has(nodeKey)?ambiguous:node)),null!=(nodeId=parentId(d,i,data))&&(nodeId+="")&&(node.parent=nodeId);for(i=0;i<n;++i)if(nodeId=(node=nodes[i]).parent){if(!(parent=nodeByKey.get(nodeId)))throw new Error("missing: "+nodeId);if(parent===ambiguous)throw new Error("ambiguous: "+nodeId);parent.children?parent.children.push(node):parent.children=[node],node.parent=parent}else{if(root)throw new Error("multiple roots");root=node}if(!root)throw new Error("no root");if(root.parent=preroot,root.eachBefore((function(node){node.depth=node.parent.depth+1,--n})).eachBefore(computeHeight),root.parent=null,n>0)throw new Error("cycle");return root}return stratify.id=function(x){return arguments.length?(id=required(x),stratify):id},stratify.parentId=function(x){return arguments.length?(parentId=required(x),stratify):parentId},stratify},exports.tree=function(){var separation=defaultSeparation$1,dx=1,dy=1,nodeSize=null;function tree(root){var t=function(root){for(var node,child,children,i,n,tree=new TreeNode(root,0),nodes=[tree];node=nodes.pop();)if(children=node._.children)for(node.children=new Array(n=children.length),i=n-1;i>=0;--i)nodes.push(child=node.children[i]=new TreeNode(children[i],i)),child.parent=node;return(tree.parent=new TreeNode(null,0)).children=[tree],tree}(root);if(t.eachAfter(firstWalk),t.parent.m=-t.z,t.eachBefore(secondWalk),nodeSize)root.eachBefore(sizeNode);else{var left=root,right=root,bottom=root;root.eachBefore((function(node){node.x<left.x&&(left=node),node.x>right.x&&(right=node),node.depth>bottom.depth&&(bottom=node)}));var s=left===right?1:separation(left,right)/2,tx=s-left.x,kx=dx/(right.x+s+tx),ky=dy/(bottom.depth||1);root.eachBefore((function(node){node.x=(node.x+tx)*kx,node.y=node.depth*ky}))}return root}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children){!function(v){for(var w,shift=0,change=0,children=v.children,i=children.length;--i>=0;)(w=children[i]).z+=shift,w.m+=shift,shift+=w.s+(change+=w.c)}(v);var midpoint=(children[0].z+children[children.length-1].z)/2;w?(v.z=w.z+separation(v._,w._),v.m=v.z-midpoint):v.z=midpoint}else w&&(v.z=w.z+separation(v._,w._));v.parent.A=function(v,w,ancestor){if(w){for(var shift,vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m;vim=nextRight(vim),vip=nextLeft(vip),vim&&vip;)vom=nextLeft(vom),(vop=nextRight(vop)).a=v,(shift=vim.z+sim-vip.z-sip+separation(vim._,vip._))>0&&(moveSubtree(nextAncestor(vim,v,ancestor),v,shift),sip+=shift,sop+=shift),sim+=vim.m,sip+=vip.m,som+=vom.m,sop+=vop.m;vim&&!nextRight(vop)&&(vop.t=vim,vop.m+=sim-sop),vip&&!nextLeft(vom)&&(vom.t=vip,vom.m+=sip-som,ancestor=v)}return ancestor}(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m,v.m+=v.parent.m}function sizeNode(node){node.x*=dx,node.y=node.depth*dy}return tree.separation=function(x){return arguments.length?(separation=x,tree):separation},tree.size=function(x){return arguments.length?(nodeSize=!1,dx=+x[0],dy=+x[1],tree):nodeSize?null:[dx,dy]},tree.nodeSize=function(x){return arguments.length?(nodeSize=!0,dx=+x[0],dy=+x[1],tree):nodeSize?[dx,dy]:null},tree},exports.treemap=function(){var tile=squarify,round=!1,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root){return root.x0=root.y0=0,root.x1=dx,root.y1=dy,root.eachBefore(positionNode),paddingStack=[0],round&&root.eachBefore(roundNode),root}function positionNode(node){var p=paddingStack[node.depth],x0=node.x0+p,y0=node.y0+p,x1=node.x1-p,y1=node.y1-p;x1<x0&&(x0=x1=(x0+x1)/2),y1<y0&&(y0=y1=(y0+y1)/2),node.x0=x0,node.y0=y0,node.x1=x1,node.y1=y1,node.children&&(p=paddingStack[node.depth+1]=paddingInner(node)/2,x0+=paddingLeft(node)-p,y0+=paddingTop(node)-p,(x1-=paddingRight(node)-p)<x0&&(x0=x1=(x0+x1)/2),(y1-=paddingBottom(node)-p)<y0&&(y0=y1=(y0+y1)/2),tile(node,x0,y0,x1,y1))}return treemap.round=function(x){return arguments.length?(round=!!x,treemap):round},treemap.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],treemap):[dx,dy]},treemap.tile=function(x){return arguments.length?(tile=required(x),treemap):tile},treemap.padding=function(x){return arguments.length?treemap.paddingInner(x).paddingOuter(x):treemap.paddingInner()},treemap.paddingInner=function(x){return arguments.length?(paddingInner="function"==typeof x?x:constant(+x),treemap):paddingInner},treemap.paddingOuter=function(x){return arguments.length?treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x):treemap.paddingTop()},treemap.paddingTop=function(x){return arguments.length?(paddingTop="function"==typeof x?x:constant(+x),treemap):paddingTop},treemap.paddingRight=function(x){return arguments.length?(paddingRight="function"==typeof x?x:constant(+x),treemap):paddingRight},treemap.paddingBottom=function(x){return arguments.length?(paddingBottom="function"==typeof x?x:constant(+x),treemap):paddingBottom},treemap.paddingLeft=function(x){return arguments.length?(paddingLeft="function"==typeof x?x:constant(+x),treemap):paddingLeft},treemap},exports.treemapBinary=function(parent,x0,y0,x1,y1){var i,sum,nodes=parent.children,n=nodes.length,sums=new Array(n+1);for(sums[0]=sum=i=0;i<n;++i)sums[i+1]=sum+=nodes[i].value;!function partition(i,j,value,x0,y0,x1,y1){if(i>=j-1){var node=nodes[i];return node.x0=x0,node.y0=y0,node.x1=x1,void(node.y1=y1)}for(var valueOffset=sums[i],valueTarget=value/2+valueOffset,k=i+1,hi=j-1;k<hi;){var mid=k+hi>>>1;sums[mid]<valueTarget?k=mid+1:hi=mid}valueTarget-sums[k-1]<sums[k]-valueTarget&&i+1<k&&--k;var valueLeft=sums[k]-valueOffset,valueRight=value-valueLeft;if(x1-x0>y1-y0){var xk=value?(x0*valueRight+x1*valueLeft)/value:x1;partition(i,k,valueLeft,x0,y0,xk,y1),partition(k,j,valueRight,xk,y0,x1,y1)}else{var yk=value?(y0*valueRight+y1*valueLeft)/value:y1;partition(i,k,valueLeft,x0,y0,x1,yk),partition(k,j,valueRight,x0,yk,x1,y1)}}(0,n,parent.value,x0,y0,x1,y1)},exports.treemapDice=treemapDice,exports.treemapResquarify=resquarify,exports.treemapSlice=treemapSlice,exports.treemapSliceDice=function(parent,x0,y0,x1,y1){(1&parent.depth?treemapSlice:treemapDice)(parent,x0,y0,x1,y1)},exports.treemapSquarify=squarify,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaCanvas,vegaDataflow,vegaScenegraph,vegaUtil){"use strict";function markBitmaps($,avoidMarks,labelInside,isGroupArea){const width=$.width,height=$.height,border=labelInside||isGroupArea,context=vegaCanvas.canvas(width,height).getContext("2d");avoidMarks.forEach(items=>function draw(context,items,interior){if(!items.length)return;const type=items[0].mark.marktype;"group"===type?items.forEach(group=>{group.items.forEach(mark=>draw(context,mark.items,interior))}):vegaScenegraph.Marks[type].draw(context,{items:interior?items.map(prepare):items})}(context,items,border));const buffer=new Uint32Array(context.getImageData(0,0,width,height).data.buffer),layer1=$.bitmap(),layer2=border&&$.bitmap();let x,y,u,v,alpha;for(y=0;y<height;++y)for(x=0;x<width;++x)alpha=4278190080&buffer[y*width+x],alpha&&(u=$(x),v=$(y),isGroupArea||layer1.set(u,v),border&&268435456^alpha&&layer2.set(u,v));return[layer1,layer2]}function prepare(source){const item=vegaDataflow.rederive(source,{});return item.stroke&&(item.strokeOpacity=1),item.fill&&(item.fillOpacity=.0625,item.stroke="#000",item.strokeOpacity=1,item.strokeWidth=2),item}const RIGHT0=new Uint32Array(33),RIGHT1=new Uint32Array(33);RIGHT1[0]=0,RIGHT0[0]=~RIGHT1[0];for(let i=1;i<=32;++i)RIGHT1[i]=RIGHT1[i-1]<<1|1,RIGHT0[i]=~RIGHT1[i];function scaler(width,height,padding){const ratio=Math.max(1,Math.sqrt(width*height/1e6)),w=~~((width+2*padding+ratio)/ratio),h=~~((height+2*padding+ratio)/ratio),scale=_=>~~((_+padding)/ratio);return scale.invert=_=>_*ratio-padding,scale.bitmap=()=>function(w,h){const array=new Uint32Array(~~((w*h+32)/32));function _set(index,mask){array[index]|=mask}function _clear(index,mask){array[index]&=mask}return{array:array,get:(x,y)=>{const index=y*w+x;return array[index>>>5]&1<<(31&index)},set:(x,y)=>{const index=y*w+x;_set(index>>>5,1<<(31&index))},clear:(x,y)=>{const index=y*w+x;_clear(index>>>5,~(1<<(31&index)))},getRange:(x,y,x2,y2)=>{let start,end,indexStart,indexEnd,r=y2;for(;r>=y;--r)if(start=r*w+x,end=r*w+x2,indexStart=start>>>5,indexEnd=end>>>5,indexStart===indexEnd){if(array[indexStart]&RIGHT0[31&start]&RIGHT1[1+(31&end)])return!0}else{if(array[indexStart]&RIGHT0[31&start])return!0;if(array[indexEnd]&RIGHT1[1+(31&end)])return!0;for(let i=indexStart+1;i<indexEnd;++i)if(array[i])return!0}return!1},setRange:(x,y,x2,y2)=>{let start,end,indexStart,indexEnd,i;for(;y<=y2;++y)if(start=y*w+x,end=y*w+x2,indexStart=start>>>5,indexEnd=end>>>5,indexStart===indexEnd)_set(indexStart,RIGHT0[31&start]&RIGHT1[1+(31&end)]);else for(_set(indexStart,RIGHT0[31&start]),_set(indexEnd,RIGHT1[1+(31&end)]),i=indexStart+1;i<indexEnd;++i)_set(i,4294967295)},clearRange:(x,y,x2,y2)=>{let start,end,indexStart,indexEnd,i;for(;y<=y2;++y)if(start=y*w+x,end=y*w+x2,indexStart=start>>>5,indexEnd=end>>>5,indexStart===indexEnd)_clear(indexStart,RIGHT1[31&start]|RIGHT0[1+(31&end)]);else for(_clear(indexStart,RIGHT1[31&start]),_clear(indexEnd,RIGHT0[1+(31&end)]),i=indexStart+1;i<indexEnd;++i)_clear(i,0)},outOfBounds:(x,y,x2,y2)=>x<0||y<0||y2>=h||x2>=w}}(w,h),scale.ratio=ratio,scale.padding=padding,scale.width=width,scale.height=height,scale}function outOfBounds(x,y,textWidth,textHeight,width,height){let r=textWidth/2;return x-r<0||x+r>width||y-(r=textHeight/2)<0||y+r>height}function collision($,x,y,textHeight,textWidth,h,bm0,bm1){const w=textWidth*h/(2*textHeight),x1=$(x-w),x2=$(x+w),y1=$(y-(h/=2)),y2=$(y+h);return bm0.outOfBounds(x1,y1,x2,y2)||bm0.getRange(x1,y1,x2,y2)||bm1&&bm1.getRange(x1,y1,x2,y2)}const X_DIR=[-1,-1,1,1],Y_DIR=[-1,1,-1,1],Aligns=["right","center","left"],Baselines=["bottom","middle","top"];function test(_x1,_x2,_y1,_y2,bm0,bm1,x1,x2,y1,y2,boundary,isInside){return!(bm0.outOfBounds(_x1,_y1,_x2,_y2)||(isInside&&bm1?bm1.getRange(_x1,_y1,_x2,_y2)||!function(x1,y1,x2,y2,boundary){return boundary[0]<=x1&&x2<=boundary[2]&&boundary[3]<=y1&&y2<=boundary[5]}(x1,y1,x2,y2,boundary):bm0.getRange(_x1,_y1,_x2,_y2)))}const anchorCode={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},placeAreaLabel={naive:function($,bitmaps,avoidBaseMark,markIndex){const width=$.width,height=$.height;return function(d){const items=d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text);let x1,x2,y1,y2,x,y,areaWidth,maxAreaWidth=0;for(let i=0;i<n;++i)x1=items[i].x,y1=items[i].y,x2=void 0===items[i].x2?x1:items[i].x2,y2=void 0===items[i].y2?y1:items[i].y2,x=(x1+x2)/2,y=(y1+y2)/2,areaWidth=Math.abs(x2-x1+y2-y1),areaWidth>=maxAreaWidth&&(maxAreaWidth=areaWidth,d.x=x,d.y=y);return x=textWidth/2,y=textHeight/2,x1=d.x-x,x2=d.x+x,y1=d.y-y,y2=d.y+y,d.align="center",x1<0&&x2<=width?d.align="left":0<=x1&&width<x2&&(d.align="right"),d.baseline="middle",y1<0&&y2<=height?d.baseline="top":0<=y1&&height<y2&&(d.baseline="bottom"),!0}},"reduced-search":function($,bitmaps,avoidBaseMark,markIndex){const width=$.width,height=$.height,bm0=bitmaps[0],bm1=bitmaps[1];function tryLabel(_x,_y,maxSize,textWidth,textHeight){const x=$.invert(_x),y=$.invert(_y);let mid,lo=maxSize,hi=height;if(!outOfBounds(x,y,textWidth,textHeight,width,height)&&!collision($,x,y,textHeight,textWidth,lo,bm0,bm1)&&!collision($,x,y,textHeight,textWidth,textHeight,bm0,null)){for(;hi-lo>=1;)mid=(lo+hi)/2,collision($,x,y,textHeight,textWidth,mid,bm0,bm1)?hi=mid:lo=mid;if(lo>maxSize)return[x,y,lo,!0]}}return function(d){const items=d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text);let x1,x2,y1,y2,x,y,_x,_y,_x1,_xMid,_x2,_y1,_yMid,_y2,areaWidth,result,swapTmp,maxSize=avoidBaseMark?textHeight:0,labelPlaced=!1,labelPlaced2=!1,maxAreaWidth=0;for(let i=0;i<n;++i){for(x1=items[i].x,y1=items[i].y,x2=void 0===items[i].x2?x1:items[i].x2,y2=void 0===items[i].y2?y1:items[i].y2,x1>x2&&(swapTmp=x1,x1=x2,x2=swapTmp),y1>y2&&(swapTmp=y1,y1=y2,y2=swapTmp),_x1=$(x1),_x2=$(x2),_xMid=~~((_x1+_x2)/2),_y1=$(y1),_y2=$(y2),_yMid=~~((_y1+_y2)/2),_x=_xMid;_x>=_x1;--_x)for(_y=_yMid;_y>=_y1;--_y)result=tryLabel(_x,_y,maxSize,textWidth,textHeight),result&&([d.x,d.y,maxSize,labelPlaced]=result);for(_x=_xMid;_x<=_x2;++_x)for(_y=_yMid;_y<=_y2;++_y)result=tryLabel(_x,_y,maxSize,textWidth,textHeight),result&&([d.x,d.y,maxSize,labelPlaced]=result);labelPlaced||avoidBaseMark||(areaWidth=Math.abs(x2-x1+y2-y1),x=(x1+x2)/2,y=(y1+y2)/2,areaWidth>=maxAreaWidth&&!outOfBounds(x,y,textWidth,textHeight,width,height)&&!collision($,x,y,textHeight,textWidth,textHeight,bm0,null)&&(maxAreaWidth=areaWidth,d.x=x,d.y=y,labelPlaced2=!0))}return!(!labelPlaced&&!labelPlaced2||(x=textWidth/2,y=textHeight/2,bm0.setRange($(d.x-x),$(d.y-y),$(d.x+x),$(d.y+y)),d.align="center",d.baseline="middle",0))}},floodfill:function($,bitmaps,avoidBaseMark,markIndex){const width=$.width,height=$.height,bm0=bitmaps[0],bm1=bitmaps[1],bm2=$.bitmap();return function(d){const items=d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text),stack=[];let x1,x2,y1,y2,x,y,_x,_y,lo,hi,mid,areaWidth,maxSize=avoidBaseMark?textHeight:0,labelPlaced=!1,labelPlaced2=!1,maxAreaWidth=0;for(let i=0;i<n;++i){for(x1=items[i].x,y1=items[i].y,x2=void 0===items[i].x2?x1:items[i].x2,y2=void 0===items[i].y2?y1:items[i].y2,stack.push([$((x1+x2)/2),$((y1+y2)/2)]);stack.length;)if([_x,_y]=stack.pop(),!(bm0.get(_x,_y)||bm1.get(_x,_y)||bm2.get(_x,_y))){bm2.set(_x,_y);for(let j=0;j<4;++j)x=_x+X_DIR[j],y=_y+Y_DIR[j],bm2.outOfBounds(x,y,x,y)||stack.push([x,y]);if(x=$.invert(_x),y=$.invert(_y),lo=maxSize,hi=height,!outOfBounds(x,y,textWidth,textHeight,width,height)&&!collision($,x,y,textHeight,textWidth,lo,bm0,bm1)&&!collision($,x,y,textHeight,textWidth,textHeight,bm0,null)){for(;hi-lo>=1;)mid=(lo+hi)/2,collision($,x,y,textHeight,textWidth,mid,bm0,bm1)?hi=mid:lo=mid;lo>maxSize&&(d.x=x,d.y=y,maxSize=lo,labelPlaced=!0)}}labelPlaced||avoidBaseMark||(areaWidth=Math.abs(x2-x1+y2-y1),x=(x1+x2)/2,y=(y1+y2)/2,areaWidth>=maxAreaWidth&&!outOfBounds(x,y,textWidth,textHeight,width,height)&&!collision($,x,y,textHeight,textWidth,textHeight,bm0,null)&&(maxAreaWidth=areaWidth,d.x=x,d.y=y,labelPlaced2=!0))}return!(!labelPlaced&&!labelPlaced2||(x=textWidth/2,y=textHeight/2,bm0.setRange($(d.x-x),$(d.y-y),$(d.x+x),$(d.y+y)),d.align="center",d.baseline="middle",0))}}};function labelLayout(texts,size,compare,offset,anchor,avoidMarks,avoidBaseMark,lineAnchor,markIndex,padding,method){if(!texts.length)return texts;const positions=Math.max(offset.length,anchor.length),offsets=function(_,count){const offsets=new Float64Array(count),n=_.length;for(let i=0;i<n;++i)offsets[i]=_[i]||0;for(let i=n;i<count;++i)offsets[i]=offsets[n-1];return offsets}(offset,positions),anchors=function(_,count){const anchors=new Int8Array(count),n=_.length;for(let i=0;i<n;++i)anchors[i]|=anchorCode[_[i]];for(let i=n;i<count;++i)anchors[i]=anchors[n-1];return anchors}(anchor,positions),marktype=(item=texts[0].datum)&&item.mark&&item.mark.marktype,grouptype="group"===marktype&&texts[0].datum.items[markIndex].marktype,isGroupArea="area"===grouptype,boundary=function(marktype,grouptype,lineAnchor,markIndex){const xy=d=>[d.x,d.x,d.x,d.y,d.y,d.y];return marktype?"line"===marktype||"area"===marktype?d=>xy(d.datum):"line"===grouptype?d=>{const items=d.datum.items[markIndex].items;return xy(items.length?items["start"===lineAnchor?0:items.length-1]:{x:NaN,y:NaN})}:d=>{const b=d.datum.bounds;return[b.x1,(b.x1+b.x2)/2,b.x2,b.y1,(b.y1+b.y2)/2,b.y2]}:xy}(marktype,grouptype,lineAnchor,markIndex),$=scaler(size[0],size[1],padding),isNaiveGroupArea=isGroupArea&&"naive"===method;var item;const data=texts.map(d=>({datum:d,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:boundary(d)}));let bitmaps;if(!isNaiveGroupArea){compare&&data.sort((a,b)=>compare(a.datum,b.datum));let labelInside=!1;for(let i=0;i<anchors.length&&!labelInside;++i)labelInside=5===anchors[i]||offsets[i]<0;marktype&&(avoidBaseMark||isGroupArea)&&(avoidMarks=[texts.map(d=>d.datum)].concat(avoidMarks)),bitmaps=avoidMarks.length?markBitmaps($,avoidMarks,labelInside,isGroupArea):function($,data){const bitmap=$.bitmap();return(data||[]).forEach(d=>bitmap.set($(d.boundary[0]),$(d.boundary[3]))),[bitmap,void 0]}($,avoidBaseMark&&data)}const place=isGroupArea?placeAreaLabel[method]($,bitmaps,avoidBaseMark,markIndex):function($,bitmaps,anchors,offsets){const width=$.width,height=$.height,bm0=bitmaps[0],bm1=bitmaps[1],n=offsets.length;return function(d){const boundary=d.boundary,textHeight=d.datum.fontSize;if(boundary[2]<0||boundary[5]<0||boundary[0]>width||boundary[3]>height)return!1;let dx,dy,isInside,sizeFactor,insideFactor,x1,x2,y1,y2,xc,yc,_x1,_x2,_y1,_y2,textWidth=0;for(let i=0;i<n;++i){if(dx=(3&anchors[i])-1,dy=(anchors[i]>>>2&3)-1,isInside=0===dx&&0===dy||offsets[i]<0,sizeFactor=dx&&dy?Math.SQRT1_2:1,insideFactor=offsets[i]<0?-1:1,x1=boundary[1+dx]+offsets[i]*dx*sizeFactor,yc=boundary[4+dy]+insideFactor*textHeight*dy/2+offsets[i]*dy*sizeFactor,y1=yc-textHeight/2,y2=yc+textHeight/2,_x1=$(x1),_y1=$(y1),_y2=$(y2),!textWidth){if(!test(_x1,_x1,_y1,_y2,bm0,bm1,x1,x1,y1,y2,boundary,isInside))continue;textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text)}if(xc=x1+insideFactor*textWidth*dx/2,x1=xc-textWidth/2,x2=xc+textWidth/2,_x1=$(x1),_x2=$(x2),test(_x1,_x2,_y1,_y2,bm0,bm1,x1,x2,y1,y2,boundary,isInside))return d.x=dx?dx*insideFactor<0?x2:x1:xc,d.y=dy?dy*insideFactor<0?y2:y1:yc,d.align=Aligns[dx*insideFactor+1],d.baseline=Baselines[dy*insideFactor+1],bm0.setRange(_x1,_y1,_x2,_y2),!0}return!1}}($,bitmaps,anchors,offsets);return data.forEach(d=>d.opacity=+place(d)),data}const Output=["x","y","opacity","align","baseline"],Anchors=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function Label(params){vegaDataflow.Transform.call(this,null,params)}Label.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Anchors},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Output.length,default:Output}]},vegaUtil.inherits(Label,vegaDataflow.Transform,{transform(_,pulse){const mod=_.modified();if(!(mod||pulse.changed(pulse.ADD_REM)||function(param){const p=_[param];return vegaUtil.isFunction(p)&&pulse.modified(p.fields)}("sort")))return;_.size&&2===_.size.length||vegaUtil.error("Size parameter should be specified as a [width, height] array.");const as=_.as||Output;return labelLayout(pulse.materialize(pulse.SOURCE).source,_.size,_.sort,vegaUtil.array(_.offset||1),vegaUtil.array(_.anchor||Anchors),_.avoidMarks||[],!1!==_.avoidBaseMark,_.lineAnchor||"end",_.markIndex||0,_.padding||0,_.method||"naive").forEach(l=>{const t=l.datum;t[as[0]]=l.x,t[as[1]]=l.y,t[as[2]]=l.opacity,t[as[3]]=l.align,t[as[4]]=l.baseline}),pulse.reflow(mod).modifies(as)}}),exports.label=Label,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(58),__webpack_require__(40),__webpack_require__(50),__webpack_require__(37))},function(module,exports,__webpack_require__){!function(exports,vegaStatistics,vegaDataflow,vegaUtil){"use strict";function partition(data,groupby){var map,i,n,t,k,g,groups=[],get=function(f){return f(t)};if(null==groupby)groups.push(data);else for(map={},i=0,n=data.length;i<n;++i)t=data[i],(g=map[k=groupby.map(get)])||(map[k]=g=[],g.dims=k,groups.push(g)),g.push(t);return groups}function Loess(params){vegaDataflow.Transform.call(this,null,params)}Loess.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},vegaUtil.inherits(Loess,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);if(!this.value||pulse.changed()||_.modified()){const groups=partition(pulse.materialize(pulse.SOURCE).source,_.groupby),names=(_.groupby||[]).map(vegaUtil.accessorName),m=names.length,as=_.as||[vegaUtil.accessorName(_.x),vegaUtil.accessorName(_.y)],values=[];groups.forEach(g=>{vegaStatistics.regressionLoess(g,_.x,_.y,_.bandwidth||.3).forEach(p=>{const t={};for(let i=0;i<m;++i)t[names[i]]=g.dims[i];t[as[0]]=p[0],t[as[1]]=p[1],values.push(vegaDataflow.ingest(t))})}),this.value&&(out.rem=this.value),this.value=out.add=out.source=values}return out}});const Methods={linear:vegaStatistics.regressionLinear,log:vegaStatistics.regressionLog,exp:vegaStatistics.regressionExp,pow:vegaStatistics.regressionPow,quad:vegaStatistics.regressionQuad,poly:vegaStatistics.regressionPoly};function Regression(params){vegaDataflow.Transform.call(this,null,params)}Regression.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Methods)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},vegaUtil.inherits(Regression,vegaDataflow.Transform,{transform(_,pulse){const out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);if(!this.value||pulse.changed()||_.modified()){const groups=partition(pulse.materialize(pulse.SOURCE).source,_.groupby),names=(_.groupby||[]).map(vegaUtil.accessorName),method=_.method||"linear",order=_.order||3,dof=((method,order)=>"poly"===method?order:"quad"===method?2:1)(method,order),as=_.as||[vegaUtil.accessorName(_.x),vegaUtil.accessorName(_.y)],fit=Methods[method],values=[];let domain=_.extent;vegaUtil.hasOwnProperty(Methods,method)||vegaUtil.error("Invalid regression method: "+method),null!=domain&&"log"===method&&domain[0]<=0&&(pulse.dataflow.warn("Ignoring extent with values <= 0 for log regression."),domain=null),groups.forEach(g=>{if(g.length<=dof)return void pulse.dataflow.warn("Skipping regression with more parameters than data points.");const model=fit(g,_.x,_.y,order);if(_.params)return void values.push(vegaDataflow.ingest({keys:g.dims,coef:model.coef,rSquared:model.rSquared}));const dom=domain||vegaUtil.extent(g,_.x),add=p=>{const t={};for(let i=0;i<names.length;++i)t[names[i]]=g.dims[i];t[as[0]]=p[0],t[as[1]]=p[1],values.push(vegaDataflow.ingest(t))};"linear"===method?dom.forEach(x=>add([x,model.predict(x)])):vegaStatistics.sampleCurve(model.predict,dom,25,200).forEach(add)}),this.value&&(out.rem=this.value),this.value=out.add=out.source=values}return out}}),exports.loess=Loess,exports.regression=Regression,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(44),__webpack_require__(40),__webpack_require__(37))},function(module,exports,__webpack_require__){!function(exports,vegaDataflow,vegaUtil,d3Delaunay){"use strict";function Voronoi(params){vegaDataflow.Transform.call(this,null,params)}Voronoi.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const defaultExtent=[-1e5,-1e5,1e5,1e5];function toPathString(p){const x=p[0][0],y=p[0][1];let n=p.length-1;for(;p[n][0]===x&&p[n][1]===y;--n);return"M"+p.slice(0,n+1).join("L")+"Z"}vegaUtil.inherits(Voronoi,vegaDataflow.Transform,{transform(_,pulse){const as=_.as||"path",data=pulse.source;if(!data||!data.length)return pulse;let s=_.size;s=s?[0,0,s[0],s[1]]:(s=_.extent)?[s[0][0],s[0][1],s[1][0],s[1][1]]:defaultExtent;const voronoi=this.value=d3Delaunay.Delaunay.from(data,_.x,_.y).voronoi(s);for(let i=0,n=data.length;i<n;++i){const polygon=voronoi.cellPolygon(i);data[i][as]=polygon?toPathString(polygon):null}return pulse.reflow(_.modified()).modifies(as)}}),exports.voronoi=Voronoi,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(40),__webpack_require__(37),__webpack_require__(123))},function(module,exports,__webpack_require__){!function(exports){"use strict";const EPSILON=Math.pow(2,-52),EDGE_STACK=new Uint32Array(512);class Delaunator{static from(points,getX=defaultGetX,getY=defaultGetY){const n=points.length,coords=new Float64Array(2*n);for(let i=0;i<n;i++){const p=points[i];coords[2*i]=getX(p),coords[2*i+1]=getY(p)}return new Delaunator(coords)}constructor(coords){const n=coords.length>>1;if(n>0&&"number"!=typeof coords[0])throw new Error("Expected coords to contain numbers.");this.coords=coords;const maxTriangles=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*maxTriangles),this._halfedges=new Int32Array(3*maxTriangles),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:coords,_hullPrev:hullPrev,_hullNext:hullNext,_hullTri:hullTri,_hullHash:hullHash}=this,n=coords.length>>1;let minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;for(let i=0;i<n;i++){const x=coords[2*i],y=coords[2*i+1];x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y),this._ids[i]=i}const cx=(minX+maxX)/2,cy=(minY+maxY)/2;let i0,i1,i2,minDist=1/0;for(let i=0;i<n;i++){const d=dist(cx,cy,coords[2*i],coords[2*i+1]);d<minDist&&(i0=i,minDist=d)}const i0x=coords[2*i0],i0y=coords[2*i0+1];minDist=1/0;for(let i=0;i<n;i++){if(i===i0)continue;const d=dist(i0x,i0y,coords[2*i],coords[2*i+1]);d<minDist&&d>0&&(i1=i,minDist=d)}let i1x=coords[2*i1],i1y=coords[2*i1+1],minRadius=1/0;for(let i=0;i<n;i++){if(i===i0||i===i1)continue;const r=circumradius(i0x,i0y,i1x,i1y,coords[2*i],coords[2*i+1]);r<minRadius&&(i2=i,minRadius=r)}let i2x=coords[2*i2],i2y=coords[2*i2+1];if(minRadius===1/0){for(let i=0;i<n;i++)this._dists[i]=coords[2*i]-coords[0]||coords[2*i+1]-coords[1];quicksort(this._ids,this._dists,0,n-1);const hull=new Uint32Array(n);let j=0;for(let i=0,d0=-1/0;i<n;i++){const id=this._ids[i];this._dists[id]>d0&&(hull[j++]=id,d0=this._dists[id])}return this.hull=hull.subarray(0,j),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(orient(i0x,i0y,i1x,i1y,i2x,i2y)){const i=i1,x=i1x,y=i1y;i1=i2,i1x=i2x,i1y=i2y,i2=i,i2x=x,i2y=y}const center=function(ax,ay,bx,by,cx,cy){const dx=bx-ax,dy=by-ay,ex=cx-ax,ey=cy-ay,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,d=.5/(dx*ey-dy*ex);return{x:ax+(ey*bl-dy*cl)*d,y:ay+(dx*cl-ex*bl)*d}}(i0x,i0y,i1x,i1y,i2x,i2y);this._cx=center.x,this._cy=center.y;for(let i=0;i<n;i++)this._dists[i]=dist(coords[2*i],coords[2*i+1],center.x,center.y);quicksort(this._ids,this._dists,0,n-1),this._hullStart=i0;let hullSize=3;hullNext[i0]=hullPrev[i2]=i1,hullNext[i1]=hullPrev[i0]=i2,hullNext[i2]=hullPrev[i1]=i0,hullTri[i0]=0,hullTri[i1]=1,hullTri[i2]=2,hullHash.fill(-1),hullHash[this._hashKey(i0x,i0y)]=i0,hullHash[this._hashKey(i1x,i1y)]=i1,hullHash[this._hashKey(i2x,i2y)]=i2,this.trianglesLen=0,this._addTriangle(i0,i1,i2,-1,-1,-1);for(let xp,yp,k=0;k<this._ids.length;k++){const i=this._ids[k],x=coords[2*i],y=coords[2*i+1];if(k>0&&Math.abs(x-xp)<=EPSILON&&Math.abs(y-yp)<=EPSILON)continue;if(xp=x,yp=y,i===i0||i===i1||i===i2)continue;let start=0;for(let j=0,key=this._hashKey(x,y);j<this._hashSize&&(start=hullHash[(key+j)%this._hashSize],-1===start||start===hullNext[start]);j++);start=hullPrev[start];let q,e=start;for(;q=hullNext[e],!orient(x,y,coords[2*e],coords[2*e+1],coords[2*q],coords[2*q+1]);)if(e=q,e===start){e=-1;break}if(-1===e)continue;let t=this._addTriangle(e,i,hullNext[e],-1,-1,hullTri[e]);hullTri[i]=this._legalize(t+2),hullTri[e]=t,hullSize++;let n=hullNext[e];for(;q=hullNext[n],orient(x,y,coords[2*n],coords[2*n+1],coords[2*q],coords[2*q+1]);)t=this._addTriangle(n,i,q,hullTri[i],-1,hullTri[n]),hullTri[i]=this._legalize(t+2),hullNext[n]=n,hullSize--,n=q;if(e===start)for(;q=hullPrev[e],orient(x,y,coords[2*q],coords[2*q+1],coords[2*e],coords[2*e+1]);)t=this._addTriangle(q,i,e,-1,hullTri[e],hullTri[q]),this._legalize(t+2),hullTri[q]=t,hullNext[e]=e,hullSize--,e=q;this._hullStart=hullPrev[i]=e,hullNext[e]=hullPrev[n]=i,hullNext[i]=n,hullHash[this._hashKey(x,y)]=i,hullHash[this._hashKey(coords[2*e],coords[2*e+1])]=e}this.hull=new Uint32Array(hullSize);for(let i=0,e=this._hullStart;i<hullSize;i++)this.hull[i]=e,e=hullNext[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(x,y){return Math.floor(function(dx,dy){const p=dx/(Math.abs(dx)+Math.abs(dy));return(dy>0?3-p:1+p)/4}(x-this._cx,y-this._cy)*this._hashSize)%this._hashSize}_legalize(a){const{_triangles:triangles,_halfedges:halfedges,coords:coords}=this;let i=0,ar=0;for(;;){const b=halfedges[a],a0=a-a%3;if(ar=a0+(a+2)%3,-1===b){if(0===i)break;a=EDGE_STACK[--i];continue}const b0=b-b%3,al=a0+(a+1)%3,bl=b0+(b+2)%3,p0=triangles[ar],pr=triangles[a],pl=triangles[al],p1=triangles[bl];if(inCircle(coords[2*p0],coords[2*p0+1],coords[2*pr],coords[2*pr+1],coords[2*pl],coords[2*pl+1],coords[2*p1],coords[2*p1+1])){triangles[a]=p1,triangles[b]=p0;const hbl=halfedges[bl];if(-1===hbl){let e=this._hullStart;do{if(this._hullTri[e]===bl){this._hullTri[e]=a;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(a,hbl),this._link(b,halfedges[ar]),this._link(ar,bl);const br=b0+(b+1)%3;i<EDGE_STACK.length&&(EDGE_STACK[i++]=br)}else{if(0===i)break;a=EDGE_STACK[--i]}}return ar}_link(a,b){this._halfedges[a]=b,-1!==b&&(this._halfedges[b]=a)}_addTriangle(i0,i1,i2,a,b,c){const t=this.trianglesLen;return this._triangles[t]=i0,this._triangles[t+1]=i1,this._triangles[t+2]=i2,this._link(t,a),this._link(t+1,b),this._link(t+2,c),this.trianglesLen+=3,t}}function dist(ax,ay,bx,by){const dx=ax-bx,dy=ay-by;return dx*dx+dy*dy}function orientIfSure(px,py,rx,ry,qx,qy){const l=(ry-py)*(qx-px),r=(rx-px)*(qy-py);return Math.abs(l-r)>=33306690738754716e-32*Math.abs(l+r)?l-r:0}function orient(rx,ry,qx,qy,px,py){return(orientIfSure(px,py,rx,ry,qx,qy)||orientIfSure(rx,ry,qx,qy,px,py)||orientIfSure(qx,qy,px,py,rx,ry))<0}function inCircle(ax,ay,bx,by,cx,cy,px,py){const dx=ax-px,dy=ay-py,ex=bx-px,ey=by-py,fx=cx-px,fy=cy-py,bp=ex*ex+ey*ey,cp=fx*fx+fy*fy;return dx*(ey*cp-bp*fy)-dy*(ex*cp-bp*fx)+(dx*dx+dy*dy)*(ex*fy-ey*fx)<0}function circumradius(ax,ay,bx,by,cx,cy){const dx=bx-ax,dy=by-ay,ex=cx-ax,ey=cy-ay,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,d=.5/(dx*ey-dy*ex),x=(ey*bl-dy*cl)*d,y=(dx*cl-ex*bl)*d;return x*x+y*y}function quicksort(ids,dists,left,right){if(right-left<=20)for(let i=left+1;i<=right;i++){const temp=ids[i],tempDist=dists[temp];let j=i-1;for(;j>=left&&dists[ids[j]]>tempDist;)ids[j+1]=ids[j--];ids[j+1]=temp}else{let i=left+1,j=right;swap(ids,left+right>>1,i),dists[ids[left]]>dists[ids[right]]&&swap(ids,left,right),dists[ids[i]]>dists[ids[right]]&&swap(ids,i,right),dists[ids[left]]>dists[ids[i]]&&swap(ids,left,i);const temp=ids[i],tempDist=dists[temp];for(;;){do{i++}while(dists[ids[i]]<tempDist);do{j--}while(dists[ids[j]]>tempDist);if(j<i)break;swap(ids,i,j)}ids[left+1]=ids[j],ids[j]=temp,right-i+1>=j-left?(quicksort(ids,dists,i,right),quicksort(ids,dists,left,j-1)):(quicksort(ids,dists,left,j-1),quicksort(ids,dists,i,right))}}function swap(arr,i,j){const tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultGetX(p){return p[0]}function defaultGetY(p){return p[1]}class Path{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(x,y){this._+=`M${this._x0=this._x1=+x},${this._y0=this._y1=+y}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(x,y){this._+=`L${this._x1=+x},${this._y1=+y}`}arc(x,y,r){const x0=(x=+x)+(r=+r),y0=y=+y;if(r<0)throw new Error("negative radius");null===this._x1?this._+=`M${x0},${y0}`:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(this._+=`A${r},${r},0,1,1,${x-r},${y}A${r},${r},0,1,1,${this._x1=x0},${this._y1=y0}`)}rect(x,y,w,h){this._+=`M${this._x0=this._x1=+x},${this._y0=this._y1=+y}h${+w}v${+h}h${-w}Z`}value(){return this._||null}}class Polygon{constructor(){this._=[]}moveTo(x,y){this._.push([x,y])}closePath(){this._.push(this._[0].slice())}lineTo(x,y){this._.push([x,y])}value(){return this._.length?this._:null}}class Voronoi{constructor(delaunay,[xmin,ymin,xmax,ymax]=[0,0,960,500]){if(!((xmax=+xmax)>=(xmin=+xmin)&&(ymax=+ymax)>=(ymin=+ymin)))throw new Error("invalid bounds");this.delaunay=delaunay,this._circumcenters=new Float64Array(2*delaunay.points.length),this.vectors=new Float64Array(2*delaunay.points.length),this.xmax=xmax,this.xmin=xmin,this.ymax=ymax,this.ymin=ymin,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:points,hull:hull,triangles:triangles},vectors:vectors}=this,circumcenters=this.circumcenters=this._circumcenters.subarray(0,triangles.length/3*2);for(let x,y,i=0,j=0,n=triangles.length;i<n;i+=3,j+=2){const t1=2*triangles[i],t2=2*triangles[i+1],t3=2*triangles[i+2],x1=points[t1],y1=points[t1+1],x2=points[t2],y2=points[t2+1],x3=points[t3],y3=points[t3+1],dx=x2-x1,dy=y2-y1,ex=x3-x1,ey=y3-y1,bl=dx*dx+dy*dy,cl=ex*ex+ey*ey,ab=2*(dx*ey-dy*ex);if(ab)if(Math.abs(ab)<1e-8)x=(x1+x3)/2,y=(y1+y3)/2;else{const d=1/ab;x=x1+(ey*bl-dy*cl)*d,y=y1+(dx*cl-ex*bl)*d}else x=(x1+x3)/2-1e8*ey,y=(y1+y3)/2+1e8*ex;circumcenters[j]=x,circumcenters[j+1]=y}let p0,x0,y0,h=hull[hull.length-1],p1=4*h,x1=points[2*h],y1=points[2*h+1];vectors.fill(0);for(let i=0;i<hull.length;++i)h=hull[i],p0=p1,x0=x1,y0=y1,p1=4*h,x1=points[2*h],y1=points[2*h+1],vectors[p0+2]=vectors[p1]=y0-y1,vectors[p0+3]=vectors[p1+1]=x1-x0}render(context){const buffer=null==context?context=new Path:void 0,{delaunay:{halfedges:halfedges,inedges:inedges,hull:hull},circumcenters:circumcenters,vectors:vectors}=this;if(hull.length<=1)return null;for(let i=0,n=halfedges.length;i<n;++i){const j=halfedges[i];if(j<i)continue;const ti=2*Math.floor(i/3),tj=2*Math.floor(j/3),xi=circumcenters[ti],yi=circumcenters[ti+1],xj=circumcenters[tj],yj=circumcenters[tj+1];this._renderSegment(xi,yi,xj,yj,context)}let h0,h1=hull[hull.length-1];for(let i=0;i<hull.length;++i){h0=h1,h1=hull[i];const t=2*Math.floor(inedges[h1]/3),x=circumcenters[t],y=circumcenters[t+1],v=4*h0,p=this._project(x,y,vectors[v+2],vectors[v+3]);p&&this._renderSegment(x,y,p[0],p[1],context)}return buffer&&buffer.value()}renderBounds(context){const buffer=null==context?context=new Path:void 0;return context.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),buffer&&buffer.value()}renderCell(i,context){const buffer=null==context?context=new Path:void 0,points=this._clip(i);if(null===points||!points.length)return;context.moveTo(points[0],points[1]);let n=points.length;for(;points[0]===points[n-2]&&points[1]===points[n-1]&&n>1;)n-=2;for(let i=2;i<n;i+=2)points[i]===points[i-2]&&points[i+1]===points[i-1]||context.lineTo(points[i],points[i+1]);return context.closePath(),buffer&&buffer.value()}*cellPolygons(){const{delaunay:{points:points}}=this;for(let i=0,n=points.length/2;i<n;++i){const cell=this.cellPolygon(i);cell&&(cell.index=i,yield cell)}}cellPolygon(i){const polygon=new Polygon;return this.renderCell(i,polygon),polygon.value()}_renderSegment(x0,y0,x1,y1,context){let S;const c0=this._regioncode(x0,y0),c1=this._regioncode(x1,y1);0===c0&&0===c1?(context.moveTo(x0,y0),context.lineTo(x1,y1)):(S=this._clipSegment(x0,y0,x1,y1,c0,c1))&&(context.moveTo(S[0],S[1]),context.lineTo(S[2],S[3]))}contains(i,x,y){return(x=+x)==x&&(y=+y)==y&&this.delaunay._step(i,x,y)===i}*neighbors(i){const ci=this._clip(i);if(ci)for(const j of this.delaunay.neighbors(i)){const cj=this._clip(j);if(cj)loop:for(let ai=0,li=ci.length;ai<li;ai+=2)for(let aj=0,lj=cj.length;aj<lj;aj+=2)if(ci[ai]==cj[aj]&&ci[ai+1]==cj[aj+1]&&ci[(ai+2)%li]==cj[(aj+lj-2)%lj]&&ci[(ai+3)%li]==cj[(aj+lj-1)%lj]){yield j;break loop}}}_cell(i){const{circumcenters:circumcenters,delaunay:{inedges:inedges,halfedges:halfedges,triangles:triangles}}=this,e0=inedges[i];if(-1===e0)return null;const points=[];let e=e0;do{const t=Math.floor(e/3);if(points.push(circumcenters[2*t],circumcenters[2*t+1]),e=e%3==2?e-2:e+1,triangles[e]!==i)break;e=halfedges[e]}while(e!==e0&&-1!==e);return points}_clip(i){if(0===i&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const points=this._cell(i);if(null===points)return null;const{vectors:V}=this,v=4*i;return V[v]||V[v+1]?this._clipInfinite(i,points,V[v],V[v+1],V[v+2],V[v+3]):this._clipFinite(i,points)}_clipFinite(i,points){const n=points.length;let x0,y0,c0,e0,e1,P=null,x1=points[n-2],y1=points[n-1],c1=this._regioncode(x1,y1);for(let j=0;j<n;j+=2)if(x0=x1,y0=y1,x1=points[j],y1=points[j+1],c0=c1,c1=this._regioncode(x1,y1),0===c0&&0===c1)e0=e1,e1=0,P?P.push(x1,y1):P=[x1,y1];else{let S,sx0,sy0,sx1,sy1;if(0===c0){if(null===(S=this._clipSegment(x0,y0,x1,y1,c0,c1)))continue;[sx0,sy0,sx1,sy1]=S}else{if(null===(S=this._clipSegment(x1,y1,x0,y0,c1,c0)))continue;[sx1,sy1,sx0,sy0]=S,e0=e1,e1=this._edgecode(sx0,sy0),e0&&e1&&this._edge(i,e0,e1,P,P.length),P?P.push(sx0,sy0):P=[sx0,sy0]}e0=e1,e1=this._edgecode(sx1,sy1),e0&&e1&&this._edge(i,e0,e1,P,P.length),P?P.push(sx1,sy1):P=[sx1,sy1]}if(P)e0=e1,e1=this._edgecode(P[0],P[1]),e0&&e1&&this._edge(i,e0,e1,P,P.length);else if(this.contains(i,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return P}_clipSegment(x0,y0,x1,y1,c0,c1){for(;;){if(0===c0&&0===c1)return[x0,y0,x1,y1];if(c0&c1)return null;let x,y,c=c0||c1;8&c?(x=x0+(x1-x0)*(this.ymax-y0)/(y1-y0),y=this.ymax):4&c?(x=x0+(x1-x0)*(this.ymin-y0)/(y1-y0),y=this.ymin):2&c?(y=y0+(y1-y0)*(this.xmax-x0)/(x1-x0),x=this.xmax):(y=y0+(y1-y0)*(this.xmin-x0)/(x1-x0),x=this.xmin),c0?(x0=x,y0=y,c0=this._regioncode(x0,y0)):(x1=x,y1=y,c1=this._regioncode(x1,y1))}}_clipInfinite(i,points,vx0,vy0,vxn,vyn){let p,P=Array.from(points);if((p=this._project(P[0],P[1],vx0,vy0))&&P.unshift(p[0],p[1]),(p=this._project(P[P.length-2],P[P.length-1],vxn,vyn))&&P.push(p[0],p[1]),P=this._clipFinite(i,P))for(let c0,j=0,n=P.length,c1=this._edgecode(P[n-2],P[n-1]);j<n;j+=2)c0=c1,c1=this._edgecode(P[j],P[j+1]),c0&&c1&&(j=this._edge(i,c0,c1,P,j),n=P.length);else this.contains(i,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(P=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return P}_edge(i,e0,e1,P,j){for(;e0!==e1;){let x,y;switch(e0){case 5:e0=4;continue;case 4:e0=6,x=this.xmax,y=this.ymin;break;case 6:e0=2;continue;case 2:e0=10,x=this.xmax,y=this.ymax;break;case 10:e0=8;continue;case 8:e0=9,x=this.xmin,y=this.ymax;break;case 9:e0=1;continue;case 1:e0=5,x=this.xmin,y=this.ymin}P[j]===x&&P[j+1]===y||!this.contains(i,x,y)||(P.splice(j,0,x,y),j+=2)}if(P.length>4)for(let i=0;i<P.length;i+=2){const j=(i+2)%P.length,k=(i+4)%P.length;(P[i]===P[j]&&P[j]===P[k]||P[i+1]===P[j+1]&&P[j+1]===P[k+1])&&(P.splice(j,2),i-=2)}return j}_project(x0,y0,vx,vy){let c,x,y,t=1/0;if(vy<0){if(y0<=this.ymin)return null;(c=(this.ymin-y0)/vy)<t&&(y=this.ymin,x=x0+(t=c)*vx)}else if(vy>0){if(y0>=this.ymax)return null;(c=(this.ymax-y0)/vy)<t&&(y=this.ymax,x=x0+(t=c)*vx)}if(vx>0){if(x0>=this.xmax)return null;(c=(this.xmax-x0)/vx)<t&&(x=this.xmax,y=y0+(t=c)*vy)}else if(vx<0){if(x0<=this.xmin)return null;(c=(this.xmin-x0)/vx)<t&&(x=this.xmin,y=y0+(t=c)*vy)}return[x,y]}_edgecode(x,y){return(x===this.xmin?1:x===this.xmax?2:0)|(y===this.ymin?4:y===this.ymax?8:0)}_regioncode(x,y){return(x<this.xmin?1:x>this.xmax?2:0)|(y<this.ymin?4:y>this.ymax?8:0)}}const tau=2*Math.PI,pow=Math.pow;function pointX(p){return p[0]}function pointY(p){return p[1]}function jitter(x,y,r){return[x+Math.sin(x+y)*r,y+Math.cos(x-y)*r]}class Delaunay{static from(points,fx=pointX,fy=pointY,that){return new Delaunay("length"in points?function(points,fx,fy,that){const n=points.length,array=new Float64Array(2*n);for(let i=0;i<n;++i){const p=points[i];array[2*i]=fx.call(that,p,i,points),array[2*i+1]=fy.call(that,p,i,points)}return array}(points,fx,fy,that):Float64Array.from(function*(points,fx,fy,that){let i=0;for(const p of points)yield fx.call(that,p,i,points),yield fy.call(that,p,i,points),++i}(points,fx,fy,that)))}constructor(points){this._delaunator=new Delaunator(points),this.inedges=new Int32Array(points.length/2),this._hullIndex=new Int32Array(points.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const d=this._delaunator,points=this.points;if(d.hull&&d.hull.length>2&&function(d){const{triangles:triangles,coords:coords}=d;for(let i=0;i<triangles.length;i+=3){const a=2*triangles[i],b=2*triangles[i+1],c=2*triangles[i+2];if((coords[c]-coords[a])*(coords[b+1]-coords[a+1])-(coords[b]-coords[a])*(coords[c+1]-coords[a+1])>1e-10)return!1}return!0}(d)){this.collinear=Int32Array.from({length:points.length/2},(_,i)=>i).sort((i,j)=>points[2*i]-points[2*j]||points[2*i+1]-points[2*j+1]);const e=this.collinear[0],f=this.collinear[this.collinear.length-1],bounds=[points[2*e],points[2*e+1],points[2*f],points[2*f+1]],r=1e-8*Math.hypot(bounds[3]-bounds[1],bounds[2]-bounds[0]);for(let i=0,n=points.length/2;i<n;++i){const p=jitter(points[2*i],points[2*i+1],r);points[2*i]=p[0],points[2*i+1]=p[1]}this._delaunator=new Delaunator(points)}else delete this.collinear;const halfedges=this.halfedges=this._delaunator.halfedges,hull=this.hull=this._delaunator.hull,triangles=this.triangles=this._delaunator.triangles,inedges=this.inedges.fill(-1),hullIndex=this._hullIndex.fill(-1);for(let e=0,n=halfedges.length;e<n;++e){const p=triangles[e%3==2?e-2:e+1];-1!==halfedges[e]&&-1!==inedges[p]||(inedges[p]=e)}for(let i=0,n=hull.length;i<n;++i)hullIndex[hull[i]]=i;hull.length<=2&&hull.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=hull[0],this.triangles[1]=hull[1],this.triangles[2]=hull[1],inedges[hull[0]]=1,2===hull.length&&(inedges[hull[1]]=0))}voronoi(bounds){return new Voronoi(this,bounds)}*neighbors(i){const{inedges:inedges,hull:hull,_hullIndex:_hullIndex,halfedges:halfedges,triangles:triangles,collinear:collinear}=this;if(collinear){const l=collinear.indexOf(i);return l>0&&(yield collinear[l-1]),void(l<collinear.length-1&&(yield collinear[l+1]))}const e0=inedges[i];if(-1===e0)return;let e=e0,p0=-1;do{if(yield p0=triangles[e],e=e%3==2?e-2:e+1,triangles[e]!==i)return;if(e=halfedges[e],-1===e){const p=hull[(_hullIndex[i]+1)%hull.length];return void(p!==p0&&(yield p))}}while(e!==e0)}find(x,y,i=0){if((x=+x)!=x||(y=+y)!=y)return-1;const i0=i;let c;for(;(c=this._step(i,x,y))>=0&&c!==i&&c!==i0;)i=c;return c}_step(i,x,y){const{inedges:inedges,hull:hull,_hullIndex:_hullIndex,halfedges:halfedges,triangles:triangles,points:points}=this;if(-1===inedges[i]||!points.length)return(i+1)%(points.length>>1);let c=i,dc=pow(x-points[2*i],2)+pow(y-points[2*i+1],2);const e0=inedges[i];let e=e0;do{let t=triangles[e];const dt=pow(x-points[2*t],2)+pow(y-points[2*t+1],2);if(dt<dc&&(dc=dt,c=t),e=e%3==2?e-2:e+1,triangles[e]!==i)break;if(e=halfedges[e],-1===e){if(e=hull[(_hullIndex[i]+1)%hull.length],e!==t&&pow(x-points[2*e],2)+pow(y-points[2*e+1],2)<dc)return e;break}}while(e!==e0);return c}render(context){const buffer=null==context?context=new Path:void 0,{points:points,halfedges:halfedges,triangles:triangles}=this;for(let i=0,n=halfedges.length;i<n;++i){const j=halfedges[i];if(j<i)continue;const ti=2*triangles[i],tj=2*triangles[j];context.moveTo(points[ti],points[ti+1]),context.lineTo(points[tj],points[tj+1])}return this.renderHull(context),buffer&&buffer.value()}renderPoints(context,r=2){const buffer=null==context?context=new Path:void 0,{points:points}=this;for(let i=0,n=points.length;i<n;i+=2){const x=points[i],y=points[i+1];context.moveTo(x+r,y),context.arc(x,y,r,0,tau)}return buffer&&buffer.value()}renderHull(context){const buffer=null==context?context=new Path:void 0,{hull:hull,points:points}=this,h=2*hull[0],n=hull.length;context.moveTo(points[h],points[h+1]);for(let i=1;i<n;++i){const h=2*hull[i];context.lineTo(points[h],points[h+1])}return context.closePath(),buffer&&buffer.value()}hullPolygon(){const polygon=new Polygon;return this.renderHull(polygon),polygon.value()}renderTriangle(i,context){const buffer=null==context?context=new Path:void 0,{points:points,triangles:triangles}=this,t0=2*triangles[i*=3],t1=2*triangles[i+1],t2=2*triangles[i+2];return context.moveTo(points[t0],points[t0+1]),context.lineTo(points[t1],points[t1+1]),context.lineTo(points[t2],points[t2+1]),context.closePath(),buffer&&buffer.value()}*trianglePolygons(){const{triangles:triangles}=this;for(let i=0,n=triangles.length/3;i<n;++i)yield this.trianglePolygon(i)}trianglePolygon(i){const polygon=new Polygon;return this.renderTriangle(i,polygon),polygon.value()}}exports.Delaunay=Delaunay,exports.Voronoi=Voronoi,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaCanvas,vegaDataflow,vegaUtil,vegaScale,vegaStatistics){"use strict";var cloudRadians=Math.PI/180;function cloud(){var text,font,fontSize,fontStyle,fontWeight,rotate,padding,size=[256,256],spiral=archimedeanSpiral,words=[],random=Math.random,cloud={};function place(board,tag,bounds){for(var dxdy,dx,dy,a,b,startX=tag.x,startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=random()<.5?1:-1,t=-dt;(dxdy=s(t+=dt))&&(dx=~~dxdy[0],dy=~~dxdy[1],!(Math.min(Math.abs(dx),Math.abs(dy))>=maxDelta));)if(tag.x=startX+dx,tag.y=startY+dy,!(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1]||bounds&&cloudCollide(tag,board,size[0])||bounds&&(b=bounds,!((a=tag).x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y)))){for(var last,sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=127&lx,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),j=0;j<h;j++){last=0;for(var i=0;i<=w;i++)board[x+i]|=last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0);x+=sw}return tag.sprite=null,!0}return!1}return cloud.layout=function(){for(var contextAndRatio=function(canvas){canvas.width=canvas.height=1;var ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2);canvas.width=2048/ratio,canvas.height=2048/ratio;var context=canvas.getContext("2d");return context.fillStyle=context.strokeStyle="red",context.textAlign="center",{context:context,ratio:ratio}}(vegaCanvas.canvas()),board=function(n){for(var a=[],i=-1;++i<n;)a[i]=0;return a}((size[0]>>5)*size[1]),bounds=null,n=words.length,i=-1,tags=[],data=words.map(d=>({text:text(d),font:font(d),style:fontStyle(d),weight:fontWeight(d),rotate:rotate(d),size:~~(fontSize(d)+1e-14),padding:padding(d),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:d})).sort((a,b)=>b.size-a.size);++i<n;){var d=data[i];d.x=size[0]*(random()+.5)>>1,d.y=size[1]*(random()+.5)>>1,cloudSprite(contextAndRatio,d,data,i),d.hasText&&place(board,d,bounds)&&(tags.push(d),bounds?cloudBounds(bounds,d):bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}],d.x-=size[0]>>1,d.y-=size[1]>>1)}return tags},cloud.words=function(_){return arguments.length?(words=_,cloud):words},cloud.size=function(_){return arguments.length?(size=[+_[0],+_[1]],cloud):size},cloud.font=function(_){return arguments.length?(font=functor(_),cloud):font},cloud.fontStyle=function(_){return arguments.length?(fontStyle=functor(_),cloud):fontStyle},cloud.fontWeight=function(_){return arguments.length?(fontWeight=functor(_),cloud):fontWeight},cloud.rotate=function(_){return arguments.length?(rotate=functor(_),cloud):rotate},cloud.text=function(_){return arguments.length?(text=functor(_),cloud):text},cloud.spiral=function(_){return arguments.length?(spiral=spirals[_]||_,cloud):spiral},cloud.fontSize=function(_){return arguments.length?(fontSize=functor(_),cloud):fontSize},cloud.padding=function(_){return arguments.length?(padding=functor(_),cloud):padding},cloud.random=function(_){return arguments.length?(random=_,cloud):random},cloud}function cloudSprite(contextAndRatio,d,data,di){if(!d.sprite){var c=contextAndRatio.context,ratio=contextAndRatio.ratio;c.clearRect(0,0,2048/ratio,2048/ratio);var w,w32,h,i,j,x=0,y=0,maxh=0,n=data.length;for(--di;++di<n;){if(d=data[di],c.save(),c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font,w=c.measureText(d.text+"m").width*ratio,h=d.size<<1,d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+31>>5<<5,h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr))}else w=w+31>>5<<5;if(h>maxh&&(maxh=h),x+w>=2048&&(x=0,y+=maxh,maxh=0),y+h>=2048)break;c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio),d.rotate&&c.rotate(d.rotate*cloudRadians),c.fillText(d.text,0,0),d.padding&&(c.lineWidth=2*d.padding,c.strokeText(d.text,0,0)),c.restore(),d.width=w,d.height=h,d.xoff=x,d.yoff=y,d.x1=w>>1,d.y1=h>>1,d.x0=-d.x1,d.y0=-d.y1,d.hasText=!0,x+=w}for(var pixels=c.getImageData(0,0,2048/ratio,2048/ratio).data,sprite=[];--di>=0;)if((d=data[di]).hasText){for(w32=(w=d.width)>>5,h=d.y1-d.y0,i=0;i<h*w32;i++)sprite[i]=0;if(null==(x=d.xoff))return;y=d.yoff;var seen=0,seenRow=-1;for(j=0;j<h;j++){for(i=0;i<w;i++){var k=w32*j+(i>>5),m=pixels[2048*(y+j)+(x+i)<<2]?1<<31-i%32:0;sprite[k]|=m,seen|=m}seen?seenRow=j:(d.y0++,h--,j--,y++)}d.y1=d.y0+seenRow,d.sprite=sprite.slice(0,(d.y1-d.y0)*w32)}}}function cloudCollide(tag,board,sw){sw>>=5;for(var last,sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=127&lx,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),j=0;j<h;j++){last=0;for(var i=0;i<=w;i++)if((last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0))&board[x+i])return!0;x+=sw}return!1}function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];d.x+d.x0<b0.x&&(b0.x=d.x+d.x0),d.y+d.y0<b0.y&&(b0.y=d.y+d.y0),d.x+d.x1>b1.x&&(b1.x=d.x+d.x1),d.y+d.y1>b1.y&&(b1.y=d.y+d.y1)}function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function functor(d){return"function"==typeof d?d:function(){return d}}var spirals={archimedean:archimedeanSpiral,rectangular:function(size){var dx=4*size[0]/size[1],x=0,y=0;return function(t){var sign=t<0?-1:1;switch(Math.sqrt(1+4*sign*t)-sign&3){case 0:x+=dx;break;case 1:y+=4;break;case 2:x-=dx;break;default:y-=4}return[x,y]}}};const Output=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Params=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Wordcloud(params){vegaDataflow.Transform.call(this,cloud(),params)}Wordcloud.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Output}]},vegaUtil.inherits(Wordcloud,vegaDataflow.Transform,{transform(_,pulse){!_.size||_.size[0]&&_.size[1]||vegaUtil.error("Wordcloud size dimensions must be non-zero.");const mod=_.modified();if(!(mod||pulse.changed(pulse.ADD_REM)||Params.some((function(param){const p=_[param];return vegaUtil.isFunction(p)&&pulse.modified(p.fields)}))))return;const data=pulse.materialize(pulse.SOURCE).source,layout=this.value,as=_.as||Output;let range,fontSize=_.fontSize||14;if(vegaUtil.isFunction(fontSize)?range=_.fontSizeRange:fontSize=vegaUtil.constant(fontSize),range){const fsize=fontSize,sizeScale=vegaScale.scale("sqrt")().domain(vegaUtil.extent(data,fsize)).range(range);fontSize=x=>sizeScale(fsize(x))}data.forEach(t=>{t[as[0]]=NaN,t[as[1]]=NaN,t[as[3]]=0});const words=layout.words(data).text(_.text).size(_.size||[500,500]).padding(_.padding||1).spiral(_.spiral||"archimedean").rotate(_.rotate||0).font(_.font||"sans-serif").fontStyle(_.fontStyle||"normal").fontWeight(_.fontWeight||"normal").fontSize(fontSize).random(vegaStatistics.random).layout(),size=layout.size(),dx=size[0]>>1,dy=size[1]>>1,n=words.length;for(let w,t,i=0;i<n;++i)w=words[i],t=w.datum,t[as[0]]=w.x+dx,t[as[1]]=w.y+dy,t[as[2]]=w.font,t[as[3]]=w.size,t[as[4]]=w.style,t[as[5]]=w.weight,t[as[6]]=w.rotate;return pulse.reflow(mod).modifies(as)}}),exports.wordcloud=Wordcloud,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(58),__webpack_require__(40),__webpack_require__(37),__webpack_require__(45),__webpack_require__(44))},function(module,exports,__webpack_require__){!function(exports,d3Array,vegaDataflow,vegaUtil){"use strict";const array8=n=>new Uint8Array(n),array16=n=>new Uint16Array(n),array32=n=>new Uint32Array(n);function array(n,m,array){const copy=(m<257?array8:m<65537?array16:array32)(n);return array&&copy.set(array),copy}function Dimension(index,i,query){const bit=1<<i;return{one:bit,zero:~bit,range:query.slice(),bisect:index.bisect,index:index.index,size:index.size,onAdd(added,curr){const range=this.bisect(this.range,added.value),idx=added.index,lo=range[0],hi=range[1],n1=idx.length;let i;for(i=0;i<lo;++i)curr[idx[i]]|=bit;for(i=hi;i<n1;++i)curr[idx[i]]|=bit;return this}}}function SortedIndex(){let index=array32(0),value=[],size=0;return{insert:function(key,data,base){if(!data.length)return[];const n0=size,n1=data.length,addi=array32(n1);let oldv,oldi,i,addv=Array(n1);for(i=0;i<n1;++i)addv[i]=key(data[i]),addi[i]=i;if(addv=function(values,index){return values.sort.call(index,(a,b)=>{const x=values[a],y=values[b];return x<y?-1:x>y?1:0}),d3Array.permute(values,index)}(addv,addi),n0)oldv=value,oldi=index,value=Array(n0+n1),index=array32(n0+n1),function(base,value0,index0,n0,value1,index1,n1,value,index){let i,i0=0,i1=0;for(i=0;i0<n0&&i1<n1;++i)value0[i0]<value1[i1]?(value[i]=value0[i0],index[i]=index0[i0++]):(value[i]=value1[i1],index[i]=index1[i1++]+base);for(;i0<n0;++i0,++i)value[i]=value0[i0],index[i]=index0[i0];for(;i1<n1;++i1,++i)value[i]=value1[i1],index[i]=index1[i1]+base}(base,oldv,oldi,n0,addv,addi,n1,value,index);else{if(base>0)for(i=0;i<n1;++i)addi[i]+=base;value=addv,index=addi}return size=n0+n1,{index:addi,value:addv}},remove:function(num,map){const n=size;let idx,i,j;for(i=0;!map[index[i]]&&i<n;++i);for(j=i;i<n;++i)map[idx=index[i]]||(index[j]=idx,value[j]=value[i],++j);size=n-num},bisect:function(range,array){let n;return array?n=array.length:(array=value,n=size),[d3Array.bisectLeft(array,range[0],0,n),d3Array.bisectRight(array,range[1],0,n)]},reindex:function(map){for(let i=0,n=size;i<n;++i)index[i]=map[index[i]]},index:()=>index,size:()=>size}}function CrossFilter(params){vegaDataflow.Transform.call(this,function(){let width=8,data=[],seen=array32(0),curr=array(0,width),prev=array(0,width);return{data:()=>data,seen:()=>seen=function(array,length,copy){return array.length>=length?array:((copy=copy||new array.constructor(length)).set(array),copy)}(seen,data.length),add(array){for(let t,i=0,j=data.length,n=array.length;i<n;++i)t=array[i],t._index=j++,data.push(t)},remove(num,map){const n=data.length,copy=Array(n-num),reindex=data;let t,i,j;for(i=0;!map[i]&&i<n;++i)copy[i]=data[i],reindex[i]=i;for(j=i;i<n;++i)t=data[i],map[i]?reindex[i]=-1:(reindex[i]=j,curr[j]=curr[i],prev[j]=prev[i],copy[j]=t,t._index=j++),curr[i]=0;return data=copy,reindex},size:()=>data.length,curr:()=>curr,prev:()=>prev,reset:k=>prev[k]=curr[k],all:()=>width<257?255:width<65537?65535:4294967295,set(k,one){curr[k]|=one},clear(k,one){curr[k]&=~one},resize(n,m){(n>curr.length||m>width)&&(width=Math.max(m,width),curr=array(n,width,curr),prev=array(n,width))}}}(),params),this._indices=null,this._dims=null}function ResolveFilter(params){vegaDataflow.Transform.call(this,null,params)}CrossFilter.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},vegaUtil.inherits(CrossFilter,vegaDataflow.Transform,{transform(_,pulse){return this._dims?_.modified("fields")||_.fields.some(f=>pulse.modified(f.fields))?this.reinit(_,pulse):this.eval(_,pulse):this.init(_,pulse)},init(_,pulse){const fields=_.fields,query=_.query,indices=this._indices={},dims=this._dims=[],m=query.length;let key,index,i=0;for(;i<m;++i)key=fields[i].fname,index=indices[key]||(indices[key]=SortedIndex()),dims.push(Dimension(index,i,query[i]));return this.eval(_,pulse)},reinit(_,pulse){const output=pulse.materialize().fork(),fields=_.fields,query=_.query,indices=this._indices,dims=this._dims,bits=this.value,curr=bits.curr(),prev=bits.prev(),all=bits.all(),out=output.rem=output.add,mod=output.mod,m=query.length,adds={};let add,index,key,mods,remMap,modMap,i,n,f;if(prev.set(curr),pulse.rem.length&&(remMap=this.remove(_,pulse,output)),pulse.add.length&&bits.add(pulse.add),pulse.mod.length)for(modMap={},mods=pulse.mod,i=0,n=mods.length;i<n;++i)modMap[mods[i]._index]=1;for(i=0;i<m;++i)f=fields[i],(!dims[i]||_.modified("fields",i)||pulse.modified(f.fields))&&(key=f.fname,(add=adds[key])||(indices[key]=index=SortedIndex(),adds[key]=add=index.insert(f,pulse.source,0)),dims[i]=Dimension(index,i,query[i]).onAdd(add,curr));for(i=0,n=bits.data().length;i<n;++i)remMap[i]||(prev[i]!==curr[i]?out.push(i):modMap[i]&&curr[i]!==all&&mod.push(i));return bits.mask=(1<<m)-1,output},eval(_,pulse){const output=pulse.materialize().fork(),m=this._dims.length;let mask=0;return pulse.rem.length&&(this.remove(_,pulse,output),mask|=(1<<m)-1),_.modified("query")&&!_.modified("fields")&&(mask|=this.update(_,pulse,output)),pulse.add.length&&(this.insert(_,pulse,output),mask|=(1<<m)-1),pulse.mod.length&&(this.modify(pulse,output),mask|=(1<<m)-1),this.value.mask=mask,output},insert(_,pulse,output){const tuples=pulse.add,bits=this.value,dims=this._dims,indices=this._indices,fields=_.fields,adds={},out=output.add,n=bits.size()+tuples.length,m=dims.length;let j,key,add,k=bits.size();bits.resize(n,m),bits.add(tuples);const curr=bits.curr(),prev=bits.prev(),all=bits.all();for(j=0;j<m;++j)key=fields[j].fname,add=adds[key]||(adds[key]=indices[key].insert(fields[j],tuples,k)),dims[j].onAdd(add,curr);for(;k<n;++k)prev[k]=all,curr[k]!==all&&out.push(k)},modify(pulse,output){const out=output.mod,bits=this.value,curr=bits.curr(),all=bits.all(),tuples=pulse.mod;let i,n,k;for(i=0,n=tuples.length;i<n;++i)k=tuples[i]._index,curr[k]!==all&&out.push(k)},remove(_,pulse,output){const indices=this._indices,bits=this.value,curr=bits.curr(),prev=bits.prev(),all=bits.all(),map={},out=output.rem,tuples=pulse.rem;let i,n,k,f;for(i=0,n=tuples.length;i<n;++i)k=tuples[i]._index,map[k]=1,prev[k]=f=curr[k],curr[k]=all,f!==all&&out.push(k);for(k in indices)indices[k].remove(n,map);return this.reindex(pulse,n,map),map},reindex(pulse,num,map){const indices=this._indices,bits=this.value;pulse.runAfter(()=>{const indexMap=bits.remove(num,map);for(const key in indices)indices[key].reindex(indexMap)})},update(_,pulse,output){const dims=this._dims,query=_.query,stamp=pulse.stamp,m=dims.length;let i,q,mask=0;for(output.filters=0,q=0;q<m;++q)_.modified("query",q)&&(i=q,++mask);if(1===mask)mask=dims[i].one,this.incrementOne(dims[i],query[i],output.add,output.rem);else for(q=0,mask=0;q<m;++q)_.modified("query",q)&&(mask|=dims[q].one,this.incrementAll(dims[q],query[q],stamp,output.add),output.rem=output.add);return mask},incrementAll(dim,query,stamp,out){const bits=this.value,seen=bits.seen(),curr=bits.curr(),prev=bits.prev(),index=dim.index(),old=dim.bisect(dim.range),range=dim.bisect(query),lo1=range[0],hi1=range[1],lo0=old[0],hi0=old[1],one=dim.one;let i,j,k;if(lo1<lo0)for(i=lo1,j=Math.min(lo0,hi1);i<j;++i)k=index[i],seen[k]!==stamp&&(prev[k]=curr[k],seen[k]=stamp,out.push(k)),curr[k]^=one;else if(lo1>lo0)for(i=lo0,j=Math.min(lo1,hi0);i<j;++i)k=index[i],seen[k]!==stamp&&(prev[k]=curr[k],seen[k]=stamp,out.push(k)),curr[k]^=one;if(hi1>hi0)for(i=Math.max(lo1,hi0),j=hi1;i<j;++i)k=index[i],seen[k]!==stamp&&(prev[k]=curr[k],seen[k]=stamp,out.push(k)),curr[k]^=one;else if(hi1<hi0)for(i=Math.max(lo0,hi1),j=hi0;i<j;++i)k=index[i],seen[k]!==stamp&&(prev[k]=curr[k],seen[k]=stamp,out.push(k)),curr[k]^=one;dim.range=query.slice()},incrementOne(dim,query,add,rem){const curr=this.value.curr(),index=dim.index(),old=dim.bisect(dim.range),range=dim.bisect(query),lo1=range[0],hi1=range[1],lo0=old[0],hi0=old[1],one=dim.one;let i,j,k;if(lo1<lo0)for(i=lo1,j=Math.min(lo0,hi1);i<j;++i)k=index[i],curr[k]^=one,add.push(k);else if(lo1>lo0)for(i=lo0,j=Math.min(lo1,hi0);i<j;++i)k=index[i],curr[k]^=one,rem.push(k);if(hi1>hi0)for(i=Math.max(lo1,hi0),j=hi1;i<j;++i)k=index[i],curr[k]^=one,add.push(k);else if(hi1<hi0)for(i=Math.max(lo0,hi1),j=hi0;i<j;++i)k=index[i],curr[k]^=one,rem.push(k);dim.range=query.slice()}}),ResolveFilter.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},vegaUtil.inherits(ResolveFilter,vegaDataflow.Transform,{transform(_,pulse){const ignore=~(_.ignore||0),bitmap=_.filter,mask=bitmap.mask;if(0==(mask&ignore))return pulse.StopPropagation;const output=pulse.fork(pulse.ALL),data=bitmap.data(),curr=bitmap.curr(),prev=bitmap.prev(),pass=k=>curr[k]&ignore?null:data[k];return output.filter(output.MOD,pass),mask&mask-1?(output.filter(output.ADD,k=>{const c=curr[k]&ignore;return!c&&c^prev[k]&ignore?data[k]:null}),output.filter(output.REM,k=>{const c=curr[k]&ignore;return!c||c^c^prev[k]&ignore?null:data[k]})):(output.filter(output.ADD,pass),output.filter(output.REM,k=>(curr[k]&ignore)===mask?data[k]:null)),output.filter(output.SOURCE,t=>pass(t._index))}}),exports.crossfilter=CrossFilter,exports.resolvefilter=ResolveFilter,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(126),__webpack_require__(40),__webpack_require__(37))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaDataflow,vegaScenegraph,d3Array,vegaFunctions,vegaRuntime,d3Timer,vegaFormat){"use strict";function ariaLabel(el,desc){el&&(null==desc?el.removeAttribute("aria-label"):el.setAttribute("aria-label",desc))}function setCursor(view,cursor){const el=view.globalCursor()?"undefined"!=typeof document&&document.body:view.container();if(el)return null==cursor?el.style.removeProperty("cursor"):el.style.cursor=cursor}function dataref(view,name){var data=view._runtime.data;return vegaUtil.hasOwnProperty(data,name)||vegaUtil.error("Unrecognized data set: "+name),data[name]}function change(name,changes){vegaDataflow.isChangeSet(changes)||vegaUtil.error("Second argument to changes must be a changeset.");const dataset=dataref(this,name);return dataset.modified=!0,this.pulse(dataset.input,changes)}function width(view){var padding=view.padding();return Math.max(0,view._viewWidth+padding.left+padding.right)}function height(view){var padding=view.padding();return Math.max(0,view._viewHeight+padding.top+padding.bottom)}function offset(view){var padding=view.padding(),origin=view._origin;return[padding.left+origin[0],padding.top+origin[1]]}function eventExtend(view,event,item){var p,e,translate,r=view._renderer,el=r&&r.canvas();return el&&(translate=offset(view),e=event.changedTouches?event.changedTouches[0]:event,(p=vegaScenegraph.point(e,el))[0]-=translate[0],p[1]-=translate[1]),event.dataflow=view,event.item=item,event.vega=function(view,item,point){const itemGroup=item?"group"===item.mark.marktype?item:item.mark.group:null;function group(name){var i,g=itemGroup;if(name)for(i=item;i;i=i.mark.group)if(i.mark.name===name){g=i;break}return g&&g.mark&&g.mark.interactive?g:{}}function xy(item){if(!item)return point;vegaUtil.isString(item)&&(item=group(item));const p=point.slice();for(;item;)p[0]-=item.x||0,p[1]-=item.y||0,item=item.mark&&item.mark.group;return p}return{view:vegaUtil.constant(view),item:vegaUtil.constant(item||{}),group:group,xy:xy,x:item=>xy(item)[0],y:item=>xy(item)[1]}}(view,item,p),event}const NO_TRAP={trap:!1};function permit(view,key,type){const rule=view._eventConfig&&view._eventConfig[key];return!(!1===rule||vegaUtil.isObject(rule)&&!rule[type])||(view.warn(`Blocked ${key} ${type} event listener.`),!1)}function itemFilter(event){return event.item}function markTarget(event){return event.item.mark.source}function invoke(name){return function(_,event){return event.vega.view().changeset().encode(event.item,name)}}function element(tag,attr,text){const el=document.createElement(tag);for(const key in attr)el.setAttribute(key,attr[key]);return null!=text&&(el.textContent=text),el}function bind(view,el,binding){if(!el)return;const param=binding.param;let bind=binding.state;return bind||(bind=binding.state={elements:null,active:!1,set:null,update:value=>{value!==view.signal(param.signal)&&view.runAsync(null,()=>{bind.source=!0,view.signal(param.signal,value)})}},param.debounce&&(bind.update=vegaUtil.debounce(param.debounce,bind.update))),function(bind,el,param,value){const div=element("div",{class:"vega-bind"}),wrapper="radio"===param.input?div:div.appendChild(element("label"));wrapper.appendChild(element("span",{class:"vega-bind-name"},param.name||param.signal)),el.appendChild(div);let input=form;switch(param.input){case"checkbox":input=checkbox;break;case"select":input=select;break;case"radio":input=radio;break;case"range":input=range}input(bind,wrapper,param,value)}(bind,el,param,view.signal(param.signal)),bind.active||(view.on(view._signals[param.signal],null,()=>{bind.source?bind.source=!1:bind.set(view.signal(param.signal))}),bind.active=!0),bind}function form(bind,el,param,value){const node=element("input");for(const key in param)"signal"!==key&&"element"!==key&&node.setAttribute("input"===key?"type":key,param[key]);node.setAttribute("name",param.signal),node.value=value,el.appendChild(node),node.addEventListener("input",()=>bind.update(node.value)),bind.elements=[node],bind.set=value=>node.value=value}function checkbox(bind,el,param,value){const attr={type:"checkbox",name:param.signal};value&&(attr.checked=!0);const node=element("input",attr);el.appendChild(node),node.addEventListener("change",()=>bind.update(node.checked)),bind.elements=[node],bind.set=value=>node.checked=!!value||null}function select(bind,el,param,value){const node=element("select",{name:param.signal}),labels=param.labels||[];param.options.forEach((option,i)=>{const attr={value:option};valuesEqual(option,value)&&(attr.selected=!0),node.appendChild(element("option",attr,(labels[i]||option)+""))}),el.appendChild(node),node.addEventListener("change",()=>{bind.update(param.options[node.selectedIndex])}),bind.elements=[node],bind.set=value=>{for(let i=0,n=param.options.length;i<n;++i)if(valuesEqual(param.options[i],value))return void(node.selectedIndex=i)}}function radio(bind,el,param,value){const group=element("span",{class:"vega-bind-radio"}),labels=param.labels||[];el.appendChild(group),bind.elements=param.options.map((option,i)=>{const attr={type:"radio",name:param.signal,value:option};valuesEqual(option,value)&&(attr.checked=!0);const input=element("input",attr);input.addEventListener("change",()=>bind.update(option));const label=element("label",{},(labels[i]||option)+"");return label.prepend(input),group.appendChild(label),input}),bind.set=value=>{const nodes=bind.elements,n=nodes.length;for(let i=0;i<n;++i)valuesEqual(nodes[i].value,value)&&(nodes[i].checked=!0)}}function range(bind,el,param,value){value=void 0!==value?value:(+param.max+ +param.min)/2;const max=null!=param.max?param.max:Math.max(100,+value)||100,min=param.min||Math.min(0,max,+value)||0,step=param.step||d3Array.tickStep(min,max,100),node=element("input",{type:"range",name:param.signal,min:min,max:max,step:step});node.value=value;const span=element("span",{},+value);el.appendChild(node),el.appendChild(span);const update=()=>{span.textContent=node.value,bind.update(+node.value)};node.addEventListener("input",update),node.addEventListener("change",update),bind.elements=[node],bind.set=value=>{node.value=value,span.textContent=value}}function valuesEqual(a,b){return a===b||a+""==b+""}function initializeRenderer(view,r,el,constructor,scaleFactor,opt){return(r=r||new constructor(view.loader())).initialize(el,width(view),height(view),offset(view),scaleFactor,opt).background(view.background())}function trap(view,fn){return fn?function(){try{fn.apply(this,arguments)}catch(error){view.error(error)}}:null}function lookup(view,el){if("string"==typeof el){if("undefined"==typeof document)return view.error("DOM document instance not found."),null;if(!(el=document.querySelector(el)))return view.error("Signal bind element not found: "+el),null}if(el)try{el.innerHTML=""}catch(e){el=null,view.error(e)}return el}const number=_=>+_||0;function padding(_){return vegaUtil.isObject(_)?{top:number(_.top),bottom:number(_.bottom),left:number(_.left),right:number(_.right)}:(_=>({top:_,bottom:_,left:_,right:_}))(number(_))}async function renderHeadless(view,type,scaleFactor,opt){const module=vegaScenegraph.renderModule(type),ctr=module&&module.headless;return ctr||vegaUtil.error("Unrecognized renderer type: "+type),await view.runAsync(),initializeRenderer(view,null,null,ctr,scaleFactor,opt).renderAsync(view._scenegraph.root)}var Skip={skip:!0};function viewWidth(view,width){var a=view.autosize(),p=view.padding();return width-(a&&"padding"===a.contains?p.left+p.right:0)}function viewHeight(view,height){var a=view.autosize(),p=view.padding();return height-(a&&"padding"===a.contains?p.top+p.bottom:0)}function dataTest(name,data){return data.modified&&vegaUtil.isArray(data.input.value)&&name.indexOf("_:vega:_")}function signalTest(name,op){return!("parent"===name||op instanceof vegaDataflow.transforms.proxy)}function defaultTooltip(handler,event,item,value){const el=handler.element();el&&el.setAttribute("title",function(value){return null==value?"":vegaUtil.isArray(value)?formatArray(value):vegaUtil.isObject(value)&&!vegaUtil.isDate(value)?(obj=value,Object.keys(obj).map(key=>{const v=obj[key];return key+": "+(vegaUtil.isArray(v)?formatArray(v):formatValue(v))}).join("\n")):value+"";var obj}(value))}function formatArray(value){return"["+value.map(formatValue).join(", ")+"]"}function formatValue(value){return vegaUtil.isArray(value)?"[â€¦]":vegaUtil.isObject(value)&&!vegaUtil.isDate(value)?"{â€¦}":value}function View(spec,options){const view=this;if(options=options||{},vegaDataflow.Dataflow.call(view),options.loader&&view.loader(options.loader),options.logger&&view.logger(options.logger),null!=options.logLevel&&view.logLevel(options.logLevel),options.locale||spec.locale){const loc=vegaUtil.extend({},spec.locale,options.locale);view.locale(vegaFormat.locale(loc.number,loc.time))}view._el=null,view._elBind=null,view._renderType=options.renderer||vegaScenegraph.RenderType.Canvas,view._scenegraph=new vegaScenegraph.Scenegraph;const root=view._scenegraph.root;view._renderer=null,view._tooltip=options.tooltip||defaultTooltip,view._redraw=!0,view._handler=(new vegaScenegraph.CanvasHandler).scene(root),view._globalCursor=!1,view._preventDefault=!1,view._timers=[],view._eventListeners=[],view._resizeListeners=[],view._eventConfig=function(config){const events=vegaUtil.extend({defaults:{}},config),unpack=(obj,keys)=>{keys.forEach(k=>{vegaUtil.isArray(obj[k])&&(obj[k]=vegaUtil.toSet(obj[k]))})};return unpack(events.defaults,["prevent","allow"]),unpack(events,["view","window","selector"]),events}(spec.eventConfig),view.globalCursor(view._eventConfig.globalCursor);const ctx=function(view,spec,expr){return vegaRuntime.context(view,vegaDataflow.transforms,vegaFunctions.functionContext,expr).parse(spec)}(view,spec,options.expr);view._runtime=ctx,view._signals=ctx.signals,view._bind=(spec.bindings||[]).map(_=>({state:null,param:vegaUtil.extend({},_)})),ctx.root&&ctx.root.set(root),root.source=ctx.data.root.input,view.pulse(ctx.data.root.input,view.changeset().insert(root.items)),view._width=view.width(),view._height=view.height(),view._viewWidth=viewWidth(view,view._width),view._viewHeight=viewHeight(view,view._height),view._origin=[0,0],view._resize=0,view._autosize=1,function(view){var s=view._signals,w=s.width,h=s.height,p=s.padding;function resetSize(){view._autosize=view._resize=1}view._resizeWidth=view.add(null,_=>{view._width=_.size,view._viewWidth=viewWidth(view,_.size),resetSize()},{size:w}),view._resizeHeight=view.add(null,_=>{view._height=_.size,view._viewHeight=viewHeight(view,_.size),resetSize()},{size:h});const resizePadding=view.add(null,resetSize,{pad:p});view._resizeWidth.rank=w.rank+1,view._resizeHeight.rank=h.rank+1,resizePadding.rank=p.rank+1}(view),function(view){view.add(null,_=>(view._background=_.bg,view._resize=1,_.bg),{bg:view._signals.background})}(view),function(view){const cursor=view._signals.cursor||(view._signals.cursor=view.add({user:"default",item:null}));view.on(view.events("view","mousemove"),cursor,(_,event)=>{const value=cursor.value,user=value?vegaUtil.isString(value)?value:value.user:"default",item=event.item&&event.item.cursor||null;return value&&user===value.user&&item==value.item?value:{user:user,item:item}}),view.add(null,(function(_){let user=_.cursor,item=this.value;return vegaUtil.isString(user)||(item=user.item,user=user.user),setCursor(view,user&&"default"!==user?user:item||user),item}),{cursor:cursor})}(view),view.description(spec.description),options.hover&&view.hover(),options.container&&view.initialize(options.container,options.bind)}function lookupSignal(view,name){return vegaUtil.hasOwnProperty(view._signals,name)?view._signals[name]:vegaUtil.error("Unrecognized signal name: "+vegaUtil.stringValue(name))}function findOperatorHandler(op,handler){const h=(op._targets||[]).filter(op=>op._update&&op._update.handler===handler);return h.length?h[0]:null}function addOperatorListener(view,name,op,handler){let h=findOperatorHandler(op,handler);return h||(h=trap(view,()=>handler(name,op.value)),h.handler=handler,view.on(op,null,h)),view}function removeOperatorListener(view,op,handler){const h=findOperatorHandler(op,handler);return h&&op._targets.remove(h),view}vegaUtil.inherits(View,vegaDataflow.Dataflow,{async evaluate(encode,prerun,postrun){if(await vegaDataflow.Dataflow.prototype.evaluate.call(this,encode,prerun),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,origin=offset(view=this),w=width(view),h=height(view),view._renderer.background(view.background()),view._renderer.resize(w,h,origin),view._handler.origin(origin),view._resizeListeners.forEach(handler=>{try{handler(w,h)}catch(error){view.error(error)}})),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}var view,origin,w,h;return postrun&&vegaDataflow.asyncCallback(this,postrun),this},dirty(item){this._redraw=!0,this._renderer&&this._renderer.dirty(item)},description(text){if(arguments.length){const desc=null!=text?text+"":null;return desc!==this._desc&&ariaLabel(this._el,this._desc=desc),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(name,value,options){const op=lookupSignal(this,name);return 1===arguments.length?op.value:this.update(op,value,options)},width(_){return arguments.length?this.signal("width",_):this.signal("width")},height(_){return arguments.length?this.signal("height",_):this.signal("height")},padding(_){return arguments.length?this.signal("padding",padding(_)):padding(this.signal("padding"))},autosize(_){return arguments.length?this.signal("autosize",_):this.signal("autosize")},background(_){return arguments.length?this.signal("background",_):this.signal("background")},renderer(type){return arguments.length?(vegaScenegraph.renderModule(type)||vegaUtil.error("Unrecognized renderer type: "+type),type!==this._renderType&&(this._renderType=type,this._resetRenderer()),this):this._renderType},tooltip(handler){return arguments.length?(handler!==this._tooltip&&(this._tooltip=handler,this._resetRenderer()),this):this._tooltip},loader(loader){return arguments.length?(loader!==this._loader&&(vegaDataflow.Dataflow.prototype.loader.call(this,loader),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(lookupSignal(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(viewWidth,viewHeight,width,height,origin,auto){this.runAfter(view=>{let rerun=0;view._autosize=0,view.width()!==width&&(rerun=1,view.signal("width",width,Skip),view._resizeWidth.skip(!0)),view.height()!==height&&(rerun=1,view.signal("height",height,Skip),view._resizeHeight.skip(!0)),view._viewWidth!==viewWidth&&(view._resize=1,view._viewWidth=viewWidth),view._viewHeight!==viewHeight&&(view._resize=1,view._viewHeight=viewHeight),view._origin[0]===origin[0]&&view._origin[1]===origin[1]||(view._resize=1,view._origin=origin),rerun&&view.run("enter"),auto&&view.runAfter(v=>v.resize())},!1,1)},addEventListener(type,handler,options){let callback=handler;return options&&!1===options.trap||(callback=trap(this,handler),callback.raw=handler),this._handler.on(type,callback),this},removeEventListener(type,handler){for(var h,t,handlers=this._handler.handlers(type),i=handlers.length;--i>=0;)if(t=handlers[i].type,h=handlers[i].handler,type===t&&(handler===h||handler===h.raw)){this._handler.off(t,h);break}return this},addResizeListener(handler){const l=this._resizeListeners;return l.indexOf(handler)<0&&l.push(handler),this},removeResizeListener(handler){var l=this._resizeListeners,i=l.indexOf(handler);return i>=0&&l.splice(i,1),this},addSignalListener(name,handler){return addOperatorListener(this,name,lookupSignal(this,name),handler)},removeSignalListener(name,handler){return removeOperatorListener(this,lookupSignal(this,name),handler)},addDataListener(name,handler){return addOperatorListener(this,name,dataref(this,name).values,handler)},removeDataListener(name,handler){return removeOperatorListener(this,dataref(this,name).values,handler)},globalCursor(_){if(arguments.length){if(this._globalCursor!==!!_){const prev=setCursor(this,null);this._globalCursor=!!_,prev&&setCursor(this,prev)}return this}return this._globalCursor},preventDefault(_){return arguments.length?(this._preventDefault=_,this):this._preventDefault},timer:function(callback,delay){this._timers.push(d3Timer.interval((function(elapsed){callback({timestamp:Date.now(),elapsed:elapsed})}),delay))},events:function(source,type,filter){var sources,view=this,s=new vegaDataflow.EventStream(filter),send=function(e,item){view.runAsync(null,()=>{"view"===source&&function(view,type){var def=view._eventConfig.defaults,prevent=def.prevent,allow=def.allow;return!1!==prevent&&!0!==allow&&(!0===prevent||!1===allow||(prevent?prevent[type]:allow?!allow[type]:view.preventDefault()))}(view,type)&&e.preventDefault(),s.receive(eventExtend(view,e,item))})};if("timer"===source)permit(view,"timer",type)&&view.timer(send,type);else if("view"===source)permit(view,"view",type)&&view.addEventListener(type,send,NO_TRAP);else if("window"===source?permit(view,"window",type)&&"undefined"!=typeof window&&(sources=[window]):"undefined"!=typeof document&&permit(view,"selector",type)&&(sources=document.querySelectorAll(source)),sources){for(var i=0,n=sources.length;i<n;++i)sources[i].addEventListener(type,send);view._eventListeners.push({type:type,sources:sources,handler:send})}else view.warn("Can not resolve event source: "+source);return s},finalize:function(){var n,m,e,tooltip=this._tooltip,timers=this._timers,listeners=this._eventListeners;for(n=timers.length;--n>=0;)timers[n].stop();for(n=listeners.length;--n>=0;)for(m=(e=listeners[n]).sources.length;--m>=0;)e.sources[m].removeEventListener(e.type,e.handler);return tooltip&&tooltip.call(this,this._handler,null,null,null),this},hover:function(hoverSet,leaveSet){return leaveSet=[leaveSet||"update",(hoverSet=[hoverSet||"hover"])[0]],this.on(this.events("view","mouseover",itemFilter),markTarget,invoke(hoverSet)),this.on(this.events("view","mouseout",itemFilter),markTarget,invoke(leaveSet)),this},data:function(name,values){return arguments.length<2?dataref(this,name).values.value:change.call(this,name,vegaDataflow.changeset().remove(vegaUtil.truthy).insert(values))},change:change,insert:function(name,_){return change.call(this,name,vegaDataflow.changeset().insert(_))},remove:function(name,_){return change.call(this,name,vegaDataflow.changeset().remove(_))},scale:function(name){var scales=this._runtime.scales;return vegaUtil.hasOwnProperty(scales,name)||vegaUtil.error("Unrecognized scale or projection: "+name),scales[name].value},initialize:function(el,elBind){const view=this,type=view._renderType,config=view._eventConfig.bind,module=vegaScenegraph.renderModule(type);el=view._el=el?lookup(view,el):null,function(view){const el=view.container();el&&(el.setAttribute("role","graphics-document"),el.setAttribute("aria-roleDescription","visualization"),ariaLabel(el,view.description()))}(view),module||view.error("Unrecognized renderer type: "+type);const Handler=module.handler||vegaScenegraph.CanvasHandler,Renderer=el?module.renderer:module.headless;return view._renderer=Renderer?initializeRenderer(view,view._renderer,el,Renderer):null,view._handler=function(view,prevHandler,el,constructor){const handler=new constructor(view.loader(),trap(view,view.tooltip())).scene(view.scenegraph().root).initialize(el,offset(view),view);return prevHandler&&prevHandler.handlers().forEach(h=>{handler.on(h.type,h.handler)}),handler}(view,view._handler,el,Handler),view._redraw=!0,el&&"none"!==config&&(elBind=elBind?view._elBind=lookup(view,elBind):el.appendChild(element("form",{class:"vega-bindings"})),view._bind.forEach(_=>{_.param.element&&"container"!==config&&(_.element=lookup(view,_.param.element))}),view._bind.forEach(_=>{bind(view,_.element||elBind,_)})),view},toImageURL:async function(type,scaleFactor){type!==vegaScenegraph.RenderType.Canvas&&type!==vegaScenegraph.RenderType.SVG&&type!==vegaScenegraph.RenderType.PNG&&vegaUtil.error("Unrecognized image type: "+type);const r=await renderHeadless(this,type,scaleFactor);return type===vegaScenegraph.RenderType.SVG?function(data,mime){const blob=new Blob([data],{type:mime});return window.URL.createObjectURL(blob)}(r.svg(),"image/svg+xml"):r.canvas().toDataURL("image/png")},toCanvas:async function(scaleFactor,opt){return(await renderHeadless(this,vegaScenegraph.RenderType.Canvas,scaleFactor,opt)).canvas()},toSVG:async function(scaleFactor){return(await renderHeadless(this,vegaScenegraph.RenderType.SVG,scaleFactor)).svg()},getState:function(options){return this._runtime.getState(options||{data:dataTest,signals:signalTest,recurse:!0})},setState:function(state){return this.runAsync(null,v=>{v._trigger=!1,v._runtime.setState(state)},v=>{v._trigger=!0}),this}}),exports.View=View,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(40),__webpack_require__(50),__webpack_require__(128),__webpack_require__(62),__webpack_require__(79),__webpack_require__(77),__webpack_require__(51))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports){"use strict";function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?rgba(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?rgba(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));const radians=Math.PI/180,degrees=180/Math.PI,t1=6/29,t2=3*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl)return hcl2lab(o);o instanceof Rgb||(o=rgbConvert(o));var x,z,r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/1);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/.96422),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/.82521)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t>.008856451679035631?Math.pow(t,1/3):t/t2+4/29}function lab2xyz(t){return t>t1?t*t*t:t2*(t-4/29)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(o instanceof Lab||(o=labConvert(o)),0===o.a&&0===o.b)return new Hcl(NaN,0<o.l&&o.l<100?0:NaN,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*degrees;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}function hcl2lab(o){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*radians;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=.96422*lab2xyz(x))-1.6168667*(y=1*lab2xyz(y))-.4906146*(z=.82521*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function(){return hcl2lab(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);o instanceof Rgb||(o=rgbConvert(o));var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*degrees-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return 1===arguments.length?cubehelixConvert(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*radians,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}})),exports.color=color,exports.cubehelix=cubehelix,exports.gray=function(l,opacity){return new Lab(l,0,0,null==opacity?1:opacity)},exports.hcl=hcl,exports.hsl=hsl,exports.lab=lab,exports.lch=function(l,c,h,opacity){return 1===arguments.length?hclConvert(l):new Hcl(h,c,l,null==opacity?1:opacity)},exports.rgb=rgb,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaExpression){"use strict";function testPoint(datum,entry){for(var dval,f,fields=entry.fields,values=entry.values,n=fields.length,i=0;i<n;++i)if((f=fields[i]).getter=vegaUtil.field.getter||vegaUtil.field(f.field),dval=f.getter(datum),vegaUtil.isDate(dval)&&(dval=vegaUtil.toNumber(dval)),vegaUtil.isDate(values[i])&&(values[i]=vegaUtil.toNumber(values[i])),vegaUtil.isDate(values[i][0])&&(values[i]=values[i].map(vegaUtil.toNumber)),"E"===f.type){if(vegaUtil.isArray(values[i])?values[i].indexOf(dval)<0:dval!==values[i])return!1}else if("R"===f.type){if(!vegaUtil.inrange(dval,values[i]))return!1}else if("R-RE"===f.type){if(!vegaUtil.inrange(dval,values[i],!0,!1))return!1}else if("R-E"===f.type){if(!vegaUtil.inrange(dval,values[i],!1,!1))return!1}else if("R-LE"===f.type&&!vegaUtil.inrange(dval,values[i],!1,!0))return!1;return!0}const selectionId=vegaUtil.field("_vgsid_"),bisect=function(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>{return(a=f(d))<(b=x)?-1:a>b?1:a>=b?0:NaN;var a,b}}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}(selectionId),bisectLeft=bisect.left,bisectRight=bisect.right;var ops={E_union:function(base,value){if(!base.length)return value;for(var i=0,n=value.length;i<n;++i)base.indexOf(value[i])<0&&base.push(value[i]);return base},E_intersect:function(base,value){return base.length?base.filter(v=>value.indexOf(v)>=0):value},R_union:function(base,value){var lo=vegaUtil.toNumber(value[0]),hi=vegaUtil.toNumber(value[1]);return lo>hi&&(lo=value[1],hi=value[0]),base.length?(base[0]>lo&&(base[0]=lo),base[1]<hi&&(base[1]=hi),base):[lo,hi]},R_intersect:function(base,value){var lo=vegaUtil.toNumber(value[0]),hi=vegaUtil.toNumber(value[1]);return lo>hi&&(lo=value[1],hi=value[0]),base.length?hi<base[0]||base[1]<lo?[]:(base[0]<lo&&(base[0]=lo),base[1]>hi&&(base[1]=hi),base):[lo,hi]}};exports.selectionIdTest=function(name,datum,op){const data=this.context.data[name],entries=data?data.values.value:[],unitIdx=data?data["index:unit"]&&data["index:unit"].value:void 0,intersect="intersect"===op,value=selectionId(datum),index=bisectLeft(entries,value);if(index===entries.length)return!1;if(selectionId(entries[index])!==value)return!1;if(unitIdx&&intersect){if(1===unitIdx.size)return!0;if(bisectRight(entries,value)-index<unitIdx.size)return!1}return!0},exports.selectionResolve=function(name,op,isMulti,vl5){for(var entry,fields,values,unit,field,res,resUnit,type,union,j,m,data=this.context.data[name],entries=data?data.values.value:[],resolved={},multiRes={},types={},n=entries.length,i=0;i<n;++i){for(unit=(entry=entries[i]).unit,fields=entry.fields,values=entry.values,j=0,m=fields.length;j<m;++j)field=fields[j],resUnit=(res=resolved[field.field]||(resolved[field.field]={}))[unit]||(res[unit]=[]),types[field.field]=type=field.type.charAt(0),union=ops[type+"_union"],res[unit]=union(resUnit,vegaUtil.array(values[j]));isMulti&&(resUnit=multiRes[unit]||(multiRes[unit]=[])).push(vegaUtil.array(values).reduce((obj,curr,j)=>(obj[fields[j].field]=curr,obj),{}))}return op=op||"union",Object.keys(resolved).forEach(field=>{resolved[field]=Object.keys(resolved[field]).map(unit=>resolved[field][unit]).reduce((acc,curr)=>void 0===acc?curr:ops[types[field]+"_"+op](acc,curr))}),entries=Object.keys(multiRes),isMulti&&entries.length&&(resolved[vl5?"vlPoint":"vlMulti"]="union"===op?{or:entries.reduce((acc,k)=>(acc.push(...multiRes[k]),acc),[])}:{and:entries.map(k=>({or:multiRes[k]}))}),resolved},exports.selectionTest=function(name,datum,op){for(var entry,miss,count,unit,b,data=this.context.data[name],entries=data?data.values.value:[],unitIdx=data?data["index:unit"]&&data["index:unit"].value:void 0,intersect="intersect"===op,n=entries.length,i=0;i<n;++i)if(entry=entries[i],unitIdx&&intersect){if(-1===(count=(miss=miss||{})[unit=entry.unit]||0))continue;if(b=testPoint(datum,entry),miss[unit]=b?-1:++count,b&&1===unitIdx.size)return!0;if(!b&&count===unitIdx.get(unit).count)return!1}else if(intersect^(b=testPoint(datum,entry)))return b;return n&&intersect},exports.selectionTuples=function(array,base){return array.map(x=>vegaUtil.extend({values:base.fields.map(f=>(f.getter||(f.getter=vegaUtil.field(f.field)))(x.datum))},base))},exports.selectionVisitor=function(name,args,scope,params){args[0].type!==vegaExpression.Literal&&vegaUtil.error("First argument to selection functions must be a string literal.");const data=args[0].value,dataName=":"+data;"intersect"!==(args.length>=2&&vegaUtil.peek(args).value)||vegaUtil.hasOwnProperty(params,"@unit")||(params["@unit"]=scope.getData(data).indataRef(scope,"unit")),vegaUtil.hasOwnProperty(params,dataName)||(params[dataName]=scope.getData(data).tuplesRef())},Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(78))},function(module,exports,__webpack_require__){!function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(f){let delta=f,compare=f;function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo}return 1===f.length&&(delta=(d,x)=>f(d)-x,compare=function(f){return(d,x)=>ascending(f(d),x)}(f)),{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0),null==hi&&(hi=a.length);const i=left(a,x,lo,hi-1);return i>lo&&delta(a[i-1],x)>-delta(a[i],x)?i-1:i},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){const mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function number(x){return null===x?NaN:+x}const ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number).center;function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}function length(array){return 0|array.length}function empty(length){return!(length>0)}function arrayify(values){return"object"!=typeof values||"length"in values?values:Array.from(values)}function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}function deviation(values,valueof){const v=variance(values,valueof);return v?Math.sqrt(v):v}function extent(values,valueof){let min,max;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(void 0===min?value>=value&&(min=max=value):(min>value&&(min=value),max<value&&(max=value)))}return[min,max]}class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y=p[j],hi=x+y,lo=Math.abs(x)<Math.abs(y)?x-(hi-y):y-(hi-x);lo&&(p[i++]=lo),x=hi}return p[i]=x,this._n=i+1,this}valueOf(){const p=this._partials;let x,y,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x=hi,y=p[--n],hi=x+y,lo=y-(hi-x),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y=2*lo,x=hi+y,y==x-hi&&(hi=x))}return hi}}function identity(x){return x}function unique(values){if(1!==values.length)throw new Error("duplicate key");return values[0]}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new Map,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}var slice=Array.prototype.slice;function constant(x){return function(){return x}}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)==(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(step=-step,start=Math.ceil(start*step),stop=Math.floor(stop*step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function nice(start,stop,count){let prestep;for(;;){const step=tickIncrement(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}function sturges(values){return Math.ceil(Math.log(count(values))/Math.LN2)+1}function bin(){var value=identity,domain=extent,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=+tz,domain===extent&&([x0,x1]=nice(x0,x1,tz)),(tz=ticks(x0,x1,tz))[tz.length-1]===x1&&tz.pop());for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function max(values,valueof){let max;if(void 0===valueof)for(const value of values)null!=value&&(max<value||void 0===max&&value>=value)&&(max=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value)}return max}function min(values,valueof){let min;if(void 0===valueof)for(const value of values)null!=value&&(min>value||void 0===min&&value>=value)&&(min=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value)}return min}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){for(;right>left;){if(right-left>600){const n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselect(array,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}const t=array[k];let i=left,j=right;for(swap(array,left,k),compare(array[right],t)>0&&swap(array,left,right);i<j;){for(swap(array,i,j),++i,--j;compare(array[i],t)<0;)++i;for(;compare(array[j],t)>0;)--j}0===compare(array[left],t)?swap(array,left,j):(++j,swap(array,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}return array}function swap(array,i,j){const t=array[i];array[i]=array[j],array[j]=t}function quantile(values,p,valueof){if(n=(values=Float64Array.from(function*(values,valueof){if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(yield value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(yield value)}}(values,valueof))).length){if((p=+p)<=0||n<2)return min(values);if(p>=1)return max(values);var n,i=(n-1)*p,i0=Math.floor(i),value0=max(quickselect(values,i0).subarray(0,i0+1));return value0+(min(values.subarray(i0+1))-value0)*(i-i0)}}function maxIndex(values,valueof){let max,maxIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(max<value||void 0===max&&value>=value)&&(max=value,maxIndex=index);return maxIndex}function minIndex(values,valueof){let min,minIndex=-1,index=-1;if(void 0===valueof)for(const value of values)++index,null!=value&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);else for(let value of values)null!=(value=valueof(value,++index,values))&&(min>value||void 0===min&&value>=value)&&(min=value,minIndex=index);return minIndex}function pair(a,b){return[a,b]}function leastIndex(values,compare=ascending){if(1===compare.length)return minIndex(values,compare);let minValue,min=-1,index=-1;for(const value of values)++index,(min<0?0===compare(value,value):compare(value,minValue)<0)&&(minValue=value,min=index);return min}var shuffle=shuffler(Math.random);function shuffler(random){return function(array,i0=0,i1=array.length){let m=i1-(i0=+i0);for(;m;){const i=random()*m--|0,t=array[m+i0];array[m+i0]=array[i+i0],array[i+i0]=t}return array}}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length$1),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length$1(d){return d.length}function set(values){return values instanceof Set?values:new Set(values)}function superset(values,other){const iterator=values[Symbol.iterator](),set=new Set;for(const o of other){if(set.has(o))continue;let value,done;for(;({value:value,done:done}=iterator.next());){if(done)return!1;if(set.add(value),Object.is(o,value))break}}return!0}exports.Adder=Adder,exports.ascending=ascending,exports.bin=bin,exports.bisect=bisectRight,exports.bisectCenter=bisectCenter,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.count=count,exports.cross=function(...values){const reduce="function"==typeof values[values.length-1]&&function(reduce){return values=>reduce(...values)}(values.pop()),lengths=(values=values.map(arrayify)).map(length),j=values.length-1,index=new Array(j+1).fill(0),product=[];if(j<0||lengths.some(empty))return product;for(;;){product.push(index.map((j,i)=>values[i][j]));let i=j;for(;++index[i]===lengths[i];){if(0===i)return reduce?product.map(reduce):product;index[i--]=0}}},exports.cumsum=function(values,valueof){var sum=0,index=0;return Float64Array.from(values,void 0===valueof?v=>sum+=+v||0:v=>sum+=+valueof(v,index++,values)||0)},exports.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},exports.deviation=deviation,exports.difference=function(values,...others){values=new Set(values);for(const other of others)for(const value of other)values.delete(value);return values},exports.disjoint=function(values,other){const iterator=other[Symbol.iterator](),set=new Set;for(const v of values){if(set.has(v))return!1;let value,done;for(;({value:value,done:done}=iterator.next())&&!done;){if(Object.is(v,value))return!1;set.add(value)}}return!0},exports.every=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(!test(value,++index,values))return!1;return!0},exports.extent=extent,exports.filter=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");const array=[];let index=-1;for(const value of values)test(value,++index,values)&&array.push(value);return array},exports.fsum=function(values,valueof){const adder=new Adder;if(void 0===valueof)for(let value of values)(value=+value)&&adder.add(value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&adder.add(value)}return+adder},exports.greatest=function(values,compare=ascending){let max,defined=!1;if(1===compare.length){let maxValue;for(const element of values){const value=compare(element);(defined?ascending(value,maxValue)>0:0===ascending(value,value))&&(max=element,maxValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,max)>0:0===compare(value,value))&&(max=value,defined=!0);return max},exports.greatestIndex=function(values,compare=ascending){if(1===compare.length)return maxIndex(values,compare);let maxValue,max=-1,index=-1;for(const value of values)++index,(max<0?0===compare(value,value):compare(value,maxValue)>0)&&(maxValue=value,max=index);return max},exports.group=function(values,...keys){return nest(values,identity,identity,keys)},exports.groups=function(values,...keys){return nest(values,Array.from,identity,keys)},exports.histogram=bin,exports.index=function(values,...keys){return nest(values,identity,unique,keys)},exports.indexes=function(values,...keys){return nest(values,Array.from,unique,keys)},exports.intersection=function(values,...others){values=new Set(values),others=others.map(set);out:for(const value of values)for(const other of others)if(!other.has(value)){values.delete(value);continue out}return values},exports.least=function(values,compare=ascending){let min,defined=!1;if(1===compare.length){let minValue;for(const element of values){const value=compare(element);(defined?ascending(value,minValue)<0:0===ascending(value,value))&&(min=element,minValue=value,defined=!0)}}else for(const value of values)(defined?compare(value,min)<0:0===compare(value,value))&&(min=value,defined=!0);return min},exports.leastIndex=leastIndex,exports.map=function(values,mapper){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof mapper)throw new TypeError("mapper is not a function");return Array.from(values,(value,index)=>mapper(value,index,values))},exports.max=max,exports.maxIndex=maxIndex,exports.mean=function(values,valueof){let count=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(++count,sum+=value);else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(++count,sum+=value)}if(count)return sum/count},exports.median=function(values,valueof){return quantile(values,.5,valueof)},exports.merge=function(arrays){return Array.from(function*(arrays){for(const array of arrays)yield*array}(arrays))},exports.min=min,exports.minIndex=minIndex,exports.nice=nice,exports.pairs=function(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs},exports.permute=function(source,keys){return Array.from(keys,key=>source[key])},exports.quantile=quantile,exports.quantileSorted=function(values,p,valueof=number){if(n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}},exports.quickselect=quickselect,exports.range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range},exports.reduce=function(values,reducer,value){if("function"!=typeof reducer)throw new TypeError("reducer is not a function");const iterator=values[Symbol.iterator]();let done,next,index=-1;if(arguments.length<3){if(({done:done,value:value}=iterator.next()),done)return;++index}for(;({done:done,value:next}=iterator.next()),!done;)value=reducer(value,next,++index,values);return value},exports.reverse=function(values){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).reverse()},exports.rollup=function(values,reduce,...keys){return nest(values,identity,reduce,keys)},exports.rollups=function(values,reduce,...keys){return nest(values,Array.from,reduce,keys)},exports.scan=function(values,compare){const index=leastIndex(values,compare);return index<0?void 0:index},exports.shuffle=shuffle,exports.shuffler=shuffler,exports.some=function(values,test){if("function"!=typeof test)throw new TypeError("test is not a function");let index=-1;for(const value of values)if(test(value,++index,values))return!0;return!1},exports.sort=function(values,comparator=ascending){if("function"!=typeof values[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(values).sort(comparator)},exports.subset=function(values,other){return superset(other,values)},exports.sum=function(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum},exports.superset=superset,exports.thresholdFreedmanDiaconis=function(values,min,max){return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(count(values),-1/3)))},exports.thresholdScott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(count(values),-1/3)))},exports.thresholdSturges=sturges,exports.tickIncrement=tickIncrement,exports.tickStep=function(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1},exports.ticks=ticks,exports.transpose=transpose,exports.union=function(...others){const set=new Set;for(const other of others)for(const o of other)set.add(o);return set},exports.variance=variance,exports.zip=function(){return transpose(arguments)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){!function(exports,vegaUtil,vegaFunctions,vegaEventSelector,vegaScale,vegaDataflow){"use strict";function parseAutosize(spec){return vegaUtil.isObject(spec)?spec:{type:spec||"pad"}}const number=_=>+_||0;function parsePadding(spec){return vegaUtil.isObject(spec)?spec.signal?spec:{top:number(spec.top),bottom:number(spec.bottom),left:number(spec.left),right:number(spec.right)}:{top:_=number(spec),bottom:_,left:_,right:_};var _}const encoder=_=>vegaUtil.isObject(_)&&!vegaUtil.isArray(_)?vegaUtil.extend({},_):{value:_};function addEncode(object,name,value,set){return null!=value?(vegaUtil.isObject(value)&&!vegaUtil.isArray(value)||vegaUtil.isArray(value)&&value.length&&vegaUtil.isObject(value[0])?object.update[name]=value:object[set||"enter"][name]={value:value},1):0}function addEncoders(object,enter,update){for(const name in enter)addEncode(object,name,enter[name]);for(const name in update)addEncode(object,name,update[name],"update")}function extendEncode(encode,extra,skip){for(const name in extra)skip&&vegaUtil.hasOwnProperty(skip,name)||(encode[name]=vegaUtil.extend(encode[name]||{},extra[name]));return encode}function has(key,encode){return encode&&(encode.enter&&encode.enter[key]||encode.update&&encode.update[key])}function applyDefault(defaults,key,value){defaults[key]=value&&value.signal?{signal:value.signal}:{value:value}}const scaleRef=scale=>vegaUtil.isString(scale)?vegaUtil.stringValue(scale):scale.signal?`(${scale.signal})`:field(scale);function entry(enc){if(null!=enc.gradient)return function(enc){const args=[enc.start,enc.stop,enc.count].map(_=>null==_?null:vegaUtil.stringValue(_));for(;args.length&&null==vegaUtil.peek(args);)args.pop();return args.unshift(scaleRef(enc.gradient)),`gradient(${args.join(",")})`}(enc);let value=enc.signal?`(${enc.signal})`:enc.color?function(enc){return enc.c?_color("hcl",enc.h,enc.c,enc.l):enc.h||enc.s?_color("hsl",enc.h,enc.s,enc.l):enc.l||enc.a?_color("lab",enc.l,enc.a,enc.b):enc.r||enc.g||enc.b?_color("rgb",enc.r,enc.g,enc.b):null}(enc.color):null!=enc.field?field(enc.field):void 0!==enc.value?vegaUtil.stringValue(enc.value):void 0;return null!=enc.scale&&(value=function(enc,value){const scale=scaleRef(enc.scale);return null!=enc.range?value=`lerp(_range(${scale}), ${+enc.range})`:(void 0!==value&&(value=`_scale(${scale}, ${value})`),enc.band&&(value=(value?value+"+":"")+`_bandwidth(${scale})`+(1==+enc.band?"":"*"+property(enc.band)),enc.extra&&(value=`(datum.extra ? _scale(${scale}, datum.extra.value) : ${value})`)),null==value&&(value="0")),value}(enc,value)),void 0===value&&(value=null),null!=enc.exponent&&(value=`pow(${value},${property(enc.exponent)})`),null!=enc.mult&&(value+="*"+property(enc.mult)),null!=enc.offset&&(value+="+"+property(enc.offset)),enc.round&&(value=`round(${value})`),value}const _color=(type,x,y,z)=>`(${type}(${[x,y,z].map(entry).join(",")})+'')`;function property(property){return vegaUtil.isObject(property)?"("+entry(property)+")":property}function field(ref){return function resolveField(ref){let object,level,field;if(ref.signal)object="datum",field=ref.signal;else if(ref.group||ref.parent){for(level=Math.max(1,ref.level||1),object="item";level-- >0;)object+=".mark.group";ref.parent?(field=ref.parent,object+=".datum"):field=ref.group}else ref.datum?(object="datum",field=ref.datum):vegaUtil.error("Invalid field reference: "+vegaUtil.stringValue(ref));return ref.signal||(field=vegaUtil.isString(field)?vegaUtil.splitAccessPath(field).map(vegaUtil.stringValue).join("]["):resolveField(field)),object+"["+field+"]"}(vegaUtil.isObject(ref)?ref:{datum:ref})}function parseEncode(encode,type,role,style,scope,params){const enc={};(params=params||{}).encoders={$encode:enc},encode=function(encode,type,role,style,config){const defaults={},enter={};let update,key,skip,props;for(key in key="lineBreak","text"!==type||null==config[key]||has(key,encode)||applyDefault(defaults,key,config[key]),("legend"==role||String(role).startsWith("axis"))&&(role=null),props="frame"===role?config.group:"mark"===role?vegaUtil.extend({},config.mark,config[type]):null,props)skip=has(key,encode)||("fill"===key||"stroke"===key)&&(has("fill",encode)||has("stroke",encode)),skip||applyDefault(defaults,key,props[key]);for(key in vegaUtil.array(style).forEach(name=>{const props=config.style&&config.style[name];for(const key in props)has(key,encode)||applyDefault(defaults,key,props[key])}),encode=vegaUtil.extend({},encode),defaults)props=defaults[key],props.signal?(update=update||{})[key]=props:enter[key]=props;return encode.enter=vegaUtil.extend(enter,encode.enter),update&&(encode.update=vegaUtil.extend(update,encode.update)),encode}(encode,type,role,style,scope.config);for(const key in encode)enc[key]=parseBlock(encode[key],type,params,scope);return params}function parseBlock(block,marktype,params,scope){const channels={},fields={};for(const name in block)null!=block[name]&&(channels[name]=parse((enc=block[name],vegaUtil.isArray(enc)?function(enc){let code="";return enc.forEach(rule=>{const value=entry(rule);code+=rule.test?`(${rule.test})?${value}:`:value}),":"===vegaUtil.peek(code)&&(code+="null"),code}(enc):entry(enc)),scope,params,fields));var enc;return{$expr:{marktype:marktype,channels:channels},$fields:Object.keys(fields),$output:Object.keys(block)}}function parse(code,scope,params,fields){const expr=vegaFunctions.parseExpression(code,scope);return expr.$fields.forEach(name=>fields[name]=1),vegaUtil.extend(params,expr.$params),expr.$expr}const OUTER_INVALID=["value","update","init","react","bind"];function outerError(prefix,name){vegaUtil.error(prefix+' for "outer" push: '+vegaUtil.stringValue(name))}function parseSignal(signal,scope){const name=signal.name;if("outer"===signal.push)scope.signals[name]||outerError("No prior signal definition",name),OUTER_INVALID.forEach(prop=>{void 0!==signal[prop]&&outerError("Invalid property ",prop)});else{const op=scope.addSignal(name,signal.value);!1===signal.react&&(op.react=!1),signal.bind&&scope.addBinding(name,signal.bind)}}function Entry(type,value,params,parent){this.id=-1,this.type=type,this.value=value,this.params=params,parent&&(this.parent=parent)}function entry$1(type,value,params,parent){return new Entry(type,value,params,parent)}function operator(value,params){return entry$1("operator",value,params)}function ref(op){const ref={$ref:op.id};return op.id<0&&(op.refs=op.refs||[]).push(ref),ref}function fieldRef(field,name){return name?{$field:field,$name:name}:{$field:field}}const keyFieldRef=fieldRef("key");function compareRef(fields,orders){return{$compare:fields,$order:orders}}function aggrField(op,field){return(op&&op.signal?"$"+op.signal:op||"")+(op&&field?"_":"")+(field&&field.signal?"$"+field.signal:field||"")}function isSignal(_){return _&&_.signal}function hasSignal(_){if(isSignal(_))return!0;if(vegaUtil.isObject(_))for(const key in _)if(hasSignal(_[key]))return!0;return!1}function value(specValue,defaultValue){return null!=specValue?specValue:defaultValue}function deref(v){return v&&v.signal||v}function parseStream(stream,scope){return(stream.merge?mergeStream:stream.stream?nestedStream:stream.type?eventStream:vegaUtil.error("Invalid stream specification: "+vegaUtil.stringValue(stream)))(stream,scope)}function mergeStream(stream,scope){const entry=streamParameters({merge:stream.merge.map(s=>parseStream(s,scope))},stream,scope);return scope.addStream(entry).id}function nestedStream(stream,scope){const entry=streamParameters({stream:parseStream(stream.stream,scope)},stream,scope);return scope.addStream(entry).id}function eventStream(stream,scope){let id;var source;"timer"===stream.type?(id=scope.event("timer",stream.throttle),stream={between:stream.between,filter:stream.filter}):id=scope.event("scope"===(source=stream.source)?"view":source||"view",stream.type);const entry=streamParameters({stream:id},stream,scope);return 1===Object.keys(entry).length?id:scope.addStream(entry).id}function streamParameters(entry,stream,scope){let param=stream.between;return param&&(2!==param.length&&vegaUtil.error('Stream "between" parameter must have 2 entries: '+vegaUtil.stringValue(stream)),entry.between=[parseStream(param[0],scope),parseStream(param[1],scope)]),param=stream.filter?[].concat(stream.filter):[],(stream.marktype||stream.markname||stream.markrole)&&param.push(function(type,name,role){const item="event.item";return item+(type&&"*"!==type?"&&"+item+".mark.marktype==='"+type+"'":"")+(role?"&&"+item+".mark.role==='"+role+"'":"")+(name?"&&"+item+".mark.name==='"+name+"'":"")}(stream.marktype,stream.markname,stream.markrole)),"scope"===stream.source&&param.push("inScope(event.item)"),param.length&&(entry.filter=vegaFunctions.parseExpression("("+param.join(")&&(")+")",scope).$expr),null!=(param=stream.throttle)&&(entry.throttle=+param),null!=(param=stream.debounce)&&(entry.debounce=+param),stream.consume&&(entry.consume=!0),entry}const OP_VALUE_EXPR={code:"_.$value",ast:{type:"Identifier",value:"value"}};function parseUpdate(spec,scope,target){const encode=spec.encode,entry={target:target};let events=spec.events,update=spec.update,sources=[];events||vegaUtil.error("Signal update missing events specification."),vegaUtil.isString(events)&&(events=vegaEventSelector.selector(events,scope.isSubscope()?"scope":"view")),events=vegaUtil.array(events).filter(s=>s.signal||s.scale?(sources.push(s),0):1),sources.length>1&&(sources=[mergeSources(sources)]),events.length&&sources.push(events.length>1?{merge:events}:events[0]),null!=encode&&(update&&vegaUtil.error("Signal encode and update are mutually exclusive."),update="encode(item(),"+vegaUtil.stringValue(encode)+")"),entry.update=vegaUtil.isString(update)?vegaFunctions.parseExpression(update,scope):null!=update.expr?vegaFunctions.parseExpression(update.expr,scope):null!=update.value?update.value:null!=update.signal?{$expr:OP_VALUE_EXPR,$params:{$value:scope.signalRef(update.signal)}}:vegaUtil.error("Invalid signal update specification."),spec.force&&(entry.options={force:!0}),sources.forEach(source=>scope.addUpdate(vegaUtil.extend(function(stream,scope){return{source:stream.signal?scope.signalRef(stream.signal):stream.scale?scope.scaleRef(stream.scale):parseStream(stream,scope)}}(source,scope),entry)))}function mergeSources(sources){return{signal:"["+sources.map(s=>s.scale?'scale("'+s.scale+'")':s.signal)+"]"}}function parseSignalUpdates(signal,scope){const op=scope.getSignal(signal.name);let expr=signal.update;signal.init&&(expr?vegaUtil.error("Signals can not include both init and update expressions."):(expr=signal.init,op.initonly=!0)),expr&&(expr=vegaFunctions.parseExpression(expr,scope),op.update=expr.$expr,op.params=expr.$params),signal.on&&signal.on.forEach(_=>parseUpdate(_,scope,op.id))}const transform=name=>(params,value,parent)=>entry$1(name,value,params||void 0,parent),Aggregate=transform("aggregate"),AxisTicks=transform("axisticks"),Bound=transform("bound"),Collect=transform("collect"),Compare=transform("compare"),DataJoin=transform("datajoin"),Encode=transform("encode"),Expression=transform("expression"),Facet=transform("facet"),Field=transform("field"),Key=transform("key"),LegendEntries=transform("legendentries"),Load=transform("load"),Mark=transform("mark"),MultiExtent=transform("multiextent"),MultiValues=transform("multivalues"),Overlap=transform("overlap"),Params=transform("params"),PreFacet=transform("prefacet"),Projection=transform("projection"),Proxy=transform("proxy"),Relay=transform("relay"),Render=transform("render"),Scale=transform("scale"),Sieve=transform("sieve"),SortItems=transform("sortitems"),ViewLayout=transform("viewlayout"),Values=transform("values");let FIELD_REF_ID=0;const MULTIDOMAIN_SORT_OPS={min:"min",max:"max",count:"sum"};function parseScale(spec,scope){const params=scope.getScale(spec.name).params;let key;var nice;for(key in params.domain=parseScaleDomain(spec.domain,spec,scope),null!=spec.range&&(params.range=function parseScaleRange(spec,scope,params){const config=scope.config.range;let range=spec.range;if(range.signal)return scope.signalRef(range.signal);if(vegaUtil.isString(range)){if(config&&vegaUtil.hasOwnProperty(config,range))return spec=vegaUtil.extend({},spec,{range:config[range]}),parseScaleRange(spec,scope,params);"width"===range?range=[0,{signal:"width"}]:"height"===range?range=vegaScale.isDiscrete(spec.type)?[0,{signal:"height"}]:[{signal:"height"},0]:vegaUtil.error("Unrecognized scale range value: "+vegaUtil.stringValue(range))}else{if(range.scheme)return params.scheme=vegaUtil.isArray(range.scheme)?parseArray(range.scheme,scope):parseLiteral(range.scheme,scope),range.extent&&(params.schemeExtent=parseArray(range.extent,scope)),void(range.count&&(params.schemeCount=parseLiteral(range.count,scope)));if(range.step)return void(params.rangeStep=parseLiteral(range.step,scope));if(vegaScale.isDiscrete(spec.type)&&!vegaUtil.isArray(range))return parseScaleDomain(range,spec,scope);vegaUtil.isArray(range)||vegaUtil.error("Unsupported range type: "+vegaUtil.stringValue(range))}return range.map(v=>(vegaUtil.isArray(v)?parseArray:parseLiteral)(v,scope))}(spec,scope,params)),null!=spec.interpolate&&function(interpolate,params){params.interpolate=parseLiteral(interpolate.type||interpolate),null!=interpolate.gamma&&(params.interpolateGamma=parseLiteral(interpolate.gamma))}(spec.interpolate,params),null!=spec.nice&&(params.nice=(nice=spec.nice,vegaUtil.isObject(nice)?{interval:parseLiteral(nice.interval),step:parseLiteral(nice.step)}:parseLiteral(nice))),null!=spec.bins&&(params.bins=function(v,scope){return v.signal||vegaUtil.isArray(v)?parseArray(v,scope):scope.objectProperty(v)}(spec.bins,scope)),spec)vegaUtil.hasOwnProperty(params,key)||"name"===key||(params[key]=parseLiteral(spec[key],scope))}function parseLiteral(v,scope){return vegaUtil.isObject(v)?v.signal?scope.signalRef(v.signal):vegaUtil.error("Unsupported object: "+vegaUtil.stringValue(v)):v}function parseArray(v,scope){return v.signal?scope.signalRef(v.signal):v.map(v=>parseLiteral(v,scope))}function dataLookupError(name){vegaUtil.error("Can not find data set: "+vegaUtil.stringValue(name))}function parseScaleDomain(domain,spec,scope){if(domain)return domain.signal?scope.signalRef(domain.signal):(vegaUtil.isArray(domain)?explicitDomain:domain.fields?multipleDomain:singularDomain)(domain,spec,scope);null==spec.domainMin&&null==spec.domainMax||vegaUtil.error("No scale domain defined for domainMin/domainMax to override.")}function explicitDomain(domain,spec,scope){return domain.map(v=>parseLiteral(v,scope))}function singularDomain(domain,spec,scope){const data=scope.getData(domain.data);return data||dataLookupError(domain.data),vegaScale.isDiscrete(spec.type)?data.valuesRef(scope,domain.field,parseSort(domain.sort,!1)):vegaScale.isQuantile(spec.type)?data.domainRef(scope,domain.field):data.extentRef(scope,domain.field)}function multipleDomain(domain,spec,scope){const data=domain.data,fields=domain.fields.reduce((dom,d)=>(d=vegaUtil.isString(d)?{data:data,field:d}:vegaUtil.isArray(d)||d.signal?function(data,scope){const name="_:vega:_"+FIELD_REF_ID++,coll=Collect({});if(vegaUtil.isArray(data))coll.value={$ingest:data};else if(data.signal){const code="setdata("+vegaUtil.stringValue(name)+","+data.signal+")";coll.params.input=scope.signalRef(code)}return scope.addDataPipeline(name,[coll,Sieve({})]),{data:name,field:"data"}}(d,scope):d,dom.push(d),dom),[]);return(vegaScale.isDiscrete(spec.type)?ordinalMultipleDomain:vegaScale.isQuantile(spec.type)?quantileMultipleDomain:numericMultipleDomain)(domain,scope,fields)}function ordinalMultipleDomain(domain,scope,fields){const sort=parseSort(domain.sort,!0);let a,v;const counts=fields.map(f=>{const data=scope.getData(f.data);return data||dataLookupError(f.data),data.countsRef(scope,f.field,sort)}),p={groupby:keyFieldRef,pulse:counts};sort&&(a=sort.op||"count",v=sort.field?aggrField(a,sort.field):"count",p.ops=[MULTIDOMAIN_SORT_OPS[a]],p.fields=[scope.fieldRef(v)],p.as=[v]),a=scope.add(Aggregate(p));const c=scope.add(Collect({pulse:ref(a)}));return v=scope.add(Values({field:keyFieldRef,sort:scope.sortRef(sort),pulse:ref(c)})),ref(v)}function parseSort(sort,multidomain){return sort&&(sort.field||sort.op?sort.field||"count"===sort.op?multidomain&&sort.field&&sort.op&&!MULTIDOMAIN_SORT_OPS[sort.op]&&vegaUtil.error("Multiple domain scales can not be sorted using "+sort.op):vegaUtil.error("No field provided for sort aggregate op: "+sort.op):vegaUtil.isObject(sort)?sort.field="key":sort={field:"key"}),sort}function quantileMultipleDomain(domain,scope,fields){const values=fields.map(f=>{const data=scope.getData(f.data);return data||dataLookupError(f.data),data.domainRef(scope,f.field)});return ref(scope.add(MultiValues({values:values})))}function numericMultipleDomain(domain,scope,fields){const extents=fields.map(f=>{const data=scope.getData(f.data);return data||dataLookupError(f.data),data.extentRef(scope,f.field)});return ref(scope.add(MultiExtent({extents:extents})))}function parseParameter(_,name,scope){return vegaUtil.isArray(_)?_.map(_=>parseParameter(_,name,scope)):vegaUtil.isObject(_)?_.signal?scope.signalRef(_.signal):"fit"===name?_:vegaUtil.error("Unsupported parameter object: "+vegaUtil.stringValue(_)):_}const Top="top",Value="value",LegendScales=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],Skip={name:1,style:1,interactive:1},zero={value:0},one={value:1};function guideGroup(mark){return mark.type="group",mark.interactive=mark.interactive||!1,mark}function lookup(spec,config){const _=(name,dflt)=>value(spec[name],value(config[name],dflt));return _.isVertical=s=>"vertical"===value(spec.direction,config.direction||(s?config.symbolDirection:config.gradientDirection)),_.gradientLength=()=>value(spec.gradientLength,config.gradientLength||config.gradientWidth),_.gradientThickness=()=>value(spec.gradientThickness,config.gradientThickness||config.gradientHeight),_.entryColumns=()=>value(spec.columns,value(config.columns,+_.isVertical(!0))),_}function getEncoding(name,encode){const v=encode&&(encode.update&&encode.update[name]||encode.enter&&encode.enter[name]);return v&&v.signal?v:v?v.value:null}function anchorExpr(s,e,m){return`item.anchor === 'start' ? ${s} : item.anchor === 'end' ? ${e} : ${m}`}const alignExpr=anchorExpr(vegaUtil.stringValue("left"),vegaUtil.stringValue("right"),vegaUtil.stringValue("center"));function extendOffset(value,offset){return offset?value?vegaUtil.isObject(value)?Object.assign({},value,{offset:extendOffset(value.offset,offset)}):{value:value,offset:offset}:offset:value}function guideMark(mark,extras){return extras?(mark.name=extras.name,mark.style=extras.style||mark.style,mark.interactive=!!extras.interactive,mark.encode=extendEncode(mark.encode,extras,Skip)):mark.interactive=!1,mark}function legendGradient(spec,scale,config,userEncode){const _=lookup(spec,config),vertical=_.isVertical(),thickness=_.gradientThickness(),length=_.gradientLength();let enter,start,stop,width,height;vertical?(start=[0,1],stop=[0,0],width=thickness,height=length):(start=[0,0],stop=[1,0],width=length,height=thickness);const encode={enter:enter={opacity:zero,x:zero,y:zero,width:encoder(width),height:encoder(height)},update:vegaUtil.extend({},enter,{opacity:one,fill:{gradient:scale,start:start,stop:stop}}),exit:{opacity:zero}};return addEncoders(encode,{stroke:_("gradientStrokeColor"),strokeWidth:_("gradientStrokeWidth")},{opacity:_("gradientOpacity")}),guideMark({type:"rect",role:"legend-gradient",encode:encode},userEncode)}function legendGradientDiscrete(spec,scale,config,userEncode,dataRef){const _=lookup(spec,config),vertical=_.isVertical(),thickness=_.gradientThickness(),length=_.gradientLength();let u,v,uu,vv,adjust="";vertical?(u="y",uu="y2",v="x",vv="width",adjust="1-"):(u="x",uu="x2",v="y",vv="height");const enter={opacity:zero,fill:{scale:scale,field:Value}};enter[u]={signal:adjust+"datum.perc",mult:length},enter[v]=zero,enter[uu]={signal:adjust+"datum.perc2",mult:length},enter[vv]=encoder(thickness);const encode={enter:enter,update:vegaUtil.extend({},enter,{opacity:one}),exit:{opacity:zero}};return addEncoders(encode,{stroke:_("gradientStrokeColor"),strokeWidth:_("gradientStrokeWidth")},{opacity:_("gradientOpacity")}),guideMark({type:"rect",role:"legend-band",key:Value,from:dataRef,encode:encode},userEncode)}function legendGradientLabels(spec,config,userEncode,dataRef){const _=lookup(spec,config),vertical=_.isVertical(),thickness=encoder(_.gradientThickness()),length=_.gradientLength();let enter,update,u,v,overlap=_("labelOverlap"),adjust="";const encode={enter:enter={opacity:zero},update:update={opacity:one,text:{field:"label"}},exit:{opacity:zero}};return addEncoders(encode,{fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontStyle:_("labelFontStyle"),fontWeight:_("labelFontWeight"),limit:value(spec.labelLimit,config.gradientLabelLimit)}),vertical?(enter.align={value:"left"},enter.baseline=update.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},u="y",v="x",adjust="1-"):(enter.align=update.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},enter.baseline={value:"top"},u="x",v="y"),enter[u]=update[u]={signal:adjust+"datum.perc",mult:length},enter[v]=update[v]=thickness,thickness.offset=value(spec.labelOffset,config.gradientLabelOffset)||0,overlap=overlap?{separation:_("labelSeparation"),method:overlap,order:"datum.index"}:void 0,guideMark({type:"text",role:"legend-label",style:"guide-label",key:Value,from:dataRef,encode:encode,overlap:overlap},userEncode)}function legendSymbolGroups(spec,config,userEncode,dataRef,columns){const _=lookup(spec,config),entries=userEncode.entries,interactive=!(!entries||!entries.interactive),name=entries?entries.name:void 0,height=_("clipHeight"),symbolOffset=_("symbolOffset"),valueRef={data:"value"},xSignal=`(${columns}) ? datum.offset : datum.size`,yEncode=height?encoder(height):{field:"size"},index="datum.index",ncols=`max(1, ${columns})`;let encode,enter,update,nrows,sort;yEncode.mult=.5,encode={enter:enter={opacity:zero,x:{signal:xSignal,mult:.5,offset:symbolOffset},y:yEncode},update:update={opacity:one,x:enter.x,y:enter.y},exit:{opacity:zero}};let baseFill=null,baseStroke=null;spec.fill||(baseFill=config.symbolBaseFillColor,baseStroke=config.symbolBaseStrokeColor),addEncoders(encode,{fill:_("symbolFillColor",baseFill),shape:_("symbolType"),size:_("symbolSize"),stroke:_("symbolStrokeColor",baseStroke),strokeDash:_("symbolDash"),strokeDashOffset:_("symbolDashOffset"),strokeWidth:_("symbolStrokeWidth")},{opacity:_("symbolOpacity")}),LegendScales.forEach(scale=>{spec[scale]&&(update[scale]=enter[scale]={scale:spec[scale],field:Value})});const symbols=guideMark({type:"symbol",role:"legend-symbol",key:Value,from:valueRef,clip:!!height||void 0,encode:encode},userEncode.symbols),labelOffset=encoder(symbolOffset);labelOffset.offset=_("labelOffset"),encode={enter:enter={opacity:zero,x:{signal:xSignal,offset:labelOffset},y:yEncode},update:update={opacity:one,text:{field:"label"},x:enter.x,y:enter.y},exit:{opacity:zero}},addEncoders(encode,{align:_("labelAlign"),baseline:_("labelBaseline"),fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontStyle:_("labelFontStyle"),fontWeight:_("labelFontWeight"),limit:_("labelLimit")});const labels=guideMark({type:"text",role:"legend-label",style:"guide-label",key:Value,from:valueRef,encode:encode},userEncode.labels);return encode={enter:{noBound:{value:!height},width:zero,height:height?encoder(height):zero,opacity:zero},exit:{opacity:zero},update:update={opacity:one,row:{signal:null},column:{signal:null}}},_.isVertical(!0)?(nrows=`ceil(item.mark.items.length / ${ncols})`,update.row.signal=`${index}%${nrows}`,update.column.signal=`floor(${index} / ${nrows})`,sort={field:["row",index]}):(update.row.signal=`floor(${index} / ${ncols})`,update.column.signal=`${index} % ${ncols}`,sort={field:index}),update.column.signal=`(${columns})?${update.column.signal}:${index}`,guideGroup({role:"scope",from:dataRef={facet:{data:dataRef,name:"value",groupby:"index"}},encode:extendEncode(encode,entries,Skip),marks:[symbols,labels],name:name,interactive:interactive,sort:sort})}const isL='item.orient === "left"',isR='item.orient === "right"',isLR=`(${isL} || ${isR})`,isVG="datum.vgrad && "+isLR,baseline=anchorExpr('"top"','"bottom"','"middle"'),alignFlip=anchorExpr('"right"','"left"','"center"'),exprAlign=`datum.vgrad && ${isR} ? (${alignFlip}) : (${isLR} && !(datum.vgrad && ${isL})) ? "left" : ${alignExpr}`,exprAnchor=`item._anchor || (${isLR} ? "middle" : "start")`,exprAngle=`${isVG} ? (${isL} ? -90 : 90) : 0`,exprBaseline=`${isLR} ? (datum.vgrad ? (${isR} ? "bottom" : "top") : ${baseline}) : "top"`;function clip(clip,scope){let expr;return vegaUtil.isObject(clip)&&(clip.signal?expr=clip.signal:clip.path?expr="pathShape("+param(clip.path)+")":clip.sphere&&(expr="geoShape("+param(clip.sphere)+', {type: "Sphere"})')),expr?scope.signalRef(expr):!!clip}function param(value){return vegaUtil.isObject(value)&&value.signal?value.signal:vegaUtil.stringValue(value)}function getRole(spec){const role=spec.role||"";return role.indexOf("axis")&&role.indexOf("legend")&&role.indexOf("title")?"group"===spec.type?"scope":role||"mark":role}function definition(spec){return{marktype:spec.type,name:spec.name||void 0,role:spec.role||getRole(spec),zindex:+spec.zindex||void 0,aria:spec.aria,description:spec.description}}function interactive(spec,scope){return spec&&spec.signal?scope.signalRef(spec.signal):!1!==spec}function parseTransform(spec,scope){const def=vegaDataflow.definition(spec.type);def||vegaUtil.error("Unrecognized transform type: "+vegaUtil.stringValue(spec.type));const t=entry$1(def.type.toLowerCase(),null,parseParameters(def,spec,scope));return spec.signal&&scope.addSignal(spec.signal,scope.proxy(t)),t.metadata=def.metadata||{},t}function parseParameters(def,spec,scope){const params={},n=def.params.length;for(let i=0;i<n;++i){const pdef=def.params[i];params[pdef.name]=parseParameter$1(pdef,spec,scope)}return params}function parseParameter$1(def,spec,scope){const type=def.type,value=spec[def.name];return"index"===type?function(def,spec,scope){return vegaUtil.isString(spec.from)||vegaUtil.error('Lookup "from" parameter must be a string literal.'),scope.getData(spec.from).lookupRef(scope,spec.key)}(0,spec,scope):void 0!==value?"param"===type?function(def,spec,scope){const value=spec[def.name];return def.array?(vegaUtil.isArray(value)||vegaUtil.error("Expected an array of sub-parameters. Instead: "+vegaUtil.stringValue(value)),value.map(v=>parseSubParameter(def,v,scope))):parseSubParameter(def,value,scope)}(def,spec,scope):"projection"===type?scope.projectionRef(spec[def.name]):def.array&&!isSignal(value)?value.map(v=>parameterValue(def,v,scope)):parameterValue(def,value,scope):void(def.required&&vegaUtil.error("Missing required "+vegaUtil.stringValue(spec.type)+" parameter: "+vegaUtil.stringValue(def.name)))}function parameterValue(def,value,scope){const type=def.type;if(isSignal(value))return isExpr$1(type)?vegaUtil.error("Expression references can not be signals."):isField(type)?scope.fieldRef(value):isCompare(type)?scope.compareRef(value):scope.signalRef(value.signal);{const expr=def.expr||isField(type);return expr&&outerExpr(value)?scope.exprRef(value.expr,value.as):expr&&outerField(value)?fieldRef(value.field,value.as):isExpr$1(type)?vegaFunctions.parseExpression(value,scope):isData(type)?ref(scope.getData(value).values):isField(type)?fieldRef(value):isCompare(type)?scope.compareRef(value):value}}function parseSubParameter(def,value,scope){const n=def.params.length;let pdef;for(let i=0;i<n;++i){pdef=def.params[i];for(const k in pdef.key)if(pdef.key[k]!==value[k]){pdef=null;break}if(pdef)break}pdef||vegaUtil.error("Unsupported parameter: "+vegaUtil.stringValue(value));const params=vegaUtil.extend(parseParameters(pdef,value,scope),pdef.key);return ref(scope.add(Params(params)))}const outerExpr=_=>_&&_.expr,outerField=_=>_&&_.field,isData=_=>"data"===_,isExpr$1=_=>"expr"===_,isField=_=>"field"===_,isCompare=_=>"compare"===_;function getDataRef(from,scope){return from.$ref?from:from.data&&from.data.$ref?from.data:ref(scope.getData(from.data).output)}function DataScope(scope,input,output,values,aggr){this.scope=scope,this.input=input,this.output=output,this.values=values,this.aggregate=aggr,this.index={}}function fieldKey(field){return vegaUtil.isString(field)?field:null}function addSortField(scope,p,sort){const as=aggrField(sort.op,sort.field);let s;if(p.ops){for(let i=0,n=p.as.length;i<n;++i)if(p.as[i]===as)return}else p.ops=["count"],p.fields=[null],p.as=["count"];sort.op&&(p.ops.push((s=sort.op.signal)?scope.signalRef(s):sort.op),p.fields.push(scope.fieldRef(sort.field)),p.as.push(as))}function cache(scope,ds,name,optype,field,counts,index){const cache=ds[name]||(ds[name]={}),sort=function(sort){return vegaUtil.isObject(sort)?("descending"===sort.order?"-":"+")+aggrField(sort.op,sort.field):""}(counts);let v,op,k=fieldKey(field);if(null!=k&&(scope=ds.scope,k+=sort?"|"+sort:"",v=cache[k]),!v){const params=counts?{field:keyFieldRef,pulse:ds.countsRef(scope,field,counts)}:{field:scope.fieldRef(field),pulse:ref(ds.output)};sort&&(params.sort=scope.sortRef(counts)),op=scope.add(entry$1(optype,void 0,params)),index&&(ds.index[field]=op),v=ref(op),null!=k&&(cache[k]=v)}return v}function parseTrigger(spec,scope,name){const remove=spec.remove,insert=spec.insert,toggle=spec.toggle,modify=spec.modify,values=spec.values,op=scope.add(operator()),update="if("+spec.trigger+',modify("'+name+'",'+[insert,remove,toggle,modify,values].map(_=>null==_?"null":_).join(",")+"),0)",expr=vegaFunctions.parseExpression(update,scope);op.update=expr.$expr,op.params=expr.$params}function parseMark(spec,scope){const role=getRole(spec),group="group"===spec.type,facet=spec.from&&spec.from.facet,overlap=spec.overlap;let ops,op,store,enc,name,layoutRef,boundRef,layout=spec.layout||"scope"===role||"frame"===role;const nested="mark"===role||layout||facet,input=function(from,group,scope){let facet,key,op,dataRef,parent;return from?(facet=from.facet)&&(group||vegaUtil.error("Only group marks can be faceted."),null!=facet.field?dataRef=parent=getDataRef(facet,scope):(from.data?parent=ref(scope.getData(from.data).aggregate):(op=parseTransform(vegaUtil.extend({type:"aggregate",groupby:vegaUtil.array(facet.groupby)},facet.aggregate),scope),op.params.key=scope.keyRef(facet.groupby),op.params.pulse=getDataRef(facet,scope),dataRef=parent=ref(scope.add(op))),key=scope.keyRef(facet.groupby,!0))):dataRef=ref(scope.add(Collect(null,[{}]))),dataRef||(dataRef=getDataRef(from,scope)),{key:key,pulse:dataRef,parent:parent}}(spec.from,group,scope);op=scope.add(DataJoin({key:input.key||(spec.key?fieldRef(spec.key):void 0),pulse:input.pulse,clean:!group}));const joinRef=ref(op);op=store=scope.add(Collect({pulse:joinRef})),op=scope.add(Mark({markdef:definition(spec),interactive:interactive(spec.interactive,scope),clip:clip(spec.clip,scope),context:{$context:!0},groups:scope.lookup(),parent:scope.signals.parent?scope.signalRef("parent"):null,index:scope.markpath(),pulse:ref(op)}));const markRef=ref(op);op=enc=scope.add(Encode(parseEncode(spec.encode,spec.type,role,spec.style,scope,{mod:!1,pulse:markRef}))),op.params.parent=scope.encode(),spec.transform&&spec.transform.forEach(_=>{const tx=parseTransform(_,scope),md=tx.metadata;(md.generates||md.changes)&&vegaUtil.error("Mark transforms should not generate new data."),md.nomod||(enc.params.mod=!0),tx.params.pulse=ref(op),scope.add(op=tx)}),spec.sort&&(op=scope.add(SortItems({sort:scope.compareRef(spec.sort),pulse:ref(op)})));const encodeRef=ref(op);(facet||layout)&&(layout=scope.add(ViewLayout({layout:scope.objectProperty(spec.layout),legends:scope.legends,mark:markRef,pulse:encodeRef})),layoutRef=ref(layout));const bound=scope.add(Bound({mark:markRef,pulse:layoutRef||encodeRef}));boundRef=ref(bound),group&&(nested&&(ops=scope.operators,ops.pop(),layout&&ops.pop()),scope.pushState(encodeRef,layoutRef||boundRef,joinRef),facet?function(spec,scope,group){const facet=spec.from.facet,name=facet.name,data=getDataRef(facet,scope);let op;facet.name||vegaUtil.error("Facet must have a name: "+vegaUtil.stringValue(facet)),facet.data||vegaUtil.error("Facet must reference a data set: "+vegaUtil.stringValue(facet)),facet.field?op=scope.add(PreFacet({field:scope.fieldRef(facet.field),pulse:data})):facet.groupby?op=scope.add(Facet({key:scope.keyRef(facet.groupby),group:ref(scope.proxy(group.parent)),pulse:data})):vegaUtil.error("Facet must specify groupby or field: "+vegaUtil.stringValue(facet));const subscope=scope.fork(),source=subscope.add(Collect()),values=subscope.add(Sieve({pulse:ref(source)}));subscope.addData(name,new DataScope(subscope,source,source,values)),subscope.addSignal("parent",null),op.params.subflow={$subflow:subscope.parse(spec).toRuntime()}}(spec,scope,input):nested?function(spec,scope,input){const op=scope.add(PreFacet({pulse:input.pulse})),subscope=scope.fork();subscope.add(Sieve()),subscope.addSignal("parent",null),op.params.subflow={$subflow:subscope.parse(spec).toRuntime()}}(spec,scope,input):scope.parse(spec),scope.popState(),nested&&(layout&&ops.push(layout),ops.push(bound))),overlap&&(boundRef=function(overlap,source,scope){const method=overlap.method,bound=overlap.bound,sep=overlap.separation,params={separation:isSignal(sep)?scope.signalRef(sep.signal):sep,method:isSignal(method)?scope.signalRef(method.signal):method,pulse:source};if(overlap.order&&(params.sort=scope.compareRef({field:overlap.order})),bound){const tol=bound.tolerance;params.boundTolerance=isSignal(tol)?scope.signalRef(tol.signal):+tol,params.boundScale=scope.scaleRef(bound.scale),params.boundOrient=bound.orient}return ref(scope.add(Overlap(params)))}(overlap,boundRef,scope));const render=scope.add(Render({pulse:boundRef})),sieve=scope.add(Sieve({pulse:ref(render)},void 0,scope.parent()));null!=spec.name&&(name=spec.name,scope.addData(name,new DataScope(scope,store,render,sieve)),spec.on&&spec.on.forEach(on=>{(on.insert||on.remove||on.toggle)&&vegaUtil.error("Marks only support modify triggers."),parseTrigger(on,scope,name)}))}function parseLegend(spec,scope){const config=scope.config.legend,encode=spec.encode||{},_=lookup(spec,config),legendEncode=encode.legend||{},name=legendEncode.name||void 0,interactive=legendEncode.interactive,style=legendEncode.style,scales={};let entryLayout,params,children,scale=0;LegendScales.forEach(s=>spec[s]?(scales[s]=spec[s],scale=scale||spec[s]):0),scale||vegaUtil.error("Missing valid scale for legend.");const type=function(spec,scaleType){let type=spec.type||"symbol";return spec.type||1!==function(spec){return LegendScales.reduce((count,type)=>count+(spec[type]?1:0),0)}(spec)||!spec.fill&&!spec.stroke||(type=vegaScale.isContinuous(scaleType)?"gradient":vegaScale.isDiscretizing(scaleType)?"discrete":"symbol"),"gradient"!==type?type:vegaScale.isDiscretizing(scaleType)?"discrete":"gradient"}(spec,scope.scaleType(scale)),datum={title:null!=spec.title,scales:scales,type:type,vgrad:"symbol"!==type&&_.isVertical()},dataRef=ref(scope.add(Collect(null,[datum]))),entryRef=ref(scope.add(LegendEntries(params={type:type,scale:scope.scaleRef(scale),count:scope.objectProperty(_("tickCount")),limit:scope.property(_("symbolLimit")),values:scope.objectProperty(spec.values),minstep:scope.property(spec.tickMinStep),formatType:scope.property(spec.formatType),formatSpecifier:scope.property(spec.format)})));return"gradient"===type?(children=[legendGradient(spec,scale,config,encode.gradient),legendGradientLabels(spec,config,encode.labels,entryRef)],params.count=params.count||scope.signalRef(`max(2,2*floor((${deref(_.gradientLength())})/100))`)):"discrete"===type?children=[legendGradientDiscrete(spec,scale,config,encode.gradient,entryRef),legendGradientLabels(spec,config,encode.labels,entryRef)]:(entryLayout=function(spec,config){const _=lookup(spec,config);return{align:_("gridAlign"),columns:_.entryColumns(),center:{row:!0,column:!1},padding:{row:_("rowPadding"),column:_("columnPadding")}}}(spec,config),children=[legendSymbolGroups(spec,config,encode,entryRef,deref(entryLayout.columns))],params.size=function(spec,scope,marks){const size=deref(getChannel("size",spec,marks)),strokeWidth=deref(getChannel("strokeWidth",spec,marks)),fontSize=deref(function(encode,scope,style){return getEncoding("fontSize",encode)||function(name,scope,style){const s=scope.config.style[style];return s&&s[name]}("fontSize",scope,style)}(marks[1].encode,scope,"guide-label"));return vegaFunctions.parseExpression(`max(ceil(sqrt(${size})+${strokeWidth}),${fontSize})`,scope)}(spec,scope,children[0].marks)),children=[guideGroup({role:"legend-entry",from:dataRef,encode:{enter:{x:{value:0},y:{value:0}}},marks:children,layout:entryLayout,interactive:interactive})],datum.title&&children.push(function(spec,config,userEncode,dataRef){const _=lookup(spec,config),encode={enter:{opacity:zero},update:{opacity:one,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:zero}};return addEncoders(encode,{orient:_("titleOrient"),_anchor:_("titleAnchor"),anchor:{signal:exprAnchor},angle:{signal:exprAngle},align:{signal:exprAlign},baseline:{signal:exprBaseline},text:spec.title,fill:_("titleColor"),fillOpacity:_("titleOpacity"),font:_("titleFont"),fontSize:_("titleFontSize"),fontStyle:_("titleFontStyle"),fontWeight:_("titleFontWeight"),limit:_("titleLimit"),lineHeight:_("titleLineHeight")},{align:_("titleAlign"),baseline:_("titleBaseline")}),guideMark({type:"text",role:"legend-title",style:"guide-title",from:dataRef,encode:encode},userEncode)}(spec,config,encode.title,dataRef)),parseMark(guideGroup({role:"legend",from:dataRef,encode:extendEncode(buildLegendEncode(_,spec,config),legendEncode,Skip),marks:children,aria:_("aria"),description:_("description"),zindex:_("zindex"),name:name,interactive:interactive,style:style}),scope)}function buildLegendEncode(_,spec,config){const encode={enter:{},update:{}};return addEncoders(encode,{orient:_("orient"),offset:_("offset"),padding:_("padding"),titlePadding:_("titlePadding"),cornerRadius:_("cornerRadius"),fill:_("fillColor"),stroke:_("strokeColor"),strokeWidth:config.strokeWidth,strokeDash:config.strokeDash,x:_("legendX"),y:_("legendY"),format:spec.format,formatType:spec.formatType}),encode}function getChannel(name,spec,marks){return spec[name]?`scale("${spec[name]}",datum)`:getEncoding(name,marks[0].encode)}function parseTitle(spec,scope){const _=lookup(spec=vegaUtil.isString(spec)?{text:spec}:spec,scope.config.title),encode=spec.encode||{},userEncode=encode.group||{},name=userEncode.name||void 0,interactive=userEncode.interactive,style=userEncode.style,children=[],dataRef=ref(scope.add(Collect(null,[{}])));return children.push(function(spec,_,userEncode,dataRef){const zero={value:0},text=spec.text,encode={enter:{opacity:zero},update:{opacity:{value:1}},exit:{opacity:zero}};return addEncoders(encode,{text:text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:_("dx"),dy:_("dy"),fill:_("color"),font:_("font"),fontSize:_("fontSize"),fontStyle:_("fontStyle"),fontWeight:_("fontWeight"),lineHeight:_("lineHeight")},{align:_("align"),angle:_("angle"),baseline:_("baseline")}),guideMark({type:"text",role:"title-text",style:"group-title",from:dataRef,encode:encode},userEncode)}(spec,_,function(spec){const encode=spec.encode;return encode&&encode.title||vegaUtil.extend({name:spec.name,interactive:spec.interactive,style:spec.style},encode)}(spec),dataRef)),spec.subtitle&&children.push(function(spec,_,userEncode,dataRef){const zero={value:0},text=spec.subtitle,encode={enter:{opacity:zero},update:{opacity:{value:1}},exit:{opacity:zero}};return addEncoders(encode,{text:text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:_("dx"),dy:_("dy"),fill:_("subtitleColor"),font:_("subtitleFont"),fontSize:_("subtitleFontSize"),fontStyle:_("subtitleFontStyle"),fontWeight:_("subtitleFontWeight"),lineHeight:_("subtitleLineHeight")},{align:_("align"),angle:_("angle"),baseline:_("baseline")}),guideMark({type:"text",role:"title-subtitle",style:"group-subtitle",from:dataRef,encode:encode},userEncode)}(spec,_,encode.subtitle,dataRef)),parseMark(guideGroup({role:"title",from:dataRef,encode:groupEncode(_,userEncode),marks:children,aria:_("aria"),description:_("description"),zindex:_("zindex"),name:name,interactive:interactive,style:style}),scope)}function groupEncode(_,userEncode){const encode={enter:{},update:{}};return addEncoders(encode,{orient:_("orient"),anchor:_("anchor"),align:{signal:alignExpr},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:_("limit"),frame:_("frame"),offset:_("offset")||0,padding:_("subtitlePadding")}),extendEncode(encode,userEncode,Skip)}function parseData$1(data,scope){const transforms=[];data.transform&&data.transform.forEach(tx=>{transforms.push(parseTransform(tx,scope))}),data.on&&data.on.forEach(on=>{parseTrigger(on,scope,data.name)}),scope.addDataPipeline(data.name,function(data,scope,ops){const output=[];let upstream,i,n,t,m,source=null,modify=!1,generate=!1;for(data.values?isSignal(data.values)||hasSignal(data.format)?(output.push(load(scope,data)),output.push(source=collect())):output.push(source=collect({$ingest:data.values,$format:data.format})):data.url?hasSignal(data.url)||hasSignal(data.format)?(output.push(load(scope,data)),output.push(source=collect())):output.push(source=collect({$request:data.url,$format:data.format})):data.source&&(source=upstream=vegaUtil.array(data.source).map(d=>ref(scope.getData(d).output)),output.push(null)),i=0,n=ops.length;i<n;++i)t=ops[i],m=t.metadata,source||m.source||output.push(source=collect()),output.push(t),m.generates&&(generate=!0),m.modifies&&!generate&&(modify=!0),m.source?source=t:m.changes&&(source=null);return upstream&&(n=upstream.length-1,output[0]=Relay({derive:modify,pulse:n?upstream:upstream[0]}),(modify||n)&&output.splice(1,0,collect())),source||output.push(collect()),output.push(Sieve({})),output}(data,scope,transforms))}function collect(values){const s=Collect({},values);return s.metadata={source:!0},s}function load(scope,data){return Load({url:data.url?scope.property(data.url):void 0,async:data.async?scope.property(data.async):void 0,values:data.values?scope.property(data.values):void 0,format:scope.objectProperty(data.format)})}DataScope.fromEntries=function(scope,entries){const n=entries.length,values=entries[n-1],output=entries[n-2];let input=entries[0],aggr=null,i=1;for(input&&"load"===input.type&&(input=entries[1]),scope.add(entries[0]);i<n;++i)entries[i].params.pulse=ref(entries[i-1]),scope.add(entries[i]),"aggregate"===entries[i].type&&(aggr=entries[i]);return new DataScope(scope,input,output,values,aggr)},DataScope.prototype={countsRef(scope,field,sort){const ds=this,cache=ds.counts||(ds.counts={}),k=fieldKey(field);let v,a,p;return null!=k&&(scope=ds.scope,v=cache[k]),v?sort&&sort.field&&addSortField(scope,v.agg.params,sort):(p={groupby:scope.fieldRef(field,"key"),pulse:ref(ds.output)},sort&&sort.field&&addSortField(scope,p,sort),a=scope.add(Aggregate(p)),v=scope.add(Collect({pulse:ref(a)})),v={agg:a,ref:ref(v)},null!=k&&(cache[k]=v)),v.ref},tuplesRef(){return ref(this.values)},extentRef(scope,field){return cache(scope,this,"extent","extent",field,!1)},domainRef(scope,field){return cache(scope,this,"domain","values",field,!1)},valuesRef(scope,field,sort){return cache(scope,this,"vals","values",field,sort||!0)},lookupRef(scope,field){return cache(scope,this,"lookup","tupleindex",field,!1)},indataRef(scope,field){return cache(scope,this,"indata","tupleindex",field,!0,!0)}};const isX=orient=>"bottom"===orient||orient===Top,getSign=(orient,a,b)=>isSignal(orient)?ifLeftTopExpr(orient.signal,a,b):"left"===orient||orient===Top?a:b,ifX=(orient,a,b)=>isSignal(orient)?ifXEnc(orient.signal,a,b):isX(orient)?a:b,ifY=(orient,a,b)=>isSignal(orient)?ifYEnc(orient.signal,a,b):isX(orient)?b:a,ifTop=(orient,a,b)=>isSignal(orient)?ifTopExpr(orient.signal,a,b):orient===Top?{value:a}:{value:b},ifXEnc=($orient,a,b)=>ifEnc(`${$orient} === 'top' || ${$orient} === 'bottom'`,a,b),ifYEnc=($orient,a,b)=>ifEnc(`${$orient} !== 'top' && ${$orient} !== 'bottom'`,a,b),ifLeftTopExpr=($orient,a,b)=>ifExpr(`${$orient} === 'left' || ${$orient} === 'top'`,a,b),ifTopExpr=($orient,a,b)=>ifExpr($orient+" === 'top'",a,b),ifRightExpr=($orient,a,b)=>ifExpr($orient+" === 'right'",a,b),ifEnc=(test,a,b)=>(a=null!=a?encoder(a):a,b=null!=b?encoder(b):b,isSimple(a)&&isSimple(b)?{signal:`${test} ? (${a=a?a.signal||vegaUtil.stringValue(a.value):null}) : (${b=b?b.signal||vegaUtil.stringValue(b.value):null})`}:[vegaUtil.extend({test:test},a)].concat(b||[])),isSimple=enc=>null==enc||1===Object.keys(enc).length,ifExpr=(test,a,b)=>({signal:`${test} ? (${toExpr(a)}) : (${toExpr(b)})`}),toExpr=v=>isSignal(v)?v.signal:null==v?null:vegaUtil.stringValue(v),patch=(value,base)=>{const s=value.signal;return s&&s.endsWith("(null)")?{signal:s.slice(0,-6)+base.signal}:value};function fallback(prop,config,axisConfig,style){let styleProp;if(config&&vegaUtil.hasOwnProperty(config,prop))return config[prop];if(vegaUtil.hasOwnProperty(axisConfig,prop))return axisConfig[prop];if(prop.startsWith("title")){switch(prop){case"titleColor":styleProp="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":styleProp=prop[5].toLowerCase()+prop.slice(6)}return style["guide-title"][styleProp]}if(prop.startsWith("label")){switch(prop){case"labelColor":styleProp="fill";break;case"labelFont":case"labelFontSize":styleProp=prop[5].toLowerCase()+prop.slice(6)}return style["guide-label"][styleProp]}return null}function keys(objects){const map={};for(const obj of objects)if(obj)for(const key in obj)map[key]=1;return Object.keys(map)}function position(spec,pos){return{scale:spec.scale,range:pos}}function axisGrid(spec,config,userEncode,dataRef,band){const _=lookup(spec,config),orient=spec.orient,vscale=spec.gridScale,sign=getSign(orient,1,-1),offset=function(offset,sign){if(1===sign);else if(vegaUtil.isObject(offset)){let entry=offset=vegaUtil.extend({},offset);for(;null!=entry.mult;){if(!vegaUtil.isObject(entry.mult))return entry.mult=isSignal(sign)?{signal:`(${entry.mult}) * (${sign.signal})`}:entry.mult*sign,offset;entry=entry.mult=vegaUtil.extend({},entry.mult)}entry.mult=sign}else offset=isSignal(sign)?{signal:`(${sign.signal}) * (${offset||0})`}:sign*(offset||0);return offset}(spec.offset,sign);let enter,exit,update;const encode={enter:enter={opacity:zero},update:update={opacity:one},exit:exit={opacity:zero}};addEncoders(encode,{stroke:_("gridColor"),strokeCap:_("gridCap"),strokeDash:_("gridDash"),strokeDashOffset:_("gridDashOffset"),strokeOpacity:_("gridOpacity"),strokeWidth:_("gridWidth")});const tickPos={scale:spec.scale,field:Value,band:band.band,extra:band.extra,offset:band.offset,round:_("tickRound")},sz=ifX(orient,{signal:"height"},{signal:"width"}),gridStart=vscale?{scale:vscale,range:0,mult:sign,offset:offset}:{value:0,offset:offset},gridEnd=vscale?{scale:vscale,range:1,mult:sign,offset:offset}:vegaUtil.extend(sz,{mult:sign,offset:offset});return enter.x=update.x=ifX(orient,tickPos,gridStart),enter.y=update.y=ifY(orient,tickPos,gridStart),enter.x2=update.x2=ifY(orient,gridEnd),enter.y2=update.y2=ifX(orient,gridEnd),exit.x=ifX(orient,tickPos),exit.y=ifY(orient,tickPos),guideMark({type:"rule",role:"axis-grid",key:Value,from:dataRef,encode:encode},userEncode)}function flushExpr(scale,threshold,a,b,c){return{signal:'flush(range("'+scale+'"), scale("'+scale+'", datum.value), '+threshold+","+a+","+b+","+c+")"}}function axisLabels(spec,config,userEncode,dataRef,size,band){const _=lookup(spec,config),orient=spec.orient,scale=spec.scale,sign=getSign(orient,-1,1),flush=deref(_("labelFlush")),flushOffset=deref(_("labelFlushOffset")),labelAlign=_("labelAlign"),labelBaseline=_("labelBaseline");let update,flushOn=0===flush||!!flush;const tickSize=encoder(size);tickSize.mult=sign,tickSize.offset=encoder(_("labelPadding")||0),tickSize.offset.mult=sign;const tickPos={scale:scale,field:Value,band:.5,offset:extendOffset(band.offset,_("labelOffset"))},align=ifX(orient,flushOn?flushExpr(scale,flush,'"left"','"right"','"center"'):{value:"center"},((orient,a,b)=>isSignal(orient)?ifRightExpr(orient.signal,a,b):"right"===orient?{value:a}:{value:b})(orient,"left","right")),baseline=ifX(orient,ifTop(orient,"bottom","top"),flushOn?flushExpr(scale,flush,'"top"','"bottom"','"middle"'):{value:"middle"}),offsetExpr=flushExpr(scale,flush,`-(${flushOffset})`,flushOffset,0);flushOn=flushOn&&flushOffset;const enter={opacity:zero,x:ifX(orient,tickPos,tickSize),y:ifY(orient,tickPos,tickSize)},encode={enter:enter,update:update={opacity:one,text:{field:"label"},x:enter.x,y:enter.y,align:align,baseline:baseline},exit:{opacity:zero,x:enter.x,y:enter.y}};addEncoders(encode,{dx:!labelAlign&&flushOn?ifX(orient,offsetExpr):null,dy:!labelBaseline&&flushOn?ifY(orient,offsetExpr):null}),addEncoders(encode,{angle:_("labelAngle"),fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontWeight:_("labelFontWeight"),fontStyle:_("labelFontStyle"),limit:_("labelLimit"),lineHeight:_("labelLineHeight")},{align:labelAlign,baseline:labelBaseline});const bound=_("labelBound");let overlap=_("labelOverlap");return overlap=overlap||bound?{separation:_("labelSeparation"),method:overlap,order:"datum.index",bound:bound?{scale:scale,orient:orient,tolerance:bound}:null}:void 0,update.align!==align&&(update.align=patch(update.align,align)),update.baseline!==baseline&&(update.baseline=patch(update.baseline,baseline)),guideMark({type:"text",role:"axis-label",style:"guide-label",key:Value,from:dataRef,encode:encode,overlap:overlap},userEncode)}function axisTitle(spec,config,userEncode,dataRef){const _=lookup(spec,config),orient=spec.orient,sign=getSign(orient,-1,1);let enter,update;const encode={enter:enter={opacity:zero,anchor:encoder(_("titleAnchor",null)),align:{signal:alignExpr}},update:update=vegaUtil.extend({},enter,{opacity:one,text:encoder(spec.title)}),exit:{opacity:zero}},titlePos={signal:`lerp(range("${spec.scale}"), ${anchorExpr(0,1,.5)})`};return update.x=ifX(orient,titlePos),update.y=ifY(orient,titlePos),enter.angle=ifX(orient,zero,((sign,value)=>0===value?0:isSignal(sign)?{signal:`(${sign.signal}) * ${value}`}:{value:sign*value})(sign,90)),enter.baseline=ifX(orient,ifTop(orient,"bottom",Top),{value:"bottom"}),update.angle=enter.angle,update.baseline=enter.baseline,addEncoders(encode,{fill:_("titleColor"),fillOpacity:_("titleOpacity"),font:_("titleFont"),fontSize:_("titleFontSize"),fontStyle:_("titleFontStyle"),fontWeight:_("titleFontWeight"),limit:_("titleLimit"),lineHeight:_("titleLineHeight")},{align:_("titleAlign"),angle:_("titleAngle"),baseline:_("titleBaseline")}),function(_,orient,encode,userEncode){const auto=(value,dim)=>null!=value?(encode.update[dim]=patch(encoder(value),encode.update[dim]),!1):!has(dim,userEncode),autoY=auto(_("titleX"),"x"),autoX=auto(_("titleY"),"y");encode.enter.auto=autoX===autoY?encoder(autoX):ifX(orient,encoder(autoX),encoder(autoY))}(_,orient,encode,userEncode),encode.update.align=patch(encode.update.align,enter.align),encode.update.angle=patch(encode.update.angle,enter.angle),encode.update.baseline=patch(encode.update.baseline,enter.baseline),guideMark({type:"text",role:"axis-title",style:"guide-title",from:dataRef,encode:encode},userEncode)}function parseAxis(spec,scope){const config=function(spec,scope){var xy,or,key,$orient,t,b,l,r,config=scope.config,style=config.style,axis=config.axis,band="band"===scope.scaleType(spec.scale)&&config.axisBand,orient=spec.orient;if(isSignal(orient)){const xyKeys=keys([config.axisX,config.axisY]),orientKeys=keys([config.axisTop,config.axisBottom,config.axisLeft,config.axisRight]);for(key of(xy={},xyKeys))xy[key]=ifX(orient,fallback(key,config.axisX,axis,style),fallback(key,config.axisY,axis,style));for(key of(or={},orientKeys))or[key]=($orient=orient.signal,t=fallback(key,config.axisTop,axis,style),b=fallback(key,config.axisBottom,axis,style),l=fallback(key,config.axisLeft,axis,style),r=fallback(key,config.axisRight,axis,style),{signal:(null!=l?`${$orient} === 'left' ? (${toExpr(l)}) : `:"")+(null!=b?`${$orient} === 'bottom' ? (${toExpr(b)}) : `:"")+(null!=r?`${$orient} === 'right' ? (${toExpr(r)}) : `:"")+(null!=t?`${$orient} === 'top' ? (${toExpr(t)}) : `:"")+"(null)"})}else xy=orient===Top||"bottom"===orient?config.axisX:config.axisY,or=config["axis"+orient[0].toUpperCase()+orient.slice(1)];return xy||or||band?vegaUtil.extend({},axis,xy,or,band):axis}(spec,scope),encode=spec.encode||{},axisEncode=encode.axis||{},name=axisEncode.name||void 0,interactive=axisEncode.interactive,style=axisEncode.style,_=lookup(spec,config),band=function(_){const v=_("tickBand");let band,extra,offset=_("tickOffset");return v?v.signal?(band={signal:`(${v.signal}) === 'extent' ? 1 : 0.5`},extra={signal:`(${v.signal}) === 'extent'`},vegaUtil.isObject(offset)||(offset={signal:`(${v.signal}) === 'extent' ? 0 : ${offset}`})):"extent"===v?(band=1,extra=!0,offset=0):(band=.5,extra=!1):(band=_("bandPosition"),extra=_("tickExtra")),{extra:extra,band:band,offset:offset}}(_),datum={scale:spec.scale,ticks:!!_("ticks"),labels:!!_("labels"),grid:!!_("grid"),domain:!!_("domain"),title:null!=spec.title},dataRef=ref(scope.add(Collect({},[datum]))),ticksRef=ref(scope.add(AxisTicks({scale:scope.scaleRef(spec.scale),extra:scope.property(band.extra),count:scope.objectProperty(spec.tickCount),values:scope.objectProperty(spec.values),minstep:scope.property(spec.tickMinStep),formatType:scope.property(spec.formatType),formatSpecifier:scope.property(spec.format)}))),children=[];let size;return datum.grid&&children.push(axisGrid(spec,config,encode.grid,ticksRef,band)),datum.ticks&&(size=_("tickSize"),children.push(function(spec,config,userEncode,dataRef,size,band){const _=lookup(spec,config),orient=spec.orient,sign=getSign(orient,-1,1);let enter,exit,update;const encode={enter:enter={opacity:zero},update:update={opacity:one},exit:exit={opacity:zero}};addEncoders(encode,{stroke:_("tickColor"),strokeCap:_("tickCap"),strokeDash:_("tickDash"),strokeDashOffset:_("tickDashOffset"),strokeOpacity:_("tickOpacity"),strokeWidth:_("tickWidth")});const tickSize=encoder(size);tickSize.mult=sign;const tickPos={scale:spec.scale,field:Value,band:band.band,extra:band.extra,offset:band.offset,round:_("tickRound")};return update.y=enter.y=ifX(orient,zero,tickPos),update.y2=enter.y2=ifX(orient,tickSize),exit.x=ifX(orient,tickPos),update.x=enter.x=ifY(orient,zero,tickPos),update.x2=enter.x2=ifY(orient,tickSize),exit.y=ifY(orient,tickPos),guideMark({type:"rule",role:"axis-tick",key:Value,from:dataRef,encode:encode},userEncode)}(spec,config,encode.ticks,ticksRef,size,band))),datum.labels&&(size=datum.ticks?size:0,children.push(axisLabels(spec,config,encode.labels,ticksRef,size,band))),datum.domain&&children.push(function(spec,config,userEncode,dataRef){const _=lookup(spec,config),orient=spec.orient;let enter,update;const encode={enter:enter={opacity:zero},update:update={opacity:one},exit:{opacity:zero}};addEncoders(encode,{stroke:_("domainColor"),strokeCap:_("domainCap"),strokeDash:_("domainDash"),strokeDashOffset:_("domainDashOffset"),strokeWidth:_("domainWidth"),strokeOpacity:_("domainOpacity")});const pos0=position(spec,0),pos1=position(spec,1);return enter.x=update.x=ifX(orient,pos0,zero),enter.x2=update.x2=ifX(orient,pos1),enter.y=update.y=ifY(orient,pos0,zero),enter.y2=update.y2=ifY(orient,pos1),guideMark({type:"rule",role:"axis-domain",from:dataRef,encode:encode},userEncode)}(spec,config,encode.domain,dataRef)),datum.title&&children.push(axisTitle(spec,config,encode.title,dataRef)),parseMark(guideGroup({role:"axis",from:dataRef,encode:extendEncode(buildAxisEncode(_,spec),axisEncode,Skip),marks:children,aria:_("aria"),description:_("description"),zindex:_("zindex"),name:name,interactive:interactive,style:style}),scope)}function buildAxisEncode(_,spec){const encode={enter:{},update:{}};return addEncoders(encode,{orient:_("orient"),offset:_("offset")||0,position:value(spec.position,0),titlePadding:_("titlePadding"),minExtent:_("minExtent"),maxExtent:_("maxExtent"),range:{signal:`abs(span(range("${spec.scale}")))`},translate:_("translate"),format:spec.format,formatType:spec.formatType}),encode}function parseScope(spec,scope,preprocessed){const signals=vegaUtil.array(spec.signals),scales=vegaUtil.array(spec.scales);return preprocessed||signals.forEach(_=>parseSignal(_,scope)),vegaUtil.array(spec.projections).forEach(_=>function(proj,scope){const config=scope.config.projection||{},params={};for(const name in proj)"name"!==name&&(params[name]=parseParameter(proj[name],name,scope));for(const name in config)null==params[name]&&(params[name]=parseParameter(config[name],name,scope));scope.addProjection(proj.name,params)}(_,scope)),scales.forEach(_=>function(spec,scope){const type=spec.type||"linear";vegaScale.isValidScaleType(type)||vegaUtil.error("Unrecognized scale type: "+vegaUtil.stringValue(type)),scope.addScale(spec.name,{type:type,domain:void 0})}(_,scope)),vegaUtil.array(spec.data).forEach(_=>parseData$1(_,scope)),scales.forEach(_=>parseScale(_,scope)),(preprocessed||signals).forEach(_=>parseSignalUpdates(_,scope)),vegaUtil.array(spec.axes).forEach(_=>parseAxis(_,scope)),vegaUtil.array(spec.marks).forEach(_=>parseMark(_,scope)),vegaUtil.array(spec.legends).forEach(_=>parseLegend(_,scope)),spec.title&&parseTitle(spec.title,scope),scope.parseLambdas(),scope}function parseView(spec,scope){const config=scope.config,root=ref(scope.root=scope.add(operator())),signals=function(spec,config){const _=name=>value(spec[name],config[name]),signals=[signalObject("background",_("background")),signalObject("autosize",parseAutosize(_("autosize"))),signalObject("padding",parsePadding(_("padding"))),signalObject("width",_("width")||0),signalObject("height",_("height")||0)],pre=signals.reduce((p,s)=>(p[s.name]=s,p),{}),map={};return vegaUtil.array(spec.signals).forEach(s=>{vegaUtil.hasOwnProperty(pre,s.name)?s=vegaUtil.extend(pre[s.name],s):signals.push(s),map[s.name]=s}),vegaUtil.array(config.signals).forEach(s=>{vegaUtil.hasOwnProperty(map,s.name)||vegaUtil.hasOwnProperty(pre,s.name)||signals.push(s)}),signals}(spec,config);signals.forEach(_=>parseSignal(_,scope)),scope.description=spec.description||config.description,scope.eventConfig=config.events,scope.legends=scope.objectProperty(config.legend&&config.legend.layout),scope.locale=config.locale;const input=scope.add(Collect()),encode=scope.add(Encode(parseEncode((spec=>extendEncode({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},spec))(spec.encode),"group","frame",spec.style,scope,{pulse:ref(input)}))),parent=scope.add(ViewLayout({layout:scope.objectProperty(spec.layout),legends:scope.legends,autosize:scope.signalRef("autosize"),mark:root,pulse:ref(encode)}));scope.operators.pop(),scope.pushState(ref(encode),ref(parent),null),parseScope(spec,scope,signals),scope.operators.push(parent);let op=scope.add(Bound({mark:root,pulse:ref(parent)}));return op=scope.add(Render({pulse:ref(op)})),op=scope.add(Sieve({pulse:ref(op)})),scope.addData("root",new DataScope(scope,input,input,op)),scope}function signalObject(name,value){return value&&value.signal?{name:name,update:value.signal}:{name:name,value:value}}function Scope$1(config,options){this.config=config||{},this.options=options||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Subscope(scope){this.config=scope.config,this.options=scope.options,this.legends=scope.legends,this.field=Object.create(scope.field),this.signals=Object.create(scope.signals),this.lambdas=Object.create(scope.lambdas),this.scales=Object.create(scope.scales),this.events=Object.create(scope.events),this.data=Object.create(scope.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++scope._nextsub[0],this._nextsub=scope._nextsub,this._parent=scope._parent.slice(),this._encode=scope._encode.slice(),this._lookup=scope._lookup.slice(),this._markpath=scope._markpath}function propertyLambda(spec){return(vegaUtil.isArray(spec)?arrayLambda:objectLambda)(spec)}function arrayLambda(array){const n=array.length;let code="[";for(let i=0;i<n;++i){const value=array[i];code+=(i>0?",":"")+(vegaUtil.isObject(value)?value.signal||propertyLambda(value):vegaUtil.stringValue(value))}return code+"]"}function objectLambda(obj){let key,value,code="{",i=0;for(key in obj)value=obj[key],code+=(++i>1?",":"")+vegaUtil.stringValue(key)+":"+(vegaUtil.isObject(value)?value.signal||propertyLambda(value):vegaUtil.stringValue(value));return code+"}"}function defaults(){return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}Scope$1.prototype=Subscope.prototype={parse(spec){return parseScope(spec,this)},fork(){return new Subscope(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(op){return this.operators.push(op),op.id=this.id(),op.refs&&(op.refs.forEach(ref=>{ref.$ref=op.id}),op.refs=null),op},proxy(op){const vref=op instanceof Entry?ref(op):op;return this.add(Proxy({value:vref}))},addStream(stream){return this.streams.push(stream),stream.id=this.id(),stream},addUpdate(update){return this.updates.push(update),update},finish(){let name,ds;for(name in this.root&&(this.root.root=!0),this.signals)this.signals[name].signal=name;for(name in this.scales)this.scales[name].scale=name;function annotate(op,name,type){let data,list;op&&(data=op.data||(op.data={}),list=data[name]||(data[name]=[]),list.push(type))}for(name in this.data){ds=this.data[name],annotate(ds.input,name,"input"),annotate(ds.output,name,"output"),annotate(ds.values,name,"values");for(const field in ds.index)annotate(ds.index[field],name,"index:"+field)}return this},pushState(encode,parent,lookup){this._encode.push(ref(this.add(Sieve({pulse:encode})))),this._parent.push(parent),this._lookup.push(lookup?ref(this.proxy(lookup)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return vegaUtil.peek(this._parent)},encode(){return vegaUtil.peek(this._encode)},lookup(){return vegaUtil.peek(this._lookup)},markpath(){const p=this._markpath;return++p[p.length-1]},fieldRef(field,name){if(vegaUtil.isString(field))return fieldRef(field,name);field.signal||vegaUtil.error("Unsupported field reference: "+vegaUtil.stringValue(field));const s=field.signal;let f=this.field[s];if(!f){const params={name:this.signalRef(s)};name&&(params.as=name),this.field[s]=f=ref(this.add(Field(params)))}return f},compareRef(cmp){let signal=!1;const check=_=>isSignal(_)?(signal=!0,this.signalRef(_.signal)):function(_){return _&&_.expr}(_)?(signal=!0,this.exprRef(_.expr)):_,fields=vegaUtil.array(cmp.field).map(check),orders=vegaUtil.array(cmp.order).map(check);return signal?ref(this.add(Compare({fields:fields,orders:orders}))):compareRef(fields,orders)},keyRef(fields,flat){let signal=!1;const sig=this.signals;return fields=vegaUtil.array(fields).map(_=>isSignal(_)?(signal=!0,ref(sig[_.signal])):_),signal?ref(this.add(Key({fields:fields,flat:flat}))):function(fields,flat){const ref={$key:fields};return flat&&(ref.$flat=!0),ref}(fields,flat)},sortRef(sort){if(!sort)return sort;const a=aggrField(sort.op,sort.field),o=sort.order||"ascending";return o.signal?ref(this.add(Compare({fields:a,orders:this.signalRef(o.signal)}))):compareRef(a,o)},event(source,type){const key=source+":"+type;if(!this.events[key]){const id=this.id();this.streams.push({id:id,source:source,type:type}),this.events[key]=id}return this.events[key]},hasOwnSignal(name){return vegaUtil.hasOwnProperty(this.signals,name)},addSignal(name,value){this.hasOwnSignal(name)&&vegaUtil.error("Duplicate signal name: "+vegaUtil.stringValue(name));const op=value instanceof Entry?value:this.add(operator(value));return this.signals[name]=op},getSignal(name){return this.signals[name]||vegaUtil.error("Unrecognized signal name: "+vegaUtil.stringValue(name)),this.signals[name]},signalRef(s){return this.signals[s]?ref(this.signals[s]):(vegaUtil.hasOwnProperty(this.lambdas,s)||(this.lambdas[s]=this.add(operator(null))),ref(this.lambdas[s]))},parseLambdas(){const code=Object.keys(this.lambdas);for(let i=0,n=code.length;i<n;++i){const s=code[i],e=vegaFunctions.parseExpression(s,this),op=this.lambdas[s];op.params=e.$params,op.update=e.$expr}},property(spec){return spec&&spec.signal?this.signalRef(spec.signal):spec},objectProperty(spec){return spec&&vegaUtil.isObject(spec)?this.signalRef(spec.signal||propertyLambda(spec)):spec},exprRef(code,name){const params={expr:vegaFunctions.parseExpression(code,this)};return name&&(params.expr.$name=name),ref(this.add(Expression(params)))},addBinding(name,bind){this.bindings||vegaUtil.error("Nested signals do not support binding: "+vegaUtil.stringValue(name)),this.bindings.push(vegaUtil.extend({signal:name},bind))},addScaleProj(name,transform){vegaUtil.hasOwnProperty(this.scales,name)&&vegaUtil.error("Duplicate scale or projection name: "+vegaUtil.stringValue(name)),this.scales[name]=this.add(transform)},addScale(name,params){this.addScaleProj(name,Scale(params))},addProjection(name,params){this.addScaleProj(name,Projection(params))},getScale(name){return this.scales[name]||vegaUtil.error("Unrecognized scale name: "+vegaUtil.stringValue(name)),this.scales[name]},scaleRef(name){return ref(this.getScale(name))},scaleType(name){return this.getScale(name).params.type},projectionRef(name){return this.scaleRef(name)},projectionType(name){return this.scaleType(name)},addData(name,dataScope){return vegaUtil.hasOwnProperty(this.data,name)&&vegaUtil.error("Duplicate data set name: "+vegaUtil.stringValue(name)),this.data[name]=dataScope},getData(name){return this.data[name]||vegaUtil.error("Undefined data set name: "+vegaUtil.stringValue(name)),this.data[name]},addDataPipeline(name,entries){return vegaUtil.hasOwnProperty(this.data,name)&&vegaUtil.error("Duplicate data set name: "+vegaUtil.stringValue(name)),this.addData(name,DataScope.fromEntries(this,entries))}},exports.AxisDomainRole="axis-domain",exports.AxisGridRole="axis-grid",exports.AxisLabelRole="axis-label",exports.AxisRole="axis",exports.AxisTickRole="axis-tick",exports.AxisTitleRole="axis-title",exports.DataScope=DataScope,exports.FrameRole="frame",exports.LegendEntryRole="legend-entry",exports.LegendLabelRole="legend-label",exports.LegendRole="legend",exports.LegendSymbolRole="legend-symbol",exports.LegendTitleRole="legend-title",exports.MarkRole="mark",exports.Scope=Scope$1,exports.ScopeRole="scope",exports.config=defaults,exports.parse=function(spec,config,options){return vegaUtil.isObject(spec)||vegaUtil.error("Input Vega specification must be an object."),parseView(spec,new Scope$1(config=vegaUtil.mergeConfig({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},config,spec.config),options)).toRuntime()},exports.signal=parseSignal,exports.signalUpdates=parseSignalUpdates,exports.stream=parseStream,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37),__webpack_require__(62),__webpack_require__(133),__webpack_require__(45),__webpack_require__(40))},function(module,exports,__webpack_require__){!function(exports){"use strict";const ILLEGAL=/[[\]{}]/,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let DEFAULT_SOURCE,MARKS;function find(s,i,endChar,pushChar,popChar){const n=s.length;let c,count=0;for(;i<n;++i){if(c=s[i],!count&&c===endChar)return i;popChar&&popChar.indexOf(c)>=0?--count:pushChar&&pushChar.indexOf(c)>=0&&++count}return i}function parseMerge(s){const output=[],n=s.length;let start=0,i=0;for(;i<n;)i=find(s,i,",","[{","]}"),output.push(s.substring(start,i).trim()),start=++i;if(0===output.length)throw"Empty event selector: "+s;return output}function parseSelector(s){return"["===s[0]?function(s){const n=s.length;let b,i=1;if(i=find(s,i,"]","[","]"),i===n)throw"Empty between selector: "+s;if(b=parseMerge(s.substring(1,i)),2!==b.length)throw"Between selector must have two elements: "+s;if(">"!==(s=s.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+s;b=b.map(parseSelector);const stream=parseSelector(s.slice(1).trim());return stream.between?{between:b,stream:stream}:(stream.between=b,stream)}(s):function(s){const stream={source:DEFAULT_SOURCE},source=[];let j,filter,throttle=[0,0],markname=0,start=0,n=s.length,i=0;if("}"===s[n-1]){if(i=s.lastIndexOf("{"),!(i>=0))throw"Unmatched right brace: "+s;try{throttle=function(s){const a=s.split(",");if(!s.length||a.length>2)throw s;return a.map(_=>{const x=+_;if(x!=x)throw s;return x})}(s.substring(i+1,n-1))}catch(e){throw"Invalid throttle specification: "+s}s=s.slice(0,i).trim(),n=s.length,i=0}if(!n)throw s;if("@"===s[0]&&(markname=++i),j=find(s,i,":"),j<n&&(source.push(s.substring(start,j).trim()),start=i=++j),i=find(s,i,"["),i===n)source.push(s.substring(start,n).trim());else if(source.push(s.substring(start,i).trim()),filter=[],start=++i,start===n)throw"Unmatched left bracket: "+s;for(;i<n;){if(i=find(s,i,"]"),i===n)throw"Unmatched left bracket: "+s;if(filter.push(s.substring(start,i).trim()),i<n-1&&"["!==s[++i])throw"Expected left bracket: "+s;start=++i}if(!(n=source.length)||ILLEGAL.test(source[n-1]))throw"Invalid event selector: "+s;var type;return n>1?(stream.type=source[1],markname?stream.markname=source[0].slice(1):(type=source[0],MARKS[type]?stream.marktype=source[0]:stream.source=source[0])):stream.type=source[0],"!"===stream.type.slice(-1)&&(stream.consume=!0,stream.type=stream.type.slice(0,-1)),null!=filter&&(stream.filter=filter),throttle[0]&&(stream.throttle=throttle[0]),throttle[1]&&(stream.debounce=throttle[1]),stream}(s)}exports.selector=function(selector,source,marks){return DEFAULT_SOURCE=source||"view",MARKS=marks||DEFAULT_MARKS,parseMerge(selector.trim()).map(parseSelector)},Object.defineProperty(exports,"__esModule",{value:!0})}(exports)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=exports.unitsAsc=exports.unitsDesc=exports.units=exports.unitsMap=void 0;const moment_1=__webpack_require__(34).__importDefault(__webpack_require__(31));exports.unitsMap={ms:{weight:1,type:"fixed",base:1},s:{weight:2,type:"fixed",base:1e3},m:{weight:3,type:"mixed",base:6e4},h:{weight:4,type:"mixed",base:36e5},d:{weight:5,type:"mixed",base:864e5},w:{weight:6,type:"calendar",base:NaN},M:{weight:7,type:"calendar",base:NaN},y:{weight:9,type:"calendar",base:NaN}},exports.units=Object.keys(exports.unitsMap).sort((a,b)=>exports.unitsMap[b].weight-exports.unitsMap[a].weight),exports.unitsDesc=[...exports.units],exports.unitsAsc=[...exports.units].reverse();const isDate=d=>"[object Date]"===Object.prototype.toString.call(d);function parse(input,options={}){const text=input,{roundUp:roundUp=!1,momentInstance:momentInstance=moment_1.default,forceNow:forceNow}=options;if(!text)return;if(momentInstance.isMoment(text))return text;if(isDate(text))return momentInstance(text);if(void 0!==forceNow&&(!isDate(d=forceNow)||isNaN(d.valueOf())))throw new Error("forceNow must be a valid Date");var d;let time,index,parseString,mathString="";return"now"===text.substring(0,3)?(time=momentInstance(forceNow),mathString=text.substring("now".length)):(index=text.indexOf("||"),-1===index?(parseString=text,mathString=""):(parseString=text.substring(0,index),mathString=text.substring(index+2)),time=momentInstance(parseString)),mathString.length?function(mathString,time,roundUp){const dateTime=time,len=mathString.length;let i=0;for(;i<len;){const c=mathString.charAt(i++);let type,num,unit;if("/"===c)type=0;else if("+"===c)type=1;else{if("-"!==c)return;type=2}if(isNaN(mathString.charAt(i)))num=1;else if(2===mathString.length)num=mathString.charAt(i);else{const numFrom=i;for(;!isNaN(mathString.charAt(i));)if(i++,i>=len)return;num=parseInt(mathString.substring(numFrom,i),10)}if(0===type&&1!==num)return;unit=mathString.charAt(i++);for(let j=i;j<len;j++){const unitChar=mathString.charAt(i);if(!/[a-z]/i.test(unitChar))break;unit+=unitChar,i++}if(-1===exports.units.indexOf(unit))return;0===type?roundUp?dateTime.endOf(unit):dateTime.startOf(unit):1===type?dateTime.add(num,unit):2===type&&dateTime.subtract(num,unit)}return dateTime}(mathString,time,roundUp):time}exports.parse=parse,exports.default={parse:parse,unitsMap:Object.freeze(exports.unitsMap),units:Object.freeze(exports.units),unitsAsc:Object.freeze(exports.unitsAsc),unitsDesc:Object.freeze(exports.unitsDesc)}},function(module,exports,__webpack_require__){!function(exports,vegaUtil){"use strict";var pkg_version="0.25.1",__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},EL_ID="vg-tooltip-element",DEFAULT_OPTIONS={offsetX:10,offsetY:10,id:EL_ID,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:escapeHTML,maxDepth:2};function escapeHTML(value){return String(value).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function createDefaultStyle(id){if(!/^[A-Za-z]+[-:.\w]*$/.test(id))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(EL_ID,id)}function formatValue(value,valueToHtml,maxDepth){if(vegaUtil.isArray(value))return"["+value.map((function(v){return valueToHtml(vegaUtil.isString(v)?v:stringify(v,maxDepth))})).join(", ")+"]";if(vegaUtil.isObject(value)){var content="",_a=value,title=_a.title,image=_a.image,rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}(_a,["title","image"]);title&&(content+="<h2>"+valueToHtml(title)+"</h2>"),image&&(content+='<img src="'+valueToHtml(image)+'">');var keys=Object.keys(rest);if(keys.length>0){content+="<table>";for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i],val=rest[key];void 0!==val&&(vegaUtil.isObject(val)&&(val=stringify(val,maxDepth)),content+='<tr><td class="key">'+valueToHtml(key)+':</td><td class="value">'+valueToHtml(val)+"</td></tr>")}content+="</table>"}return content||"{}"}return valueToHtml(value)}function replacer(maxDepth){var stack=[];return function(key,value){if("object"!=typeof value||null===value)return value;var pos=stack.indexOf(this)+1;return stack.length=pos,stack.length>maxDepth?"[Object]":stack.indexOf(value)>=0?"[Circular]":(stack.push(value),value)}}function stringify(obj,maxDepth){return JSON.stringify(obj,replacer(maxDepth))}function calculatePosition(event,tooltipBox,offsetX,offsetY){var x=event.clientX+offsetX;x+tooltipBox.width>window.innerWidth&&(x=+event.clientX-offsetX-tooltipBox.width);var y=event.clientY+offsetY;return y+tooltipBox.height>window.innerHeight&&(y=+event.clientY-offsetY-tooltipBox.height),{x:x,y:y}}var Handler=function(){function Handler(options){this.options=__assign(__assign({},DEFAULT_OPTIONS),options);var elementId=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){var style=document.createElement("style");style.setAttribute("id",this.options.styleId),style.innerHTML=createDefaultStyle(elementId);var head=document.head;head.childNodes.length>0?head.insertBefore(style,head.childNodes[0]):head.appendChild(style)}}return Handler.prototype.tooltipHandler=function(handler,event,item,value){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null!=value&&""!==value){this.el.innerHTML=formatValue(value,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",this.options.theme+"-theme");var _a=calculatePosition(event,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY),x=_a.x,y=_a.y;this.el.setAttribute("style","top: "+y+"px; left: "+x+"px")}else this.el.classList.remove("visible",this.options.theme+"-theme")},Handler}(),version$1=pkg_version;exports.DEFAULT_OPTIONS=DEFAULT_OPTIONS,exports.Handler=Handler,exports.calculatePosition=calculatePosition,exports.createDefaultStyle=createDefaultStyle,exports.default=function(view,opt){var handler=new Handler(opt);return view.tooltip(handler.call).run(),handler},exports.escapeHTML=escapeHTML,exports.formatValue=formatValue,exports.replacer=replacer,exports.stringify=stringify,exports.version=version$1,Object.defineProperty(exports,"__esModule",{value:!0})}(exports,__webpack_require__(37))}])]);