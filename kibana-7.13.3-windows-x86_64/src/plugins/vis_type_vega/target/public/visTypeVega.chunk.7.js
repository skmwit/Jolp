(window.visTypeVega_bundle_jsonpfunction=window.visTypeVega_bundle_jsonpfunction||[]).push([[7],{217:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"VegaParser",(function(){return vega_parser_VegaParser}));var external_kbnSharedDeps_Lodash_=__webpack_require__(7),external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_),dist_parser=__webpack_require__(85),parser_default=__webpack_require__.n(dist_parser),compare_versions=__webpack_require__(86),compare_versions_default=__webpack_require__.n(compare_versions),hjson=__webpack_require__(10),hjson_default=__webpack_require__.n(hjson),external_kbnSharedDeps_ElasticEui_=__webpack_require__(8),external_kbnSharedDeps_Theme_=__webpack_require__(33),external_kbnSharedDeps_KbnI18n_=__webpack_require__(3),vega_node=__webpack_require__(48),vega_lite=__webpack_require__(80),external_kbnSharedDeps_Moment_=__webpack_require__(31),external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const getRequestName=(request,index)=>request.dataObject.name||external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.unnamedRequest",{defaultMessage:"Unnamed request #{index}",values:{index:index}});class es_query_parser_EsQueryParser{constructor(timeCache,searchAPI,filters,onWarning){_defineProperty(this,"_timeCache",void 0),_defineProperty(this,"_searchAPI",void 0),_defineProperty(this,"_filters",void 0),_defineProperty(this,"_onWarning",void 0),this._timeCache=timeCache,this._searchAPI=searchAPI,this._filters=filters,this._onWarning=onWarning}parseUrl(dataObject,url){let body=url.body,context=url["%context%"];delete url["%context%"];let timefield=url["%timefield%"];delete url["%timefield%"];let usesContext=void 0!==context||void 0!==timefield;if(void 0===body)url.body=body={};else if(!Object(external_kbnSharedDeps_Lodash_.isPlainObject)(body))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.urlBodyValueTypeErrorMessage",{defaultMessage:"{configName} must be an object",values:{configName:"url.body"}}));const legacyContext=url["%context_query%"];if(delete url["%context_query%"],void 0!==legacyContext){if(void 0!==body.query)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyAndBodyQueryValuesAtTheSameTimeErrorMessage",{defaultMessage:"{dataUrlParam} must not have legacy {legacyContext} and {bodyQueryConfigName} values at the same time",values:{legacyContext:'"%context_query%"',bodyQueryConfigName:'"body.query"',dataUrlParam:'"data.url"'}}));if(usesContext)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyContextTogetherWithContextOrTimefieldErrorMessage",{defaultMessage:"{dataUrlParam} must not have {legacyContext} together with {context} or {timefield}",values:{legacyContext:'"%context_query%"',context:'"%context%"',timefield:'"%timefield%"',dataUrlParam:'"data.url"'}}));if(!0!==legacyContext&&("string"!=typeof legacyContext||0===legacyContext.length))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.legacyContextCanBeTrueErrorMessage",{defaultMessage:"Legacy {legacyContext} can either be {trueValue} (ignores time range picker), or it can be the name of the time field, e.g. {timestampParam}",values:{legacyContext:'"%context_query%"',trueValue:"true",timestampParam:'"@timestamp"'}}));usesContext=!0,context=!0;let result='"url": {"%context%": true';"string"==typeof legacyContext&&(timefield=legacyContext,result+=', "%timefield%": '+JSON.stringify(timefield)),result+="}",this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.legacyUrlShouldChangeToWarningMessage",{defaultMessage:"Legacy {urlParam}: {legacyUrl} should change to {result}",values:{legacyUrl:'"%context_query%": '+JSON.stringify(legacyContext),result:result,urlParam:'"url"'}}))}if(void 0!==body.query){if(usesContext)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.urlContextAndUrlTimefieldMustNotBeUsedErrorMessage",{defaultMessage:"{urlContext} and {timefield} must not be used when {queryParam} is set",values:{timefield:"url.%timefield%",urlContext:"url.%context%",queryParam:"url.body.query"}}));this._injectContextVars(body.query,!0)}else if(usesContext&&(timefield&&(body.query={range:{[timefield]:this._createRangeFilter({"%timefilter%":!0})}}),context)){const newQuery=Object(external_kbnSharedDeps_Lodash_.cloneDeep)(this._filters);timefield&&newQuery.bool.must.push(body.query),body.query=newQuery}return this._injectContextVars(body.aggs,!1),{dataObject:dataObject,url:url}}async populateData(requests){const esSearches=requests.map((r,index)=>({...r.url,name:getRequestName(r,index)})),data$=this._searchAPI.search(esSearches);(await data$.toPromise()).forEach((data,index)=>{const requestObject=requests.find(item=>getRequestName(item,index)===data.name);requestObject&&(requestObject.dataObject.url=requestObject.url,requestObject.dataObject.values=data.rawResponse)})}_injectContextVars(obj,isQuery){if(obj&&"object"==typeof obj)if(Array.isArray(obj))for(let pos=0;pos<obj.length;){const item=obj[pos];if(!isQuery||"%dashboard_context-filter_clause%"!==item&&"%dashboard_context-must_clause%"!==item&&"%dashboard_context-must_not_clause%"!==item)this._injectContextVars(item,isQuery),pos++;else{let ctxTag="";switch(item){case"%dashboard_context-filter_clause%":ctxTag="filter";break;case"%dashboard_context-must_clause%":ctxTag="must";break;case"%dashboard_context-must_not_clause%":ctxTag="must_not"}const ctx=Object(external_kbnSharedDeps_Lodash_.cloneDeep)(this._filters);ctx&&ctx.bool&&ctx.bool[ctxTag]?Array.isArray(ctx.bool[ctxTag])?(obj.splice(pos,1,...ctx.bool[ctxTag]),pos+=ctx.bool[ctxTag].length):obj[pos++]=ctx.bool[ctxTag]:obj.splice(pos,1)}}else for(const prop of Object.keys(obj)){const subObj=obj[prop];if(subObj&&"object"==typeof obj)if("interval"===prop&&subObj["%autointerval%"]){let size=subObj["%autointerval%"];if(!0===size)size=50;else if("number"!=typeof size)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.autointervalValueTypeErrorMessage",{defaultMessage:"{autointerval} must be either {trueValue} or a number",values:{autointerval:'"%autointerval%"',trueValue:"true"}}));const bounds=this._timeCache.getTimeBounds();obj.interval=es_query_parser_EsQueryParser._roundInterval((bounds.max-bounds.min)/size)}else switch(subObj["%timefilter%"]){case"min":case"max":obj[prop]=this._getTimeBound(subObj,subObj["%timefilter%"]);continue;case!0:this._createRangeFilter(subObj);continue;case void 0:this._injectContextVars(subObj,isQuery);continue;default:throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.timefilterValueErrorMessage",{defaultMessage:"{timefilter} property must be set to {trueValue}, {minValue}, or {maxValue}",values:{timefilter:'"%timefilter%"',trueValue:"true",minValue:'"min"',maxValue:'"max"'}}))}}}_createRangeFilter(obj){return obj.gte=external_kbnSharedDeps_Moment_default()(this._getTimeBound(obj,"min")).toISOString(),obj.lte=external_kbnSharedDeps_Moment_default()(this._getTimeBound(obj,"max")).toISOString(),obj.format="strict_date_optional_time",delete obj["%timefilter%"],delete obj.shift,delete obj.unit,obj}_getTimeBound(opts,type){var _bounds$type;let result=(null===(_bounds$type=this._timeCache.getTimeBounds()[type])||void 0===_bounds$type?void 0:_bounds$type.valueOf())||0;if(opts.shift){const shift=opts.shift;if("number"!=typeof shift)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.shiftMustValueTypeErrorMessage",{defaultMessage:"{shiftParam} must be a numeric value",values:{shiftParam:'"shift"'}}));let multiplier;switch(opts.unit||"d"){case"w":case"week":multiplier=6048e5;break;case"d":case"day":multiplier=864e5;break;case"h":case"hour":multiplier=36e5;break;case"m":case"minute":multiplier=6e4;break;case"s":case"second":multiplier=1e3;break;default:throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.esQueryParser.unknownUnitValueErrorMessage",{defaultMessage:"Unknown {unitParamName} value. Must be one of: [{unitParamValues}]",values:{unitParamName:'"unit"',unitParamValues:'"week", "day", "hour", "minute", "second"'}}))}result+=shift*multiplier}return result}static _roundInterval(interval){switch(!0){case interval<=500:return"100ms";case interval<=5e3:return"1s";case interval<=7500:return"5s";case interval<=15e3:return"10s";case interval<=45e3:return"30s";case interval<=18e4:return"1m";case interval<=45e4:return"5m";case interval<=12e5:return"10m";case interval<=27e5:return"30m";case interval<=72e5:return"1h";case interval<=216e5:return"3h";case interval<=864e5:return"12h";case interval<=6048e5:return"24h";case interval<=18144e5:return"1w";case interval<36288e5:return"30d";default:return"1y"}}}var utils=__webpack_require__(81),vega_base_view=__webpack_require__(71);function ems_file_parser_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class ems_file_parser_EmsFileParser{constructor(serviceSettings){ems_file_parser_defineProperty(this,"_serviceSettings",void 0),ems_file_parser_defineProperty(this,"_fileLayersP",void 0),this._serviceSettings=serviceSettings}parseUrl(obj,url){if("string"!=typeof url.name)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.emsFileParser.missingNameOfFileErrorMessage",{defaultMessage:"{dataUrlParam} with {dataUrlParamValue} requires {nameParam} parameter (name of the file)",values:{dataUrlParam:'"data.url"',dataUrlParamValue:'{"%type%": "emsfile"}',nameParam:'"name"'}}));return this._fileLayersP||(this._fileLayersP=this._serviceSettings.getFileLayers()),{obj:obj,name:url.name}}async populateData(requests){if(0===requests.length)return;const layers=await this._fileLayersP;for(const{obj:obj,name:name}of requests){const foundLayer=null==layers?void 0:layers.find(v=>v.name===name);if(!foundLayer)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.emsFileParser.emsFileNameDoesNotExistErrorMessage",{defaultMessage:"{emsfile} {emsfileName} does not exist",values:{emsfileName:JSON.stringify(name),emsfile:"emsfile"}}));const url=await this._serviceSettings.getUrlForRegionLayer(foundLayer);obj.url=Object(vega_base_view.b)(url)}}}var external_kbnSharedDeps_Jquery_=__webpack_require__(32),external_kbnSharedDeps_Jquery_default=__webpack_require__.n(external_kbnSharedDeps_Jquery_);class url_parser_UrlParser{constructor(onWarning){var obj,key,value;value=void 0,(key="_onWarning")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this._onWarning=onWarning}parseUrl(obj,urlObj){let url=urlObj.url;if(!url)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.urlParser.dataUrlRequiresUrlParameterInFormErrorMessage",{defaultMessage:'{dataUrlParam} requires a {urlParam} parameter in a form "{formLink}"',values:{dataUrlParam:'"data.url"',urlParam:'"url"',formLink:"https://example.org/path/subpath"}}));const query=urlObj.query;query?url+=(url.includes("?")?"&":"?")+external_kbnSharedDeps_Jquery_default.a.param(query):this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.urlParser.urlShouldHaveQuerySubObjectWarningMessage",{defaultMessage:"Using a {urlObject} should have a {subObjectName} sub-object",values:{urlObject:'"url": {"%type%": "url", "url": ...}',subObjectName:'"query"'}})),obj.url=url}populateData(){}}function vega_parser_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const defaultColor=Object(external_kbnSharedDeps_ElasticEui_.euiPaletteColorBlind)()[0],locToDirMap={left:"row-reverse",right:"row",top:"column-reverse",bottom:"column"};class vega_parser_VegaParser{constructor(spec,searchAPI,timeCache,filters,getServiceSettings){vega_parser_defineProperty(this,"spec",void 0),vega_parser_defineProperty(this,"hideWarnings",void 0),vega_parser_defineProperty(this,"restoreSignalValuesOnRefresh",void 0),vega_parser_defineProperty(this,"error",void 0),vega_parser_defineProperty(this,"warnings",void 0),vega_parser_defineProperty(this,"_urlParsers",void 0),vega_parser_defineProperty(this,"isVegaLite",void 0),vega_parser_defineProperty(this,"useHover",void 0),vega_parser_defineProperty(this,"_config",void 0),vega_parser_defineProperty(this,"useMap",void 0),vega_parser_defineProperty(this,"renderer",void 0),vega_parser_defineProperty(this,"tooltips",void 0),vega_parser_defineProperty(this,"mapConfig",void 0),vega_parser_defineProperty(this,"vlspec",void 0),vega_parser_defineProperty(this,"useResize",void 0),vega_parser_defineProperty(this,"containerDir",void 0),vega_parser_defineProperty(this,"controlsDir",void 0),vega_parser_defineProperty(this,"searchAPI",void 0),vega_parser_defineProperty(this,"getServiceSettings",void 0),vega_parser_defineProperty(this,"filters",void 0),vega_parser_defineProperty(this,"timeCache",void 0),this.spec=spec,this.hideWarnings=!1,this.error=void 0,this.warnings=[],this.searchAPI=searchAPI,this.getServiceSettings=getServiceSettings,this.filters=filters,this.timeCache=timeCache}async parseAsync(){try{await this._parseAsync()}catch(err){this.error=utils.a.formatErrorToStr(err)}return this}async _parseAsync(){if(void 0!==this.isVegaLite)throw new Error;if("string"==typeof this.spec){const spec=hjson_default.a.parse(this.spec,{legacyRoot:!1});if(!spec.$schema)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.inputSpecDoesNotSpecifySchemaErrorMessage",{defaultMessage:"Your specification requires a {schemaParam} field with a valid URL for\nVega (see {vegaSchemaUrl}) or\nVega-Lite (see {vegaLiteSchemaUrl}).\nThe URL is an identifier only. Kibana and your browser will never access this URL.",values:{schemaParam:'"$schema"',vegaLiteSchemaUrl:"https://vega.github.io/vega-lite/docs/spec.html#top-level",vegaSchemaUrl:"https://vega.github.io/vega/docs/specification/#top-level-specification-properties"}}));this.spec=spec}if(!external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.spec))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.invalidVegaSpecErrorMessage",{defaultMessage:"Invalid Vega specification"}));this.isVegaLite=this.parseSchema(this.spec).isVegaLite,this.useHover=!this.isVegaLite,this._config=this._parseConfig(),this.hideWarnings=!!this._config.hideWarnings,this._parseBool("restoreSignalValuesOnRefresh",this._config,!1),this.restoreSignalValuesOnRefresh=this._config.restoreSignalValuesOnRefresh,this.useMap="map"===this._config.type,this.renderer="svg"===this._config.renderer?"svg":"canvas",this.tooltips=this._parseTooltips(),this._setDefaultColors(),this._parseControlPlacement(),this.useMap?(this.mapConfig=this._parseMapConfig(),this.useResize=!1):this.spec&&this._compileWithAutosize(),await this._resolveDataUrls(),this.isVegaLite&&this._compileVegaLite()}_compileWithAutosize(){const defaultAutosize={type:"fit",contains:"padding"};let autosize=this.spec.autosize,useResize=!0;if(this.isVegaLite||!autosize||"object"!=typeof autosize||!("signal"in autosize)){if(autosize||void 0===autosize||this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.autoSizeDoesNotAllowFalse",{defaultMessage:"{autoSizeParam} is enabled, it can only be disabled by setting {autoSizeParam} to {noneParam}",values:{autoSizeParam:'"autosize"',noneParam:'"none"'}})),"string"==typeof autosize)useResize="none"!==autosize,autosize={...defaultAutosize,type:autosize};else if("object"==typeof autosize){var _autosize,_autosize2;autosize={...defaultAutosize,...autosize},useResize=Boolean((null===(_autosize=autosize)||void 0===_autosize?void 0:_autosize.type)&&"none"!==(null===(_autosize2=autosize)||void 0===_autosize2?void 0:_autosize2.type))}else autosize=defaultAutosize;useResize&&(this.spec.width&&"container"!==this.spec.width||this.spec.height&&"container"!==this.spec.height)&&this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.widthAndHeightParamsAreIgnored",{defaultMessage:"{widthParam} and {heightParam} params are ignored because {autoSizeParam} is enabled. Set {autoSizeParam}: {noneParam} to disable",values:{widthParam:'"width"',heightParam:'"height"',autoSizeParam:'"autosize"',noneParam:'"none"'}})),useResize&&(this.spec.width="container",this.spec.height="container"),this.spec.autosize=autosize,this.useResize=useResize}}_compileVegaLite(){this.vlspec=this.spec;const vegaLogger=Object(vega_node.logger)(vega_node.Warn);if(vegaLogger.warn=this._onWarning.bind(this),this.spec=Object(vega_lite.compile)(this.vlspec,{logger:vegaLogger}).spec,this.useMap){if(!this.spec||!this.vlspec)return;const hasConfig=external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.vlspec.config);if(void 0===this.vlspec.config||hasConfig&&!this.vlspec.config.projection){if(!Array.isArray(this.spec.projections)||1!==this.spec.projections.length||"projection"!==this.spec.projections[0].name)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.VLCompilerShouldHaveGeneratedSingleProtectionObjectErrorMessage",{defaultMessage:"Internal error: Vega-Lite compiler should have generated a single projection object"}));delete this.spec.projections}this.vlspec.width||delete this.spec.width,this.vlspec.height||delete this.spec.height,this.vlspec.padding||void 0!==this.vlspec.config&&(!hasConfig||this.vlspec.config.padding)||delete this.spec.padding,this.vlspec.autosize||void 0!==this.vlspec.config&&(!hasConfig||this.vlspec.config.autosize)||delete this.spec.autosize}}_parseControlPlacement(){var _this$_config,_this$_config2;if(this.containerDir=null!==(_this$_config=this._config)&&void 0!==_this$_config&&_this$_config.controlsLocation?locToDirMap[this._config.controlsLocation]:void 0,void 0===this.containerDir){if(!this._config||void 0!==this._config.controlsLocation)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.unrecognizedControlsLocationValueErrorMessage",{defaultMessage:"Unrecognized {controlsLocationParam} value. Expecting one of [{locToDirMap}]",values:{locToDirMap:`"${Object.keys(locToDirMap).join('", "')}"`,controlsLocationParam:"controlsLocation"}}));this.containerDir="column"}const dir=null===(_this$_config2=this._config)||void 0===_this$_config2?void 0:_this$_config2.controlsDirection;if(void 0!==dir&&"horizontal"!==dir&&"vertical"!==dir)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.unrecognizedDirValueErrorMessage",{defaultMessage:"Unrecognized {dirParam} value. Expecting one of [{expectedValues}]",values:{expectedValues:'"horizontal", "vertical"',dirParam:"dir"}}));this.controlsDir="horizontal"===dir?"row":"column"}_parseConfig(){let result=null;if(this.spec){if(void 0!==this.spec._hostConfig){if(result=this.spec._hostConfig,delete this.spec._hostConfig,!external_kbnSharedDeps_Lodash_default.a.isPlainObject(result))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.hostConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:'"_hostConfig"'}}));this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.hostConfigIsDeprecatedWarningMessage",{defaultMessage:"{deprecatedConfigName} has been deprecated. Use {newConfigName} instead.",values:{deprecatedConfigName:'"_hostConfig"',newConfigName:"config.kibana"}}))}if(external_kbnSharedDeps_Lodash_default.a.isPlainObject(this.spec.config)&&void 0!==this.spec.config.kibana&&(result=this.spec.config.kibana,delete this.spec.config.kibana,!external_kbnSharedDeps_Lodash_default.a.isPlainObject(result)))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.kibanaConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:"config.kibana"}}))}return result||{}}_parseTooltips(){var _this$_config3;if(this._config&&!1===this._config.tooltips)return!1;const result=(null===(_this$_config3=this._config)||void 0===_this$_config3?void 0:_this$_config3.tooltips)||{};if(void 0===result.position)result.position="top";else if(-1===["top","right","bottom","left"].indexOf(result.position))throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.unexpectedValueForPositionConfigurationErrorMessage",{defaultMessage:"Unexpected value for the {configurationName} configuration",values:{configurationName:"result.position"}}));if(void 0===result.padding)result.padding=16;else if("number"!=typeof result.padding)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.paddingConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a number",values:{configName:"config.kibana.result.padding"}}));if(void 0===result.textTruncate)result.textTruncate=!1;else if("boolean"!=typeof result.textTruncate)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.textTruncateConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a boolean",values:{configName:"textTruncate"}}));if(void 0===result.centerOnMark)result.centerOnMark=50;else if("boolean"==typeof result.centerOnMark)result.centerOnMark=result.centerOnMark?Number.MAX_VALUE:-1;else if("number"!=typeof result.centerOnMark)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.centerOnMarkConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be {trueValue}, {falseValue}, or a number",values:{configName:"config.kibana.result.centerOnMark",trueValue:"true",falseValue:"false"}}));return result}_parseMapConfig(){var _this$_config4,_this$_config6;const res={delayRepaint:void 0===(null===(_this$_config4=this._config)||void 0===_this$_config4?void 0:_this$_config4.delayRepaint)||this._config.delayRepaint},validate=(name,isZoom)=>{const val=this._config?this._config[name]:void 0;if(void 0!==val){const parsed=parseFloat(val);if(Number.isFinite(parsed)&&(!isZoom||parsed>=0&&parsed<=30))return void(res[name]=parsed);this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.someKibanaConfigurationIsNoValidWarningMessage",{defaultMessage:"{configName} is not valid",values:{configName:"config.kibana."+name}}))}isZoom||(res[name]=0)};var _this$_config5;(validate("latitude",!1),validate("longitude",!1),validate("zoom",!0),validate("minZoom",!0),validate("maxZoom",!0),this._parseBool("mapStyle",res,!0),res.mapStyle)&&(res.emsTileServiceId=null===(_this$_config5=this._config)||void 0===_this$_config5?void 0:_this$_config5.emsTileServiceId);this._parseBool("zoomControl",res,!0),this._parseBool("scrollWheelZoom",res,!1);const maxBounds=null===(_this$_config6=this._config)||void 0===_this$_config6?void 0:_this$_config6.maxBounds;return void 0!==maxBounds&&(Array.isArray(maxBounds)&&4===maxBounds.length&&maxBounds.every(v=>"number"==typeof v&&Number.isFinite(v))?res.maxBounds=maxBounds:this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.maxBoundsValueTypeWarningMessage",{defaultMessage:"{maxBoundsConfigName} must be an array with four numbers",values:{maxBoundsConfigName:"config.kibana.maxBounds"}}))),res}_parseBool(paramName,dstObj,dflt){const val=this._config?this._config[paramName]:void 0;void 0===val?dstObj[paramName]=dflt:"boolean"!=typeof val?(this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.someKibanaParamValueTypeWarningMessage",{defaultMessage:"{configName} must be a boolean value",values:{configName:"config.kibana."+paramName}})),dstObj[paramName]=dflt):dstObj[paramName]=val}parseSchema(spec){const schema=parser_default()(spec.$schema),isVegaLite="vega-lite"===schema.library,libVersion=isVegaLite?vega_lite.version:vega_node.version;return compare_versions_default()(schema.version,libVersion)>0&&this._onWarning(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.notValidLibraryVersionForInputSpecWarningMessage",{defaultMessage:"The input spec uses {schemaLibrary} {schemaVersion}, but current version of {schemaLibrary} is {libraryVersion}.",values:{schemaLibrary:schema.library,schemaVersion:schema.version,libraryVersion:libVersion}})),{isVegaLite:isVegaLite,libVersion:libVersion}}async _resolveDataUrls(){if(!this._urlParsers){const serviceSettings=await this.getServiceSettings(),onWarn=this._onWarning.bind(this);this._urlParsers={elasticsearch:new es_query_parser_EsQueryParser(this.timeCache,this.searchAPI,this.filters,onWarn),emsfile:new ems_file_parser_EmsFileParser(serviceSettings),url:new url_parser_UrlParser(onWarn)}}const pending={};this.searchAPI.resetSearchStats(),this._findObjectDataUrls(this.spec,obj=>{const url=obj.url;delete obj.url;let type=url["%type%"];delete url["%type%"],void 0===type&&(type="elasticsearch");const parser=this._urlParsers[type];if(void 0===parser)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.notSupportedUrlTypeErrorMessage",{defaultMessage:"{urlObject} is not supported",values:{urlObject:'url: {"%type%": "${type}"}'}}));let pendingArr=pending[type];void 0===pendingArr&&(pending[type]=pendingArr=[]),pendingArr.push(parser.parseUrl(obj,url))});const pendingParsers=Object.keys(pending);pendingParsers.length>0&&await Promise.all(pendingParsers.map(type=>this._urlParsers[type].populateData(pending[type])))}_findObjectDataUrls(obj,onFind,key){if(Array.isArray(obj))for(const elem of obj)this._findObjectDataUrls(elem,onFind,key);else if(external_kbnSharedDeps_Lodash_default.a.isPlainObject(obj))if("data"===key&&external_kbnSharedDeps_Lodash_default.a.isPlainObject(obj.url)){if(void 0!==obj.values||void 0!==obj.source)throw new Error(external_kbnSharedDeps_KbnI18n_.i18n.translate("visTypeVega.vegaParser.dataExceedsSomeParamsUseTimesLimitErrorMessage",{defaultMessage:"Data must not have more than one of {urlParam}, {valuesParam}, and {sourceParam}",values:{urlParam:'"url"',valuesParam:'"values"',sourceParam:'"source"'}}));onFind(obj)}else for(const k of Object.keys(obj))this._findObjectDataUrls(obj[k],onFind,k)}_setDefaultColors(){var _this$spec;(this._setDefaultValue({scheme:"elastic"},"config","range","category"),this.isVegaLite)?this._setDefaultValue(defaultColor,"config","mark","color"):(null===(_this$spec=this.spec)||void 0===_this$spec||!_this$spec.config.mark||void 0===this.spec.config.mark.color&&void 0===this.spec.config.mark.fill)&&(this._setDefaultValue(defaultColor,"config","arc","fill"),this._setDefaultValue(defaultColor,"config","area","fill"),this._setDefaultValue(defaultColor,"config","line","stroke"),this._setDefaultValue(defaultColor,"config","path","stroke"),this._setDefaultValue(defaultColor,"config","rect","fill"),this._setDefaultValue(defaultColor,"config","rule","stroke"),this._setDefaultValue(defaultColor,"config","shape","stroke"),this._setDefaultValue(defaultColor,"config","symbol","fill"),this._setDefaultValue(defaultColor,"config","trail","fill"));this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorDarkestShade,"config","title","color"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorDarkShade,"config","style","guide-label","fill"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorDarkestShade,"config","style","guide-title","fill"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorDarkestShade,"config","style","group-title","fill"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorDarkestShade,"config","style","group-subtitle","fill"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorChartLines,"config","axis","tickColor"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorChartLines,"config","axis","domainColor"),this._setDefaultValue(external_kbnSharedDeps_Theme_.euiThemeVars.euiColorChartLines,"config","axis","gridColor"),this._setDefaultValue("transparent","config","background")}_setDefaultValue(value,...fields){let o=this.spec;for(let i=0;i<fields.length-1;i++){const field=fields[i],subObj=o[field];if(void 0===subObj)o[field]={};else if(!external_kbnSharedDeps_Lodash_default.a.isPlainObject(subObj))return;o=o[field]}const lastField=fields[fields.length-1];void 0===o[lastField]&&(o[lastField]=value)}_onWarning(...args){if(!this.hideWarnings)return this.warnings.push(utils.a.formatWarningToStr(args)),utils.a.formatWarningToStr(args)}}},85:function(module,exports){module.exports=function(e){const[n,o]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:n,version:o}}},86:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){var semver=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function split(v){var str,q,c=v.replace(/^v/,"").replace(/\+.*$/,""),patchIndex=(q="-",-1===(str=c).indexOf(q)?str.length:str.indexOf(q)),arr=c.substring(0,patchIndex).split(".");return arr.push(c.substring(patchIndex+1)),arr}function tryParse(v){return isNaN(Number(v))?v:Number(v)}function validate(version){if("string"!=typeof version)throw new TypeError("Invalid argument expected string");if(!semver.test(version))throw new Error("Invalid argument not valid semver ('"+version+"' received)")}function compareVersions(v1,v2){[v1,v2].forEach(validate);for(var s1=split(v1),s2=split(v2),i=0;i<Math.max(s1.length-1,s2.length-1);i++){var n1=parseInt(s1[i]||0,10),n2=parseInt(s2[i]||0,10);if(n1>n2)return 1;if(n2>n1)return-1}var sp1=s1[s1.length-1],sp2=s2[s2.length-1];if(sp1&&sp2){var p1=sp1.split(".").map(tryParse),p2=sp2.split(".").map(tryParse);for(i=0;i<Math.max(p1.length,p2.length);i++){if(void 0===p1[i]||"string"==typeof p2[i]&&"number"==typeof p1[i])return-1;if(void 0===p2[i]||"string"==typeof p1[i]&&"number"==typeof p2[i])return 1;if(p1[i]>p2[i])return 1;if(p2[i]>p1[i])return-1}}else if(sp1||sp2)return sp1?-1:1;return 0}var allowedOperators=[">",">=","=","<","<="],operatorResMap={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return compareVersions.compare=function(v1,v2,operator){!function(op){if("string"!=typeof op)throw new TypeError("Invalid operator type, expected string but got "+typeof op);if(-1===allowedOperators.indexOf(op))throw new TypeError("Invalid operator, expected one of "+allowedOperators.join("|"))}(operator);var res=compareVersions(v1,v2);return operatorResMap[operator].indexOf(res)>-1},compareVersions})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}}]);